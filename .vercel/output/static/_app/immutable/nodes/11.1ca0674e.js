import{ai as fs,aj as ps,a1 as $t,Z as ds,s as de,B as pe,j as G,n as H,h as M,l as Q,C as Na,q as Me,Q as Ce,e as Y,a as ee,c as K,b as U,g as Ir,d as te,i as O,k as F,x as be,D as ms,y as Ua,ac as ys,t as ut,f as ft,A as At,N as Ra,v as Pe,w as Te,M as Nt,J as R,r as hs,E as Hn}from"../chunks/scheduler.ccf898a6.js";import{g as _e,a as N,c as ke,t as j,S as ge,i as ve,b as ne,d as fe,m as oe,e as ae}from"../chunks/index.7272c3b3.js";import{g as gs}from"../chunks/navigation.58f74453.js";import{m as Se,u as Dr,a as De,o as Cr,b as dn,s as cr,d as Jn}from"../chunks/MapViewer.svelte_svelte_type_style_lang.c398696c.js";import{w as ie}from"../chunks/paths.d8f4387a.js";import{e as Yn}from"../chunks/each.34974530.js";import{v as vs}from"../chunks/v4.4a60fe23.js";import{_ as Ye}from"../chunks/preload-helper.a4192956.js";import{s as X}from"../chunks/supabaseClient.5a6af499.js";import{p as nr}from"../chunks/stores.54c459da.js";import{t as ur}from"../chunks/SvelteToast.svelte_svelte_type_style_lang.cf71ce25.js";import{a as bs,c as mn,g as ws}from"../chunks/_commonjsHelpers.de833af9.js";function Kn(t,e){const r=e.token={};function n(o,a,i,l){if(e.token!==r)return;e.resolved=l;let c=e.ctx;i!==void 0&&(c=c.slice(),c[i]=l);const p=o&&(e.current=o)(c);let b=!1;e.block&&(e.blocks?e.blocks.forEach((m,S)=>{S!==a&&m&&(_e(),N(m,1,1,()=>{e.blocks[S]===m&&(e.blocks[S]=null)}),ke())}):e.block.d(1),p.c(),j(p,1),p.m(e.mount(),e.anchor),b=!0),e.block=p,e.blocks&&(e.blocks[a]=p),b&&ds()}if(fs(t)){const o=ps();if(t.then(a=>{$t(o),n(e.then,1,e.value,a),$t(null)},a=>{if($t(o),n(e.catch,2,e.error,a),$t(null),!e.hasCatch)throw a}),e.current!==e.pending)return n(e.pending,0),!0}else{if(e.current!==e.then)return n(e.then,1,e.value,t),!0;e.resolved=t}}function Ss(t,e,r){const n=e.slice(),{resolved:o}=t;t.current===t.then&&(n[t.value]=o),t.current===t.catch&&(n[t.error]=o),t.block.p(n,r)}const xr=ie(null),Ue=ie(null);function _s(){const{subscribe:t,set:e,update:r}=ie([]);function n(o,a){const i=t(o,a);return()=>{i()}}return{subscribe:n,set:e,update:r}}const ue=_s();function ks(){const{subscribe:t,set:e,update:r}=ie([],()=>()=>{});return{subscribe:t,set:e,update:r}}const ht=ks();function Es(){const{subscribe:t,set:e,update:r}=ie([],()=>()=>{});return{subscribe:t,set:e,update:r}}const gt=Es(),qa=ie(!1),za=ie(!1),Ge=ie({showMarkerMenu:!1});function Xn(t,e,r){const n=t.slice();return n[16]=e[r],n}function Qn(t){let e,r,n,o,a='<svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>',i,l,c='<svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"></path></svg>',p,b,m,S,k,P=Yn(t[1]),$=[];for(let _=0;_<P.length;_+=1)$[_]=Zn(Xn(t,P,_));return{c(){e=Y("div"),r=Y("div"),n=Y("div"),o=Y("button"),o.innerHTML=a,i=ee(),l=Y("button"),l.innerHTML=c,p=ee(),b=Y("div"),m=Y("div");for(let _=0;_<$.length;_+=1)$[_].c();this.h()},l(_){e=K(_,"DIV",{class:!0});var g=U(e);r=K(g,"DIV",{class:!0});var y=U(r);n=K(y,"DIV",{class:!0});var s=U(n);o=K(s,"BUTTON",{class:!0,"data-svelte-h":!0}),Ir(o)!=="svelte-xbbqa5"&&(o.innerHTML=a),i=te(s),l=K(s,"BUTTON",{class:!0,"data-svelte-h":!0}),Ir(l)!=="svelte-1vky3ua"&&(l.innerHTML=c),s.forEach(M),p=te(y),b=K(y,"DIV",{class:!0});var d=U(b);m=K(d,"DIV",{class:!0});var w=U(m);for(let u=0;u<$.length;u+=1)$[u].l(w);w.forEach(M),d.forEach(M),y.forEach(M),g.forEach(M),this.h()},h(){O(o,"class","p-4 hover:bg-green-300 transition duration-200 flex justify-center items-center border-r border-gray-300"),O(l,"class","p-4 hover:bg-red-300 transition duration-200 flex justify-center items-center"),O(n,"class","grid grid-cols-2 bg-gray-200"),O(m,"class","grid grid-auto-flow grid-auto-columns gap-2 svelte-n5a7pp"),O(b,"class","p-4 overflow-auto max-h-64"),O(r,"class","bg-white bg-opacity-90 rounded-lg shadow-lg w-11/12 sm:w-1/2 overflow-hidden border-2 border-gray-300"),O(e,"class","fixed bottom-0 left-0 right-0 flex justify-center mb-8 z-10")},m(_,g){G(_,e,g),F(e,r),F(r,n),F(n,o),F(n,i),F(n,l),F(r,p),F(r,b),F(b,m);for(let y=0;y<$.length;y+=1)$[y]&&$[y].m(m,null);S||(k=[be(o,"click",t[2]),be(l,"click",t[3])],S=!0)},p(_,g){if(g&18){P=Yn(_[1]);let y;for(y=0;y<P.length;y+=1){const s=Xn(_,P,y);$[y]?$[y].p(s,g):($[y]=Zn(s),$[y].c(),$[y].m(m,null))}for(;y<$.length;y+=1)$[y].d(1);$.length=P.length}},d(_){_&&M(e),ms($,_),S=!1,Ua(k)}}}function Zn(t){let e,r,n,o,a,i;function l(){return t[7](t[16])}return{c(){e=Y("button"),r=Y("div"),n=Y("i"),o=ee(),this.h()},l(c){e=K(c,"BUTTON",{class:!0});var p=U(e);r=K(p,"DIV",{class:!0});var b=U(r);n=K(b,"I",{class:!0}),U(n).forEach(M),b.forEach(M),o=te(p),p.forEach(M),this.h()},h(){O(n,"class",ys(`${t[16].class} text-4xl text-gray-700`)+" svelte-n5a7pp"),O(r,"class","bg-gray-200 hover:bg-gray-300 rounded-lg p-3 transition duration-200 transform hover:scale-125"),O(e,"class","marker-icon focus:outline-none svelte-n5a7pp")},m(c,p){G(c,e,p),F(e,r),F(r,n),F(e,o),a||(i=be(e,"click",l),a=!0)},p(c,p){t=c},d(c){c&&M(e),a=!1,i()}}}function $s(t){let e,r=t[0].showMarkerMenu&&Qn(t);return{c(){r&&r.c(),e=pe()},l(n){r&&r.l(n),e=pe()},m(n,o){r&&r.m(n,o),G(n,e,o)},p(n,[o]){n[0].showMarkerMenu?r?r.p(n,o):(r=Qn(n),r.c(),r.m(e.parentNode,e)):r&&(r.d(1),r=null)},i:H,o:H,d(n){n&&M(e),r&&r.d(n)}}}function As(t,e,r){let n,o,a;Q(t,ue,s=>r(9,n=s)),Q(t,Ue,s=>r(10,o=s)),Q(t,Ge,s=>r(0,a=s));const{getMap:i}=Na("map");let l;const c=[{id:"arrow-up-circle",class:"at-arrow-up-circle"},{id:"arrow-down-circle",class:"at-arrow-down-circle"},{id:"arrow-left-circle",class:"at-arrow-left-circle"},{id:"arrow-right-circle",class:"at-arrow-right-circle"},{id:"user",class:"at-user"},{id:"users",class:"at-users"},{id:"gear",class:"at-gear"},{id:"home",class:"at-home"},{id:"check-shield",class:"at-check-shield"},{id:"trash",class:"at-trash"},{id:"exit",class:"at-exit"},{id:"xmark-circle",class:"at-xmark-circle"},{id:"info-circle",class:"at-info-circle"},{id:"pin-destination",class:"at-pin-destination"},{id:"lock-keyhole",class:"at-lock-keyhole"},{id:"unlock-keyhole",class:"at-unlock-keyhole"},{id:"shopping-cart",class:"at-shopping-cart"},{id:"crosshairs",class:"at-crosshairs"},{id:"dollar-sign",class:"at-dollar-sign"},{id:"berries",class:"at-berries"},{id:"call",class:"at-call"},{id:"call-xmark",class:"at-call-xmark"},{id:"signal",class:"at-signal"},{id:"wifi",class:"at-wifi"},{id:"triangle-exclamation",class:"at-triangle-exclamation"},{id:"street-cone",class:"at-street-cone"},{id:"construction-truck",class:"at-construction-truck"},{id:"electric-battery-charge",class:"at-electric-battery-charge"},{id:"electric-car",class:"at-electric-car"},{id:"flower",class:"at-flower"},{id:"gasoline",class:"at-gasoline"},{id:"green-gas",class:"at-green-gas"},{id:"green-container",class:"at-green-container"},{id:"green-can",class:"at-green-can"},{id:"plant-house",class:"at-plant-house"},{id:"arrows-recycle",class:"at-arrows-recycle"},{id:"water-container",class:"at-water-container"},{id:"gewindmillar",class:"at-windmill"},{id:"kg-weight",class:"at-kg-weight"},{id:"carrot",class:"at-carrot"},{id:"hamburger",class:"at-hamburger"},{id:"middle-finger",class:"at-middle-finger"},{id:"toilet-bathroom",class:"at-toilet-bathroom"},{id:"taxi-service",class:"at-taxi-service"},{id:"block",class:"at-block"},{id:"wheelchair",class:"at-wheelchair"},{id:"car-garage",class:"at-car-garage"},{id:"electricity-home",class:"at-electricity-home"},{id:"house-home",class:"at-house-home"},{id:"houses",class:"at-houses"},{id:"carrot-turnip-vegetable",class:"at-carrot-turnip-vegetable"},{id:"cart",class:"at-cart"},{id:"wheat-harvest",class:"at-wheat-harvest"},{id:"helicopter-travel",class:"at-helicopter-travel"},{id:"airplane",class:"at-airplane"},{id:"farming-tractor",class:"at-farming-tractor"},{id:"camper-vehicle",class:"at-camper-vehicle"},{id:"car-vehicle",class:"at-car-vehicle"},{id:"cargo-transport",class:"at-cargo-transport"},{id:"bulldozer",class:"at-bulldozer"},{id:"construction-transport",class:"at-construction-transport"},{id:"crane-truck",class:"at-crane-truck"},{id:"delivery-truck",class:"at-delivery-truck"},{id:"liquid-transportation",class:"at-liquid-transportation"},{id:"transport-truck",class:"at-transport-truck"},{id:"ladder-truck",class:"at-ladder-truck"},{id:"celcius",class:"at-celcius"},{id:"clouds",class:"at-clouds"},{id:"crosswinds",class:"at-crosswinds"},{id:"rain-storm",class:"at-rain-storm"},{id:"rain-drops",class:"at-rain-drops"}];let{markerPlacementEvent:p=null}=e,{markerClickEvent:b=null}=e;Me(async()=>{await i(),document.querySelector(".map-container"),l=gt.subscribe(g)}),Ce(()=>{console.log("Destroying MarkerManager"),l&&l(),ue.set([]),ht.set([]),gt.set([])});function m(s,d,w){if(d==="default"){const u=new Se.Marker().setLngLat(s);u.getElement().setAttribute("data-marker-id",w);const f=new CustomEvent("handleUpdateMarkerListeners",{detail:{marker:u,id:w}});return document.dispatchEvent(f),u}else{const u=document.createElement("div");u.style.display="flex",u.style.justifyContent="center",u.style.alignItems="center",u.style.width="35px",u.style.height="35px",u.style.borderRadius="100%",u.style.backgroundColor="LightGray",u.style.opacity=.9,u.style.boxShadow="0 2px 4px rgba(0, 0, 0, 0.2)",u.setAttribute("data-marker-id",w);const f=document.createElement("i");f.className=d,f.style.fontSize="20px",f.style.color="black",f.style.fill="#ff6347",f.style.fontWeight="bold",u.appendChild(f);const v=new Se.Marker({element:u}).setLngLat(s),h=new CustomEvent("handleUpdateMarkerListeners",{detail:{marker:v,id:w}});return document.dispatchEvent(h),v}}async function S(s){const d=await i(),{lngLat:w}=s;if(w){if(o){const{marker:v}=o;v.remove()}const u=vs(),f=m(w,"default",u);f.setLngLat(w).addTo(d),Ue.set({marker:f,id:u}),d.flyTo({center:w,zoom:15,duration:1e3}),Ge.update(v=>({...v,showMarkerMenu:!0})),console.log("Marker ID Placed:",u,o)}else console.error("Invalid event format. Missing lngLat property.")}function k(){var s,d,w;if(o){const{marker:u,id:f}=o,v=new Date().toISOString(),h=n.find(E=>E.id===f);if(h){const E=(d=u.getElement().querySelector("i"))==null?void 0:d.className,A=(w=h.marker.getElement().querySelector("i"))==null?void 0:w.className;if(E===A){console.log("No changes made to the marker icon"),Ue.set(null),Ge.update(T=>({...T,showMarkerMenu:!1}));return}console.log("Updating marker icon"),ue.update(T=>{const I={marker:u,id:f,last_confirmed:v};return console.log("Updated marker data:",I),console.log("Updated marker icon:",E),T.map(L=>L.id===f?I:L)})}else{const E=((s=u.getElement().querySelector("i"))==null?void 0:s.className)||"default",A={marker:u,id:f,last_confirmed:v};console.log("New marker icon:",E),ue.update(T=>[...T,A])}Ue.set(null)}Ge.update(u=>({...u,showMarkerMenu:!1}))}function P(){if(o){const{marker:s,id:d}=o;s.remove(),Ue.set(null);const w=n.find(u=>u.id===d);w&&(ue.update(u=>{const f=u.filter(v=>v.id!==d);return ht.update(v=>[...v,{id:d,last_confirmed:w.last_confirmed}]),f}),console.log("Marker removed:",d))}Ge.update(s=>({...s,showMarkerMenu:!1}))}async function $(s){const d=await i(),{marker:w,id:u}=s;if(Ue.set({marker:w,id:u}),console.log(`Marker selected with ID: ${u}`,o),o){const f=w.getLngLat();d.flyTo({center:f,zoom:15,duration:1e3}),Ge.update(v=>({...v,showMarkerMenu:!0}))}}async function _(s){const d=await i();let w=s.id;if(o){const{marker:u,id:f}=o,v=u.getLngLat();u.remove();const h=c.find(E=>E.id===w);if(h){const E=m(v,h.class,f);E.addTo(d);const A={marker:E,id:f};Ue.set(A)}else console.log("recentMarker is null or undefined")}}async function g(s){const d=await i(),w=[];s.forEach((u,f)=>{const{markerData:v}=u,{id:h,marker_data:E,last_confirmed:A}=v;if(u.action==="add"){const{geometry:T,properties:I}=E,{coordinates:L}=T,{icon:D}=I,C=new Se.LngLat(L[0],L[1]),J=m(C,D,h);J.setLngLat(C).addTo(d),ue.update(x=>[...x,{marker:J,id:h,last_confirmed:A}]),w.push(f)}else if(u.action==="update"){const T=n.find(I=>I.id===h);if(T){const{marker:I}=T,{geometry:L,properties:D}=E,{coordinates:C}=L,{icon:J}=D,x=new Se.LngLat(C[0],C[1]);I.remove();const V=m(x,J,h);V.setLngLat(x).addTo(d),ue.update(Oe=>Oe.map(at=>at.id===h?{marker:V,id:h,last_confirmed:A}:at)),console.log("Marker updated:",v)}w.push(f)}else if(u.action==="delete"){const T=n.find(I=>I.id===h);if(T){const{marker:I}=T;I.remove(),ue.update(L=>L.filter(D=>D.id!==h)),console.log("Marker removed:",v)}w.push(f)}}),w.length>0&&gt.update(u=>u.filter((f,v)=>!w.includes(v)))}const y=s=>_(s);return t.$$set=s=>{"markerPlacementEvent"in s&&r(5,p=s.markerPlacementEvent),"markerClickEvent"in s&&r(6,b=s.markerClickEvent)},t.$$.update=()=>{t.$$.dirty&32&&p&&S(p),t.$$.dirty&64&&b&&$(b)},[a,c,k,P,_,p,b,y]}class Ps extends ge{constructor(e){super(),ve(this,e,As,$s,de,{markerPlacementEvent:5,markerClickEvent:6})}}const Br=ie([]),Fr=ie([]),Wa=ie([]),jr=ie([]),Nr=ie([]),Ur=ie({noTrails:!0,allTrails:!1,latestTrail:!1,userLatestTrail:!1});function Ts(t){let e,r;return{c(){e=Pe("svg"),r=Pe("path"),this.h()},l(n){e=Te(n,"svg",{xmlns:!0,class:!0,viewBox:!0,fill:!0});var o=U(e);r=Te(o,"path",{"fill-rule":!0,d:!0,"clip-rule":!0}),U(r).forEach(M),o.forEach(M),this.h()},h(){O(r,"fill-rule","evenodd"),O(r,"d","M14.243 5.757a6 6 0 10-.986 9.284 1 1 0 111.087 1.678A8 8 0 1118 10a3 3 0 01-4.8 2.401A4 4 0 1114 10a1 1 0 102 0c0-1.537-.586-3.07-1.757-4.243zM12 10a2 2 0 10-4 0 2 2 0 004 0z"),O(r,"clip-rule","evenodd"),O(e,"xmlns","http://www.w3.org/2000/svg"),O(e,"class","h-5 w-5"),O(e,"viewBox","0 0 20 20"),O(e,"fill","currentColor")},m(n,o){G(n,e,o),F(e,r)},d(n){n&&M(e)}}}function Ms(t){let e,r;return{c(){e=Pe("svg"),r=Pe("path"),this.h()},l(n){e=Te(n,"svg",{xmlns:!0,class:!0,viewBox:!0,fill:!0});var o=U(e);r=Te(o,"path",{"fill-rule":!0,d:!0,"clip-rule":!0}),U(r).forEach(M),o.forEach(M),this.h()},h(){O(r,"fill-rule","evenodd"),O(r,"d","M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z"),O(r,"clip-rule","evenodd"),O(e,"xmlns","http://www.w3.org/2000/svg"),O(e,"class","h-5 w-5"),O(e,"viewBox","0 0 20 20"),O(e,"fill","currentColor")},m(n,o){G(n,e,o),F(e,r)},d(n){n&&M(e)}}}function Os(t){let e,r,n,o;return{c(){e=Pe("svg"),r=Pe("title"),n=ut("trail"),o=Pe("path"),this.h()},l(a){e=Te(a,"svg",{fill:!0,width:!0,height:!0,viewBox:!0,version:!0,xmlns:!0});var i=U(e);r=Te(i,"title",{});var l=U(r);n=ft(l,"trail"),l.forEach(M),o=Te(i,"path",{d:!0}),U(o).forEach(M),i.forEach(M),this.h()},h(){O(o,"d","M30.165 30.887c-1.604 0.076-21.522-0.043-21.522-0.043-12.101-12.151 18.219-16.173-0.521-26.154l-1.311 1.383-1.746-4.582 5.635 0.439-1.128 1.267c23.438 6.83-3.151 19.631 20.594 27.69v0z"),O(e,"fill","#000000"),O(e,"width","30px"),O(e,"height","30px"),O(e,"viewBox","0 0 32 32"),O(e,"version","1.1"),O(e,"xmlns","http://www.w3.org/2000/svg")},m(a,i){G(a,e,i),F(e,r),F(r,n),F(e,o)},p:H,i:H,o:H,d(a){a&&M(e)}}}function Ls(t){let e,r,n=t[1]&&eo(t);return{c(){e=Y("div"),n&&n.c(),this.h()},l(o){e=K(o,"DIV",{class:!0});var a=U(e);n&&n.l(a),a.forEach(M),this.h()},h(){O(e,"class","flex flex-col -mt-7 pb-0")},m(o,a){G(o,e,a),n&&n.m(e,null),r=!0},p(o,a){o[1]?n?(n.p(o,a),a&2&&j(n,1)):(n=eo(o),n.c(),j(n,1),n.m(e,null)):n&&(_e(),N(n,1,1,()=>{n=null}),ke())},i(o){r||(j(n),r=!0)},o(o){N(n),r=!1},d(o){o&&M(e),n&&n.d()}}}function eo(t){let e,r,n;var o=t[1];function a(i,l){return{props:{src:"/animations/PulsingBlueBeacon.json",autoplay:!0,loop:!0,controls:!1,controlsLayout:null,renderer:"svg",background:"transparent",height:80,width:80}}}return o&&(e=Nt(o,a())),{c(){e&&ne(e.$$.fragment),r=pe()},l(i){e&&fe(e.$$.fragment,i),r=pe()},m(i,l){e&&oe(e,i,l),G(i,r,l),n=!0},p(i,l){if(l&2&&o!==(o=i[1])){if(e){_e();const c=e;N(c.$$.fragment,1,0,()=>{ae(c,1)}),ke()}o?(e=Nt(o,a()),ne(e.$$.fragment),j(e.$$.fragment,1),oe(e,r.parentNode,r)):e=null}},i(i){n||(e&&j(e.$$.fragment,i),n=!0)},o(i){e&&N(e.$$.fragment,i),n=!1},d(i){i&&M(r),e&&ae(e,i)}}}function Is(t){let e,r,n='<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>',o,a,i,l,c=t[9][t[2]]+"",p,b,m,S=t[10][t[3]].color+"",k,P,$=t[10][t[3]].size+"",_,g,y,s,d,w,u,f=t[13][t[4]]+"",v,h,E,A;function T(x,V){return x[0]?Ms:Ts}let I=T(t),L=I(t);const D=[Ls,Os],C=[];function J(x,V){return x[5]?0:1}return s=J(t),d=C[s]=D[s](t),{c(){e=Y("div"),r=Y("button"),r.innerHTML=n,o=ee(),a=Y("button"),L.c(),i=ee(),l=Y("button"),p=ut(c),b=ee(),m=Y("button"),k=ut(S),P=ee(),_=ut($),g=ee(),y=Y("button"),d.c(),w=ee(),u=Y("button"),v=ut(f),this.h()},l(x){e=K(x,"DIV",{});var V=U(e);r=K(V,"BUTTON",{class:!0,"data-svelte-h":!0}),Ir(r)!=="svelte-1cawvwb"&&(r.innerHTML=n),o=te(V),a=K(V,"BUTTON",{class:!0});var Oe=U(a);L.l(Oe),Oe.forEach(M),i=te(V),l=K(V,"BUTTON",{class:!0});var at=U(l);p=ft(at,c),at.forEach(M),b=te(V),m=K(V,"BUTTON",{class:!0});var Et=U(m);k=ft(Et,S),P=te(Et),_=ft(Et,$),Et.forEach(M),g=te(V),y=K(V,"BUTTON",{class:!0});var Vn=U(y);d.l(Vn),Vn.forEach(M),w=te(V),u=K(V,"BUTTON",{class:!0});var Gn=U(u);v=ft(Gn,f),Gn.forEach(M),V.forEach(M),this.h()},h(){O(r,"class","btn btn-circle btn-lg bg-white bg-opacity-50 hover:bg-opacity-100 absolute top-4 left-4 z-10"),O(a,"class","btn btn-circle btn-md absolute top-4 right-4 z-10"),O(l,"class","btn btn-circle btn-md absolute top-20 right-4 z-10"),O(m,"class","btn btn-circle btn-md absolute top-20 right-20 z-10"),O(y,"class","btn btn-circle btn-md absolute top-36 right-4 z-10"),O(u,"class","btn btn-circle btn-md absolute top-52 right-4 z-10 text-xs")},m(x,V){G(x,e,V),F(e,r),F(e,o),F(e,a),L.m(a,null),F(e,i),F(e,l),F(l,p),F(e,b),F(e,m),F(m,k),F(m,P),F(m,_),F(e,g),F(e,y),C[s].m(y,null),F(e,w),F(e,u),F(u,v),h=!0,E||(A=[be(r,"click",t[8]),be(a,"click",t[7]),be(l,"click",t[11]),be(m,"click",t[12]),be(y,"click",t[6]),be(u,"click",t[14])],E=!0)},p(x,[V]){I!==(I=T(x))&&(L.d(1),L=I(x),L&&(L.c(),L.m(a,null))),(!h||V&4)&&c!==(c=x[9][x[2]]+"")&&At(p,c),(!h||V&8)&&S!==(S=x[10][x[3]].color+"")&&At(k,S),(!h||V&8)&&$!==($=x[10][x[3]].size+"")&&At(_,$);let Oe=s;s=J(x),s===Oe?C[s].p(x,V):(_e(),N(C[Oe],1,1,()=>{C[Oe]=null}),ke(),d=C[s],d?d.p(x,V):(d=C[s]=D[s](x),d.c()),j(d,1),d.m(y,null)),(!h||V&16)&&f!==(f=x[13][x[4]]+"")&&At(v,f)},i(x){h||(j(d),h=!0)},o(x){N(d),h=!1},d(x){x&&M(e),L.d(),C[s].d(),E=!1,Ua(A)}}}const Ds="mapbox://styles/mapbox/satellite-streets-v12",Cs="mapbox://styles/mapbox/outdoors-v12";function xs(t,e,r){let n;Q(t,Dr,s=>r(5,n=s));let o;Me(async()=>{{const s=await Ye(()=>import("../chunks/index.9bcd1db9.js"),["..\\chunks\\index.9bcd1db9.js","..\\chunks\\scheduler.ccf898a6.js","..\\chunks\\index.7272c3b3.js","..\\chunks\\lottie.c94986b4.js","..\\chunks\\_commonjsHelpers.de833af9.js","..\\chunks\\each.34974530.js","..\\assets\\index.798bbb7e.css"],import.meta.url);r(1,o=s.LottiePlayer)}});let{isSatelliteView:a=!0}=e;const i=Ra();function l(){Dr.update(s=>{const d=!s;return console.log("Toggling isTrailing:",d),d})}function c(){r(0,a=!a),xr.update(s=>(s.setStyle(a?Ds:Cs),s)),i("toggleMapStyleDispatcher",a)}function p(){i("backToDashboard")}const b=["tractor","combine","loader","pointer","Harvester"];let m=0;const S=[{color:"red",size:"25px"},{color:"blue",size:"35px"},{color:"green",size:"45px"},{color:"yellow",size:"60px"}];let k=0;function P(){r(2,m=(m+1)%b.length),De.update(s=>({...s,vehicle_marker:{...s.vehicle_marker,type:b[m]}}))}function $(){r(3,k=(k+1)%S.length),De.update(s=>({...s,vehicle_marker:{...s.vehicle_marker,color:S[k].color,size:S[k].size}}))}const _=["noTrails","allTrails","latestTrail","userLatestTrail"];let g=0;function y(){r(4,g=(g+1)%_.length);const s=_[g];Ur.update(d=>(d.noTrails=!1,d.allTrails=!1,d.latestTrail=!1,d.userLatestTrail=!1,d[s]=!0,d))}return t.$$set=s=>{"isSatelliteView"in s&&r(0,a=s.isSatelliteView)},[a,o,m,k,g,n,l,c,p,b,S,P,$,_,y]}class Va extends ge{constructor(e){super(),ve(this,e,xs,Is,de,{isSatelliteView:0})}}const Bs=500,Fs=5;function to(t){const e=t.target;e.style.cursor="pointer"}function ro(t){const e=t.target;e.style.cursor=""}function js(t,e,r){let{map:n}=e;const o=Ra();let a=null,i=null,l=[],c;Me(()=>{document.addEventListener("handleUpdateMarkerListeners",b),n.on("mousedown",k),n.on("touchstart",k),n.on("drag",P),n.on("mouseup",$)}),Ce(()=>{console.log("Destroying MapControls"),console.log("MapControls, unsubscribing from confirmedMarkersStore",c),console.log("Out"),document.removeEventListener("handleUpdateMarkerListeners",b),n.off("mousedown",k),n.off("touchstart",k),n.off("drag",P),n.off("mouseup",$)});function p(_,g){const y=_.getElement();y.removeEventListener("mouseenter",to),y.removeEventListener("mouseleave",ro),y.removeEventListener("click",m),y.removeAttribute("data-listeners-added"),y.addEventListener("mouseenter",to),y.addEventListener("mouseleave",ro),y.addEventListener("click",m),y.setAttribute("data-listeners-added","true");const s=l.findIndex(d=>d.id===g);s!==-1?l=l.map((d,w)=>w===s?{marker:_,id:g}:d):l=[...l,{marker:_,id:g}]}function b(_){const{marker:g,id:y}=_.detail;p(g,y)}function m(_){_.stopPropagation();const g=_.target.closest(".mapboxgl-marker");if(g){const y=l.find(s=>s.marker.getElement()===g);if(y){const{marker:s,id:d}=y;o("markerClick",{marker:s,id:d})}else console.log("No matching marker found in confirmedMarkers array")}else console.log("No marker element found")}function S(_){const g=_.lngLat||_.target.getLngLat();g?o("markerPlacement",{lngLat:g}):console.error("Invalid event format. Missing lngLat property.")}function k(_){clearTimeout(a),i={x:_.originalEvent.clientX||_.originalEvent.touches[0].clientX,y:_.originalEvent.clientY||_.originalEvent.touches[0].clientY},a=setTimeout(()=>{S(_),a=null},Bs)}function P(_){if(i){const g=_.originalEvent.touches?_.originalEvent.touches[0]:_.originalEvent,y=g.clientX-i.x,s=g.clientY-i.y;Math.sqrt(y*y+s*s)>Fs&&(clearTimeout(a),a=null,i=null)}}function $(_){clearTimeout(a),a=null,i=null}return t.$$set=_=>{"map"in _&&r(0,n=_.map)},[n]}class Ns extends ge{constructor(e){super(),ve(this,e,js,null,de,{map:0})}}var Us=typeof global=="object"&&global&&global.Object===Object&&global;const Rs=Us;var qs=typeof self=="object"&&self&&self.Object===Object&&self,zs=Rs||qs||Function("return this")();const Ga=zs;var Ws=Ga.Symbol;const Ut=Ws;var Ha=Object.prototype,Vs=Ha.hasOwnProperty,Gs=Ha.toString,it=Ut?Ut.toStringTag:void 0;function Hs(t){var e=Vs.call(t,it),r=t[it];try{t[it]=void 0;var n=!0}catch{}var o=Gs.call(t);return n&&(e?t[it]=r:delete t[it]),o}var Js=Object.prototype,Ys=Js.toString;function Ks(t){return Ys.call(t)}var Xs="[object Null]",Qs="[object Undefined]",no=Ut?Ut.toStringTag:void 0;function Zs(t){return t==null?t===void 0?Qs:Xs:no&&no in Object(t)?Hs(t):Ks(t)}function el(t){return t!=null&&typeof t=="object"}var tl="[object Symbol]";function rl(t){return typeof t=="symbol"||el(t)&&Zs(t)==tl}var nl=/\s/;function ol(t){for(var e=t.length;e--&&nl.test(t.charAt(e)););return e}var al=/^\s+/;function il(t){return t&&t.slice(0,ol(t)+1).replace(al,"")}function Rr(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var oo=0/0,sl=/^[-+]0x[0-9a-f]+$/i,ll=/^0b[01]+$/i,cl=/^0o[0-7]+$/i,ul=parseInt;function ao(t){if(typeof t=="number")return t;if(rl(t))return oo;if(Rr(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=Rr(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=il(t);var r=ll.test(t);return r||cl.test(t)?ul(t.slice(2),r?2:8):sl.test(t)?oo:+t}var fl=function(){return Ga.Date.now()};const fr=fl;var pl="Expected a function",dl=Math.max,ml=Math.min;function yl(t,e,r){var n,o,a,i,l,c,p=0,b=!1,m=!1,S=!0;if(typeof t!="function")throw new TypeError(pl);e=ao(e)||0,Rr(r)&&(b=!!r.leading,m="maxWait"in r,a=m?dl(ao(r.maxWait)||0,e):a,S="trailing"in r?!!r.trailing:S);function k(u){var f=n,v=o;return n=o=void 0,p=u,i=t.apply(v,f),i}function P(u){return p=u,l=setTimeout(g,e),b?k(u):i}function $(u){var f=u-c,v=u-p,h=e-f;return m?ml(h,a-v):h}function _(u){var f=u-c,v=u-p;return c===void 0||f>=e||f<0||m&&v>=a}function g(){var u=fr();if(_(u))return y(u);l=setTimeout(g,$(u))}function y(u){return l=void 0,S&&n?k(u):(n=o=void 0,i)}function s(){l!==void 0&&clearTimeout(l),p=0,n=c=o=l=void 0}function d(){return l===void 0?i:y(fr())}function w(){var u=fr(),f=_(u);if(n=arguments,o=this,c=u,f){if(l===void 0)return P(c);if(m)return clearTimeout(l),l=setTimeout(g,e),k(c)}return l===void 0&&(l=setTimeout(g,e)),i}return w.cancel=s,w.flush=d,w}function hl(t){let e,r,n,o,a,i;return{c(){e=Y("button"),r=Pe("svg"),n=Pe("path"),this.h()},l(l){e=K(l,"BUTTON",{class:!0});var c=U(e);r=Te(c,"svg",{class:!0,xmlns:!0,fill:!0,viewBox:!0,stroke:!0});var p=U(r);n=Te(p,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),U(n).forEach(M),p.forEach(M),c.forEach(M),this.h()},h(){O(n,"stroke-linecap","round"),O(n,"stroke-linejoin","round"),O(n,"stroke-width","2"),O(n,"d","M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"),O(r,"class",o="w-6 h-6 "+(t[0]?"animate-spin":"")),O(r,"xmlns","http://www.w3.org/2000/svg"),O(r,"fill","none"),O(r,"viewBox","0 0 24 24"),O(r,"stroke","currentColor"),O(e,"class","btn btn-circle btn-md absolute top-36 right-20 z-10")},m(l,c){G(l,e,c),F(e,r),F(r,n),a||(i=be(e,"click",t[2]),a=!0)},p(l,[c]){c&1&&o!==(o="w-6 h-6 "+(l[0]?"animate-spin":""))&&O(r,"class",o)},i:H,o:H,d(l){l&&M(e),a=!1,i()}}}function gl(t,e,r){let n,o,a;Q(t,ht,_=>r(6,n=_)),Q(t,ue,_=>r(7,o=_)),Q(t,nr,_=>r(8,a=_));let i=!1,l,c,p=!1,b;Me(()=>{r(1,c=yl(m,500));const _=a.data.session;b=X.channel("map_markers_changes").on("postgres_changes",{event:"*",schema:"public",table:"map_markers"},g=>{g.new.update_user_id!==_.user.id?p||c("Server Sync"):console.log("Skipping synchronization, update made by current user")}).subscribe(),m("Loaded from server"),l=ue.subscribe(g=>{p||c("Local Sync")})}),Ce(()=>{console.log("Destroying MapStateSaver"),c.cancel(),l&&l(),b&&X.removeChannel(b),console.log("Removing all markers from the map"),ue.update(_=>(_.forEach(({marker:g})=>{g.remove()}),[])),ue.set([]),ht.set([]),gt.set([])});async function m(_){if(console.log("Synchronizing markers..."),p){console.log("Synchronization already in progress. Skipping.");return}p=!0,r(0,i=!0);const g=a.data.session;if(!g){console.error("User not authenticated"),ur.push("User not authenticated",{theme:{"--toastBackground":"hsl(var(--er))","--toastColor":"hsl(var(--erc))","--toastBarBackground":"hsl(var(--er))"}});return}try{const y=await P(g),s=o;let{localMarkersToBeAdded:d,localMarkersToBeUpdated:w,localMarkersToBeDeleted:u,serverMarkersToBeAdded:f,serverMarkersToBeUpdated:v,serverMarkersToBeDeleted:h}=S(s,y);const E=[...d.map(A=>({action:"add",markerData:A})),...w.map(A=>({action:"update",markerData:A})),...u.map(A=>({action:"delete",markerData:A}))];gt.set(E),await k(g,{serverMarkersToBeAdded:f,serverMarkersToBeUpdated:v,serverMarkersToBeDeleted:h}),ur.push(_)}catch(y){console.error("Error synchronizing markers:",y);let s="Error synchronizing markers";y.message==="Failed to retrieve user profile"?s="Please create a map or connect to a map for online synchronization.":y.message==="No master map assigned. Please create or connect to a map."?s="No master map assigned. Please create or connect to a map.":y.message==="Failed to retrieve latest markers from server"&&(s="Failed to retrieve latest markers from the server. Please try again later."),ur.push(s,{theme:{"--toastBackground":"hsl(var(--er))","--toastColor":"hsl(var(--erc))","--toastBarBackground":"hsl(var(--er))"}})}p=!1,r(0,i=!1)}function S(_,g){let y=[],s=[],d=[],w=[],u=[],f=[];for(const v of _){const h=g.find(E=>E.id===v.id);h?h.deleted?new Date(v.last_confirmed)>new Date(h.deleted_at)?u.push(v):d.push(v):new Date(h.last_confirmed)>new Date(v.last_confirmed)?s.push(h):new Date(v.last_confirmed)>new Date(h.last_confirmed)&&u.push(v):n.find(A=>A.id===v.id)||w.push(v)}for(const v of g){const h=_.find(A=>A.id===v.id),E=n.find(A=>A.id===v.id);!h&&!v.deleted&&!E&&y.push(v)}for(const v of n){const h=g.find(E=>E.id===v.id);h&&new Date(v.last_confirmed)>=new Date(h.last_confirmed)&&f.push(h)}return{localMarkersToBeAdded:y,localMarkersToBeUpdated:s,localMarkersToBeDeleted:d,serverMarkersToBeAdded:w,serverMarkersToBeUpdated:u,serverMarkersToBeDeleted:f}}async function k(_,{serverMarkersToBeAdded:g,serverMarkersToBeUpdated:y,serverMarkersToBeDeleted:s}){const d=_.user.id,{data:w,error:u}=await X.from("profiles").select("master_map_id").eq("id",d).single();if(u)throw console.error("Error retrieving user profile:",u),new Error("Failed to retrieve user profile");const f=w.master_map_id;if(g.length>0){const v=g.map(E=>{var J;const{marker:A,id:T,last_confirmed:I}=E,L=A.getLngLat().toArray(),D=((J=A.getElement().querySelector("i"))==null?void 0:J.className)||"default";return{master_map_id:f,id:T,marker_data:{type:"Feature",geometry:{type:"Point",coordinates:L},properties:{icon:D,id:T}},last_confirmed:I,update_user_id:d}}),{error:h}=await X.from("map_markers").insert(v);if(h)throw console.error("Error adding markers to server:",h),new Error("Failed to add markers to server")}if(y.length>0){const v=y.map(E=>{var J;const{marker:A,id:T,last_confirmed:I}=E,L=A.getLngLat().toArray(),D=((J=A.getElement().querySelector("i"))==null?void 0:J.className)||"default";return{id:T,marker_data:{type:"Feature",geometry:{type:"Point",coordinates:L},properties:{icon:D,id:T}},last_confirmed:I,update_user_id:d}}),{error:h}=await X.from("map_markers").upsert(v,{onConflict:"id"});if(h)throw console.error("Error updating markers on server:",h),new Error("Failed to update markers on server")}if(s.length>0){const v=s.map(E=>({id:E.id,deleted:!0,deleted_at:new Date().toISOString()})),{error:h}=await X.from("map_markers").upsert(v,{onConflict:"id"});if(h)throw console.error("Error deleting markers on server:",h),new Error("Failed to delete markers on server");ht.update(E=>E.filter(A=>!s.some(T=>T.id===A.id)))}}async function P(_){const g=_.user.id,{data:y,error:s}=await X.from("profiles").select("master_map_id").eq("id",g).single();if(s)throw console.error("Error retrieving user profile:",s),new Error("Failed to retrieve user profile");const d=y.master_map_id;if(!d)throw new Error("No master map assigned. Please create or connect to a map.");const{data:w,error:u}=await X.from("map_markers").select("id, marker_data, last_confirmed, deleted").eq("master_map_id",d).is("deleted",null);if(u)throw console.error("Error retrieving latest markers from server:",u),new Error("Failed to retrieve latest markers from server");return w}return[i,c,()=>c("Sync Button")]}class vl extends ge{constructor(e){super(),ve(this,e,gl,hl,de,{})}}function bl(t){let e;return{c(){e=Y("div"),this.h()},l(r){e=K(r,"DIV",{class:!0,style:!0}),U(e).forEach(M),this.h()},h(){O(e,"class","vehicle-icon"),R(e,"background-image","url('"+t[5].path+"')"),R(e,"background-size","contain"),R(e,"background-repeat","no-repeat"),R(e,"background-position","center"),R(e,"width",t[2]),R(e,"height",t[2]),R(e,"position","relative"),R(e,"z-index","1"),R(e,"transform-origin","center"),R(e,"transition","transform 0.2s ease-in-out")},m(r,n){G(r,e,n)},p(r,n){n&32&&R(e,"background-image","url('"+r[5].path+"')"),n&4&&R(e,"width",r[2]),n&4&&R(e,"height",r[2])},i:H,o:H,d(r){r&&M(e)}}}function wl(t){let e,r,n,o={ctx:t,current:null,token:null,hasCatch:!1,pending:kl,then:_l,catch:Sl,value:8,blocks:[,,,]};return Kn(r=t[5].path(),o),{c(){e=pe(),o.block.c()},l(a){e=pe(),o.block.l(a)},m(a,i){G(a,e,i),o.block.m(a,o.anchor=i),o.mount=()=>e.parentNode,o.anchor=e,n=!0},p(a,i){t=a,o.ctx=t,i&32&&r!==(r=t[5].path())&&Kn(r,o)||Ss(o,t,i)},i(a){n||(j(o.block),n=!0)},o(a){for(let i=0;i<3;i+=1){const l=o.blocks[i];N(l)}n=!1},d(a){a&&M(e),o.block.d(a),o.token=null,o=null}}}function Sl(t){return{c:H,l:H,m:H,p:H,i:H,o:H,d:H}}function _l(t){let e,r,n;var o=t[8].default;function a(i,l){return{props:{color:i[3],size:i[2]}}}return o&&(e=Nt(o,a(t))),{c(){e&&ne(e.$$.fragment),r=pe()},l(i){e&&fe(e.$$.fragment,i),r=pe()},m(i,l){e&&oe(e,i,l),G(i,r,l),n=!0},p(i,l){if(l&32&&o!==(o=i[8].default)){if(e){_e();const c=e;N(c.$$.fragment,1,0,()=>{ae(c,1)}),ke()}o?(e=Nt(o,a(i)),ne(e.$$.fragment),j(e.$$.fragment,1),oe(e,r.parentNode,r)):e=null}else if(o){const c={};l&8&&(c.color=i[3]),l&4&&(c.size=i[2]),e.$set(c)}},i(i){n||(e&&j(e.$$.fragment,i),n=!0)},o(i){e&&N(e.$$.fragment,i),n=!1},d(i){i&&M(r),e&&ae(e,i)}}}function kl(t){return{c:H,l:H,m:H,p:H,i:H,o:H,d:H}}function io(t){let e;return{c(){e=Y("div"),this.h()},l(r){e=K(r,"DIV",{class:!0,style:!0}),U(e).forEach(M),this.h()},h(){O(e,"class","pulse-circle animate-pulse"),R(e,"width",t[1]),R(e,"height",t[1]),R(e,"border-radius","50%"),R(e,"background-color",t[0]),R(e,"box-shadow","0 0 0 10px "+t[0]),R(e,"position","absolute"),R(e,"top","50%"),R(e,"left","50%"),R(e,"transform","translate(-50%, -50%)"),R(e,"z-index","0")},m(r,n){G(r,e,n)},p(r,n){n&2&&R(e,"width",r[1]),n&2&&R(e,"height",r[1]),n&1&&R(e,"background-color",r[0]),n&1&&R(e,"box-shadow","0 0 0 10px "+r[0])},d(r){r&&M(e)}}}function El(t){let e,r,n,o,a;const i=[wl,bl],l=[];function c(b,m){return b[5].type==="svg"?0:1}r=c(t),n=l[r]=i[r](t);let p=t[4]&&io(t);return{c(){e=Y("div"),n.c(),o=ee(),p&&p.c(),this.h()},l(b){e=K(b,"DIV",{class:!0,style:!0});var m=U(e);n.l(m),o=te(m),p&&p.l(m),m.forEach(M),this.h()},h(){O(e,"class","user-marker"),R(e,"position","relative"),R(e,"display","inline-block")},m(b,m){G(b,e,m),l[r].m(e,null),F(e,o),p&&p.m(e,null),a=!0},p(b,[m]){let S=r;r=c(b),r===S?l[r].p(b,m):(_e(),N(l[S],1,1,()=>{l[S]=null}),ke(),n=l[r],n?n.p(b,m):(n=l[r]=i[r](b),n.c()),j(n,1),n.m(e,o)),b[4]?p?p.p(b,m):(p=io(b),p.c(),p.m(e,null)):p&&(p.d(1),p=null)},i(b){a||(j(n),a=!0)},o(b){N(n),a=!1},d(b){b&&M(e),l[r].d(),p&&p.d()}}}function $l(t,e,r){let n,{pulseColor:o="rgba(172, 172, 230, 0.8)"}=e,{pulseSize:a="40px"}=e,{vehicleSize:i="60px"}=e,{userVehicle:l="harvester"}=e,{vehicleColor:c="red"}=e,{showPulse:p=!0}=e;const b={harvester:{path:"/images/HarvestorUp.png",type:"image"},chaserbin:{path:"/images/ChaserBinUp.png",type:"image"},tractor:{path:()=>Ye(()=>import("../chunks/SimpleTractor.1d251584.js"),["..\\chunks\\SimpleTractor.1d251584.js","..\\chunks\\scheduler.ccf898a6.js","..\\chunks\\index.7272c3b3.js"],import.meta.url),type:"svg"},combine:{path:()=>Ye(()=>import("../chunks/CombineHeader.5d0fc37b.js"),["..\\chunks\\CombineHeader.5d0fc37b.js","..\\chunks\\scheduler.ccf898a6.js","..\\chunks\\index.7272c3b3.js"],import.meta.url),type:"svg"},loader:{path:()=>Ye(()=>import("../chunks/TractorLoader.2ab3baff.js"),["..\\chunks\\TractorLoader.2ab3baff.js","..\\chunks\\scheduler.ccf898a6.js","..\\chunks\\index.7272c3b3.js"],import.meta.url),type:"svg"},phone:{path:()=>Ye(()=>import("../chunks/PhoneBlock.880bbec1.js"),["..\\chunks\\PhoneBlock.880bbec1.js","..\\chunks\\scheduler.ccf898a6.js","..\\chunks\\index.7272c3b3.js"],import.meta.url),type:"svg"},pointer:{path:()=>Ye(()=>import("../chunks/Pointer.f4492f00.js"),["..\\chunks\\Pointer.f4492f00.js","..\\chunks\\scheduler.ccf898a6.js","..\\chunks\\index.7272c3b3.js"],import.meta.url),type:"svg"}};return t.$$set=m=>{"pulseColor"in m&&r(0,o=m.pulseColor),"pulseSize"in m&&r(1,a=m.pulseSize),"vehicleSize"in m&&r(2,i=m.vehicleSize),"userVehicle"in m&&r(6,l=m.userVehicle),"vehicleColor"in m&&r(3,c=m.vehicleColor),"showPulse"in m&&r(4,p=m.showPulse)},t.$$.update=()=>{t.$$.dirty&64&&r(5,n=b[l]||b.harvester)},[o,a,i,c,p,n,l]}class Al extends ge{constructor(e){super(),ve(this,e,$l,El,de,{pulseColor:0,pulseSize:1,vehicleSize:2,userVehicle:6,vehicleColor:3,showPulse:4})}}const Pl=1e3;let Tl=!1;function so(t,e,r,n){const o=t.getLngLat(),a=t.getRotation(),i=e-o.lng,l=r-o.lat;let c=n-a;c>180?c-=360:c<-180&&(c+=360);const p=1e3,b=performance.now();function m(S){const k=S-b,P=Math.min(k/p,1),$=P<.5?2*P*P:-1+(4-2*P)*P,_=o.lng+i*$,g=o.lat+l*$,y=a+c*$;t.setLngLat([_,g]).setRotation(y),k<p&&requestAnimationFrame(m)}requestAnimationFrame(m)}function Ml(t,e,r){let n,o,a;Q(t,Dr,w=>r(12,n=w)),Q(t,De,w=>r(13,o=w)),Q(t,nr,w=>r(14,a=w));let{map:i}=e,l,c,p=0,b=[],m,S,k=null,P=null,$=null;Me(()=>{console.log("Mounting VehicleTracker");const w=a.data.session;w&&w.user.id,l=new Se.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0,showUserHeading:!0,showAccuracyCircle:!0,showUserLocation:!1}),i.addControl(l,"bottom-right"),i.on("load",()=>{l.trigger()}),l.on("geolocate",u=>{const{coords:f}=u;s(f)}),m=De.subscribe(u=>{u.coordinates,g(u.vehicle_marker)}),S=Cr.subscribe(_)}),Ce(()=>{console.log("Unmounting VehicleTracker"),c&&c.remove(),m&&m(),S&&S()});function _(w){w.forEach(u=>{const{coordinates:f,heading:v,vehicle_marker:h,vehicle_id:E,update_types:A}=u,[T,I]=f.slice(1,-1).split(",").map(parseFloat),L=b.findIndex(D=>D.getElement().getAttribute("data-vehicle-id")===E);if(L!==-1){const D=b[L];if(A.includes("vehicle_marker_changed")){D.remove();const C=new Se.Marker({element:y(h,!1,E),pitchAlignment:"map",rotationAlignment:"map"});C.setLngLat([T,I]).setRotation(v).addTo(i),b[L]=C}(A.includes("position_changed")||A.includes("heading_changed"))&&so(D,T,I,v)}else if(A.includes("new_vehicle")){const D=new Se.Marker({element:y(h,!1,E),pitchAlignment:"map",rotationAlignment:"map"});D.setLngLat([T,I]).setRotation(v).addTo(i),b.push(D)}dn.update(D=>{const C=D.findIndex(J=>J.vehicle_id===E);return C!==-1?D[C]=u:D.push(u),D})})}function g(w){if(c&&$&&w.type===$.type&&w.color===$.color&&w.size===$.size){console.log("Vehicle marker hasn't changed");return}if(c&&c.remove(),c=new Se.Marker({element:y(w,!0),pitchAlignment:"map",rotationAlignment:"map"}),o.coordinates){const{latitude:u,longitude:f}=o.coordinates;c.setLngLat([f,u]).addTo(i),$={...w}}}function y(w,u=!1,f=null){const v=document.createElement("div");return v.setAttribute("data-vehicle-id",f),new Al({target:v,props:{pulseColor:"rgba(172, 172, 230, 0.8)",pulseSize:"40px",vehicleSize:w.size,userVehicle:w.type,vehicleColor:w.color,showPulse:u}}),v}function s(w){const{latitude:u,longitude:f,heading:v}=w,h=Date.now(),E={coordinates:{latitude:u,longitude:f},last_update:h,is_trailing:Tl,vehicle_marker:o.vehicle_marker},A=v!==null?Math.round(v):v;d(h,E,A)}function d(w,u,f){if(w-p>=Pl){const{coordinates:v}=u,{latitude:h,longitude:E}=v;if(n){const A={coordinates:{latitude:h,longitude:E},timestamp:w};Nr.update(T=>[...T,A])}if(!k||k.latitude!==h||k.longitude!==E||P!==f){let A="";if(!k)A+="Initial coordinates. ";else{if(k.latitude!==h){const T=h-k.latitude;A+=`Latitude changed by ${T.toFixed(6)}. `}if(k.longitude!==E){const T=E-k.longitude;A+=`Longitude changed by ${T.toFixed(6)}. `}}if(P!==f){const T=f-P;A+=`Heading changed by ${T.toFixed(2)}°.`}console.log("Changes detected:",A),De.update(T=>({...T,coordinates:u.coordinates,last_update:u.last_update,is_trailing:u.is_trailing,vehicle_marker:u.vehicle_marker,heading:f})),c&&c.getLngLat()&&so(c,E,h,f),k={latitude:h,longitude:E},P=f}p=w}}return t.$$set=w=>{"map"in w&&r(0,i=w.map)},[i]}class Ol extends ge{constructor(e){super(),ve(this,e,Ml,null,de,{map:0})}}function lo(t,e){return t.map(o=>{const a=e.find(l=>l.vehicle_id===o.vehicle_id),i={vehicle_id:o.vehicle_id,coordinates:o.coordinates,heading:o.heading,vehicle_marker:o.vehicle_marker,update_types:[]};if(!a)i.update_types.push("new_vehicle");else{const l=JSON.stringify(o.vehicle_marker)!==JSON.stringify(a.vehicle_marker),c=o.coordinates!==a.coordinates,p=o.heading!==a.heading;l&&(console.log(),i.update_types.push("vehicle_marker_changed")),c&&i.update_types.push("position_changed"),p&&i.update_types.push("heading_changed")}return i}).filter(o=>o.update_types.length>0)}function Ll(t,e,r){let n,o,a;Q(t,nr,m=>r(2,n=m)),Q(t,dn,m=>r(3,o=m)),Q(t,cr,m=>r(4,a=m));let i=null,l;Me(async()=>{console.log("Initializing VehicleStateSynchronizer");const m=n.data.session;if(m){const S=m.user.id;console.log("Session:",m),console.log("User ID:",S);const{data:k,error:P}=await X.from("profiles").select("master_map_id").eq("id",S).single();if(P){console.error("Error retrieving user profile:",P);return}const $=k.master_map_id,_=await c(S);if(_){const[s,d]=_.coordinates.slice(1,-1).split(",").map(parseFloat);De.update(w=>({...w,..._,coordinates:{latitude:d,longitude:s}}))}const g=await p($,S);cr.set(g);const y=lo(a,o);Cr.set(y),i=X.channel("vehicle_state_changes").on("postgres_changes",{event:"*",schema:"public",table:"vehicle_state",filter:`master_map_id=eq.${$}`},s=>{if(s.new.vehicle_id!==S){cr.update(w=>{const u=w.findIndex(f=>f.vehicle_id===s.new.vehicle_id);return u!==-1?w[u]=s.new:(console.log("pushing new vehicle",s.new),w.push(s.new)),w});const d=lo(a,o);Cr.set(d)}}).subscribe(),l=De.subscribe(async s=>{await b(s)})}za.set(!0)}),Ce(()=>{i&&X.removeChannel(i),l&&l()});async function c(m){const{data:S,error:k}=await X.from("vehicle_state").select("*").eq("vehicle_id",m).single();return k?(console.error("Error retrieving user vehicle data:",k),null):S}async function p(m,S){const{data:k,error:P}=await X.from("vehicle_state").select("*").eq("master_map_id",m);return P?(console.error("Error retrieving initial vehicle data:",P),[]):k.filter($=>$.vehicle_id!==S)}async function b(m){const S=n.data.session;if(!S){console.error("User not authenticated");return}const k=S.user.id,{data:P,error:$}=await X.from("profiles").select("master_map_id").eq("id",k).single();if($){console.error("Error retrieving user profile:",$);return}const _=P.master_map_id,{coordinates:g,last_update:y,heading:s,is_trailing:d,vehicle_marker:w}=m;if(!g){console.warn("Coordinates not available. Skipping vehicle state update.");return}const u={vehicle_id:k,master_map_id:_,coordinates:`(${g.longitude},${g.latitude})`,last_update:new Date(y).toISOString(),is_trailing:d,vehicle_marker:w};s!==null&&(u.heading=s);const{data:f,error:v}=await X.from("vehicle_state").upsert(u).single();v&&console.error("Error sending vehicle state to the database:",v)}return[]}class Il extends ge{constructor(e){super(),ve(this,e,Ll,null,de,{})}}var co=Object.prototype.toString,Ja=function(e){var r=co.call(e),n=r==="[object Arguments]";return n||(n=r!=="[object Array]"&&e!==null&&typeof e=="object"&&typeof e.length=="number"&&e.length>=0&&co.call(e.callee)==="[object Function]"),n},pr,uo;function Dl(){if(uo)return pr;uo=1;var t;if(!Object.keys){var e=Object.prototype.hasOwnProperty,r=Object.prototype.toString,n=Ja,o=Object.prototype.propertyIsEnumerable,a=!o.call({toString:null},"toString"),i=o.call(function(){},"prototype"),l=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],c=function(S){var k=S.constructor;return k&&k.prototype===S},p={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},b=function(){if(typeof window>"u")return!1;for(var S in window)try{if(!p["$"+S]&&e.call(window,S)&&window[S]!==null&&typeof window[S]=="object")try{c(window[S])}catch{return!0}}catch{return!0}return!1}(),m=function(S){if(typeof window>"u"||!b)return c(S);try{return c(S)}catch{return!1}};t=function(k){var P=k!==null&&typeof k=="object",$=r.call(k)==="[object Function]",_=n(k),g=P&&r.call(k)==="[object String]",y=[];if(!P&&!$&&!_)throw new TypeError("Object.keys called on a non-object");var s=i&&$;if(g&&k.length>0&&!e.call(k,0))for(var d=0;d<k.length;++d)y.push(String(d));if(_&&k.length>0)for(var w=0;w<k.length;++w)y.push(String(w));else for(var u in k)!(s&&u==="prototype")&&e.call(k,u)&&y.push(String(u));if(a)for(var f=m(k),v=0;v<l.length;++v)!(f&&l[v]==="constructor")&&e.call(k,l[v])&&y.push(l[v]);return y}}return pr=t,pr}var Cl=Array.prototype.slice,xl=Ja,fo=Object.keys,Lt=fo?function(e){return fo(e)}:Dl(),po=Object.keys;Lt.shim=function(){if(Object.keys){var e=function(){var r=Object.keys(arguments);return r&&r.length===arguments.length}(1,2);e||(Object.keys=function(n){return xl(n)?po(Cl.call(n)):po(n)})}else Object.keys=Lt;return Object.keys||Lt};var yn=Lt,Bl=Error,Fl=EvalError,jl=RangeError,Nl=ReferenceError,Ya=SyntaxError,ze=TypeError,Ul=URIError,or=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},r=Symbol("test"),n=Object(r);if(typeof r=="string"||Object.prototype.toString.call(r)!=="[object Symbol]"||Object.prototype.toString.call(n)!=="[object Symbol]")return!1;var o=42;e[r]=o;for(r in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var a=Object.getOwnPropertySymbols(e);if(a.length!==1||a[0]!==r||!Object.prototype.propertyIsEnumerable.call(e,r))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var i=Object.getOwnPropertyDescriptor(e,r);if(i.value!==o||i.enumerable!==!0)return!1}return!0},mo=typeof Symbol<"u"&&Symbol,Rl=or,hn=function(){return typeof mo!="function"||typeof Symbol!="function"||typeof mo("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:Rl()},yo={foo:{}},ql=Object,zl=function(){return{__proto__:yo}.foo===yo.foo&&!({__proto__:null}instanceof ql)},Wl="Function.prototype.bind called on incompatible ",Vl=Object.prototype.toString,Gl=Math.max,Hl="[object Function]",ho=function(e,r){for(var n=[],o=0;o<e.length;o+=1)n[o]=e[o];for(var a=0;a<r.length;a+=1)n[a+e.length]=r[a];return n},Jl=function(e,r){for(var n=[],o=r||0,a=0;o<e.length;o+=1,a+=1)n[a]=e[o];return n},Yl=function(t,e){for(var r="",n=0;n<t.length;n+=1)r+=t[n],n+1<t.length&&(r+=e);return r},Kl=function(e){var r=this;if(typeof r!="function"||Vl.apply(r)!==Hl)throw new TypeError(Wl+r);for(var n=Jl(arguments,1),o,a=function(){if(this instanceof o){var b=r.apply(this,ho(n,arguments));return Object(b)===b?b:this}return r.apply(e,ho(n,arguments))},i=Gl(0,r.length-n.length),l=[],c=0;c<i;c++)l[c]="$"+c;if(o=Function("binder","return function ("+Yl(l,",")+"){ return binder.apply(this,arguments); }")(a),r.prototype){var p=function(){};p.prototype=r.prototype,o.prototype=new p,p.prototype=null}return o},Xl=Kl,gn=Function.prototype.bind||Xl,Ql=Function.prototype.call,Zl=Object.prototype.hasOwnProperty,ec=gn,Ka=ec.call(Ql,Zl),B,tc=Bl,rc=Fl,nc=jl,oc=Nl,Ze=Ya,Qe=ze,ac=Ul,Xa=Function,dr=function(t){try{return Xa('"use strict"; return ('+t+").constructor;")()}catch{}},Re=Object.getOwnPropertyDescriptor;if(Re)try{Re({},"")}catch{Re=null}var mr=function(){throw new Qe},ic=Re?function(){try{return arguments.callee,mr}catch{try{return Re(arguments,"callee").get}catch{return mr}}}():mr,He=hn(),sc=zl(),Z=Object.getPrototypeOf||(sc?function(t){return t.__proto__}:null),Ke={},lc=typeof Uint8Array>"u"||!Z?B:Z(Uint8Array),qe={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?B:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?B:ArrayBuffer,"%ArrayIteratorPrototype%":He&&Z?Z([][Symbol.iterator]()):B,"%AsyncFromSyncIteratorPrototype%":B,"%AsyncFunction%":Ke,"%AsyncGenerator%":Ke,"%AsyncGeneratorFunction%":Ke,"%AsyncIteratorPrototype%":Ke,"%Atomics%":typeof Atomics>"u"?B:Atomics,"%BigInt%":typeof BigInt>"u"?B:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?B:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?B:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?B:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":tc,"%eval%":eval,"%EvalError%":rc,"%Float32Array%":typeof Float32Array>"u"?B:Float32Array,"%Float64Array%":typeof Float64Array>"u"?B:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?B:FinalizationRegistry,"%Function%":Xa,"%GeneratorFunction%":Ke,"%Int8Array%":typeof Int8Array>"u"?B:Int8Array,"%Int16Array%":typeof Int16Array>"u"?B:Int16Array,"%Int32Array%":typeof Int32Array>"u"?B:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":He&&Z?Z(Z([][Symbol.iterator]())):B,"%JSON%":typeof JSON=="object"?JSON:B,"%Map%":typeof Map>"u"?B:Map,"%MapIteratorPrototype%":typeof Map>"u"||!He||!Z?B:Z(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?B:Promise,"%Proxy%":typeof Proxy>"u"?B:Proxy,"%RangeError%":nc,"%ReferenceError%":oc,"%Reflect%":typeof Reflect>"u"?B:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?B:Set,"%SetIteratorPrototype%":typeof Set>"u"||!He||!Z?B:Z(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?B:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":He&&Z?Z(""[Symbol.iterator]()):B,"%Symbol%":He?Symbol:B,"%SyntaxError%":Ze,"%ThrowTypeError%":ic,"%TypedArray%":lc,"%TypeError%":Qe,"%Uint8Array%":typeof Uint8Array>"u"?B:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?B:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?B:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?B:Uint32Array,"%URIError%":ac,"%WeakMap%":typeof WeakMap>"u"?B:WeakMap,"%WeakRef%":typeof WeakRef>"u"?B:WeakRef,"%WeakSet%":typeof WeakSet>"u"?B:WeakSet};if(Z)try{null.error}catch(t){var cc=Z(Z(t));qe["%Error.prototype%"]=cc}var uc=function t(e){var r;if(e==="%AsyncFunction%")r=dr("async function () {}");else if(e==="%GeneratorFunction%")r=dr("function* () {}");else if(e==="%AsyncGeneratorFunction%")r=dr("async function* () {}");else if(e==="%AsyncGenerator%"){var n=t("%AsyncGeneratorFunction%");n&&(r=n.prototype)}else if(e==="%AsyncIteratorPrototype%"){var o=t("%AsyncGenerator%");o&&Z&&(r=Z(o.prototype))}return qe[e]=r,r},go={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},kt=gn,Rt=Ka,fc=kt.call(Function.call,Array.prototype.concat),pc=kt.call(Function.apply,Array.prototype.splice),vo=kt.call(Function.call,String.prototype.replace),qt=kt.call(Function.call,String.prototype.slice),dc=kt.call(Function.call,RegExp.prototype.exec),mc=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,yc=/\\(\\)?/g,hc=function(e){var r=qt(e,0,1),n=qt(e,-1);if(r==="%"&&n!=="%")throw new Ze("invalid intrinsic syntax, expected closing `%`");if(n==="%"&&r!=="%")throw new Ze("invalid intrinsic syntax, expected opening `%`");var o=[];return vo(e,mc,function(a,i,l,c){o[o.length]=l?vo(c,yc,"$1"):i||a}),o},gc=function(e,r){var n=e,o;if(Rt(go,n)&&(o=go[n],n="%"+o[0]+"%"),Rt(qe,n)){var a=qe[n];if(a===Ke&&(a=uc(n)),typeof a>"u"&&!r)throw new Qe("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:o,name:n,value:a}}throw new Ze("intrinsic "+e+" does not exist!")},Ee=function(e,r){if(typeof e!="string"||e.length===0)throw new Qe("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof r!="boolean")throw new Qe('"allowMissing" argument must be a boolean');if(dc(/^%?[^%]*%?$/,e)===null)throw new Ze("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var n=hc(e),o=n.length>0?n[0]:"",a=gc("%"+o+"%",r),i=a.name,l=a.value,c=!1,p=a.alias;p&&(o=p[0],pc(n,fc([0,1],p)));for(var b=1,m=!0;b<n.length;b+=1){var S=n[b],k=qt(S,0,1),P=qt(S,-1);if((k==='"'||k==="'"||k==="`"||P==='"'||P==="'"||P==="`")&&k!==P)throw new Ze("property names with quotes must have matching quotes");if((S==="constructor"||!m)&&(c=!0),o+="."+S,i="%"+o+"%",Rt(qe,i))l=qe[i];else if(l!=null){if(!(S in l)){if(!r)throw new Qe("base intrinsic for "+e+" exists, but the property is not available.");return}if(Re&&b+1>=n.length){var $=Re(l,S);m=!!$,m&&"get"in $&&!("originalValue"in $.get)?l=$.get:l=l[S]}else m=Rt(l,S),l=l[S];m&&!c&&(qe[i]=l)}}return l},yr,bo;function vn(){if(bo)return yr;bo=1;var t=Ee,e=t("%Object.defineProperty%",!0)||!1;if(e)try{e({},"a",{value:1})}catch{e=!1}return yr=e,yr}var vc=Ee,It=vc("%Object.getOwnPropertyDescriptor%",!0);if(It)try{It([],"length")}catch{It=null}var bn=It,wo=vn(),bc=Ya,Je=ze,So=bn,wn=function(e,r,n){if(!e||typeof e!="object"&&typeof e!="function")throw new Je("`obj` must be an object or a function`");if(typeof r!="string"&&typeof r!="symbol")throw new Je("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new Je("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new Je("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new Je("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new Je("`loose`, if provided, must be a boolean");var o=arguments.length>3?arguments[3]:null,a=arguments.length>4?arguments[4]:null,i=arguments.length>5?arguments[5]:null,l=arguments.length>6?arguments[6]:!1,c=!!So&&So(e,r);if(wo)wo(e,r,{configurable:i===null&&c?c.configurable:!i,enumerable:o===null&&c?c.enumerable:!o,value:n,writable:a===null&&c?c.writable:!a});else if(l||!o&&!a&&!i)e[r]=n;else throw new bc("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},qr=vn(),Qa=function(){return!!qr};Qa.hasArrayLengthDefineBug=function(){if(!qr)return null;try{return qr([],"length",{value:1}).length!==1}catch{return!0}};var Sn=Qa,wc=yn,Sc=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",_c=Object.prototype.toString,kc=Array.prototype.concat,_o=wn,Ec=function(t){return typeof t=="function"&&_c.call(t)==="[object Function]"},Za=Sn(),$c=function(t,e,r,n){if(e in t){if(n===!0){if(t[e]===r)return}else if(!Ec(n)||!n())return}Za?_o(t,e,r,!0):_o(t,e,r)},ei=function(t,e){var r=arguments.length>2?arguments[2]:{},n=wc(e);Sc&&(n=kc.call(n,Object.getOwnPropertySymbols(e)));for(var o=0;o<n.length;o+=1)$c(t,n[o],e[n[o]],r[n[o]])};ei.supportsDescriptors=!!Za;var We=ei,ti={exports:{}},Ac=Ee,ko=wn,Pc=Sn(),Eo=bn,$o=ze,Tc=Ac("%Math.floor%"),Mc=function(e,r){if(typeof e!="function")throw new $o("`fn` is not a function");if(typeof r!="number"||r<0||r>4294967295||Tc(r)!==r)throw new $o("`length` must be a positive 32-bit integer");var n=arguments.length>2&&!!arguments[2],o=!0,a=!0;if("length"in e&&Eo){var i=Eo(e,"length");i&&!i.configurable&&(o=!1),i&&!i.writable&&(a=!1)}return(o||a||!n)&&(Pc?ko(e,"length",r,!0,!0):ko(e,"length",r)),e};(function(t){var e=gn,r=Ee,n=Mc,o=ze,a=r("%Function.prototype.apply%"),i=r("%Function.prototype.call%"),l=r("%Reflect.apply%",!0)||e.call(i,a),c=vn(),p=r("%Math.max%");t.exports=function(S){if(typeof S!="function")throw new o("a function is required");var k=l(e,i,arguments);return n(k,1+p(0,S.length-(arguments.length-1)),!0)};var b=function(){return l(e,a,arguments)};c?c(t.exports,"apply",{value:b}):t.exports.apply=b})(ti);var nt=ti.exports,ri=Ee,ni=nt,Oc=ni(ri("String.prototype.indexOf")),me=function(e,r){var n=ri(e,!!r);return typeof n=="function"&&Oc(e,".prototype.")>-1?ni(n):n},Lc=yn,oi=or(),ai=me,Ao=Object,Ic=ai("Array.prototype.push"),Po=ai("Object.prototype.propertyIsEnumerable"),Dc=oi?Object.getOwnPropertySymbols:null,ii=function(e,r){if(e==null)throw new TypeError("target must be an object");var n=Ao(e);if(arguments.length===1)return n;for(var o=1;o<arguments.length;++o){var a=Ao(arguments[o]),i=Lc(a),l=oi&&(Object.getOwnPropertySymbols||Dc);if(l)for(var c=l(a),p=0;p<c.length;++p){var b=c[p];Po(a,b)&&Ic(i,b)}for(var m=0;m<i.length;++m){var S=i[m];if(Po(a,S)){var k=a[S];n[S]=k}}}return n},hr=ii,Cc=function(){if(!Object.assign)return!1;for(var t="abcdefghijklmnopqrst",e=t.split(""),r={},n=0;n<e.length;++n)r[e[n]]=e[n];var o=Object.assign({},r),a="";for(var i in o)a+=i;return t!==a},xc=function(){if(!Object.assign||!Object.preventExtensions)return!1;var t=Object.preventExtensions({1:2});try{Object.assign(t,"xy")}catch{return t[1]==="y"}return!1},si=function(){return!Object.assign||Cc()||xc()?hr:Object.assign},Bc=We,Fc=si,jc=function(){var e=Fc();return Bc(Object,{assign:e},{assign:function(){return Object.assign!==e}}),e},Nc=We,Uc=nt,Rc=ii,li=si,qc=jc,zc=Uc.apply(li()),ci=function(e,r){return zc(Object,arguments)};Nc(ci,{getPolyfill:li,implementation:Rc,shim:qc});var Wc=ci,St=function(){return typeof(function(){}).name=="string"},vt=Object.getOwnPropertyDescriptor;if(vt)try{vt([],"length")}catch{vt=null}St.functionsHaveConfigurableNames=function(){if(!St()||!vt)return!1;var e=vt(function(){},"name");return!!e&&!!e.configurable};var Vc=Function.prototype.bind;St.boundFunctionsHaveNames=function(){return St()&&typeof Vc=="function"&&(function(){}).bind().name!==""};var Gc=St,To=wn,Hc=Sn(),Jc=Gc.functionsHaveConfigurableNames(),Yc=ze,Kc=function(e,r){if(typeof e!="function")throw new Yc("`fn` is not a function");var n=arguments.length>2&&!!arguments[2];return(!n||Jc)&&(Hc?To(e,"name",r,!0,!0):To(e,"name",r)),e},Xc=Kc,Qc=ze,Zc=Object,ui=Xc(function(){if(this==null||this!==Zc(this))throw new Qc("RegExp.prototype.flags getter called on non-object");var e="";return this.hasIndices&&(e+="d"),this.global&&(e+="g"),this.ignoreCase&&(e+="i"),this.multiline&&(e+="m"),this.dotAll&&(e+="s"),this.unicode&&(e+="u"),this.unicodeSets&&(e+="v"),this.sticky&&(e+="y"),e},"get flags",!0),eu=ui,tu=We.supportsDescriptors,ru=Object.getOwnPropertyDescriptor,fi=function(){if(tu&&/a/mig.flags==="gim"){var e=ru(RegExp.prototype,"flags");if(e&&typeof e.get=="function"&&typeof RegExp.prototype.dotAll=="boolean"&&typeof RegExp.prototype.hasIndices=="boolean"){var r="",n={};if(Object.defineProperty(n,"hasIndices",{get:function(){r+="d"}}),Object.defineProperty(n,"sticky",{get:function(){r+="y"}}),r==="dy")return e.get}}return eu},nu=We.supportsDescriptors,ou=fi,au=Object.getOwnPropertyDescriptor,iu=Object.defineProperty,su=TypeError,Mo=Object.getPrototypeOf,lu=/a/,cu=function(){if(!nu||!Mo)throw new su("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");var e=ou(),r=Mo(lu),n=au(r,"flags");return(!n||n.get!==e)&&iu(r,"flags",{configurable:!0,enumerable:!1,get:e}),e},uu=We,fu=nt,pu=ui,pi=fi,du=cu,di=fu(pi());uu(di,{getPolyfill:pi,implementation:pu,shim:du});var mu=di,Dt={exports:{}},yu=or,Ve=function(){return yu()&&!!Symbol.toStringTag},hu=Ve(),gu=me,zr=gu("Object.prototype.toString"),ar=function(e){return hu&&e&&typeof e=="object"&&Symbol.toStringTag in e?!1:zr(e)==="[object Arguments]"},mi=function(e){return ar(e)?!0:e!==null&&typeof e=="object"&&typeof e.length=="number"&&e.length>=0&&zr(e)!=="[object Array]"&&zr(e.callee)==="[object Function]"},vu=function(){return ar(arguments)}();ar.isLegacyArguments=mi;var yi=vu?ar:mi;const bu={},wu=Object.freeze(Object.defineProperty({__proto__:null,default:bu},Symbol.toStringTag,{value:"Module"})),Su=bs(wu);var _n=typeof Map=="function"&&Map.prototype,gr=Object.getOwnPropertyDescriptor&&_n?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,zt=_n&&gr&&typeof gr.get=="function"?gr.get:null,Oo=_n&&Map.prototype.forEach,kn=typeof Set=="function"&&Set.prototype,vr=Object.getOwnPropertyDescriptor&&kn?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,Wt=kn&&vr&&typeof vr.get=="function"?vr.get:null,Lo=kn&&Set.prototype.forEach,_u=typeof WeakMap=="function"&&WeakMap.prototype,bt=_u?WeakMap.prototype.has:null,ku=typeof WeakSet=="function"&&WeakSet.prototype,wt=ku?WeakSet.prototype.has:null,Eu=typeof WeakRef=="function"&&WeakRef.prototype,Io=Eu?WeakRef.prototype.deref:null,$u=Boolean.prototype.valueOf,Au=Object.prototype.toString,Pu=Function.prototype.toString,Tu=String.prototype.match,En=String.prototype.slice,Ie=String.prototype.replace,Mu=String.prototype.toUpperCase,Do=String.prototype.toLowerCase,hi=RegExp.prototype.test,Co=Array.prototype.concat,we=Array.prototype.join,Ou=Array.prototype.slice,xo=Math.floor,Wr=typeof BigInt=="function"?BigInt.prototype.valueOf:null,br=Object.getOwnPropertySymbols,Vr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,et=typeof Symbol=="function"&&typeof Symbol.iterator=="object",re=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===et||"symbol")?Symbol.toStringTag:null,gi=Object.prototype.propertyIsEnumerable,Bo=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(t){return t.__proto__}:null);function Fo(t,e){if(t===1/0||t===-1/0||t!==t||t&&t>-1e3&&t<1e3||hi.call(/e/,e))return e;var r=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof t=="number"){var n=t<0?-xo(-t):xo(t);if(n!==t){var o=String(n),a=En.call(e,o.length+1);return Ie.call(o,r,"$&_")+"."+Ie.call(Ie.call(a,/([0-9]{3})/g,"$&_"),/_$/,"")}}return Ie.call(e,r,"$&_")}var Gr=Su,jo=Gr.custom,No=bi(jo)?jo:null,Lu=function t(e,r,n,o){var a=r||{};if(Le(a,"quoteStyle")&&a.quoteStyle!=="single"&&a.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(Le(a,"maxStringLength")&&(typeof a.maxStringLength=="number"?a.maxStringLength<0&&a.maxStringLength!==1/0:a.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var i=Le(a,"customInspect")?a.customInspect:!0;if(typeof i!="boolean"&&i!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(Le(a,"indent")&&a.indent!==null&&a.indent!=="	"&&!(parseInt(a.indent,10)===a.indent&&a.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(Le(a,"numericSeparator")&&typeof a.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var l=a.numericSeparator;if(typeof e>"u")return"undefined";if(e===null)return"null";if(typeof e=="boolean")return e?"true":"false";if(typeof e=="string")return Si(e,a);if(typeof e=="number"){if(e===0)return 1/0/e>0?"0":"-0";var c=String(e);return l?Fo(e,c):c}if(typeof e=="bigint"){var p=String(e)+"n";return l?Fo(e,p):p}var b=typeof a.depth>"u"?5:a.depth;if(typeof n>"u"&&(n=0),n>=b&&b>0&&typeof e=="object")return Hr(e)?"[Array]":"[Object]";var m=Yu(a,n);if(typeof o>"u")o=[];else if(wi(o,e)>=0)return"[Circular]";function S(I,L,D){if(L&&(o=Ou.call(o),o.push(L)),D){var C={depth:a.depth};return Le(a,"quoteStyle")&&(C.quoteStyle=a.quoteStyle),t(I,C,n+1,o)}return t(I,a,n+1,o)}if(typeof e=="function"&&!Uo(e)){var k=Uu(e),P=Pt(e,S);return"[Function"+(k?": "+k:" (anonymous)")+"]"+(P.length>0?" { "+we.call(P,", ")+" }":"")}if(bi(e)){var $=et?Ie.call(String(e),/^(Symbol\(.*\))_[^)]*$/,"$1"):Vr.call(e);return typeof e=="object"&&!et?st($):$}if(Gu(e)){for(var _="<"+Do.call(String(e.nodeName)),g=e.attributes||[],y=0;y<g.length;y++)_+=" "+g[y].name+"="+vi(Iu(g[y].value),"double",a);return _+=">",e.childNodes&&e.childNodes.length&&(_+="..."),_+="</"+Do.call(String(e.nodeName))+">",_}if(Hr(e)){if(e.length===0)return"[]";var s=Pt(e,S);return m&&!Ju(s)?"["+Jr(s,m)+"]":"[ "+we.call(s,", ")+" ]"}if(Cu(e)){var d=Pt(e,S);return!("cause"in Error.prototype)&&"cause"in e&&!gi.call(e,"cause")?"{ ["+String(e)+"] "+we.call(Co.call("[cause]: "+S(e.cause),d),", ")+" }":d.length===0?"["+String(e)+"]":"{ ["+String(e)+"] "+we.call(d,", ")+" }"}if(typeof e=="object"&&i){if(No&&typeof e[No]=="function"&&Gr)return Gr(e,{depth:b-n});if(i!=="symbol"&&typeof e.inspect=="function")return e.inspect()}if(Ru(e)){var w=[];return Oo&&Oo.call(e,function(I,L){w.push(S(L,e,!0)+" => "+S(I,e))}),Ro("Map",zt.call(e),w,m)}if(Wu(e)){var u=[];return Lo&&Lo.call(e,function(I){u.push(S(I,e))}),Ro("Set",Wt.call(e),u,m)}if(qu(e))return wr("WeakMap");if(Vu(e))return wr("WeakSet");if(zu(e))return wr("WeakRef");if(Bu(e))return st(S(Number(e)));if(ju(e))return st(S(Wr.call(e)));if(Fu(e))return st($u.call(e));if(xu(e))return st(S(String(e)));if(typeof window<"u"&&e===window)return"{ [object Window] }";if(e===mn)return"{ [object globalThis] }";if(!Du(e)&&!Uo(e)){var f=Pt(e,S),v=Bo?Bo(e)===Object.prototype:e instanceof Object||e.constructor===Object,h=e instanceof Object?"":"null prototype",E=!v&&re&&Object(e)===e&&re in e?En.call(xe(e),8,-1):h?"Object":"",A=v||typeof e.constructor!="function"?"":e.constructor.name?e.constructor.name+" ":"",T=A+(E||h?"["+we.call(Co.call([],E||[],h||[]),": ")+"] ":"");return f.length===0?T+"{}":m?T+"{"+Jr(f,m)+"}":T+"{ "+we.call(f,", ")+" }"}return String(e)};function vi(t,e,r){var n=(r.quoteStyle||e)==="double"?'"':"'";return n+t+n}function Iu(t){return Ie.call(String(t),/"/g,"&quot;")}function Hr(t){return xe(t)==="[object Array]"&&(!re||!(typeof t=="object"&&re in t))}function Du(t){return xe(t)==="[object Date]"&&(!re||!(typeof t=="object"&&re in t))}function Uo(t){return xe(t)==="[object RegExp]"&&(!re||!(typeof t=="object"&&re in t))}function Cu(t){return xe(t)==="[object Error]"&&(!re||!(typeof t=="object"&&re in t))}function xu(t){return xe(t)==="[object String]"&&(!re||!(typeof t=="object"&&re in t))}function Bu(t){return xe(t)==="[object Number]"&&(!re||!(typeof t=="object"&&re in t))}function Fu(t){return xe(t)==="[object Boolean]"&&(!re||!(typeof t=="object"&&re in t))}function bi(t){if(et)return t&&typeof t=="object"&&t instanceof Symbol;if(typeof t=="symbol")return!0;if(!t||typeof t!="object"||!Vr)return!1;try{return Vr.call(t),!0}catch{}return!1}function ju(t){if(!t||typeof t!="object"||!Wr)return!1;try{return Wr.call(t),!0}catch{}return!1}var Nu=Object.prototype.hasOwnProperty||function(t){return t in this};function Le(t,e){return Nu.call(t,e)}function xe(t){return Au.call(t)}function Uu(t){if(t.name)return t.name;var e=Tu.call(Pu.call(t),/^function\s*([\w$]+)/);return e?e[1]:null}function wi(t,e){if(t.indexOf)return t.indexOf(e);for(var r=0,n=t.length;r<n;r++)if(t[r]===e)return r;return-1}function Ru(t){if(!zt||!t||typeof t!="object")return!1;try{zt.call(t);try{Wt.call(t)}catch{return!0}return t instanceof Map}catch{}return!1}function qu(t){if(!bt||!t||typeof t!="object")return!1;try{bt.call(t,bt);try{wt.call(t,wt)}catch{return!0}return t instanceof WeakMap}catch{}return!1}function zu(t){if(!Io||!t||typeof t!="object")return!1;try{return Io.call(t),!0}catch{}return!1}function Wu(t){if(!Wt||!t||typeof t!="object")return!1;try{Wt.call(t);try{zt.call(t)}catch{return!0}return t instanceof Set}catch{}return!1}function Vu(t){if(!wt||!t||typeof t!="object")return!1;try{wt.call(t,wt);try{bt.call(t,bt)}catch{return!0}return t instanceof WeakSet}catch{}return!1}function Gu(t){return!t||typeof t!="object"?!1:typeof HTMLElement<"u"&&t instanceof HTMLElement?!0:typeof t.nodeName=="string"&&typeof t.getAttribute=="function"}function Si(t,e){if(t.length>e.maxStringLength){var r=t.length-e.maxStringLength,n="... "+r+" more character"+(r>1?"s":"");return Si(En.call(t,0,e.maxStringLength),e)+n}var o=Ie.call(Ie.call(t,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,Hu);return vi(o,"single",e)}function Hu(t){var e=t.charCodeAt(0),r={8:"b",9:"t",10:"n",12:"f",13:"r"}[e];return r?"\\"+r:"\\x"+(e<16?"0":"")+Mu.call(e.toString(16))}function st(t){return"Object("+t+")"}function wr(t){return t+" { ? }"}function Ro(t,e,r,n){var o=n?Jr(r,n):we.call(r,", ");return t+" ("+e+") {"+o+"}"}function Ju(t){for(var e=0;e<t.length;e++)if(wi(t[e],`
`)>=0)return!1;return!0}function Yu(t,e){var r;if(t.indent==="	")r="	";else if(typeof t.indent=="number"&&t.indent>0)r=we.call(Array(t.indent+1)," ");else return null;return{base:r,prev:we.call(Array(e+1),r)}}function Jr(t,e){if(t.length===0)return"";var r=`
`+e.prev+e.base;return r+we.call(t,","+r)+`
`+e.prev}function Pt(t,e){var r=Hr(t),n=[];if(r){n.length=t.length;for(var o=0;o<t.length;o++)n[o]=Le(t,o)?e(t[o],t):""}var a=typeof br=="function"?br(t):[],i;if(et){i={};for(var l=0;l<a.length;l++)i["$"+a[l]]=a[l]}for(var c in t)Le(t,c)&&(r&&String(Number(c))===c&&c<t.length||et&&i["$"+c]instanceof Symbol||(hi.call(/[^\w$]/,c)?n.push(e(c,t)+": "+e(t[c],t)):n.push(c+": "+e(t[c],t))));if(typeof br=="function")for(var p=0;p<a.length;p++)gi.call(t,a[p])&&n.push("["+e(a[p])+"]: "+e(t[a[p]],t));return n}var $n=Ee,ot=me,Ku=Lu,Xu=$n("%TypeError%"),Tt=$n("%WeakMap%",!0),Mt=$n("%Map%",!0),Qu=ot("WeakMap.prototype.get",!0),Zu=ot("WeakMap.prototype.set",!0),ef=ot("WeakMap.prototype.has",!0),tf=ot("Map.prototype.get",!0),rf=ot("Map.prototype.set",!0),nf=ot("Map.prototype.has",!0),An=function(t,e){for(var r=t,n;(n=r.next)!==null;r=n)if(n.key===e)return r.next=n.next,n.next=t.next,t.next=n,n},of=function(t,e){var r=An(t,e);return r&&r.value},af=function(t,e,r){var n=An(t,e);n?n.value=r:t.next={key:e,next:t.next,value:r}},sf=function(t,e){return!!An(t,e)},_i=function(){var e,r,n,o={assert:function(a){if(!o.has(a))throw new Xu("Side channel does not contain "+Ku(a))},get:function(a){if(Tt&&a&&(typeof a=="object"||typeof a=="function")){if(e)return Qu(e,a)}else if(Mt){if(r)return tf(r,a)}else if(n)return of(n,a)},has:function(a){if(Tt&&a&&(typeof a=="object"||typeof a=="function")){if(e)return ef(e,a)}else if(Mt){if(r)return nf(r,a)}else if(n)return sf(n,a);return!1},set:function(a,i){Tt&&a&&(typeof a=="object"||typeof a=="function")?(e||(e=new Tt),Zu(e,a,i)):Mt?(r||(r=new Mt),rf(r,a,i)):(n||(n={key:{},next:null}),af(n,a,i))}};return o},lf=Ka,lt=_i(),Ae=ze,Pn={assert:function(t,e){if(!t||typeof t!="object"&&typeof t!="function")throw new Ae("`O` is not an object");if(typeof e!="string")throw new Ae("`slot` must be a string");if(lt.assert(t),!Pn.has(t,e))throw new Ae("`"+e+"` is not present on `O`")},get:function(t,e){if(!t||typeof t!="object"&&typeof t!="function")throw new Ae("`O` is not an object");if(typeof e!="string")throw new Ae("`slot` must be a string");var r=lt.get(t);return r&&r["$"+e]},has:function(t,e){if(!t||typeof t!="object"&&typeof t!="function")throw new Ae("`O` is not an object");if(typeof e!="string")throw new Ae("`slot` must be a string");var r=lt.get(t);return!!r&&lf(r,"$"+e)},set:function(t,e,r){if(!t||typeof t!="object"&&typeof t!="function")throw new Ae("`O` is not an object");if(typeof e!="string")throw new Ae("`slot` must be a string");var n=lt.get(t);n||(n={},lt.set(t,n)),n["$"+e]=r}};Object.freeze&&Object.freeze(Pn);var cf=Pn,ct=cf,uf=SyntaxError,qo=typeof StopIteration=="object"?StopIteration:null,ff=function(e){if(!qo)throw new uf("this environment lacks StopIteration");ct.set(e,"[[Done]]",!1);var r={next:function(){var o=ct.get(this,"[[Iterator]]"),a=ct.get(o,"[[Done]]");try{return{done:a,value:a?void 0:o.next()}}catch(i){if(ct.set(o,"[[Done]]",!0),i!==qo)throw i;return{done:!0,value:void 0}}}};return ct.set(r,"[[Iterator]]",e),r},pf={}.toString,ki=Array.isArray||function(t){return pf.call(t)=="[object Array]"},df=String.prototype.valueOf,mf=function(e){try{return df.call(e),!0}catch{return!1}},yf=Object.prototype.toString,hf="[object String]",gf=Ve(),Ei=function(e){return typeof e=="string"?!0:typeof e!="object"?!1:gf?mf(e):yf.call(e)===hf},Tn=typeof Map=="function"&&Map.prototype?Map:null,vf=typeof Set=="function"&&Set.prototype?Set:null,Vt;Tn||(Vt=function(e){return!1});var $i=Tn?Map.prototype.has:null,zo=vf?Set.prototype.has:null;!Vt&&!$i&&(Vt=function(e){return!1});var Ai=Vt||function(e){if(!e||typeof e!="object")return!1;try{if($i.call(e),zo)try{zo.call(e)}catch{return!0}return e instanceof Tn}catch{}return!1},bf=typeof Map=="function"&&Map.prototype?Map:null,Mn=typeof Set=="function"&&Set.prototype?Set:null,Gt;Mn||(Gt=function(e){return!1});var Wo=bf?Map.prototype.has:null,Pi=Mn?Set.prototype.has:null;!Gt&&!Pi&&(Gt=function(e){return!1});var Ti=Gt||function(e){if(!e||typeof e!="object")return!1;try{if(Pi.call(e),Wo)try{Wo.call(e)}catch{return!0}return e instanceof Mn}catch{}return!1},Vo=yi,Go=ff;if(hn()||or()){var Sr=Symbol.iterator;Dt.exports=function(e){if(e!=null&&typeof e[Sr]<"u")return e[Sr]();if(Vo(e))return Array.prototype[Sr].call(e)}}else{var wf=ki,Sf=Ei,Ho=Ee,_f=Ho("%Map%",!0),kf=Ho("%Set%",!0),ye=me,Jo=ye("Array.prototype.push"),Yo=ye("String.prototype.charCodeAt"),Ef=ye("String.prototype.slice"),$f=function(e,r){var n=e.length;if(r+1>=n)return r+1;var o=Yo(e,r);if(o<55296||o>56319)return r+1;var a=Yo(e,r+1);return a<56320||a>57343?r+1:r+2},_r=function(e){var r=0;return{next:function(){var o=r>=e.length,a;return o||(a=e[r],r+=1),{done:o,value:a}}}},Ko=function(e,r){if(wf(e)||Vo(e))return _r(e);if(Sf(e)){var n=0;return{next:function(){var a=$f(e,n),i=Ef(e,n,a);return n=a,{done:a>e.length,value:i}}}}if(r&&typeof e["_es6-shim iterator_"]<"u")return e["_es6-shim iterator_"]()};if(!_f&&!kf)Dt.exports=function(e){if(e!=null)return Ko(e,!0)};else{var Af=Ai,Pf=Ti,Xo=ye("Map.prototype.forEach",!0),Qo=ye("Set.prototype.forEach",!0);if(typeof process>"u"||!process.versions||!process.versions.node)var Zo=ye("Map.prototype.iterator",!0),ea=ye("Set.prototype.iterator",!0);var ta=ye("Map.prototype.@@iterator",!0)||ye("Map.prototype._es6-shim iterator_",!0),ra=ye("Set.prototype.@@iterator",!0)||ye("Set.prototype._es6-shim iterator_",!0),Tf=function(e){if(Af(e)){if(Zo)return Go(Zo(e));if(ta)return ta(e);if(Xo){var r=[];return Xo(e,function(o,a){Jo(r,[a,o])}),_r(r)}}if(Pf(e)){if(ea)return Go(ea(e));if(ra)return ra(e);if(Qo){var n=[];return Qo(e,function(o){Jo(n,o)}),_r(n)}}};Dt.exports=function(e){return Tf(e)||Ko(e)}}}var Mf=Dt.exports,na=function(t){return t!==t},Mi=function(e,r){return e===0&&r===0?1/e===1/r:!!(e===r||na(e)&&na(r))},Of=Mi,Oi=function(){return typeof Object.is=="function"?Object.is:Of},Lf=Oi,If=We,Df=function(){var e=Lf();return If(Object,{is:e},{is:function(){return Object.is!==e}}),e},Cf=We,xf=nt,Bf=Mi,Li=Oi,Ff=Df,Ii=xf(Li(),Object);Cf(Ii,{getPolyfill:Li,implementation:Bf,shim:Ff});var jf=Ii,Nf=nt,Di=me,Uf=Ee,Yr=Uf("%ArrayBuffer%",!0),Ct=Di("ArrayBuffer.prototype.byteLength",!0),Rf=Di("Object.prototype.toString"),oa=!!Yr&&!Ct&&new Yr(0).slice,aa=!!oa&&Nf(oa),Ci=Ct||aa?function(e){if(!e||typeof e!="object")return!1;try{return Ct?Ct(e):aa(e,0),!0}catch{return!1}}:Yr?function(e){return Rf(e)==="[object ArrayBuffer]"}:function(e){return!1},qf=Date.prototype.getDay,zf=function(e){try{return qf.call(e),!0}catch{return!1}},Wf=Object.prototype.toString,Vf="[object Date]",Gf=Ve(),Hf=function(e){return typeof e!="object"||e===null?!1:Gf?zf(e):Wf.call(e)===Vf},Kr=me,xi=Ve(),Bi,Fi,Xr,Qr;if(xi){Bi=Kr("Object.prototype.hasOwnProperty"),Fi=Kr("RegExp.prototype.exec"),Xr={};var kr=function(){throw Xr};Qr={toString:kr,valueOf:kr},typeof Symbol.toPrimitive=="symbol"&&(Qr[Symbol.toPrimitive]=kr)}var Jf=Kr("Object.prototype.toString"),Yf=Object.getOwnPropertyDescriptor,Kf="[object RegExp]",Xf=xi?function(e){if(!e||typeof e!="object")return!1;var r=Yf(e,"lastIndex"),n=r&&Bi(r,"value");if(!n)return!1;try{Fi(e,Qr)}catch(o){return o===Xr}}:function(e){return!e||typeof e!="object"&&typeof e!="function"?!1:Jf(e)===Kf},Qf=me,ia=Qf("SharedArrayBuffer.prototype.byteLength",!0),Zf=ia?function(e){if(!e||typeof e!="object")return!1;try{return ia(e),!0}catch{return!1}}:function(e){return!1},ep=Number.prototype.toString,tp=function(e){try{return ep.call(e),!0}catch{return!1}},rp=Object.prototype.toString,np="[object Number]",op=Ve(),ap=function(e){return typeof e=="number"?!0:typeof e!="object"?!1:op?tp(e):rp.call(e)===np},ji=me,ip=ji("Boolean.prototype.toString"),sp=ji("Object.prototype.toString"),lp=function(e){try{return ip(e),!0}catch{return!1}},cp="[object Boolean]",up=Ve(),fp=function(e){return typeof e=="boolean"?!0:e===null||typeof e!="object"?!1:up&&Symbol.toStringTag in e?lp(e):sp(e)===cp},Zr={exports:{}},pp=Object.prototype.toString,dp=hn();if(dp){var mp=Symbol.prototype.toString,yp=/^Symbol\(.*\)$/,hp=function(e){return typeof e.valueOf()!="symbol"?!1:yp.test(mp.call(e))};Zr.exports=function(e){if(typeof e=="symbol")return!0;if(pp.call(e)!=="[object Symbol]")return!1;try{return hp(e)}catch{return!1}}}else Zr.exports=function(e){return!1};var gp=Zr.exports,en={exports:{}},sa=typeof BigInt<"u"&&BigInt,vp=function(){return typeof sa=="function"&&typeof BigInt=="function"&&typeof sa(42)=="bigint"&&typeof BigInt(42)=="bigint"},bp=vp();if(bp){var wp=BigInt.prototype.valueOf,Sp=function(e){try{return wp.call(e),!0}catch{}return!1};en.exports=function(e){return e===null||typeof e>"u"||typeof e=="boolean"||typeof e=="string"||typeof e=="number"||typeof e=="symbol"||typeof e=="function"?!1:typeof e=="bigint"?!0:Sp(e)}}else en.exports=function(e){return!1};var _p=en.exports,kp=Ei,Ep=ap,$p=fp,Ap=gp,Pp=_p,Tp=function(e){if(e==null||typeof e!="object"&&typeof e!="function")return null;if(kp(e))return"String";if(Ep(e))return"Number";if($p(e))return"Boolean";if(Ap(e))return"Symbol";if(Pp(e))return"BigInt"},Ht=typeof WeakMap=="function"&&WeakMap.prototype?WeakMap:null,la=typeof WeakSet=="function"&&WeakSet.prototype?WeakSet:null,Jt;Ht||(Jt=function(e){return!1});var tn=Ht?Ht.prototype.has:null,Er=la?la.prototype.has:null;!Jt&&!tn&&(Jt=function(e){return!1});var Mp=Jt||function(e){if(!e||typeof e!="object")return!1;try{if(tn.call(e,tn),Er)try{Er.call(e,Er)}catch{return!0}return e instanceof Ht}catch{}return!1},rn={exports:{}},Op=Ee,Ni=me,Lp=Op("%WeakSet%",!0),$r=Ni("WeakSet.prototype.has",!0);if($r){var Ar=Ni("WeakMap.prototype.has",!0);rn.exports=function(e){if(!e||typeof e!="object")return!1;try{if($r(e,$r),Ar)try{Ar(e,Ar)}catch{return!0}return e instanceof Lp}catch{}return!1}}else rn.exports=function(e){return!1};var Ip=rn.exports,Dp=Ai,Cp=Ti,xp=Mp,Bp=Ip,Fp=function(e){if(e&&typeof e=="object"){if(Dp(e))return"Map";if(Cp(e))return"Set";if(xp(e))return"WeakMap";if(Bp(e))return"WeakSet"}return!1},Ui=Function.prototype.toString,Xe=typeof Reflect=="object"&&Reflect!==null&&Reflect.apply,nn,xt;if(typeof Xe=="function"&&typeof Object.defineProperty=="function")try{nn=Object.defineProperty({},"length",{get:function(){throw xt}}),xt={},Xe(function(){throw 42},null,nn)}catch(t){t!==xt&&(Xe=null)}else Xe=null;var jp=/^\s*class\b/,on=function(e){try{var r=Ui.call(e);return jp.test(r)}catch{return!1}},Pr=function(e){try{return on(e)?!1:(Ui.call(e),!0)}catch{return!1}},Bt=Object.prototype.toString,Np="[object Object]",Up="[object Function]",Rp="[object GeneratorFunction]",qp="[object HTMLAllCollection]",zp="[object HTML document.all class]",Wp="[object HTMLCollection]",Vp=typeof Symbol=="function"&&!!Symbol.toStringTag,Gp=!(0 in[,]),an=function(){return!1};if(typeof document=="object"){var Hp=document.all;Bt.call(Hp)===Bt.call(document.all)&&(an=function(e){if((Gp||!e)&&(typeof e>"u"||typeof e=="object"))try{var r=Bt.call(e);return(r===qp||r===zp||r===Wp||r===Np)&&e("")==null}catch{}return!1})}var Jp=Xe?function(e){if(an(e))return!0;if(!e||typeof e!="function"&&typeof e!="object")return!1;try{Xe(e,null,nn)}catch(r){if(r!==xt)return!1}return!on(e)&&Pr(e)}:function(e){if(an(e))return!0;if(!e||typeof e!="function"&&typeof e!="object")return!1;if(Vp)return Pr(e);if(on(e))return!1;var r=Bt.call(e);return r!==Up&&r!==Rp&&!/^\[object HTML/.test(r)?!1:Pr(e)},Yp=Jp,Kp=Object.prototype.toString,Ri=Object.prototype.hasOwnProperty,Xp=function(e,r,n){for(var o=0,a=e.length;o<a;o++)Ri.call(e,o)&&(n==null?r(e[o],o,e):r.call(n,e[o],o,e))},Qp=function(e,r,n){for(var o=0,a=e.length;o<a;o++)n==null?r(e.charAt(o),o,e):r.call(n,e.charAt(o),o,e)},Zp=function(e,r,n){for(var o in e)Ri.call(e,o)&&(n==null?r(e[o],o,e):r.call(n,e[o],o,e))},ed=function(e,r,n){if(!Yp(r))throw new TypeError("iterator must be a function");var o;arguments.length>=3&&(o=n),Kp.call(e)==="[object Array]"?Xp(e,r,o):typeof e=="string"?Qp(e,r,o):Zp(e,r,o)},td=ed,rd=["Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array"],Tr=rd,nd=typeof globalThis>"u"?mn:globalThis,od=function(){for(var e=[],r=0;r<Tr.length;r++)typeof nd[Tr[r]]=="function"&&(e[e.length]=Tr[r]);return e},Yt=td,ad=od,ca=nt,On=me,Ft=bn,id=On("Object.prototype.toString"),qi=Ve(),ua=typeof globalThis>"u"?mn:globalThis,sn=ad(),Ln=On("String.prototype.slice"),Mr=Object.getPrototypeOf,sd=On("Array.prototype.indexOf",!0)||function(e,r){for(var n=0;n<e.length;n+=1)if(e[n]===r)return n;return-1},Kt={__proto__:null};qi&&Ft&&Mr?Yt(sn,function(t){var e=new ua[t];if(Symbol.toStringTag in e){var r=Mr(e),n=Ft(r,Symbol.toStringTag);if(!n){var o=Mr(r);n=Ft(o,Symbol.toStringTag)}Kt["$"+t]=ca(n.get)}}):Yt(sn,function(t){var e=new ua[t],r=e.slice||e.set;r&&(Kt["$"+t]=ca(r))});var ld=function(e){var r=!1;return Yt(Kt,function(n,o){if(!r)try{"$"+n(e)===o&&(r=Ln(o,1))}catch{}}),r},cd=function(e){var r=!1;return Yt(Kt,function(n,o){if(!r)try{n(e),r=Ln(o,1)}catch{}}),r},ud=function(e){if(!e||typeof e!="object")return!1;if(!qi){var r=Ln(id(e),8,-1);return sd(sn,r)>-1?r:r!=="Object"?!1:cd(e)}return Ft?ld(e):null},fd=me,fa=fd("ArrayBuffer.prototype.byteLength",!0),pd=Ci,dd=function(e){return pd(e)?fa?fa(e):e.byteLength:NaN},zi=Wc,$e=me,pa=mu,md=Ee,tt=Mf,yd=_i,da=jf,ma=yi,ya=ki,ha=Ci,ga=Hf,va=Xf,ba=Zf,wa=yn,Sa=Tp,_a=Fp,ka=ud,Ea=dd,$a=$e("SharedArrayBuffer.prototype.byteLength",!0),Aa=$e("Date.prototype.getTime"),Or=Object.getPrototypeOf,Pa=$e("Object.prototype.toString"),Xt=md("%Set%",!0),ln=$e("Map.prototype.has",!0),Qt=$e("Map.prototype.get",!0),Ta=$e("Map.prototype.size",!0),Zt=$e("Set.prototype.add",!0),Wi=$e("Set.prototype.delete",!0),er=$e("Set.prototype.has",!0),jt=$e("Set.prototype.size",!0);function Ma(t,e,r,n){for(var o=tt(t),a;(a=o.next())&&!a.done;)if(he(e,a.value,r,n))return Wi(t,a.value),!0;return!1}function Vi(t){if(typeof t>"u")return null;if(typeof t!="object")return typeof t=="symbol"?!1:typeof t=="string"||typeof t=="number"?+t==+t:!0}function hd(t,e,r,n,o,a){var i=Vi(r);if(i!=null)return i;var l=Qt(e,i),c=zi({},o,{strict:!1});return typeof l>"u"&&!ln(e,i)||!he(n,l,c,a)?!1:!ln(t,i)&&he(n,l,c,a)}function gd(t,e,r){var n=Vi(r);return n??(er(e,n)&&!er(t,n))}function Oa(t,e,r,n,o,a){for(var i=tt(t),l,c;(l=i.next())&&!l.done;)if(c=l.value,he(r,c,o,a)&&he(n,Qt(e,c),o,a))return Wi(t,c),!0;return!1}function he(t,e,r,n){var o=r||{};if(o.strict?da(t,e):t===e)return!0;var a=Sa(t),i=Sa(e);if(a!==i)return!1;if(!t||!e||typeof t!="object"&&typeof e!="object")return o.strict?da(t,e):t==e;var l=n.has(t),c=n.has(e),p;if(l&&c){if(n.get(t)===n.get(e))return!0}else p={};return l||n.set(t,p),c||n.set(e,p),wd(t,e,o,n)}function La(t){return!t||typeof t!="object"||typeof t.length!="number"||typeof t.copy!="function"||typeof t.slice!="function"||t.length>0&&typeof t[0]!="number"?!1:!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))}function vd(t,e,r,n){if(jt(t)!==jt(e))return!1;for(var o=tt(t),a=tt(e),i,l,c;(i=o.next())&&!i.done;)if(i.value&&typeof i.value=="object")c||(c=new Xt),Zt(c,i.value);else if(!er(e,i.value)){if(r.strict||!gd(t,e,i.value))return!1;c||(c=new Xt),Zt(c,i.value)}if(c){for(;(l=a.next())&&!l.done;)if(l.value&&typeof l.value=="object"){if(!Ma(c,l.value,r.strict,n))return!1}else if(!r.strict&&!er(t,l.value)&&!Ma(c,l.value,r.strict,n))return!1;return jt(c)===0}return!0}function bd(t,e,r,n){if(Ta(t)!==Ta(e))return!1;for(var o=tt(t),a=tt(e),i,l,c,p,b,m;(i=o.next())&&!i.done;)if(p=i.value[0],b=i.value[1],p&&typeof p=="object")c||(c=new Xt),Zt(c,p);else if(m=Qt(e,p),typeof m>"u"&&!ln(e,p)||!he(b,m,r,n)){if(r.strict||!hd(t,e,p,b,r,n))return!1;c||(c=new Xt),Zt(c,p)}if(c){for(;(l=a.next())&&!l.done;)if(p=l.value[0],m=l.value[1],p&&typeof p=="object"){if(!Oa(c,t,p,m,r,n))return!1}else if(!r.strict&&(!t.has(p)||!he(Qt(t,p),m,r,n))&&!Oa(c,t,p,m,zi({},r,{strict:!1}),n))return!1;return jt(c)===0}return!0}function wd(t,e,r,n){var o,a;if(typeof t!=typeof e||t==null||e==null||Pa(t)!==Pa(e)||ma(t)!==ma(e))return!1;var i=ya(t),l=ya(e);if(i!==l)return!1;var c=t instanceof Error,p=e instanceof Error;if(c!==p||(c||p)&&(t.name!==e.name||t.message!==e.message))return!1;var b=va(t),m=va(e);if(b!==m||(b||m)&&(t.source!==e.source||pa(t)!==pa(e)))return!1;var S=ga(t),k=ga(e);if(S!==k||(S||k)&&Aa(t)!==Aa(e)||r.strict&&Or&&Or(t)!==Or(e))return!1;var P=ka(t),$=ka(e);if(P!==$)return!1;if(P||$){if(t.length!==e.length)return!1;for(o=0;o<t.length;o++)if(t[o]!==e[o])return!1;return!0}var _=La(t),g=La(e);if(_!==g)return!1;if(_||g){if(t.length!==e.length)return!1;for(o=0;o<t.length;o++)if(t[o]!==e[o])return!1;return!0}var y=ha(t),s=ha(e);if(y!==s)return!1;if(y||s)return Ea(t)!==Ea(e)?!1:typeof Uint8Array=="function"&&he(new Uint8Array(t),new Uint8Array(e),r,n);var d=ba(t),w=ba(e);if(d!==w)return!1;if(d||w)return $a(t)!==$a(e)?!1:typeof Uint8Array=="function"&&he(new Uint8Array(t),new Uint8Array(e),r,n);if(typeof t!=typeof e)return!1;var u=wa(t),f=wa(e);if(u.length!==f.length)return!1;for(u.sort(),f.sort(),o=u.length-1;o>=0;o--)if(u[o]!=f[o])return!1;for(o=u.length-1;o>=0;o--)if(a=u[o],!he(t[a],e[a],r,n))return!1;var v=_a(t),h=_a(e);return v!==h?!1:v==="Set"||h==="Set"?vd(t,e,r,n):v==="Map"?bd(t,e,r,n):!0}var Sd=function(e,r,n){return he(e,r,n,yd())};const In=ws(Sd);var _d=Object.defineProperty,q=(t,e)=>_d(t,"name",{value:e,configurable:!0}),kd=class{constructor(e){this.direction=!1,this.compareProperties=!0;var r,n,o;this.precision=10**-((r=e==null?void 0:e.precision)!=null?r:17),this.direction=(n=e==null?void 0:e.direction)!=null?n:!1,this.compareProperties=(o=e==null?void 0:e.compareProperties)!=null?o:!0}compare(e,r){if(e.type!==r.type||!pt(e,r))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,r.coordinates);case"LineString":return this.compareLine(e.coordinates,r.coordinates);case"Polygon":return this.comparePolygon(e,r);case"GeometryCollection":return this.compareGeometryCollection(e,r);case"Feature":return this.compareFeature(e,r);case"FeatureCollection":return this.compareFeatureCollection(e,r);default:if(e.type.startsWith("Multi")){const n=cn(e),o=cn(r);return n.every(a=>o.some(i=>this.compare(a,i)))}}return!1}compareCoord(e,r){return e.length===r.length&&e.every((n,o)=>Math.abs(n-r[o])<this.precision)}compareLine(e,r,n=0,o=!1){if(!pt(e,r))return!1;const a=e;let i=r;if(o&&!this.compareCoord(a[0],i[0])){const c=this.fixStartIndex(i,a);if(c)i=c;else return!1}const l=this.compareCoord(a[n],i[n]);return this.direction||l?this.comparePath(a,i):this.compareCoord(a[n],i[i.length-(1+n)])?this.comparePath(a.slice().reverse(),i):!1}fixStartIndex(e,r){let n,o=-1;for(let a=0;a<e.length;a++)if(this.compareCoord(e[a],r[0])){o=a;break}return o>=0&&(n=[].concat(e.slice(o,e.length),e.slice(1,o+1))),n}comparePath(e,r){return e.every((n,o)=>this.compareCoord(n,r[o]))}comparePolygon(e,r){if(this.compareLine(e.coordinates[0],r.coordinates[0],1,!0)){const n=e.coordinates.slice(1,e.coordinates.length),o=r.coordinates.slice(1,r.coordinates.length);return n.every(a=>o.some(i=>this.compareLine(a,i,1,!0)))}return!1}compareGeometryCollection(e,r){return pt(e.geometries,r.geometries)&&this.compareBBox(e,r)&&e.geometries.every((n,o)=>this.compare(n,r.geometries[o]))}compareFeature(e,r){return e.id===r.id&&(this.compareProperties?In(e.properties,r.properties):!0)&&this.compareBBox(e,r)&&this.compare(e.geometry,r.geometry)}compareFeatureCollection(e,r){return pt(e.features,r.features)&&this.compareBBox(e,r)&&e.features.every((n,o)=>this.compare(n,r.features[o]))}compareBBox(e,r){return!e.bbox&&!r.bbox||(e.bbox&&r.bbox?this.compareCoord(e.bbox,r.bbox):!1)}};q(kd,"GeojsonEquality");function pt(t,e){return t.coordinates?t.coordinates.length===e.coordinates.length:t.length===e.length}q(pt,"sameLength");function cn(t){return t.coordinates.map(e=>({type:t.type.replace("Multi",""),coordinates:e}))}q(cn,"explode");var se=63710088e-1,Gi={centimeters:se*100,centimetres:se*100,degrees:360/(2*Math.PI),feet:se*3.28084,inches:se*39.37,kilometers:se/1e3,kilometres:se/1e3,meters:se,metres:se,miles:se/1609.344,millimeters:se*1e3,millimetres:se*1e3,nauticalmiles:se/1852,radians:1,yards:se*1.0936},Ia={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Be(t,e,r={}){const n={type:"Feature"};return(r.id===0||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=e||{},n.geometry=t,n}q(Be,"feature");function Ed(t,e,r={}){switch(t){case"Point":return Dn(e).geometry;case"LineString":return xn(e).geometry;case"Polygon":return Cn(e).geometry;case"MultiPoint":return Ji(e).geometry;case"MultiLineString":return Hi(e).geometry;case"MultiPolygon":return Yi(e).geometry;default:throw new Error(t+" is invalid")}}q(Ed,"geometry");function Dn(t,e,r={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!rt(t[0])||!rt(t[1]))throw new Error("coordinates must contain numbers");return Be({type:"Point",coordinates:t},e,r)}q(Dn,"point");function $d(t,e,r={}){return ir(t.map(n=>Dn(n,e)),r)}q($d,"points");function Cn(t,e,r={}){for(const o of t){if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(o[o.length-1].length!==o[0].length)throw new Error("First and last Position are not equivalent.");for(let a=0;a<o[o.length-1].length;a++)if(o[o.length-1][a]!==o[0][a])throw new Error("First and last Position are not equivalent.")}return Be({type:"Polygon",coordinates:t},e,r)}q(Cn,"polygon");function Ad(t,e,r={}){return ir(t.map(n=>Cn(n,e)),r)}q(Ad,"polygons");function xn(t,e,r={}){if(t.length<2)throw new Error("coordinates must be an array of two or more positions");return Be({type:"LineString",coordinates:t},e,r)}q(xn,"lineString");function Pd(t,e,r={}){return ir(t.map(n=>xn(n,e)),r)}q(Pd,"lineStrings");function ir(t,e={}){const r={type:"FeatureCollection"};return e.id&&(r.id=e.id),e.bbox&&(r.bbox=e.bbox),r.features=t,r}q(ir,"featureCollection");function Hi(t,e,r={}){return Be({type:"MultiLineString",coordinates:t},e,r)}q(Hi,"multiLineString");function Ji(t,e,r={}){return Be({type:"MultiPoint",coordinates:t},e,r)}q(Ji,"multiPoint");function Yi(t,e,r={}){return Be({type:"MultiPolygon",coordinates:t},e,r)}q(Yi,"multiPolygon");function Td(t,e,r={}){return Be({type:"GeometryCollection",geometries:t},e,r)}q(Td,"geometryCollection");function Md(t,e=0){if(e&&!(e>=0))throw new Error("precision must be a positive number");const r=Math.pow(10,e||0);return Math.round(t*r)/r}q(Md,"round");function Ki(t,e="kilometers"){const r=Gi[e];if(!r)throw new Error(e+" units is invalid");return t*r}q(Ki,"radiansToLength");function Bn(t,e="kilometers"){const r=Gi[e];if(!r)throw new Error(e+" units is invalid");return t/r}q(Bn,"lengthToRadians");function Od(t,e){return Xi(Bn(t,e))}q(Od,"lengthToDegrees");function Ld(t){let e=t%360;return e<0&&(e+=360),e}q(Ld,"bearingToAzimuth");function Xi(t){return t%(2*Math.PI)*180/Math.PI}q(Xi,"radiansToDegrees");function Id(t){return t%360*Math.PI/180}q(Id,"degreesToRadians");function Dd(t,e="kilometers",r="kilometers"){if(!(t>=0))throw new Error("length must be a positive number");return Ki(Bn(t,e),r)}q(Dd,"convertLength");function Cd(t,e="meters",r="kilometers"){if(!(t>=0))throw new Error("area must be a positive number");const n=Ia[e];if(!n)throw new Error("invalid original units");const o=Ia[r];if(!o)throw new Error("invalid final units");return t/n*o}q(Cd,"convertArea");function rt(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}q(rt,"isNumber");function xd(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}q(xd,"isObject");function Bd(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(t.length!==4&&t.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(e=>{if(!rt(e))throw new Error("bbox must only contain numbers")})}q(Bd,"validateBBox");function Fd(t){if(!t)throw new Error("id is required");if(["string","number"].indexOf(typeof t)===-1)throw new Error("id must be a number or a string")}q(Fd,"validateId");var jd=Object.defineProperty,Fe=(t,e)=>jd(t,"name",{value:e,configurable:!0});function un(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}Fe(un,"getCoord");function Nd(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}Fe(Nd,"getCoords");function Qi(t){if(t.length>1&&rt(t[0])&&rt(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return Qi(t[0]);throw new Error("coordinates must only contain numbers")}Fe(Qi,"containsNumber");function Ud(t,e,r){if(!e||!r)throw new Error("type and name required");if(!t||t.type!==e)throw new Error("Invalid input to "+r+": must be a "+e+", given "+t.type)}Fe(Ud,"geojsonType");function Rd(t,e,r){if(!t)throw new Error("No feature passed");if(!r)throw new Error(".featureOf() requires a name");if(!t||t.type!=="Feature"||!t.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+r+": must be a "+e+", given "+t.geometry.type)}Fe(Rd,"featureOf");function qd(t,e,r){if(!t)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!t||t.type!=="FeatureCollection")throw new Error("Invalid input to "+r+", FeatureCollection required");for(const n of t.features){if(!n||n.type!=="Feature"||!n.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!n.geometry||n.geometry.type!==e)throw new Error("Invalid input to "+r+": must be a "+e+", given "+n.geometry.type)}}Fe(qd,"collectionOf");function zd(t){return t.type==="Feature"?t.geometry:t}Fe(zd,"getGeom");function Wd(t,e){return t.type==="FeatureCollection"?"FeatureCollection":t.type==="GeometryCollection"?"GeometryCollection":t.type==="Feature"&&t.geometry!==null?t.geometry.type:t.type}Fe(Wd,"getType");var Vd=Object.defineProperty,z=(t,e)=>Vd(t,"name",{value:e,configurable:!0}),Gd=class{constructor(e){this.direction=!1,this.compareProperties=!0;var r,n,o;this.precision=10**-((r=e==null?void 0:e.precision)!=null?r:17),this.direction=(n=e==null?void 0:e.direction)!=null?n:!1,this.compareProperties=(o=e==null?void 0:e.compareProperties)!=null?o:!0}compare(e,r){if(e.type!==r.type||!dt(e,r))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,r.coordinates);case"LineString":return this.compareLine(e.coordinates,r.coordinates);case"Polygon":return this.comparePolygon(e,r);case"GeometryCollection":return this.compareGeometryCollection(e,r);case"Feature":return this.compareFeature(e,r);case"FeatureCollection":return this.compareFeatureCollection(e,r);default:if(e.type.startsWith("Multi")){const n=fn(e),o=fn(r);return n.every(a=>o.some(i=>this.compare(a,i)))}}return!1}compareCoord(e,r){return e.length===r.length&&e.every((n,o)=>Math.abs(n-r[o])<this.precision)}compareLine(e,r,n=0,o=!1){if(!dt(e,r))return!1;const a=e;let i=r;if(o&&!this.compareCoord(a[0],i[0])){const c=this.fixStartIndex(i,a);if(c)i=c;else return!1}const l=this.compareCoord(a[n],i[n]);return this.direction||l?this.comparePath(a,i):this.compareCoord(a[n],i[i.length-(1+n)])?this.comparePath(a.slice().reverse(),i):!1}fixStartIndex(e,r){let n,o=-1;for(let a=0;a<e.length;a++)if(this.compareCoord(e[a],r[0])){o=a;break}return o>=0&&(n=[].concat(e.slice(o,e.length),e.slice(1,o+1))),n}comparePath(e,r){return e.every((n,o)=>this.compareCoord(n,r[o]))}comparePolygon(e,r){if(this.compareLine(e.coordinates[0],r.coordinates[0],1,!0)){const n=e.coordinates.slice(1,e.coordinates.length),o=r.coordinates.slice(1,r.coordinates.length);return n.every(a=>o.some(i=>this.compareLine(a,i,1,!0)))}return!1}compareGeometryCollection(e,r){return dt(e.geometries,r.geometries)&&this.compareBBox(e,r)&&e.geometries.every((n,o)=>this.compare(n,r.geometries[o]))}compareFeature(e,r){return e.id===r.id&&(this.compareProperties?In(e.properties,r.properties):!0)&&this.compareBBox(e,r)&&this.compare(e.geometry,r.geometry)}compareFeatureCollection(e,r){return dt(e.features,r.features)&&this.compareBBox(e,r)&&e.features.every((n,o)=>this.compare(n,r.features[o]))}compareBBox(e,r){return!e.bbox&&!r.bbox||(e.bbox&&r.bbox?this.compareCoord(e.bbox,r.bbox):!1)}};z(Gd,"GeojsonEquality");function dt(t,e){return t.coordinates?t.coordinates.length===e.coordinates.length:t.length===e.length}z(dt,"sameLength");function fn(t){return t.coordinates.map(e=>({type:t.type.replace("Multi",""),coordinates:e}))}z(fn,"explode");var le=63710088e-1,Zi={centimeters:le*100,centimetres:le*100,degrees:360/(2*Math.PI),feet:le*3.28084,inches:le*39.37,kilometers:le/1e3,kilometres:le/1e3,meters:le,metres:le,miles:le/1609.344,millimeters:le*1e3,millimetres:le*1e3,nauticalmiles:le/1852,radians:1,yards:le*1.0936},Da={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function je(t,e,r={}){const n={type:"Feature"};return(r.id===0||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=e||{},n.geometry=t,n}z(je,"feature");function Hd(t,e,r={}){switch(t){case"Point":return Fn(e).geometry;case"LineString":return Nn(e).geometry;case"Polygon":return jn(e).geometry;case"MultiPoint":return ts(e).geometry;case"MultiLineString":return es(e).geometry;case"MultiPolygon":return rs(e).geometry;default:throw new Error(t+" is invalid")}}z(Hd,"geometry");function Fn(t,e,r={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!tr(t[0])||!tr(t[1]))throw new Error("coordinates must contain numbers");return je({type:"Point",coordinates:t},e,r)}z(Fn,"point");function Jd(t,e,r={}){return sr(t.map(n=>Fn(n,e)),r)}z(Jd,"points");function jn(t,e,r={}){for(const o of t){if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(o[o.length-1].length!==o[0].length)throw new Error("First and last Position are not equivalent.");for(let a=0;a<o[o.length-1].length;a++)if(o[o.length-1][a]!==o[0][a])throw new Error("First and last Position are not equivalent.")}return je({type:"Polygon",coordinates:t},e,r)}z(jn,"polygon");function Yd(t,e,r={}){return sr(t.map(n=>jn(n,e)),r)}z(Yd,"polygons");function Nn(t,e,r={}){if(t.length<2)throw new Error("coordinates must be an array of two or more positions");return je({type:"LineString",coordinates:t},e,r)}z(Nn,"lineString");function Kd(t,e,r={}){return sr(t.map(n=>Nn(n,e)),r)}z(Kd,"lineStrings");function sr(t,e={}){const r={type:"FeatureCollection"};return e.id&&(r.id=e.id),e.bbox&&(r.bbox=e.bbox),r.features=t,r}z(sr,"featureCollection");function es(t,e,r={}){return je({type:"MultiLineString",coordinates:t},e,r)}z(es,"multiLineString");function ts(t,e,r={}){return je({type:"MultiPoint",coordinates:t},e,r)}z(ts,"multiPoint");function rs(t,e,r={}){return je({type:"MultiPolygon",coordinates:t},e,r)}z(rs,"multiPolygon");function Xd(t,e,r={}){return je({type:"GeometryCollection",geometries:t},e,r)}z(Xd,"geometryCollection");function Qd(t,e=0){if(e&&!(e>=0))throw new Error("precision must be a positive number");const r=Math.pow(10,e||0);return Math.round(t*r)/r}z(Qd,"round");function Un(t,e="kilometers"){const r=Zi[e];if(!r)throw new Error(e+" units is invalid");return t*r}z(Un,"radiansToLength");function Rn(t,e="kilometers"){const r=Zi[e];if(!r)throw new Error(e+" units is invalid");return t/r}z(Rn,"lengthToRadians");function Zd(t,e){return ns(Rn(t,e))}z(Zd,"lengthToDegrees");function em(t){let e=t%360;return e<0&&(e+=360),e}z(em,"bearingToAzimuth");function ns(t){return t%(2*Math.PI)*180/Math.PI}z(ns,"radiansToDegrees");function mt(t){return t%360*Math.PI/180}z(mt,"degreesToRadians");function tm(t,e="kilometers",r="kilometers"){if(!(t>=0))throw new Error("length must be a positive number");return Un(Rn(t,e),r)}z(tm,"convertLength");function rm(t,e="meters",r="kilometers"){if(!(t>=0))throw new Error("area must be a positive number");const n=Da[e];if(!n)throw new Error("invalid original units");const o=Da[r];if(!o)throw new Error("invalid final units");return t/n*o}z(rm,"convertArea");function tr(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}z(tr,"isNumber");function nm(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}z(nm,"isObject");function om(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(t.length!==4&&t.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(e=>{if(!tr(e))throw new Error("bbox must only contain numbers")})}z(om,"validateBBox");function am(t){if(!t)throw new Error("id is required");if(["string","number"].indexOf(typeof t)===-1)throw new Error("id must be a number or a string")}z(am,"validateId");var im=Object.defineProperty,sm=(t,e)=>im(t,"name",{value:e,configurable:!0});function os(t,e,r={}){var n=un(t),o=un(e),a=mt(o[1]-n[1]),i=mt(o[0]-n[0]),l=mt(n[1]),c=mt(o[1]),p=Math.pow(Math.sin(a/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(l)*Math.cos(c);return Un(2*Math.atan2(Math.sqrt(p),Math.sqrt(1-p)),r.units)}sm(os,"distance");var lm=Object.defineProperty,W=(t,e)=>lm(t,"name",{value:e,configurable:!0}),cm=class{constructor(e){this.direction=!1,this.compareProperties=!0;var r,n,o;this.precision=10**-((r=e==null?void 0:e.precision)!=null?r:17),this.direction=(n=e==null?void 0:e.direction)!=null?n:!1,this.compareProperties=(o=e==null?void 0:e.compareProperties)!=null?o:!0}compare(e,r){if(e.type!==r.type||!yt(e,r))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,r.coordinates);case"LineString":return this.compareLine(e.coordinates,r.coordinates);case"Polygon":return this.comparePolygon(e,r);case"GeometryCollection":return this.compareGeometryCollection(e,r);case"Feature":return this.compareFeature(e,r);case"FeatureCollection":return this.compareFeatureCollection(e,r);default:if(e.type.startsWith("Multi")){const n=pn(e),o=pn(r);return n.every(a=>o.some(i=>this.compare(a,i)))}}return!1}compareCoord(e,r){return e.length===r.length&&e.every((n,o)=>Math.abs(n-r[o])<this.precision)}compareLine(e,r,n=0,o=!1){if(!yt(e,r))return!1;const a=e;let i=r;if(o&&!this.compareCoord(a[0],i[0])){const c=this.fixStartIndex(i,a);if(c)i=c;else return!1}const l=this.compareCoord(a[n],i[n]);return this.direction||l?this.comparePath(a,i):this.compareCoord(a[n],i[i.length-(1+n)])?this.comparePath(a.slice().reverse(),i):!1}fixStartIndex(e,r){let n,o=-1;for(let a=0;a<e.length;a++)if(this.compareCoord(e[a],r[0])){o=a;break}return o>=0&&(n=[].concat(e.slice(o,e.length),e.slice(1,o+1))),n}comparePath(e,r){return e.every((n,o)=>this.compareCoord(n,r[o]))}comparePolygon(e,r){if(this.compareLine(e.coordinates[0],r.coordinates[0],1,!0)){const n=e.coordinates.slice(1,e.coordinates.length),o=r.coordinates.slice(1,r.coordinates.length);return n.every(a=>o.some(i=>this.compareLine(a,i,1,!0)))}return!1}compareGeometryCollection(e,r){return yt(e.geometries,r.geometries)&&this.compareBBox(e,r)&&e.geometries.every((n,o)=>this.compare(n,r.geometries[o]))}compareFeature(e,r){return e.id===r.id&&(this.compareProperties?In(e.properties,r.properties):!0)&&this.compareBBox(e,r)&&this.compare(e.geometry,r.geometry)}compareFeatureCollection(e,r){return yt(e.features,r.features)&&this.compareBBox(e,r)&&e.features.every((n,o)=>this.compare(n,r.features[o]))}compareBBox(e,r){return!e.bbox&&!r.bbox||(e.bbox&&r.bbox?this.compareCoord(e.bbox,r.bbox):!1)}};W(cm,"GeojsonEquality");function yt(t,e){return t.coordinates?t.coordinates.length===e.coordinates.length:t.length===e.length}W(yt,"sameLength");function pn(t){return t.coordinates.map(e=>({type:t.type.replace("Multi",""),coordinates:e}))}W(pn,"explode");var ce=63710088e-1,as={centimeters:ce*100,centimetres:ce*100,degrees:360/(2*Math.PI),feet:ce*3.28084,inches:ce*39.37,kilometers:ce/1e3,kilometres:ce/1e3,meters:ce,metres:ce,miles:ce/1609.344,millimeters:ce*1e3,millimetres:ce*1e3,nauticalmiles:ce/1852,radians:1,yards:ce*1.0936},Ca={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Ne(t,e,r={}){const n={type:"Feature"};return(r.id===0||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=e||{},n.geometry=t,n}W(Ne,"feature");function um(t,e,r={}){switch(t){case"Point":return _t(e).geometry;case"LineString":return zn(e).geometry;case"Polygon":return qn(e).geometry;case"MultiPoint":return ss(e).geometry;case"MultiLineString":return is(e).geometry;case"MultiPolygon":return ls(e).geometry;default:throw new Error(t+" is invalid")}}W(um,"geometry");function _t(t,e,r={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!rr(t[0])||!rr(t[1]))throw new Error("coordinates must contain numbers");return Ne({type:"Point",coordinates:t},e,r)}W(_t,"point");function fm(t,e,r={}){return lr(t.map(n=>_t(n,e)),r)}W(fm,"points");function qn(t,e,r={}){for(const o of t){if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(o[o.length-1].length!==o[0].length)throw new Error("First and last Position are not equivalent.");for(let a=0;a<o[o.length-1].length;a++)if(o[o.length-1][a]!==o[0][a])throw new Error("First and last Position are not equivalent.")}return Ne({type:"Polygon",coordinates:t},e,r)}W(qn,"polygon");function pm(t,e,r={}){return lr(t.map(n=>qn(n,e)),r)}W(pm,"polygons");function zn(t,e,r={}){if(t.length<2)throw new Error("coordinates must be an array of two or more positions");return Ne({type:"LineString",coordinates:t},e,r)}W(zn,"lineString");function dm(t,e,r={}){return lr(t.map(n=>zn(n,e)),r)}W(dm,"lineStrings");function lr(t,e={}){const r={type:"FeatureCollection"};return e.id&&(r.id=e.id),e.bbox&&(r.bbox=e.bbox),r.features=t,r}W(lr,"featureCollection");function is(t,e,r={}){return Ne({type:"MultiLineString",coordinates:t},e,r)}W(is,"multiLineString");function ss(t,e,r={}){return Ne({type:"MultiPoint",coordinates:t},e,r)}W(ss,"multiPoint");function ls(t,e,r={}){return Ne({type:"MultiPolygon",coordinates:t},e,r)}W(ls,"multiPolygon");function mm(t,e,r={}){return Ne({type:"GeometryCollection",geometries:t},e,r)}W(mm,"geometryCollection");function ym(t,e=0){if(e&&!(e>=0))throw new Error("precision must be a positive number");const r=Math.pow(10,e||0);return Math.round(t*r)/r}W(ym,"round");function cs(t,e="kilometers"){const r=as[e];if(!r)throw new Error(e+" units is invalid");return t*r}W(cs,"radiansToLength");function Wn(t,e="kilometers"){const r=as[e];if(!r)throw new Error(e+" units is invalid");return t/r}W(Wn,"lengthToRadians");function hm(t,e){return us(Wn(t,e))}W(hm,"lengthToDegrees");function gm(t){let e=t%360;return e<0&&(e+=360),e}W(gm,"bearingToAzimuth");function us(t){return t%(2*Math.PI)*180/Math.PI}W(us,"radiansToDegrees");function vm(t){return t%360*Math.PI/180}W(vm,"degreesToRadians");function bm(t,e="kilometers",r="kilometers"){if(!(t>=0))throw new Error("length must be a positive number");return cs(Wn(t,e),r)}W(bm,"convertLength");function wm(t,e="meters",r="kilometers"){if(!(t>=0))throw new Error("area must be a positive number");const n=Ca[e];if(!n)throw new Error("invalid original units");const o=Ca[r];if(!o)throw new Error("invalid final units");return t/n*o}W(wm,"convertArea");function rr(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}W(rr,"isNumber");function Sm(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}W(Sm,"isObject");function _m(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(t.length!==4&&t.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(e=>{if(!rr(e))throw new Error("bbox must only contain numbers")})}W(_m,"validateBBox");function km(t){if(!t)throw new Error("id is required");if(["string","number"].indexOf(typeof t)===-1)throw new Error("id must be a number or a string")}W(km,"validateId");function Em(t){return{type:"FeatureCollection",features:t.flatMap(e=>e.geometry.coordinates.map(r=>({type:"Feature",geometry:{type:"Point",coordinates:r},properties:{}})))}}function $m(t,e,r){let n,o,a,i,l;Q(t,Ur,f=>r(7,n=f)),Q(t,dn,f=>r(8,o=f)),Q(t,Wa,f=>r(9,a=f)),Q(t,De,f=>r(10,i=f)),Q(t,Br,f=>r(11,l=f));let{map:c}=e,p,b={},m={},S={};const k={solidLine:{width:30,opacity:.4,dashArray:[1]},dashedLine:{width:6,opacity:.8,dashArray:[0,4,3]},circle:{radius:2,opacity:.8}};Me(()=>{console.log("Mounting TrailTracker"),$(),Fr.subscribe(f=>{Object.keys(f).length>0&&(Object.entries(f).forEach(([v,h])=>{s(h,i,`user-${v}`)}),Fr.set({}))}),jr.subscribe(f=>{Object.keys(f).length>0&&(Object.entries(f).forEach(([v,h])=>{const E=o.find(A=>A.vehicle_id===v);E?s(h,E,`other-${v}`):console.warn(`Vehicle not found for trail data: ${v}`)}),jr.set({}))}),p=Ur.subscribe(u),c.on("style.load",$)}),Ce(()=>{console.log("Destroying TrailTracker"),c&&c.off("style.load",$),w(),p&&p()});function P(f,v){c.getSource(f)?c.getSource(f).setData(v):c.addSource(f,{type:"geojson",data:v})}function $(){b={},m={},console.log("Loading User Trail:",l),Object.entries(l).forEach(([f,v])=>{s(v,i,`user-${f}`)}),console.log("Loading Other Trail:",a),Object.entries(a).forEach(([f,v])=>{const h=o.find(E=>E.vehicle_id===f);h?s(v,h,`other-${f}`):console.warn(`Vehicle not found for trail data: ${f}`)})}function _(f,v,h,E,A,T=[1]){c.getLayer(v)?(c.setPaintProperty(v,"line-color",h),c.setPaintProperty(v,"line-width",E),c.setPaintProperty(v,"line-opacity",A),c.setPaintProperty(v,"line-dasharray",T)):c.addLayer({type:"line",source:f,id:v,layout:{visibility:"visible"},paint:{"line-color":h,"line-width":E,"line-opacity":A,"line-dasharray":T}})}function g(f,v,h){const E=`${f}-circles`,A=Em(v);P(E,A),c.getLayer(`${f}-circles`)||c.addLayer({id:`${f}-circles`,type:"circle",source:E,paint:{"circle-color":h.vehicle_marker.color,"circle-radius":k.circle.radius,"circle-opacity":k.circle.opacity}})}function y(f,v,h){const E=[];let A=[];for(let T=0;T<f.length;T++){const I=f[T].coordinates.slice(1,-1).split(",").map(parseFloat),L=f[T].timestamp;if(A.length===0)A.push(I);else{const D=A[A.length-1],C=f[T-1].timestamp,J=os(_t(D),_t(I)),x=L-C;J<=v&&x<=h?A.push(I):(E.push({type:"Feature",geometry:{type:"LineString",coordinates:A},properties:{timestamp:f[T-1].timestamp}}),A=[I])}}return A.length>0&&E.push({type:"Feature",geometry:{type:"LineString",coordinates:A},properties:{timestamp:f[f.length-1].timestamp}}),E}function s(f,v,h){const E=b[h],A=1,T=60*60*1e3;if(E){const L=[...E.features.flatMap(C=>C.geometry.coordinates.map((J,x)=>({coordinates:`(${J[0]},${J[1]})`,timestamp:C.properties.timestamp}))),...f],D=y(L,A,T);b[h].features=D}else{const L=y(f,A,T);b[h]={type:"FeatureCollection",features:L};const D=`${h}-line`,C=`${h}-line-background`;P(D,b[h]),_(D,C,v.vehicle_marker.color,k.solidLine.width,k.solidLine.opacity,k.solidLine.dashArray)}const I=`${h}-line`;P(I,b[h]),b[h].features.forEach((L,D)=>{const C=`${h}-trail-${D}-line`,J=`${h}-trail-${D}`;P(C,{type:"FeatureCollection",features:[L]}),_(C,J,v.vehicle_marker.color,k.dashedLine.width,k.dashedLine.opacity,k.dashedLine.dashArray),d(J);const x=h.split("-")[1];m[x]={sourceId:h,trailId:J}}),g(h,b[h].features,v)}function d(f){const v=[[0,4,3],[.5,4,2.5],[1,4,2],[1.5,4,1.5],[2,4,1],[2.5,4,.5],[3,4,0],[0,.5,3,3.5],[0,1,3,3],[0,1.5,3,2.5],[0,2,3,2],[0,2.5,3,1.5],[0,3,3,1],[0,3.5,3,.5]];let h=0;function E(A){try{const T=parseInt(A/40%v.length);T!==h&&c&&c.getLayer(f)&&(c.setPaintProperty(f,"line-dasharray",v[h]),h=T),S[f]=requestAnimationFrame(E)}catch{cancelAnimationFrame(S[f]),delete S[f]}}E(0)}function w(){Object.values(S).forEach(cancelAnimationFrame),S={}}function u(){n.allTrails?Object.keys(b).forEach(f=>{b[f].features.forEach((v,h)=>{const E=`${f}-trail-${h}`;c.setLayoutProperty(E,"visibility","visible"),d(E)})}):n.noTrails?Object.keys(b).forEach(f=>{b[f].features.forEach((v,h)=>{const E=`${f}-trail-${h}`;c.setLayoutProperty(E,"visibility","none")})}):n.latestTrail?Object.keys(b).forEach(f=>{var E;const v=f.split("-")[1],h=(E=m[v])==null?void 0:E.trailId;b[f].features.forEach((A,T)=>{const I=`${f}-trail-${T}`,L=I===h,D=L?"visible":"none";c.setLayoutProperty(I,"visibility",D),L&&d(I)})}):n.userLatestTrail&&Object.keys(b).forEach(f=>{var A;const v=f.split("-")[1],h=(A=m[v])==null?void 0:A.trailId,E=f.startsWith("user-");b[f].features.forEach((T,I)=>{const L=`${f}-trail-${I}`,D=L===h,C=E&&D?"visible":"none";c.setLayoutProperty(L,"visibility",C),E&&D&&d(L)})}),Object.keys(b).forEach(f=>{b[f].features.forEach((v,h)=>{const E=`${f}-trail-${h}`;c.getLayoutProperty(E,"visibility")})})}return t.$$set=f=>{"map"in f&&r(0,c=f.map)},[c]}class Am extends ge{constructor(e){super(),ve(this,e,$m,null,de,{map:0})}}const Pm=1e4;function Ot(t,e){return t.reduce((r,n)=>{const o=n[e];return r[o]||(r[o]=[]),r[o].push(n),r},{})}function Tm(t,e,r){let n;Q(t,nr,g=>r(6,n=g));let o,{db:a}=e,i,l,c,p=null;Me(async()=>{console.log("Initializing TrailStateSynchronizer");const g=n.data.session;if(!g){console.error("User not authenticated");return}i=g.user.id;const{data:y,error:s}=await X.from("profiles").select("master_map_id").eq("id",i).single();if(s){console.error("Error retrieving user profile:",s);return}l=y.master_map_id,await k(),o=Nr.subscribe(async w=>{w.length>0&&await m(w)}),(await a.TrailData.filter(w=>w.synced===!1).toArray()).length>0?(console.log("Unsynced data found on mount. Starting sync scheduler."),b()):console.log("No unsynced data found on mount."),c=X.channel("trail_data_changes").on("postgres_changes",{event:"*",schema:"public",table:"trail_data",filter:`master_map_id=eq.${l}`},w=>{if(w.new.vehicle_id!==i){const{vehicle_id:u,coordinates:f,timestamp:v}=w.new;jr.update(h=>(h[u]||(h[u]=[]),h[u].push({coordinates:f,timestamp:v}),h))}}).subscribe()}),Ce(()=>{o&&o(),p&&(console.log("Clearing sync interval on component destroy."),clearInterval(p)),c&&X.removeChannel(c)});function b(){p||(console.log("Starting sync scheduler."),p=setInterval(_,Pm))}async function m(g){try{const y=n.data.session;if(!y){console.error("User not authenticated");return}const s=y.user.id,{data:d,error:w}=await X.from("profiles").select("master_map_id").eq("id",s).single();if(w){console.error("Error retrieving user profile:",w);return}const u=g.map(h=>({...h,id:`${s}_${h.timestamp}`,timestamp:new Date(h.timestamp).getTime(),vehicle_id:s,coordinates:`(${h.coordinates.longitude},${h.coordinates.latitude})`,master_map_id:l})),{data:f,error:v}=await X.from("trail_data").insert(u).select("*");v?(console.error("Error inserting markers into Supabase:",v),await S(u,!1),console.log("Unsynced data added. Starting sync scheduler."),b()):(console.log("Markers inserted into Supabase:",f),await S(u,!0)),Br.update(h=>(h[s]||(h[s]=[]),console.log("Adding markers to userTrailStore:",u),h[s].push(...u),h)),Fr.update(h=>(h[s]||(h[s]=[]),console.log("Adding markers to newUserTrail:",u),h[s].push(...u),h)),Nr.set([])}catch(y){console.error("Error processing unsaved markers:",y)}}async function S(g,y){try{const s=g.map(d=>({...d,synced:y}));console.log(`Saving markers to IndexedDB with synced set to ${y}:`,s),await a.TrailData.bulkPut(s)}catch(s){console.error("Error storing markers in IndexedDB:",s)}}async function k(){let g={},y={};if(navigator.onLine){const{user:s,other:d}=await $();g=s,y=d}if(Object.keys(g).length===0&&Object.keys(y).length===0){const{user:s,other:d}=await P();g=s,y=d,console.log("Trail data loaded from IndexedDB")}Br.set(g),Wa.set(y),qa.set(!0)}async function P(){try{const g=Date.now()-6048e5,s=(await a.TrailData.where("timestamp").above(g).and(u=>u.master_map_id===l).toArray()).sort((u,f)=>u.timestamp-f.timestamp),d=Ot(s.filter(u=>u.vehicle_id===i),"vehicle_id"),w=Ot(s.filter(u=>u.vehicle_id!==i),"vehicle_id");return{user:d,other:w}}catch(g){return console.error("Error loading trail data from IndexedDB:",g),{user:{},other:{}}}}async function $(){try{const g=Date.now()-6048e5,{data:y,error:s}=await X.from("trail_data").select("*").eq("master_map_id",l).eq("vehicle_id",i).gte("timestamp",g).order("timestamp",{ascending:!0});if(s)throw s;const{data:d,error:w}=await X.from("trail_data").select("*").eq("master_map_id",l).neq("vehicle_id",i).gte("timestamp",g).order("timestamp",{ascending:!0});if(w)throw w;const u=Ot(y,"vehicle_id"),f=Ot(d,"vehicle_id");return{user:u,other:f}}catch(g){return console.error("Error loading trail data from Supabase:",g),{user:{},other:{}}}}async function _(){try{console.log("Syncing unsynced data with server");const g=await a.TrailData.filter(u=>u.synced===!1).toArray();if(g.length===0){console.log("No unsynced data found in IndexedDB. Stopping sync scheduler."),clearInterval(p),p=null;return}console.log("Unsynced data found:",g);const y=g.map(u=>({id:u.id,vehicle_id:u.vehicle_id,timestamp:new Date(u.timestamp).getTime(),coordinates:u.coordinates,master_map_id:u.master_map_id}));console.log("Sending unsynced data to Supabase:",y);const{data:s,error:d}=await X.from("trail_data").upsert(y);if(d)throw console.error("Error inserting data into Supabase:",d),d;console.log("Data synced with server:",s);const w=g.map(u=>({...u,synced:!0}));await a.TrailData.bulkPut(w),console.log("Synced flag updated in IndexedDB")}catch(g){console.error("Error syncing unsynced data with server:",g)}}return t.$$set=g=>{"db"in g&&r(0,a=g.db)},[a]}class Mm extends ge{constructor(e){super(),ve(this,e,Tm,null,de,{db:0})}}function xa(t){let e,r,n,o,a,i,l,c,p,b,m,S,k,P,$;e=new Va({}),e.$on("toggleMapStyleDispatcher",t[12]),n=new Ps({props:{markerPlacementEvent:t[6],markerClickEvent:t[7]}}),a=new vl({});let _={map:t[3]};l=new Ns({props:_}),t[13](l),l.$on("markerPlacement",t[10]),l.$on("markerClick",t[11]),p=new Il({}),m=new Ol({props:{map:t[3]}});let g=t[8]&&Ba(t),y=t[9]&&Fa(t);return{c(){ne(e.$$.fragment),r=ee(),ne(n.$$.fragment),o=ee(),ne(a.$$.fragment),i=ee(),ne(l.$$.fragment),c=ee(),ne(p.$$.fragment),b=ee(),ne(m.$$.fragment),S=ee(),g&&g.c(),k=ee(),y&&y.c(),P=pe()},l(s){fe(e.$$.fragment,s),r=te(s),fe(n.$$.fragment,s),o=te(s),fe(a.$$.fragment,s),i=te(s),fe(l.$$.fragment,s),c=te(s),fe(p.$$.fragment,s),b=te(s),fe(m.$$.fragment,s),S=te(s),g&&g.l(s),k=te(s),y&&y.l(s),P=pe()},m(s,d){oe(e,s,d),G(s,r,d),oe(n,s,d),G(s,o,d),oe(a,s,d),G(s,i,d),oe(l,s,d),G(s,c,d),oe(p,s,d),G(s,b,d),oe(m,s,d),G(s,S,d),g&&g.m(s,d),G(s,k,d),y&&y.m(s,d),G(s,P,d),$=!0},p(s,d){const w={};d&64&&(w.markerPlacementEvent=s[6]),d&128&&(w.markerClickEvent=s[7]),n.$set(w);const u={};d&8&&(u.map=s[3]),l.$set(u);const f={};d&8&&(f.map=s[3]),m.$set(f),s[8]?g?(g.p(s,d),d&256&&j(g,1)):(g=Ba(s),g.c(),j(g,1),g.m(k.parentNode,k)):g&&(_e(),N(g,1,1,()=>{g=null}),ke()),s[9]?y?(y.p(s,d),d&512&&j(y,1)):(y=Fa(s),y.c(),j(y,1),y.m(P.parentNode,P)):y&&(_e(),N(y,1,1,()=>{y=null}),ke())},i(s){$||(j(e.$$.fragment,s),j(n.$$.fragment,s),j(a.$$.fragment,s),j(l.$$.fragment,s),j(p.$$.fragment,s),j(m.$$.fragment,s),j(g),j(y),$=!0)},o(s){N(e.$$.fragment,s),N(n.$$.fragment,s),N(a.$$.fragment,s),N(l.$$.fragment,s),N(p.$$.fragment,s),N(m.$$.fragment,s),N(g),N(y),$=!1},d(s){s&&(M(r),M(o),M(i),M(c),M(b),M(S),M(k),M(P)),ae(e,s),ae(n,s),ae(a,s),t[13](null),ae(l,s),ae(p,s),ae(m,s),g&&g.d(s),y&&y.d(s)}}}function Ba(t){let e,r;return e=new Mm({props:{db:t[0]}}),{c(){ne(e.$$.fragment)},l(n){fe(e.$$.fragment,n)},m(n,o){oe(e,n,o),r=!0},p(n,o){const a={};o&1&&(a.db=n[0]),e.$set(a)},i(n){r||(j(e.$$.fragment,n),r=!0)},o(n){N(e.$$.fragment,n),r=!1},d(n){ae(e,n)}}}function Fa(t){let e=t[1],r,n,o=ja(t);return{c(){o.c(),r=pe()},l(a){o.l(a),r=pe()},m(a,i){o.m(a,i),G(a,r,i),n=!0},p(a,i){i&2&&de(e,e=a[1])?(_e(),N(o,1,1,H),ke(),o=ja(a),o.c(),j(o,1),o.m(r.parentNode,r)):o.p(a,i)},i(a){n||(j(o),n=!0)},o(a){N(o),n=!1},d(a){a&&M(r),o.d(a)}}}function ja(t){let e,r;return e=new Am({props:{map:t[3]}}),{c(){ne(e.$$.fragment)},l(n){fe(e.$$.fragment,n)},m(n,o){oe(e,n,o),r=!0},p(n,o){const a={};o&8&&(a.map=n[3]),e.$set(a)},i(n){r||(j(e.$$.fragment,n),r=!0)},o(n){N(e.$$.fragment,n),r=!1},d(n){ae(e,n)}}}function Om(t){let e,r,n=t[5]&&xa(t);return{c(){e=Y("div"),n&&n.c(),this.h()},l(o){e=K(o,"DIV",{class:!0});var a=U(e);n&&n.l(a),a.forEach(M),this.h()},h(){O(e,"class","map-container svelte-1s99y2r")},m(o,a){G(o,e,a),n&&n.m(e,null),t[14](e),r=!0},p(o,[a]){o[5]?n?(n.p(o,a),a&32&&j(n,1)):(n=xa(o),n.c(),j(n,1),n.m(e,null)):n&&(_e(),N(n,1,1,()=>{n=null}),ke())},i(o){r||(j(n),r=!0)},o(o){N(n),r=!1},d(o){o&&M(e),n&&n.d(),t[14](null)}}}const Lm="pk.eyJ1IjoibHVjaG9kb3JlIiwiYSI6ImNsdndpd2NvNjA5OWUybG14anc1aWJpbXMifQ.7DSbOP9x-3sTZdJ5ee4UKw",Lr="mapbox://styles/mapbox/satellite-streets-v12",Im="mapbox://styles/mapbox/outdoors-v12";function Dm(t,e,r){let n,o;Q(t,za,d=>r(8,n=d)),Q(t,qa,d=>r(9,o=d));let a,i=!0,l=Lr,c,p,b,m=!1;hs("map",{getMap:()=>Promise.resolve(p)});const S={container:null,style:Lr,center:[90,-40],zoom:2};Me(async()=>{r(5,m=!1),Se.accessToken=Lm,S.container=c,r(3,p=new Se.Map(S)),xr.set(p),r(5,m=!0);try{await Jn.open(),r(0,a=Jn)}catch(d){console.error("Error opening IndexedDB database:",d)}}),Ce(()=>{console.log("DestroyingMap"),p&&(p.off(),p.remove(),r(3,p=null),xr.set(null)),b&&b.$destroy()});let k=null,P=null;function $(d){r(6,k=d.detail)}function _(d){r(7,P=d.detail)}function g(){i?r(1,l=Im):r(1,l=Lr),p.setStyle(l),i=!i}function y(d){Hn[d?"unshift":"push"](()=>{b=d,r(4,b)})}function s(d){Hn[d?"unshift":"push"](()=>{c=d,r(2,c)})}return[a,l,c,p,b,m,k,P,n,o,$,_,g,y,s]}class Cm extends ge{constructor(e){super(),ve(this,e,Dm,Om,de,{})}}function xm(t){let e,r,n,o,a;return r=new Cm({}),o=new Va({}),o.$on("backToDashboard",t[0]),{c(){e=Y("div"),ne(r.$$.fragment),n=ee(),ne(o.$$.fragment),this.h()},l(i){e=K(i,"DIV",{class:!0});var l=U(e);fe(r.$$.fragment,l),n=te(l),fe(o.$$.fragment,l),l.forEach(M),this.h()},h(){O(e,"class","fixed top-0 left-0 w-full h-full overflow-hidden")},m(i,l){G(i,e,l),oe(r,e,null),F(e,n),oe(o,e,null),a=!0},p:H,i(i){a||(j(r.$$.fragment,i),j(o.$$.fragment,i),a=!0)},o(i){N(r.$$.fragment,i),N(o.$$.fragment,i),a=!1},d(i){i&&M(e),ae(r),ae(o)}}}function Bm(t){Na("adminSection").set("mapviewer");function r(){gs("/account")}return[r]}class Qm extends ge{constructor(e){super(),ve(this,e,Bm,xm,de,{})}}export{Qm as component};
