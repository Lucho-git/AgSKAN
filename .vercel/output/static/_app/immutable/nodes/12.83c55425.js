import{s as vt,e as D,v as zt,a as Y,c as P,b as R,w as qt,h as B,d as Q,g as st,i as h,j as gt,k as b,P as ht,x as S,n as at,y as Ot,q as Ut,Q as $t,E as mt,R as Gt,C as Yt}from"../chunks/scheduler.ccf898a6.js";import{S as ft,i as bt,b as Qt,d as Xt,m as Zt,t as Jt,a as Kt,e as te}from"../chunks/index.7272c3b3.js";import"../chunks/user.18705ff9.js";import"../chunks/supabaseClient.5a6af499.js";import"../chunks/MapViewer.svelte_svelte_type_style_lang.c398696c.js";import"../chunks/paths.d8f4387a.js";import"../chunks/SvelteToast.svelte_svelte_type_style_lang.cf71ce25.js";function ee(a){let n,s,i,r,o,v,W,w,j,G="↺",z,A,I,c,y,l="↻",p,d,L,E,V='<div class="card bg-base-100 rounded-none flex-grow overflow-y-auto border-2 border-black h-full -mb-1"><div class="card-body p-4"><div class="mb-2"><div class="flex items-center"><svg class="w-6 h-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <span class="font-bold text-sm">Time</span></div> <div id="time" class="text-sm"><div class="badge badge-outline" id="date"></div> <br/> <div class="badge badge-outline" id="hours"></div></div></div> <div class="mb-2"><div class="flex items-center"><svg class="w-6 h-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path></svg> <span class="font-bold text-sm">Crop</span></div> <div class="badge badge-outline" id="crop"></div></div> <div class="mb-2"><div class="flex items-center"><svg class="w-6 h-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"></path></svg> <span class="font-bold text-sm">Applied Rate</span></div> <div class="badge badge-outline" id="appliedRate"></div></div> <div class="mb-2"><div class="flex items-center"><svg class="w-6 h-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg> <span class="font-bold text-sm">Swath Width</span></div> <div class="badge badge-outline" id="swathWidth"></div></div> <div class="mb-2"><div class="flex items-center"><svg class="w-6 h-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg> <span class="font-bold text-sm">Heading</span></div> <div class="badge badge-outline" id="heading"></div></div> <div class="mb-2"><div class="flex items-center"><svg class="w-6 h-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg> <span class="font-bold text-sm">Target Rate</span></div> <div class="badge badge-outline" id="targetRate"></div></div> <div class="mb-2"><div class="flex items-center"><svg class="w-6 h-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4"></path></svg> <span class="font-bold text-sm">Variety</span></div> <div class="badge badge-outline" id="variety"></div></div> <div class="mb-2"><div class="flex items-center"><svg class="w-6 h-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"></path></svg> <span class="font-bold text-sm">Machine</span></div> <div class="badge badge-outline" id="machine"></div></div> <div class="mb-2"><div class="flex items-center"><svg class="w-6 h-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 18.657A8 8 0 016.343 7.343S7 9 9 10c0-2 .5-5 2.986-7C14 5 16.09 5.777 17.656 7.343A7.975 7.975 0 0120 13a7.975 7.975 0 01-2.343 5.657z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.879 16.121A3 3 0 1012.015 11L11 14H9c0 .768.293 1.536.879 2.121z"></path></svg> <span class="font-bold text-sm">Fuel</span></div> <div class="badge badge-outline" id="fuel"></div></div> <div class="mb-2"><div class="flex items-center"><svg class="w-6 h-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg> <span class="font-bold text-sm">Vehicle Speed</span></div> <div class="badge badge-outline" id="vehicleSpeed"></div></div></div></div> <div class="border-t-2 border-black"></div>',F,q;return{c(){n=D("div"),s=D("div"),i=D("div"),r=D("div"),o=D("div"),v=zt("svg"),W=Y(),w=D("div"),j=D("button"),j.textContent=G,z=Y(),A=D("button"),c=Y(),y=D("button"),y.textContent=l,p=Y(),d=D("input"),L=Y(),E=D("div"),E.innerHTML=V,this.h()},l(_){n=P(_,"DIV",{class:!0});var u=R(n);s=P(u,"DIV",{class:!0});var x=R(s);i=P(x,"DIV",{class:!0});var N=R(i);r=P(N,"DIV",{class:!0});var O=R(r);o=P(O,"DIV",{id:!0,class:!0});var T=R(o);v=qt(T,"svg",{id:!0,width:!0,height:!0}),R(v).forEach(B),T.forEach(B),O.forEach(B),W=Q(N),w=P(N,"DIV",{class:!0});var k=R(w);j=P(k,"BUTTON",{"data-svelte-h":!0}),st(j)!=="svelte-dbuqjm"&&(j.textContent=G),z=Q(k),A=P(k,"BUTTON",{class:!0,"data-state":!0}),R(A).forEach(B),c=Q(k),y=P(k,"BUTTON",{"data-svelte-h":!0}),st(y)!=="svelte-l0lyy5"&&(y.textContent=l),p=Q(k),d=P(k,"INPUT",{class:!0,type:!0,min:!0,max:!0,step:!0}),k.forEach(B),N.forEach(B),L=Q(x),E=P(x,"DIV",{class:!0,"data-svelte-h":!0}),st(E)!=="svelte-1y58c7p"&&(E.innerHTML=V),x.forEach(B),u.forEach(B),this.h()},h(){h(v,"id","animation-svg"),h(v,"width","100%"),h(v,"height","100%"),h(o,"id","animation-container"),h(o,"class","svelte-sfludt"),h(r,"class","animation-wrapper flex-grow svelte-sfludt"),h(A,"class","play-pause-restart ml-2 mr-2 svelte-sfludt"),h(A,"data-state",I=a[3].toLowerCase()),h(d,"class","ml-2"),h(d,"type","range"),h(d,"min","0"),h(d,"max","1"),h(d,"step","0.001"),h(w,"class","controls mt-4 svelte-sfludt"),h(i,"class","w-5/6 flex flex-col"),h(E,"class","hidden md:block md:w-1/6 mt-8 md:mt-0 flex flex-col relative min-w-[160px] max-w-[200px] svelte-sfludt"),h(s,"class","flex flex-row"),h(n,"class","full-width mx-auto svelte-sfludt")},m(_,u){gt(_,n,u),b(n,s),b(s,i),b(i,r),b(r,o),b(o,v),a[10](v),a[11](o),b(i,W),b(i,w),b(w,j),b(w,z),b(w,A),b(w,c),b(w,y),b(w,p),b(w,d),ht(d,a[2]),b(s,L),b(s,E),F||(q=[S(j,"click",a[9]),S(A,"click",a[7]),S(y,"click",a[8]),S(d,"change",a[12]),S(d,"input",a[12]),S(d,"input",a[4]),S(d,"mousedown",a[5]),S(d,"touchstart",a[5],{passive:!0}),S(d,"mouseup",a[6]),S(d,"touchend",a[6],{passive:!0}),S(d,"mouseleave",a[6])],F=!0)},p(_,u){u[0]&8&&I!==(I=_[3].toLowerCase())&&h(A,"data-state",I),u[0]&4&&ht(d,_[2])},i:at,o:at,d(_){_&&B(n),a[10](null),a[11](null),F=!1,Ot(q)}}}let se=.1;const ae=.1;function ne(a,n){const s=n.x-a.x,i=n.y-a.y;return Math.sqrt(s*s+i*i)}function nt(a,n){const s=a.map(o=>({x:o.geometry.coordinates[0],y:o.geometry.coordinates[1]}));if(s.length<=2)return a;let i=0,r=0;for(let o=1;o<s.length-1;o++){const v=oe(s[o],s[0],s[s.length-1]);v>i&&(r=o,i=v)}if(i>n){const o=nt(a.slice(0,r+1),n),v=nt(a.slice(r),n);return[...o.slice(0,-1),...v]}else return[a[0],a[a.length-1]]}function oe(a,n,s){const i=s.x-n.x,r=s.y-n.y,o=Math.abs(r*a.x-i*a.y+s.x*n.y-s.y*n.x),v=Math.sqrt(i*i+r*r);return o/v}function ie(a,n,s){let i=[],r=[],o=[],v=[],W=[],w=[],j=[],G=[],z=[],A=[],I,c,y,l,p=[],d=[],L,E,V,F,q,_,u=0,x,N,O={},T,k,C=[],ot=0,U=!0,$="Pause",K=[],X=0,Z=1;Ut(async()=>{gsap.registerPlugin(MotionPathPlugin),await wt(),await yt();const t=nt(p,5e-6);console.log(`Original data points: ${p.length}`),console.log(`Simplified data points: ${t.length}`),p=t,i=p.map(e=>e.properties.Time),r=p.map(e=>e.properties.Crop),o=p.map(e=>e.properties.AppliedRate),v=p.map(e=>e.properties.SWATHWIDTH),W=p.map(e=>e.properties.Heading),w=p.map(e=>e.properties.TargetRate),j=p.map(e=>e.properties.Variety),G=p.map(e=>e.properties.Machine),z=p.map(e=>e.properties.FUEL),A=p.map(e=>e.properties.VEHICLSPEED),Mt(),y=Et(),C=St(),kt(),_t(),Ct(),xt(),dt(),console.log("About to draw paddock boundary"),Bt(),console.log("Drawn paddock boundary"),lt(),I.addEventListener("wheel",it),addEventListener("animationprogress",e=>{s(2,u=e.detail)})}),$t(()=>{I.removeEventListener("wheel",it),removeEventListener("animationprogress",t=>{s(2,u=t.detail)}),l&&(l.clear(),s(2,u=0)),s(1,c.innerHTML="",c)});async function wt(){p=(await(await fetch("/data/supershedseeding.geojson")).json()).features}async function yt(){d=(await(await fetch("/data/supershedboundary.geojson")).json()).features[0].geometry.coordinates[0][0],console.log(d)}function it(t){t.preventDefault();const e=t.deltaY<0?1:-1;Z+=e*ae,Z=Math.max(.5,Math.min(Z,2)),s(1,c.style.transform=`scale(${Z})`,c)}function xt(){K=[],X=0;for(let t=1;t<C.length;t++){const e=C[t-1],g=C[t],f=ne(e,g);K.push(f),X+=f}X*=se}function kt(){x=document.createElementNS("http://www.w3.org/2000/svg","path"),x.setAttribute("fill","none"),x.setAttribute("stroke","transparent"),x.setAttribute("stroke-width",y),x.setAttribute("d",`M${C.map(t=>`${t.x},${t.y}`).join("L")}`),c.appendChild(x),N={path:x,autoRotate:!0,align:x,alignOrigin:[.5,.5],start:0,end:1}}function _t(){const t=["red","green","orange","purple","cyan","magenta","teal","brown","lime"];p.forEach((e,g)=>{const f=e.properties&&e.properties.SECTIONID;f&&!O[f]&&(O[f]=t.length>0?t[ot%t.length]:`hsl(${Math.random()*360}, 50%, 50%)`,ot++)})}function Ct(){T=document.createElementNS("http://www.w3.org/2000/svg","image"),T.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","/images/tractor.svg"),T.setAttribute("width",y*4),T.setAttribute("height",y*4),k=gsap.to(T,{motionPath:N,duration:1,ease:"linear",paused:!0})}function Mt(){L=Math.min(...d.map(t=>t[0])),E=Math.max(...d.map(t=>t[0])),V=Math.min(...d.map(t=>t[1])),F=Math.max(...d.map(t=>t[1])),q=c.clientWidth/(E-L),_=c.clientHeight/(F-V)}function Dt(){l&&(l.pause(),l.progress(u),u===1?(U=!1,s(3,$="Restart")):(U=!0,s(3,$="Pause")))}function Pt(){l&&l.pause()}function At(){l&&u!==1&&l.resume()}function Et(){const e=(E-L)*(Math.PI/180),g=(F-V)*(Math.PI/180),f=Math.sin(g/2)**2+Math.cos(V*(Math.PI/180))*Math.cos(F*(Math.PI/180))*Math.sin(e/2)**2,M=6371e3*(2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)));return 12*(c.clientWidth/M)}function St(){const t=[];for(let e=0;e<p.length;e++){const{geometry:{coordinates:[g,f]}}=p[e],m=(g-L)*q,M=c.clientHeight-(f-V)*_;t.push({x:m,y:M})}return t}function Bt(){console.log("Drawing paddock boundary");const t=document.createElementNS("http://www.w3.org/2000/svg","path"),e=d.map(g=>`${(g[0]-L)*q},${c.clientHeight-(g[1]-V)*_}`).join("L");t.setAttribute("d",`M${e}Z`),t.setAttribute("fill","none"),t.setAttribute("stroke","blue"),t.setAttribute("stroke-width",5),c.appendChild(t)}function rt(t){const e=i[t],[g,f]=e.split(" ");document.getElementById("date").textContent=g,document.getElementById("hours").textContent=f,document.getElementById("crop").textContent=r[t],document.getElementById("appliedRate").textContent=o[t],document.getElementById("swathWidth").textContent=v[t];const m=W[t];document.getElementById("heading").textContent=m.toFixed(2),document.getElementById("targetRate").textContent=w[t],document.getElementById("variety").textContent=j[t],document.getElementById("machine").textContent=G[t];const M=z[t];document.getElementById("fuel").textContent=M.toFixed(4);const H=A[t];document.getElementById("vehicleSpeed").textContent=H.toFixed(2)}let tt=0;function lt(){l=gsap.timeline({onUpdate:()=>{s(2,u=l.progress()),dispatchEvent(new CustomEvent("animationprogress",{detail:u}));const e=Math.floor(u*(C.length-1));e!==tt&&(tt=e,rt(tt))}}),s(2,u=0),l.clear();let t=0;for(let e=1;e<C.length;e++){const g=e-1,f=e,m=K[e-1]/X*10;jt(g,f,m,t),t+=m}c.appendChild(T),k.duration(t),k.restart(),l.add(k,0),l.eventCallback("onComplete",()=>{U=!1,s(3,$="Restart")})}function jt(t,e,g,f){const m=document.createElementNS("http://www.w3.org/2000/svg","path"),M=C[t],H=C[e],J={x:(M.x+H.x)/2,y:(M.y+H.y)/2},ct={x:(M.x+J.x)/2,y:(M.y+J.y)/2},pt={x:(J.x+H.x)/2,y:(J.y+H.y)/2},Ft=`M${M.x},${M.y} C${ct.x},${ct.y} ${pt.x},${pt.y} ${H.x},${H.y}`;m.setAttribute("d",Ft);const ut=p[e].properties&&p[e].properties.SECTIONID,Nt=ut?O[ut]:"black";m.setAttribute("stroke",Nt),m.setAttribute("fill","none"),m.setAttribute("stroke-width",y),m.setAttribute("stroke-linecap","round"),m.setAttribute("stroke-linejoin","round"),m.style.opacity=0,c.appendChild(m);const et=m.getTotalLength();l.fromTo(m,{strokeDasharray:et+" "+et,strokeDashoffset:et},{strokeDashoffset:0,duration:g,ease:"linear",onUpdate:()=>{const Wt=l.progress();m.style.opacity=Wt>=f/l.duration()?1:0}},f)}function dt(){const t=document.createElementNS("http://www.w3.org/2000/svg","path"),e=`M${C[0].x},${C[0].y} ${C.slice(1).map(g=>`L${g.x},${g.y}`).join(" ")}`;t.setAttribute("d",e),t.setAttribute("stroke","black"),t.setAttribute("fill","none"),t.setAttribute("stroke-width",y*.05),t.setAttribute("stroke-linecap","round"),t.setAttribute("stroke-linejoin","round"),t.setAttribute("opacity",.3),c.appendChild(t)}function It(){U?(l.pause(),s(3,$="Play")):(l.progress()===1?(s(1,c.innerHTML="",c),dt(),rt(0),lt()):l.play(),s(3,$="Pause")),U=!U}function Lt(){l.progress(l.progress()+.1)}function Vt(){l.progress(l.progress()-.1)}function Tt(t){mt[t?"unshift":"push"](()=>{c=t,s(1,c)})}function Ht(t){mt[t?"unshift":"push"](()=>{I=t,s(0,I)})}function Rt(){u=Gt(this.value),s(2,u)}return[I,c,u,$,Dt,Pt,At,It,Lt,Vt,Tt,Ht,Rt]}class re extends ft{constructor(n){super(),bt(this,n,ie,ee,vt,{},null,[-1,-1,-1])}}function le(a){let n,s,i;return s=new re({}),{c(){n=D("div"),Qt(s.$$.fragment),this.h()},l(r){n=P(r,"DIV",{class:!0});var o=R(n);Xt(s.$$.fragment,o),o.forEach(B),this.h()},h(){h(n,"class","app-container svelte-tb1q46")},m(r,o){gt(r,n,o),Zt(s,n,null),i=!0},p:at,i(r){i||(Jt(s.$$.fragment,r),i=!0)},o(r){Kt(s.$$.fragment,r),i=!1},d(r){r&&B(n),te(s)}}}function de(a){return Yt("adminSection").set("pathplanner"),[]}class fe extends ft{constructor(n){super(),bt(this,n,de,le,vt,{})}}export{fe as component};
