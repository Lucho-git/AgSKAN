import{w as Hi}from"./index.BnUP_WGm.js";import{b as Sc,g as Ic}from"./index.B9zg-xLz.js";import{_ as Mf}from"./preload-helper.BQ24v_F8.js";function zf(Zr,Nr){for(var tr=0;tr<Nr.length;tr++){const mt=Nr[tr];if(typeof mt!="string"&&!Array.isArray(mt)){for(const lr in mt)if(lr!=="default"&&!(lr in Zr)){const Cr=Object.getOwnPropertyDescriptor(mt,lr);Cr&&Object.defineProperty(Zr,lr,Cr.get?Cr:{enumerable:!0,get:()=>mt[lr]})}}}return Object.freeze(Object.defineProperty(Zr,Symbol.toStringTag,{value:"Module"}))}function Df(){const{subscribe:Zr,set:Nr,update:tr}=Hi(null);return{subscribe:Zr,set:Nr,update:tr,reset:()=>Nr(null),setEndTime:mt=>tr(lr=>lr?{...lr,endTime:mt}:null),addCoordinate:mt=>tr(lr=>lr&&{...lr,path:[...lr.path,mt]})}}function Lf(){const{subscribe:Zr,set:Nr,update:tr}=Hi([]);return{subscribe:Zr,set:Nr,update:tr,add:mt=>tr(lr=>[...lr,mt]),clear:()=>Nr([])}}function Of(){const{subscribe:Zr,set:Nr,update:tr}=Hi([]);return{subscribe:Zr,set:Nr,update:tr,add:mt=>tr(lr=>[...lr,mt]),remove:mt=>tr(lr=>lr.filter(Cr=>!mt.some(l=>l.timestamp===Cr.timestamp))),clear:()=>Nr([])}}function Rf(){const{subscribe:Zr,set:Nr,update:tr}=Hi([]);return{subscribe:Zr,set:Nr,update:tr,add:mt=>tr(lr=>[...lr,mt]),remove:mt=>tr(lr=>lr.filter(Cr=>Cr.trail_id!==mt.trail_id)),clear:()=>Nr([])}}const Jf=Df(),Yf=Lf(),$f=Of(),Qf=Rf();var Wp={exports:{}};(function(Zr,Nr){(function(tr,mt){Zr.exports=mt()})(Sc,function(){var tr,mt,lr;function Cr(l,ur){if(!tr)tr=ur;else if(!mt)mt=ur;else{var Oe="var sharedChunk = {}; ("+tr+")(sharedChunk); ("+mt+")(sharedChunk);",Ur={};tr(Ur),lr=ur(Ur),typeof window<"u"&&(lr.workerUrl=window.URL.createObjectURL(new Blob([Oe],{type:"text/javascript"})))}}return Cr(["exports"],function(l){function ur(e,t){return e(t={exports:{}},t.exports),t.exports}var Oe=Ur;function Ur(e,t,r,a){this.cx=3*e,this.bx=3*(r-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(a-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=a,this.p2x=r,this.p2y=a}Ur.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e},Ur.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e},Ur.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},Ur.prototype.solveCurveX=function(e,t){var r,a,u,c,f;for(t===void 0&&(t=1e-6),u=e,f=0;f<8;f++){if(c=this.sampleCurveX(u)-e,Math.abs(c)<t)return u;var y=this.sampleCurveDerivativeX(u);if(Math.abs(y)<1e-6)break;u-=c/y}if((u=e)<(r=0))return r;if(u>(a=1))return a;for(;r<a;){if(c=this.sampleCurveX(u),Math.abs(c-e)<t)return u;e>c?r=u:a=u,u=.5*(a-r)+r}return u},Ur.prototype.solve=function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))};var Rt=Gr;function Gr(e,t){this.x=e,this.y=t}Gr.prototype={clone:function(){return new Gr(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,r=e.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),r=Math.sin(e),a=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=a,this},_rotateAround:function(e,t){var r=Math.cos(e),a=Math.sin(e),u=t.y+a*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-a*(this.y-t.y),this.y=u,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Gr.convert=function(e){return e instanceof Gr?e:Array.isArray(e)?new Gr(e[0],e[1]):e};var Xe=typeof self<"u"?self:{},Nn=Math.pow(2,53)-1;function nr(e,t,r,a){var u=new Oe(e,t,r,a);return function(c){return u.solve(c)}}var Or=nr(.25,.1,.25,1);function _t(e,t,r){return Math.min(r,Math.max(t,e))}function or(e,t,r){var a=r-t,u=((e-t)%a+a)%a+t;return u===t?r:u}function dr(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];for(var a=0,u=t;a<u.length;a+=1){var c=u[a];for(var f in c)e[f]=c[f]}return e}var Ji=1;function Rr(){return Ji++}function Vr(){return function e(t){return t?(t^16*Math.random()>>t/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function Un(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function Qr(e,t){e.forEach(function(r){t[r]&&(t[r]=t[r].bind(t))})}function zi(e,t){return e.indexOf(t,e.length-t.length)!==-1}function bn(e,t,r){var a={};for(var u in e)a[u]=t.call(r||this,e[u],u,e);return a}function vi(e,t,r){var a={};for(var u in e)t.call(r||this,e[u],u,e)&&(a[u]=e[u]);return a}function si(e){return Array.isArray(e)?e.map(si):typeof e=="object"&&e?bn(e,si):e}var _i={};function Sr(e){_i[e]||(typeof console<"u"&&console.warn(e),_i[e]=!0)}function Br(e,t,r){return(r.y-e.y)*(t.x-e.x)>(t.y-e.y)*(r.x-e.x)}function Bo(e){for(var t=0,r=0,a=e.length,u=a-1,c=void 0,f=void 0;r<a;u=r++)t+=((f=e[u]).x-(c=e[r]).x)*(c.y+f.y);return t}function yn(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function vo(e){var t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(a,u,c,f){var y=c||f;return t[u]=!y||y.toLowerCase(),""}),t["max-age"]){var r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t}var Vn=null;function xi(e){if(Vn==null){var t=e.navigator?e.navigator.userAgent:null;Vn=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return Vn}function Mn(e){try{var t=Xe[e];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch{return!1}}var $n,Di,Wn,no,bi=Xe.performance&&Xe.performance.now?Xe.performance.now.bind(Xe.performance):Date.now.bind(Date),Li=Xe.requestAnimationFrame||Xe.mozRequestAnimationFrame||Xe.webkitRequestAnimationFrame||Xe.msRequestAnimationFrame,gn=Xe.cancelAnimationFrame||Xe.mozCancelAnimationFrame||Xe.webkitCancelAnimationFrame||Xe.msCancelAnimationFrame,wi={now:bi,frame:function(e){var t=Li(e);return{cancel:function(){return gn(t)}}},getImageData:function(e,t){t===void 0&&(t=0);var r=Xe.document.createElement("canvas"),a=r.getContext("2d");if(!a)throw new Error("failed to create canvas 2d context");return r.width=e.width,r.height=e.height,a.drawImage(e,0,0,e.width,e.height),a.getImageData(-t,-t,e.width+2*t,e.height+2*t)},resolveURL:function(e){return $n||($n=Xe.document.createElement("a")),$n.href=e,$n.href},hardwareConcurrency:Xe.navigator&&Xe.navigator.hardwareConcurrency||4,get devicePixelRatio(){return Xe.devicePixelRatio},get prefersReducedMotion(){return!!Xe.matchMedia&&(Di==null&&(Di=Xe.matchMedia("(prefers-reduced-motion: reduce)")),Di.matches)}},Ke={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},wn={supported:!1,testSupport:function(e){!En&&no&&(qt?Wt(e):Wn=e)}},En=!1,qt=!1;function Wt(e){var t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,no),e.isContextLost())return;wn.supported=!0}catch{}e.deleteTexture(t),En=!0}Xe.document&&((no=Xe.document.createElement("img")).onload=function(){Wn&&Wt(Wn),Wn=null,qt=!0},no.onerror=function(){En=!0,Wn=null},no.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var Ei="01",gr=function(e,t){this._transformRequestFn=e,this._customAccessToken=t,this._createSkuToken()};function jt(e){return e.indexOf("mapbox:")===0}gr.prototype._createSkuToken=function(){var e=function(){for(var t="",r=0;r<10;r++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ei,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt},gr.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},gr.prototype.transformRequest=function(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}},gr.prototype.normalizeStyleURL=function(e,t){if(!jt(e))return e;var r=vn(e);return r.path="/styles/v1"+r.path,this._makeAPIURL(r,this._customAccessToken||t)},gr.prototype.normalizeGlyphsURL=function(e,t){if(!jt(e))return e;var r=vn(e);return r.path="/fonts/v1"+r.path,this._makeAPIURL(r,this._customAccessToken||t)},gr.prototype.normalizeSourceURL=function(e,t){if(!jt(e))return e;var r=vn(e);return r.path="/v4/"+r.authority+".json",r.params.push("secure"),this._makeAPIURL(r,this._customAccessToken||t)},gr.prototype.normalizeSpriteURL=function(e,t,r,a){var u=vn(e);return jt(e)?(u.path="/styles/v1"+u.path+"/sprite"+t+r,this._makeAPIURL(u,this._customAccessToken||a)):(u.path+=""+t+r,zn(u))},gr.prototype.normalizeTileURL=function(e,t){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!jt(e))return e;var r=vn(e);r.path=r.path.replace(/(\.(png|jpg)\d*)(?=$)/,(wi.devicePixelRatio>=2||t===512?"@2x":"")+(wn.supported?".webp":"$1")),r.path=r.path.replace(/^.+\/v4\//,"/"),r.path="/v4"+r.path;var a=this._customAccessToken||function(u){for(var c=0,f=u;c<f.length;c+=1){var y=f[c].match(/^access_token=(.*)$/);if(y)return y[1]}return null}(r.params)||Ke.ACCESS_TOKEN;return Ke.REQUIRE_ACCESS_TOKEN&&a&&this._skuToken&&r.params.push("sku="+this._skuToken),this._makeAPIURL(r,a)},gr.prototype.canonicalizeTileURL=function(e,t){var r=vn(e);if(!r.path.match(/(^\/v4\/)/)||!r.path.match(/\.[\w]+$/))return e;var a="mapbox://tiles/";a+=r.path.replace("/v4/","");var u=r.params;return t&&(u=u.filter(function(c){return!c.match(/^access_token=/)})),u.length&&(a+="?"+u.join("&")),a},gr.prototype.canonicalizeTileset=function(e,t){for(var r=!!t&&jt(t),a=[],u=0,c=e.tiles||[];u<c.length;u+=1){var f=c[u];Si(f)?a.push(this.canonicalizeTileURL(f,r)):a.push(f)}return a},gr.prototype._makeAPIURL=function(e,t){var r="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",a=vn(Ke.API_URL);if(e.protocol=a.protocol,e.authority=a.authority,e.protocol==="http"){var u=e.params.indexOf("secure");u>=0&&e.params.splice(u,1)}if(a.path!=="/"&&(e.path=""+a.path+e.path),!Ke.REQUIRE_ACCESS_TOKEN)return zn(e);if(!(t=t||Ke.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+r);if(t[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+r);return e.params=e.params.filter(function(c){return c.indexOf("access_token")===-1}),e.params.push("access_token="+t),zn(e)};var oa=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function Si(e){return oa.test(e)}var Jo=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function vn(e){var t=e.match(Jo);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function zn(e){var t=e.params.length?"?"+e.params.join("&"):"";return e.protocol+"://"+e.authority+e.path+t}function br(e){if(!e)return null;var t=e.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(decodeURIComponent(Xe.atob(t[1]).split("").map(function(r){return"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch{return null}}var Sn=function(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};Sn.prototype.getStorageKey=function(e){var t,r=br(Ke.ACCESS_TOKEN);return t=r&&r.u?Xe.btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,function(a,u){return String.fromCharCode(+("0x"+u))})):Ke.ACCESS_TOKEN||"",e?"mapbox.eventData."+e+":"+t:"mapbox.eventData:"+t},Sn.prototype.fetchEventData=function(){var e=Mn("localStorage"),t=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{var a=Xe.localStorage.getItem(t);a&&(this.eventData=JSON.parse(a));var u=Xe.localStorage.getItem(r);u&&(this.anonId=u)}catch{Sr("Unable to read from LocalStorage")}},Sn.prototype.saveEventData=function(){var e=Mn("localStorage"),t=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{Xe.localStorage.setItem(r,this.anonId),Object.keys(this.eventData).length>=1&&Xe.localStorage.setItem(t,JSON.stringify(this.eventData))}catch{Sr("Unable to write to LocalStorage")}},Sn.prototype.processRequests=function(e){},Sn.prototype.postEvent=function(e,t,r,a){var u=this;if(Ke.EVENTS_URL){var c=vn(Ke.EVENTS_URL);c.params.push("access_token="+(a||Ke.ACCESS_TOKEN||""));var f={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.3",skuId:Ei,userId:this.anonId},y=t?dr(f,t):f,x={url:zn(c),headers:{"Content-Type":"text/plain"},body:JSON.stringify([y])};this.pendingRequest=Ar(x,function(w){u.pendingRequest=null,r(w),u.saveEventData(),u.processRequests(a)})}},Sn.prototype.queueRequest=function(e,t){this.queue.push(e),this.processRequests(t)};var Qn,Ti,un=function(e){function t(){e.call(this,"map.load"),this.success={},this.skuToken=""}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.postMapLoadEvent=function(r,a,u,c){this.skuToken=u;var f=!(!c&&!Ke.ACCESS_TOKEN),y=Array.isArray(r)&&r.some(function(x){return jt(x)||Si(x)});Ke.EVENTS_URL&&f&&y&&this.queueRequest({id:a,timestamp:Date.now()},c)},t.prototype.processRequests=function(r){var a=this;if(!this.pendingRequest&&this.queue.length!==0){var u=this.queue.shift(),c=u.id,f=u.timestamp;c&&this.success[c]||(this.anonId||this.fetchEventData(),Un(this.anonId)||(this.anonId=Vr()),this.postEvent(f,{skuToken:this.skuToken},function(y){y||c&&(a.success[c]=!0)},r))}},t}(Sn),Hn=new(function(e){function t(r){e.call(this,"appUserTurnstile"),this._customAccessToken=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.postTurnstileEvent=function(r,a){Ke.EVENTS_URL&&Ke.ACCESS_TOKEN&&Array.isArray(r)&&r.some(function(u){return jt(u)||Si(u)})&&this.queueRequest(Date.now(),a)},t.prototype.processRequests=function(r){var a=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var u=br(Ke.ACCESS_TOKEN),c=u?u.u:Ke.ACCESS_TOKEN,f=c!==this.eventData.tokenU;Un(this.anonId)||(this.anonId=Vr(),f=!0);var y=this.queue.shift();if(this.eventData.lastSuccess){var x=new Date(this.eventData.lastSuccess),w=new Date(y),I=(y-this.eventData.lastSuccess)/864e5;f=f||I>=1||I<-1||x.getDate()!==w.getDate()}else f=!0;if(!f)return this.processRequests();this.postEvent(y,{"enabled.telemetry":!1},function(A){A||(a.eventData.lastSuccess=y,a.eventData.tokenU=c)},r)}},t}(Sn)),_o=Hn.postTurnstileEvent.bind(Hn),Oi=new un,Ri=Oi.postMapLoadEvent.bind(Oi),Bi=500,Dn=50;function Ii(){Xe.caches&&!Qn&&(Qn=Xe.caches.open("mapbox-tiles"))}function Fi(e){var t=e.indexOf("?");return t<0?e:e.slice(0,t)}var Ln,bt=1/0;function ui(){return Ln==null&&(Ln=Xe.OffscreenCanvas&&new Xe.OffscreenCanvas(1,1).getContext("2d")&&typeof Xe.createImageBitmap=="function"),Ln}var ei={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(ei);var Ni=function(e){function t(r,a,u){a===401&&Si(u)&&(r+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),e.call(this,r),this.status=a,this.url=u,this.name=this.constructor.name,this.message=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},t}(Error),pt=yn()?function(){return self.worker&&self.worker.referrer}:function(){return(Xe.location.protocol==="blob:"?Xe.parent:Xe).location.href},_n,li,ti=function(e,t){if(!(/^file:/.test(r=e.url)||/^file:/.test(pt())&&!/^\w+:/.test(r))){if(Xe.fetch&&Xe.Request&&Xe.AbortController&&Xe.Request.prototype.hasOwnProperty("signal"))return function(a,u){var c,f=new Xe.AbortController,y=new Xe.Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:pt(),signal:f.signal}),x=!1,w=!1,I=(c=y.url).indexOf("sku=")>0&&Si(c);a.type==="json"&&y.headers.set("Accept","application/json");var A=function(O,Z,X){if(!w){if(O&&O.message!=="SecurityError"&&Sr(O),Z&&X)return z(Z);var re=Date.now();Xe.fetch(y).then(function(Y){if(Y.ok){var ce=I?Y.clone():null;return z(Y,ce,re)}return u(new Ni(Y.statusText,Y.status,a.url))}).catch(function(Y){Y.code!==20&&u(new Error(Y.message))})}},z=function(O,Z,X){(a.type==="arrayBuffer"?O.arrayBuffer():a.type==="json"?O.json():O.text()).then(function(re){w||(Z&&X&&function(Y,ce,ve){if(Ii(),Qn){var xe={status:ce.status,statusText:ce.statusText,headers:new Xe.Headers};ce.headers.forEach(function(Me,Ue){return xe.headers.set(Ue,Me)});var Te=vo(ce.headers.get("Cache-Control")||"");Te["no-store"]||(Te["max-age"]&&xe.headers.set("Expires",new Date(ve+1e3*Te["max-age"]).toUTCString()),new Date(xe.headers.get("Expires")).getTime()-ve<42e4||function(Me,Ue){if(Ti===void 0)try{new Response(new ReadableStream),Ti=!0}catch{Ti=!1}Ti?Ue(Me.body):Me.blob().then(Ue)}(ce,function(Me){var Ue=new Xe.Response(Me,xe);Ii(),Qn&&Qn.then(function(Je){return Je.put(Fi(Y.url),Ue)}).catch(function(Je){return Sr(Je.message)})}))}}(y,Z,X),x=!0,u(null,re,O.headers.get("Cache-Control"),O.headers.get("Expires")))}).catch(function(re){w||u(new Error(re.message))})};return I?function(O,Z){if(Ii(),!Qn)return Z(null);var X=Fi(O.url);Qn.then(function(re){re.match(X).then(function(Y){var ce=function(ve){if(!ve)return!1;var xe=new Date(ve.headers.get("Expires")||0),Te=vo(ve.headers.get("Cache-Control")||"");return xe>Date.now()&&!Te["no-cache"]}(Y);re.delete(X),ce&&re.put(X,Y.clone()),Z(null,Y,ce)}).catch(Z)}).catch(Z)}(y,A):A(null,null),{cancel:function(){w=!0,x||f.abort()}}}(e,t);if(yn()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}var r;return function(a,u){var c=new Xe.XMLHttpRequest;for(var f in c.open(a.method||"GET",a.url,!0),a.type==="arrayBuffer"&&(c.responseType="arraybuffer"),a.headers)c.setRequestHeader(f,a.headers[f]);return a.type==="json"&&(c.responseType="text",c.setRequestHeader("Accept","application/json")),c.withCredentials=a.credentials==="include",c.onerror=function(){u(new Error(c.statusText))},c.onload=function(){if((c.status>=200&&c.status<300||c.status===0)&&c.response!==null){var y=c.response;if(a.type==="json")try{y=JSON.parse(c.response)}catch(x){return u(x)}u(null,y,c.getResponseHeader("Cache-Control"),c.getResponseHeader("Expires"))}else u(new Ni(c.statusText,c.status,a.url))},c.send(a.body),{cancel:function(){return c.abort()}}}(e,t)},xo=function(e,t){return ti(dr(e,{type:"arrayBuffer"}),t)},Ar=function(e,t){return ti(dr(e,{method:"POST"}),t)},C="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";_n=[],li=0;var M=function(e,t){if(wn.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),li>=Ke.MAX_PARALLEL_IMAGE_REQUESTS){var r={requestParameters:e,callback:t,cancelled:!1,cancel:function(){this.cancelled=!0}};return _n.push(r),r}li++;var a=!1,u=function(){if(!a)for(a=!0,li--;_n.length&&li<Ke.MAX_PARALLEL_IMAGE_REQUESTS;){var f=_n.shift();f.cancelled||(f.cancel=M(f.requestParameters,f.callback).cancel)}},c=xo(e,function(f,y,x,w){u(),f?t(f):y&&(ui()?function(I,A){var z=new Xe.Blob([new Uint8Array(I)],{type:"image/png"});Xe.createImageBitmap(z).then(function(O){A(null,O)}).catch(function(O){A(new Error("Could not load image because of "+O.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(y,t):function(I,A,z,O){var Z=new Xe.Image,X=Xe.URL;Z.onload=function(){A(null,Z),X.revokeObjectURL(Z.src),Z.onload=null,Xe.requestAnimationFrame(function(){Z.src=C})},Z.onerror=function(){return A(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var re=new Xe.Blob([new Uint8Array(I)],{type:"image/png"});Z.cacheControl=z,Z.expires=O,Z.src=I.byteLength?X.createObjectURL(re):C}(y,t,x,w))});return{cancel:function(){c.cancel(),u()}}};function D(e,t,r){r[e]&&r[e].indexOf(t)!==-1||(r[e]=r[e]||[],r[e].push(t))}function U(e,t,r){if(r&&r[e]){var a=r[e].indexOf(t);a!==-1&&r[e].splice(a,1)}}var G=function(e,t){t===void 0&&(t={}),dr(this,t),this.type=e},ne=function(e){function t(r,a){a===void 0&&(a={}),e.call(this,"error",dr({error:r},a))}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(G),$=function(){};$.prototype.on=function(e,t){return this._listeners=this._listeners||{},D(e,t,this._listeners),this},$.prototype.off=function(e,t){return U(e,t,this._listeners),U(e,t,this._oneTimeListeners),this},$.prototype.once=function(e,t){return this._oneTimeListeners=this._oneTimeListeners||{},D(e,t,this._oneTimeListeners),this},$.prototype.fire=function(e,t){typeof e=="string"&&(e=new G(e,t||{}));var r=e.type;if(this.listens(r)){e.target=this;for(var a=0,u=this._listeners&&this._listeners[r]?this._listeners[r].slice():[];a<u.length;a+=1)u[a].call(this,e);for(var c=0,f=this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[];c<f.length;c+=1){var y=f[c];U(r,y,this._oneTimeListeners),y.call(this,e)}var x=this._eventedParent;x&&(dr(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),x.fire(e))}else e instanceof ne&&console.error(e.error);return this},$.prototype.listens=function(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)},$.prototype.setEventedParent=function(e,t){return this._eventedParent=e,this._eventedParentData=t,this};var L={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},J=function(e,t,r,a){this.message=(e?e+": ":"")+r,a&&(this.identifier=a),t!=null&&t.__line__&&(this.line=t.__line__)};function se(e){var t=e.value;return t?[new J(e.key,t,"constants have been deprecated as of v8")]:[]}function ze(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];for(var a=0,u=t;a<u.length;a+=1){var c=u[a];for(var f in c)e[f]=c[f]}return e}function Be(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function Ee(e){if(Array.isArray(e))return e.map(Ee);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){var t={};for(var r in e)t[r]=Ee(e[r]);return t}return Be(e)}var ke=function(e){function t(r,a){e.call(this,a),this.message=a,this.key=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(Error),ot=function(e,t){t===void 0&&(t=[]),this.parent=e,this.bindings={};for(var r=0,a=t;r<a.length;r+=1){var u=a[r];this.bindings[u[0]]=u[1]}};ot.prototype.concat=function(e){return new ot(this,e)},ot.prototype.get=function(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(e+" not found in scope.")},ot.prototype.has=function(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)};var We={kind:"null"},Se={kind:"number"},it={kind:"string"},je={kind:"boolean"},Ye={kind:"color"},Bt={kind:"object"},et={kind:"value"},Yt={kind:"collator"},Nt={kind:"formatted"},Ut={kind:"resolvedImage"};function Ht(e,t){return{kind:"array",itemType:e,N:t}}function rr(e){if(e.kind==="array"){var t=rr(e.itemType);return typeof e.N=="number"?"array<"+t+", "+e.N+">":e.itemType.kind==="value"?"array":"array<"+t+">"}return e.kind}var Hr=[We,Se,it,je,Ye,Nt,Bt,Ht(et),Ut];function cr(e,t){if(t.kind==="error")return null;if(e.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!cr(e.itemType,t.itemType))&&(typeof e.N!="number"||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if(e.kind==="value"){for(var r=0,a=Hr;r<a.length;r+=1)if(!cr(a[r],t))return null}}return"Expected "+rr(e)+" but found "+rr(t)+" instead."}function zr(e,t){return t.some(function(r){return r.kind===e.kind})}function vr(e,t){return t.some(function(r){return r==="null"?e===null:r==="array"?Array.isArray(e):r==="object"?e&&!Array.isArray(e)&&typeof e=="object":r===typeof e})}var Zt=ur(function(e,t){var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function a(y){return(y=Math.round(y))<0?0:y>255?255:y}function u(y){return a(y[y.length-1]==="%"?parseFloat(y)/100*255:parseInt(y))}function c(y){return(x=y[y.length-1]==="%"?parseFloat(y)/100:parseFloat(y))<0?0:x>1?1:x;var x}function f(y,x,w){return w<0?w+=1:w>1&&(w-=1),6*w<1?y+(x-y)*w*6:2*w<1?x:3*w<2?y+(x-y)*(2/3-w)*6:y}try{t.parseCSSColor=function(y){var x,w=y.replace(/ /g,"").toLowerCase();if(w in r)return r[w].slice();if(w[0]==="#")return w.length===4?(x=parseInt(w.substr(1),16))>=0&&x<=4095?[(3840&x)>>4|(3840&x)>>8,240&x|(240&x)>>4,15&x|(15&x)<<4,1]:null:w.length===7&&(x=parseInt(w.substr(1),16))>=0&&x<=16777215?[(16711680&x)>>16,(65280&x)>>8,255&x,1]:null;var I=w.indexOf("("),A=w.indexOf(")");if(I!==-1&&A+1===w.length){var z=w.substr(0,I),O=w.substr(I+1,A-(I+1)).split(","),Z=1;switch(z){case"rgba":if(O.length!==4)return null;Z=c(O.pop());case"rgb":return O.length!==3?null:[u(O[0]),u(O[1]),u(O[2]),Z];case"hsla":if(O.length!==4)return null;Z=c(O.pop());case"hsl":if(O.length!==3)return null;var X=(parseFloat(O[0])%360+360)%360/360,re=c(O[1]),Y=c(O[2]),ce=Y<=.5?Y*(re+1):Y+re-Y*re,ve=2*Y-ce;return[a(255*f(ve,ce,X+1/3)),a(255*f(ve,ce,X)),a(255*f(ve,ce,X-1/3)),Z];default:return null}}return null}}catch{}}).parseCSSColor,pr=function(e,t,r,a){a===void 0&&(a=1),this.r=e,this.g=t,this.b=r,this.a=a};pr.parse=function(e){if(e){if(e instanceof pr)return e;if(typeof e=="string"){var t=Zt(e);if(t)return new pr(t[0]/255*t[3],t[1]/255*t[3],t[2]/255*t[3],t[3])}}},pr.prototype.toString=function(){var e=this.toArray(),t=e[1],r=e[2],a=e[3];return"rgba("+Math.round(e[0])+","+Math.round(t)+","+Math.round(r)+","+a+")"},pr.prototype.toArray=function(){var e=this.a;return e===0?[0,0,0,0]:[255*this.r/e,255*this.g/e,255*this.b/e,e]},pr.black=new pr(0,0,0,1),pr.white=new pr(1,1,1,1),pr.transparent=new pr(0,0,0,0),pr.red=new pr(1,0,0,1);var Jr=function(e,t,r){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Jr.prototype.compare=function(e,t){return this.collator.compare(e,t)},Jr.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var v=function(e,t,r,a,u){this.text=e,this.image=t,this.scale=r,this.fontStack=a,this.textColor=u},E=function(e){this.sections=e};E.fromString=function(e){return new E([new v(e,null,null,null,null)])},E.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(e){return e.text.length!==0||e.image&&e.image.name.length!==0})},E.factory=function(e){return e instanceof E?e:E.fromString(e)},E.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(e){return e.text}).join("")},E.prototype.serialize=function(){for(var e=["format"],t=0,r=this.sections;t<r.length;t+=1){var a=r[t];if(a.image)e.push(["image",a.image.name]);else{e.push(a.text);var u={};a.fontStack&&(u["text-font"]=["literal",a.fontStack.split(",")]),a.scale&&(u["font-scale"]=a.scale),a.textColor&&(u["text-color"]=["rgba"].concat(a.textColor.toArray())),e.push(u)}}return e};var j=function(e){this.name=e.name,this.available=e.available};function be(e,t,r,a){return typeof e=="number"&&e>=0&&e<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof r=="number"&&r>=0&&r<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:"Invalid rgba value ["+[e,t,r,a].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof a=="number"?[e,t,r,a]:[e,t,r]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function ue(e){if(e===null||typeof e=="string"||typeof e=="boolean"||typeof e=="number"||e instanceof pr||e instanceof Jr||e instanceof E||e instanceof j)return!0;if(Array.isArray(e)){for(var t=0,r=e;t<r.length;t+=1)if(!ue(r[t]))return!1;return!0}if(typeof e=="object"){for(var a in e)if(!ue(e[a]))return!1;return!0}return!1}function V(e){if(e===null)return We;if(typeof e=="string")return it;if(typeof e=="boolean")return je;if(typeof e=="number")return Se;if(e instanceof pr)return Ye;if(e instanceof Jr)return Yt;if(e instanceof E)return Nt;if(e instanceof j)return Ut;if(Array.isArray(e)){for(var t,r=e.length,a=0,u=e;a<u.length;a+=1){var c=V(u[a]);if(t){if(t===c)continue;t=et;break}t=c}return Ht(t||et,r)}return Bt}function Ne(e){var t=typeof e;return e===null?"":t==="string"||t==="number"||t==="boolean"?String(e):e instanceof pr||e instanceof E||e instanceof j?e.toString():JSON.stringify(e)}j.prototype.toString=function(){return this.name},j.fromString=function(e){return e?new j({name:e,available:!1}):null},j.prototype.serialize=function(){return["image",this.name]};var Ge=function(e,t){this.type=e,this.value=t};Ge.parse=function(e,t){if(e.length!==2)return t.error("'literal' expression requires exactly one argument, but found "+(e.length-1)+" instead.");if(!ue(e[1]))return t.error("invalid value");var r=e[1],a=V(r),u=t.expectedType;return a.kind!=="array"||a.N!==0||!u||u.kind!=="array"||typeof u.N=="number"&&u.N!==0||(a=u),new Ge(a,r)},Ge.prototype.evaluate=function(){return this.value},Ge.prototype.eachChild=function(){},Ge.prototype.outputDefined=function(){return!0},Ge.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof pr?["rgba"].concat(this.value.toArray()):this.value instanceof E?this.value.serialize():this.value};var Ve=function(e){this.name="ExpressionEvaluationError",this.message=e};Ve.prototype.toJSON=function(){return this.message};var Le={string:it,number:Se,boolean:je,object:Bt},st=function(e,t){this.type=e,this.args=t};st.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var r,a=1,u=e[0];if(u==="array"){var c,f;if(e.length>2){var y=e[1];if(typeof y!="string"||!(y in Le)||y==="object")return t.error('The item type argument of "array" must be one of string, number, boolean',1);c=Le[y],a++}else c=et;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);f=e[2],a++}r=Ht(c,f)}else r=Le[u];for(var x=[];a<e.length;a++){var w=t.parse(e[a],a,et);if(!w)return null;x.push(w)}return new st(r,x)},st.prototype.evaluate=function(e){for(var t=0;t<this.args.length;t++){var r=this.args[t].evaluate(e);if(!cr(this.type,V(r)))return r;if(t===this.args.length-1)throw new Ve("Expected value to be of type "+rr(this.type)+", but found "+rr(V(r))+" instead.")}return null},st.prototype.eachChild=function(e){this.args.forEach(e)},st.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},st.prototype.serialize=function(){var e=this.type,t=[e.kind];if(e.kind==="array"){var r=e.itemType;if(r.kind==="string"||r.kind==="number"||r.kind==="boolean"){t.push(r.kind);var a=e.N;(typeof a=="number"||this.args.length>1)&&t.push(a)}}return t.concat(this.args.map(function(u){return u.serialize()}))};var At=function(e){this.type=Nt,this.sections=e};At.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var r=e[1];if(!Array.isArray(r)&&typeof r=="object")return t.error("First argument must be an image or text section.");for(var a=[],u=!1,c=1;c<=e.length-1;++c){var f=e[c];if(u&&typeof f=="object"&&!Array.isArray(f)){u=!1;var y=null;if(f["font-scale"]&&!(y=t.parse(f["font-scale"],1,Se)))return null;var x=null;if(f["text-font"]&&!(x=t.parse(f["text-font"],1,Ht(it))))return null;var w=null;if(f["text-color"]&&!(w=t.parse(f["text-color"],1,Ye)))return null;var I=a[a.length-1];I.scale=y,I.font=x,I.textColor=w}else{var A=t.parse(e[c],1,et);if(!A)return null;var z=A.type.kind;if(z!=="string"&&z!=="value"&&z!=="null"&&z!=="resolvedImage")return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");u=!0,a.push({content:A,scale:null,font:null,textColor:null})}}return new At(a)},At.prototype.evaluate=function(e){return new E(this.sections.map(function(t){var r=t.content.evaluate(e);return V(r)===Ut?new v("",r,null,null,null):new v(Ne(r),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)}))},At.prototype.eachChild=function(e){for(var t=0,r=this.sections;t<r.length;t+=1){var a=r[t];e(a.content),a.scale&&e(a.scale),a.font&&e(a.font),a.textColor&&e(a.textColor)}},At.prototype.outputDefined=function(){return!1},At.prototype.serialize=function(){for(var e=["format"],t=0,r=this.sections;t<r.length;t+=1){var a=r[t];e.push(a.content.serialize());var u={};a.scale&&(u["font-scale"]=a.scale.serialize()),a.font&&(u["text-font"]=a.font.serialize()),a.textColor&&(u["text-color"]=a.textColor.serialize()),e.push(u)}return e};var er=function(e){this.type=Ut,this.input=e};er.parse=function(e,t){if(e.length!==2)return t.error("Expected two arguments.");var r=t.parse(e[1],1,it);return r?new er(r):t.error("No image name provided.")},er.prototype.evaluate=function(e){var t=this.input.evaluate(e),r=j.fromString(t);return r&&e.availableImages&&(r.available=e.availableImages.indexOf(t)>-1),r},er.prototype.eachChild=function(e){e(this.input)},er.prototype.outputDefined=function(){return!1},er.prototype.serialize=function(){return["image",this.input.serialize()]};var Tn={"to-boolean":je,"to-color":Ye,"to-number":Se,"to-string":it},Dr=function(e,t){this.type=e,this.args=t};Dr.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var r=e[0];if((r==="to-boolean"||r==="to-string")&&e.length!==2)return t.error("Expected one argument.");for(var a=Tn[r],u=[],c=1;c<e.length;c++){var f=t.parse(e[c],c,et);if(!f)return null;u.push(f)}return new Dr(a,u)},Dr.prototype.evaluate=function(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){for(var t,r,a=0,u=this.args;a<u.length;a+=1){if(r=null,(t=u[a].evaluate(e))instanceof pr)return t;if(typeof t=="string"){var c=e.parseColor(t);if(c)return c}else if(Array.isArray(t)&&!(r=t.length<3||t.length>4?"Invalid rbga value "+JSON.stringify(t)+": expected an array containing either three or four numeric values.":be(t[0],t[1],t[2],t[3])))return new pr(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new Ve(r||"Could not parse color from value '"+(typeof t=="string"?t:String(JSON.stringify(t)))+"'")}if(this.type.kind==="number"){for(var f=null,y=0,x=this.args;y<x.length;y+=1){if((f=x[y].evaluate(e))===null)return 0;var w=Number(f);if(!isNaN(w))return w}throw new Ve("Could not convert "+JSON.stringify(f)+" to number.")}return this.type.kind==="formatted"?E.fromString(Ne(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?j.fromString(Ne(this.args[0].evaluate(e))):Ne(this.args[0].evaluate(e))},Dr.prototype.eachChild=function(e){this.args.forEach(e)},Dr.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},Dr.prototype.serialize=function(){if(this.type.kind==="formatted")return new At([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new er(this.args[0]).serialize();var e=["to-"+this.type.kind];return this.eachChild(function(t){e.push(t.serialize())}),e};var Fe=["Unknown","Point","LineString","Polygon"],yt=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};yt.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},yt.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?Fe[this.feature.type]:this.feature.type:null},yt.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},yt.prototype.canonicalID=function(){return this.canonical},yt.prototype.properties=function(){return this.feature&&this.feature.properties||{}},yt.prototype.parseColor=function(e){var t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=pr.parse(e)),t};var Kt=function(e,t,r,a){this.name=e,this.type=t,this._evaluate=r,this.args=a};Kt.prototype.evaluate=function(e){return this._evaluate(e,this.args)},Kt.prototype.eachChild=function(e){this.args.forEach(e)},Kt.prototype.outputDefined=function(){return!1},Kt.prototype.serialize=function(){return[this.name].concat(this.args.map(function(e){return e.serialize()}))},Kt.parse=function(e,t){var r,a=e[0],u=Kt.definitions[a];if(!u)return t.error('Unknown expression "'+a+'". If you wanted a literal array, use ["literal", [...]].',0);for(var c=Array.isArray(u)?u[0]:u.type,f=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,y=f.filter(function(St){var lt=St[0];return!Array.isArray(lt)||lt.length===e.length-1}),x=null,w=0,I=y;w<I.length;w+=1){var A=I[w],z=A[0],O=A[1];x=new ji(t.registry,t.path,null,t.scope);for(var Z=[],X=!1,re=1;re<e.length;re++){var Y=e[re],ce=Array.isArray(z)?z[re-1]:z.type,ve=x.parse(Y,1+Z.length,ce);if(!ve){X=!0;break}Z.push(ve)}if(!X)if(Array.isArray(z)&&z.length!==Z.length)x.error("Expected "+z.length+" arguments, but found "+Z.length+" instead.");else{for(var xe=0;xe<Z.length;xe++){var Te=Array.isArray(z)?z[xe]:z.type,Me=Z[xe];x.concat(xe+1).checkSubtype(Te,Me.type)}if(x.errors.length===0)return new Kt(a,c,O,Z)}}if(y.length===1)(r=t.errors).push.apply(r,x.errors);else{for(var Ue=(y.length?y:f).map(function(St){var lt;return lt=St[0],Array.isArray(lt)?"("+lt.map(rr).join(", ")+")":"("+rr(lt.type)+"...)"}).join(" | "),Je=[],xt=1;xt<e.length;xt++){var ut=t.parse(e[xt],1+Je.length);if(!ut)return null;Je.push(rr(ut.type))}t.error("Expected arguments of type "+Ue+", but found ("+Je.join(", ")+") instead.")}return null},Kt.register=function(e,t){for(var r in Kt.definitions=t,t)e[r]=Kt};var Dt=function(e,t,r){this.type=Yt,this.locale=r,this.caseSensitive=e,this.diacriticSensitive=t};function jr(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function Ui(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function Ka(e,t){var r=(180+e[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,u=Math.pow(2,t.z);return[Math.round(r*u*8192),Math.round(a*u*8192)]}function ln(e,t,r){return t[1]>e[1]!=r[1]>e[1]&&e[0]<(r[0]-t[0])*(e[1]-t[1])/(r[1]-t[1])+t[0]}function Fo(e,t){for(var r,a,u,c,f,y,x,w=!1,I=0,A=t.length;I<A;I++)for(var z=t[I],O=0,Z=z.length;O<Z-1;O++){if((c=(r=e)[0]-(a=z[O])[0])*(x=r[1]-(u=z[O+1])[1])-(y=r[0]-u[0])*(f=r[1]-a[1])==0&&c*y<=0&&f*x<=0)return!1;ln(e,z[O],z[O+1])&&(w=!w)}return w}function Xa(e,t){for(var r=0;r<t.length;r++)if(Fo(e,t[r]))return!0;return!1}function bo(e,t,r,a){var u=a[0]-r[0],c=a[1]-r[1],f=(e[0]-r[0])*c-u*(e[1]-r[1]),y=(t[0]-r[0])*c-u*(t[1]-r[1]);return f>0&&y<0||f<0&&y>0}function Bs(e,t,r){for(var a=0,u=r;a<u.length;a+=1)for(var c=u[a],f=0;f<c.length-1;++f)if((A=[(I=c[f+1])[0]-(w=c[f])[0],I[1]-w[1]])[0]*(z=[(x=t)[0]-(y=e)[0],x[1]-y[1]])[1]-A[1]*z[0]!=0&&bo(y,x,w,I)&&bo(w,I,y,x))return!0;var y,x,w,I,A,z;return!1}function hs(e,t){for(var r=0;r<e.length;++r)if(!Fo(e[r],t))return!1;for(var a=0;a<e.length-1;++a)if(Bs(e[a],e[a+1],t))return!1;return!0}function In(e,t){for(var r=0;r<t.length;r++)if(hs(e,t[r]))return!0;return!1}function ri(e,t,r){for(var a=[],u=0;u<e.length;u++){for(var c=[],f=0;f<e[u].length;f++){var y=Ka(e[u][f],r);jr(t,y),c.push(y)}a.push(c)}return a}function Yo(e,t,r){for(var a=[],u=0;u<e.length;u++){var c=ri(e[u],t,r);a.push(c)}return a}function wo(e,t,r,a){if(e[0]<r[0]||e[0]>r[2]){var u=.5*a,c=e[0]-r[0]>u?-a:r[0]-e[0]>u?a:0;c===0&&(c=e[0]-r[2]>u?-a:r[2]-e[0]>u?a:0),e[0]+=c}jr(t,e)}function Wa(e,t,r,a){for(var u=8192*Math.pow(2,a.z),c=[8192*a.x,8192*a.y],f=[],y=0,x=e;y<x.length;y+=1)for(var w=0,I=x[y];w<I.length;w+=1){var A=I[w],z=[A.x+c[0],A.y+c[1]];wo(z,t,r,u),f.push(z)}return f}function Yi(e,t,r,a){for(var u,c=8192*Math.pow(2,a.z),f=[8192*a.x,8192*a.y],y=[],x=0,w=e;x<w.length;x+=1){for(var I=[],A=0,z=w[x];A<z.length;A+=1){var O=z[A],Z=[O.x+f[0],O.y+f[1]];jr(t,Z),I.push(Z)}y.push(I)}if(t[2]-t[0]<=c/2){(u=t)[0]=u[1]=1/0,u[2]=u[3]=-1/0;for(var X=0,re=y;X<re.length;X+=1)for(var Y=0,ce=re[X];Y<ce.length;Y+=1)wo(ce[Y],t,r,c)}return y}Dt.parse=function(e,t){if(e.length!==2)return t.error("Expected one argument.");var r=e[1];if(typeof r!="object"||Array.isArray(r))return t.error("Collator options argument must be an object.");var a=t.parse(r["case-sensitive"]!==void 0&&r["case-sensitive"],1,je);if(!a)return null;var u=t.parse(r["diacritic-sensitive"]!==void 0&&r["diacritic-sensitive"],1,je);if(!u)return null;var c=null;return r.locale&&!(c=t.parse(r.locale,1,it))?null:new Dt(a,u,c)},Dt.prototype.evaluate=function(e){return new Jr(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)},Dt.prototype.eachChild=function(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)},Dt.prototype.outputDefined=function(){return!1},Dt.prototype.serialize=function(){var e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]};var Vi=function(e,t){this.type=je,this.geojson=e,this.geometries=t};function jn(e){if(e instanceof Kt&&(e.name==="get"&&e.args.length===1||e.name==="feature-state"||e.name==="has"&&e.args.length===1||e.name==="properties"||e.name==="geometry-type"||e.name==="id"||/^filter-/.test(e.name))||e instanceof Vi)return!1;var t=!0;return e.eachChild(function(r){t&&!jn(r)&&(t=!1)}),t}function io(e){if(e instanceof Kt&&e.name==="feature-state")return!1;var t=!0;return e.eachChild(function(r){t&&!io(r)&&(t=!1)}),t}function No(e,t){if(e instanceof Kt&&t.indexOf(e.name)>=0)return!1;var r=!0;return e.eachChild(function(a){r&&!No(a,t)&&(r=!1)}),r}Vi.parse=function(e,t){if(e.length!==2)return t.error("'within' expression requires exactly one argument, but found "+(e.length-1)+" instead.");if(ue(e[1])){var r=e[1];if(r.type==="FeatureCollection")for(var a=0;a<r.features.length;++a){var u=r.features[a].geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new Vi(r,r.features[a].geometry)}else if(r.type==="Feature"){var c=r.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new Vi(r,r.geometry)}else if(r.type==="Polygon"||r.type==="MultiPolygon")return new Vi(r,r)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")},Vi.prototype.evaluate=function(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(t,r){var a=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],c=t.canonicalID();if(r.type==="Polygon"){var f=ri(r.coordinates,u,c),y=Wa(t.geometry(),a,u,c);if(!Ui(a,u))return!1;for(var x=0,w=y;x<w.length;x+=1)if(!Fo(w[x],f))return!1}if(r.type==="MultiPolygon"){var I=Yo(r.coordinates,u,c),A=Wa(t.geometry(),a,u,c);if(!Ui(a,u))return!1;for(var z=0,O=A;z<O.length;z+=1)if(!Xa(O[z],I))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(t,r){var a=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],c=t.canonicalID();if(r.type==="Polygon"){var f=ri(r.coordinates,u,c),y=Yi(t.geometry(),a,u,c);if(!Ui(a,u))return!1;for(var x=0,w=y;x<w.length;x+=1)if(!hs(w[x],f))return!1}if(r.type==="MultiPolygon"){var I=Yo(r.coordinates,u,c),A=Yi(t.geometry(),a,u,c);if(!Ui(a,u))return!1;for(var z=0,O=A;z<O.length;z+=1)if(!In(O[z],I))return!1}return!0}(e,this.geometries)}return!1},Vi.prototype.eachChild=function(){},Vi.prototype.outputDefined=function(){return!0},Vi.prototype.serialize=function(){return["within",this.geojson]};var oo=function(e,t){this.type=t.type,this.name=e,this.boundExpression=t};oo.parse=function(e,t){if(e.length!==2||typeof e[1]!="string")return t.error("'var' expression requires exactly one string literal argument.");var r=e[1];return t.scope.has(r)?new oo(r,t.scope.get(r)):t.error('Unknown variable "'+r+'". Make sure "'+r+'" has been bound in an enclosing "let" expression before using it.',1)},oo.prototype.evaluate=function(e){return this.boundExpression.evaluate(e)},oo.prototype.eachChild=function(){},oo.prototype.outputDefined=function(){return!1},oo.prototype.serialize=function(){return["var",this.name]};var ji=function(e,t,r,a,u){t===void 0&&(t=[]),a===void 0&&(a=new ot),u===void 0&&(u=[]),this.registry=e,this.path=t,this.key=t.map(function(c){return"["+c+"]"}).join(""),this.scope=a,this.errors=u,this.expectedType=r};function aa(e,t){for(var r,a=e.length-1,u=0,c=a,f=0;u<=c;)if((r=e[f=Math.floor((u+c)/2)])<=t){if(f===a||t<e[f+1])return f;u=f+1}else{if(!(r>t))throw new Ve("Input is not a number.");c=f-1}return 0}ji.prototype.parse=function(e,t,r,a,u){return u===void 0&&(u={}),t?this.concat(t,r,a)._parse(e,u):this._parse(e,u)},ji.prototype._parse=function(e,t){function r(w,I,A){return A==="assert"?new st(I,[w]):A==="coerce"?new Dr(I,[w]):w}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var a=e[0];if(typeof a!="string")return this.error("Expression name must be a string, but found "+typeof a+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var u=this.registry[a];if(u){var c=u.parse(e,this);if(!c)return null;if(this.expectedType){var f=this.expectedType,y=c.type;if(f.kind!=="string"&&f.kind!=="number"&&f.kind!=="boolean"&&f.kind!=="object"&&f.kind!=="array"||y.kind!=="value")if(f.kind!=="color"&&f.kind!=="formatted"&&f.kind!=="resolvedImage"||y.kind!=="value"&&y.kind!=="string"){if(this.checkSubtype(f,y))return null}else c=r(c,f,t.typeAnnotation||"coerce");else c=r(c,f,t.typeAnnotation||"assert")}if(!(c instanceof Ge)&&c.type.kind!=="resolvedImage"&&function w(I){if(I instanceof oo)return w(I.boundExpression);if(I instanceof Kt&&I.name==="error"||I instanceof Dt||I instanceof Vi)return!1;var A=I instanceof Dr||I instanceof st,z=!0;return I.eachChild(function(O){z=A?z&&w(O):z&&O instanceof Ge}),!!z&&jn(I)&&No(I,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(c)){var x=new yt;try{c=new Ge(c.type,c.evaluate(x))}catch(w){return this.error(w.message),null}}return c}return this.error('Unknown expression "'+a+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof e+" instead.")},ji.prototype.concat=function(e,t,r){var a=typeof e=="number"?this.path.concat(e):this.path,u=r?this.scope.concat(r):this.scope;return new ji(this.registry,a,t||null,u,this.errors)},ji.prototype.error=function(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];var a=""+this.key+t.map(function(u){return"["+u+"]"}).join("");this.errors.push(new ke(a,e))},ji.prototype.checkSubtype=function(e,t){var r=cr(e,t);return r&&this.error(r),r};var ni=function(e,t,r){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(var a=0,u=r;a<u.length;a+=1){var c=u[a],f=c[1];this.labels.push(c[0]),this.outputs.push(f)}};function en(e,t,r){return e*(1-r)+t*r}ni.parse=function(e,t){if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");var r=t.parse(e[1],1,Se);if(!r)return null;var a=[],u=null;t.expectedType&&t.expectedType.kind!=="value"&&(u=t.expectedType);for(var c=1;c<e.length;c+=2){var f=c===1?-1/0:e[c],y=e[c+1],x=c,w=c+1;if(typeof f!="number")return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',x);if(a.length&&a[a.length-1][0]>=f)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',x);var I=t.parse(y,w,u);if(!I)return null;u=u||I.type,a.push([f,I])}return new ni(u,r,a)},ni.prototype.evaluate=function(e){var t=this.labels,r=this.outputs;if(t.length===1)return r[0].evaluate(e);var a=this.input.evaluate(e);if(a<=t[0])return r[0].evaluate(e);var u=t.length;return a>=t[u-1]?r[u-1].evaluate(e):r[aa(t,a)].evaluate(e)},ni.prototype.eachChild=function(e){e(this.input);for(var t=0,r=this.outputs;t<r.length;t+=1)e(r[t])},ni.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})},ni.prototype.serialize=function(){for(var e=["step",this.input.serialize()],t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e};var ao=Object.freeze({__proto__:null,number:en,color:function(e,t,r){return new pr(en(e.r,t.r,r),en(e.g,t.g,r),en(e.b,t.b,r),en(e.a,t.a,r))},array:function(e,t,r){return e.map(function(a,u){return en(a,t[u],r)})}}),Fs=6/29*3*(6/29),Au=Math.PI/180,Ha=180/Math.PI;function sa(e){return e>.008856451679035631?Math.pow(e,1/3):e/Fs+4/29}function Ia(e){return e>6/29?e*e*e:Fs*(e-4/29)}function fs(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function ds(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Ns(e){var t=ds(e.r),r=ds(e.g),a=ds(e.b),u=sa((.4124564*t+.3575761*r+.1804375*a)/.95047),c=sa((.2126729*t+.7151522*r+.072175*a)/1);return{l:116*c-16,a:500*(u-c),b:200*(c-sa((.0193339*t+.119192*r+.9503041*a)/1.08883)),alpha:e.a}}function Ja(e){var t=(e.l+16)/116,r=isNaN(e.a)?t:t+e.a/500,a=isNaN(e.b)?t:t-e.b/200;return t=1*Ia(t),r=.95047*Ia(r),a=1.08883*Ia(a),new pr(fs(3.2404542*r-1.5371385*t-.4985314*a),fs(-.969266*r+1.8760108*t+.041556*a),fs(.0556434*r-.2040259*t+1.0572252*a),e.alpha)}function ms(e,t,r){var a=t-e;return e+r*(a>180||a<-180?a-360*Math.round(a/360):a)}var ua={forward:Ns,reverse:Ja,interpolate:function(e,t,r){return{l:en(e.l,t.l,r),a:en(e.a,t.a,r),b:en(e.b,t.b,r),alpha:en(e.alpha,t.alpha,r)}}},Uo={forward:function(e){var t=Ns(e),r=t.l,a=t.a,u=t.b,c=Math.atan2(u,a)*Ha;return{h:c<0?c+360:c,c:Math.sqrt(a*a+u*u),l:r,alpha:e.a}},reverse:function(e){var t=e.h*Au,r=e.c;return Ja({l:e.l,a:Math.cos(t)*r,b:Math.sin(t)*r,alpha:e.alpha})},interpolate:function(e,t,r){return{h:ms(e.h,t.h,r),c:en(e.c,t.c,r),l:en(e.l,t.l,r),alpha:en(e.alpha,t.alpha,r)}}},Ca=Object.freeze({__proto__:null,lab:ua,hcl:Uo}),cn=function(e,t,r,a,u){this.type=e,this.operator=t,this.interpolation=r,this.input=a,this.labels=[],this.outputs=[];for(var c=0,f=u;c<f.length;c+=1){var y=f[c],x=y[1];this.labels.push(y[0]),this.outputs.push(x)}};function Ya(e,t,r,a){var u=a-r,c=e-r;return u===0?0:t===1?c/u:(Math.pow(t,c)-1)/(Math.pow(t,u)-1)}cn.interpolationFactor=function(e,t,r,a){var u=0;if(e.name==="exponential")u=Ya(t,e.base,r,a);else if(e.name==="linear")u=Ya(t,1,r,a);else if(e.name==="cubic-bezier"){var c=e.controlPoints;u=new Oe(c[0],c[1],c[2],c[3]).solve(Ya(t,1,r,a))}return u},cn.parse=function(e,t){var r=e[0],a=e[1],u=e[2],c=e.slice(3);if(!Array.isArray(a)||a.length===0)return t.error("Expected an interpolation type expression.",1);if(a[0]==="linear")a={name:"linear"};else if(a[0]==="exponential"){var f=a[1];if(typeof f!="number")return t.error("Exponential interpolation requires a numeric base.",1,1);a={name:"exponential",base:f}}else{if(a[0]!=="cubic-bezier")return t.error("Unknown interpolation type "+String(a[0]),1,0);var y=a.slice(1);if(y.length!==4||y.some(function(re){return typeof re!="number"||re<0||re>1}))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);a={name:"cubic-bezier",controlPoints:y}}if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(!(u=t.parse(u,2,Se)))return null;var x=[],w=null;r==="interpolate-hcl"||r==="interpolate-lab"?w=Ye:t.expectedType&&t.expectedType.kind!=="value"&&(w=t.expectedType);for(var I=0;I<c.length;I+=2){var A=c[I],z=c[I+1],O=I+3,Z=I+4;if(typeof A!="number")return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',O);if(x.length&&x[x.length-1][0]>=A)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',O);var X=t.parse(z,Z,w);if(!X)return null;w=w||X.type,x.push([A,X])}return w.kind==="number"||w.kind==="color"||w.kind==="array"&&w.itemType.kind==="number"&&typeof w.N=="number"?new cn(w,r,a,u,x):t.error("Type "+rr(w)+" is not interpolatable.")},cn.prototype.evaluate=function(e){var t=this.labels,r=this.outputs;if(t.length===1)return r[0].evaluate(e);var a=this.input.evaluate(e);if(a<=t[0])return r[0].evaluate(e);var u=t.length;if(a>=t[u-1])return r[u-1].evaluate(e);var c=aa(t,a),f=cn.interpolationFactor(this.interpolation,a,t[c],t[c+1]),y=r[c].evaluate(e),x=r[c+1].evaluate(e);return this.operator==="interpolate"?ao[this.type.kind.toLowerCase()](y,x,f):this.operator==="interpolate-hcl"?Uo.reverse(Uo.interpolate(Uo.forward(y),Uo.forward(x),f)):ua.reverse(ua.interpolate(ua.forward(y),ua.forward(x),f))},cn.prototype.eachChild=function(e){e(this.input);for(var t=0,r=this.outputs;t<r.length;t+=1)e(r[t])},cn.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})},cn.prototype.serialize=function(){var e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var t=[this.operator,e,this.input.serialize()],r=0;r<this.labels.length;r++)t.push(this.labels[r],this.outputs[r].serialize());return t};var Vo=function(e,t){this.type=e,this.args=t};Vo.parse=function(e,t){if(e.length<2)return t.error("Expectected at least one argument.");var r=null,a=t.expectedType;a&&a.kind!=="value"&&(r=a);for(var u=[],c=0,f=e.slice(1);c<f.length;c+=1){var y=t.parse(f[c],1+u.length,r,void 0,{typeAnnotation:"omit"});if(!y)return null;r=r||y.type,u.push(y)}var x=a&&u.some(function(w){return cr(a,w.type)});return new Vo(x?et:r,u)},Vo.prototype.evaluate=function(e){for(var t,r=null,a=0,u=0,c=this.args;u<c.length&&(a++,(r=c[u].evaluate(e))&&r instanceof j&&!r.available&&(t||(t=r.name),r=null,a===this.args.length&&(r=t)),r===null);u+=1);return r},Vo.prototype.eachChild=function(e){this.args.forEach(e)},Vo.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},Vo.prototype.serialize=function(){var e=["coalesce"];return this.eachChild(function(t){e.push(t.serialize())}),e};var $i=function(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t};$i.prototype.evaluate=function(e){return this.result.evaluate(e)},$i.prototype.eachChild=function(e){for(var t=0,r=this.bindings;t<r.length;t+=1)e(r[t][1]);e(this.result)},$i.parse=function(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found "+(e.length-1)+" instead.");for(var r=[],a=1;a<e.length-1;a+=2){var u=e[a];if(typeof u!="string")return t.error("Expected string, but found "+typeof u+" instead.",a);if(/[^a-zA-Z0-9_]/.test(u))return t.error("Variable names must contain only alphanumeric characters or '_'.",a);var c=t.parse(e[a+1],a+1);if(!c)return null;r.push([u,c])}var f=t.parse(e[e.length-1],e.length-1,t.expectedType,r);return f?new $i(r,f):null},$i.prototype.outputDefined=function(){return this.result.outputDefined()},$i.prototype.serialize=function(){for(var e=["let"],t=0,r=this.bindings;t<r.length;t+=1){var a=r[t];e.push(a[0],a[1].serialize())}return e.push(this.result.serialize()),e};var Eo=function(e,t,r){this.type=e,this.index=t,this.input=r};Eo.parse=function(e,t){if(e.length!==3)return t.error("Expected 2 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,Se),a=t.parse(e[2],2,Ht(t.expectedType||et));return r&&a?new Eo(a.type.itemType,r,a):null},Eo.prototype.evaluate=function(e){var t=this.index.evaluate(e),r=this.input.evaluate(e);if(t<0)throw new Ve("Array index out of bounds: "+t+" < 0.");if(t>=r.length)throw new Ve("Array index out of bounds: "+t+" > "+(r.length-1)+".");if(t!==Math.floor(t))throw new Ve("Array index must be an integer, but found "+t+" instead.");return r[t]},Eo.prototype.eachChild=function(e){e(this.index),e(this.input)},Eo.prototype.outputDefined=function(){return!1},Eo.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var So=function(e,t){this.type=je,this.needle=e,this.haystack=t};So.parse=function(e,t){if(e.length!==3)return t.error("Expected 2 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,et),a=t.parse(e[2],2,et);return r&&a?zr(r.type,[je,it,Se,We,et])?new So(r,a):t.error("Expected first argument to be of type boolean, string, number or null, but found "+rr(r.type)+" instead"):null},So.prototype.evaluate=function(e){var t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!r)return!1;if(!vr(t,["boolean","string","number","null"]))throw new Ve("Expected first argument to be of type boolean, string, number or null, but found "+rr(V(t))+" instead.");if(!vr(r,["string","array"]))throw new Ve("Expected second argument to be of type array or string, but found "+rr(V(r))+" instead.");return r.indexOf(t)>=0},So.prototype.eachChild=function(e){e(this.needle),e(this.haystack)},So.prototype.outputDefined=function(){return!0},So.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var so=function(e,t,r){this.type=Se,this.needle=e,this.haystack=t,this.fromIndex=r};so.parse=function(e,t){if(e.length<=2||e.length>=5)return t.error("Expected 3 or 4 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,et),a=t.parse(e[2],2,et);if(!r||!a)return null;if(!zr(r.type,[je,it,Se,We,et]))return t.error("Expected first argument to be of type boolean, string, number or null, but found "+rr(r.type)+" instead");if(e.length===4){var u=t.parse(e[3],3,Se);return u?new so(r,a,u):null}return new so(r,a)},so.prototype.evaluate=function(e){var t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!vr(t,["boolean","string","number","null"]))throw new Ve("Expected first argument to be of type boolean, string, number or null, but found "+rr(V(t))+" instead.");if(!vr(r,["string","array"]))throw new Ve("Expected second argument to be of type array or string, but found "+rr(V(r))+" instead.");if(this.fromIndex){var a=this.fromIndex.evaluate(e);return r.indexOf(t,a)}return r.indexOf(t)},so.prototype.eachChild=function(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)},so.prototype.outputDefined=function(){return!1},so.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var To=function(e,t,r,a,u,c){this.inputType=e,this.type=t,this.input=r,this.cases=a,this.outputs=u,this.otherwise=c};To.parse=function(e,t){if(e.length<5)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if(e.length%2!=1)return t.error("Expected an even number of arguments.");var r,a;t.expectedType&&t.expectedType.kind!=="value"&&(a=t.expectedType);for(var u={},c=[],f=2;f<e.length-1;f+=2){var y=e[f],x=e[f+1];Array.isArray(y)||(y=[y]);var w=t.concat(f);if(y.length===0)return w.error("Expected at least one branch label.");for(var I=0,A=y;I<A.length;I+=1){var z=A[I];if(typeof z!="number"&&typeof z!="string")return w.error("Branch labels must be numbers or strings.");if(typeof z=="number"&&Math.abs(z)>Number.MAX_SAFE_INTEGER)return w.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof z=="number"&&Math.floor(z)!==z)return w.error("Numeric branch labels must be integer values.");if(r){if(w.checkSubtype(r,V(z)))return null}else r=V(z);if(u[String(z)]!==void 0)return w.error("Branch labels must be unique.");u[String(z)]=c.length}var O=t.parse(x,f,a);if(!O)return null;a=a||O.type,c.push(O)}var Z=t.parse(e[1],1,et);if(!Z)return null;var X=t.parse(e[e.length-1],e.length-1,a);return X?Z.type.kind!=="value"&&t.concat(1).checkSubtype(r,Z.type)?null:new To(r,a,Z,u,c,X):null},To.prototype.evaluate=function(e){var t=this.input.evaluate(e);return(V(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)},To.prototype.eachChild=function(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)},To.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})&&this.otherwise.outputDefined()},To.prototype.serialize=function(){for(var e=this,t=["match",this.input.serialize()],r=[],a={},u=0,c=Object.keys(this.cases).sort();u<c.length;u+=1){var f=c[u];(A=a[this.cases[f]])===void 0?(a[this.cases[f]]=r.length,r.push([this.cases[f],[f]])):r[A][1].push(f)}for(var y=function(O){return e.inputType.kind==="number"?Number(O):O},x=0,w=r;x<w.length;x+=1){var I=w[x],A=I[0],z=I[1];t.push(z.length===1?y(z[0]):z.map(y)),t.push(this.outputs[outputIndex$1].serialize())}return t.push(this.otherwise.serialize()),t};var tn=function(e,t,r){this.type=e,this.branches=t,this.otherwise=r};tn.parse=function(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found only "+(e.length-1)+".");if(e.length%2!=0)return t.error("Expected an odd number of arguments.");var r;t.expectedType&&t.expectedType.kind!=="value"&&(r=t.expectedType);for(var a=[],u=1;u<e.length-1;u+=2){var c=t.parse(e[u],u,je);if(!c)return null;var f=t.parse(e[u+1],u+1,r);if(!f)return null;a.push([c,f]),r=r||f.type}var y=t.parse(e[e.length-1],e.length-1,r);return y?new tn(r,a,y):null},tn.prototype.evaluate=function(e){for(var t=0,r=this.branches;t<r.length;t+=1){var a=r[t],u=a[1];if(a[0].evaluate(e))return u.evaluate(e)}return this.otherwise.evaluate(e)},tn.prototype.eachChild=function(e){for(var t=0,r=this.branches;t<r.length;t+=1){var a=r[t],u=a[1];e(a[0]),e(u)}e(this.otherwise)},tn.prototype.outputDefined=function(){return this.branches.every(function(e){return e[1].outputDefined()})&&this.otherwise.outputDefined()},tn.prototype.serialize=function(){var e=["case"];return this.eachChild(function(t){e.push(t.serialize())}),e};var qi=function(e,t,r,a){this.type=e,this.input=t,this.beginIndex=r,this.endIndex=a};function la(e,t){return e==="=="||e==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function ys(e,t,r,a){return a.compare(t,r)===0}function wr(e,t,r){var a=e!=="=="&&e!=="!=";return function(){function u(c,f,y){this.type=je,this.lhs=c,this.rhs=f,this.collator=y,this.hasUntypedArgument=c.type.kind==="value"||f.type.kind==="value"}return u.parse=function(c,f){if(c.length!==3&&c.length!==4)return f.error("Expected two or three arguments.");var y=c[0],x=f.parse(c[1],1,et);if(!x)return null;if(!la(y,x.type))return f.concat(1).error('"'+y+`" comparisons are not supported for type '`+rr(x.type)+"'.");var w=f.parse(c[2],2,et);if(!w)return null;if(!la(y,w.type))return f.concat(2).error('"'+y+`" comparisons are not supported for type '`+rr(w.type)+"'.");if(x.type.kind!==w.type.kind&&x.type.kind!=="value"&&w.type.kind!=="value")return f.error("Cannot compare types '"+rr(x.type)+"' and '"+rr(w.type)+"'.");a&&(x.type.kind==="value"&&w.type.kind!=="value"?x=new st(w.type,[x]):x.type.kind!=="value"&&w.type.kind==="value"&&(w=new st(x.type,[w])));var I=null;if(c.length===4){if(x.type.kind!=="string"&&w.type.kind!=="string"&&x.type.kind!=="value"&&w.type.kind!=="value")return f.error("Cannot use collator to compare non-string types.");if(!(I=f.parse(c[3],3,Yt)))return null}return new u(x,w,I)},u.prototype.evaluate=function(c){var f=this.lhs.evaluate(c),y=this.rhs.evaluate(c);if(a&&this.hasUntypedArgument){var x=V(f),w=V(y);if(x.kind!==w.kind||x.kind!=="string"&&x.kind!=="number")throw new Ve('Expected arguments for "'+e+'" to be (string, string) or (number, number), but found ('+x.kind+", "+w.kind+") instead.")}if(this.collator&&!a&&this.hasUntypedArgument){var I=V(f),A=V(y);if(I.kind!=="string"||A.kind!=="string")return t(c,f,y)}return this.collator?r(c,f,y,this.collator.evaluate(c)):t(c,f,y)},u.prototype.eachChild=function(c){c(this.lhs),c(this.rhs),this.collator&&c(this.collator)},u.prototype.outputDefined=function(){return!0},u.prototype.serialize=function(){var c=[e];return this.eachChild(function(f){c.push(f.serialize())}),c},u}()}qi.parse=function(e,t){if(e.length<=2||e.length>=5)return t.error("Expected 3 or 4 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,et),a=t.parse(e[2],2,Se);if(!r||!a)return null;if(!zr(r.type,[Ht(et),it,et]))return t.error("Expected first argument to be of type array or string, but found "+rr(r.type)+" instead");if(e.length===4){var u=t.parse(e[3],3,Se);return u?new qi(r.type,r,a,u):null}return new qi(r.type,r,a)},qi.prototype.evaluate=function(e){var t=this.input.evaluate(e),r=this.beginIndex.evaluate(e);if(!vr(t,["string","array"]))throw new Ve("Expected first argument to be of type array or string, but found "+rr(V(t))+" instead.");if(this.endIndex){var a=this.endIndex.evaluate(e);return t.slice(r,a)}return t.slice(r)},qi.prototype.eachChild=function(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)},qi.prototype.outputDefined=function(){return!1},qi.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var Us=wr("==",function(e,t,r){return t===r},ys),Aa=wr("!=",function(e,t,r){return t!==r},function(e,t,r,a){return!ys(0,t,r,a)}),Pa=wr("<",function(e,t,r){return t<r},function(e,t,r,a){return a.compare(t,r)<0}),$a=wr(">",function(e,t,r){return t>r},function(e,t,r,a){return a.compare(t,r)>0}),jo=wr("<=",function(e,t,r){return t<=r},function(e,t,r,a){return a.compare(t,r)<=0}),Qa=wr(">=",function(e,t,r){return t>=r},function(e,t,r,a){return a.compare(t,r)>=0}),Io=function(e,t,r,a,u){this.type=it,this.number=e,this.locale=t,this.currency=r,this.minFractionDigits=a,this.maxFractionDigits=u};Io.parse=function(e,t){if(e.length!==3)return t.error("Expected two arguments.");var r=t.parse(e[1],1,Se);if(!r)return null;var a=e[2];if(typeof a!="object"||Array.isArray(a))return t.error("NumberFormat options argument must be an object.");var u=null;if(a.locale&&!(u=t.parse(a.locale,1,it)))return null;var c=null;if(a.currency&&!(c=t.parse(a.currency,1,it)))return null;var f=null;if(a["min-fraction-digits"]&&!(f=t.parse(a["min-fraction-digits"],1,Se)))return null;var y=null;return a["max-fraction-digits"]&&!(y=t.parse(a["max-fraction-digits"],1,Se))?null:new Io(r,u,c,f,y)},Io.prototype.evaluate=function(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))},Io.prototype.eachChild=function(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)},Io.prototype.outputDefined=function(){return!1},Io.prototype.serialize=function(){var e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]};var Qi=function(e){this.type=Se,this.input=e};Qi.parse=function(e,t){if(e.length!==2)return t.error("Expected 1 argument, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1);return r?r.type.kind!=="array"&&r.type.kind!=="string"&&r.type.kind!=="value"?t.error("Expected argument of type string or array, but found "+rr(r.type)+" instead."):new Qi(r):null},Qi.prototype.evaluate=function(e){var t=this.input.evaluate(e);if(typeof t=="string"||Array.isArray(t))return t.length;throw new Ve("Expected value to be of type string or array, but found "+rr(V(t))+" instead.")},Qi.prototype.eachChild=function(e){e(this.input)},Qi.prototype.outputDefined=function(){return!1},Qi.prototype.serialize=function(){var e=["length"];return this.eachChild(function(t){e.push(t.serialize())}),e};var Co={"==":Us,"!=":Aa,">":$a,"<":Pa,">=":Qa,"<=":jo,array:st,at:Eo,boolean:st,case:tn,coalesce:Vo,collator:Dt,format:At,image:er,in:So,"index-of":so,interpolate:cn,"interpolate-hcl":cn,"interpolate-lab":cn,length:Qi,let:$i,literal:Ge,match:To,number:st,"number-format":Io,object:st,slice:qi,step:ni,string:st,"to-boolean":Dr,"to-color":Dr,"to-number":Dr,"to-string":Dr,var:oo,within:Vi};function gs(e,t){var r=t[0],a=t[1],u=t[2],c=t[3];r=r.evaluate(e),a=a.evaluate(e),u=u.evaluate(e);var f=c?c.evaluate(e):1,y=be(r,a,u,f);if(y)throw new Ve(y);return new pr(r/255*f,a/255*f,u/255*f,f)}function Vs(e,t){return e in t}function ka(e,t){var r=t[e];return r===void 0?null:r}function uo(e){return{type:e}}function js(e){return{result:"success",value:e}}function Ao(e){return{result:"error",value:e}}function Po(e){return e["property-type"]==="data-driven"||e["property-type"]==="cross-faded-data-driven"}function qs(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}function ca(e){return!!e.expression&&e.expression.interpolated}function kr(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":e===null?"null":typeof e}function Ma(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}function Zs(e){return e}function pa(e,t,r){return e!==void 0?e:t!==void 0?t:r!==void 0?r:void 0}function vs(e,t,r,a,u){return pa(typeof r===u?a[r]:void 0,e.default,t.default)}function _s(e,t,r){if(kr(r)!=="number")return pa(e.default,t.default);var a=e.stops.length;if(a===1||r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[a-1][0])return e.stops[a-1][1];var u=aa(e.stops.map(function(c){return c[0]}),r);return e.stops[u][1]}function xs(e,t,r){var a=e.base!==void 0?e.base:1;if(kr(r)!=="number")return pa(e.default,t.default);var u=e.stops.length;if(u===1||r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[u-1][0])return e.stops[u-1][1];var c=aa(e.stops.map(function(A){return A[0]}),r),f=function(A,z,O,Z){var X=Z-O,re=A-O;return X===0?0:z===1?re/X:(Math.pow(z,re)-1)/(Math.pow(z,X)-1)}(r,a,e.stops[c][0],e.stops[c+1][0]),y=e.stops[c][1],x=e.stops[c+1][1],w=ao[t.type]||Zs;if(e.colorSpace&&e.colorSpace!=="rgb"){var I=Ca[e.colorSpace];w=function(A,z){return I.reverse(I.interpolate(I.forward(A),I.forward(z),f))}}return typeof y.evaluate=="function"?{evaluate:function(){for(var A=[],z=arguments.length;z--;)A[z]=arguments[z];var O=y.evaluate.apply(void 0,A),Z=x.evaluate.apply(void 0,A);if(O!==void 0&&Z!==void 0)return w(O,Z,f)}}:w(y,x,f)}function za(e,t,r){return t.type==="color"?r=pr.parse(r):t.type==="formatted"?r=E.fromString(r.toString()):t.type==="resolvedImage"?r=j.fromString(r.toString()):kr(r)===t.type||t.type==="enum"&&t.values[r]||(r=void 0),pa(r,e.default,t.default)}Kt.register(Co,{error:[{kind:"error"},[it],function(e,t){throw new Ve(t[0].evaluate(e))}],typeof:[it,[et],function(e,t){return rr(V(t[0].evaluate(e)))}],"to-rgba":[Ht(Se,4),[Ye],function(e,t){return t[0].evaluate(e).toArray()}],rgb:[Ye,[Se,Se,Se],gs],rgba:[Ye,[Se,Se,Se,Se],gs],has:{type:je,overloads:[[[it],function(e,t){return Vs(t[0].evaluate(e),e.properties())}],[[it,Bt],function(e,t){var r=t[1];return Vs(t[0].evaluate(e),r.evaluate(e))}]]},get:{type:et,overloads:[[[it],function(e,t){return ka(t[0].evaluate(e),e.properties())}],[[it,Bt],function(e,t){var r=t[1];return ka(t[0].evaluate(e),r.evaluate(e))}]]},"feature-state":[et,[it],function(e,t){return ka(t[0].evaluate(e),e.featureState||{})}],properties:[Bt,[],function(e){return e.properties()}],"geometry-type":[it,[],function(e){return e.geometryType()}],id:[et,[],function(e){return e.id()}],zoom:[Se,[],function(e){return e.globals.zoom}],"heatmap-density":[Se,[],function(e){return e.globals.heatmapDensity||0}],"line-progress":[Se,[],function(e){return e.globals.lineProgress||0}],accumulated:[et,[],function(e){return e.globals.accumulated===void 0?null:e.globals.accumulated}],"+":[Se,uo(Se),function(e,t){for(var r=0,a=0,u=t;a<u.length;a+=1)r+=u[a].evaluate(e);return r}],"*":[Se,uo(Se),function(e,t){for(var r=1,a=0,u=t;a<u.length;a+=1)r*=u[a].evaluate(e);return r}],"-":{type:Se,overloads:[[[Se,Se],function(e,t){var r=t[1];return t[0].evaluate(e)-r.evaluate(e)}],[[Se],function(e,t){return-t[0].evaluate(e)}]]},"/":[Se,[Se,Se],function(e,t){var r=t[1];return t[0].evaluate(e)/r.evaluate(e)}],"%":[Se,[Se,Se],function(e,t){var r=t[1];return t[0].evaluate(e)%r.evaluate(e)}],ln2:[Se,[],function(){return Math.LN2}],pi:[Se,[],function(){return Math.PI}],e:[Se,[],function(){return Math.E}],"^":[Se,[Se,Se],function(e,t){var r=t[1];return Math.pow(t[0].evaluate(e),r.evaluate(e))}],sqrt:[Se,[Se],function(e,t){return Math.sqrt(t[0].evaluate(e))}],log10:[Se,[Se],function(e,t){return Math.log(t[0].evaluate(e))/Math.LN10}],ln:[Se,[Se],function(e,t){return Math.log(t[0].evaluate(e))}],log2:[Se,[Se],function(e,t){return Math.log(t[0].evaluate(e))/Math.LN2}],sin:[Se,[Se],function(e,t){return Math.sin(t[0].evaluate(e))}],cos:[Se,[Se],function(e,t){return Math.cos(t[0].evaluate(e))}],tan:[Se,[Se],function(e,t){return Math.tan(t[0].evaluate(e))}],asin:[Se,[Se],function(e,t){return Math.asin(t[0].evaluate(e))}],acos:[Se,[Se],function(e,t){return Math.acos(t[0].evaluate(e))}],atan:[Se,[Se],function(e,t){return Math.atan(t[0].evaluate(e))}],min:[Se,uo(Se),function(e,t){return Math.min.apply(Math,t.map(function(r){return r.evaluate(e)}))}],max:[Se,uo(Se),function(e,t){return Math.max.apply(Math,t.map(function(r){return r.evaluate(e)}))}],abs:[Se,[Se],function(e,t){return Math.abs(t[0].evaluate(e))}],round:[Se,[Se],function(e,t){var r=t[0].evaluate(e);return r<0?-Math.round(-r):Math.round(r)}],floor:[Se,[Se],function(e,t){return Math.floor(t[0].evaluate(e))}],ceil:[Se,[Se],function(e,t){return Math.ceil(t[0].evaluate(e))}],"filter-==":[je,[it,et],function(e,t){var r=t[0],a=t[1];return e.properties()[r.value]===a.value}],"filter-id-==":[je,[et],function(e,t){var r=t[0];return e.id()===r.value}],"filter-type-==":[je,[it],function(e,t){var r=t[0];return e.geometryType()===r.value}],"filter-<":[je,[it,et],function(e,t){var r=t[0],a=t[1],u=e.properties()[r.value],c=a.value;return typeof u==typeof c&&u<c}],"filter-id-<":[je,[et],function(e,t){var r=t[0],a=e.id(),u=r.value;return typeof a==typeof u&&a<u}],"filter->":[je,[it,et],function(e,t){var r=t[0],a=t[1],u=e.properties()[r.value],c=a.value;return typeof u==typeof c&&u>c}],"filter-id->":[je,[et],function(e,t){var r=t[0],a=e.id(),u=r.value;return typeof a==typeof u&&a>u}],"filter-<=":[je,[it,et],function(e,t){var r=t[0],a=t[1],u=e.properties()[r.value],c=a.value;return typeof u==typeof c&&u<=c}],"filter-id-<=":[je,[et],function(e,t){var r=t[0],a=e.id(),u=r.value;return typeof a==typeof u&&a<=u}],"filter->=":[je,[it,et],function(e,t){var r=t[0],a=t[1],u=e.properties()[r.value],c=a.value;return typeof u==typeof c&&u>=c}],"filter-id->=":[je,[et],function(e,t){var r=t[0],a=e.id(),u=r.value;return typeof a==typeof u&&a>=u}],"filter-has":[je,[et],function(e,t){return t[0].value in e.properties()}],"filter-has-id":[je,[],function(e){return e.id()!==null&&e.id()!==void 0}],"filter-type-in":[je,[Ht(it)],function(e,t){return t[0].value.indexOf(e.geometryType())>=0}],"filter-id-in":[je,[Ht(et)],function(e,t){return t[0].value.indexOf(e.id())>=0}],"filter-in-small":[je,[it,Ht(et)],function(e,t){var r=t[0];return t[1].value.indexOf(e.properties()[r.value])>=0}],"filter-in-large":[je,[it,Ht(et)],function(e,t){var r=t[0],a=t[1];return function(u,c,f,y){for(;f<=y;){var x=f+y>>1;if(c[x]===u)return!0;c[x]>u?y=x-1:f=x+1}return!1}(e.properties()[r.value],a.value,0,a.value.length-1)}],all:{type:je,overloads:[[[je,je],function(e,t){var r=t[1];return t[0].evaluate(e)&&r.evaluate(e)}],[uo(je),function(e,t){for(var r=0,a=t;r<a.length;r+=1)if(!a[r].evaluate(e))return!1;return!0}]]},any:{type:je,overloads:[[[je,je],function(e,t){var r=t[1];return t[0].evaluate(e)||r.evaluate(e)}],[uo(je),function(e,t){for(var r=0,a=t;r<a.length;r+=1)if(a[r].evaluate(e))return!0;return!1}]]},"!":[je,[je],function(e,t){return!t[0].evaluate(e)}],"is-supported-script":[je,[it],function(e,t){var r=e.globals&&e.globals.isSupportedScript;return!r||r(t[0].evaluate(e))}],upcase:[it,[it],function(e,t){return t[0].evaluate(e).toUpperCase()}],downcase:[it,[it],function(e,t){return t[0].evaluate(e).toLowerCase()}],concat:[it,uo(et),function(e,t){return t.map(function(r){return Ne(r.evaluate(e))}).join("")}],"resolved-locale":[it,[Yt],function(e,t){return t[0].evaluate(e).resolvedLocale()}]});var ha=function(e,t){this.expression=e,this._warningHistory={},this._evaluator=new yt,this._defaultValue=t?function(r){return r.type==="color"&&Ma(r.default)?new pr(0,0,0,0):r.type==="color"?pr.parse(r.default)||null:r.default===void 0?null:r.default}(t):null,this._enumValues=t&&t.type==="enum"?t.values:null};function Da(e){return Array.isArray(e)&&e.length>0&&typeof e[0]=="string"&&e[0]in Co}function es(e,t){var r=new ji(Co,[],t?function(u){var c={color:Ye,string:it,number:Se,enum:it,boolean:je,formatted:Nt,resolvedImage:Ut};return u.type==="array"?Ht(c[u.value]||et,u.length):c[u.type]}(t):void 0),a=r.parse(e,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return a?js(new ha(a,t)):Ao(r.errors)}ha.prototype.evaluateWithoutErrorHandling=function(e,t,r,a,u,c){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=r,this._evaluator.canonical=a,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=c,this.expression.evaluate(this._evaluator)},ha.prototype.evaluate=function(e,t,r,a,u,c){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=r||null,this._evaluator.canonical=a,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=c||null;try{var f=this.expression.evaluate(this._evaluator);if(f==null||typeof f=="number"&&f!=f)return this._defaultValue;if(this._enumValues&&!(f in this._enumValues))throw new Ve("Expected value to be one of "+Object.keys(this._enumValues).map(function(y){return JSON.stringify(y)}).join(", ")+", but found "+JSON.stringify(f)+" instead.");return f}catch(y){return this._warningHistory[y.message]||(this._warningHistory[y.message]=!0,typeof console<"u"&&console.warn(y.message)),this._defaultValue}};var qo=function(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent=e!=="constant"&&!io(t.expression)};qo.prototype.evaluateWithoutErrorHandling=function(e,t,r,a,u,c){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,a,u,c)},qo.prototype.evaluate=function(e,t,r,a,u,c){return this._styleExpression.evaluate(e,t,r,a,u,c)};var ci=function(e,t,r,a){this.kind=e,this.zoomStops=r,this._styleExpression=t,this.isStateDependent=e!=="camera"&&!io(t.expression),this.interpolationType=a};function rn(e,t){if((e=es(e,t)).result==="error")return e;var r=e.value.expression,a=jn(r);if(!a&&!Po(t))return Ao([new ke("","data expressions not supported")]);var u=No(r,["zoom"]);if(!u&&!qs(t))return Ao([new ke("","zoom expressions not supported")]);var c=function f(y){var x=null;if(y instanceof $i)x=f(y.result);else if(y instanceof Vo)for(var w=0,I=y.args;w<I.length&&!(x=f(I[w]));w+=1);else(y instanceof ni||y instanceof cn)&&y.input instanceof Kt&&y.input.name==="zoom"&&(x=y);return x instanceof ke||y.eachChild(function(A){var z=f(A);z instanceof ke?x=z:!x&&z?x=new ke("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):x&&z&&x!==z&&(x=new ke("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),x}(r);return c||u?c instanceof ke?Ao([c]):c instanceof cn&&!ca(t)?Ao([new ke("",'"interpolate" expressions cannot be used with this property')]):js(c?new ci(a?"camera":"composite",e.value,c.labels,c instanceof cn?c.interpolation:void 0):new qo(a?"constant":"source",e.value)):Ao([new ke("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}ci.prototype.evaluateWithoutErrorHandling=function(e,t,r,a,u,c){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,a,u,c)},ci.prototype.evaluate=function(e,t,r,a,u,c){return this._styleExpression.evaluate(e,t,r,a,u,c)},ci.prototype.interpolationFactor=function(e,t,r){return this.interpolationType?cn.interpolationFactor(this.interpolationType,e,t,r):0};var ko=function(e,t){this._parameters=e,this._specification=t,ze(this,function r(a,u){var c,f,y,x=u.type==="color",w=a.stops&&typeof a.stops[0][0]=="object",I=w||!(w||a.property!==void 0),A=a.type||(ca(u)?"exponential":"interval");if(x&&((a=ze({},a)).stops&&(a.stops=a.stops.map(function(ut){return[ut[0],pr.parse(ut[1])]})),a.default=pr.parse(a.default?a.default:u.default)),a.colorSpace&&a.colorSpace!=="rgb"&&!Ca[a.colorSpace])throw new Error("Unknown color space: "+a.colorSpace);if(A==="exponential")c=xs;else if(A==="interval")c=_s;else if(A==="categorical"){c=vs,f=Object.create(null);for(var z=0,O=a.stops;z<O.length;z+=1){var Z=O[z];f[Z[0]]=Z[1]}y=typeof a.stops[0][0]}else{if(A!=="identity")throw new Error('Unknown function type "'+A+'"');c=za}if(w){for(var X={},re=[],Y=0;Y<a.stops.length;Y++){var ce=a.stops[Y],ve=ce[0].zoom;X[ve]===void 0&&(X[ve]={zoom:ve,type:a.type,property:a.property,default:a.default,stops:[]},re.push(ve)),X[ve].stops.push([ce[0].value,ce[1]])}for(var xe=[],Te=0,Me=re;Te<Me.length;Te+=1){var Ue=Me[Te];xe.push([X[Ue].zoom,r(X[Ue],u)])}var Je={name:"linear"};return{kind:"composite",interpolationType:Je,interpolationFactor:cn.interpolationFactor.bind(void 0,Je),zoomStops:xe.map(function(ut){return ut[0]}),evaluate:function(ut,St){var lt=ut.zoom;return xs({stops:xe,base:a.base},u,lt).evaluate(lt,St)}}}if(I){var xt=A==="exponential"?{name:"exponential",base:a.base!==void 0?a.base:1}:null;return{kind:"camera",interpolationType:xt,interpolationFactor:cn.interpolationFactor.bind(void 0,xt),zoomStops:a.stops.map(function(ut){return ut[0]}),evaluate:function(ut){return c(a,u,ut.zoom,f,y)}}}return{kind:"source",evaluate:function(ut,St){var lt=St&&St.properties?St.properties[a.property]:void 0;return lt===void 0?pa(a.default,u.default):c(a,u,lt,f,y)}}}(this._parameters,this._specification))};function nn(e){var t=e.key,r=e.value,a=e.valueSpec||{},u=e.objectElementValidators||{},c=e.style,f=e.styleSpec,y=[],x=kr(r);if(x!=="object")return[new J(t,r,"object expected, "+x+" found")];for(var w in r){var I=w.split(".")[0],A=a[I]||a["*"],z=void 0;if(u[I])z=u[I];else if(a[I])z=oe;else if(u["*"])z=u["*"];else{if(!a["*"]){y.push(new J(t,r[w],'unknown property "'+w+'"'));continue}z=oe}y=y.concat(z({key:(t&&t+".")+w,value:r[w],valueSpec:A,style:c,styleSpec:f,object:r,objectKey:w},r))}for(var O in a)u[O]||a[O].required&&a[O].default===void 0&&r[O]===void 0&&y.push(new J(t,r,'missing required property "'+O+'"'));return y}function Gs(e){var t=e.value,r=e.valueSpec,a=e.style,u=e.styleSpec,c=e.key,f=e.arrayElementValidator||oe;if(kr(t)!=="array")return[new J(c,t,"array expected, "+kr(t)+" found")];if(r.length&&t.length!==r.length)return[new J(c,t,"array length "+r.length+" expected, length "+t.length+" found")];if(r["min-length"]&&t.length<r["min-length"])return[new J(c,t,"array length at least "+r["min-length"]+" expected, length "+t.length+" found")];var y={type:r.value,values:r.values};u.$version<7&&(y.function=r.function),kr(r.value)==="object"&&(y=r.value);for(var x=[],w=0;w<t.length;w++)x=x.concat(f({array:t,arrayIndex:w,value:t[w],valueSpec:y,style:a,styleSpec:u,key:c+"["+w+"]"}));return x}function ts(e){var t=e.key,r=e.value,a=e.valueSpec,u=kr(r);return u==="number"&&r!=r&&(u="NaN"),u!=="number"?[new J(t,r,"number expected, "+u+" found")]:"minimum"in a&&r<a.minimum?[new J(t,r,r+" is less than the minimum value "+a.minimum)]:"maximum"in a&&r>a.maximum?[new J(t,r,r+" is greater than the maximum value "+a.maximum)]:[]}function bs(e){var t,r,a,u=e.valueSpec,c=Be(e.value.type),f={},y=c!=="categorical"&&e.value.property===void 0,x=!y,w=kr(e.value.stops)==="array"&&kr(e.value.stops[0])==="array"&&kr(e.value.stops[0][0])==="object",I=nn({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(O){if(c==="identity")return[new J(O.key,O.value,'identity function may not have a "stops" property')];var Z=[],X=O.value;return Z=Z.concat(Gs({key:O.key,value:X,valueSpec:O.valueSpec,style:O.style,styleSpec:O.styleSpec,arrayElementValidator:A})),kr(X)==="array"&&X.length===0&&Z.push(new J(O.key,X,"array must have at least one stop")),Z},default:function(O){return oe({key:O.key,value:O.value,valueSpec:u,style:O.style,styleSpec:O.styleSpec})}}});return c==="identity"&&y&&I.push(new J(e.key,e.value,'missing required property "property"')),c==="identity"||e.value.stops||I.push(new J(e.key,e.value,'missing required property "stops"')),c==="exponential"&&e.valueSpec.expression&&!ca(e.valueSpec)&&I.push(new J(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(x&&!Po(e.valueSpec)?I.push(new J(e.key,e.value,"property functions not supported")):y&&!qs(e.valueSpec)&&I.push(new J(e.key,e.value,"zoom functions not supported"))),c!=="categorical"&&!w||e.value.property!==void 0||I.push(new J(e.key,e.value,'"property" property is required')),I;function A(O){var Z=[],X=O.value,re=O.key;if(kr(X)!=="array")return[new J(re,X,"array expected, "+kr(X)+" found")];if(X.length!==2)return[new J(re,X,"array length 2 expected, length "+X.length+" found")];if(w){if(kr(X[0])!=="object")return[new J(re,X,"object expected, "+kr(X[0])+" found")];if(X[0].zoom===void 0)return[new J(re,X,"object stop key must have zoom")];if(X[0].value===void 0)return[new J(re,X,"object stop key must have value")];if(a&&a>Be(X[0].zoom))return[new J(re,X[0].zoom,"stop zoom values must appear in ascending order")];Be(X[0].zoom)!==a&&(a=Be(X[0].zoom),r=void 0,f={}),Z=Z.concat(nn({key:re+"[0]",value:X[0],valueSpec:{zoom:{}},style:O.style,styleSpec:O.styleSpec,objectElementValidators:{zoom:ts,value:z}}))}else Z=Z.concat(z({key:re+"[0]",value:X[0],style:O.style,styleSpec:O.styleSpec},X));return Da(Ee(X[1]))?Z.concat([new J(re+"[1]",X[1],"expressions are not allowed in function stops.")]):Z.concat(oe({key:re+"[1]",value:X[1],valueSpec:u,style:O.style,styleSpec:O.styleSpec}))}function z(O,Z){var X=kr(O.value),re=Be(O.value),Y=O.value!==null?O.value:Z;if(t){if(X!==t)return[new J(O.key,Y,X+" stop domain type must match previous stop domain type "+t)]}else t=X;if(X!=="number"&&X!=="string"&&X!=="boolean")return[new J(O.key,Y,"stop domain value must be a number, string, or boolean")];if(X!=="number"&&c!=="categorical"){var ce="number expected, "+X+" found";return Po(u)&&c===void 0&&(ce+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new J(O.key,Y,ce)]}return c!=="categorical"||X!=="number"||isFinite(re)&&Math.floor(re)===re?c!=="categorical"&&X==="number"&&r!==void 0&&re<r?[new J(O.key,Y,"stop domain values must appear in ascending order")]:(r=re,c==="categorical"&&re in f?[new J(O.key,Y,"stop domain values must be unique")]:(f[re]=!0,[])):[new J(O.key,Y,"integer expected, found "+re)]}}function Ci(e){var t=(e.expressionContext==="property"?rn:es)(Ee(e.value),e.valueSpec);if(t.result==="error")return t.value.map(function(a){return new J(""+e.key+a.key,e.value,a.message)});var r=t.value.expression||t.value._styleExpression.expression;if(e.expressionContext==="property"&&e.propertyKey==="text-font"&&!r.outputDefined())return[new J(e.key,e.value,'Invalid data expression for "'+e.propertyKey+'". Output values must be contained as literals within the expression.')];if(e.expressionContext==="property"&&e.propertyType==="layout"&&!io(r))return[new J(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if(e.expressionContext==="filter"&&!io(r))return[new J(e.key,e.value,'"feature-state" data expressions are not supported with filters.')];if(e.expressionContext&&e.expressionContext.indexOf("cluster")===0){if(!No(r,["zoom","feature-state"]))return[new J(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(e.expressionContext==="cluster-initial"&&!jn(r))return[new J(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function $o(e){var t=e.key,r=e.value,a=e.valueSpec,u=[];return Array.isArray(a.values)?a.values.indexOf(Be(r))===-1&&u.push(new J(t,r,"expected one of ["+a.values.join(", ")+"], "+JSON.stringify(r)+" found")):Object.keys(a.values).indexOf(Be(r))===-1&&u.push(new J(t,r,"expected one of ["+Object.keys(a.values).join(", ")+"], "+JSON.stringify(r)+" found")),u}function Mo(e){if(e===!0||e===!1)return!0;if(!Array.isArray(e)||e.length===0)return!1;switch(e[0]){case"has":return e.length>=2&&e[1]!=="$id"&&e[1]!=="$type";case"in":return e.length>=3&&(typeof e[1]!="string"||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return e.length!==3||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(var t=0,r=e.slice(1);t<r.length;t+=1){var a=r[t];if(!Mo(a)&&typeof a!="boolean")return!1}return!0;default:return!0}}ko.deserialize=function(e){return new ko(e._parameters,e._specification)},ko.serialize=function(e){return{_parameters:e._parameters,_specification:e._specification}};var lo={type:"boolean",default:!1};function La(e){if(e==null)return{filter:function(){return!0},needGeometry:!1};Mo(e)||(e=g(e));var t=es(e,lo);if(t.result==="error")throw new Error(t.value.map(function(r){return r.key+": "+r.message}).join(", "));return{filter:function(r,a,u){return t.value.evaluate(r,a,{},u)},needGeometry:function r(a){if(!Array.isArray(a))return!1;if(a[0]==="within")return!0;for(var u=1;u<a.length;u++)if(r(a[u]))return!0;return!1}(e)}}function h(e,t){return e<t?-1:e>t?1:0}function g(e){if(!e)return!0;var t,r=e[0];return e.length<=1?r!=="any":r==="=="?b(e[1],e[2],"=="):r==="!="?R(b(e[1],e[2],"==")):r==="<"||r===">"||r==="<="||r===">="?b(e[1],e[2],r):r==="any"?(t=e.slice(1),["any"].concat(t.map(g))):r==="all"?["all"].concat(e.slice(1).map(g)):r==="none"?["all"].concat(e.slice(1).map(g).map(R)):r==="in"?T(e[1],e.slice(2)):r==="!in"?R(T(e[1],e.slice(2))):r==="has"?k(e[1]):r==="!has"?R(k(e[1])):r!=="within"||e}function b(e,t,r){switch(e){case"$type":return["filter-type-"+r,t];case"$id":return["filter-id-"+r,t];default:return["filter-"+r,e,t]}}function T(e,t){if(t.length===0)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(function(r){return typeof r!=typeof t[0]})?["filter-in-large",e,["literal",t.sort(h)]]:["filter-in-small",e,["literal",t]]}}function k(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function R(e){return["!",e]}function K(e){return Mo(Ee(e.value))?Ci(ze({},e,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function t(r){var a=r.value,u=r.key;if(kr(a)!=="array")return[new J(u,a,"array expected, "+kr(a)+" found")];var c,f=r.styleSpec,y=[];if(a.length<1)return[new J(u,a,"filter array must have at least 1 element")];switch(y=y.concat($o({key:u+"[0]",value:a[0],valueSpec:f.filter_operator,style:r.style,styleSpec:r.styleSpec})),Be(a[0])){case"<":case"<=":case">":case">=":a.length>=2&&Be(a[1])==="$type"&&y.push(new J(u,a,'"$type" cannot be use with operator "'+a[0]+'"'));case"==":case"!=":a.length!==3&&y.push(new J(u,a,'filter array for operator "'+a[0]+'" must have 3 elements'));case"in":case"!in":a.length>=2&&(c=kr(a[1]))!=="string"&&y.push(new J(u+"[1]",a[1],"string expected, "+c+" found"));for(var x=2;x<a.length;x++)c=kr(a[x]),Be(a[1])==="$type"?y=y.concat($o({key:u+"["+x+"]",value:a[x],valueSpec:f.geometry_type,style:r.style,styleSpec:r.styleSpec})):c!=="string"&&c!=="number"&&c!=="boolean"&&y.push(new J(u+"["+x+"]",a[x],"string, number, or boolean expected, "+c+" found"));break;case"any":case"all":case"none":for(var w=1;w<a.length;w++)y=y.concat(t({key:u+"["+w+"]",value:a[w],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":c=kr(a[1]),a.length!==2?y.push(new J(u,a,'filter array for "'+a[0]+'" operator must have 2 elements')):c!=="string"&&y.push(new J(u+"[1]",a[1],"string expected, "+c+" found"));break;case"within":c=kr(a[1]),a.length!==2?y.push(new J(u,a,'filter array for "'+a[0]+'" operator must have 2 elements')):c!=="object"&&y.push(new J(u+"[1]",a[1],"object expected, "+c+" found"))}return y}(e)}function te(e,t){var r=e.key,a=e.style,u=e.styleSpec,c=e.value,f=e.objectKey,y=u[t+"_"+e.layerType];if(!y)return[];var x=f.match(/^(.*)-transition$/);if(t==="paint"&&x&&y[x[1]]&&y[x[1]].transition)return oe({key:r,value:c,valueSpec:u.transition,style:a,styleSpec:u});var w,I=e.valueSpec||y[f];if(!I)return[new J(r,c,'unknown property "'+f+'"')];if(kr(c)==="string"&&Po(I)&&!I.tokens&&(w=/^{([^}]+)}$/.exec(c)))return[new J(r,c,'"'+f+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(w[1])+" }`.")];var A=[];return e.layerType==="symbol"&&(f==="text-field"&&a&&!a.glyphs&&A.push(new J(r,c,'use of "text-field" requires a style "glyphs" property')),f==="text-font"&&Ma(Ee(c))&&Be(c.type)==="identity"&&A.push(new J(r,c,'"text-font" does not support identity functions'))),A.concat(oe({key:e.key,value:c,valueSpec:I,style:a,styleSpec:u,expressionContext:"property",propertyType:t,propertyKey:f}))}function le(e){return te(e,"paint")}function he(e){return te(e,"layout")}function ge(e){var t=[],r=e.value,a=e.key,u=e.style,c=e.styleSpec;r.type||r.ref||t.push(new J(a,r,'either "type" or "ref" is required'));var f,y=Be(r.type),x=Be(r.ref);if(r.id)for(var w=Be(r.id),I=0;I<e.arrayIndex;I++){var A=u.layers[I];Be(A.id)===w&&t.push(new J(a,r.id,'duplicate layer id "'+r.id+'", previously used at line '+A.id.__line__))}if("ref"in r)["type","source","source-layer","filter","layout"].forEach(function(Z){Z in r&&t.push(new J(a,r[Z],'"'+Z+'" is prohibited for ref layers'))}),u.layers.forEach(function(Z){Be(Z.id)===x&&(f=Z)}),f?f.ref?t.push(new J(a,r.ref,"ref cannot reference another ref layer")):y=Be(f.type):t.push(new J(a,r.ref,'ref layer "'+x+'" not found'));else if(y!=="background")if(r.source){var z=u.sources&&u.sources[r.source],O=z&&Be(z.type);z?O==="vector"&&y==="raster"?t.push(new J(a,r.source,'layer "'+r.id+'" requires a raster source')):O==="raster"&&y!=="raster"?t.push(new J(a,r.source,'layer "'+r.id+'" requires a vector source')):O!=="vector"||r["source-layer"]?O==="raster-dem"&&y!=="hillshade"?t.push(new J(a,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):y!=="line"||!r.paint||!r.paint["line-gradient"]||O==="geojson"&&z.lineMetrics||t.push(new J(a,r,'layer "'+r.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):t.push(new J(a,r,'layer "'+r.id+'" must specify a "source-layer"')):t.push(new J(a,r.source,'source "'+r.source+'" not found'))}else t.push(new J(a,r,'missing required property "source"'));return t=t.concat(nn({key:a,value:r,valueSpec:c.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return oe({key:a+".type",value:r.type,valueSpec:c.layer.type,style:e.style,styleSpec:e.styleSpec,object:r,objectKey:"type"})},filter:K,layout:function(Z){return nn({layer:r,key:Z.key,value:Z.value,style:Z.style,styleSpec:Z.styleSpec,objectElementValidators:{"*":function(X){return he(ze({layerType:y},X))}}})},paint:function(Z){return nn({layer:r,key:Z.key,value:Z.value,style:Z.style,styleSpec:Z.styleSpec,objectElementValidators:{"*":function(X){return le(ze({layerType:y},X))}}})}}}))}function ie(e){var t=e.value,r=e.key,a=kr(t);return a!=="string"?[new J(r,t,"string expected, "+a+" found")]:[]}var fe={promoteId:function(e){var t=e.key,r=e.value;if(kr(r)==="string")return ie({key:t,value:r});var a=[];for(var u in r)a.push.apply(a,ie({key:t+"."+u,value:r[u]}));return a}};function pe(e){var t=e.value,r=e.key,a=e.styleSpec,u=e.style;if(!t.type)return[new J(r,t,'"type" is required')];var c,f=Be(t.type);switch(f){case"vector":case"raster":case"raster-dem":return nn({key:r,value:t,valueSpec:a["source_"+f.replace("-","_")],style:e.style,styleSpec:a,objectElementValidators:fe});case"geojson":if(c=nn({key:r,value:t,valueSpec:a.source_geojson,style:u,styleSpec:a,objectElementValidators:fe}),t.cluster)for(var y in t.clusterProperties){var x=t.clusterProperties[y],w=x[0],I=typeof w=="string"?[w,["accumulated"],["get",y]]:w;c.push.apply(c,Ci({key:r+"."+y+".map",value:x[1],expressionContext:"cluster-map"})),c.push.apply(c,Ci({key:r+"."+y+".reduce",value:I,expressionContext:"cluster-reduce"}))}return c;case"video":return nn({key:r,value:t,valueSpec:a.source_video,style:u,styleSpec:a});case"image":return nn({key:r,value:t,valueSpec:a.source_image,style:u,styleSpec:a});case"canvas":return[new J(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return $o({key:r+".type",value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function de(e){var t=e.value,r=e.styleSpec,a=r.light,u=e.style,c=[],f=kr(t);if(t===void 0)return c;if(f!=="object")return c.concat([new J("light",t,"object expected, "+f+" found")]);for(var y in t){var x=y.match(/^(.*)-transition$/);c=c.concat(x&&a[x[1]]&&a[x[1]].transition?oe({key:y,value:t[y],valueSpec:r.transition,style:u,styleSpec:r}):a[y]?oe({key:y,value:t[y],valueSpec:a[y],style:u,styleSpec:r}):[new J(y,t[y],'unknown property "'+y+'"')])}return c}var _e={"*":function(){return[]},array:Gs,boolean:function(e){var t=e.value,r=e.key,a=kr(t);return a!=="boolean"?[new J(r,t,"boolean expected, "+a+" found")]:[]},number:ts,color:function(e){var t=e.key,r=e.value,a=kr(r);return a!=="string"?[new J(t,r,"color expected, "+a+" found")]:Zt(r)===null?[new J(t,r,'color expected, "'+r+'" found')]:[]},constants:se,enum:$o,filter:K,function:bs,layer:ge,object:nn,source:pe,light:de,string:ie,formatted:function(e){return ie(e).length===0?[]:Ci(e)},resolvedImage:function(e){return ie(e).length===0?[]:Ci(e)}};function oe(e){var t=e.value,r=e.valueSpec,a=e.styleSpec;return r.expression&&Ma(Be(t))?bs(e):r.expression&&Da(Ee(t))?Ci(e):r.type&&_e[r.type]?_e[r.type](e):nn(ze({},e,{valueSpec:r.type?a[r.type]:r}))}function ye(e){var t=e.value,r=e.key,a=ie(e);return a.length||(t.indexOf("{fontstack}")===-1&&a.push(new J(r,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&a.push(new J(r,t,'"glyphs" url must include a "{range}" token'))),a}function Ie(e,t){t===void 0&&(t=L);var r=[];return r=r.concat(oe({key:"",value:e,valueSpec:t.$root,styleSpec:t,style:e,objectElementValidators:{glyphs:ye,"*":function(){return[]}}})),e.constants&&(r=r.concat(se({key:"constants",value:e.constants}))),Pe(r)}function Pe(e){return[].concat(e).sort(function(t,r){return t.line-r.line})}function De(e){return function(){for(var t=[],r=arguments.length;r--;)t[r]=arguments[r];return Pe(e.apply(this,t))}}Ie.source=De(pe),Ie.light=De(de),Ie.layer=De(ge),Ie.filter=De(K),Ie.paintProperty=De(le),Ie.layoutProperty=De(he);var $e=Ie,ht=$e.light,tt=$e.paintProperty,rt=$e.layoutProperty;function ft(e,t){var r=!1;if(t&&t.length)for(var a=0,u=t;a<u.length;a+=1)e.fire(new ne(new Error(u[a].message))),r=!0;return r}var nt=at;function at(e,t,r){var a=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var u=new Int32Array(this.arrayBuffer);e=u[0],this.d=(t=u[1])+2*(r=u[2]);for(var c=0;c<this.d*this.d;c++){var f=u[3+c],y=u[3+c+1];a.push(f===y?null:u.subarray(f,y))}var x=u[3+a.length+1];this.keys=u.subarray(u[3+a.length],x),this.bboxes=u.subarray(x),this.insert=this._insertReadonly}else{this.d=t+2*r;for(var w=0;w<this.d*this.d;w++)a.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=r,this.scale=t/e,this.uid=0;var I=r/t*e;this.min=-I,this.max=e+I}at.prototype.insert=function(e,t,r,a,u){this._forEachCell(t,r,a,u,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(r),this.bboxes.push(a),this.bboxes.push(u)},at.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},at.prototype._insertCell=function(e,t,r,a,u,c){this.cells[u].push(c)},at.prototype.query=function(e,t,r,a,u){var c=this.min,f=this.max;if(e<=c&&t<=c&&f<=r&&f<=a&&!u)return Array.prototype.slice.call(this.keys);var y=[];return this._forEachCell(e,t,r,a,this._queryCell,y,{},u),y},at.prototype._queryCell=function(e,t,r,a,u,c,f,y){var x=this.cells[u];if(x!==null)for(var w=this.keys,I=this.bboxes,A=0;A<x.length;A++){var z=x[A];if(f[z]===void 0){var O=4*z;(y?y(I[O+0],I[O+1],I[O+2],I[O+3]):e<=I[O+2]&&t<=I[O+3]&&r>=I[O+0]&&a>=I[O+1])?(f[z]=!0,c.push(w[z])):f[z]=!1}}},at.prototype._forEachCell=function(e,t,r,a,u,c,f,y){for(var x=this._convertToCellCoord(e),w=this._convertToCellCoord(t),I=this._convertToCellCoord(r),A=this._convertToCellCoord(a),z=x;z<=I;z++)for(var O=w;O<=A;O++){var Z=this.d*O+z;if((!y||y(this._convertFromCellCoord(z),this._convertFromCellCoord(O),this._convertFromCellCoord(z+1),this._convertFromCellCoord(O+1)))&&u.call(this,e,t,r,a,Z,c,f,y))return}},at.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},at.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},at.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=3+this.cells.length+1+1,r=0,a=0;a<this.cells.length;a++)r+=this.cells[a].length;var u=new Int32Array(t+r+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;for(var c=t,f=0;f<e.length;f++){var y=e[f];u[3+f]=c,u.set(y,c),c+=y.length}return u[3+e.length]=c,u.set(this.keys,c),u[3+e.length+1]=c+=this.keys.length,u.set(this.bboxes,c),c+=this.bboxes.length,u.buffer};var $t=Xe.ImageData,hr=Xe.ImageBitmap,Pt={};function Qe(e,t,r){r===void 0&&(r={}),Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),Pt[e]={klass:t,omit:r.omit||[],shallow:r.shallow||[]}}for(var Lt in Qe("Object",Object),nt.serialize=function(e,t){var r=e.toArrayBuffer();return t&&t.push(r),{buffer:r}},nt.deserialize=function(e){return new nt(e.buffer)},Qe("Grid",nt),Qe("Color",pr),Qe("Error",Error),Qe("ResolvedImage",j),Qe("StylePropertyFunction",ko),Qe("StyleExpression",ha,{omit:["_evaluator"]}),Qe("ZoomDependentExpression",ci),Qe("ZoomConstantExpression",qo),Qe("CompoundExpression",Kt,{omit:["_evaluate"]}),Co)Co[Lt]._classRegistryKey||Qe("Expression_"+Lt,Co[Lt]);function Cn(e){return e&&typeof ArrayBuffer<"u"&&(e instanceof ArrayBuffer||e.constructor&&e.constructor.name==="ArrayBuffer")}function pn(e){return hr&&e instanceof hr}function pi(e,t){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(Cn(e)||pn(e))return t&&t.push(e),e;if(ArrayBuffer.isView(e)){var r=e;return t&&t.push(r.buffer),r}if(e instanceof $t)return t&&t.push(e.data.buffer),e;if(Array.isArray(e)){for(var a=[],u=0,c=e;u<c.length;u+=1)a.push(pi(c[u],t));return a}if(typeof e=="object"){var f=e.constructor,y=f._classRegistryKey;if(!y)throw new Error("can't serialize object of unregistered class");var x=f.serialize?f.serialize(e,t):{};if(!f.serialize){for(var w in e)if(e.hasOwnProperty(w)&&!(Pt[y].omit.indexOf(w)>=0)){var I=e[w];x[w]=Pt[y].shallow.indexOf(w)>=0?I:pi(I,t)}e instanceof Error&&(x.message=e.message)}if(x.$name)throw new Error("$name property is reserved for worker serialization logic.");return y!=="Object"&&(x.$name=y),x}throw new Error("can't serialize object of type "+typeof e)}function Lr(e){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||Cn(e)||pn(e)||ArrayBuffer.isView(e)||e instanceof $t)return e;if(Array.isArray(e))return e.map(Lr);if(typeof e=="object"){var t=e.$name||"Object",r=Pt[t].klass;if(!r)throw new Error("can't deserialize unregistered class "+t);if(r.deserialize)return r.deserialize(e);for(var a=Object.create(r.prototype),u=0,c=Object.keys(e);u<c.length;u+=1){var f=c[u];if(f!=="$name"){var y=e[f];a[f]=Pt[t].shallow.indexOf(f)>=0?y:Lr(y)}}return a}throw new Error("can't deserialize object of type "+typeof e)}var zo=function(){this.first=!0};zo.prototype.update=function(e,t){var r=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=r,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=r,!0):(this.lastFloorZoom>r?(this.lastIntegerZoom=r+1,this.lastIntegerZoomTime=t):this.lastFloorZoom<r&&(this.lastIntegerZoom=r,this.lastIntegerZoomTime=t),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=r,!0))};var He={"Latin-1 Supplement":function(e){return e>=128&&e<=255},Arabic:function(e){return e>=1536&&e<=1791},"Arabic Supplement":function(e){return e>=1872&&e<=1919},"Arabic Extended-A":function(e){return e>=2208&&e<=2303},"Hangul Jamo":function(e){return e>=4352&&e<=4607},"Unified Canadian Aboriginal Syllabics":function(e){return e>=5120&&e<=5759},Khmer:function(e){return e>=6016&&e<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(e){return e>=6320&&e<=6399},"General Punctuation":function(e){return e>=8192&&e<=8303},"Letterlike Symbols":function(e){return e>=8448&&e<=8527},"Number Forms":function(e){return e>=8528&&e<=8591},"Miscellaneous Technical":function(e){return e>=8960&&e<=9215},"Control Pictures":function(e){return e>=9216&&e<=9279},"Optical Character Recognition":function(e){return e>=9280&&e<=9311},"Enclosed Alphanumerics":function(e){return e>=9312&&e<=9471},"Geometric Shapes":function(e){return e>=9632&&e<=9727},"Miscellaneous Symbols":function(e){return e>=9728&&e<=9983},"Miscellaneous Symbols and Arrows":function(e){return e>=11008&&e<=11263},"CJK Radicals Supplement":function(e){return e>=11904&&e<=12031},"Kangxi Radicals":function(e){return e>=12032&&e<=12255},"Ideographic Description Characters":function(e){return e>=12272&&e<=12287},"CJK Symbols and Punctuation":function(e){return e>=12288&&e<=12351},Hiragana:function(e){return e>=12352&&e<=12447},Katakana:function(e){return e>=12448&&e<=12543},Bopomofo:function(e){return e>=12544&&e<=12591},"Hangul Compatibility Jamo":function(e){return e>=12592&&e<=12687},Kanbun:function(e){return e>=12688&&e<=12703},"Bopomofo Extended":function(e){return e>=12704&&e<=12735},"CJK Strokes":function(e){return e>=12736&&e<=12783},"Katakana Phonetic Extensions":function(e){return e>=12784&&e<=12799},"Enclosed CJK Letters and Months":function(e){return e>=12800&&e<=13055},"CJK Compatibility":function(e){return e>=13056&&e<=13311},"CJK Unified Ideographs Extension A":function(e){return e>=13312&&e<=19903},"Yijing Hexagram Symbols":function(e){return e>=19904&&e<=19967},"CJK Unified Ideographs":function(e){return e>=19968&&e<=40959},"Yi Syllables":function(e){return e>=40960&&e<=42127},"Yi Radicals":function(e){return e>=42128&&e<=42191},"Hangul Jamo Extended-A":function(e){return e>=43360&&e<=43391},"Hangul Syllables":function(e){return e>=44032&&e<=55215},"Hangul Jamo Extended-B":function(e){return e>=55216&&e<=55295},"Private Use Area":function(e){return e>=57344&&e<=63743},"CJK Compatibility Ideographs":function(e){return e>=63744&&e<=64255},"Arabic Presentation Forms-A":function(e){return e>=64336&&e<=65023},"Vertical Forms":function(e){return e>=65040&&e<=65055},"CJK Compatibility Forms":function(e){return e>=65072&&e<=65103},"Small Form Variants":function(e){return e>=65104&&e<=65135},"Arabic Presentation Forms-B":function(e){return e>=65136&&e<=65279},"Halfwidth and Fullwidth Forms":function(e){return e>=65280&&e<=65519}};function Pu(e){for(var t=0,r=e;t<r.length;t+=1)if(Ks(r[t].charCodeAt(0)))return!0;return!1}function Ks(e){return!(e!==746&&e!==747&&(e<4352||!(He["Bopomofo Extended"](e)||He.Bopomofo(e)||He["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||He["CJK Compatibility Ideographs"](e)||He["CJK Compatibility"](e)||He["CJK Radicals Supplement"](e)||He["CJK Strokes"](e)||!(!He["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||e===12336)||He["CJK Unified Ideographs Extension A"](e)||He["CJK Unified Ideographs"](e)||He["Enclosed CJK Letters and Months"](e)||He["Hangul Compatibility Jamo"](e)||He["Hangul Jamo Extended-A"](e)||He["Hangul Jamo Extended-B"](e)||He["Hangul Jamo"](e)||He["Hangul Syllables"](e)||He.Hiragana(e)||He["Ideographic Description Characters"](e)||He.Kanbun(e)||He["Kangxi Radicals"](e)||He["Katakana Phonetic Extensions"](e)||He.Katakana(e)&&e!==12540||!(!He["Halfwidth and Fullwidth Forms"](e)||e===65288||e===65289||e===65293||e>=65306&&e<=65310||e===65339||e===65341||e===65343||e>=65371&&e<=65503||e===65507||e>=65512&&e<=65519)||!(!He["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||He["Unified Canadian Aboriginal Syllabics"](e)||He["Unified Canadian Aboriginal Syllabics Extended"](e)||He["Vertical Forms"](e)||He["Yijing Hexagram Symbols"](e)||He["Yi Syllables"](e)||He["Yi Radicals"](e))))}function ku(e){return!(Ks(e)||function(t){return!!(He["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||He["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||He["Letterlike Symbols"](t)||He["Number Forms"](t)||He["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||He["Control Pictures"](t)&&t!==9251||He["Optical Character Recognition"](t)||He["Enclosed Alphanumerics"](t)||He["Geometric Shapes"](t)||He["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||He["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||He["CJK Symbols and Punctuation"](t)||He.Katakana(t)||He["Private Use Area"](t)||He["CJK Compatibility Forms"](t)||He["Small Form Variants"](t)||He["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(e))}function co(e){return e>=1424&&e<=2303||He["Arabic Presentation Forms-A"](e)||He["Arabic Presentation Forms-B"](e)}function Zi(e,t){return!(!t&&co(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||He.Khmer(e))}function Xs(e){for(var t=0,r=e;t<r.length;t+=1)if(co(r[t].charCodeAt(0)))return!0;return!1}var Ws=null,Gi="unavailable",Qo=null,cl=function(e){e&&typeof e=="string"&&e.indexOf("NetworkError")>-1&&(Gi="error"),Ws&&Ws(e)};function ws(){Mu.fire(new G("pluginStateChange",{pluginStatus:Gi,pluginURL:Qo}))}var Mu=new $,zu=function(){return Gi},Do=function(){if(Gi!=="deferred"||!Qo)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Gi="loading",ws(),Qo&&xo({url:Qo},function(e){e?cl(e):(Gi="loaded",ws())})},eo={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Gi==="loaded"||eo.applyArabicShaping!=null},isLoading:function(){return Gi==="loading"},setState:function(e){Gi=e.pluginStatus,Qo=e.pluginURL},isParsed:function(){return eo.applyArabicShaping!=null&&eo.processBidirectionalText!=null&&eo.processStyledBidirectionalText!=null},getPluginURL:function(){return Qo}},ar=function(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.zoomHistory=t.zoomHistory,this.transition=t.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new zo,this.transition={})};ar.prototype.isSupportedScript=function(e){return function(t,r){for(var a=0,u=t;a<u.length;a+=1)if(!Zi(u[a].charCodeAt(0),r))return!1;return!0}(e,eo.isLoaded())},ar.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},ar.prototype.getCrossfadeParameters=function(){var e=this.zoom,t=e-Math.floor(e),r=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:t+(1-t)*r}:{fromScale:.5,toScale:1,t:1-(1-r)*t}};var Zo=function(e,t){this.property=e,this.value=t,this.expression=function(r,a){if(Ma(r))return new ko(r,a);if(Da(r)){var u=rn(r,a);if(u.result==="error")throw new Error(u.value.map(function(f){return f.key+": "+f.message}).join(", "));return u.value}var c=r;return typeof r=="string"&&a.type==="color"&&(c=pr.parse(r)),{kind:"constant",evaluate:function(){return c}}}(t===void 0?e.specification.default:t,e.specification)};Zo.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},Zo.prototype.possiblyEvaluate=function(e,t,r){return this.property.possiblyEvaluate(this,e,t,r)};var po=function(e){this.property=e,this.value=new Zo(e,void 0)};po.prototype.transitioned=function(e,t){return new Oa(this.property,this.value,t,dr({},e.transition,this.transition),e.now)},po.prototype.untransitioned=function(){return new Oa(this.property,this.value,null,{},0)};var Jn=function(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)};Jn.prototype.getValue=function(e){return si(this._values[e].value.value)},Jn.prototype.setValue=function(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new po(this._values[e].property)),this._values[e].value=new Zo(this._values[e].property,t===null?void 0:si(t))},Jn.prototype.getTransition=function(e){return si(this._values[e].transition)},Jn.prototype.setTransition=function(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new po(this._values[e].property)),this._values[e].transition=si(t)||void 0},Jn.prototype.serialize=function(){for(var e={},t=0,r=Object.keys(this._values);t<r.length;t+=1){var a=r[t],u=this.getValue(a);u!==void 0&&(e[a]=u);var c=this.getTransition(a);c!==void 0&&(e[a+"-transition"]=c)}return e},Jn.prototype.transitioned=function(e,t){for(var r=new fa(this._properties),a=0,u=Object.keys(this._values);a<u.length;a+=1){var c=u[a];r._values[c]=this._values[c].transitioned(e,t._values[c])}return r},Jn.prototype.untransitioned=function(){for(var e=new fa(this._properties),t=0,r=Object.keys(this._values);t<r.length;t+=1){var a=r[t];e._values[a]=this._values[a].untransitioned()}return e};var Oa=function(e,t,r,a,u){this.property=e,this.value=t,this.begin=u+a.delay||0,this.end=this.begin+a.duration||0,e.specification.transition&&(a.delay||a.duration)&&(this.prior=r)};Oa.prototype.possiblyEvaluate=function(e,t,r){var a=e.now||0,u=this.value.possiblyEvaluate(e,t,r),c=this.prior;if(c){if(a>this.end)return this.prior=null,u;if(this.value.isDataDriven())return this.prior=null,u;if(a<this.begin)return c.possiblyEvaluate(e,t,r);var f=(a-this.begin)/(this.end-this.begin);return this.property.interpolate(c.possiblyEvaluate(e,t,r),u,function(y){if(y<=0)return 0;if(y>=1)return 1;var x=y*y,w=x*y;return 4*(y<.5?w:3*(y-x)+w-.75)}(f))}return u};var fa=function(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)};fa.prototype.possiblyEvaluate=function(e,t,r){for(var a=new Es(this._properties),u=0,c=Object.keys(this._values);u<c.length;u+=1){var f=c[u];a._values[f]=this._values[f].possiblyEvaluate(e,t,r)}return a},fa.prototype.hasTransition=function(){for(var e=0,t=Object.keys(this._values);e<t.length;e+=1)if(this._values[t[e]].prior)return!0;return!1};var Lo=function(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)};Lo.prototype.getValue=function(e){return si(this._values[e].value)},Lo.prototype.setValue=function(e,t){this._values[e]=new Zo(this._values[e].property,t===null?void 0:si(t))},Lo.prototype.serialize=function(){for(var e={},t=0,r=Object.keys(this._values);t<r.length;t+=1){var a=r[t],u=this.getValue(a);u!==void 0&&(e[a]=u)}return e},Lo.prototype.possiblyEvaluate=function(e,t,r){for(var a=new Es(this._properties),u=0,c=Object.keys(this._values);u<c.length;u+=1){var f=c[u];a._values[f]=this._values[f].possiblyEvaluate(e,t,r)}return a};var hi=function(e,t,r){this.property=e,this.value=t,this.parameters=r};hi.prototype.isConstant=function(){return this.value.kind==="constant"},hi.prototype.constantOr=function(e){return this.value.kind==="constant"?this.value.value:e},hi.prototype.evaluate=function(e,t,r,a){return this.property.evaluate(this.value,this.parameters,e,t,r,a)};var Es=function(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)};Es.prototype.get=function(e){return this._values[e]};var wt=function(e){this.specification=e};wt.prototype.possiblyEvaluate=function(e,t){return e.expression.evaluate(t)},wt.prototype.interpolate=function(e,t,r){var a=ao[this.specification.type];return a?a(e,t,r):e};var gt=function(e,t){this.specification=e,this.overrides=t};gt.prototype.possiblyEvaluate=function(e,t,r,a){return new hi(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(t,null,{},r,a)}:e.expression,t)},gt.prototype.interpolate=function(e,t,r){if(e.value.kind!=="constant"||t.value.kind!=="constant")return e;if(e.value.value===void 0||t.value.value===void 0)return new hi(this,{kind:"constant",value:void 0},e.parameters);var a=ao[this.specification.type];return a?new hi(this,{kind:"constant",value:a(e.value.value,t.value.value,r)},e.parameters):e},gt.prototype.evaluate=function(e,t,r,a,u,c){return e.kind==="constant"?e.value:e.evaluate(t,r,a,u,c)};var Hs=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.possiblyEvaluate=function(r,a,u,c){if(r.value===void 0)return new hi(this,{kind:"constant",value:void 0},a);if(r.expression.kind==="constant"){var f=r.expression.evaluate(a,null,{},u,c),y=r.property.specification.type==="resolvedImage"&&typeof f!="string"?f.name:f,x=this._calculate(y,y,y,a);return new hi(this,{kind:"constant",value:x},a)}if(r.expression.kind==="camera"){var w=this._calculate(r.expression.evaluate({zoom:a.zoom-1}),r.expression.evaluate({zoom:a.zoom}),r.expression.evaluate({zoom:a.zoom+1}),a);return new hi(this,{kind:"constant",value:w},a)}return new hi(this,r.expression,a)},t.prototype.evaluate=function(r,a,u,c,f,y){if(r.kind==="source"){var x=r.evaluate(a,u,c,f,y);return this._calculate(x,x,x,a)}return r.kind==="composite"?this._calculate(r.evaluate({zoom:Math.floor(a.zoom)-1},u,c),r.evaluate({zoom:Math.floor(a.zoom)},u,c),r.evaluate({zoom:Math.floor(a.zoom)+1},u,c),a):r.value},t.prototype._calculate=function(r,a,u,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:r,to:a}:{from:u,to:a}},t.prototype.interpolate=function(r){return r},t}(gt),fi=function(e){this.specification=e};fi.prototype.possiblyEvaluate=function(e,t,r,a){if(e.value!==void 0){if(e.expression.kind==="constant"){var u=e.expression.evaluate(t,null,{},r,a);return this._calculate(u,u,u,t)}return this._calculate(e.expression.evaluate(new ar(Math.floor(t.zoom-1),t)),e.expression.evaluate(new ar(Math.floor(t.zoom),t)),e.expression.evaluate(new ar(Math.floor(t.zoom+1),t)),t)}},fi.prototype._calculate=function(e,t,r,a){return a.zoom>a.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:r,to:t}},fi.prototype.interpolate=function(e){return e};var Oo=function(e){this.specification=e};Oo.prototype.possiblyEvaluate=function(e,t,r,a){return!!e.expression.evaluate(t,null,{},r,a)},Oo.prototype.interpolate=function(){return!1};var Yn=function(e){for(var t in this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],e){var r=e[t];r.specification.overridable&&this.overridableProperties.push(t);var a=this.defaultPropertyValues[t]=new Zo(r,void 0),u=this.defaultTransitionablePropertyValues[t]=new po(r);this.defaultTransitioningPropertyValues[t]=u.untransitioned(),this.defaultPossiblyEvaluatedValues[t]=a.possiblyEvaluate({})}};Qe("DataDrivenProperty",gt),Qe("DataConstantProperty",wt),Qe("CrossFadedDataDrivenProperty",Hs),Qe("CrossFadedProperty",fi),Qe("ColorRampProperty",Oo);var Go=function(e){function t(r,a){if(e.call(this),this.id=r.id,this.type=r.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},r.type!=="custom"&&(this.metadata=(r=r).metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type!=="background"&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),a.layout&&(this._unevaluatedLayout=new Lo(a.layout)),a.paint)){for(var u in this._transitionablePaint=new Jn(a.paint),r.paint)this.setPaintProperty(u,r.paint[u],{validate:!1});for(var c in r.layout)this.setLayoutProperty(c,r.layout[c],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Es(a.paint)}}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},t.prototype.getLayoutProperty=function(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)},t.prototype.setLayoutProperty=function(r,a,u){u===void 0&&(u={}),a!=null&&this._validate(rt,"layers."+this.id+".layout."+r,r,a,u)||(r!=="visibility"?this._unevaluatedLayout.setValue(r,a):this.visibility=a)},t.prototype.getPaintProperty=function(r){return zi(r,"-transition")?this._transitionablePaint.getTransition(r.slice(0,-11)):this._transitionablePaint.getValue(r)},t.prototype.setPaintProperty=function(r,a,u){if(u===void 0&&(u={}),a!=null&&this._validate(tt,"layers."+this.id+".paint."+r,r,a,u))return!1;if(zi(r,"-transition"))return this._transitionablePaint.setTransition(r.slice(0,-11),a||void 0),!1;var c=this._transitionablePaint._values[r],f=c.property.specification["property-type"]==="cross-faded-data-driven",y=c.value.isDataDriven(),x=c.value;this._transitionablePaint.setValue(r,a),this._handleSpecialPaintPropertyUpdate(r);var w=this._transitionablePaint._values[r].value;return w.isDataDriven()||y||f||this._handleOverridablePaintPropertyUpdate(r,x,w)},t.prototype._handleSpecialPaintPropertyUpdate=function(r){},t.prototype._handleOverridablePaintPropertyUpdate=function(r,a,u){return!1},t.prototype.isHidden=function(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||this.visibility==="none"},t.prototype.updateTransitions=function(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)},t.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},t.prototype.recalculate=function(r,a){r.getCrossfadeParameters&&(this._crossfadeParameters=r.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,a)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,a)},t.prototype.serialize=function(){var r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),vi(r,function(a,u){return!(a===void 0||u==="layout"&&!Object.keys(a).length||u==="paint"&&!Object.keys(a).length)})},t.prototype._validate=function(r,a,u,c,f){return f===void 0&&(f={}),(!f||f.validate!==!1)&&ft(this,r.call($e,{key:a,layerType:this.type,objectKey:u,value:c,styleSpec:L,style:{glyphs:!0,sprite:!0}}))},t.prototype.is3D=function(){return!1},t.prototype.isTileClipped=function(){return!1},t.prototype.hasOffscreenPass=function(){return!1},t.prototype.resize=function(){},t.prototype.isStateDependent=function(){for(var r in this.paint._values){var a=this.paint.get(r);if(a instanceof hi&&Po(a.property.specification)&&(a.value.kind==="source"||a.value.kind==="composite")&&a.value.isStateDependent)return!0}return!1},t}($),Du={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Js=function(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},Tr=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function qn(e,t){t===void 0&&(t=1);var r=0,a=0;return{members:e.map(function(u){var c=Du[u.type].BYTES_PER_ELEMENT,f=r=pl(r,Math.max(t,c)),y=u.components||1;return a=Math.max(a,c),r+=c*y,{name:u.name,type:u.type,components:y,offset:f}}),size:pl(r,Math.max(a,t)),alignment:t}}function pl(e,t){return Math.ceil(e/t)*t}Tr.serialize=function(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}},Tr.deserialize=function(e){var t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t},Tr.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},Tr.prototype.clear=function(){this.length=0},Tr.prototype.resize=function(e){this.reserve(e),this.length=e},Tr.prototype.reserve=function(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}},Tr.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Ra=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,a){var u=this.length;return this.resize(u+1),this.emplace(u,r,a)},t.prototype.emplace=function(r,a,u){var c=2*r;return this.int16[c+0]=a,this.int16[c+1]=u,r},t}(Tr);Ra.prototype.bytesPerElement=4,Qe("StructArrayLayout2i4",Ra);var Lu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,a,u,c){var f=this.length;return this.resize(f+1),this.emplace(f,r,a,u,c)},t.prototype.emplace=function(r,a,u,c,f){var y=4*r;return this.int16[y+0]=a,this.int16[y+1]=u,this.int16[y+2]=c,this.int16[y+3]=f,r},t}(Tr);Lu.prototype.bytesPerElement=8,Qe("StructArrayLayout4i8",Lu);var ea=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,a,u,c,f,y){var x=this.length;return this.resize(x+1),this.emplace(x,r,a,u,c,f,y)},t.prototype.emplace=function(r,a,u,c,f,y,x){var w=6*r;return this.int16[w+0]=a,this.int16[w+1]=u,this.int16[w+2]=c,this.int16[w+3]=f,this.int16[w+4]=y,this.int16[w+5]=x,r},t}(Tr);ea.prototype.bytesPerElement=12,Qe("StructArrayLayout2i4i12",ea);var Ki=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,a,u,c,f,y){var x=this.length;return this.resize(x+1),this.emplace(x,r,a,u,c,f,y)},t.prototype.emplace=function(r,a,u,c,f,y,x){var w=4*r,I=8*r;return this.int16[w+0]=a,this.int16[w+1]=u,this.uint8[I+4]=c,this.uint8[I+5]=f,this.uint8[I+6]=y,this.uint8[I+7]=x,r},t}(Tr);Ki.prototype.bytesPerElement=8,Qe("StructArrayLayout2i4ub8",Ki);var rs=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,a){var u=this.length;return this.resize(u+1),this.emplace(u,r,a)},t.prototype.emplace=function(r,a,u){var c=2*r;return this.float32[c+0]=a,this.float32[c+1]=u,r},t}(Tr);rs.prototype.bytesPerElement=8,Qe("StructArrayLayout2f8",rs);var Ko=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,a,u,c,f,y,x,w,I,A){var z=this.length;return this.resize(z+1),this.emplace(z,r,a,u,c,f,y,x,w,I,A)},t.prototype.emplace=function(r,a,u,c,f,y,x,w,I,A,z){var O=10*r;return this.uint16[O+0]=a,this.uint16[O+1]=u,this.uint16[O+2]=c,this.uint16[O+3]=f,this.uint16[O+4]=y,this.uint16[O+5]=x,this.uint16[O+6]=w,this.uint16[O+7]=I,this.uint16[O+8]=A,this.uint16[O+9]=z,r},t}(Tr);Ko.prototype.bytesPerElement=20,Qe("StructArrayLayout10ui20",Ko);var Ys=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,a,u,c,f,y,x,w,I,A,z,O){var Z=this.length;return this.resize(Z+1),this.emplace(Z,r,a,u,c,f,y,x,w,I,A,z,O)},t.prototype.emplace=function(r,a,u,c,f,y,x,w,I,A,z,O,Z){var X=12*r;return this.int16[X+0]=a,this.int16[X+1]=u,this.int16[X+2]=c,this.int16[X+3]=f,this.uint16[X+4]=y,this.uint16[X+5]=x,this.uint16[X+6]=w,this.uint16[X+7]=I,this.int16[X+8]=A,this.int16[X+9]=z,this.int16[X+10]=O,this.int16[X+11]=Z,r},t}(Tr);Ys.prototype.bytesPerElement=24,Qe("StructArrayLayout4i4ui4i24",Ys);var ns=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,a,u){var c=this.length;return this.resize(c+1),this.emplace(c,r,a,u)},t.prototype.emplace=function(r,a,u,c){var f=3*r;return this.float32[f+0]=a,this.float32[f+1]=u,this.float32[f+2]=c,r},t}(Tr);ns.prototype.bytesPerElement=12,Qe("StructArrayLayout3f12",ns);var Ss=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r){var a=this.length;return this.resize(a+1),this.emplace(a,r)},t.prototype.emplace=function(r,a){return this.uint32[1*r+0]=a,r},t}(Tr);Ss.prototype.bytesPerElement=4,Qe("StructArrayLayout1ul4",Ss);var Ou=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,a,u,c,f,y,x,w,I){var A=this.length;return this.resize(A+1),this.emplace(A,r,a,u,c,f,y,x,w,I)},t.prototype.emplace=function(r,a,u,c,f,y,x,w,I,A){var z=10*r,O=5*r;return this.int16[z+0]=a,this.int16[z+1]=u,this.int16[z+2]=c,this.int16[z+3]=f,this.int16[z+4]=y,this.int16[z+5]=x,this.uint32[O+3]=w,this.uint16[z+8]=I,this.uint16[z+9]=A,r},t}(Tr);Ou.prototype.bytesPerElement=20,Qe("StructArrayLayout6i1ul2ui20",Ou);var is=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,a,u,c,f,y){var x=this.length;return this.resize(x+1),this.emplace(x,r,a,u,c,f,y)},t.prototype.emplace=function(r,a,u,c,f,y,x){var w=6*r;return this.int16[w+0]=a,this.int16[w+1]=u,this.int16[w+2]=c,this.int16[w+3]=f,this.int16[w+4]=y,this.int16[w+5]=x,r},t}(Tr);is.prototype.bytesPerElement=12,Qe("StructArrayLayout2i2i2i12",is);var Ba=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,a,u,c,f){var y=this.length;return this.resize(y+1),this.emplace(y,r,a,u,c,f)},t.prototype.emplace=function(r,a,u,c,f,y){var x=4*r,w=8*r;return this.float32[x+0]=a,this.float32[x+1]=u,this.float32[x+2]=c,this.int16[w+6]=f,this.int16[w+7]=y,r},t}(Tr);Ba.prototype.bytesPerElement=16,Qe("StructArrayLayout2f1f2i16",Ba);var Ru=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,a,u,c){var f=this.length;return this.resize(f+1),this.emplace(f,r,a,u,c)},t.prototype.emplace=function(r,a,u,c,f){var y=12*r,x=3*r;return this.uint8[y+0]=a,this.uint8[y+1]=u,this.float32[x+1]=c,this.float32[x+2]=f,r},t}(Tr);Ru.prototype.bytesPerElement=12,Qe("StructArrayLayout2ub2f12",Ru);var da=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,a,u){var c=this.length;return this.resize(c+1),this.emplace(c,r,a,u)},t.prototype.emplace=function(r,a,u,c){var f=3*r;return this.uint16[f+0]=a,this.uint16[f+1]=u,this.uint16[f+2]=c,r},t}(Tr);da.prototype.bytesPerElement=6,Qe("StructArrayLayout3ui6",da);var ma=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,a,u,c,f,y,x,w,I,A,z,O,Z,X,re,Y,ce){var ve=this.length;return this.resize(ve+1),this.emplace(ve,r,a,u,c,f,y,x,w,I,A,z,O,Z,X,re,Y,ce)},t.prototype.emplace=function(r,a,u,c,f,y,x,w,I,A,z,O,Z,X,re,Y,ce,ve){var xe=24*r,Te=12*r,Me=48*r;return this.int16[xe+0]=a,this.int16[xe+1]=u,this.uint16[xe+2]=c,this.uint16[xe+3]=f,this.uint32[Te+2]=y,this.uint32[Te+3]=x,this.uint32[Te+4]=w,this.uint16[xe+10]=I,this.uint16[xe+11]=A,this.uint16[xe+12]=z,this.float32[Te+7]=O,this.float32[Te+8]=Z,this.uint8[Me+36]=X,this.uint8[Me+37]=re,this.uint8[Me+38]=Y,this.uint32[Te+10]=ce,this.int16[xe+22]=ve,r},t}(Tr);ma.prototype.bytesPerElement=48,Qe("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ma);var $s=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,a,u,c,f,y,x,w,I,A,z,O,Z,X,re,Y,ce,ve,xe,Te,Me,Ue,Je,xt,ut,St,lt,Qt){var Mt=this.length;return this.resize(Mt+1),this.emplace(Mt,r,a,u,c,f,y,x,w,I,A,z,O,Z,X,re,Y,ce,ve,xe,Te,Me,Ue,Je,xt,ut,St,lt,Qt)},t.prototype.emplace=function(r,a,u,c,f,y,x,w,I,A,z,O,Z,X,re,Y,ce,ve,xe,Te,Me,Ue,Je,xt,ut,St,lt,Qt,Mt){var vt=34*r,ir=17*r;return this.int16[vt+0]=a,this.int16[vt+1]=u,this.int16[vt+2]=c,this.int16[vt+3]=f,this.int16[vt+4]=y,this.int16[vt+5]=x,this.int16[vt+6]=w,this.int16[vt+7]=I,this.uint16[vt+8]=A,this.uint16[vt+9]=z,this.uint16[vt+10]=O,this.uint16[vt+11]=Z,this.uint16[vt+12]=X,this.uint16[vt+13]=re,this.uint16[vt+14]=Y,this.uint16[vt+15]=ce,this.uint16[vt+16]=ve,this.uint16[vt+17]=xe,this.uint16[vt+18]=Te,this.uint16[vt+19]=Me,this.uint16[vt+20]=Ue,this.uint16[vt+21]=Je,this.uint16[vt+22]=xt,this.uint32[ir+12]=ut,this.float32[ir+13]=St,this.float32[ir+14]=lt,this.float32[ir+15]=Qt,this.float32[ir+16]=Mt,r},t}(Tr);$s.prototype.bytesPerElement=68,Qe("StructArrayLayout8i15ui1ul4f68",$s);var ya=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r){var a=this.length;return this.resize(a+1),this.emplace(a,r)},t.prototype.emplace=function(r,a){return this.float32[1*r+0]=a,r},t}(Tr);ya.prototype.bytesPerElement=4,Qe("StructArrayLayout1f4",ya);var ho=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,a,u){var c=this.length;return this.resize(c+1),this.emplace(c,r,a,u)},t.prototype.emplace=function(r,a,u,c){var f=3*r;return this.int16[f+0]=a,this.int16[f+1]=u,this.int16[f+2]=c,r},t}(Tr);ho.prototype.bytesPerElement=6,Qe("StructArrayLayout3i6",ho);var Bu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,a,u){var c=this.length;return this.resize(c+1),this.emplace(c,r,a,u)},t.prototype.emplace=function(r,a,u,c){var f=4*r;return this.uint32[2*r+0]=a,this.uint16[f+2]=u,this.uint16[f+3]=c,r},t}(Tr);Bu.prototype.bytesPerElement=8,Qe("StructArrayLayout1ul2ui8",Bu);var Ts=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,a){var u=this.length;return this.resize(u+1),this.emplace(u,r,a)},t.prototype.emplace=function(r,a,u){var c=2*r;return this.uint16[c+0]=a,this.uint16[c+1]=u,r},t}(Tr);Ts.prototype.bytesPerElement=4,Qe("StructArrayLayout2ui4",Ts);var Fu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r){var a=this.length;return this.resize(a+1),this.emplace(a,r)},t.prototype.emplace=function(r,a){return this.uint16[1*r+0]=a,r},t}(Tr);Fu.prototype.bytesPerElement=2,Qe("StructArrayLayout1ui2",Fu);var Qs=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,a,u,c){var f=this.length;return this.resize(f+1),this.emplace(f,r,a,u,c)},t.prototype.emplace=function(r,a,u,c,f){var y=4*r;return this.float32[y+0]=a,this.float32[y+1]=u,this.float32[y+2]=c,this.float32[y+3]=f,r},t}(Tr);Qs.prototype.bytesPerElement=16,Qe("StructArrayLayout4f16",Qs);var n=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return r.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},r.x1.get=function(){return this._structArray.int16[this._pos2+2]},r.y1.get=function(){return this._structArray.int16[this._pos2+3]},r.x2.get=function(){return this._structArray.int16[this._pos2+4]},r.y2.get=function(){return this._structArray.int16[this._pos2+5]},r.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},r.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},r.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},r.anchorPoint.get=function(){return new Rt(this.anchorPointX,this.anchorPointY)},Object.defineProperties(t.prototype,r),t}(Js);n.prototype.size=20;var o=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new n(this,r)},t}(Ou);Qe("CollisionBoxArray",o);var i=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return r.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},r.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},r.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},r.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},r.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},r.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},r.segment.get=function(){return this._structArray.uint16[this._pos2+10]},r.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},r.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},r.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},r.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},r.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},r.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},r.placedOrientation.set=function(a){this._structArray.uint8[this._pos1+37]=a},r.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},r.hidden.set=function(a){this._structArray.uint8[this._pos1+38]=a},r.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},r.crossTileID.set=function(a){this._structArray.uint32[this._pos4+10]=a},r.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(t.prototype,r),t}(Js);i.prototype.size=48;var s=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new i(this,r)},t}(ma);Qe("PlacedSymbolArray",s);var p=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return r.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},r.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},r.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},r.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},r.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},r.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},r.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},r.key.get=function(){return this._structArray.uint16[this._pos2+8]},r.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},r.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},r.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},r.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},r.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},r.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},r.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},r.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},r.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},r.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},r.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},r.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},r.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},r.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},r.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},r.crossTileID.set=function(a){this._structArray.uint32[this._pos4+12]=a},r.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},r.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},r.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},r.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(t.prototype,r),t}(Js);p.prototype.size=68;var d=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new p(this,r)},t}($s);Qe("SymbolInstanceArray",d);var m=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getoffsetX=function(r){return this.float32[1*r+0]},t}(ya);Qe("GlyphOffsetArray",m);var _=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getx=function(r){return this.int16[3*r+0]},t.prototype.gety=function(r){return this.int16[3*r+1]},t.prototype.gettileUnitDistanceFromAnchor=function(r){return this.int16[3*r+2]},t}(ho);Qe("SymbolLineVertexArray",_);var S=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return r.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},r.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},r.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(t.prototype,r),t}(Js);S.prototype.size=8;var P=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new S(this,r)},t}(Bu);Qe("FeatureIndexArray",P);var B=qn([{name:"a_pos",components:2,type:"Int16"}],4).members,F=function(e){e===void 0&&(e=[]),this.segments=e};function N(e,t){return 256*(e=_t(Math.floor(e),0,255))+_t(Math.floor(t),0,255)}F.prototype.prepareSegment=function(e,t,r,a){var u=this.segments[this.segments.length-1];return e>F.MAX_VERTEX_ARRAY_LENGTH&&Sr("Max vertices per segment is "+F.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+e),(!u||u.vertexLength+e>F.MAX_VERTEX_ARRAY_LENGTH||u.sortKey!==a)&&(u={vertexOffset:t.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0},a!==void 0&&(u.sortKey=a),this.segments.push(u)),u},F.prototype.get=function(){return this.segments},F.prototype.destroy=function(){for(var e=0,t=this.segments;e<t.length;e+=1){var r=t[e];for(var a in r.vaos)r.vaos[a].destroy()}},F.simpleSegment=function(e,t,r,a){return new F([{vertexOffset:e,primitiveOffset:t,vertexLength:r,primitiveLength:a,vaos:{},sortKey:0}])},F.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Qe("SegmentVector",F);var H=qn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),W=ur(function(e){e.exports=function(t,r){var a,u,c,f,y,x,w,I;for(u=t.length-(a=3&t.length),c=r,y=3432918353,x=461845907,I=0;I<u;)w=255&t.charCodeAt(I)|(255&t.charCodeAt(++I))<<8|(255&t.charCodeAt(++I))<<16|(255&t.charCodeAt(++I))<<24,++I,c=27492+(65535&(f=5*(65535&(c=(c^=w=(65535&(w=(w=(65535&w)*y+(((w>>>16)*y&65535)<<16)&4294967295)<<15|w>>>17))*x+(((w>>>16)*x&65535)<<16)&4294967295)<<13|c>>>19))+((5*(c>>>16)&65535)<<16)&4294967295))+((58964+(f>>>16)&65535)<<16);switch(w=0,a){case 3:w^=(255&t.charCodeAt(I+2))<<16;case 2:w^=(255&t.charCodeAt(I+1))<<8;case 1:c^=w=(65535&(w=(w=(65535&(w^=255&t.charCodeAt(I)))*y+(((w>>>16)*y&65535)<<16)&4294967295)<<15|w>>>17))*x+(((w>>>16)*x&65535)<<16)&4294967295}return c^=t.length,c=2246822507*(65535&(c^=c>>>16))+((2246822507*(c>>>16)&65535)<<16)&4294967295,c=3266489909*(65535&(c^=c>>>13))+((3266489909*(c>>>16)&65535)<<16)&4294967295,(c^=c>>>16)>>>0}}),ee=ur(function(e){e.exports=function(t,r){for(var a,u=t.length,c=r^u,f=0;u>=4;)a=1540483477*(65535&(a=255&t.charCodeAt(f)|(255&t.charCodeAt(++f))<<8|(255&t.charCodeAt(++f))<<16|(255&t.charCodeAt(++f))<<24))+((1540483477*(a>>>16)&65535)<<16),c=1540483477*(65535&c)+((1540483477*(c>>>16)&65535)<<16)^(a=1540483477*(65535&(a^=a>>>24))+((1540483477*(a>>>16)&65535)<<16)),u-=4,++f;switch(u){case 3:c^=(255&t.charCodeAt(f+2))<<16;case 2:c^=(255&t.charCodeAt(f+1))<<8;case 1:c=1540483477*(65535&(c^=255&t.charCodeAt(f)))+((1540483477*(c>>>16)&65535)<<16)}return c=1540483477*(65535&(c^=c>>>13))+((1540483477*(c>>>16)&65535)<<16),(c^=c>>>15)>>>0}}),q=W,Q=ee;q.murmur3=W,q.murmur2=Q;var ae=function(){this.ids=[],this.positions=[],this.indexed=!1};ae.prototype.add=function(e,t,r,a){this.ids.push(Ce(e)),this.positions.push(t,r,a)},ae.prototype.getPositions=function(e){for(var t=Ce(e),r=0,a=this.ids.length-1;r<a;){var u=r+a>>1;this.ids[u]>=t?a=u:r=u+1}for(var c=[];this.ids[r]===t;)c.push({index:this.positions[3*r],start:this.positions[3*r+1],end:this.positions[3*r+2]}),r++;return c},ae.serialize=function(e,t){var r=new Float64Array(e.ids),a=new Uint32Array(e.positions);return function u(c,f,y,x){for(;y<x;){for(var w=c[y+x>>1],I=y-1,A=x+1;;){do I++;while(c[I]<w);do A--;while(c[A]>w);if(I>=A)break;we(c,I,A),we(f,3*I,3*A),we(f,3*I+1,3*A+1),we(f,3*I+2,3*A+2)}A-y<x-A?(u(c,f,y,A),y=A+1):(u(c,f,A+1,x),x=A)}}(r,a,0,r.length-1),t&&t.push(r.buffer,a.buffer),{ids:r,positions:a}},ae.deserialize=function(e){var t=new ae;return t.ids=e.ids,t.positions=e.positions,t.indexed=!0,t};var me=Math.pow(2,53)-1;function Ce(e){var t=+e;return!isNaN(t)&&t<=me?t:q(String(e))}function we(e,t,r){var a=e[t];e[t]=e[r],e[r]=a}Qe("FeaturePositionMap",ae);var Ae=function(e,t){this.gl=e.gl,this.location=t},Re=function(e){function t(r,a){e.call(this,r,a),this.current=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))},t}(Ae),Ze=function(e){function t(r,a){e.call(this,r,a),this.current=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))},t}(Ae),qe=function(e){function t(r,a){e.call(this,r,a),this.current=[0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))},t}(Ae),ct=function(e){function t(r,a){e.call(this,r,a),this.current=[0,0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))},t}(Ae),Et=function(e){function t(r,a){e.call(this,r,a),this.current=[0,0,0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3]))},t}(Ae),Ct=function(e){function t(r,a){e.call(this,r,a),this.current=pr.transparent}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a))},t}(Ae),It=new Float32Array(16),mr=function(e){function t(r,a){e.call(this,r,a),this.current=It}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(var a=1;a<16;a++)if(r[a]!==this.current[a]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}},t}(Ae);function dt(e){return[N(255*e.r,255*e.g),N(255*e.b,255*e.a)]}var Vt=function(e,t,r){this.value=e,this.uniformNames=t.map(function(a){return"u_"+a}),this.type=r};Vt.prototype.setUniform=function(e,t,r){e.set(r.constantOr(this.value))},Vt.prototype.getBinding=function(e,t,r){return this.type==="color"?new Ct(e,t):new Ze(e,t)};var Jt=function(e,t){this.uniformNames=t.map(function(r){return"u_"+r}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};Jt.prototype.setConstantPatternPositions=function(e,t){this.pixelRatioFrom=t.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=t.tlbr,this.patternTo=e.tlbr},Jt.prototype.setUniform=function(e,t,r,a){var u=a==="u_pattern_to"?this.patternTo:a==="u_pattern_from"?this.patternFrom:a==="u_pixel_ratio_to"?this.pixelRatioTo:a==="u_pixel_ratio_from"?this.pixelRatioFrom:null;u&&e.set(u)},Jt.prototype.getBinding=function(e,t,r){return r.substr(0,9)==="u_pattern"?new Et(e,t):new Ze(e,t)};var Ft=function(e,t,r,a){this.expression=e,this.type=r,this.maxValue=0,this.paintVertexAttributes=t.map(function(u){return{name:"a_"+u,type:"Float32",components:r==="color"?2:1,offset:0}}),this.paintVertexArray=new a};Ft.prototype.populatePaintArray=function(e,t,r,a,u){var c=this.paintVertexArray.length,f=this.expression.evaluate(new ar(0),t,{},a,[],u);this.paintVertexArray.resize(e),this._setPaintValue(c,e,f)},Ft.prototype.updatePaintArray=function(e,t,r,a){var u=this.expression.evaluate({zoom:0},r,a);this._setPaintValue(e,t,u)},Ft.prototype._setPaintValue=function(e,t,r){if(this.type==="color")for(var a=dt(r),u=e;u<t;u++)this.paintVertexArray.emplace(u,a[0],a[1]);else{for(var c=e;c<t;c++)this.paintVertexArray.emplace(c,r);this.maxValue=Math.max(this.maxValue,Math.abs(r))}},Ft.prototype.upload=function(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Ft.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Ot=function(e,t,r,a,u,c){this.expression=e,this.uniformNames=t.map(function(f){return"u_"+f+"_t"}),this.type=r,this.useIntegerZoom=a,this.zoom=u,this.maxValue=0,this.paintVertexAttributes=t.map(function(f){return{name:"a_"+f,type:"Float32",components:r==="color"?4:2,offset:0}}),this.paintVertexArray=new c};Ot.prototype.populatePaintArray=function(e,t,r,a,u){var c=this.expression.evaluate(new ar(this.zoom),t,{},a,[],u),f=this.expression.evaluate(new ar(this.zoom+1),t,{},a,[],u),y=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(y,e,c,f)},Ot.prototype.updatePaintArray=function(e,t,r,a){var u=this.expression.evaluate({zoom:this.zoom},r,a),c=this.expression.evaluate({zoom:this.zoom+1},r,a);this._setPaintValue(e,t,u,c)},Ot.prototype._setPaintValue=function(e,t,r,a){if(this.type==="color")for(var u=dt(r),c=dt(a),f=e;f<t;f++)this.paintVertexArray.emplace(f,u[0],u[1],c[0],c[1]);else{for(var y=e;y<t;y++)this.paintVertexArray.emplace(y,r,a);this.maxValue=Math.max(this.maxValue,Math.abs(r),Math.abs(a))}},Ot.prototype.upload=function(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Ot.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Ot.prototype.setUniform=function(e,t){var r=this.useIntegerZoom?Math.floor(t.zoom):t.zoom,a=_t(this.expression.interpolationFactor(r,this.zoom,this.zoom+1),0,1);e.set(a)},Ot.prototype.getBinding=function(e,t,r){return new Ze(e,t)};var Xt=function(e,t,r,a,u,c){this.expression=e,this.type=t,this.useIntegerZoom=r,this.zoom=a,this.layerId=c,this.zoomInPaintVertexArray=new u,this.zoomOutPaintVertexArray=new u};Xt.prototype.populatePaintArray=function(e,t,r){var a=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(a,e,t.patterns&&t.patterns[this.layerId],r)},Xt.prototype.updatePaintArray=function(e,t,r,a,u){this._setPaintValues(e,t,r.patterns&&r.patterns[this.layerId],u)},Xt.prototype._setPaintValues=function(e,t,r,a){if(a&&r){var u=a[r.min],c=a[r.mid],f=a[r.max];if(u&&c&&f)for(var y=e;y<t;y++)this.zoomInPaintVertexArray.emplace(y,c.tl[0],c.tl[1],c.br[0],c.br[1],u.tl[0],u.tl[1],u.br[0],u.br[1],c.pixelRatio,u.pixelRatio),this.zoomOutPaintVertexArray.emplace(y,c.tl[0],c.tl[1],c.br[0],c.br[1],f.tl[0],f.tl[1],f.br[0],f.br[1],c.pixelRatio,f.pixelRatio)}},Xt.prototype.upload=function(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,H.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,H.members,this.expression.isStateDependent))},Xt.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var zt=function(e,t,r){this.binders={},this._buffers=[];var a=[];for(var u in e.paint._values)if(r(u)){var c=e.paint.get(u);if(c instanceof hi&&Po(c.property.specification)){var f=On(u,e.type),y=c.value,x=c.property.specification.type,w=c.property.useIntegerZoom,I=c.property.specification["property-type"],A=I==="cross-faded"||I==="cross-faded-data-driven";if(y.kind==="constant")this.binders[u]=A?new Jt(y.value,f):new Vt(y.value,f,x),a.push("/u_"+u);else if(y.kind==="source"||A){var z=on(u,x,"source");this.binders[u]=A?new Xt(y,x,w,t,z,e.id):new Ft(y,f,x,z),a.push("/a_"+u)}else{var O=on(u,x,"composite");this.binders[u]=new Ot(y,f,x,w,t,O),a.push("/z_"+u)}}}this.cacheKey=a.sort().join("")};zt.prototype.getMaxValue=function(e){var t=this.binders[e];return t instanceof Ft||t instanceof Ot?t.maxValue:0},zt.prototype.populatePaintArrays=function(e,t,r,a,u){for(var c in this.binders){var f=this.binders[c];(f instanceof Ft||f instanceof Ot||f instanceof Xt)&&f.populatePaintArray(e,t,r,a,u)}},zt.prototype.setConstantPatternPositions=function(e,t){for(var r in this.binders){var a=this.binders[r];a instanceof Jt&&a.setConstantPatternPositions(e,t)}},zt.prototype.updatePaintArrays=function(e,t,r,a,u){var c=!1;for(var f in e)for(var y=0,x=t.getPositions(f);y<x.length;y+=1){var w=x[y],I=r.feature(w.index);for(var A in this.binders){var z=this.binders[A];if((z instanceof Ft||z instanceof Ot||z instanceof Xt)&&z.expression.isStateDependent===!0){var O=a.paint.get(A);z.expression=O.value,z.updatePaintArray(w.start,w.end,I,e[f],u),c=!0}}}return c},zt.prototype.defines=function(){var e=[];for(var t in this.binders){var r=this.binders[t];(r instanceof Vt||r instanceof Jt)&&e.push.apply(e,r.uniformNames.map(function(a){return"#define HAS_UNIFORM_"+a}))}return e},zt.prototype.getBinderAttributes=function(){var e=[];for(var t in this.binders){var r=this.binders[t];if(r instanceof Ft||r instanceof Ot)for(var a=0;a<r.paintVertexAttributes.length;a++)e.push(r.paintVertexAttributes[a].name);else if(r instanceof Xt)for(var u=0;u<H.members.length;u++)e.push(H.members[u].name)}return e},zt.prototype.getBinderUniforms=function(){var e=[];for(var t in this.binders){var r=this.binders[t];if(r instanceof Vt||r instanceof Jt||r instanceof Ot)for(var a=0,u=r.uniformNames;a<u.length;a+=1)e.push(u[a])}return e},zt.prototype.getPaintVertexBuffers=function(){return this._buffers},zt.prototype.getUniforms=function(e,t){var r=[];for(var a in this.binders){var u=this.binders[a];if(u instanceof Vt||u instanceof Jt||u instanceof Ot)for(var c=0,f=u.uniformNames;c<f.length;c+=1){var y=f[c];if(t[y]){var x=u.getBinding(e,t[y],y);r.push({name:y,property:a,binding:x})}}}return r},zt.prototype.setUniforms=function(e,t,r,a){for(var u=0,c=t;u<c.length;u+=1){var f=c[u],y=f.name,x=f.property;this.binders[x].setUniform(f.binding,a,r.get(x),y)}},zt.prototype.updatePaintBuffers=function(e){for(var t in this._buffers=[],this.binders){var r=this.binders[t];if(e&&r instanceof Xt){var a=e.fromScale===2?r.zoomInPaintVertexBuffer:r.zoomOutPaintVertexBuffer;a&&this._buffers.push(a)}else(r instanceof Ft||r instanceof Ot)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}},zt.prototype.upload=function(e){for(var t in this.binders){var r=this.binders[t];(r instanceof Ft||r instanceof Ot||r instanceof Xt)&&r.upload(e)}this.updatePaintBuffers()},zt.prototype.destroy=function(){for(var e in this.binders){var t=this.binders[e];(t instanceof Ft||t instanceof Ot||t instanceof Xt)&&t.destroy()}};var kt=function(e,t,r){r===void 0&&(r=function(){return!0}),this.programConfigurations={};for(var a=0,u=e;a<u.length;a+=1){var c=u[a];this.programConfigurations[c.id]=new zt(c,t,r)}this.needsUpload=!1,this._featureMap=new ae,this._bufferOffset=0};function On(e,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[e]||[e.replace(t+"-","").replace(/-/g,"_")]}function on(e,t,r){var a={color:{source:rs,composite:Qs},number:{source:ya,composite:rs}},u=function(c){return{"line-pattern":{source:Ko,composite:Ko},"fill-pattern":{source:Ko,composite:Ko},"fill-extrusion-pattern":{source:Ko,composite:Ko}}[c]}(e);return u&&u[r]||a[t][r]}kt.prototype.populatePaintArrays=function(e,t,r,a,u,c){for(var f in this.programConfigurations)this.programConfigurations[f].populatePaintArrays(e,t,a,u,c);t.id!==void 0&&this._featureMap.add(t.id,r,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0},kt.prototype.updatePaintArrays=function(e,t,r,a){for(var u=0,c=r;u<c.length;u+=1){var f=c[u];this.needsUpload=this.programConfigurations[f.id].updatePaintArrays(e,this._featureMap,t,f,a)||this.needsUpload}},kt.prototype.get=function(e){return this.programConfigurations[e]},kt.prototype.upload=function(e){if(this.needsUpload){for(var t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}},kt.prototype.destroy=function(){for(var e in this.programConfigurations)this.programConfigurations[e].destroy()},Qe("ConstantBinder",Vt),Qe("CrossFadedConstantBinder",Jt),Qe("SourceExpressionBinder",Ft),Qe("CrossFadedCompositeBinder",Xt),Qe("CompositeExpressionBinder",Ot),Qe("ProgramConfiguration",zt,{omit:["_buffers"]}),Qe("ProgramConfigurationSet",kt);var ii=Math.pow(2,14)-1,Zn=-ii-1;function Yr(e){for(var t=8192/e.extent,r=e.loadGeometry(),a=0;a<r.length;a++)for(var u=r[a],c=0;c<u.length;c++){var f=u[c],y=Math.round(f.x*t),x=Math.round(f.y*t);f.x=_t(y,Zn,ii),f.y=_t(x,Zn,ii),(y<f.x||y>f.x+1||x<f.y||x>f.y+1)&&Sr("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return r}function hn(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?Yr(e):[]}}function Xi(e,t,r,a,u){e.emplaceBack(2*t+(a+1)/2,2*r+(u+1)/2)}var di=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Ra,this.indexArray=new da,this.segments=new F,this.programConfigurations=new kt(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};function ga(e,t){for(var r=0;r<e.length;r++)if(Xo(t,e[r]))return!0;for(var a=0;a<t.length;a++)if(Xo(e,t[a]))return!0;return!!Is(e,t)}function Ai(e,t,r){return!!Xo(e,t)||!!va(t,e,r)}function Ro(e,t){if(e.length===1)return Cs(t,e[0]);for(var r=0;r<t.length;r++)for(var a=t[r],u=0;u<a.length;u++)if(Xo(e,a[u]))return!0;for(var c=0;c<e.length;c++)if(Cs(t,e[c]))return!0;for(var f=0;f<t.length;f++)if(Is(e,t[f]))return!0;return!1}function fo(e,t,r){if(e.length>1){if(Is(e,t))return!0;for(var a=0;a<t.length;a++)if(va(t[a],e,r))return!0}for(var u=0;u<e.length;u++)if(va(e[u],t,r))return!0;return!1}function Is(e,t){if(e.length===0||t.length===0)return!1;for(var r=0;r<e.length-1;r++)for(var a=e[r],u=e[r+1],c=0;c<t.length-1;c++)if(os(a,u,t[c],t[c+1]))return!0;return!1}function os(e,t,r,a){return Br(e,r,a)!==Br(t,r,a)&&Br(e,t,r)!==Br(e,t,a)}function va(e,t,r){var a=r*r;if(t.length===1)return e.distSqr(t[0])<a;for(var u=1;u<t.length;u++)if(as(e,t[u-1],t[u])<a)return!0;return!1}function as(e,t,r){var a=t.distSqr(r);if(a===0)return e.distSqr(t);var u=((e.x-t.x)*(r.x-t.x)+(e.y-t.y)*(r.y-t.y))/a;return e.distSqr(u<0?t:u>1?r:r.sub(t)._mult(u)._add(t))}function Cs(e,t){for(var r,a,u,c=!1,f=0;f<e.length;f++)for(var y=0,x=(r=e[f]).length-1;y<r.length;x=y++)(a=r[y]).y>t.y!=(u=r[x]).y>t.y&&t.x<(u.x-a.x)*(t.y-a.y)/(u.y-a.y)+a.x&&(c=!c);return c}function Xo(e,t){for(var r=!1,a=0,u=e.length-1;a<e.length;u=a++){var c=e[a],f=e[u];c.y>t.y!=f.y>t.y&&t.x<(f.x-c.x)*(t.y-c.y)/(f.y-c.y)+c.x&&(r=!r)}return r}function As(e,t,r){var a=r[0],u=r[2];if(e.x<a.x&&t.x<a.x||e.x>u.x&&t.x>u.x||e.y<a.y&&t.y<a.y||e.y>u.y&&t.y>u.y)return!1;var c=Br(e,t,r[0]);return c!==Br(e,t,r[1])||c!==Br(e,t,r[2])||c!==Br(e,t,r[3])}function Wo(e,t,r){var a=t.paint.get(e).value;return a.kind==="constant"?a.value:r.programConfigurations.get(t.id).getMaxValue(e)}function Rn(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function ta(e,t,r,a,u){if(!t[0]&&!t[1])return e;var c=Rt.convert(t)._mult(u);r==="viewport"&&c._rotate(-a);for(var f=[],y=0;y<e.length;y++)f.push(e[y].sub(c));return f}di.prototype.populate=function(e,t,r){var a=this.layers[0],u=[],c=null;a.type==="circle"&&(c=a.layout.get("circle-sort-key"));for(var f=0,y=e;f<y.length;f+=1){var x=y[f],w=x.feature,I=x.id,A=x.index,z=x.sourceLayerIndex,O=this.layers[0]._featureFilter.needGeometry,Z=hn(w,O);if(this.layers[0]._featureFilter.filter(new ar(this.zoom),Z,r)){var X=c?c.evaluate(Z,{},r):void 0,re={id:I,properties:w.properties,type:w.type,sourceLayerIndex:z,index:A,geometry:O?Z.geometry:Yr(w),patterns:{},sortKey:X};u.push(re)}}c&&u.sort(function(Je,xt){return Je.sortKey-xt.sortKey});for(var Y=0,ce=u;Y<ce.length;Y+=1){var ve=ce[Y],xe=ve.geometry,Te=ve.index,Me=ve.sourceLayerIndex,Ue=e[Te].feature;this.addFeature(ve,xe,Te,r),t.featureIndex.insert(Ue,xe,Te,Me,this.index)}},di.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},di.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},di.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},di.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,B),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},di.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},di.prototype.addFeature=function(e,t,r,a){for(var u=0,c=t;u<c.length;u+=1)for(var f=0,y=c[u];f<y.length;f+=1){var x=y[f],w=x.x,I=x.y;if(!(w<0||w>=8192||I<0||I>=8192)){var A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),z=A.vertexLength;Xi(this.layoutVertexArray,w,I,-1,-1),Xi(this.layoutVertexArray,w,I,1,-1),Xi(this.layoutVertexArray,w,I,1,1),Xi(this.layoutVertexArray,w,I,-1,1),this.indexArray.emplaceBack(z,z+1,z+2),this.indexArray.emplaceBack(z,z+3,z+2),A.vertexLength+=4,A.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,{},a)},Qe("CircleBucket",di,{omit:["layers"]});var _a=new Yn({"circle-sort-key":new gt(L.layout_circle["circle-sort-key"])}),Fa={paint:new Yn({"circle-radius":new gt(L.paint_circle["circle-radius"]),"circle-color":new gt(L.paint_circle["circle-color"]),"circle-blur":new gt(L.paint_circle["circle-blur"]),"circle-opacity":new gt(L.paint_circle["circle-opacity"]),"circle-translate":new wt(L.paint_circle["circle-translate"]),"circle-translate-anchor":new wt(L.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new wt(L.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new wt(L.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new gt(L.paint_circle["circle-stroke-width"]),"circle-stroke-color":new gt(L.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new gt(L.paint_circle["circle-stroke-opacity"])}),layout:_a},Er=typeof Float32Array<"u"?Float32Array:Array;function to(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Pi(e,t,r){var a=t[0],u=t[1],c=t[2],f=t[3],y=t[4],x=t[5],w=t[6],I=t[7],A=t[8],z=t[9],O=t[10],Z=t[11],X=t[12],re=t[13],Y=t[14],ce=t[15],ve=r[0],xe=r[1],Te=r[2],Me=r[3];return e[0]=ve*a+xe*y+Te*A+Me*X,e[1]=ve*u+xe*x+Te*z+Me*re,e[2]=ve*c+xe*w+Te*O+Me*Y,e[3]=ve*f+xe*I+Te*Z+Me*ce,e[4]=(ve=r[4])*a+(xe=r[5])*y+(Te=r[6])*A+(Me=r[7])*X,e[5]=ve*u+xe*x+Te*z+Me*re,e[6]=ve*c+xe*w+Te*O+Me*Y,e[7]=ve*f+xe*I+Te*Z+Me*ce,e[8]=(ve=r[8])*a+(xe=r[9])*y+(Te=r[10])*A+(Me=r[11])*X,e[9]=ve*u+xe*x+Te*z+Me*re,e[10]=ve*c+xe*w+Te*O+Me*Y,e[11]=ve*f+xe*I+Te*Z+Me*ce,e[12]=(ve=r[12])*a+(xe=r[13])*y+(Te=r[14])*A+(Me=r[15])*X,e[13]=ve*u+xe*x+Te*z+Me*re,e[14]=ve*c+xe*w+Te*O+Me*Y,e[15]=ve*f+xe*I+Te*Z+Me*ce,e}Math.hypot||(Math.hypot=function(){for(var e=arguments,t=0,r=arguments.length;r--;)t+=e[r]*e[r];return Math.sqrt(t)});var Na,Kl=Pi;function eu(e,t,r){var a=t[0],u=t[1],c=t[2],f=t[3];return e[0]=r[0]*a+r[4]*u+r[8]*c+r[12]*f,e[1]=r[1]*a+r[5]*u+r[9]*c+r[13]*f,e[2]=r[2]*a+r[6]*u+r[10]*c+r[14]*f,e[3]=r[3]*a+r[7]*u+r[11]*c+r[15]*f,e}Na=new Er(3),Er!=Float32Array&&(Na[0]=0,Na[1]=0,Na[2]=0),function(){var e=new Er(4);Er!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0)}();var Xl=(function(){var e=new Er(2);Er!=Float32Array&&(e[0]=0,e[1]=0)}(),function(e){function t(r){e.call(this,r,Fa)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(r){return new di(r)},t.prototype.queryRadius=function(r){var a=r;return Wo("circle-radius",this,a)+Wo("circle-stroke-width",this,a)+Rn(this.paint.get("circle-translate"))},t.prototype.queryIntersectsFeature=function(r,a,u,c,f,y,x,w){for(var I=ta(r,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),y.angle,x),A=this.paint.get("circle-radius").evaluate(a,u)+this.paint.get("circle-stroke-width").evaluate(a,u),z=this.paint.get("circle-pitch-alignment")==="map",O=z?I:function(Ue,Je){return Ue.map(function(xt){return Ps(xt,Je)})}(I,w),Z=z?A*x:A,X=0,re=c;X<re.length;X+=1)for(var Y=0,ce=re[X];Y<ce.length;Y+=1){var ve=ce[Y],xe=z?ve:Ps(ve,w),Te=Z,Me=eu([],[ve.x,ve.y,0,1],w);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Te*=Me[3]/y.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Te*=y.cameraToCenterDistance/Me[3]),Ai(O,xe,Te))return!0}return!1},t}(Go));function Ps(e,t){var r=eu([],[e.x,e.y,0,1],t);return new Rt(r[0]/r[3],r[1]/r[3])}var hl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(di);function ss(e,t,r,a){var u=t.width,c=t.height;if(a){if(a instanceof Uint8ClampedArray)a=new Uint8Array(a.buffer);else if(a.length!==u*c*r)throw new RangeError("mismatched image size")}else a=new Uint8Array(u*c*r);return e.width=u,e.height=c,e.data=a,e}function tu(e,t,r){var a=t.width,u=t.height;if(a!==e.width||u!==e.height){var c=ss({},{width:a,height:u},r);Wl(e,c,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,a),height:Math.min(e.height,u)},r),e.width=a,e.height=u,e.data=c.data}}function Wl(e,t,r,a,u,c){if(u.width===0||u.height===0)return t;if(u.width>e.width||u.height>e.height||r.x>e.width-u.width||r.y>e.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>t.width||u.height>t.height||a.x>t.width-u.width||a.y>t.height-u.height)throw new RangeError("out of range destination coordinates for image copy");for(var f=e.data,y=t.data,x=0;x<u.height;x++)for(var w=((r.y+x)*e.width+r.x)*c,I=((a.y+x)*t.width+a.x)*c,A=0;A<u.width*c;A++)y[I+A]=f[w+A];return t}Qe("HeatmapBucket",hl,{omit:["layers"]});var ks=function(e,t){ss(this,e,1,t)};ks.prototype.resize=function(e){tu(this,e,1)},ks.prototype.clone=function(){return new ks({width:this.width,height:this.height},new Uint8Array(this.data))},ks.copy=function(e,t,r,a,u){Wl(e,t,r,a,u,1)};var Wi=function(e,t){ss(this,e,4,t)};Wi.prototype.resize=function(e){tu(this,e,4)},Wi.prototype.replace=function(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e},Wi.prototype.clone=function(){return new Wi({width:this.width,height:this.height},new Uint8Array(this.data))},Wi.copy=function(e,t,r,a,u){Wl(e,t,r,a,u,4)},Qe("AlphaImage",ks),Qe("RGBAImage",Wi);var $p={paint:new Yn({"heatmap-radius":new gt(L.paint_heatmap["heatmap-radius"]),"heatmap-weight":new gt(L.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new wt(L.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Oo(L.paint_heatmap["heatmap-color"]),"heatmap-opacity":new wt(L.paint_heatmap["heatmap-opacity"])})};function Cc(e){var t={},r=e.resolution||256,a=e.clips?e.clips.length:1,u=e.image||new Wi({width:r,height:a}),c=function(Z,X,re){t[e.evaluationKey]=re;var Y=e.expression.evaluate(t);u.data[Z+X+0]=Math.floor(255*Y.r/Y.a),u.data[Z+X+1]=Math.floor(255*Y.g/Y.a),u.data[Z+X+2]=Math.floor(255*Y.b/Y.a),u.data[Z+X+3]=Math.floor(255*Y.a)};if(e.clips)for(var f=0,y=0;f<a;++f,y+=4*r)for(var x=0,w=0;x<r;x++,w+=4){var I=x/(r-1),A=e.clips[f];c(y,w,A.start*(1-I)+A.end*I)}else for(var z=0,O=0;z<r;z++,O+=4)c(0,O,z/(r-1));return u}var Qp=function(e){function t(r){e.call(this,r,$p),this._updateColorRamp()}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(r){return new hl(r)},t.prototype._handleSpecialPaintPropertyUpdate=function(r){r==="heatmap-color"&&this._updateColorRamp()},t.prototype._updateColorRamp=function(){this.colorRamp=Cc({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},t.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},t.prototype.queryRadius=function(){return 0},t.prototype.queryIntersectsFeature=function(){return!1},t.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},t}(Go),eh={paint:new Yn({"hillshade-illumination-direction":new wt(L.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new wt(L.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new wt(L.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new wt(L.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new wt(L.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new wt(L.paint_hillshade["hillshade-accent-color"])})},th=function(e){function t(r){e.call(this,r,eh)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},t}(Go),rh=qn([{name:"a_pos",components:2,type:"Int16"}],4).members,Hl=fl,nh=fl;function fl(e,t,r){r=r||2;var a,u,c,f,y,x,w,I=t&&t.length,A=I?t[0]*r:e.length,z=Ac(e,0,A,r,!0),O=[];if(!z||z.next===z.prev)return O;if(I&&(z=function(X,re,Y,ce){var ve,xe,Te,Me=[];for(ve=0,xe=re.length;ve<xe;ve++)(Te=Ac(X,re[ve]*ce,ve<xe-1?re[ve+1]*ce:X.length,ce,!1))===Te.next&&(Te.steiner=!0),Me.push(ph(Te));for(Me.sort(uh),ve=0;ve<Me.length;ve++)lh(Me[ve],Y),Y=us(Y,Y.next);return Y}(e,t,z,r)),e.length>80*r){a=c=e[0],u=f=e[1];for(var Z=r;Z<A;Z+=r)(y=e[Z])<a&&(a=y),(x=e[Z+1])<u&&(u=x),y>c&&(c=y),x>f&&(f=x);w=(w=Math.max(c-a,f-u))!==0?1/w:0}return Nu(z,O,r,a,u,w),O}function Ac(e,t,r,a,u){var c,f;if(u===$l(e,t,r,a)>0)for(c=t;c<r;c+=a)f=Mc(c,e[c],e[c+1],f);else for(c=r-a;c>=t;c-=a)f=Mc(c,e[c],e[c+1],f);return f&&dl(f,f.next)&&(Vu(f),f=f.next),f}function us(e,t){if(!e)return e;t||(t=e);var r,a=e;do if(r=!1,a.steiner||!dl(a,a.next)&&An(a.prev,a,a.next)!==0)a=a.next;else{if(Vu(a),(a=t=a.prev)===a.next)break;r=!0}while(r||a!==t);return t}function Nu(e,t,r,a,u,c,f){if(e){!f&&c&&function(I,A,z,O){var Z=I;do Z.z===null&&(Z.z=Jl(Z.x,Z.y,A,z,O)),Z.prevZ=Z.prev,Z.nextZ=Z.next,Z=Z.next;while(Z!==I);Z.prevZ.nextZ=null,Z.prevZ=null,function(X){var re,Y,ce,ve,xe,Te,Me,Ue,Je=1;do{for(Y=X,X=null,xe=null,Te=0;Y;){for(Te++,ce=Y,Me=0,re=0;re<Je&&(Me++,ce=ce.nextZ);re++);for(Ue=Je;Me>0||Ue>0&&ce;)Me!==0&&(Ue===0||!ce||Y.z<=ce.z)?(ve=Y,Y=Y.nextZ,Me--):(ve=ce,ce=ce.nextZ,Ue--),xe?xe.nextZ=ve:X=ve,ve.prevZ=xe,xe=ve;Y=ce}xe.nextZ=null,Je*=2}while(Te>1)}(Z)}(e,a,u,c);for(var y,x,w=e;e.prev!==e.next;)if(y=e.prev,x=e.next,c?oh(e,a,u,c):ih(e))t.push(y.i/r),t.push(e.i/r),t.push(x.i/r),Vu(e),e=x.next,w=x.next;else if((e=x)===w){f?f===1?Nu(e=ah(us(e),t,r),t,r,a,u,c,2):f===2&&sh(e,t,r,a,u,c):Nu(us(e),t,r,a,u,c,1);break}}}function ih(e){var t=e.prev,r=e,a=e.next;if(An(t,r,a)>=0)return!1;for(var u=e.next.next;u!==e.prev;){if(ru(t.x,t.y,r.x,r.y,a.x,a.y,u.x,u.y)&&An(u.prev,u,u.next)>=0)return!1;u=u.next}return!0}function oh(e,t,r,a){var u=e.prev,c=e,f=e.next;if(An(u,c,f)>=0)return!1;for(var y=u.x>c.x?u.x>f.x?u.x:f.x:c.x>f.x?c.x:f.x,x=u.y>c.y?u.y>f.y?u.y:f.y:c.y>f.y?c.y:f.y,w=Jl(u.x<c.x?u.x<f.x?u.x:f.x:c.x<f.x?c.x:f.x,u.y<c.y?u.y<f.y?u.y:f.y:c.y<f.y?c.y:f.y,t,r,a),I=Jl(y,x,t,r,a),A=e.prevZ,z=e.nextZ;A&&A.z>=w&&z&&z.z<=I;){if(A!==e.prev&&A!==e.next&&ru(u.x,u.y,c.x,c.y,f.x,f.y,A.x,A.y)&&An(A.prev,A,A.next)>=0||(A=A.prevZ,z!==e.prev&&z!==e.next&&ru(u.x,u.y,c.x,c.y,f.x,f.y,z.x,z.y)&&An(z.prev,z,z.next)>=0))return!1;z=z.nextZ}for(;A&&A.z>=w;){if(A!==e.prev&&A!==e.next&&ru(u.x,u.y,c.x,c.y,f.x,f.y,A.x,A.y)&&An(A.prev,A,A.next)>=0)return!1;A=A.prevZ}for(;z&&z.z<=I;){if(z!==e.prev&&z!==e.next&&ru(u.x,u.y,c.x,c.y,f.x,f.y,z.x,z.y)&&An(z.prev,z,z.next)>=0)return!1;z=z.nextZ}return!0}function ah(e,t,r){var a=e;do{var u=a.prev,c=a.next.next;!dl(u,c)&&Pc(u,a,a.next,c)&&Uu(u,c)&&Uu(c,u)&&(t.push(u.i/r),t.push(a.i/r),t.push(c.i/r),Vu(a),Vu(a.next),a=e=c),a=a.next}while(a!==e);return us(a)}function sh(e,t,r,a,u,c){var f=e;do{for(var y=f.next.next;y!==f.prev;){if(f.i!==y.i&&hh(f,y)){var x=kc(f,y);return f=us(f,f.next),x=us(x,x.next),Nu(f,t,r,a,u,c),void Nu(x,t,r,a,u,c)}y=y.next}f=f.next}while(f!==e)}function uh(e,t){return e.x-t.x}function lh(e,t){if(t=function(a,u){var c,f=u,y=a.x,x=a.y,w=-1/0;do{if(x<=f.y&&x>=f.next.y&&f.next.y!==f.y){var I=f.x+(x-f.y)*(f.next.x-f.x)/(f.next.y-f.y);if(I<=y&&I>w){if(w=I,I===y){if(x===f.y)return f;if(x===f.next.y)return f.next}c=f.x<f.next.x?f:f.next}}f=f.next}while(f!==u);if(!c)return null;if(y===w)return c;var A,z=c,O=c.x,Z=c.y,X=1/0;f=c;do y>=f.x&&f.x>=O&&y!==f.x&&ru(x<Z?y:w,x,O,Z,x<Z?w:y,x,f.x,f.y)&&(A=Math.abs(x-f.y)/(y-f.x),Uu(f,a)&&(A<X||A===X&&(f.x>c.x||f.x===c.x&&ch(c,f)))&&(c=f,X=A)),f=f.next;while(f!==z);return c}(e,t)){var r=kc(t,e);us(t,t.next),us(r,r.next)}}function ch(e,t){return An(e.prev,e,t.prev)<0&&An(t.next,e,e.next)<0}function Jl(e,t,r,a,u){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*u)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-a)*u)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function ph(e){var t=e,r=e;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==e);return r}function ru(e,t,r,a,u,c,f,y){return(u-f)*(t-y)-(e-f)*(c-y)>=0&&(e-f)*(a-y)-(r-f)*(t-y)>=0&&(r-f)*(c-y)-(u-f)*(a-y)>=0}function hh(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(r,a){var u=r;do{if(u.i!==r.i&&u.next.i!==r.i&&u.i!==a.i&&u.next.i!==a.i&&Pc(u,u.next,r,a))return!0;u=u.next}while(u!==r);return!1}(e,t)&&(Uu(e,t)&&Uu(t,e)&&function(r,a){var u=r,c=!1,f=(r.x+a.x)/2,y=(r.y+a.y)/2;do u.y>y!=u.next.y>y&&u.next.y!==u.y&&f<(u.next.x-u.x)*(y-u.y)/(u.next.y-u.y)+u.x&&(c=!c),u=u.next;while(u!==r);return c}(e,t)&&(An(e.prev,e,t.prev)||An(e,t.prev,t))||dl(e,t)&&An(e.prev,e,e.next)>0&&An(t.prev,t,t.next)>0)}function An(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function dl(e,t){return e.x===t.x&&e.y===t.y}function Pc(e,t,r,a){var u=yl(An(e,t,r)),c=yl(An(e,t,a)),f=yl(An(r,a,e)),y=yl(An(r,a,t));return u!==c&&f!==y||!(u!==0||!ml(e,r,t))||!(c!==0||!ml(e,a,t))||!(f!==0||!ml(r,e,a))||!(y!==0||!ml(r,t,a))}function ml(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function yl(e){return e>0?1:e<0?-1:0}function Uu(e,t){return An(e.prev,e,e.next)<0?An(e,t,e.next)>=0&&An(e,e.prev,t)>=0:An(e,t,e.prev)<0||An(e,e.next,t)<0}function kc(e,t){var r=new Yl(e.i,e.x,e.y),a=new Yl(t.i,t.x,t.y),u=e.next,c=t.prev;return e.next=t,t.prev=e,r.next=u,u.prev=r,a.next=r,r.prev=a,c.next=a,a.prev=c,a}function Mc(e,t,r,a){var u=new Yl(e,t,r);return a?(u.next=a.next,u.prev=a,a.next.prev=u,a.next=u):(u.prev=u,u.next=u),u}function Vu(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Yl(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function $l(e,t,r,a){for(var u=0,c=t,f=r-a;c<r;c+=a)u+=(e[f]-e[c])*(e[c+1]+e[f+1]),f=c;return u}function fh(e,t,r,a,u){(function c(f,y,x,w,I){for(;w>x;){if(w-x>600){var A=w-x+1,z=y-x+1,O=Math.log(A),Z=.5*Math.exp(2*O/3),X=.5*Math.sqrt(O*Z*(A-Z)/A)*(z-A/2<0?-1:1);c(f,y,Math.max(x,Math.floor(y-z*Z/A+X)),Math.min(w,Math.floor(y+(A-z)*Z/A+X)),I)}var re=f[y],Y=x,ce=w;for(ju(f,x,y),I(f[w],re)>0&&ju(f,x,w);Y<ce;){for(ju(f,Y,ce),Y++,ce--;I(f[Y],re)<0;)Y++;for(;I(f[ce],re)>0;)ce--}I(f[x],re)===0?ju(f,x,ce):ju(f,++ce,w),ce<=y&&(x=ce+1),y<=ce&&(w=ce-1)}})(e,t,r,a||e.length-1,u||dh)}function ju(e,t,r){var a=e[t];e[t]=e[r],e[r]=a}function dh(e,t){return e<t?-1:e>t?1:0}function Ql(e,t){var r=e.length;if(r<=1)return[e];for(var a,u,c=[],f=0;f<r;f++){var y=Bo(e[f]);y!==0&&(e[f].area=Math.abs(y),u===void 0&&(u=y<0),u===y<0?(a&&c.push(a),a=[e[f]]):a.push(e[f]))}if(a&&c.push(a),t>1)for(var x=0;x<c.length;x++)c[x].length<=t||(fh(c[x],t,1,c[x].length-1,mh),c[x]=c[x].slice(0,t));return c}function mh(e,t){return t.area-e.area}function ec(e,t,r){for(var a=r.patternDependencies,u=!1,c=0,f=t;c<f.length;c+=1){var y=f[c].paint.get(e+"-pattern");y.isConstant()||(u=!0);var x=y.constantOr(null);x&&(u=!0,a[x.to]=!0,a[x.from]=!0)}return u}function tc(e,t,r,a,u){for(var c=u.patternDependencies,f=0,y=t;f<y.length;f+=1){var x=y[f],w=x.paint.get(e+"-pattern").value;if(w.kind!=="constant"){var I=w.evaluate({zoom:a-1},r,{},u.availableImages),A=w.evaluate({zoom:a},r,{},u.availableImages),z=w.evaluate({zoom:a+1},r,{},u.availableImages);A=A&&A.name?A.name:A,z=z&&z.name?z.name:z,c[I=I&&I.name?I.name:I]=!0,c[A]=!0,c[z]=!0,r.patterns[x.id]={min:I,mid:A,max:z}}}return r}fl.deviation=function(e,t,r,a){var u=t&&t.length,c=Math.abs($l(e,0,u?t[0]*r:e.length,r));if(u)for(var f=0,y=t.length;f<y;f++)c-=Math.abs($l(e,t[f]*r,f<y-1?t[f+1]*r:e.length,r));var x=0;for(f=0;f<a.length;f+=3){var w=a[f]*r,I=a[f+1]*r,A=a[f+2]*r;x+=Math.abs((e[w]-e[A])*(e[I+1]-e[w+1])-(e[w]-e[I])*(e[A+1]-e[w+1]))}return c===0&&x===0?0:Math.abs((x-c)/c)},fl.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},a=0,u=0;u<e.length;u++){for(var c=0;c<e[u].length;c++)for(var f=0;f<t;f++)r.vertices.push(e[u][c][f]);u>0&&r.holes.push(a+=e[u-1].length)}return r},Hl.default=nh;var ra=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ra,this.indexArray=new da,this.indexArray2=new Ts,this.programConfigurations=new kt(e.layers,e.zoom),this.segments=new F,this.segments2=new F,this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};ra.prototype.populate=function(e,t,r){this.hasPattern=ec("fill",this.layers,t);for(var a=this.layers[0].layout.get("fill-sort-key"),u=[],c=0,f=e;c<f.length;c+=1){var y=f[c],x=y.feature,w=y.id,I=y.index,A=y.sourceLayerIndex,z=this.layers[0]._featureFilter.needGeometry,O=hn(x,z);if(this.layers[0]._featureFilter.filter(new ar(this.zoom),O,r)){var Z=a?a.evaluate(O,{},r,t.availableImages):void 0,X={id:w,properties:x.properties,type:x.type,sourceLayerIndex:A,index:I,geometry:z?O.geometry:Yr(x),patterns:{},sortKey:Z};u.push(X)}}a&&u.sort(function(Ue,Je){return Ue.sortKey-Je.sortKey});for(var re=0,Y=u;re<Y.length;re+=1){var ce=Y[re],ve=ce.geometry,xe=ce.index,Te=ce.sourceLayerIndex;if(this.hasPattern){var Me=tc("fill",this.layers,ce,this.zoom,t);this.patternFeatures.push(Me)}else this.addFeature(ce,ve,xe,r,{});t.featureIndex.insert(e[xe].feature,ve,xe,Te,this.index)}},ra.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},ra.prototype.addFeatures=function(e,t,r){for(var a=0,u=this.patternFeatures;a<u.length;a+=1){var c=u[a];this.addFeature(c,c.geometry,c.index,t,r)}},ra.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ra.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ra.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,rh),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0},ra.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},ra.prototype.addFeature=function(e,t,r,a,u){for(var c=0,f=Ql(t,500);c<f.length;c+=1){for(var y=f[c],x=0,w=0,I=y;w<I.length;w+=1)x+=I[w].length;for(var A=this.segments.prepareSegment(x,this.layoutVertexArray,this.indexArray),z=A.vertexLength,O=[],Z=[],X=0,re=y;X<re.length;X+=1){var Y=re[X];if(Y.length!==0){Y!==y[0]&&Z.push(O.length/2);var ce=this.segments2.prepareSegment(Y.length,this.layoutVertexArray,this.indexArray2),ve=ce.vertexLength;this.layoutVertexArray.emplaceBack(Y[0].x,Y[0].y),this.indexArray2.emplaceBack(ve+Y.length-1,ve),O.push(Y[0].x),O.push(Y[0].y);for(var xe=1;xe<Y.length;xe++)this.layoutVertexArray.emplaceBack(Y[xe].x,Y[xe].y),this.indexArray2.emplaceBack(ve+xe-1,ve+xe),O.push(Y[xe].x),O.push(Y[xe].y);ce.vertexLength+=Y.length,ce.primitiveLength+=Y.length}}for(var Te=Hl(O,Z),Me=0;Me<Te.length;Me+=3)this.indexArray.emplaceBack(z+Te[Me],z+Te[Me+1],z+Te[Me+2]);A.vertexLength+=x,A.primitiveLength+=Te.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,u,a)},Qe("FillBucket",ra,{omit:["layers","patternFeatures"]});var yh=new Yn({"fill-sort-key":new gt(L.layout_fill["fill-sort-key"])}),gh={paint:new Yn({"fill-antialias":new wt(L.paint_fill["fill-antialias"]),"fill-opacity":new gt(L.paint_fill["fill-opacity"]),"fill-color":new gt(L.paint_fill["fill-color"]),"fill-outline-color":new gt(L.paint_fill["fill-outline-color"]),"fill-translate":new wt(L.paint_fill["fill-translate"]),"fill-translate-anchor":new wt(L.paint_fill["fill-translate-anchor"]),"fill-pattern":new Hs(L.paint_fill["fill-pattern"])}),layout:yh},vh=function(e){function t(r){e.call(this,r,gh)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.recalculate=function(r,a){e.prototype.recalculate.call(this,r,a);var u=this.paint._values["fill-outline-color"];u.value.kind==="constant"&&u.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},t.prototype.createBucket=function(r){return new ra(r)},t.prototype.queryRadius=function(){return Rn(this.paint.get("fill-translate"))},t.prototype.queryIntersectsFeature=function(r,a,u,c,f,y,x){return Ro(ta(r,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),y.angle,x),c)},t.prototype.isTileClipped=function(){return!0},t}(Go),_h=qn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,zc=nu;function nu(e,t,r,a,u){this.properties={},this.extent=r,this.type=0,this._pbf=e,this._geometry=-1,this._keys=a,this._values=u,e.readFields(xh,this,t)}function xh(e,t,r){e==1?t.id=r.readVarint():e==2?function(a,u){for(var c=a.readVarint()+a.pos;a.pos<c;){var f=u._keys[a.readVarint()],y=u._values[a.readVarint()];u.properties[f]=y}}(r,t):e==3?t.type=r.readVarint():e==4&&(t._geometry=r.pos)}function bh(e){for(var t,r,a=0,u=0,c=e.length,f=c-1;u<c;f=u++)a+=((r=e[f]).x-(t=e[u]).x)*(t.y+r.y);return a}nu.types=["Unknown","Point","LineString","Polygon"],nu.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,r=e.readVarint()+e.pos,a=1,u=0,c=0,f=0,y=[];e.pos<r;){if(u<=0){var x=e.readVarint();a=7&x,u=x>>3}if(u--,a===1||a===2)c+=e.readSVarint(),f+=e.readSVarint(),a===1&&(t&&y.push(t),t=[]),t.push(new Rt(c,f));else{if(a!==7)throw new Error("unknown command "+a);t&&t.push(t[0].clone())}}return t&&y.push(t),y},nu.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,r=1,a=0,u=0,c=0,f=1/0,y=-1/0,x=1/0,w=-1/0;e.pos<t;){if(a<=0){var I=e.readVarint();r=7&I,a=I>>3}if(a--,r===1||r===2)(u+=e.readSVarint())<f&&(f=u),u>y&&(y=u),(c+=e.readSVarint())<x&&(x=c),c>w&&(w=c);else if(r!==7)throw new Error("unknown command "+r)}return[f,x,y,w]},nu.prototype.toGeoJSON=function(e,t,r){var a,u,c=this.extent*Math.pow(2,r),f=this.extent*e,y=this.extent*t,x=this.loadGeometry(),w=nu.types[this.type];function I(O){for(var Z=0;Z<O.length;Z++){var X=O[Z];O[Z]=[360*(X.x+f)/c-180,360/Math.PI*Math.atan(Math.exp((180-360*(X.y+y)/c)*Math.PI/180))-90]}}switch(this.type){case 1:var A=[];for(a=0;a<x.length;a++)A[a]=x[a][0];I(x=A);break;case 2:for(a=0;a<x.length;a++)I(x[a]);break;case 3:for(x=function(O){var Z=O.length;if(Z<=1)return[O];for(var X,re,Y=[],ce=0;ce<Z;ce++){var ve=bh(O[ce]);ve!==0&&(re===void 0&&(re=ve<0),re===ve<0?(X&&Y.push(X),X=[O[ce]]):X.push(O[ce]))}return X&&Y.push(X),Y}(x),a=0;a<x.length;a++)for(u=0;u<x[a].length;u++)I(x[a][u])}x.length===1?x=x[0]:w="Multi"+w;var z={type:"Feature",geometry:{type:w,coordinates:x},properties:this.properties};return"id"in this&&(z.id=this.id),z};var Dc=Lc;function Lc(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(wh,this,t),this.length=this._features.length}function wh(e,t,r){e===15?t.version=r.readVarint():e===1?t.name=r.readString():e===5?t.extent=r.readVarint():e===2?t._features.push(r.pos):e===3?t._keys.push(r.readString()):e===4&&t._values.push(function(a){for(var u=null,c=a.readVarint()+a.pos;a.pos<c;){var f=a.readVarint()>>3;u=f===1?a.readString():f===2?a.readFloat():f===3?a.readDouble():f===4?a.readVarint64():f===5?a.readVarint():f===6?a.readSVarint():f===7?a.readBoolean():null}return u}(r))}function Eh(e,t,r){if(e===3){var a=new Dc(r,r.readVarint()+r.pos);a.length&&(t[a.name]=a)}}Lc.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new zc(this._pbf,t,this.extent,this._keys,this._values)};var iu={VectorTile:function(e,t){this.layers=e.readFields(Eh,{},t)},VectorTileFeature:zc,VectorTileLayer:Dc},Sh=iu.VectorTileFeature.types,rc=Math.pow(2,13);function qu(e,t,r,a,u,c,f,y){e.emplaceBack(t,r,2*Math.floor(a*rc)+f,u*rc*2,c*rc*2,Math.round(y))}var na=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new ea,this.indexArray=new da,this.programConfigurations=new kt(e.layers,e.zoom),this.segments=new F,this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};function Th(e,t){return e.x===t.x&&(e.x<0||e.x>8192)||e.y===t.y&&(e.y<0||e.y>8192)}na.prototype.populate=function(e,t,r){this.features=[],this.hasPattern=ec("fill-extrusion",this.layers,t);for(var a=0,u=e;a<u.length;a+=1){var c=u[a],f=c.feature,y=c.id,x=c.index,w=c.sourceLayerIndex,I=this.layers[0]._featureFilter.needGeometry,A=hn(f,I);if(this.layers[0]._featureFilter.filter(new ar(this.zoom),A,r)){var z={id:y,sourceLayerIndex:w,index:x,geometry:I?A.geometry:Yr(f),properties:f.properties,type:f.type,patterns:{}};this.hasPattern?this.features.push(tc("fill-extrusion",this.layers,z,this.zoom,t)):this.addFeature(z,z.geometry,x,r,{}),t.featureIndex.insert(f,z.geometry,x,w,this.index,!0)}}},na.prototype.addFeatures=function(e,t,r){for(var a=0,u=this.features;a<u.length;a+=1){var c=u[a];this.addFeature(c,c.geometry,c.index,t,r)}},na.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},na.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},na.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},na.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,_h),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},na.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},na.prototype.addFeature=function(e,t,r,a,u){for(var c=0,f=Ql(t,500);c<f.length;c+=1){for(var y=f[c],x=0,w=0,I=y;w<I.length;w+=1)x+=I[w].length;for(var A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),z=0,O=y;z<O.length;z+=1){var Z=O[z];if(Z.length!==0&&!((ir=Z).every(function(Gt){return Gt.x<0})||ir.every(function(Gt){return Gt.x>8192})||ir.every(function(Gt){return Gt.y<0})||ir.every(function(Gt){return Gt.y>8192})))for(var X=0,re=0;re<Z.length;re++){var Y=Z[re];if(re>=1){var ce=Z[re-1];if(!Th(Y,ce)){A.vertexLength+4>F.MAX_VERTEX_ARRAY_LENGTH&&(A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var ve=Y.sub(ce)._perp()._unit(),xe=ce.dist(Y);X+xe>32768&&(X=0),qu(this.layoutVertexArray,Y.x,Y.y,ve.x,ve.y,0,0,X),qu(this.layoutVertexArray,Y.x,Y.y,ve.x,ve.y,0,1,X),qu(this.layoutVertexArray,ce.x,ce.y,ve.x,ve.y,0,0,X+=xe),qu(this.layoutVertexArray,ce.x,ce.y,ve.x,ve.y,0,1,X);var Te=A.vertexLength;this.indexArray.emplaceBack(Te,Te+2,Te+1),this.indexArray.emplaceBack(Te+1,Te+2,Te+3),A.vertexLength+=4,A.primitiveLength+=2}}}}if(A.vertexLength+x>F.MAX_VERTEX_ARRAY_LENGTH&&(A=this.segments.prepareSegment(x,this.layoutVertexArray,this.indexArray)),Sh[e.type]==="Polygon"){for(var Me=[],Ue=[],Je=A.vertexLength,xt=0,ut=y;xt<ut.length;xt+=1){var St=ut[xt];if(St.length!==0){St!==y[0]&&Ue.push(Me.length/2);for(var lt=0;lt<St.length;lt++){var Qt=St[lt];qu(this.layoutVertexArray,Qt.x,Qt.y,0,0,1,1,0),Me.push(Qt.x),Me.push(Qt.y)}}}for(var Mt=Hl(Me,Ue),vt=0;vt<Mt.length;vt+=3)this.indexArray.emplaceBack(Je+Mt[vt],Je+Mt[vt+2],Je+Mt[vt+1]);A.primitiveLength+=Mt.length/3,A.vertexLength+=x}}var ir;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,u,a)},Qe("FillExtrusionBucket",na,{omit:["layers","features"]});var Ih={paint:new Yn({"fill-extrusion-opacity":new wt(L["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new gt(L["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new wt(L["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new wt(L["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Hs(L["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new gt(L["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new gt(L["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new wt(L["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},Ch=function(e){function t(r){e.call(this,r,Ih)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(r){return new na(r)},t.prototype.queryRadius=function(){return Rn(this.paint.get("fill-extrusion-translate"))},t.prototype.is3D=function(){return!0},t.prototype.queryIntersectsFeature=function(r,a,u,c,f,y,x,w){var I=ta(r,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),y.angle,x),A=this.paint.get("fill-extrusion-height").evaluate(a,u),z=this.paint.get("fill-extrusion-base").evaluate(a,u),O=function(X,re,Y,ce){for(var ve=[],xe=0,Te=X;xe<Te.length;xe+=1){var Me=Te[xe],Ue=[Me.x,Me.y,0,1];eu(Ue,Ue,re),ve.push(new Rt(Ue[0]/Ue[3],Ue[1]/Ue[3]))}return ve}(I,w),Z=function(X,re,Y,ce){for(var ve=[],xe=[],Te=ce[8]*re,Me=ce[9]*re,Ue=ce[10]*re,Je=ce[11]*re,xt=ce[8]*Y,ut=ce[9]*Y,St=ce[10]*Y,lt=ce[11]*Y,Qt=0,Mt=X;Qt<Mt.length;Qt+=1){for(var vt=[],ir=[],Gt=0,fr=Mt[Qt];Gt<fr.length;Gt+=1){var Tt=fr[Gt],_r=Tt.x,Xr=Tt.y,an=ce[0]*_r+ce[4]*Xr+ce[12],$r=ce[1]*_r+ce[5]*Xr+ce[13],Wr=ce[2]*_r+ce[6]*Xr+ce[14],sn=ce[3]*_r+ce[7]*Xr+ce[15],Bn=Wr+Ue,Fn=sn+Je,yi=an+xt,Kn=$r+ut,gi=Wr+St,fn=sn+lt,Xn=new Rt((an+Te)/Fn,($r+Me)/Fn);Xn.z=Bn/Fn,vt.push(Xn);var sr=new Rt(yi/fn,Kn/fn);sr.z=gi/fn,ir.push(sr)}ve.push(vt),xe.push(ir)}return[ve,xe]}(c,z,A,w);return function(X,re,Y){var ce=1/0;Ro(Y,re)&&(ce=Oc(Y,re[0]));for(var ve=0;ve<re.length;ve++)for(var xe=re[ve],Te=X[ve],Me=0;Me<xe.length-1;Me++){var Ue=xe[Me],Je=[Ue,xe[Me+1],Te[Me+1],Te[Me],Ue];ga(Y,Je)&&(ce=Math.min(ce,Oc(Y,Je)))}return ce!==1/0&&ce}(Z[0],Z[1],O)},t}(Go);function Zu(e,t){return e.x*t.x+e.y*t.y}function Oc(e,t){if(e.length===1){for(var r,a=0,u=t[a++];!r||u.equals(r);)if(!(r=t[a++]))return 1/0;for(;a<t.length;a++){var c=t[a],f=e[0],y=r.sub(u),x=c.sub(u),w=f.sub(u),I=Zu(y,y),A=Zu(y,x),z=Zu(x,x),O=Zu(w,y),Z=Zu(w,x),X=I*z-A*A,re=(z*O-A*Z)/X,Y=(I*Z-A*O)/X,ce=u.z*(1-re-Y)+r.z*re+c.z*Y;if(isFinite(ce))return ce}return 1/0}for(var ve=1/0,xe=0,Te=t;xe<Te.length;xe+=1)ve=Math.min(ve,Te[xe].z);return ve}var Ah=qn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,Ph=qn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,kh=iu.VectorTileFeature.types,Mh=Math.cos(Math.PI/180*37.5),Rc=Math.pow(2,14)/.5,ki=function(e){var t=this;this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(r){return r.id}),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(r){t.gradients[r.id]={}}),this.layoutVertexArray=new Ki,this.layoutVertexArray2=new rs,this.indexArray=new da,this.programConfigurations=new kt(e.layers,e.zoom),this.segments=new F,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(r){return r.isStateDependent()}).map(function(r){return r.id})};ki.prototype.populate=function(e,t,r){this.hasPattern=ec("line",this.layers,t);for(var a=this.layers[0].layout.get("line-sort-key"),u=[],c=0,f=e;c<f.length;c+=1){var y=f[c],x=y.feature,w=y.id,I=y.index,A=y.sourceLayerIndex,z=this.layers[0]._featureFilter.needGeometry,O=hn(x,z);if(this.layers[0]._featureFilter.filter(new ar(this.zoom),O,r)){var Z=a?a.evaluate(O,{},r):void 0,X={id:w,properties:x.properties,type:x.type,sourceLayerIndex:A,index:I,geometry:z?O.geometry:Yr(x),patterns:{},sortKey:Z};u.push(X)}}a&&u.sort(function(Ue,Je){return Ue.sortKey-Je.sortKey});for(var re=0,Y=u;re<Y.length;re+=1){var ce=Y[re],ve=ce.geometry,xe=ce.index,Te=ce.sourceLayerIndex;if(this.hasPattern){var Me=tc("line",this.layers,ce,this.zoom,t);this.patternFeatures.push(Me)}else this.addFeature(ce,ve,xe,r,{});t.featureIndex.insert(e[xe].feature,ve,xe,Te,this.index)}},ki.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},ki.prototype.addFeatures=function(e,t,r){for(var a=0,u=this.patternFeatures;a<u.length;a+=1){var c=u[a];this.addFeature(c,c.geometry,c.index,t,r)}},ki.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ki.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ki.prototype.upload=function(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Ph)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ah),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},ki.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},ki.prototype.lineFeatureClips=function(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}},ki.prototype.addFeature=function(e,t,r,a,u){var c=this.layers[0].layout,f=c.get("line-join").evaluate(e,{}),y=c.get("line-cap"),x=c.get("line-miter-limit"),w=c.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(var I=0,A=t;I<A.length;I+=1)this.addLine(A[I],e,f,y,x,w);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,u,a)},ki.prototype.addLine=function(e,t,r,a,u,c){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var f=0;f<e.length-1;f++)this.totalDistance+=e[f].dist(e[f+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var y=kh[t.type]==="Polygon",x=e.length;x>=2&&e[x-1].equals(e[x-2]);)x--;for(var w=0;w<x-1&&e[w].equals(e[w+1]);)w++;if(!(x<(y?3:2))){r==="bevel"&&(u=1.05);var I,A=this.overscaling<=16?122880/(512*this.overscaling):0,z=this.segments.prepareSegment(10*x,this.layoutVertexArray,this.indexArray),O=void 0,Z=void 0,X=void 0,re=void 0;this.e1=this.e2=-1,y&&(re=e[w].sub(I=e[x-2])._unit()._perp());for(var Y=w;Y<x;Y++)if(!(Z=Y===x-1?y?e[w+1]:void 0:e[Y+1])||!e[Y].equals(Z)){re&&(X=re),I&&(O=I),I=e[Y],re=Z?Z.sub(I)._unit()._perp():X;var ce=(X=X||re).add(re);ce.x===0&&ce.y===0||ce._unit();var ve=X.x*re.x+X.y*re.y,xe=ce.x*re.x+ce.y*re.y,Te=xe!==0?1/xe:1/0,Me=2*Math.sqrt(2-2*xe),Ue=xe<Mh&&O&&Z,Je=X.x*re.y-X.y*re.x>0;if(Ue&&Y>w){var xt=I.dist(O);if(xt>2*A){var ut=I.sub(I.sub(O)._mult(A/xt)._round());this.updateDistance(O,ut),this.addCurrentVertex(ut,X,0,0,z),O=ut}}var St=O&&Z,lt=St?r:y?"butt":a;if(St&&lt==="round"&&(Te<c?lt="miter":Te<=2&&(lt="fakeround")),lt==="miter"&&Te>u&&(lt="bevel"),lt==="bevel"&&(Te>2&&(lt="flipbevel"),Te<u&&(lt="miter")),O&&this.updateDistance(O,I),lt==="miter")ce._mult(Te),this.addCurrentVertex(I,ce,0,0,z);else if(lt==="flipbevel"){if(Te>100)ce=re.mult(-1);else{var Qt=Te*X.add(re).mag()/X.sub(re).mag();ce._perp()._mult(Qt*(Je?-1:1))}this.addCurrentVertex(I,ce,0,0,z),this.addCurrentVertex(I,ce.mult(-1),0,0,z)}else if(lt==="bevel"||lt==="fakeround"){var Mt=-Math.sqrt(Te*Te-1),vt=Je?Mt:0,ir=Je?0:Mt;if(O&&this.addCurrentVertex(I,X,vt,ir,z),lt==="fakeround")for(var Gt=Math.round(180*Me/Math.PI/20),fr=1;fr<Gt;fr++){var Tt=fr/Gt;if(Tt!==.5){var _r=Tt-.5;Tt+=Tt*_r*(Tt-1)*((1.0904+ve*(ve*(3.55645-1.43519*ve)-3.2452))*_r*_r+(.848013+ve*(.215638*ve-1.06021)))}var Xr=re.sub(X)._mult(Tt)._add(X)._unit()._mult(Je?-1:1);this.addHalfVertex(I,Xr.x,Xr.y,!1,Je,0,z)}Z&&this.addCurrentVertex(I,re,-vt,-ir,z)}else if(lt==="butt")this.addCurrentVertex(I,ce,0,0,z);else if(lt==="square"){var an=O?1:-1;this.addCurrentVertex(I,ce,an,an,z)}else lt==="round"&&(O&&(this.addCurrentVertex(I,X,0,0,z),this.addCurrentVertex(I,X,1,1,z,!0)),Z&&(this.addCurrentVertex(I,re,-1,-1,z,!0),this.addCurrentVertex(I,re,0,0,z)));if(Ue&&Y<x-1){var $r=I.dist(Z);if($r>2*A){var Wr=I.add(Z.sub(I)._mult(A/$r)._round());this.updateDistance(I,Wr),this.addCurrentVertex(Wr,re,0,0,z),I=Wr}}}}},ki.prototype.addCurrentVertex=function(e,t,r,a,u,c){c===void 0&&(c=!1);var f=t.y*a-t.x,y=-t.y-t.x*a;this.addHalfVertex(e,t.x+t.y*r,t.y-t.x*r,c,!1,r,u),this.addHalfVertex(e,f,y,c,!0,-a,u),this.distance>Rc/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(e,t,r,a,u,c))},ki.prototype.addHalfVertex=function(e,t,r,a,u,c,f){var y=.5*(this.lineClips?this.scaledDistance*(Rc-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e.x<<1)+(a?1:0),(e.y<<1)+(u?1:0),Math.round(63*t)+128,Math.round(63*r)+128,1+(c===0?0:c<0?-1:1)|(63&y)<<2,y>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var x=f.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,x),f.primitiveLength++),u?this.e2=x:this.e1=x},ki.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},ki.prototype.updateDistance=function(e,t){this.distance+=e.dist(t),this.updateScaledDistance()},Qe("LineBucket",ki,{omit:["layers","patternFeatures"]});var zh=new Yn({"line-cap":new wt(L.layout_line["line-cap"]),"line-join":new gt(L.layout_line["line-join"]),"line-miter-limit":new wt(L.layout_line["line-miter-limit"]),"line-round-limit":new wt(L.layout_line["line-round-limit"]),"line-sort-key":new gt(L.layout_line["line-sort-key"])}),Bc={paint:new Yn({"line-opacity":new gt(L.paint_line["line-opacity"]),"line-color":new gt(L.paint_line["line-color"]),"line-translate":new wt(L.paint_line["line-translate"]),"line-translate-anchor":new wt(L.paint_line["line-translate-anchor"]),"line-width":new gt(L.paint_line["line-width"]),"line-gap-width":new gt(L.paint_line["line-gap-width"]),"line-offset":new gt(L.paint_line["line-offset"]),"line-blur":new gt(L.paint_line["line-blur"]),"line-dasharray":new fi(L.paint_line["line-dasharray"]),"line-pattern":new Hs(L.paint_line["line-pattern"]),"line-gradient":new Oo(L.paint_line["line-gradient"])}),layout:zh},Fc=new(function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.possiblyEvaluate=function(r,a){return a=new ar(Math.floor(a.zoom),{now:a.now,fadeDuration:a.fadeDuration,zoomHistory:a.zoomHistory,transition:a.transition}),e.prototype.possiblyEvaluate.call(this,r,a)},t.prototype.evaluate=function(r,a,u,c){return a=dr({},a,{zoom:Math.floor(a.zoom)}),e.prototype.evaluate.call(this,r,a,u,c)},t}(gt))(Bc.paint.properties["line-width"].specification);Fc.useIntegerZoom=!0;var Dh=function(e){function t(r){e.call(this,r,Bc),this.gradientVersion=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._handleSpecialPaintPropertyUpdate=function(r){r==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof ni,this.gradientVersion=(this.gradientVersion+1)%Nn)},t.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},t.prototype.recalculate=function(r,a){e.prototype.recalculate.call(this,r,a),this.paint._values["line-floorwidth"]=Fc.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)},t.prototype.createBucket=function(r){return new ki(r)},t.prototype.queryRadius=function(r){var a=r,u=Nc(Wo("line-width",this,a),Wo("line-gap-width",this,a)),c=Wo("line-offset",this,a);return u/2+Math.abs(c)+Rn(this.paint.get("line-translate"))},t.prototype.queryIntersectsFeature=function(r,a,u,c,f,y,x){var w=ta(r,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),y.angle,x),I=x/2*Nc(this.paint.get("line-width").evaluate(a,u),this.paint.get("line-gap-width").evaluate(a,u)),A=this.paint.get("line-offset").evaluate(a,u);return A&&(c=function(z,O){for(var Z=[],X=new Rt(0,0),re=0;re<z.length;re++){for(var Y=z[re],ce=[],ve=0;ve<Y.length;ve++){var xe=Y[ve],Te=Y[ve+1],Me=ve===0?X:xe.sub(Y[ve-1])._unit()._perp(),Ue=ve===Y.length-1?X:Te.sub(xe)._unit()._perp(),Je=Me._add(Ue)._unit();Je._mult(1/(Je.x*Ue.x+Je.y*Ue.y)),ce.push(Je._mult(O)._add(xe))}Z.push(ce)}return Z}(c,A*x)),function(z,O,Z){for(var X=0;X<O.length;X++){var re=O[X];if(z.length>=3){for(var Y=0;Y<re.length;Y++)if(Xo(z,re[Y]))return!0}if(fo(z,re,Z))return!0}return!1}(w,c,I)},t.prototype.isTileClipped=function(){return!0},t}(Go);function Nc(e,t){return t>0?t+2*e:e}var Lh=qn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Oh=qn([{name:"a_projected_pos",components:3,type:"Float32"}],4),Rh=(qn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),qn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Uc=(qn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),qn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Bh=qn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Fh(e,t,r){return e.sections.forEach(function(a){a.text=function(u,c,f){var y=c.layout.get("text-transform").evaluate(f,{});return y==="uppercase"?u=u.toLocaleUpperCase():y==="lowercase"&&(u=u.toLocaleLowerCase()),eo.applyArabicShaping&&(u=eo.applyArabicShaping(u)),u}(a.text,t,r)}),e}qn([{name:"triangle",components:3,type:"Uint16"}]),qn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),qn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),qn([{type:"Float32",name:"offsetX"}]),qn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Gu={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"},Vc=function(e,t,r,a,u){var c,f,y=8*u-a-1,x=(1<<y)-1,w=x>>1,I=-7,A=u-1,z=-1,O=e[t+A];for(A+=z,c=O&(1<<-I)-1,O>>=-I,I+=y;I>0;c=256*c+e[t+A],A+=z,I-=8);for(f=c&(1<<-I)-1,c>>=-I,I+=a;I>0;f=256*f+e[t+A],A+=z,I-=8);if(c===0)c=1-w;else{if(c===x)return f?NaN:1/0*(O?-1:1);f+=Math.pow(2,a),c-=w}return(O?-1:1)*f*Math.pow(2,c-a)},jc=function(e,t,r,a,u,c){var f,y,x,w=8*c-u-1,I=(1<<w)-1,A=I>>1,z=u===23?Math.pow(2,-24)-Math.pow(2,-77):0,O=0,Z=1,X=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(y=isNaN(t)?1:0,f=I):(f=Math.floor(Math.log(t)/Math.LN2),t*(x=Math.pow(2,-f))<1&&(f--,x*=2),(t+=f+A>=1?z/x:z*Math.pow(2,1-A))*x>=2&&(f++,x/=2),f+A>=I?(y=0,f=I):f+A>=1?(y=(t*x-1)*Math.pow(2,u),f+=A):(y=t*Math.pow(2,A-1)*Math.pow(2,u),f=0));u>=8;e[r+O]=255&y,O+=Z,y/=256,u-=8);for(f=f<<u|y,w+=u;w>0;e[r+O]=255&f,O+=Z,f/=256,w-=8);e[r+O-Z]|=128*X},gl=Fr;function Fr(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}Fr.Varint=0,Fr.Fixed64=1,Fr.Bytes=2,Fr.Fixed32=5;var qc=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Ua(e){return e.type===Fr.Bytes?e.readVarint()+e.pos:e.pos+1}function ou(e,t,r){return r?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function Zc(e,t,r){var a=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(a);for(var u=r.pos-1;u>=e;u--)r.buf[u+a]=r.buf[u]}function Nh(e,t){for(var r=0;r<e.length;r++)t.writeVarint(e[r])}function Uh(e,t){for(var r=0;r<e.length;r++)t.writeSVarint(e[r])}function Vh(e,t){for(var r=0;r<e.length;r++)t.writeFloat(e[r])}function jh(e,t){for(var r=0;r<e.length;r++)t.writeDouble(e[r])}function qh(e,t){for(var r=0;r<e.length;r++)t.writeBoolean(e[r])}function Zh(e,t){for(var r=0;r<e.length;r++)t.writeFixed32(e[r])}function Gh(e,t){for(var r=0;r<e.length;r++)t.writeSFixed32(e[r])}function Kh(e,t){for(var r=0;r<e.length;r++)t.writeFixed64(e[r])}function Xh(e,t){for(var r=0;r<e.length;r++)t.writeSFixed64(e[r])}function vl(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function au(e,t,r){e[r]=t,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24}function Gc(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}function Wh(e,t,r){e===1&&r.readMessage(Hh,t)}function Hh(e,t,r){if(e===3){var a=r.readMessage(Jh,{}),u=a.width,c=a.height,f=a.left,y=a.top,x=a.advance;t.push({id:a.id,bitmap:new ks({width:u+6,height:c+6},a.bitmap),metrics:{width:u,height:c,left:f,top:y,advance:x}})}}function Jh(e,t,r){e===1?t.id=r.readVarint():e===2?t.bitmap=r.readBytes():e===3?t.width=r.readVarint():e===4?t.height=r.readVarint():e===5?t.left=r.readSVarint():e===6?t.top=r.readSVarint():e===7&&(t.advance=r.readVarint())}function Kc(e){for(var t=0,r=0,a=0,u=e;a<u.length;a+=1){var c=u[a];t+=c.w*c.h,r=Math.max(r,c.w)}e.sort(function(X,re){return re.h-X.h});for(var f=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}],y=0,x=0,w=0,I=e;w<I.length;w+=1)for(var A=I[w],z=f.length-1;z>=0;z--){var O=f[z];if(!(A.w>O.w||A.h>O.h)){if(A.x=O.x,A.y=O.y,x=Math.max(x,A.y+A.h),y=Math.max(y,A.x+A.w),A.w===O.w&&A.h===O.h){var Z=f.pop();z<f.length&&(f[z]=Z)}else A.h===O.h?(O.x+=A.w,O.w-=A.w):A.w===O.w?(O.y+=A.h,O.h-=A.h):(f.push({x:O.x+A.w,y:O.y,w:O.w-A.w,h:A.h}),O.y+=A.h,O.h-=A.h);break}}return{w:y,h:x,fill:t/(y*x)||0}}Fr.prototype={destroy:function(){this.buf=null},readFields:function(e,t,r){for(r=r||this.length;this.pos<r;){var a=this.readVarint(),u=a>>3,c=this.pos;this.type=7&a,e(u,t,this),this.pos===c&&this.skip(a)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=vl(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=Gc(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=vl(this.buf,this.pos)+4294967296*vl(this.buf,this.pos+4);return this.pos+=8,e},readSFixed64:function(){var e=vl(this.buf,this.pos)+4294967296*Gc(this.buf,this.pos+4);return this.pos+=8,e},readFloat:function(){var e=Vc(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=Vc(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,r,a=this.buf;return t=127&(r=a[this.pos++]),r<128?t:(t|=(127&(r=a[this.pos++]))<<7,r<128?t:(t|=(127&(r=a[this.pos++]))<<14,r<128?t:(t|=(127&(r=a[this.pos++]))<<21,r<128?t:function(u,c,f){var y,x,w=f.buf;if(y=(112&(x=w[f.pos++]))>>4,x<128||(y|=(127&(x=w[f.pos++]))<<3,x<128)||(y|=(127&(x=w[f.pos++]))<<10,x<128)||(y|=(127&(x=w[f.pos++]))<<17,x<128)||(y|=(127&(x=w[f.pos++]))<<24,x<128)||(y|=(1&(x=w[f.pos++]))<<31,x<128))return ou(u,y,c);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(r=a[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&qc?function(r,a,u){return qc.decode(r.subarray(a,u))}(this.buf,t,e):function(r,a,u){for(var c="",f=a;f<u;){var y,x,w,I=r[f],A=null,z=I>239?4:I>223?3:I>191?2:1;if(f+z>u)break;z===1?I<128&&(A=I):z===2?(192&(y=r[f+1]))==128&&(A=(31&I)<<6|63&y)<=127&&(A=null):z===3?(x=r[f+2],(192&(y=r[f+1]))==128&&(192&x)==128&&((A=(15&I)<<12|(63&y)<<6|63&x)<=2047||A>=55296&&A<=57343)&&(A=null)):z===4&&(x=r[f+2],w=r[f+3],(192&(y=r[f+1]))==128&&(192&x)==128&&(192&w)==128&&((A=(15&I)<<18|(63&y)<<12|(63&x)<<6|63&w)<=65535||A>=1114112)&&(A=null)),A===null?(A=65533,z=1):A>65535&&(A-=65536,c+=String.fromCharCode(A>>>10&1023|55296),A=56320|1023&A),c+=String.fromCharCode(A),f+=z}return c}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==Fr.Bytes)return e.push(this.readVarint(t));var r=Ua(this);for(e=e||[];this.pos<r;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==Fr.Bytes)return e.push(this.readSVarint());var t=Ua(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==Fr.Bytes)return e.push(this.readBoolean());var t=Ua(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==Fr.Bytes)return e.push(this.readFloat());var t=Ua(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==Fr.Bytes)return e.push(this.readDouble());var t=Ua(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==Fr.Bytes)return e.push(this.readFixed32());var t=Ua(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==Fr.Bytes)return e.push(this.readSFixed32());var t=Ua(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==Fr.Bytes)return e.push(this.readFixed64());var t=Ua(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==Fr.Bytes)return e.push(this.readSFixed64());var t=Ua(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===Fr.Varint)for(;this.buf[this.pos++]>127;);else if(t===Fr.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Fr.Fixed32)this.pos+=4;else{if(t!==Fr.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),au(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),au(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),au(this.buf,-1&e,this.pos),au(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),au(this.buf,-1&e,this.pos),au(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(t,r){var a,u;if(t>=0?(a=t%4294967296|0,u=t/4294967296|0):(u=~(-t/4294967296),4294967295^(a=~(-t%4294967296))?a=a+1|0:(a=0,u=u+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(c,f,y){y.buf[y.pos++]=127&c|128,c>>>=7,y.buf[y.pos++]=127&c|128,c>>>=7,y.buf[y.pos++]=127&c|128,c>>>=7,y.buf[y.pos++]=127&c|128,y.buf[y.pos]=127&(c>>>=7)}(a,0,r),function(c,f){var y=(7&c)<<4;f.buf[f.pos++]|=y|((c>>>=3)?128:0),c&&(f.buf[f.pos++]=127&c|((c>>>=7)?128:0),c&&(f.buf[f.pos++]=127&c|((c>>>=7)?128:0),c&&(f.buf[f.pos++]=127&c|((c>>>=7)?128:0),c&&(f.buf[f.pos++]=127&c|((c>>>=7)?128:0),c&&(f.buf[f.pos++]=127&c)))))}(u,r)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(!!e)},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(a,u,c){for(var f,y,x=0;x<u.length;x++){if((f=u.charCodeAt(x))>55295&&f<57344){if(!y){f>56319||x+1===u.length?(a[c++]=239,a[c++]=191,a[c++]=189):y=f;continue}if(f<56320){a[c++]=239,a[c++]=191,a[c++]=189,y=f;continue}f=y-55296<<10|f-56320|65536,y=null}else y&&(a[c++]=239,a[c++]=191,a[c++]=189,y=null);f<128?a[c++]=f:(f<2048?a[c++]=f>>6|192:(f<65536?a[c++]=f>>12|224:(a[c++]=f>>18|240,a[c++]=f>>12&63|128),a[c++]=f>>6&63|128),a[c++]=63&f|128)}return c}(this.buf,e,this.pos);var r=this.pos-t;r>=128&&Zc(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(e){this.realloc(4),jc(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),jc(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=e[r]},writeRawMessage:function(e,t){this.pos++;var r=this.pos;e(t,this);var a=this.pos-r;a>=128&&Zc(r,a,this),this.pos=r-1,this.writeVarint(a),this.pos+=a},writeMessage:function(e,t,r){this.writeTag(e,Fr.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,Nh,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,Uh,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,qh,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,Vh,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,jh,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,Zh,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,Gh,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,Kh,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,Xh,t)},writeBytesField:function(e,t){this.writeTag(e,Fr.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,Fr.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,Fr.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,Fr.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,Fr.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,Fr.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,Fr.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,Fr.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,Fr.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,Fr.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,!!t)}};var _l=function(e,t){var r=t.pixelRatio,a=t.version,u=t.stretchX,c=t.stretchY,f=t.content;this.paddedRect=e,this.pixelRatio=r,this.stretchX=u,this.stretchY=c,this.content=f,this.version=a},Ku={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};Ku.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},Ku.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},Ku.tlbr.get=function(){return this.tl.concat(this.br)},Ku.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(_l.prototype,Ku);var Xu=function(e,t){var r={},a={};this.haveRenderCallbacks=[];var u=[];this.addImages(e,r,u),this.addImages(t,a,u);var c=Kc(u),f=new Wi({width:c.w||1,height:c.h||1});for(var y in e){var x=e[y],w=r[y].paddedRect;Wi.copy(x.data,f,{x:0,y:0},{x:w.x+1,y:w.y+1},x.data)}for(var I in t){var A=t[I],z=a[I].paddedRect,O=z.x+1,Z=z.y+1,X=A.data.width,re=A.data.height;Wi.copy(A.data,f,{x:0,y:0},{x:O,y:Z},A.data),Wi.copy(A.data,f,{x:0,y:re-1},{x:O,y:Z-1},{width:X,height:1}),Wi.copy(A.data,f,{x:0,y:0},{x:O,y:Z+re},{width:X,height:1}),Wi.copy(A.data,f,{x:X-1,y:0},{x:O-1,y:Z},{width:1,height:re}),Wi.copy(A.data,f,{x:0,y:0},{x:O+X,y:Z},{width:1,height:re})}this.image=f,this.iconPositions=r,this.patternPositions=a};Xu.prototype.addImages=function(e,t,r){for(var a in e){var u=e[a],c={x:0,y:0,w:u.data.width+2,h:u.data.height+2};r.push(c),t[a]=new _l(c,u),u.hasRenderCallback&&this.haveRenderCallbacks.push(a)}},Xu.prototype.patchUpdatedImages=function(e,t){for(var r in e.dispatchRenderCallbacks(this.haveRenderCallbacks),e.updatedImages)this.patchUpdatedImage(this.iconPositions[r],e.getImage(r),t),this.patchUpdatedImage(this.patternPositions[r],e.getImage(r),t)},Xu.prototype.patchUpdatedImage=function(e,t,r){if(e&&t&&e.version!==t.version){e.version=t.version;var a=e.tl;r.update(t.data,void 0,{x:a[0],y:a[1]})}},Qe("ImagePosition",_l),Qe("ImageAtlas",Xu);var mo={horizontal:1,vertical:2,horizontalOnly:3},su=function(){this.scale=1,this.fontStack="",this.imageName=null};su.forText=function(e,t){var r=new su;return r.scale=e||1,r.fontStack=t,r},su.forImage=function(e){var t=new su;return t.imageName=e,t};var mi=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function xl(e,t,r,a,u,c,f,y,x,w,I,A,z,O,Z,X){var re,Y=mi.fromFeature(e,u);A===mo.vertical&&Y.verticalizePunctuation();var ce=eo.processBidirectionalText,ve=eo.processStyledBidirectionalText;if(ce&&Y.sections.length===1){re=[];for(var xe=0,Te=ce(Y.toString(),nc(Y,w,c,t,a,O,Z));xe<Te.length;xe+=1){var Me=Te[xe],Ue=new mi;Ue.text=Me,Ue.sections=Y.sections;for(var Je=0;Je<Me.length;Je++)Ue.sectionIndex.push(0);re.push(Ue)}}else if(ve){re=[];for(var xt=0,ut=ve(Y.text,Y.sectionIndex,nc(Y,w,c,t,a,O,Z));xt<ut.length;xt+=1){var St=ut[xt],lt=new mi;lt.text=St[0],lt.sectionIndex=St[1],lt.sections=Y.sections,re.push(lt)}}else re=function(vt,ir){for(var Gt=[],fr=vt.text,Tt=0,_r=0,Xr=ir;_r<Xr.length;_r+=1){var an=Xr[_r];Gt.push(vt.substring(Tt,an)),Tt=an}return Tt<fr.length&&Gt.push(vt.substring(Tt,fr.length)),Gt}(Y,nc(Y,w,c,t,a,O,Z));var Qt=[],Mt={positionedLines:Qt,text:Y.toString(),top:I[1],bottom:I[1],left:I[0],right:I[0],writingMode:A,iconsInText:!1,verticalizable:!1};return function(vt,ir,Gt,fr,Tt,_r,Xr,an,$r,Wr,sn,Bn){for(var Fn=0,yi=-17,Kn=0,gi=0,fn=an==="right"?1:an==="left"?0:.5,Xn=0,sr=0,Mr=Tt;sr<Mr.length;sr+=1){var Ir=Mr[sr];Ir.trim();var yr=Ir.getMaxScale(),Mi=24*(yr-1),oi={positionedGlyphs:[],lineOffset:0};vt.positionedLines[Xn]=oi;var qr=oi.positionedGlyphs,xn=0;if(Ir.length()){for(var ai=0;ai<Ir.length();ai++){var xr=Ir.getSection(ai),xa=Ir.getSectionIndex(ai),yo=Ir.getCharCode(ai),ba=0,dn=null,wa=null,Ho=null,mu=24,Ls=!($r===mo.horizontal||!sn&&!Ks(yo)||sn&&(bl[yo]||(Za=yo,He.Arabic(Za)||He["Arabic Supplement"](Za)||He["Arabic Extended-A"](Za)||He["Arabic Presentation Forms-A"](Za)||He["Arabic Presentation Forms-B"](Za))));if(xr.imageName){var yu=fr[xr.imageName];if(!yu)continue;Ho=xr.imageName,vt.iconsInText=vt.iconsInText||!0,wa=yu.paddedRect;var qa=yu.displaySize;xr.scale=24*xr.scale/Bn,ba=Mi+(24-qa[1]*xr.scale),mu=(dn={width:qa[0],height:qa[1],left:1,top:-3,advance:Ls?qa[1]:qa[0]}).advance;var gu=Ls?qa[0]*xr.scale-24*yr:qa[1]*xr.scale-24*yr;gu>0&&gu>xn&&(xn=gu)}else{var kl=Gt[xr.fontStack],vu=kl&&kl[yo];if(vu&&vu.rect)wa=vu.rect,dn=vu.metrics;else{var Ju=ir[xr.fontStack],Ml=Ju&&Ju[yo];if(!Ml)continue;dn=Ml.metrics}ba=24*(yr-xr.scale)}Ls?(vt.verticalizable=!0,qr.push({glyph:yo,imageName:Ho,x:Fn,y:yi+ba,vertical:Ls,scale:xr.scale,fontStack:xr.fontStack,sectionIndex:xa,metrics:dn,rect:wa}),Fn+=mu*xr.scale+Wr):(qr.push({glyph:yo,imageName:Ho,x:Fn,y:yi+ba,vertical:Ls,scale:xr.scale,fontStack:xr.fontStack,sectionIndex:xa,metrics:dn,rect:wa}),Fn+=dn.advance*xr.scale+Wr)}qr.length!==0&&(Kn=Math.max(Fn-Wr,Kn),$h(qr,0,qr.length-1,fn,xn)),Fn=0;var zl=_r*yr+xn;oi.lineOffset=Math.max(xn,Mi),yi+=zl,gi=Math.max(zl,gi),++Xn}else yi+=_r,++Xn}var Za,Yu=yi- -17,_u=ic(Xr),cs=_u.horizontalAlign,xu=_u.verticalAlign;(function(Dl,Ll,$u,Qu,Ol,el,tl,rl,Rl){var bu,Bl=(Ll-$u)*Ol;bu=el!==tl?-rl*Qu- -17:(-Qu*Rl+.5)*tl;for(var wu=0,nl=Dl;wu<nl.length;wu+=1)for(var Os=0,il=nl[wu].positionedGlyphs;Os<il.length;Os+=1){var Eu=il[Os];Eu.x+=Bl,Eu.y+=bu}})(vt.positionedLines,fn,cs,xu,Kn,gi,_r,Yu,Tt.length),vt.top+=-xu*Yu,vt.bottom=vt.top+Yu,vt.left+=-cs*Kn,vt.right=vt.left+Kn}(Mt,t,r,a,re,f,y,x,A,w,z,X),!function(vt){for(var ir=0,Gt=vt;ir<Gt.length;ir+=1)if(Gt[ir].positionedGlyphs.length!==0)return!1;return!0}(Qt)&&Mt}mi.fromFeature=function(e,t){for(var r=new mi,a=0;a<e.sections.length;a++){var u=e.sections[a];u.image?r.addImageSection(u):r.addTextSection(u,t)}return r},mi.prototype.length=function(){return this.text.length},mi.prototype.getSection=function(e){return this.sections[this.sectionIndex[e]]},mi.prototype.getSectionIndex=function(e){return this.sectionIndex[e]},mi.prototype.getCharCode=function(e){return this.text.charCodeAt(e)},mi.prototype.verticalizePunctuation=function(){this.text=function(e){for(var t="",r=0;r<e.length;r++){var a=e.charCodeAt(r+1)||null,u=e.charCodeAt(r-1)||null;t+=a&&ku(a)&&!Gu[e[r+1]]||u&&ku(u)&&!Gu[e[r-1]]||!Gu[e[r]]?e[r]:Gu[e[r]]}return t}(this.text)},mi.prototype.trim=function(){for(var e=0,t=0;t<this.text.length&&bl[this.text.charCodeAt(t)];t++)e++;for(var r=this.text.length,a=this.text.length-1;a>=0&&a>=e&&bl[this.text.charCodeAt(a)];a--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)},mi.prototype.substring=function(e,t){var r=new mi;return r.text=this.text.substring(e,t),r.sectionIndex=this.sectionIndex.slice(e,t),r.sections=this.sections,r},mi.prototype.toString=function(){return this.text},mi.prototype.getMaxScale=function(){var e=this;return this.sectionIndex.reduce(function(t,r){return Math.max(t,e.sections[r].scale)},0)},mi.prototype.addTextSection=function(e,t){this.text+=e.text,this.sections.push(su.forText(e.scale,e.fontStack||t));for(var r=this.sections.length-1,a=0;a<e.text.length;++a)this.sectionIndex.push(r)},mi.prototype.addImageSection=function(e){var t=e.image?e.image.name:"";if(t.length!==0){var r=this.getNextImageSectionCharCode();r?(this.text+=String.fromCharCode(r),this.sections.push(su.forImage(t)),this.sectionIndex.push(this.sections.length-1)):Sr("Reached maximum number of images 6401")}else Sr("Can't add FormattedSection with an empty image.")},mi.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var bl={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},ro={};function Xc(e,t,r,a,u,c){if(t.imageName){var f=a[t.imageName];return f?f.displaySize[0]*t.scale*24/c+u:0}var y=r[t.fontStack],x=y&&y[e];return x?x.metrics.advance*t.scale+u:0}function Wc(e,t,r,a){var u=Math.pow(e-t,2);return a?e<t?u/2:2*u:u+Math.abs(r)*r}function Yh(e,t,r){var a=0;return e===10&&(a-=1e4),r&&(a+=150),e!==40&&e!==65288||(a+=50),t!==41&&t!==65289||(a+=50),a}function Hc(e,t,r,a,u,c){for(var f=null,y=Wc(t,r,u,c),x=0,w=a;x<w.length;x+=1){var I=w[x],A=Wc(t-I.x,r,u,c)+I.badness;A<=y&&(f=I,y=A)}return{index:e,x:t,priorBreak:f,badness:y}}function nc(e,t,r,a,u,c,f){if(c!=="point")return[];if(!e)return[];for(var y,x=[],w=function(re,Y,ce,ve,xe,Te){for(var Me=0,Ue=0;Ue<re.length();Ue++){var Je=re.getSection(Ue);Me+=Xc(re.getCharCode(Ue),Je,ve,xe,Y,Te)}return Me/Math.max(1,Math.ceil(Me/ce))}(e,t,r,a,u,f),I=e.text.indexOf("​")>=0,A=0,z=0;z<e.length();z++){var O=e.getSection(z),Z=e.getCharCode(z);if(bl[Z]||(A+=Xc(Z,O,a,u,t,f)),z<e.length()-1){var X=!((y=Z)<11904||!(He["Bopomofo Extended"](y)||He.Bopomofo(y)||He["CJK Compatibility Forms"](y)||He["CJK Compatibility Ideographs"](y)||He["CJK Compatibility"](y)||He["CJK Radicals Supplement"](y)||He["CJK Strokes"](y)||He["CJK Symbols and Punctuation"](y)||He["CJK Unified Ideographs Extension A"](y)||He["CJK Unified Ideographs"](y)||He["Enclosed CJK Letters and Months"](y)||He["Halfwidth and Fullwidth Forms"](y)||He.Hiragana(y)||He["Ideographic Description Characters"](y)||He["Kangxi Radicals"](y)||He["Katakana Phonetic Extensions"](y)||He.Katakana(y)||He["Vertical Forms"](y)||He["Yi Radicals"](y)||He["Yi Syllables"](y)));(ro[Z]||X||O.imageName)&&x.push(Hc(z+1,A,w,x,Yh(Z,e.getCharCode(z+1),X&&I),!1))}}return function re(Y){return Y?re(Y.priorBreak).concat(Y.index):[]}(Hc(e.length(),A,w,x,0,!0))}function ic(e){var t=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function $h(e,t,r,a,u){if(a||u)for(var c=e[r],f=(e[r].x+c.metrics.advance*c.scale)*a,y=t;y<=r;y++)e[y].x-=f,e[y].y+=u}function Jc(e,t,r,a,u,c){var f,y=e.image;if(y.content){var x=y.content,w=y.pixelRatio||1;f=[x[0]/w,x[1]/w,y.displaySize[0]-x[2]/w,y.displaySize[1]-x[3]/w]}var I,A,z,O,Z=t.left*c,X=t.right*c;r==="width"||r==="both"?(O=u[0]+Z-a[3],A=u[0]+X+a[1]):A=(O=u[0]+(Z+X-y.displaySize[0])/2)+y.displaySize[0];var re=t.top*c,Y=t.bottom*c;return r==="height"||r==="both"?(I=u[1]+re-a[0],z=u[1]+Y+a[2]):z=(I=u[1]+(re+Y-y.displaySize[1])/2)+y.displaySize[1],{image:y,top:I,right:A,bottom:z,left:O,collisionPadding:f}}ro[10]=!0,ro[32]=!0,ro[38]=!0,ro[40]=!0,ro[41]=!0,ro[43]=!0,ro[45]=!0,ro[47]=!0,ro[173]=!0,ro[183]=!0,ro[8203]=!0,ro[8208]=!0,ro[8211]=!0,ro[8231]=!0;var uu=function(e){function t(r,a,u,c){e.call(this,r,a),this.angle=u,c!==void 0&&(this.segment=c)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.clone=function(){return new t(this.x,this.y,this.angle,this.segment)},t}(Rt);function oc(e,t){var r=t.expression;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new ar(e+1))};if(r.kind==="source")return{kind:"source"};for(var a=r.zoomStops,u=r.interpolationType,c=0;c<a.length&&a[c]<=e;)c++;for(var f=c=Math.max(0,c-1);f<a.length&&a[f]<e+1;)f++;f=Math.min(a.length-1,f);var y=a[c],x=a[f];return r.kind==="composite"?{kind:"composite",minZoom:y,maxZoom:x,interpolationType:u}:{kind:"camera",minZoom:y,maxZoom:x,minSize:r.evaluate(new ar(y)),maxSize:r.evaluate(new ar(x)),interpolationType:u}}function Yc(e,t,r){var a=t.uSize,u=r.lowerSize;return e.kind==="source"?u/128:e.kind==="composite"?en(u/128,r.upperSize/128,t.uSizeT):a}function $c(e,t){var r=0,a=0;if(e.kind==="constant")a=e.layoutSize;else if(e.kind!=="source"){var u=e.interpolationType,c=u?_t(cn.interpolationFactor(u,t,e.minZoom,e.maxZoom),0,1):0;e.kind==="camera"?a=en(e.minSize,e.maxSize,c):r=c}return{uSizeT:r,uSize:a}}Qe("Anchor",uu);var Qh=Object.freeze({__proto__:null,getSizeData:oc,evaluateSizeForFeature:Yc,evaluateSizeForZoom:$c,SIZE_PACK_FACTOR:128});function Qc(e,t,r,a,u){if(t.segment===void 0)return!0;for(var c=t,f=t.segment+1,y=0;y>-r/2;){if(--f<0)return!1;y-=e[f].dist(c),c=e[f]}y+=e[f].dist(e[f+1]),f++;for(var x=[],w=0;y<r/2;){var I=e[f],A=e[f+1];if(!A)return!1;var z=e[f-1].angleTo(I)-I.angleTo(A);for(z=Math.abs((z+3*Math.PI)%(2*Math.PI)-Math.PI),x.push({distance:y,angleDelta:z}),w+=z;y-x[0].distance>a;)w-=x.shift().angleDelta;if(w>u)return!1;f++,y+=I.dist(A)}return!0}function ep(e){for(var t=0,r=0;r<e.length-1;r++)t+=e[r].dist(e[r+1]);return t}function tp(e,t,r){return e?.6*t*r:0}function rp(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function ef(e,t,r,a,u,c){for(var f=tp(r,u,c),y=rp(r,a)*c,x=0,w=ep(e)/2,I=0;I<e.length-1;I++){var A=e[I],z=e[I+1],O=A.dist(z);if(x+O>w){var Z=(w-x)/O,X=en(A.x,z.x,Z),re=en(A.y,z.y,Z),Y=new uu(X,re,z.angleTo(A),I);return Y._round(),!f||Qc(e,Y,y,f,t)?Y:void 0}x+=O}}function tf(e,t,r,a,u,c,f,y,x){var w=tp(a,c,f),I=rp(a,u),A=I*f,z=e[0].x===0||e[0].x===x||e[0].y===0||e[0].y===x;return t-A<t/4&&(t=A+t/4),function O(Z,X,re,Y,ce,ve,xe,Te,Me){for(var Ue=ve/2,Je=ep(Z),xt=0,ut=X-re,St=[],lt=0;lt<Z.length-1;lt++){for(var Qt=Z[lt],Mt=Z[lt+1],vt=Qt.dist(Mt),ir=Mt.angleTo(Qt);ut+re<xt+vt;){var Gt=((ut+=re)-xt)/vt,fr=en(Qt.x,Mt.x,Gt),Tt=en(Qt.y,Mt.y,Gt);if(fr>=0&&fr<Me&&Tt>=0&&Tt<Me&&ut-Ue>=0&&ut+Ue<=Je){var _r=new uu(fr,Tt,ir,lt);_r._round(),Y&&!Qc(Z,_r,ve,Y,ce)||St.push(_r)}}xt+=vt}return Te||St.length||xe||(St=O(Z,xt/2,re,Y,ce,ve,xe,!0,Me)),St}(e,z?t/2*y%t:(I/2+2*c)*f*y%t,t,w,r,A,z,!1,x)}function np(e,t,r,a,u){for(var c=[],f=0;f<e.length;f++)for(var y=e[f],x=void 0,w=0;w<y.length-1;w++){var I=y[w],A=y[w+1];I.x<t&&A.x<t||(I.x<t?I=new Rt(t,I.y+(t-I.x)/(A.x-I.x)*(A.y-I.y))._round():A.x<t&&(A=new Rt(t,I.y+(t-I.x)/(A.x-I.x)*(A.y-I.y))._round()),I.y<r&&A.y<r||(I.y<r?I=new Rt(I.x+(r-I.y)/(A.y-I.y)*(A.x-I.x),r)._round():A.y<r&&(A=new Rt(I.x+(r-I.y)/(A.y-I.y)*(A.x-I.x),r)._round()),I.x>=a&&A.x>=a||(I.x>=a?I=new Rt(a,I.y+(a-I.x)/(A.x-I.x)*(A.y-I.y))._round():A.x>=a&&(A=new Rt(a,I.y+(a-I.x)/(A.x-I.x)*(A.y-I.y))._round()),I.y>=u&&A.y>=u||(I.y>=u?I=new Rt(I.x+(u-I.y)/(A.y-I.y)*(A.x-I.x),u)._round():A.y>=u&&(A=new Rt(I.x+(u-I.y)/(A.y-I.y)*(A.x-I.x),u)._round()),x&&I.equals(x[x.length-1])||c.push(x=[I]),x.push(A)))))}return c}function ip(e,t,r,a){var u=[],c=e.image,f=c.pixelRatio,y=c.paddedRect.w-2,x=c.paddedRect.h-2,w=e.right-e.left,I=e.bottom-e.top,A=c.stretchX||[[0,y]],z=c.stretchY||[[0,x]],O=function(fr,Tt){return fr+Tt[1]-Tt[0]},Z=A.reduce(O,0),X=z.reduce(O,0),re=y-Z,Y=x-X,ce=0,ve=Z,xe=0,Te=X,Me=0,Ue=re,Je=0,xt=Y;if(c.content&&a){var ut=c.content;ce=wl(A,0,ut[0]),xe=wl(z,0,ut[1]),ve=wl(A,ut[0],ut[2]),Te=wl(z,ut[1],ut[3]),Me=ut[0]-ce,Je=ut[1]-xe,Ue=ut[2]-ut[0]-ve,xt=ut[3]-ut[1]-Te}var St=function(fr,Tt,_r,Xr){var an=El(fr.stretch-ce,ve,w,e.left),$r=Sl(fr.fixed-Me,Ue,fr.stretch,Z),Wr=El(Tt.stretch-xe,Te,I,e.top),sn=Sl(Tt.fixed-Je,xt,Tt.stretch,X),Bn=El(_r.stretch-ce,ve,w,e.left),Fn=Sl(_r.fixed-Me,Ue,_r.stretch,Z),yi=El(Xr.stretch-xe,Te,I,e.top),Kn=Sl(Xr.fixed-Je,xt,Xr.stretch,X),gi=new Rt(an,Wr),fn=new Rt(Bn,Wr),Xn=new Rt(Bn,yi),sr=new Rt(an,yi),Mr=new Rt($r/f,sn/f),Ir=new Rt(Fn/f,Kn/f),yr=t*Math.PI/180;if(yr){var Mi=Math.sin(yr),oi=Math.cos(yr),qr=[oi,-Mi,Mi,oi];gi._matMult(qr),fn._matMult(qr),sr._matMult(qr),Xn._matMult(qr)}var xn=fr.stretch+fr.fixed,ai=Tt.stretch+Tt.fixed;return{tl:gi,tr:fn,bl:sr,br:Xn,tex:{x:c.paddedRect.x+1+xn,y:c.paddedRect.y+1+ai,w:_r.stretch+_r.fixed-xn,h:Xr.stretch+Xr.fixed-ai},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Mr,pixelOffsetBR:Ir,minFontScaleX:Ue/f/w,minFontScaleY:xt/f/I,isSDF:r}};if(a&&(c.stretchX||c.stretchY))for(var lt=op(A,re,Z),Qt=op(z,Y,X),Mt=0;Mt<lt.length-1;Mt++)for(var vt=lt[Mt],ir=lt[Mt+1],Gt=0;Gt<Qt.length-1;Gt++)u.push(St(vt,Qt[Gt],ir,Qt[Gt+1]));else u.push(St({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:x+1}));return u}function wl(e,t,r){for(var a=0,u=0,c=e;u<c.length;u+=1){var f=c[u];a+=Math.max(t,Math.min(r,f[1]))-Math.max(t,Math.min(r,f[0]))}return a}function op(e,t,r){for(var a=[{fixed:-1,stretch:0}],u=0,c=e;u<c.length;u+=1){var f=c[u],y=f[0],x=f[1],w=a[a.length-1];a.push({fixed:y-w.stretch,stretch:w.stretch}),a.push({fixed:y-w.stretch,stretch:w.stretch+(x-y)})}return a.push({fixed:t+1,stretch:r}),a}function El(e,t,r,a){return e/t*r+a}function Sl(e,t,r,a){return e-t*r/a}var Tl=function(e,t,r,a,u,c,f,y,x,w){if(this.boxStartIndex=e.length,x){var I=c.top,A=c.bottom,z=c.collisionPadding;z&&(I-=z[1],A+=z[3]);var O=A-I;O>0&&(O=Math.max(10,O),this.circleDiameter=O)}else{var Z=c.top*f-y,X=c.bottom*f+y,re=c.left*f-y,Y=c.right*f+y,ce=c.collisionPadding;if(ce&&(re-=ce[0]*f,Z-=ce[1]*f,Y+=ce[2]*f,X+=ce[3]*f),w){var ve=new Rt(re,Z),xe=new Rt(Y,Z),Te=new Rt(re,X),Me=new Rt(Y,X),Ue=w*Math.PI/180;ve._rotate(Ue),xe._rotate(Ue),Te._rotate(Ue),Me._rotate(Ue),re=Math.min(ve.x,xe.x,Te.x,Me.x),Y=Math.max(ve.x,xe.x,Te.x,Me.x),Z=Math.min(ve.y,xe.y,Te.y,Me.y),X=Math.max(ve.y,xe.y,Te.y,Me.y)}e.emplaceBack(t.x,t.y,re,Z,Y,X,r,a,u)}this.boxEndIndex=e.length},lu=function(e,t){if(e===void 0&&(e=[]),t===void 0&&(t=rf),this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(var r=(this.length>>1)-1;r>=0;r--)this._down(r)};function rf(e,t){return e<t?-1:e>t?1:0}function nf(e,t,r){r===void 0&&(r=!1);for(var a=1/0,u=1/0,c=-1/0,f=-1/0,y=e[0],x=0;x<y.length;x++){var w=y[x];(!x||w.x<a)&&(a=w.x),(!x||w.y<u)&&(u=w.y),(!x||w.x>c)&&(c=w.x),(!x||w.y>f)&&(f=w.y)}var I=Math.min(c-a,f-u),A=I/2,z=new lu([],of);if(I===0)return new Rt(a,u);for(var O=a;O<c;O+=I)for(var Z=u;Z<f;Z+=I)z.push(new cu(O+A,Z+A,A,e));for(var X=function(ce){for(var ve=0,xe=0,Te=0,Me=ce[0],Ue=0,Je=Me.length,xt=Je-1;Ue<Je;xt=Ue++){var ut=Me[Ue],St=Me[xt],lt=ut.x*St.y-St.x*ut.y;xe+=(ut.x+St.x)*lt,Te+=(ut.y+St.y)*lt,ve+=3*lt}return new cu(xe/ve,Te/ve,0,ce)}(e),re=z.length;z.length;){var Y=z.pop();(Y.d>X.d||!X.d)&&(X=Y,r&&console.log("found best %d after %d probes",Math.round(1e4*Y.d)/1e4,re)),Y.max-X.d<=t||(z.push(new cu(Y.p.x-(A=Y.h/2),Y.p.y-A,A,e)),z.push(new cu(Y.p.x+A,Y.p.y-A,A,e)),z.push(new cu(Y.p.x-A,Y.p.y+A,A,e)),z.push(new cu(Y.p.x+A,Y.p.y+A,A,e)),re+=4)}return r&&(console.log("num probes: "+re),console.log("best distance: "+X.d)),X.p}function of(e,t){return t.max-e.max}function cu(e,t,r,a){this.p=new Rt(e,t),this.h=r,this.d=function(u,c){for(var f=!1,y=1/0,x=0;x<c.length;x++)for(var w=c[x],I=0,A=w.length,z=A-1;I<A;z=I++){var O=w[I],Z=w[z];O.y>u.y!=Z.y>u.y&&u.x<(Z.x-O.x)*(u.y-O.y)/(Z.y-O.y)+O.x&&(f=!f),y=Math.min(y,as(u,O,Z))}return(f?1:-1)*Math.sqrt(y)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}lu.prototype.push=function(e){this.data.push(e),this.length++,this._up(this.length-1)},lu.prototype.pop=function(){if(this.length!==0){var e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}},lu.prototype.peek=function(){return this.data[0]},lu.prototype._up=function(e){for(var t=this.data,r=this.compare,a=t[e];e>0;){var u=e-1>>1,c=t[u];if(r(a,c)>=0)break;t[e]=c,e=u}t[e]=a},lu.prototype._down=function(e){for(var t=this.data,r=this.compare,a=this.length>>1,u=t[e];e<a;){var c=1+(e<<1),f=t[c],y=c+1;if(y<this.length&&r(t[y],f)<0&&(c=y,f=t[y]),r(f,u)>=0)break;t[e]=f,e=c}t[e]=u};var ac=Number.POSITIVE_INFINITY;function ap(e,t){return t[1]!==ac?function(r,a,u){var c=0,f=0;switch(a=Math.abs(a),u=Math.abs(u),r){case"top-right":case"top-left":case"top":f=u-7;break;case"bottom-right":case"bottom-left":case"bottom":f=7-u}switch(r){case"top-right":case"bottom-right":case"right":c=-a;break;case"top-left":case"bottom-left":case"left":c=a}return[c,f]}(e,t[0],t[1]):function(r,a){var u=0,c=0;a<0&&(a=0);var f=a/Math.sqrt(2);switch(r){case"top-right":case"top-left":c=f-7;break;case"bottom-right":case"bottom-left":c=7-f;break;case"bottom":c=7-a;break;case"top":c=a-7}switch(r){case"top-right":case"bottom-right":u=-f;break;case"top-left":case"bottom-left":u=f;break;case"left":u=a;break;case"right":u=-a}return[u,c]}(e,t[0])}function sc(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function sp(e,t,r,a,u,c,f,y,x,w,I,A,z,O,Z){var X=function(xe,Te,Me,Ue,Je,xt,ut,St){for(var lt=Ue.layout.get("text-rotate").evaluate(xt,{})*Math.PI/180,Qt=[],Mt=0,vt=Te.positionedLines;Mt<vt.length;Mt+=1)for(var ir=vt[Mt],Gt=0,fr=ir.positionedGlyphs;Gt<fr.length;Gt+=1){var Tt=fr[Gt];if(Tt.rect){var _r=Tt.rect||{},Xr=4,an=!0,$r=1,Wr=0,sn=(Je||St)&&Tt.vertical,Bn=Tt.metrics.advance*Tt.scale/2;if(St&&Te.verticalizable&&(Wr=ir.lineOffset/2-(Tt.imageName?-(24-Tt.metrics.width*Tt.scale)/2:24*(Tt.scale-1))),Tt.imageName){var Fn=ut[Tt.imageName];an=Fn.sdf,Xr=1/($r=Fn.pixelRatio)}var yi=Je?[Tt.x+Bn,Tt.y]:[0,0],Kn=Je?[0,0]:[Tt.x+Bn+Me[0],Tt.y+Me[1]-Wr],gi=[0,0];sn&&(gi=Kn,Kn=[0,0]);var fn=(Tt.metrics.left-Xr)*Tt.scale-Bn+Kn[0],Xn=(-Tt.metrics.top-Xr)*Tt.scale+Kn[1],sr=fn+_r.w*Tt.scale/$r,Mr=Xn+_r.h*Tt.scale/$r,Ir=new Rt(fn,Xn),yr=new Rt(sr,Xn),Mi=new Rt(fn,Mr),oi=new Rt(sr,Mr);if(sn){var qr=new Rt(-Bn,Bn- -17),xn=-Math.PI/2,ai=12-Bn,xr=new Rt(22-ai,-(Tt.imageName?ai:0)),xa=new(Function.prototype.bind.apply(Rt,[null].concat(gi)));Ir._rotateAround(xn,qr)._add(xr)._add(xa),yr._rotateAround(xn,qr)._add(xr)._add(xa),Mi._rotateAround(xn,qr)._add(xr)._add(xa),oi._rotateAround(xn,qr)._add(xr)._add(xa)}if(lt){var yo=Math.sin(lt),ba=Math.cos(lt),dn=[ba,-yo,yo,ba];Ir._matMult(dn),yr._matMult(dn),Mi._matMult(dn),oi._matMult(dn)}var wa=new Rt(0,0),Ho=new Rt(0,0);Qt.push({tl:Ir,tr:yr,bl:Mi,br:oi,tex:_r,writingMode:Te.writingMode,glyphOffset:yi,sectionIndex:Tt.sectionIndex,isSDF:an,pixelOffsetTL:wa,pixelOffsetBR:Ho,minFontScaleX:0,minFontScaleY:0})}}return Qt}(0,r,y,u,c,f,a,e.allowVerticalPlacement),re=e.textSizeData,Y=null;re.kind==="source"?(Y=[128*u.layout.get("text-size").evaluate(f,{})])[0]>32640&&Sr(e.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):re.kind==="composite"&&((Y=[128*O.compositeTextSizes[0].evaluate(f,{},Z),128*O.compositeTextSizes[1].evaluate(f,{},Z)])[0]>32640||Y[1]>32640)&&Sr(e.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),e.addSymbols(e.text,X,Y,y,c,f,w,t,x.lineStartIndex,x.lineLength,z,Z);for(var ce=0,ve=I;ce<ve.length;ce+=1)A[ve[ce]]=e.text.placedSymbolArray.length-1;return 4*X.length}function up(e){for(var t in e)return e[t];return null}function af(e,t,r,a){var u=e.compareText;if(t in u){for(var c=u[t],f=c.length-1;f>=0;f--)if(a.dist(c[f])<r)return!0}else u[t]=[];return u[t].push(a),!1}var sf=iu.VectorTileFeature.types,uf=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Il(e,t,r,a,u,c,f,y,x,w,I,A,z){var O=y?Math.min(32640,Math.round(y[0])):0,Z=y?Math.min(32640,Math.round(y[1])):0;e.emplaceBack(t,r,Math.round(32*a),Math.round(32*u),c,f,(O<<1)+(x?1:0),Z,16*w,16*I,256*A,256*z)}function uc(e,t,r){e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r)}function lf(e){for(var t=0,r=e.sections;t<r.length;t+=1)if(Xs(r[t].text))return!0;return!1}var pu=function(e){this.layoutVertexArray=new Ys,this.indexArray=new da,this.programConfigurations=e,this.segments=new F,this.dynamicLayoutVertexArray=new ns,this.opacityVertexArray=new Ss,this.placedSymbolArray=new s};pu.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},pu.prototype.upload=function(e,t,r,a){this.isEmpty()||(r&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Lh.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Oh.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,uf,!0),this.opacityVertexBuffer.itemSize=1),(r||a)&&this.programConfigurations.upload(e))},pu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},Qe("SymbolBuffers",pu);var Wu=function(e,t,r){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new r,this.segments=new F,this.collisionVertexArray=new Ru};Wu.prototype.upload=function(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Rh.members,!0)},Wu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},Qe("CollisionBuffers",Wu);var Pr=function(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(c){return c.id}),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=to([]),this.placementViewportMatrix=to([]);var t=this.layers[0]._unevaluatedLayout._values;this.textSizeData=oc(this.zoom,t["text-size"]),this.iconSizeData=oc(this.zoom,t["icon-size"]);var r=this.layers[0].layout,a=r.get("symbol-sort-key"),u=r.get("symbol-z-order");this.canOverlap=r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey=u!=="viewport-y"&&a.constantOr(1)!==void 0,this.sortFeaturesByY=(u==="viewport-y"||u==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,r.get("symbol-placement")==="point"&&(this.writingModes=r.get("text-writing-mode").map(function(c){return mo[c]})),this.stateDependentLayerIds=this.layers.filter(function(c){return c.isStateDependent()}).map(function(c){return c.id}),this.sourceID=e.sourceID};Pr.prototype.createArrays=function(){this.text=new pu(new kt(this.layers,this.zoom,function(e){return/^text/.test(e)})),this.icon=new pu(new kt(this.layers,this.zoom,function(e){return/^icon/.test(e)})),this.glyphOffsetArray=new m,this.lineVertexArray=new _,this.symbolInstances=new d},Pr.prototype.calculateGlyphDependencies=function(e,t,r,a,u){for(var c=0;c<e.length;c++)if(t[e.charCodeAt(c)]=!0,(r||a)&&u){var f=Gu[e.charAt(c)];f&&(t[f.charCodeAt(0)]=!0)}},Pr.prototype.populate=function(e,t,r){var a=this.layers[0],u=a.layout,c=u.get("text-font"),f=u.get("text-field"),y=u.get("icon-image"),x=(f.value.kind!=="constant"||f.value.value instanceof E&&!f.value.value.isEmpty()||f.value.value.toString().length>0)&&(c.value.kind!=="constant"||c.value.value.length>0),w=y.value.kind!=="constant"||!!y.value.value||Object.keys(y.parameters).length>0,I=u.get("symbol-sort-key");if(this.features=[],x||w){for(var A=t.iconDependencies,z=t.glyphDependencies,O=t.availableImages,Z=new ar(this.zoom),X=0,re=e;X<re.length;X+=1){var Y=re[X],ce=Y.feature,ve=Y.id,xe=Y.index,Te=Y.sourceLayerIndex,Me=a._featureFilter.needGeometry,Ue=hn(ce,Me);if(a._featureFilter.filter(Z,Ue,r)){Me||(Ue.geometry=Yr(ce));var Je=void 0;if(x){var xt=a.getValueAndResolveTokens("text-field",Ue,r,O),ut=E.factory(xt);lf(ut)&&(this.hasRTLText=!0),(!this.hasRTLText||zu()==="unavailable"||this.hasRTLText&&eo.isParsed())&&(Je=Fh(ut,a,Ue))}var St=void 0;if(w){var lt=a.getValueAndResolveTokens("icon-image",Ue,r,O);St=lt instanceof j?lt:j.fromString(lt)}if(Je||St){var Qt=this.sortFeaturesByKey?I.evaluate(Ue,{},r):void 0;if(this.features.push({id:ve,text:Je,icon:St,index:xe,sourceLayerIndex:Te,geometry:Ue.geometry,properties:ce.properties,type:sf[ce.type],sortKey:Qt}),St&&(A[St.name]=!0),Je){var Mt=c.evaluate(Ue,{},r).join(","),vt=u.get("text-rotation-alignment")==="map"&&u.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(mo.vertical)>=0;for(var ir=0,Gt=Je.sections;ir<Gt.length;ir+=1){var fr=Gt[ir];if(fr.image)A[fr.image.name]=!0;else{var Tt=Pu(Je.toString()),_r=fr.fontStack||Mt,Xr=z[_r]=z[_r]||{};this.calculateGlyphDependencies(fr.text,Xr,vt,this.allowVerticalPlacement,Tt)}}}}}}u.get("symbol-placement")==="line"&&(this.features=function(an){var $r={},Wr={},sn=[],Bn=0;function Fn(qr){sn.push(an[qr]),Bn++}function yi(qr,xn,ai){var xr=Wr[qr];return delete Wr[qr],Wr[xn]=xr,sn[xr].geometry[0].pop(),sn[xr].geometry[0]=sn[xr].geometry[0].concat(ai[0]),xr}function Kn(qr,xn,ai){var xr=$r[xn];return delete $r[xn],$r[qr]=xr,sn[xr].geometry[0].shift(),sn[xr].geometry[0]=ai[0].concat(sn[xr].geometry[0]),xr}function gi(qr,xn,ai){var xr=ai?xn[0][xn[0].length-1]:xn[0][0];return qr+":"+xr.x+":"+xr.y}for(var fn=0;fn<an.length;fn++){var Xn=an[fn],sr=Xn.geometry,Mr=Xn.text?Xn.text.toString():null;if(Mr){var Ir=gi(Mr,sr),yr=gi(Mr,sr,!0);if(Ir in Wr&&yr in $r&&Wr[Ir]!==$r[yr]){var Mi=Kn(Ir,yr,sr),oi=yi(Ir,yr,sn[Mi].geometry);delete $r[Ir],delete Wr[yr],Wr[gi(Mr,sn[oi].geometry,!0)]=oi,sn[Mi].geometry=null}else Ir in Wr?yi(Ir,yr,sr):yr in $r?Kn(Ir,yr,sr):(Fn(fn),$r[Ir]=Bn-1,Wr[yr]=Bn-1)}else Fn(fn)}return sn.filter(function(qr){return qr.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(an,$r){return an.sortKey-$r.sortKey})}},Pr.prototype.update=function(e,t,r){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers,r),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers,r))},Pr.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},Pr.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},Pr.prototype.upload=function(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},Pr.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},Pr.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},Pr.prototype.addToLineVertexArray=function(e,t){var r=this.lineVertexArray.length;if(e.segment!==void 0){for(var a=e.dist(t[e.segment+1]),u=e.dist(t[e.segment]),c={},f=e.segment+1;f<t.length;f++)c[f]={x:t[f].x,y:t[f].y,tileUnitDistanceFromAnchor:a},f<t.length-1&&(a+=t[f+1].dist(t[f]));for(var y=e.segment||0;y>=0;y--)c[y]={x:t[y].x,y:t[y].y,tileUnitDistanceFromAnchor:u},y>0&&(u+=t[y-1].dist(t[y]));for(var x=0;x<t.length;x++){var w=c[x];this.lineVertexArray.emplaceBack(w.x,w.y,w.tileUnitDistanceFromAnchor)}}return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}},Pr.prototype.addSymbols=function(e,t,r,a,u,c,f,y,x,w,I,A){for(var z=e.indexArray,O=e.layoutVertexArray,Z=e.segments.prepareSegment(4*t.length,O,z,this.canOverlap?c.sortKey:void 0),X=this.glyphOffsetArray.length,re=Z.vertexLength,Y=this.allowVerticalPlacement&&f===mo.vertical?Math.PI/2:0,ce=c.text&&c.text.sections,ve=0;ve<t.length;ve++){var xe=t[ve],Te=xe.tl,Me=xe.tr,Ue=xe.bl,Je=xe.br,xt=xe.tex,ut=xe.pixelOffsetTL,St=xe.pixelOffsetBR,lt=xe.minFontScaleX,Qt=xe.minFontScaleY,Mt=xe.glyphOffset,vt=xe.isSDF,ir=xe.sectionIndex,Gt=Z.vertexLength,fr=Mt[1];Il(O,y.x,y.y,Te.x,fr+Te.y,xt.x,xt.y,r,vt,ut.x,ut.y,lt,Qt),Il(O,y.x,y.y,Me.x,fr+Me.y,xt.x+xt.w,xt.y,r,vt,St.x,ut.y,lt,Qt),Il(O,y.x,y.y,Ue.x,fr+Ue.y,xt.x,xt.y+xt.h,r,vt,ut.x,St.y,lt,Qt),Il(O,y.x,y.y,Je.x,fr+Je.y,xt.x+xt.w,xt.y+xt.h,r,vt,St.x,St.y,lt,Qt),uc(e.dynamicLayoutVertexArray,y,Y),z.emplaceBack(Gt,Gt+1,Gt+2),z.emplaceBack(Gt+1,Gt+2,Gt+3),Z.vertexLength+=4,Z.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Mt[0]),ve!==t.length-1&&ir===t[ve+1].sectionIndex||e.programConfigurations.populatePaintArrays(O.length,c,c.index,{},A,ce&&ce[ir])}e.placedSymbolArray.emplaceBack(y.x,y.y,X,this.glyphOffsetArray.length-X,re,x,w,y.segment,r?r[0]:0,r?r[1]:0,a[0],a[1],f,0,!1,0,I)},Pr.prototype._addCollisionDebugVertex=function(e,t,r,a,u,c){return t.emplaceBack(0,0),e.emplaceBack(r.x,r.y,a,u,Math.round(c.x),Math.round(c.y))},Pr.prototype.addCollisionDebugVertices=function(e,t,r,a,u,c,f){var y=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),x=y.vertexLength,w=u.layoutVertexArray,I=u.collisionVertexArray,A=f.anchorX,z=f.anchorY;this._addCollisionDebugVertex(w,I,c,A,z,new Rt(e,t)),this._addCollisionDebugVertex(w,I,c,A,z,new Rt(r,t)),this._addCollisionDebugVertex(w,I,c,A,z,new Rt(r,a)),this._addCollisionDebugVertex(w,I,c,A,z,new Rt(e,a)),y.vertexLength+=4;var O=u.indexArray;O.emplaceBack(x,x+1),O.emplaceBack(x+1,x+2),O.emplaceBack(x+2,x+3),O.emplaceBack(x+3,x),y.primitiveLength+=4},Pr.prototype.addDebugCollisionBoxes=function(e,t,r,a){for(var u=e;u<t;u++){var c=this.collisionBoxArray.get(u);this.addCollisionDebugVertices(c.x1,c.y1,c.x2,c.y2,a?this.textCollisionBox:this.iconCollisionBox,c.anchorPoint,r)}},Pr.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Wu(is,Uc.members,Ts),this.iconCollisionBox=new Wu(is,Uc.members,Ts);for(var e=0;e<this.symbolInstances.length;e++){var t=this.symbolInstances.get(e);this.addDebugCollisionBoxes(t.textBoxStartIndex,t.textBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.verticalTextBoxStartIndex,t.verticalTextBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.iconBoxStartIndex,t.iconBoxEndIndex,t,!1),this.addDebugCollisionBoxes(t.verticalIconBoxStartIndex,t.verticalIconBoxEndIndex,t,!1)}},Pr.prototype._deserializeCollisionBoxesForSymbol=function(e,t,r,a,u,c,f,y,x){for(var w={},I=t;I<r;I++){var A=e.get(I);w.textBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,anchorPointX:A.anchorPointX,anchorPointY:A.anchorPointY},w.textFeatureIndex=A.featureIndex;break}for(var z=a;z<u;z++){var O=e.get(z);w.verticalTextBox={x1:O.x1,y1:O.y1,x2:O.x2,y2:O.y2,anchorPointX:O.anchorPointX,anchorPointY:O.anchorPointY},w.verticalTextFeatureIndex=O.featureIndex;break}for(var Z=c;Z<f;Z++){var X=e.get(Z);w.iconBox={x1:X.x1,y1:X.y1,x2:X.x2,y2:X.y2,anchorPointX:X.anchorPointX,anchorPointY:X.anchorPointY},w.iconFeatureIndex=X.featureIndex;break}for(var re=y;re<x;re++){var Y=e.get(re);w.verticalIconBox={x1:Y.x1,y1:Y.y1,x2:Y.x2,y2:Y.y2,anchorPointX:Y.anchorPointX,anchorPointY:Y.anchorPointY},w.verticalIconFeatureIndex=Y.featureIndex;break}return w},Pr.prototype.deserializeCollisionBoxes=function(e){this.collisionArrays=[];for(var t=0;t<this.symbolInstances.length;t++){var r=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex))}},Pr.prototype.hasTextData=function(){return this.text.segments.get().length>0},Pr.prototype.hasIconData=function(){return this.icon.segments.get().length>0},Pr.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},Pr.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},Pr.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},Pr.prototype.addIndicesForPlacedSymbol=function(e,t){for(var r=e.placedSymbolArray.get(t),a=r.vertexStartIndex+4*r.numGlyphs,u=r.vertexStartIndex;u<a;u+=4)e.indexArray.emplaceBack(u,u+1,u+2),e.indexArray.emplaceBack(u+1,u+2,u+3)},Pr.prototype.getSortedSymbolIndexes=function(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var t=Math.sin(e),r=Math.cos(e),a=[],u=[],c=[],f=0;f<this.symbolInstances.length;++f){c.push(f);var y=this.symbolInstances.get(f);a.push(0|Math.round(t*y.anchorX+r*y.anchorY)),u.push(y.featureIndex)}return c.sort(function(x,w){return a[x]-a[w]||u[w]-u[x]}),c},Pr.prototype.addToSortKeyRanges=function(e,t){var r=this.sortKeyRanges[this.sortKeyRanges.length-1];r&&r.sortKey===t?r.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})},Pr.prototype.sortFeatures=function(e){var t=this;if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var r=0,a=this.symbolInstanceIndexes;r<a.length;r+=1){var u=this.symbolInstances.get(a[r]);this.featureSortOrder.push(u.featureIndex),[u.rightJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.leftJustifiedTextSymbolIndex].forEach(function(c,f,y){c>=0&&y.indexOf(c)===f&&t.addIndicesForPlacedSymbol(t.text,c)}),u.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,u.verticalPlacedTextSymbolIndex),u.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,u.placedIconSymbolIndex),u.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,u.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},Qe("SymbolBucket",Pr,{omit:["layers","collisionBoxArray","features","compareText"]}),Pr.MAX_GLYPHS=65535,Pr.addDynamicAttributes=uc;var cf=new Yn({"symbol-placement":new wt(L.layout_symbol["symbol-placement"]),"symbol-spacing":new wt(L.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new wt(L.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new gt(L.layout_symbol["symbol-sort-key"]),"symbol-z-order":new wt(L.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new wt(L.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new wt(L.layout_symbol["icon-ignore-placement"]),"icon-optional":new wt(L.layout_symbol["icon-optional"]),"icon-rotation-alignment":new wt(L.layout_symbol["icon-rotation-alignment"]),"icon-size":new gt(L.layout_symbol["icon-size"]),"icon-text-fit":new wt(L.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new wt(L.layout_symbol["icon-text-fit-padding"]),"icon-image":new gt(L.layout_symbol["icon-image"]),"icon-rotate":new gt(L.layout_symbol["icon-rotate"]),"icon-padding":new wt(L.layout_symbol["icon-padding"]),"icon-keep-upright":new wt(L.layout_symbol["icon-keep-upright"]),"icon-offset":new gt(L.layout_symbol["icon-offset"]),"icon-anchor":new gt(L.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new wt(L.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new wt(L.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new wt(L.layout_symbol["text-rotation-alignment"]),"text-field":new gt(L.layout_symbol["text-field"]),"text-font":new gt(L.layout_symbol["text-font"]),"text-size":new gt(L.layout_symbol["text-size"]),"text-max-width":new gt(L.layout_symbol["text-max-width"]),"text-line-height":new wt(L.layout_symbol["text-line-height"]),"text-letter-spacing":new gt(L.layout_symbol["text-letter-spacing"]),"text-justify":new gt(L.layout_symbol["text-justify"]),"text-radial-offset":new gt(L.layout_symbol["text-radial-offset"]),"text-variable-anchor":new wt(L.layout_symbol["text-variable-anchor"]),"text-anchor":new gt(L.layout_symbol["text-anchor"]),"text-max-angle":new wt(L.layout_symbol["text-max-angle"]),"text-writing-mode":new wt(L.layout_symbol["text-writing-mode"]),"text-rotate":new gt(L.layout_symbol["text-rotate"]),"text-padding":new wt(L.layout_symbol["text-padding"]),"text-keep-upright":new wt(L.layout_symbol["text-keep-upright"]),"text-transform":new gt(L.layout_symbol["text-transform"]),"text-offset":new gt(L.layout_symbol["text-offset"]),"text-allow-overlap":new wt(L.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new wt(L.layout_symbol["text-ignore-placement"]),"text-optional":new wt(L.layout_symbol["text-optional"])}),lc={paint:new Yn({"icon-opacity":new gt(L.paint_symbol["icon-opacity"]),"icon-color":new gt(L.paint_symbol["icon-color"]),"icon-halo-color":new gt(L.paint_symbol["icon-halo-color"]),"icon-halo-width":new gt(L.paint_symbol["icon-halo-width"]),"icon-halo-blur":new gt(L.paint_symbol["icon-halo-blur"]),"icon-translate":new wt(L.paint_symbol["icon-translate"]),"icon-translate-anchor":new wt(L.paint_symbol["icon-translate-anchor"]),"text-opacity":new gt(L.paint_symbol["text-opacity"]),"text-color":new gt(L.paint_symbol["text-color"],{runtimeType:Ye,getOverride:function(e){return e.textColor},hasOverride:function(e){return!!e.textColor}}),"text-halo-color":new gt(L.paint_symbol["text-halo-color"]),"text-halo-width":new gt(L.paint_symbol["text-halo-width"]),"text-halo-blur":new gt(L.paint_symbol["text-halo-blur"]),"text-translate":new wt(L.paint_symbol["text-translate"]),"text-translate-anchor":new wt(L.paint_symbol["text-translate-anchor"])}),layout:cf},hu=function(e){this.type=e.property.overrides?e.property.overrides.runtimeType:We,this.defaultValue=e};hu.prototype.evaluate=function(e){if(e.formattedSection){var t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default},hu.prototype.eachChild=function(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)},hu.prototype.outputDefined=function(){return!1},hu.prototype.serialize=function(){return null},Qe("FormatSectionOverride",hu,{omit:["defaultValue"]});var pf=function(e){function t(r){e.call(this,r,lc)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.recalculate=function(r,a){if(e.prototype.recalculate.call(this,r,a),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var u=this.layout.get("text-writing-mode");if(u){for(var c=[],f=0,y=u;f<y.length;f+=1){var x=y[f];c.indexOf(x)<0&&c.push(x)}this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},t.prototype.getValueAndResolveTokens=function(r,a,u,c){var f=this.layout.get(r).evaluate(a,{},u,c),y=this._unevaluatedLayout._values[r];return y.isDataDriven()||Da(y.value)||!f?f:function(x,w){return w.replace(/{([^{}]+)}/g,function(I,A){return A in x?String(x[A]):""})}(a.properties,f)},t.prototype.createBucket=function(r){return new Pr(r)},t.prototype.queryRadius=function(){return 0},t.prototype.queryIntersectsFeature=function(){return!1},t.prototype._setPaintOverrides=function(){for(var r=0,a=lc.paint.overridableProperties;r<a.length;r+=1){var u=a[r];if(t.hasPaintOverride(this.layout,u)){var c,f=this.paint.get(u),y=new hu(f),x=new ha(y,f.property.specification);c=f.value.kind==="constant"||f.value.kind==="source"?new qo("source",x):new ci("composite",x,f.value.zoomStops,f.value._interpolationType),this.paint._values[u]=new hi(f.property,c,f.parameters)}}},t.prototype._handleOverridablePaintPropertyUpdate=function(r,a,u){return!(!this.layout||a.isDataDriven()||u.isDataDriven())&&t.hasPaintOverride(this.layout,r)},t.hasPaintOverride=function(r,a){var u=r.get("text-field"),c=lc.paint.properties[a],f=!1,y=function(I){for(var A=0,z=I;A<z.length;A+=1)if(c.overrides&&c.overrides.hasOverride(z[A]))return void(f=!0)};if(u.value.kind==="constant"&&u.value.value instanceof E)y(u.value.value.sections);else if(u.value.kind==="source"){var x=function(I){f||(I instanceof Ge&&V(I.value)===Nt?y(I.value.sections):I instanceof At?y(I.sections):I.eachChild(x))},w=u.value;w._styleExpression&&x(w._styleExpression.expression)}return f},t}(Go),hf={paint:new Yn({"background-color":new wt(L.paint_background["background-color"]),"background-pattern":new fi(L.paint_background["background-pattern"]),"background-opacity":new wt(L.paint_background["background-opacity"])})},ff=function(e){function t(r){e.call(this,r,hf)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(Go),df={paint:new Yn({"raster-opacity":new wt(L.paint_raster["raster-opacity"]),"raster-hue-rotate":new wt(L.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new wt(L.paint_raster["raster-brightness-min"]),"raster-brightness-max":new wt(L.paint_raster["raster-brightness-max"]),"raster-saturation":new wt(L.paint_raster["raster-saturation"]),"raster-contrast":new wt(L.paint_raster["raster-contrast"]),"raster-resampling":new wt(L.paint_raster["raster-resampling"]),"raster-fade-duration":new wt(L.paint_raster["raster-fade-duration"])})},mf=function(e){function t(r){e.call(this,r,df)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(Go),yf=function(e){function t(r){e.call(this,r,{}),this.implementation=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},t.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},t.prototype.recalculate=function(){},t.prototype.updateTransitions=function(){},t.prototype.hasTransition=function(){},t.prototype.serialize=function(){},t.prototype.onAdd=function(r){this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},t.prototype.onRemove=function(r){this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},t}(Go),gf={circle:Xl,heatmap:Qp,hillshade:th,fill:vh,"fill-extrusion":Ch,line:Dh,symbol:pf,background:ff,raster:mf},lp=Xe.HTMLImageElement,cp=Xe.HTMLCanvasElement,pp=Xe.HTMLVideoElement,hp=Xe.ImageData,Cl=Xe.ImageBitmap,Ms=function(e,t,r,a){this.context=e,this.format=r,this.texture=e.gl.createTexture(),this.update(t,a)};Ms.prototype.update=function(e,t,r){var a=e.width,u=e.height,c=!(this.size&&this.size[0]===a&&this.size[1]===u||r),f=this.context,y=f.gl;if(this.useMipmap=!!(t&&t.useMipmap),y.bindTexture(y.TEXTURE_2D,this.texture),f.pixelStoreUnpackFlipY.set(!1),f.pixelStoreUnpack.set(1),f.pixelStoreUnpackPremultiplyAlpha.set(this.format===y.RGBA&&(!t||t.premultiply!==!1)),c)this.size=[a,u],e instanceof lp||e instanceof cp||e instanceof pp||e instanceof hp||Cl&&e instanceof Cl?y.texImage2D(y.TEXTURE_2D,0,this.format,this.format,y.UNSIGNED_BYTE,e):y.texImage2D(y.TEXTURE_2D,0,this.format,a,u,0,this.format,y.UNSIGNED_BYTE,e.data);else{var x=r||{x:0,y:0},w=x.x,I=x.y;e instanceof lp||e instanceof cp||e instanceof pp||e instanceof hp||Cl&&e instanceof Cl?y.texSubImage2D(y.TEXTURE_2D,0,w,I,y.RGBA,y.UNSIGNED_BYTE,e):y.texSubImage2D(y.TEXTURE_2D,0,w,I,a,u,y.RGBA,y.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&y.generateMipmap(y.TEXTURE_2D)},Ms.prototype.bind=function(e,t,r){var a=this.context.gl;a.bindTexture(a.TEXTURE_2D,this.texture),r!==a.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(r=a.LINEAR),e!==this.filter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,e),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,r||e),this.filter=e),t!==this.wrap&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,t),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,t),this.wrap=t)},Ms.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},Ms.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var cc=function(e){var t=this;this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){t._triggered=!1,t._callback()})};cc.prototype.trigger=function(){var e=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){e._triggered=!1,e._callback()},0))},cc.prototype.remove=function(){delete this._channel,this._callback=function(){}};var fu=function(e,t,r){this.target=e,this.parent=t,this.mapId=r,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},Qr(["receive","process"],this),this.invoker=new cc(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=yn()?e:Xe};function fp(e,t,r){var a=2*Math.PI*6378137/256/Math.pow(2,r);return[e*a-2*Math.PI*6378137/2,t*a-2*Math.PI*6378137/2]}fu.prototype.send=function(e,t,r,a,u){var c=this;u===void 0&&(u=!1);var f=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(this.callbacks[f]=r);var y=xi(this.globalScope)?void 0:[];return this.target.postMessage({id:f,type:e,hasCallback:!!r,targetMapId:a,mustQueue:u,sourceMapId:this.mapId,data:pi(t,y)},y),{cancel:function(){r&&delete c.callbacks[f],c.target.postMessage({id:f,type:"<cancel>",targetMapId:a,sourceMapId:c.mapId})}}},fu.prototype.receive=function(e){var t=e.data,r=t.id;if(r&&(!t.targetMapId||this.mapId===t.targetMapId))if(t.type==="<cancel>"){delete this.tasks[r];var a=this.cancelCallbacks[r];delete this.cancelCallbacks[r],a&&a()}else yn()||t.mustQueue?(this.tasks[r]=t,this.taskQueue.push(r),this.invoker.trigger()):this.processTask(r,t)},fu.prototype.process=function(){if(this.taskQueue.length){var e=this.taskQueue.shift(),t=this.tasks[e];delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),t&&this.processTask(e,t)}},fu.prototype.processTask=function(e,t){var r=this;if(t.type==="<response>"){var a=this.callbacks[e];delete this.callbacks[e],a&&(t.error?a(Lr(t.error)):a(null,Lr(t.data)))}else{var u=!1,c=xi(this.globalScope)?void 0:[],f=t.hasCallback?function(I,A){u=!0,delete r.cancelCallbacks[e],r.target.postMessage({id:e,type:"<response>",sourceMapId:r.mapId,error:I?pi(I):null,data:pi(A,c)},c)}:function(I){u=!0},y=null,x=Lr(t.data);if(this.parent[t.type])y=this.parent[t.type](t.sourceMapId,x,f);else if(this.parent.getWorkerSource){var w=t.type.split(".");y=this.parent.getWorkerSource(t.sourceMapId,w[0],x.source)[w[1]](x,f)}else f(new Error("Could not find function "+t.type));!u&&y&&y.cancel&&(this.cancelCallbacks[e]=y.cancel)}},fu.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Pn=function(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))};Pn.prototype.setNorthEast=function(e){return this._ne=e instanceof Kr?new Kr(e.lng,e.lat):Kr.convert(e),this},Pn.prototype.setSouthWest=function(e){return this._sw=e instanceof Kr?new Kr(e.lng,e.lat):Kr.convert(e),this},Pn.prototype.extend=function(e){var t,r,a=this._sw,u=this._ne;if(e instanceof Kr)t=e,r=e;else{if(!(e instanceof Pn))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Pn.convert(e)):this.extend(Kr.convert(e)):this;if(r=e._ne,!(t=e._sw)||!r)return this}return a||u?(a.lng=Math.min(t.lng,a.lng),a.lat=Math.min(t.lat,a.lat),u.lng=Math.max(r.lng,u.lng),u.lat=Math.max(r.lat,u.lat)):(this._sw=new Kr(t.lng,t.lat),this._ne=new Kr(r.lng,r.lat)),this},Pn.prototype.getCenter=function(){return new Kr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Pn.prototype.getSouthWest=function(){return this._sw},Pn.prototype.getNorthEast=function(){return this._ne},Pn.prototype.getNorthWest=function(){return new Kr(this.getWest(),this.getNorth())},Pn.prototype.getSouthEast=function(){return new Kr(this.getEast(),this.getSouth())},Pn.prototype.getWest=function(){return this._sw.lng},Pn.prototype.getSouth=function(){return this._sw.lat},Pn.prototype.getEast=function(){return this._ne.lng},Pn.prototype.getNorth=function(){return this._ne.lat},Pn.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Pn.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Pn.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Pn.prototype.contains=function(e){var t=Kr.convert(e),r=t.lng,a=t.lat,u=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&u},Pn.convert=function(e){return!e||e instanceof Pn?e:new Pn(e)};var Kr=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid LngLat object: ("+e+", "+t+")");if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};Kr.prototype.wrap=function(){return new Kr(or(this.lng,-180,180),this.lat)},Kr.prototype.toArray=function(){return[this.lng,this.lat]},Kr.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},Kr.prototype.distanceTo=function(e){var t=Math.PI/180,r=this.lat*t,a=e.lat*t,u=Math.sin(r)*Math.sin(a)+Math.cos(r)*Math.cos(a)*Math.cos((e.lng-this.lng)*t);return 63710088e-1*Math.acos(Math.min(u,1))},Kr.prototype.toBounds=function(e){e===void 0&&(e=0);var t=360*e/40075017,r=t/Math.cos(Math.PI/180*this.lat);return new Pn(new Kr(this.lng-r,this.lat-t),new Kr(this.lng+r,this.lat+t))},Kr.convert=function(e){if(e instanceof Kr)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Kr(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Kr(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var dp=2*Math.PI*63710088e-1;function mp(e){return dp*Math.cos(e*Math.PI/180)}function yp(e){return(180+e)/360}function gp(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function vp(e,t){return e/mp(t)}function pc(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}var zs=function(e,t,r){r===void 0&&(r=0),this.x=+e,this.y=+t,this.z=+r};zs.fromLngLat=function(e,t){t===void 0&&(t=0);var r=Kr.convert(e);return new zs(yp(r.lng),gp(r.lat),vp(t,r.lat))},zs.prototype.toLngLat=function(){return new Kr(360*this.x-180,pc(this.y))},zs.prototype.toAltitude=function(){return this.z*mp(pc(this.y))},zs.prototype.meterInMercatorCoordinateUnits=function(){return 1/dp*(e=pc(this.y),1/Math.cos(e*Math.PI/180));var e};var Ds=function(e,t,r){this.z=e,this.x=t,this.y=r,this.key=Hu(0,e,e,t,r)};Ds.prototype.equals=function(e){return this.z===e.z&&this.x===e.x&&this.y===e.y},Ds.prototype.url=function(e,t){var r,a,u,c,f,y=(a=this.y,u=this.z,c=fp(256*(r=this.x),256*(a=Math.pow(2,u)-a-1),u),f=fp(256*(r+1),256*(a+1),u),c[0]+","+c[1]+","+f[0]+","+f[1]),x=function(w,I,A){for(var z,O="",Z=w;Z>0;Z--)O+=(I&(z=1<<Z-1)?1:0)+(A&z?2:0);return O}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(t==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",x).replace("{bbox-epsg-3857}",y)},Ds.prototype.getTilePoint=function(e){var t=Math.pow(2,this.z);return new Rt(8192*(e.x*t-this.x),8192*(e.y*t-this.y))},Ds.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var _p=function(e,t){this.wrap=e,this.canonical=t,this.key=Hu(e,t.z,t.z,t.x,t.y)},kn=function(e,t,r,a,u){this.overscaledZ=e,this.wrap=t,this.canonical=new Ds(r,+a,+u),this.key=Hu(t,e,r,a,u)};function Hu(e,t,r,a,u){(e*=2)<0&&(e=-1*e-1);var c=1<<r;return(c*c*e+c*u+a).toString(36)+r.toString(36)+t.toString(36)}kn.prototype.equals=function(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)},kn.prototype.scaledTo=function(e){var t=this.canonical.z-e;return e>this.canonical.z?new kn(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new kn(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)},kn.prototype.calculateScaledKey=function(e,t){var r=this.canonical.z-e;return e>this.canonical.z?Hu(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y):Hu(this.wrap*+t,e,e,this.canonical.x>>r,this.canonical.y>>r)},kn.prototype.isChildOf=function(e){if(e.wrap!==this.wrap)return!1;var t=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t},kn.prototype.children=function(e){if(this.overscaledZ>=e)return[new kn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var t=this.canonical.z+1,r=2*this.canonical.x,a=2*this.canonical.y;return[new kn(t,this.wrap,t,r,a),new kn(t,this.wrap,t,r+1,a),new kn(t,this.wrap,t,r,a+1),new kn(t,this.wrap,t,r+1,a+1)]},kn.prototype.isLessThan=function(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))},kn.prototype.wrapped=function(){return new kn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},kn.prototype.unwrapTo=function(e){return new kn(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)},kn.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},kn.prototype.toUnwrapped=function(){return new _p(this.wrap,this.canonical)},kn.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},kn.prototype.getTilePoint=function(e){return this.canonical.getTilePoint(new zs(e.x-this.wrap,e.y))},Qe("CanonicalTileID",Ds),Qe("OverscaledTileID",kn,{omit:["posMatrix"]});var Va=function(e,t,r){if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(r&&r!=="mapbox"&&r!=="terrarium")return Sr('"'+r+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=t.height;var a=this.dim=t.height-2;this.data=new Uint32Array(t.data.buffer),this.encoding=r||"mapbox";for(var u=0;u<a;u++)this.data[this._idx(-1,u)]=this.data[this._idx(0,u)],this.data[this._idx(a,u)]=this.data[this._idx(a-1,u)],this.data[this._idx(u,-1)]=this.data[this._idx(u,0)],this.data[this._idx(u,a)]=this.data[this._idx(u,a-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(a,-1)]=this.data[this._idx(a-1,0)],this.data[this._idx(-1,a)]=this.data[this._idx(0,a-1)],this.data[this._idx(a,a)]=this.data[this._idx(a-1,a-1)]};Va.prototype.get=function(e,t){var r=new Uint8Array(this.data.buffer),a=4*this._idx(e,t);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(r[a],r[a+1],r[a+2])},Va.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Va.prototype._idx=function(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)},Va.prototype._unpackMapbox=function(e,t,r){return(256*e*256+256*t+r)/10-1e4},Va.prototype._unpackTerrarium=function(e,t,r){return 256*e+t+r/256-32768},Va.prototype.getPixels=function(){return new Wi({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Va.prototype.backfillBorder=function(e,t,r){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");var a=t*this.dim,u=t*this.dim+this.dim,c=r*this.dim,f=r*this.dim+this.dim;switch(t){case-1:a=u-1;break;case 1:u=a+1}switch(r){case-1:c=f-1;break;case 1:f=c+1}for(var y=-t*this.dim,x=-r*this.dim,w=c;w<f;w++)for(var I=a;I<u;I++)this.data[this._idx(I,w)]=e.data[this._idx(I+y,w+x)]},Qe("DEMData",Va);var Al=function(e){this._stringToNumber={},this._numberToString=[];for(var t=0;t<e.length;t++){var r=e[t];this._stringToNumber[r]=t,this._numberToString[t]=r}};Al.prototype.encode=function(e){return this._stringToNumber[e]},Al.prototype.decode=function(e){return this._numberToString[e]};var Pl=function(e,t,r,a,u){this.type="Feature",this._vectorTileFeature=e,e._z=t,e._x=r,e._y=a,this.properties=e.properties,this.id=u},hc={geometry:{configurable:!0}};hc.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},hc.geometry.set=function(e){this._geometry=e},Pl.prototype.toJSON=function(){var e={geometry:this.geometry};for(var t in this)t!=="_geometry"&&t!=="_vectorTileFeature"&&(e[t]=this[t]);return e},Object.defineProperties(Pl.prototype,hc);var du=function(){this.state={},this.stateChanges={},this.deletedStates={}};du.prototype.updateState=function(e,t,r){var a=String(t);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][a]=this.stateChanges[e][a]||{},dr(this.stateChanges[e][a],r),this.deletedStates[e]===null)for(var u in this.deletedStates[e]={},this.state[e])u!==a&&(this.deletedStates[e][u]=null);else if(this.deletedStates[e]&&this.deletedStates[e][a]===null)for(var c in this.deletedStates[e][a]={},this.state[e][a])r[c]||(this.deletedStates[e][a][c]=null);else for(var f in r)this.deletedStates[e]&&this.deletedStates[e][a]&&this.deletedStates[e][a][f]===null&&delete this.deletedStates[e][a][f]},du.prototype.removeFeatureState=function(e,t,r){if(this.deletedStates[e]!==null){var a=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},r&&t!==void 0)this.deletedStates[e][a]!==null&&(this.deletedStates[e][a]=this.deletedStates[e][a]||{},this.deletedStates[e][a][r]=null);else if(t!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][a])for(r in this.deletedStates[e][a]={},this.stateChanges[e][a])this.deletedStates[e][a][r]=null;else this.deletedStates[e][a]=null;else this.deletedStates[e]=null}},du.prototype.getState=function(e,t){var r=String(t),a=dr({},(this.state[e]||{})[r],(this.stateChanges[e]||{})[r]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){var u=this.deletedStates[e][t];if(u===null)return{};for(var c in u)delete a[c]}return a},du.prototype.initializeTileState=function(e,t){e.setFeatureState(this.state,t)},du.prototype.coalesceChanges=function(e,t){var r={};for(var a in this.stateChanges){this.state[a]=this.state[a]||{};var u={};for(var c in this.stateChanges[a])this.state[a][c]||(this.state[a][c]={}),dr(this.state[a][c],this.stateChanges[a][c]),u[c]=this.state[a][c];r[a]=u}for(var f in this.deletedStates){this.state[f]=this.state[f]||{};var y={};if(this.deletedStates[f]===null)for(var x in this.state[f])y[x]={},this.state[f][x]={};else for(var w in this.deletedStates[f]){if(this.deletedStates[f][w]===null)this.state[f][w]={};else for(var I=0,A=Object.keys(this.deletedStates[f][w]);I<A.length;I+=1)delete this.state[f][w][A[I]];y[w]=this.state[f][w]}r[f]=r[f]||{},dr(r[f],y)}if(this.stateChanges={},this.deletedStates={},Object.keys(r).length!==0)for(var z in e)e[z].setFeatureState(r,t)};var ja=function(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new nt(8192,16,0),this.grid3D=new nt(8192,16,0),this.featureIndexArray=new P,this.promoteId=t};function xp(e,t,r,a,u){return bn(e,function(c,f){var y=t instanceof Es?t.get(f):null;return y&&y.evaluate?y.evaluate(r,a,u):y})}function bp(e){for(var t=1/0,r=1/0,a=-1/0,u=-1/0,c=0,f=e;c<f.length;c+=1){var y=f[c];t=Math.min(t,y.x),r=Math.min(r,y.y),a=Math.max(a,y.x),u=Math.max(u,y.y)}return{minX:t,minY:r,maxX:a,maxY:u}}function vf(e,t){return t-e}ja.prototype.insert=function(e,t,r,a,u,c){var f=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,a,u);for(var y=c?this.grid3D:this.grid,x=0;x<t.length;x++){for(var w=t[x],I=[1/0,1/0,-1/0,-1/0],A=0;A<w.length;A++){var z=w[A];I[0]=Math.min(I[0],z.x),I[1]=Math.min(I[1],z.y),I[2]=Math.max(I[2],z.x),I[3]=Math.max(I[3],z.y)}I[0]<8192&&I[1]<8192&&I[2]>=0&&I[3]>=0&&y.insert(f,I[0],I[1],I[2],I[3])}},ja.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new iu.VectorTile(new gl(this.rawTileData)).layers,this.sourceLayerCoder=new Al(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},ja.prototype.query=function(e,t,r,a){var u=this;this.loadVTLayers();for(var c=e.params||{},f=8192/e.tileSize/e.scale,y=La(c.filter),x=e.queryGeometry,w=e.queryPadding*f,I=bp(x),A=this.grid.query(I.minX-w,I.minY-w,I.maxX+w,I.maxY+w),z=bp(e.cameraQueryGeometry),O=this.grid3D.query(z.minX-w,z.minY-w,z.maxX+w,z.maxY+w,function(xe,Te,Me,Ue){return function(Je,xt,ut,St,lt){for(var Qt=0,Mt=Je;Qt<Mt.length;Qt+=1){var vt=Mt[Qt];if(xt<=vt.x&&ut<=vt.y&&St>=vt.x&&lt>=vt.y)return!0}var ir=[new Rt(xt,ut),new Rt(xt,lt),new Rt(St,lt),new Rt(St,ut)];if(Je.length>2){for(var Gt=0,fr=ir;Gt<fr.length;Gt+=1)if(Xo(Je,fr[Gt]))return!0}for(var Tt=0;Tt<Je.length-1;Tt++)if(As(Je[Tt],Je[Tt+1],ir))return!0;return!1}(e.cameraQueryGeometry,xe-w,Te-w,Me+w,Ue+w)}),Z=0,X=O;Z<X.length;Z+=1)A.push(X[Z]);A.sort(vf);for(var re,Y={},ce=function(xe){var Te=A[xe];if(Te!==re){re=Te;var Me=u.featureIndexArray.get(Te),Ue=null;u.loadMatchingFeature(Y,Me.bucketIndex,Me.sourceLayerIndex,Me.featureIndex,y,c.layers,c.availableImages,t,r,a,function(Je,xt,ut){return Ue||(Ue=Yr(Je)),xt.queryIntersectsFeature(x,Je,ut,Ue,u.z,e.transform,f,e.pixelPosMatrix)})}},ve=0;ve<A.length;ve++)ce(ve);return Y},ja.prototype.loadMatchingFeature=function(e,t,r,a,u,c,f,y,x,w,I){var A=this.bucketLayerIDs[t];if(!c||function(Je,xt){for(var ut=0;ut<Je.length;ut++)if(xt.indexOf(Je[ut])>=0)return!0;return!1}(c,A)){var z=this.sourceLayerCoder.decode(r),O=this.vtLayers[z].feature(a);if(u.needGeometry){var Z=hn(O,!0);if(!u.filter(new ar(this.tileID.overscaledZ),Z,this.tileID.canonical))return}else if(!u.filter(new ar(this.tileID.overscaledZ),O))return;for(var X=this.getId(O,z),re=0;re<A.length;re++){var Y=A[re];if(!(c&&c.indexOf(Y)<0)){var ce=y[Y];if(ce){var ve={};X!==void 0&&w&&(ve=w.getState(ce.sourceLayer||"_geojsonTileLayer",X));var xe=dr({},x[Y]);xe.paint=xp(xe.paint,ce.paint,O,ve,f),xe.layout=xp(xe.layout,ce.layout,O,ve,f);var Te=!I||I(O,ce,ve);if(Te){var Me=new Pl(O,this.z,this.x,this.y,X);Me.layer=xe;var Ue=e[Y];Ue===void 0&&(Ue=e[Y]=[]),Ue.push({featureIndex:a,feature:Me,intersectionZ:Te})}}}}}},ja.prototype.lookupSymbolFeatures=function(e,t,r,a,u,c,f,y){var x={};this.loadVTLayers();for(var w=La(u),I=0,A=e;I<A.length;I+=1)this.loadMatchingFeature(x,r,a,A[I],w,c,f,y,t);return x},ja.prototype.hasLayer=function(e){for(var t=0,r=this.bucketLayerIDs;t<r.length;t+=1)for(var a=0,u=r[t];a<u.length;a+=1)if(e===u[a])return!0;return!1},ja.prototype.getId=function(e,t){var r=e.id;return this.promoteId&&typeof(r=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[t]])=="boolean"&&(r=Number(r)),r},Qe("FeatureIndex",ja,{omit:["rawTileData","sourceLayerCoder"]});var Gn=function(e,t){this.tileID=e,this.uid=Rr(),this.uses=0,this.tileSize=t,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};Gn.prototype.registerFadeDuration=function(e){var t=e+this.timeAdded;t<wi.now()||this.fadeEndTime&&t<this.fadeEndTime||(this.fadeEndTime=t)},Gn.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},Gn.prototype.loadVectorData=function(e,t,r){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){for(var a in e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(w,I){var A={};if(!I)return A;for(var z=function(){var X=Z[O],re=X.layerIds.map(function(ve){return I.getLayer(ve)}).filter(Boolean);if(re.length!==0){X.layers=re,X.stateDependentLayerIds&&(X.stateDependentLayers=X.stateDependentLayerIds.map(function(ve){return re.filter(function(xe){return xe.id===ve})[0]}));for(var Y=0,ce=re;Y<ce.length;Y+=1)A[ce[Y].id]=X}},O=0,Z=w;O<Z.length;O+=1)z();return A}(e.buckets,t.style),this.hasSymbolBuckets=!1,this.buckets){var u=this.buckets[a];if(u instanceof Pr){if(this.hasSymbolBuckets=!0,!r)break;u.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var c in this.buckets){var f=this.buckets[c];if(f instanceof Pr&&f.hasRTLText){this.hasRTLText=!0,eo.isLoading()||eo.isLoaded()||zu()!=="deferred"||Do();break}}for(var y in this.queryPadding=0,this.buckets){var x=this.buckets[y];this.queryPadding=Math.max(this.queryPadding,t.style.getLayer(y).queryRadius(x))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new o},Gn.prototype.unloadVectorData=function(){for(var e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},Gn.prototype.getBucket=function(e){return this.buckets[e.id]},Gn.prototype.upload=function(e){for(var t in this.buckets){var r=this.buckets[t];r.uploadPending()&&r.upload(e)}var a=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Ms(e,this.imageAtlas.image,a.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Ms(e,this.glyphAtlasImage,a.ALPHA),this.glyphAtlasImage=null)},Gn.prototype.prepare=function(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)},Gn.prototype.queryRenderedFeatures=function(e,t,r,a,u,c,f,y,x,w){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:a,cameraQueryGeometry:u,scale:c,tileSize:this.tileSize,pixelPosMatrix:w,transform:y,params:f,queryPadding:this.queryPadding*x},e,t,r):{}},Gn.prototype.querySourceFeatures=function(e,t){var r=this.latestFeatureIndex;if(r&&r.rawTileData){var a=r.loadVTLayers(),u=t?t.sourceLayer:"",c=a._geojsonTileLayer||a[u];if(c)for(var f=La(t&&t.filter),y=this.tileID.canonical,x=y.z,w=y.x,I=y.y,A={z:x,x:w,y:I},z=0;z<c.length;z++){var O=c.feature(z);if(f.needGeometry){var Z=hn(O,!0);if(!f.filter(new ar(this.tileID.overscaledZ),Z,this.tileID.canonical))continue}else if(!f.filter(new ar(this.tileID.overscaledZ),O))continue;var X=r.getId(O,u),re=new Pl(O,x,w,I,X);re.tile=A,e.push(re)}}},Gn.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},Gn.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},Gn.prototype.setExpiryData=function(e){var t=this.expirationTime;if(e.cacheControl){var r=vo(e.cacheControl);r["max-age"]&&(this.expirationTime=Date.now()+1e3*r["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){var a=Date.now(),u=!1;if(this.expirationTime>a)u=!1;else if(t)if(this.expirationTime<t)u=!0;else{var c=this.expirationTime-t;c?this.expirationTime=a+Math.max(c,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},Gn.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},Gn.prototype.setFeatureState=function(e,t){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(e).length!==0){var r=this.latestFeatureIndex.loadVTLayers();for(var a in this.buckets)if(t.style.hasLayer(a)){var u=this.buckets[a],c=u.layers[0].sourceLayer||"_geojsonTileLayer",f=r[c],y=e[c];if(f&&y&&Object.keys(y).length!==0){u.update(y,f,this.imageAtlas&&this.imageAtlas.patternPositions||{});var x=t&&t.style&&t.style.getLayer(a);x&&(this.queryPadding=Math.max(this.queryPadding,x.queryRadius(u)))}}}},Gn.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},Gn.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<wi.now()},Gn.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},Gn.prototype.setHoldDuration=function(e){this.symbolFadeHoldUntil=wi.now()+e},Gn.prototype.setDependencies=function(e,t){for(var r={},a=0,u=t;a<u.length;a+=1)r[u[a]]=!0;this.dependencies[e]=r},Gn.prototype.hasDependency=function(e,t){for(var r=0,a=e;r<a.length;r+=1){var u=this.dependencies[a[r]];if(u){for(var c=0,f=t;c<f.length;c+=1)if(u[f[c]])return!0}}return!1};var ls=Xe.performance,wp=function(e){this._marks={start:[e.url,"start"].join("#"),end:[e.url,"end"].join("#"),measure:e.url.toString()},ls.mark(this._marks.start)};wp.prototype.finish=function(){ls.mark(this._marks.end);var e=ls.getEntriesByName(this._marks.measure);return e.length===0&&(ls.measure(this._marks.measure,this._marks.start,this._marks.end),e=ls.getEntriesByName(this._marks.measure),ls.clearMarks(this._marks.start),ls.clearMarks(this._marks.end),ls.clearMeasures(this._marks.measure)),e},l.Actor=fu,l.AlphaImage=ks,l.CanonicalTileID=Ds,l.CollisionBoxArray=o,l.Color=pr,l.DEMData=Va,l.DataConstantProperty=wt,l.DictionaryCoder=Al,l.EXTENT=8192,l.ErrorEvent=ne,l.EvaluationParameters=ar,l.Event=G,l.Evented=$,l.FeatureIndex=ja,l.FillBucket=ra,l.FillExtrusionBucket=na,l.ImageAtlas=Xu,l.ImagePosition=_l,l.LineBucket=ki,l.LngLat=Kr,l.LngLatBounds=Pn,l.MercatorCoordinate=zs,l.ONE_EM=24,l.OverscaledTileID=kn,l.Point=Rt,l.Point$1=Rt,l.Properties=Yn,l.Protobuf=gl,l.RGBAImage=Wi,l.RequestManager=gr,l.RequestPerformance=wp,l.ResourceType=ei,l.SegmentVector=F,l.SourceFeatureState=du,l.StructArrayLayout1ui2=Fu,l.StructArrayLayout2f1f2i16=Ba,l.StructArrayLayout2i4=Ra,l.StructArrayLayout3ui6=da,l.StructArrayLayout4i8=Lu,l.SymbolBucket=Pr,l.Texture=Ms,l.Tile=Gn,l.Transitionable=Jn,l.Uniform1f=Ze,l.Uniform1i=Re,l.Uniform2f=qe,l.Uniform3f=ct,l.Uniform4f=Et,l.UniformColor=Ct,l.UniformMatrix4f=mr,l.UnwrappedTileID=_p,l.ValidationError=J,l.WritingMode=mo,l.ZoomHistory=zo,l.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e},l.addDynamicAttributes=uc,l.asyncAll=function(e,t,r){if(!e.length)return r(null,[]);var a=e.length,u=new Array(e.length),c=null;e.forEach(function(f,y){t(f,function(x,w){x&&(c=x),u[y]=w,--a==0&&r(c,u)})})},l.bezier=nr,l.bindAll=Qr,l.browser=wi,l.cacheEntryPossiblyAdded=function(e){++bt>Dn&&(e.getActor().send("enforceCacheSizeLimit",Bi),bt=0)},l.clamp=_t,l.clearTileCache=function(e){var t=Xe.caches.delete("mapbox-tiles");e&&t.catch(e).then(function(){return e()})},l.clipLine=np,l.clone=function(e){var t=new Er(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},l.clone$1=si,l.clone$2=function(e){var t=new Er(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},l.collisionCircleLayout=Bh,l.config=Ke,l.create=function(){var e=new Er(16);return Er!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},l.create$1=function(){var e=new Er(9);return Er!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e},l.create$2=function(){var e=new Er(4);return Er!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},l.createCommonjsModule=ur,l.createExpression=es,l.createLayout=qn,l.createStyleLayer=function(e){return e.type==="custom"?new yf(e):new gf[e.type](e)},l.cross=function(e,t,r){var a=t[0],u=t[1],c=t[2],f=r[0],y=r[1],x=r[2];return e[0]=u*x-c*y,e[1]=c*f-a*x,e[2]=a*y-u*f,e},l.deepEqual=function e(t,r){if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(var a=0;a<t.length;a++)if(!e(t[a],r[a]))return!1;return!0}if(typeof t=="object"&&t!==null&&r!==null){if(typeof r!="object"||Object.keys(t).length!==Object.keys(r).length)return!1;for(var u in t)if(!e(t[u],r[u]))return!1;return!0}return t===r},l.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},l.dot$1=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},l.ease=Or,l.emitValidationErrors=ft,l.endsWith=zi,l.enforceCacheSizeLimit=function(e){Ii(),Qn&&Qn.then(function(t){t.keys().then(function(r){for(var a=0;a<r.length-e;a++)t.delete(r[a])})})},l.evaluateSizeForFeature=Yc,l.evaluateSizeForZoom=$c,l.evaluateVariableOffset=ap,l.evented=Mu,l.extend=dr,l.featureFilter=La,l.filterObject=vi,l.fromRotation=function(e,t){var r=Math.sin(t),a=Math.cos(t);return e[0]=a,e[1]=r,e[2]=0,e[3]=-r,e[4]=a,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},l.getAnchorAlignment=ic,l.getAnchorJustification=sc,l.getArrayBuffer=xo,l.getImage=M,l.getJSON=function(e,t){return ti(dr(e,{type:"json"}),t)},l.getRTLTextPluginStatus=zu,l.getReferrer=pt,l.getVideo=function(e,t){var r,a,u=Xe.document.createElement("video");u.muted=!0,u.onloadstart=function(){t(null,u)};for(var c=0;c<e.length;c++){var f=Xe.document.createElement("source");r=e[c],a=void 0,(a=Xe.document.createElement("a")).href=r,(a.protocol!==Xe.document.location.protocol||a.host!==Xe.document.location.host)&&(u.crossOrigin="Anonymous"),f.src=e[c],u.appendChild(f)}return{cancel:function(){}}},l.identity=to,l.invert=function(e,t){var r=t[0],a=t[1],u=t[2],c=t[3],f=t[4],y=t[5],x=t[6],w=t[7],I=t[8],A=t[9],z=t[10],O=t[11],Z=t[12],X=t[13],re=t[14],Y=t[15],ce=r*y-a*f,ve=r*x-u*f,xe=r*w-c*f,Te=a*x-u*y,Me=a*w-c*y,Ue=u*w-c*x,Je=I*X-A*Z,xt=I*re-z*Z,ut=I*Y-O*Z,St=A*re-z*X,lt=A*Y-O*X,Qt=z*Y-O*re,Mt=ce*Qt-ve*lt+xe*St+Te*ut-Me*xt+Ue*Je;return Mt?(e[0]=(y*Qt-x*lt+w*St)*(Mt=1/Mt),e[1]=(u*lt-a*Qt-c*St)*Mt,e[2]=(X*Ue-re*Me+Y*Te)*Mt,e[3]=(z*Me-A*Ue-O*Te)*Mt,e[4]=(x*ut-f*Qt-w*xt)*Mt,e[5]=(r*Qt-u*ut+c*xt)*Mt,e[6]=(re*xe-Z*Ue-Y*ve)*Mt,e[7]=(I*Ue-z*xe+O*ve)*Mt,e[8]=(f*lt-y*ut+w*Je)*Mt,e[9]=(a*ut-r*lt-c*Je)*Mt,e[10]=(Z*Me-X*xe+Y*ce)*Mt,e[11]=(A*xe-I*Me-O*ce)*Mt,e[12]=(y*xt-f*St-x*Je)*Mt,e[13]=(r*St-a*xt+u*Je)*Mt,e[14]=(X*ve-Z*Te-re*ce)*Mt,e[15]=(I*Te-A*ve+z*ce)*Mt,e):null},l.isChar=He,l.isMapboxURL=jt,l.keysDifference=function(e,t){var r=[];for(var a in e)a in t||r.push(a);return r},l.makeRequest=ti,l.mapObject=bn,l.mercatorXfromLng=yp,l.mercatorYfromLat=gp,l.mercatorZfromAltitude=vp,l.mul=Kl,l.multiply=Pi,l.mvt=iu,l.nextPowerOfTwo=function(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},l.normalize=function(e,t){var r=t[0],a=t[1],u=t[2],c=r*r+a*a+u*u;return c>0&&(c=1/Math.sqrt(c)),e[0]=t[0]*c,e[1]=t[1]*c,e[2]=t[2]*c,e},l.number=en,l.offscreenCanvasSupported=ui,l.ortho=function(e,t,r,a,u,c,f){var y=1/(t-r),x=1/(a-u),w=1/(c-f);return e[0]=-2*y,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*x,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*w,e[11]=0,e[12]=(t+r)*y,e[13]=(u+a)*x,e[14]=(f+c)*w,e[15]=1,e},l.parseGlyphPBF=function(e){return new gl(e).readFields(Wh,[])},l.pbf=gl,l.performSymbolLayout=function(e,t,r,a,u,c,f){e.createArrays(),e.tilePixelRatio=8192/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;var y=e.layers[0].layout,x=e.layers[0]._unevaluatedLayout._values,w={};if(e.textSizeData.kind==="composite"){var I=e.textSizeData,A=I.maxZoom;w.compositeTextSizes=[x["text-size"].possiblyEvaluate(new ar(I.minZoom),f),x["text-size"].possiblyEvaluate(new ar(A),f)]}if(e.iconSizeData.kind==="composite"){var z=e.iconSizeData,O=z.maxZoom;w.compositeIconSizes=[x["icon-size"].possiblyEvaluate(new ar(z.minZoom),f),x["icon-size"].possiblyEvaluate(new ar(O),f)]}w.layoutTextSize=x["text-size"].possiblyEvaluate(new ar(e.zoom+1),f),w.layoutIconSize=x["icon-size"].possiblyEvaluate(new ar(e.zoom+1),f),w.textMaxSize=x["text-size"].possiblyEvaluate(new ar(18));for(var Z=24*y.get("text-line-height"),X=y.get("text-rotation-alignment")==="map"&&y.get("symbol-placement")!=="point",re=y.get("text-keep-upright"),Y=y.get("text-size"),ce=function(){var Te=xe[ve],Me=y.get("text-font").evaluate(Te,{},f).join(","),Ue=Y.evaluate(Te,{},f),Je=w.layoutTextSize.evaluate(Te,{},f),xt=w.layoutIconSize.evaluate(Te,{},f),ut={horizontal:{},vertical:void 0},St=Te.text,lt=[0,0];if(St){var Qt=St.toString(),Mt=24*y.get("text-letter-spacing").evaluate(Te,{},f),vt=function(sr){for(var Mr=0,Ir=sr;Mr<Ir.length;Mr+=1)if(yr=Ir[Mr].charCodeAt(0),He.Arabic(yr)||He["Arabic Supplement"](yr)||He["Arabic Extended-A"](yr)||He["Arabic Presentation Forms-A"](yr)||He["Arabic Presentation Forms-B"](yr))return!1;var yr;return!0}(Qt)?Mt:0,ir=y.get("text-anchor").evaluate(Te,{},f),Gt=y.get("text-variable-anchor");if(!Gt){var fr=y.get("text-radial-offset").evaluate(Te,{},f);lt=fr?ap(ir,[24*fr,ac]):y.get("text-offset").evaluate(Te,{},f).map(function(sr){return 24*sr})}var Tt=X?"center":y.get("text-justify").evaluate(Te,{},f),_r=y.get("symbol-placement"),Xr=_r==="point"?24*y.get("text-max-width").evaluate(Te,{},f):0,an=function(){e.allowVerticalPlacement&&Pu(Qt)&&(ut.vertical=xl(St,t,r,u,Me,Xr,Z,ir,"left",vt,lt,mo.vertical,!0,_r,Je,Ue))};if(!X&&Gt){for(var $r=Tt==="auto"?Gt.map(function(sr){return sc(sr)}):[Tt],Wr=!1,sn=0;sn<$r.length;sn++){var Bn=$r[sn];if(!ut.horizontal[Bn])if(Wr)ut.horizontal[Bn]=ut.horizontal[0];else{var Fn=xl(St,t,r,u,Me,Xr,Z,"center",Bn,vt,lt,mo.horizontal,!1,_r,Je,Ue);Fn&&(ut.horizontal[Bn]=Fn,Wr=Fn.positionedLines.length===1)}}an()}else{Tt==="auto"&&(Tt=sc(ir));var yi=xl(St,t,r,u,Me,Xr,Z,ir,Tt,vt,lt,mo.horizontal,!1,_r,Je,Ue);yi&&(ut.horizontal[Tt]=yi),an(),Pu(Qt)&&X&&re&&(ut.vertical=xl(St,t,r,u,Me,Xr,Z,ir,Tt,vt,lt,mo.vertical,!1,_r,Je,Ue))}}var Kn=void 0,gi=!1;if(Te.icon&&Te.icon.name){var fn=a[Te.icon.name];fn&&(Kn=function(sr,Mr,Ir){var yr=ic(Ir),Mi=Mr[0]-sr.displaySize[0]*yr.horizontalAlign,oi=Mr[1]-sr.displaySize[1]*yr.verticalAlign;return{image:sr,top:oi,bottom:oi+sr.displaySize[1],left:Mi,right:Mi+sr.displaySize[0]}}(u[Te.icon.name],y.get("icon-offset").evaluate(Te,{},f),y.get("icon-anchor").evaluate(Te,{},f)),gi=fn.sdf,e.sdfIcons===void 0?e.sdfIcons=fn.sdf:e.sdfIcons!==fn.sdf&&Sr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(fn.pixelRatio!==e.pixelRatio||y.get("icon-rotate").constantOr(1)!==0)&&(e.iconsNeedLinear=!0))}var Xn=up(ut.horizontal)||ut.vertical;e.iconsInText=!!Xn&&Xn.iconsInText,(Xn||Kn)&&function(sr,Mr,Ir,yr,Mi,oi,qr,xn,ai,xr,xa){var yo=oi.textMaxSize.evaluate(Mr,{});yo===void 0&&(yo=qr);var ba,dn=sr.layers[0].layout,wa=dn.get("icon-offset").evaluate(Mr,{},xa),Ho=up(Ir.horizontal),mu=qr/24,Ls=sr.tilePixelRatio*mu,yu=sr.tilePixelRatio*yo/24,qa=sr.tilePixelRatio*xn,gu=sr.tilePixelRatio*dn.get("symbol-spacing"),kl=dn.get("text-padding")*sr.tilePixelRatio,vu=dn.get("icon-padding")*sr.tilePixelRatio,Ju=dn.get("text-max-angle")/180*Math.PI,Ml=dn.get("text-rotation-alignment")==="map"&&dn.get("symbol-placement")!=="point",zl=dn.get("icon-rotation-alignment")==="map"&&dn.get("symbol-placement")!=="point",Za=dn.get("symbol-placement"),Yu=gu/2,_u=dn.get("icon-text-fit");yr&&_u!=="none"&&(sr.allowVerticalPlacement&&Ir.vertical&&(ba=Jc(yr,Ir.vertical,_u,dn.get("icon-text-fit-padding"),wa,mu)),Ho&&(yr=Jc(yr,Ho,_u,dn.get("icon-text-fit-padding"),wa,mu)));var cs=function(_f,ol){ol.x<0||ol.x>=8192||ol.y<0||ol.y>=8192||function(mn,ia,xf,ps,yc,Tp,Fl,Ea,Nl,al,Ul,Vl,gc,Ip,sl,Cp,Ap,Pp,kp,Mp,go,jl,zp,Sa,bf){var Dp,Rs,Su,Tu,Iu,Cu=mn.addToLineVertexArray(ia,xf),Lp=0,Op=0,Rp=0,Bp=0,vc=-1,_c=-1,Ga={},Fp=q(""),xc=0,bc=0;if(Ea._unevaluatedLayout.getValue("text-radial-offset")===void 0?(xc=(Dp=Ea.layout.get("text-offset").evaluate(go,{},Sa).map(function(ll){return 24*ll}))[0],bc=Dp[1]):(xc=24*Ea.layout.get("text-radial-offset").evaluate(go,{},Sa),bc=ac),mn.allowVerticalPlacement&&ps.vertical){var Np=Ea.layout.get("text-rotate").evaluate(go,{},Sa)+90;Tu=new Tl(Nl,ia,al,Ul,Vl,ps.vertical,gc,Ip,sl,Np),Fl&&(Iu=new Tl(Nl,ia,al,Ul,Vl,Fl,Ap,Pp,sl,Np))}if(yc){var wc=Ea.layout.get("icon-rotate").evaluate(go,{}),Up=Ea.layout.get("icon-text-fit")!=="none",Vp=ip(yc,wc,zp,Up),Ec=Fl?ip(Fl,wc,zp,Up):void 0;Su=new Tl(Nl,ia,al,Ul,Vl,yc,Ap,Pp,!1,wc),Lp=4*Vp.length;var jp=mn.iconSizeData,ul=null;jp.kind==="source"?(ul=[128*Ea.layout.get("icon-size").evaluate(go,{})])[0]>32640&&Sr(mn.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):jp.kind==="composite"&&((ul=[128*jl.compositeIconSizes[0].evaluate(go,{},Sa),128*jl.compositeIconSizes[1].evaluate(go,{},Sa)])[0]>32640||ul[1]>32640)&&Sr(mn.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),mn.addSymbols(mn.icon,Vp,ul,Mp,kp,go,!1,ia,Cu.lineStartIndex,Cu.lineLength,-1,Sa),vc=mn.icon.placedSymbolArray.length-1,Ec&&(Op=4*Ec.length,mn.addSymbols(mn.icon,Ec,ul,Mp,kp,go,mo.vertical,ia,Cu.lineStartIndex,Cu.lineLength,-1,Sa),_c=mn.icon.placedSymbolArray.length-1)}for(var qp in ps.horizontal){var ql=ps.horizontal[qp];if(!Rs){Fp=q(ql.text);var wf=Ea.layout.get("text-rotate").evaluate(go,{},Sa);Rs=new Tl(Nl,ia,al,Ul,Vl,ql,gc,Ip,sl,wf)}var Zp=ql.positionedLines.length===1;if(Rp+=sp(mn,ia,ql,Tp,Ea,sl,go,Cp,Cu,ps.vertical?mo.horizontal:mo.horizontalOnly,Zp?Object.keys(ps.horizontal):[qp],Ga,vc,jl,Sa),Zp)break}ps.vertical&&(Bp+=sp(mn,ia,ps.vertical,Tp,Ea,sl,go,Cp,Cu,mo.vertical,["vertical"],Ga,_c,jl,Sa));var Ef=Rs?Rs.boxStartIndex:mn.collisionBoxArray.length,Sf=Rs?Rs.boxEndIndex:mn.collisionBoxArray.length,Tf=Tu?Tu.boxStartIndex:mn.collisionBoxArray.length,If=Tu?Tu.boxEndIndex:mn.collisionBoxArray.length,Cf=Su?Su.boxStartIndex:mn.collisionBoxArray.length,Af=Su?Su.boxEndIndex:mn.collisionBoxArray.length,Pf=Iu?Iu.boxStartIndex:mn.collisionBoxArray.length,kf=Iu?Iu.boxEndIndex:mn.collisionBoxArray.length,Ta=-1,Zl=function(ll,Kp){return ll&&ll.circleDiameter?Math.max(ll.circleDiameter,Kp):Kp};Ta=Zl(Rs,Ta),Ta=Zl(Tu,Ta),Ta=Zl(Su,Ta);var Gp=(Ta=Zl(Iu,Ta))>-1?1:0;Gp&&(Ta*=bf/24),mn.glyphOffsetArray.length>=Pr.MAX_GLYPHS&&Sr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),go.sortKey!==void 0&&mn.addToSortKeyRanges(mn.symbolInstances.length,go.sortKey),mn.symbolInstances.emplaceBack(ia.x,ia.y,Ga.right>=0?Ga.right:-1,Ga.center>=0?Ga.center:-1,Ga.left>=0?Ga.left:-1,Ga.vertical||-1,vc,_c,Fp,Ef,Sf,Tf,If,Cf,Af,Pf,kf,al,Rp,Bp,Lp,Op,Gp,0,gc,xc,bc,Ta)}(sr,ol,_f,Ir,yr,Mi,ba,sr.layers[0],sr.collisionBoxArray,Mr.index,Mr.sourceLayerIndex,sr.index,Ls,kl,Ml,ai,qa,vu,zl,wa,Mr,oi,xr,xa,qr)};if(Za==="line")for(var xu=0,Dl=np(Mr.geometry,0,0,8192,8192);xu<Dl.length;xu+=1)for(var Ll=Dl[xu],$u=0,Qu=tf(Ll,gu,Ju,Ir.vertical||Ho,yr,24,yu,sr.overscaling,8192);$u<Qu.length;$u+=1){var Ol=Qu[$u];Ho&&af(sr,Ho.text,Yu,Ol)||cs(Ll,Ol)}else if(Za==="line-center")for(var el=0,tl=Mr.geometry;el<tl.length;el+=1){var rl=tl[el];if(rl.length>1){var Rl=ef(rl,Ju,Ir.vertical||Ho,yr,24,yu);Rl&&cs(rl,Rl)}}else if(Mr.type==="Polygon")for(var bu=0,Bl=Ql(Mr.geometry,0);bu<Bl.length;bu+=1){var wu=Bl[bu],nl=nf(wu,16);cs(wu[0],new uu(nl.x,nl.y,0))}else if(Mr.type==="LineString")for(var Os=0,il=Mr.geometry;Os<il.length;Os+=1){var Eu=il[Os];cs(Eu,new uu(Eu[0].x,Eu[0].y,0))}else if(Mr.type==="Point")for(var fc=0,Ep=Mr.geometry;fc<Ep.length;fc+=1)for(var dc=0,Sp=Ep[fc];dc<Sp.length;dc+=1){var mc=Sp[dc];cs([mc],new uu(mc.x,mc.y,0))}}(e,Te,ut,Kn,a,w,Je,xt,lt,gi,f)},ve=0,xe=e.features;ve<xe.length;ve+=1)ce();c&&e.generateCollisionDebugBuffers()},l.perspective=function(e,t,r,a,u){var c,f=1/Math.tan(t/2);return e[0]=f/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=f,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,u!=null&&u!==1/0?(e[10]=(u+a)*(c=1/(a-u)),e[14]=2*u*a*c):(e[10]=-1,e[14]=-2*a),e},l.pick=function(e,t){for(var r={},a=0;a<t.length;a++){var u=t[a];u in e&&(r[u]=e[u])}return r},l.plugin=eo,l.polygonIntersectsPolygon=ga,l.postMapLoadEvent=Ri,l.postTurnstileEvent=_o,l.potpack=Kc,l.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],l.register=Qe,l.registerForPluginStateChange=function(e){return e({pluginStatus:Gi,pluginURL:Qo}),Mu.on("pluginStateChange",e),e},l.renderColorRamp=Cc,l.rotate=function(e,t,r){var a=t[0],u=t[1],c=t[2],f=t[3],y=Math.sin(r),x=Math.cos(r);return e[0]=a*x+c*y,e[1]=u*x+f*y,e[2]=a*-y+c*x,e[3]=u*-y+f*x,e},l.rotateX=function(e,t,r){var a=Math.sin(r),u=Math.cos(r),c=t[4],f=t[5],y=t[6],x=t[7],w=t[8],I=t[9],A=t[10],z=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=c*u+w*a,e[5]=f*u+I*a,e[6]=y*u+A*a,e[7]=x*u+z*a,e[8]=w*u-c*a,e[9]=I*u-f*a,e[10]=A*u-y*a,e[11]=z*u-x*a,e},l.rotateZ=function(e,t,r){var a=Math.sin(r),u=Math.cos(r),c=t[0],f=t[1],y=t[2],x=t[3],w=t[4],I=t[5],A=t[6],z=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=c*u+w*a,e[1]=f*u+I*a,e[2]=y*u+A*a,e[3]=x*u+z*a,e[4]=w*u-c*a,e[5]=I*u-f*a,e[6]=A*u-y*a,e[7]=z*u-x*a,e},l.scale=function(e,t,r){var a=r[0],u=r[1],c=r[2];return e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a,e[3]=t[3]*a,e[4]=t[4]*u,e[5]=t[5]*u,e[6]=t[6]*u,e[7]=t[7]*u,e[8]=t[8]*c,e[9]=t[9]*c,e[10]=t[10]*c,e[11]=t[11]*c,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},l.scale$1=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},l.scale$2=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e},l.setCacheLimits=function(e,t){Bi=e,Dn=t},l.setRTLTextPlugin=function(e,t,r){if(r===void 0&&(r=!1),Gi==="deferred"||Gi==="loading"||Gi==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");Qo=wi.resolveURL(e),Gi="deferred",Ws=t,ws(),r||Do()},l.sphericalToCartesian=function(e){var t=e[0],r=e[1],a=e[2];return r+=90,r*=Math.PI/180,a*=Math.PI/180,{x:t*Math.cos(r)*Math.sin(a),y:t*Math.sin(r)*Math.sin(a),z:t*Math.cos(a)}},l.sqrLen=function(e){var t=e[0],r=e[1];return t*t+r*r},l.styleSpec=L,l.sub=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e},l.symbolSize=Qh,l.transformMat3=function(e,t,r){var a=t[0],u=t[1],c=t[2];return e[0]=a*r[0]+u*r[3]+c*r[6],e[1]=a*r[1]+u*r[4]+c*r[7],e[2]=a*r[2]+u*r[5]+c*r[8],e},l.transformMat4=eu,l.translate=function(e,t,r){var a,u,c,f,y,x,w,I,A,z,O,Z,X=r[0],re=r[1],Y=r[2];return t===e?(e[12]=t[0]*X+t[4]*re+t[8]*Y+t[12],e[13]=t[1]*X+t[5]*re+t[9]*Y+t[13],e[14]=t[2]*X+t[6]*re+t[10]*Y+t[14],e[15]=t[3]*X+t[7]*re+t[11]*Y+t[15]):(u=t[1],c=t[2],f=t[3],y=t[4],x=t[5],w=t[6],I=t[7],A=t[8],z=t[9],O=t[10],Z=t[11],e[0]=a=t[0],e[1]=u,e[2]=c,e[3]=f,e[4]=y,e[5]=x,e[6]=w,e[7]=I,e[8]=A,e[9]=z,e[10]=O,e[11]=Z,e[12]=a*X+y*re+A*Y+t[12],e[13]=u*X+x*re+z*Y+t[13],e[14]=c*X+w*re+O*Y+t[14],e[15]=f*X+I*re+Z*Y+t[15]),e},l.triggerPluginCompletionEvent=cl,l.uniqueId=Rr,l.validateCustomStyleLayer=function(e){var t=[],r=e.id;return r===void 0&&t.push({message:"layers."+r+': missing required property "id"'}),e.render===void 0&&t.push({message:"layers."+r+': missing required method "render"'}),e.renderingMode&&e.renderingMode!=="2d"&&e.renderingMode!=="3d"&&t.push({message:"layers."+r+': property "renderingMode" must be either "2d" or "3d"'}),t},l.validateLight=ht,l.validateStyle=$e,l.values=function(e){var t=[];for(var r in e)t.push(e[r]);return t},l.vectorTile=iu,l.version="1.13.3",l.warnOnce=Sr,l.webpSupported=wn,l.window=Xe,l.wrap=or}),Cr(["./shared"],function(l){function ur(C){var M=typeof C;if(M==="number"||M==="boolean"||M==="string"||C==null)return JSON.stringify(C);if(Array.isArray(C)){for(var D="[",U=0,G=C;U<G.length;U+=1)D+=ur(G[U])+",";return D+"]"}for(var ne=Object.keys(C).sort(),$="{",L=0;L<ne.length;L++)$+=JSON.stringify(ne[L])+":"+ur(C[ne[L]])+",";return $+"}"}function Oe(C){for(var M="",D=0,U=l.refProperties;D<U.length;D+=1)M+="/"+ur(C[U[D]]);return M}var Ur=function(C){this.keyCache={},C&&this.replace(C)};Ur.prototype.replace=function(C){this._layerConfigs={},this._layers={},this.update(C,[])},Ur.prototype.update=function(C,M){for(var D=this,U=0,G=C;U<G.length;U+=1){var ne=G[U];this._layerConfigs[ne.id]=ne;var $=this._layers[ne.id]=l.createStyleLayer(ne);$._featureFilter=l.featureFilter($.filter),this.keyCache[ne.id]&&delete this.keyCache[ne.id]}for(var L=0,J=M;L<J.length;L+=1){var se=J[L];delete this.keyCache[se],delete this._layerConfigs[se],delete this._layers[se]}this.familiesBySource={};for(var ze=0,Be=function(je,Ye){for(var Bt={},et=0;et<je.length;et++){var Yt=Ye&&Ye[je[et].id]||Oe(je[et]);Ye&&(Ye[je[et].id]=Yt);var Nt=Bt[Yt];Nt||(Nt=Bt[Yt]=[]),Nt.push(je[et])}var Ut=[];for(var Ht in Bt)Ut.push(Bt[Ht]);return Ut}(l.values(this._layerConfigs),this.keyCache);ze<Be.length;ze+=1){var Ee=Be[ze].map(function(je){return D._layers[je.id]}),ke=Ee[0];if(ke.visibility!=="none"){var ot=ke.source||"",We=this.familiesBySource[ot];We||(We=this.familiesBySource[ot]={});var Se=ke.sourceLayer||"_geojsonTileLayer",it=We[Se];it||(it=We[Se]=[]),it.push(Ee)}}};var Rt=function(C){var M={},D=[];for(var U in C){var G=C[U],ne=M[U]={};for(var $ in G){var L=G[+$];if(L&&L.bitmap.width!==0&&L.bitmap.height!==0){var J={x:0,y:0,w:L.bitmap.width+2,h:L.bitmap.height+2};D.push(J),ne[$]={rect:J,metrics:L.metrics}}}}var se=l.potpack(D),ze=new l.AlphaImage({width:se.w||1,height:se.h||1});for(var Be in C){var Ee=C[Be];for(var ke in Ee){var ot=Ee[+ke];if(ot&&ot.bitmap.width!==0&&ot.bitmap.height!==0){var We=M[Be][ke].rect;l.AlphaImage.copy(ot.bitmap,ze,{x:0,y:0},{x:We.x+1,y:We.y+1},ot.bitmap)}}}this.image=ze,this.positions=M};l.register("GlyphAtlas",Rt);var Gr=function(C){this.tileID=new l.OverscaledTileID(C.tileID.overscaledZ,C.tileID.wrap,C.tileID.canonical.z,C.tileID.canonical.x,C.tileID.canonical.y),this.uid=C.uid,this.zoom=C.zoom,this.pixelRatio=C.pixelRatio,this.tileSize=C.tileSize,this.source=C.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=C.showCollisionBoxes,this.collectResourceTiming=!!C.collectResourceTiming,this.returnDependencies=!!C.returnDependencies,this.promoteId=C.promoteId};function Xe(C,M,D){for(var U=new l.EvaluationParameters(M),G=0,ne=C;G<ne.length;G+=1)ne[G].recalculate(U,D)}function Nn(C,M){var D=l.getArrayBuffer(C.request,function(U,G,ne,$){U?M(U):G&&M(null,{vectorTile:new l.vectorTile.VectorTile(new l.pbf(G)),rawData:G,cacheControl:ne,expires:$})});return function(){D.cancel(),M()}}Gr.prototype.parse=function(C,M,D,U,G){var ne=this;this.status="parsing",this.data=C,this.collisionBoxArray=new l.CollisionBoxArray;var $=new l.DictionaryCoder(Object.keys(C.layers).sort()),L=new l.FeatureIndex(this.tileID,this.promoteId);L.bucketLayerIDs=[];var J,se,ze,Be,Ee={},ke={featureIndex:L,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:D},ot=M.familiesBySource[this.source];for(var We in ot){var Se=C.layers[We];if(Se){Se.version===1&&l.warnOnce('Vector tile source "'+this.source+'" layer "'+We+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var it=$.encode(We),je=[],Ye=0;Ye<Se.length;Ye++){var Bt=Se.feature(Ye),et=L.getId(Bt,We);je.push({feature:Bt,id:et,index:Ye,sourceLayerIndex:it})}for(var Yt=0,Nt=ot[We];Yt<Nt.length;Yt+=1){var Ut=Nt[Yt],Ht=Ut[0];Ht.minzoom&&this.zoom<Math.floor(Ht.minzoom)||Ht.maxzoom&&this.zoom>=Ht.maxzoom||Ht.visibility!=="none"&&(Xe(Ut,this.zoom,D),(Ee[Ht.id]=Ht.createBucket({index:L.bucketLayerIDs.length,layers:Ut,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:it,sourceID:this.source})).populate(je,ke,this.tileID.canonical),L.bucketLayerIDs.push(Ut.map(function(vr){return vr.id})))}}}var rr=l.mapObject(ke.glyphDependencies,function(vr){return Object.keys(vr).map(Number)});Object.keys(rr).length?U.send("getGlyphs",{uid:this.uid,stacks:rr},function(vr,Zt){J||(J=vr,se=Zt,zr.call(ne))}):se={};var Hr=Object.keys(ke.iconDependencies);Hr.length?U.send("getImages",{icons:Hr,source:this.source,tileID:this.tileID,type:"icons"},function(vr,Zt){J||(J=vr,ze=Zt,zr.call(ne))}):ze={};var cr=Object.keys(ke.patternDependencies);function zr(){if(J)return G(J);if(se&&ze&&Be){var vr=new Rt(se),Zt=new l.ImageAtlas(ze,Be);for(var pr in Ee){var Jr=Ee[pr];Jr instanceof l.SymbolBucket?(Xe(Jr.layers,this.zoom,D),l.performSymbolLayout(Jr,se,vr.positions,ze,Zt.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):Jr.hasPattern&&(Jr instanceof l.LineBucket||Jr instanceof l.FillBucket||Jr instanceof l.FillExtrusionBucket)&&(Xe(Jr.layers,this.zoom,D),Jr.addFeatures(ke,this.tileID.canonical,Zt.patternPositions))}this.status="done",G(null,{buckets:l.values(Ee).filter(function(v){return!v.isEmpty()}),featureIndex:L,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:vr.image,imageAtlas:Zt,glyphMap:this.returnDependencies?se:null,iconMap:this.returnDependencies?ze:null,glyphPositions:this.returnDependencies?vr.positions:null})}}cr.length?U.send("getImages",{icons:cr,source:this.source,tileID:this.tileID,type:"patterns"},function(vr,Zt){J||(J=vr,Be=Zt,zr.call(ne))}):Be={},zr.call(this)};var nr=function(C,M,D,U){this.actor=C,this.layerIndex=M,this.availableImages=D,this.loadVectorData=U||Nn,this.loading={},this.loaded={}};nr.prototype.loadTile=function(C,M){var D=this,U=C.uid;this.loading||(this.loading={});var G=!!(C&&C.request&&C.request.collectResourceTiming)&&new l.RequestPerformance(C.request),ne=this.loading[U]=new Gr(C);ne.abort=this.loadVectorData(C,function($,L){if(delete D.loading[U],$||!L)return ne.status="done",D.loaded[U]=ne,M($);var J=L.rawData,se={};L.expires&&(se.expires=L.expires),L.cacheControl&&(se.cacheControl=L.cacheControl);var ze={};if(G){var Be=G.finish();Be&&(ze.resourceTiming=JSON.parse(JSON.stringify(Be)))}ne.vectorTile=L.vectorTile,ne.parse(L.vectorTile,D.layerIndex,D.availableImages,D.actor,function(Ee,ke){if(Ee||!ke)return M(Ee);M(null,l.extend({rawTileData:J.slice(0)},ke,se,ze))}),D.loaded=D.loaded||{},D.loaded[U]=ne})},nr.prototype.reloadTile=function(C,M){var D=this,U=this.loaded,G=C.uid,ne=this;if(U&&U[G]){var $=U[G];$.showCollisionBoxes=C.showCollisionBoxes;var L=function(J,se){var ze=$.reloadCallback;ze&&(delete $.reloadCallback,$.parse($.vectorTile,ne.layerIndex,D.availableImages,ne.actor,ze)),M(J,se)};$.status==="parsing"?$.reloadCallback=L:$.status==="done"&&($.vectorTile?$.parse($.vectorTile,this.layerIndex,this.availableImages,this.actor,L):L())}},nr.prototype.abortTile=function(C,M){var D=this.loading,U=C.uid;D&&D[U]&&D[U].abort&&(D[U].abort(),delete D[U]),M()},nr.prototype.removeTile=function(C,M){var D=this.loaded,U=C.uid;D&&D[U]&&delete D[U],M()};var Or=l.window.ImageBitmap,_t=function(){this.loaded={}};function or(C,M){if(C.length!==0){dr(C[0],M);for(var D=1;D<C.length;D++)dr(C[D],!1)}}function dr(C,M){for(var D=0,U=0,G=0,ne=C.length,$=ne-1;G<ne;$=G++){var L=(C[G][0]-C[$][0])*(C[$][1]+C[G][1]),J=D+L;U+=Math.abs(D)>=Math.abs(L)?D-J+L:L-J+D,D=J}D+U>=0!=!!M&&C.reverse()}_t.prototype.loadTile=function(C,M){var D=C.uid,U=C.encoding,G=C.rawImageData,ne=Or&&G instanceof Or?this.getImageData(G):G,$=new l.DEMData(D,ne,U);this.loaded=this.loaded||{},this.loaded[D]=$,M(null,$)},_t.prototype.getImageData=function(C){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(C.width,C.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=C.width,this.offscreenCanvas.height=C.height,this.offscreenCanvasContext.drawImage(C,0,0,C.width,C.height);var M=this.offscreenCanvasContext.getImageData(-1,-1,C.width+2,C.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new l.RGBAImage({width:M.width,height:M.height},M.data)},_t.prototype.removeTile=function(C){var M=this.loaded,D=C.uid;M&&M[D]&&delete M[D]};var Ji=l.vectorTile.VectorTileFeature.prototype.toGeoJSON,Rr=function(C){this._feature=C,this.extent=l.EXTENT,this.type=C.type,this.properties=C.tags,"id"in C&&!isNaN(C.id)&&(this.id=parseInt(C.id,10))};Rr.prototype.loadGeometry=function(){if(this._feature.type===1){for(var C=[],M=0,D=this._feature.geometry;M<D.length;M+=1){var U=D[M];C.push([new l.Point$1(U[0],U[1])])}return C}for(var G=[],ne=0,$=this._feature.geometry;ne<$.length;ne+=1){for(var L=[],J=0,se=$[ne];J<se.length;J+=1){var ze=se[J];L.push(new l.Point$1(ze[0],ze[1]))}G.push(L)}return G},Rr.prototype.toGeoJSON=function(C,M,D){return Ji.call(this,C,M,D)};var Vr=function(C){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=l.EXTENT,this.length=C.length,this._features=C};Vr.prototype.feature=function(C){return new Rr(this._features[C])};var Un=l.vectorTile.VectorTileFeature,Qr=zi;function zi(C,M){this.options=M||{},this.features=C,this.length=C.length}function bn(C,M){this.id=typeof C.id=="number"?C.id:void 0,this.type=C.type,this.rawGeometry=C.type===1?[C.geometry]:C.geometry,this.properties=C.tags,this.extent=M||4096}zi.prototype.feature=function(C){return new bn(this.features[C],this.options.extent)},bn.prototype.loadGeometry=function(){var C=this.rawGeometry;this.geometry=[];for(var M=0;M<C.length;M++){for(var D=C[M],U=[],G=0;G<D.length;G++)U.push(new l.Point$1(D[G][0],D[G][1]));this.geometry.push(U)}return this.geometry},bn.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var C=this.geometry,M=1/0,D=-1/0,U=1/0,G=-1/0,ne=0;ne<C.length;ne++)for(var $=C[ne],L=0;L<$.length;L++){var J=$[L];M=Math.min(M,J.x),D=Math.max(D,J.x),U=Math.min(U,J.y),G=Math.max(G,J.y)}return[M,U,D,G]},bn.prototype.toGeoJSON=Un.prototype.toGeoJSON;var vi=_i,si=Qr;function _i(C){var M=new l.pbf;return function(D,U){for(var G in D.layers)U.writeMessage(3,Sr,D.layers[G])}(C,M),M.finish()}function Sr(C,M){var D;M.writeVarintField(15,C.version||1),M.writeStringField(1,C.name||""),M.writeVarintField(5,C.extent||4096);var U={keys:[],values:[],keycache:{},valuecache:{}};for(D=0;D<C.length;D++)U.feature=C.feature(D),M.writeMessage(2,Br,U);var G=U.keys;for(D=0;D<G.length;D++)M.writeStringField(3,G[D]);var ne=U.values;for(D=0;D<ne.length;D++)M.writeMessage(4,xi,ne[D])}function Br(C,M){var D=C.feature;D.id!==void 0&&M.writeVarintField(1,D.id),M.writeMessage(2,Bo,C),M.writeVarintField(3,D.type),M.writeMessage(4,Vn,D)}function Bo(C,M){var D=C.feature,U=C.keys,G=C.values,ne=C.keycache,$=C.valuecache;for(var L in D.properties){var J=ne[L];J===void 0&&(U.push(L),ne[L]=J=U.length-1),M.writeVarint(J);var se=D.properties[L],ze=typeof se;ze!=="string"&&ze!=="boolean"&&ze!=="number"&&(se=JSON.stringify(se));var Be=ze+":"+se,Ee=$[Be];Ee===void 0&&(G.push(se),$[Be]=Ee=G.length-1),M.writeVarint(Ee)}}function yn(C,M){return(M<<3)+(7&C)}function vo(C){return C<<1^C>>31}function Vn(C,M){for(var D=C.loadGeometry(),U=C.type,G=0,ne=0,$=D.length,L=0;L<$;L++){var J=D[L],se=1;U===1&&(se=J.length),M.writeVarint(yn(1,se));for(var ze=U===3?J.length-1:J.length,Be=0;Be<ze;Be++){Be===1&&U!==1&&M.writeVarint(yn(2,ze-1));var Ee=J[Be].x-G,ke=J[Be].y-ne;M.writeVarint(vo(Ee)),M.writeVarint(vo(ke)),G+=Ee,ne+=ke}U===3&&M.writeVarint(yn(7,1))}}function xi(C,M){var D=typeof C;D==="string"?M.writeStringField(1,C):D==="boolean"?M.writeBooleanField(7,C):D==="number"&&(C%1!=0?M.writeDoubleField(3,C):C<0?M.writeSVarintField(6,C):M.writeVarintField(5,C))}function Mn(C,M,D,U){$n(C,D,U),$n(M,2*D,2*U),$n(M,2*D+1,2*U+1)}function $n(C,M,D){var U=C[M];C[M]=C[D],C[D]=U}function Di(C,M,D,U){var G=C-D,ne=M-U;return G*G+ne*ne}vi.fromVectorTileJs=_i,vi.fromGeojsonVt=function(C,M){M=M||{};var D={};for(var U in C)D[U]=new Qr(C[U].features,M),D[U].name=U,D[U].version=M.version,D[U].extent=M.extent;return _i({layers:D})},vi.GeoJSONWrapper=si;var Wn=function(C){return C[0]},no=function(C){return C[1]},bi=function(C,M,D,U,G){M===void 0&&(M=Wn),D===void 0&&(D=no),U===void 0&&(U=64),G===void 0&&(G=Float64Array),this.nodeSize=U,this.points=C;for(var ne=C.length<65536?Uint16Array:Uint32Array,$=this.ids=new ne(C.length),L=this.coords=new G(2*C.length),J=0;J<C.length;J++)$[J]=J,L[2*J]=M(C[J]),L[2*J+1]=D(C[J]);(function se(ze,Be,Ee,ke,ot,We){if(!(ot-ke<=Ee)){var Se=ke+ot>>1;(function it(je,Ye,Bt,et,Yt,Nt){for(;Yt>et;){if(Yt-et>600){var Ut=Yt-et+1,Ht=Bt-et+1,rr=Math.log(Ut),Hr=.5*Math.exp(2*rr/3),cr=.5*Math.sqrt(rr*Hr*(Ut-Hr)/Ut)*(Ht-Ut/2<0?-1:1);it(je,Ye,Bt,Math.max(et,Math.floor(Bt-Ht*Hr/Ut+cr)),Math.min(Yt,Math.floor(Bt+(Ut-Ht)*Hr/Ut+cr)),Nt)}var zr=Ye[2*Bt+Nt],vr=et,Zt=Yt;for(Mn(je,Ye,et,Bt),Ye[2*Yt+Nt]>zr&&Mn(je,Ye,et,Yt);vr<Zt;){for(Mn(je,Ye,vr,Zt),vr++,Zt--;Ye[2*vr+Nt]<zr;)vr++;for(;Ye[2*Zt+Nt]>zr;)Zt--}Ye[2*et+Nt]===zr?Mn(je,Ye,et,Zt):Mn(je,Ye,++Zt,Yt),Zt<=Bt&&(et=Zt+1),Bt<=Zt&&(Yt=Zt-1)}})(ze,Be,Se,ke,ot,We%2),se(ze,Be,Ee,ke,Se-1,We+1),se(ze,Be,Ee,Se+1,ot,We+1)}})($,L,U,0,$.length-1,0)};bi.prototype.range=function(C,M,D,U){return function(G,ne,$,L,J,se,ze){for(var Be,Ee,ke=[0,G.length-1,0],ot=[];ke.length;){var We=ke.pop(),Se=ke.pop(),it=ke.pop();if(Se-it<=ze)for(var je=it;je<=Se;je++)Ee=ne[2*je+1],(Be=ne[2*je])>=$&&Be<=J&&Ee>=L&&Ee<=se&&ot.push(G[je]);else{var Ye=Math.floor((it+Se)/2);Ee=ne[2*Ye+1],(Be=ne[2*Ye])>=$&&Be<=J&&Ee>=L&&Ee<=se&&ot.push(G[Ye]);var Bt=(We+1)%2;(We===0?$<=Be:L<=Ee)&&(ke.push(it),ke.push(Ye-1),ke.push(Bt)),(We===0?J>=Be:se>=Ee)&&(ke.push(Ye+1),ke.push(Se),ke.push(Bt))}}return ot}(this.ids,this.coords,C,M,D,U,this.nodeSize)},bi.prototype.within=function(C,M,D){return function(U,G,ne,$,L,J){for(var se=[0,U.length-1,0],ze=[],Be=L*L;se.length;){var Ee=se.pop(),ke=se.pop(),ot=se.pop();if(ke-ot<=J)for(var We=ot;We<=ke;We++)Di(G[2*We],G[2*We+1],ne,$)<=Be&&ze.push(U[We]);else{var Se=Math.floor((ot+ke)/2),it=G[2*Se],je=G[2*Se+1];Di(it,je,ne,$)<=Be&&ze.push(U[Se]);var Ye=(Ee+1)%2;(Ee===0?ne-L<=it:$-L<=je)&&(se.push(ot),se.push(Se-1),se.push(Ye)),(Ee===0?ne+L>=it:$+L>=je)&&(se.push(Se+1),se.push(ke),se.push(Ye))}}return ze}(this.ids,this.coords,C,M,D,this.nodeSize)};var Li={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(C){return C}},gn=function(C){this.options=Ei(Object.create(Li),C),this.trees=new Array(this.options.maxZoom+1)};function wi(C,M,D,U,G){return{x:C,y:M,zoom:1/0,id:D,parentId:-1,numPoints:U,properties:G}}function Ke(C,M){var D=C.geometry.coordinates,U=D[1];return{x:qt(D[0]),y:Wt(U),zoom:1/0,index:M,parentId:-1}}function wn(C){return{type:"Feature",id:C.id,properties:En(C),geometry:{type:"Point",coordinates:[(U=C.x,360*(U-.5)),(M=C.y,D=(180-360*M)*Math.PI/180,360*Math.atan(Math.exp(D))/Math.PI-90)]}};var M,D,U}function En(C){var M=C.numPoints,D=M>=1e4?Math.round(M/1e3)+"k":M>=1e3?Math.round(M/100)/10+"k":M;return Ei(Ei({},C.properties),{cluster:!0,cluster_id:C.id,point_count:M,point_count_abbreviated:D})}function qt(C){return C/360+.5}function Wt(C){var M=Math.sin(C*Math.PI/180),D=.5-.25*Math.log((1+M)/(1-M))/Math.PI;return D<0?0:D>1?1:D}function Ei(C,M){for(var D in M)C[D]=M[D];return C}function gr(C){return C.x}function jt(C){return C.y}function oa(C,M,D,U,G,ne){var $=G-D,L=ne-U;if($!==0||L!==0){var J=((C-D)*$+(M-U)*L)/($*$+L*L);J>1?(D=G,U=ne):J>0&&(D+=$*J,U+=L*J)}return($=C-D)*$+(L=M-U)*L}function Si(C,M,D,U){var G={id:C===void 0?null:C,type:M,geometry:D,tags:U,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ne){var $=ne.geometry,L=ne.type;if(L==="Point"||L==="MultiPoint"||L==="LineString")Jo(ne,$);else if(L==="Polygon"||L==="MultiLineString")for(var J=0;J<$.length;J++)Jo(ne,$[J]);else if(L==="MultiPolygon")for(J=0;J<$.length;J++)for(var se=0;se<$[J].length;se++)Jo(ne,$[J][se])}(G),G}function Jo(C,M){for(var D=0;D<M.length;D+=3)C.minX=Math.min(C.minX,M[D]),C.minY=Math.min(C.minY,M[D+1]),C.maxX=Math.max(C.maxX,M[D]),C.maxY=Math.max(C.maxY,M[D+1])}function vn(C,M,D,U){if(M.geometry){var G=M.geometry.coordinates,ne=M.geometry.type,$=Math.pow(D.tolerance/((1<<D.maxZoom)*D.extent),2),L=[],J=M.id;if(D.promoteId?J=M.properties[D.promoteId]:D.generateId&&(J=U||0),ne==="Point")zn(G,L);else if(ne==="MultiPoint")for(var se=0;se<G.length;se++)zn(G[se],L);else if(ne==="LineString")br(G,L,$,!1);else if(ne==="MultiLineString"){if(D.lineMetrics){for(se=0;se<G.length;se++)br(G[se],L=[],$,!1),C.push(Si(J,"LineString",L,M.properties));return}Sn(G,L,$,!1)}else if(ne==="Polygon")Sn(G,L,$,!0);else{if(ne!=="MultiPolygon"){if(ne==="GeometryCollection"){for(se=0;se<M.geometry.geometries.length;se++)vn(C,{id:J,geometry:M.geometry.geometries[se],properties:M.properties},D,U);return}throw new Error("Input data is not a valid GeoJSON object.")}for(se=0;se<G.length;se++){var ze=[];Sn(G[se],ze,$,!0),L.push(ze)}}C.push(Si(J,ne,L,M.properties))}}function zn(C,M){M.push(Qn(C[0])),M.push(Ti(C[1])),M.push(0)}function br(C,M,D,U){for(var G,ne,$=0,L=0;L<C.length;L++){var J=Qn(C[L][0]),se=Ti(C[L][1]);M.push(J),M.push(se),M.push(0),L>0&&($+=U?(G*se-J*ne)/2:Math.sqrt(Math.pow(J-G,2)+Math.pow(se-ne,2))),G=J,ne=se}var ze=M.length-3;M[2]=1,function Be(Ee,ke,ot,We){for(var Se,it=We,je=ot-ke>>1,Ye=ot-ke,Bt=Ee[ke],et=Ee[ke+1],Yt=Ee[ot],Nt=Ee[ot+1],Ut=ke+3;Ut<ot;Ut+=3){var Ht=oa(Ee[Ut],Ee[Ut+1],Bt,et,Yt,Nt);if(Ht>it)Se=Ut,it=Ht;else if(Ht===it){var rr=Math.abs(Ut-je);rr<Ye&&(Se=Ut,Ye=rr)}}it>We&&(Se-ke>3&&Be(Ee,ke,Se,We),Ee[Se+2]=it,ot-Se>3&&Be(Ee,Se,ot,We))}(M,0,ze,D),M[ze+2]=1,M.size=Math.abs($),M.start=0,M.end=M.size}function Sn(C,M,D,U){for(var G=0;G<C.length;G++){var ne=[];br(C[G],ne,D,U),M.push(ne)}}function Qn(C){return C/360+.5}function Ti(C){var M=Math.sin(C*Math.PI/180),D=.5-.25*Math.log((1+M)/(1-M))/Math.PI;return D<0?0:D>1?1:D}function un(C,M,D,U,G,ne,$,L){if(U/=M,ne>=(D/=M)&&$<U)return C;if($<D||ne>=U)return null;for(var J=[],se=0;se<C.length;se++){var ze=C[se],Be=ze.geometry,Ee=ze.type,ke=G===0?ze.minX:ze.minY,ot=G===0?ze.maxX:ze.maxY;if(ke>=D&&ot<U)J.push(ze);else if(!(ot<D||ke>=U)){var We=[];if(Ee==="Point"||Ee==="MultiPoint")Hn(Be,We,D,U,G);else if(Ee==="LineString")_o(Be,We,D,U,G,!1,L.lineMetrics);else if(Ee==="MultiLineString")Ri(Be,We,D,U,G,!1);else if(Ee==="Polygon")Ri(Be,We,D,U,G,!0);else if(Ee==="MultiPolygon")for(var Se=0;Se<Be.length;Se++){var it=[];Ri(Be[Se],it,D,U,G,!0),it.length&&We.push(it)}if(We.length){if(L.lineMetrics&&Ee==="LineString"){for(Se=0;Se<We.length;Se++)J.push(Si(ze.id,Ee,We[Se],ze.tags));continue}Ee!=="LineString"&&Ee!=="MultiLineString"||(We.length===1?(Ee="LineString",We=We[0]):Ee="MultiLineString"),Ee!=="Point"&&Ee!=="MultiPoint"||(Ee=We.length===3?"Point":"MultiPoint"),J.push(Si(ze.id,Ee,We,ze.tags))}}}return J.length?J:null}function Hn(C,M,D,U,G){for(var ne=0;ne<C.length;ne+=3){var $=C[ne+G];$>=D&&$<=U&&(M.push(C[ne]),M.push(C[ne+1]),M.push(C[ne+2]))}}function _o(C,M,D,U,G,ne,$){for(var L,J,se=Oi(C),ze=G===0?Dn:Ii,Be=C.start,Ee=0;Ee<C.length-3;Ee+=3){var ke=C[Ee],ot=C[Ee+1],We=C[Ee+2],Se=C[Ee+3],it=C[Ee+4],je=G===0?ke:ot,Ye=G===0?Se:it,Bt=!1;$&&(L=Math.sqrt(Math.pow(ke-Se,2)+Math.pow(ot-it,2))),je<D?Ye>D&&(J=ze(se,ke,ot,Se,it,D),$&&(se.start=Be+L*J)):je>U?Ye<U&&(J=ze(se,ke,ot,Se,it,U),$&&(se.start=Be+L*J)):Bi(se,ke,ot,We),Ye<D&&je>=D&&(J=ze(se,ke,ot,Se,it,D),Bt=!0),Ye>U&&je<=U&&(J=ze(se,ke,ot,Se,it,U),Bt=!0),!ne&&Bt&&($&&(se.end=Be+L*J),M.push(se),se=Oi(C)),$&&(Be+=L)}var et=C.length-3;ke=C[et],ot=C[et+1],We=C[et+2],(je=G===0?ke:ot)>=D&&je<=U&&Bi(se,ke,ot,We),et=se.length-3,ne&&et>=3&&(se[et]!==se[0]||se[et+1]!==se[1])&&Bi(se,se[0],se[1],se[2]),se.length&&M.push(se)}function Oi(C){var M=[];return M.size=C.size,M.start=C.start,M.end=C.end,M}function Ri(C,M,D,U,G,ne){for(var $=0;$<C.length;$++)_o(C[$],M,D,U,G,ne,!1)}function Bi(C,M,D,U){C.push(M),C.push(D),C.push(U)}function Dn(C,M,D,U,G,ne){var $=(ne-M)/(U-M);return C.push(ne),C.push(D+(G-D)*$),C.push(1),$}function Ii(C,M,D,U,G,ne){var $=(ne-D)/(G-D);return C.push(M+(U-M)*$),C.push(ne),C.push(1),$}function Fi(C,M){for(var D=[],U=0;U<C.length;U++){var G,ne=C[U],$=ne.type;if($==="Point"||$==="MultiPoint"||$==="LineString")G=Ln(ne.geometry,M);else if($==="MultiLineString"||$==="Polygon"){G=[];for(var L=0;L<ne.geometry.length;L++)G.push(Ln(ne.geometry[L],M))}else if($==="MultiPolygon")for(G=[],L=0;L<ne.geometry.length;L++){for(var J=[],se=0;se<ne.geometry[L].length;se++)J.push(Ln(ne.geometry[L][se],M));G.push(J)}D.push(Si(ne.id,$,G,ne.tags))}return D}function Ln(C,M){var D=[];D.size=C.size,C.start!==void 0&&(D.start=C.start,D.end=C.end);for(var U=0;U<C.length;U+=3)D.push(C[U]+M,C[U+1],C[U+2]);return D}function bt(C,M){if(C.transformed)return C;var D,U,G,ne=1<<C.z,$=C.x,L=C.y;for(D=0;D<C.features.length;D++){var J=C.features[D],se=J.geometry,ze=J.type;if(J.geometry=[],ze===1)for(U=0;U<se.length;U+=2)J.geometry.push(ui(se[U],se[U+1],M,ne,$,L));else for(U=0;U<se.length;U++){var Be=[];for(G=0;G<se[U].length;G+=2)Be.push(ui(se[U][G],se[U][G+1],M,ne,$,L));J.geometry.push(Be)}}return C.transformed=!0,C}function ui(C,M,D,U,G,ne){return[Math.round(D*(C*U-G)),Math.round(D*(M*U-ne))]}function ei(C,M,D,U,G){for(var ne=M===G.maxZoom?0:G.tolerance/((1<<M)*G.extent),$={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:D,y:U,z:M,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},L=0;L<C.length;L++){$.numFeatures++,Ni($,C[L],ne,G);var J=C[L].minX,se=C[L].minY,ze=C[L].maxX,Be=C[L].maxY;J<$.minX&&($.minX=J),se<$.minY&&($.minY=se),ze>$.maxX&&($.maxX=ze),Be>$.maxY&&($.maxY=Be)}return $}function Ni(C,M,D,U){var G=M.geometry,ne=M.type,$=[];if(ne==="Point"||ne==="MultiPoint")for(var L=0;L<G.length;L+=3)$.push(G[L]),$.push(G[L+1]),C.numPoints++,C.numSimplified++;else if(ne==="LineString")pt($,G,C,D,!1,!1);else if(ne==="MultiLineString"||ne==="Polygon")for(L=0;L<G.length;L++)pt($,G[L],C,D,ne==="Polygon",L===0);else if(ne==="MultiPolygon")for(var J=0;J<G.length;J++){var se=G[J];for(L=0;L<se.length;L++)pt($,se[L],C,D,!0,L===0)}if($.length){var ze=M.tags||null;if(ne==="LineString"&&U.lineMetrics){for(var Be in ze={},M.tags)ze[Be]=M.tags[Be];ze.mapbox_clip_start=G.start/G.size,ze.mapbox_clip_end=G.end/G.size}var Ee={geometry:$,type:ne==="Polygon"||ne==="MultiPolygon"?3:ne==="LineString"||ne==="MultiLineString"?2:1,tags:ze};M.id!==null&&(Ee.id=M.id),C.features.push(Ee)}}function pt(C,M,D,U,G,ne){var $=U*U;if(U>0&&M.size<(G?$:U))D.numPoints+=M.length/3;else{for(var L=[],J=0;J<M.length;J+=3)(U===0||M[J+2]>$)&&(D.numSimplified++,L.push(M[J]),L.push(M[J+1])),D.numPoints++;G&&function(se,ze){for(var Be=0,Ee=0,ke=se.length,ot=ke-2;Ee<ke;ot=Ee,Ee+=2)Be+=(se[Ee]-se[ot])*(se[Ee+1]+se[ot+1]);if(Be>0===ze)for(Ee=0,ke=se.length;Ee<ke/2;Ee+=2){var We=se[Ee],Se=se[Ee+1];se[Ee]=se[ke-2-Ee],se[Ee+1]=se[ke-1-Ee],se[ke-2-Ee]=We,se[ke-1-Ee]=Se}}(L,ne),C.push(L)}}function _n(C,M){var D=(M=this.options=function(G,ne){for(var $ in ne)G[$]=ne[$];return G}(Object.create(this.options),M)).debug;if(D&&console.time("preprocess data"),M.maxZoom<0||M.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(M.promoteId&&M.generateId)throw new Error("promoteId and generateId cannot be used together.");var U=function(G,ne){var $=[];if(G.type==="FeatureCollection")for(var L=0;L<G.features.length;L++)vn($,G.features[L],ne,L);else vn($,G.type==="Feature"?G:{geometry:G},ne);return $}(C,M);this.tiles={},this.tileCoords=[],D&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",M.indexMaxZoom,M.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(U=function(G,ne){var $=ne.buffer/ne.extent,L=G,J=un(G,1,-1-$,$,0,-1,2,ne),se=un(G,1,1-$,2+$,0,-1,2,ne);return(J||se)&&(L=un(G,1,-$,1+$,0,-1,2,ne)||[],J&&(L=Fi(J,1).concat(L)),se&&(L=L.concat(Fi(se,-1)))),L}(U,M)).length&&this.splitTile(U,0,0,0),D&&(U.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function li(C,M,D){return 32*((1<<C)*D+M)+C}function ti(C,M){var D=C.tileID.canonical;if(!this._geoJSONIndex)return M(null,null);var U=this._geoJSONIndex.getTile(D.z,D.x,D.y);if(!U)return M(null,null);var G=new Vr(U.features),ne=vi(G);ne.byteOffset===0&&ne.byteLength===ne.buffer.byteLength||(ne=new Uint8Array(ne)),M(null,{vectorTile:G,rawData:ne.buffer})}gn.prototype.load=function(C){var M=this.options,D=M.log,U=M.minZoom,G=M.maxZoom,ne=M.nodeSize;D&&console.time("total time");var $="prepare "+C.length+" points";D&&console.time($),this.points=C;for(var L=[],J=0;J<C.length;J++)C[J].geometry&&L.push(Ke(C[J],J));this.trees[G+1]=new bi(L,gr,jt,ne,Float32Array),D&&console.timeEnd($);for(var se=G;se>=U;se--){var ze=+Date.now();L=this._cluster(L,se),this.trees[se]=new bi(L,gr,jt,ne,Float32Array),D&&console.log("z%d: %d clusters in %dms",se,L.length,+Date.now()-ze)}return D&&console.timeEnd("total time"),this},gn.prototype.getClusters=function(C,M){var D=((C[0]+180)%360+360)%360-180,U=Math.max(-90,Math.min(90,C[1])),G=C[2]===180?180:((C[2]+180)%360+360)%360-180,ne=Math.max(-90,Math.min(90,C[3]));if(C[2]-C[0]>=360)D=-180,G=180;else if(D>G){var $=this.getClusters([D,U,180,ne],M),L=this.getClusters([-180,U,G,ne],M);return $.concat(L)}for(var J=this.trees[this._limitZoom(M)],se=[],ze=0,Be=J.range(qt(D),Wt(ne),qt(G),Wt(U));ze<Be.length;ze+=1){var Ee=J.points[Be[ze]];se.push(Ee.numPoints?wn(Ee):this.points[Ee.index])}return se},gn.prototype.getChildren=function(C){var M=this._getOriginId(C),D=this._getOriginZoom(C),U="No cluster with the specified id.",G=this.trees[D];if(!G)throw new Error(U);var ne=G.points[M];if(!ne)throw new Error(U);for(var $=this.options.radius/(this.options.extent*Math.pow(2,D-1)),L=[],J=0,se=G.within(ne.x,ne.y,$);J<se.length;J+=1){var ze=G.points[se[J]];ze.parentId===C&&L.push(ze.numPoints?wn(ze):this.points[ze.index])}if(L.length===0)throw new Error(U);return L},gn.prototype.getLeaves=function(C,M,D){var U=[];return this._appendLeaves(U,C,M=M||10,D=D||0,0),U},gn.prototype.getTile=function(C,M,D){var U=this.trees[this._limitZoom(C)],G=Math.pow(2,C),ne=this.options,$=ne.radius/ne.extent,L=(D-$)/G,J=(D+1+$)/G,se={features:[]};return this._addTileFeatures(U.range((M-$)/G,L,(M+1+$)/G,J),U.points,M,D,G,se),M===0&&this._addTileFeatures(U.range(1-$/G,L,1,J),U.points,G,D,G,se),M===G-1&&this._addTileFeatures(U.range(0,L,$/G,J),U.points,-1,D,G,se),se.features.length?se:null},gn.prototype.getClusterExpansionZoom=function(C){for(var M=this._getOriginZoom(C)-1;M<=this.options.maxZoom;){var D=this.getChildren(C);if(M++,D.length!==1)break;C=D[0].properties.cluster_id}return M},gn.prototype._appendLeaves=function(C,M,D,U,G){for(var ne=0,$=this.getChildren(M);ne<$.length;ne+=1){var L=$[ne],J=L.properties;if(J&&J.cluster?G+J.point_count<=U?G+=J.point_count:G=this._appendLeaves(C,J.cluster_id,D,U,G):G<U?G++:C.push(L),C.length===D)break}return G},gn.prototype._addTileFeatures=function(C,M,D,U,G,ne){for(var $=0,L=C;$<L.length;$+=1){var J=M[L[$]],se=J.numPoints,ze={type:1,geometry:[[Math.round(this.options.extent*(J.x*G-D)),Math.round(this.options.extent*(J.y*G-U))]],tags:se?En(J):this.points[J.index].properties},Be=void 0;se?Be=J.id:this.options.generateId?Be=J.index:this.points[J.index].id&&(Be=this.points[J.index].id),Be!==void 0&&(ze.id=Be),ne.features.push(ze)}},gn.prototype._limitZoom=function(C){return Math.max(this.options.minZoom,Math.min(+C,this.options.maxZoom+1))},gn.prototype._cluster=function(C,M){for(var D=[],U=this.options,G=U.reduce,ne=U.minPoints,$=U.radius/(U.extent*Math.pow(2,M)),L=0;L<C.length;L++){var J=C[L];if(!(J.zoom<=M)){J.zoom=M;for(var se=this.trees[M+1],ze=se.within(J.x,J.y,$),Be=J.numPoints||1,Ee=Be,ke=0,ot=ze;ke<ot.length;ke+=1){var We=se.points[ot[ke]];We.zoom>M&&(Ee+=We.numPoints||1)}if(Ee>=ne){for(var Se=J.x*Be,it=J.y*Be,je=G&&Be>1?this._map(J,!0):null,Ye=(L<<5)+(M+1)+this.points.length,Bt=0,et=ze;Bt<et.length;Bt+=1){var Yt=se.points[et[Bt]];if(!(Yt.zoom<=M)){Yt.zoom=M;var Nt=Yt.numPoints||1;Se+=Yt.x*Nt,it+=Yt.y*Nt,Yt.parentId=Ye,G&&(je||(je=this._map(J,!0)),G(je,this._map(Yt)))}}J.parentId=Ye,D.push(wi(Se/Ee,it/Ee,Ye,Ee,je))}else if(D.push(J),Ee>1)for(var Ut=0,Ht=ze;Ut<Ht.length;Ut+=1){var rr=se.points[Ht[Ut]];rr.zoom<=M||(rr.zoom=M,D.push(rr))}}}return D},gn.prototype._getOriginId=function(C){return C-this.points.length>>5},gn.prototype._getOriginZoom=function(C){return(C-this.points.length)%32},gn.prototype._map=function(C,M){if(C.numPoints)return M?Ei({},C.properties):C.properties;var D=this.points[C.index].properties,U=this.options.map(D);return M&&U===D?Ei({},U):U},_n.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},_n.prototype.splitTile=function(C,M,D,U,G,ne,$){for(var L=[C,M,D,U],J=this.options,se=J.debug;L.length;){U=L.pop(),D=L.pop(),M=L.pop(),C=L.pop();var ze=1<<M,Be=li(M,D,U),Ee=this.tiles[Be];if(!Ee&&(se>1&&console.time("creation"),Ee=this.tiles[Be]=ei(C,M,D,U,J),this.tileCoords.push({z:M,x:D,y:U}),se)){se>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",M,D,U,Ee.numFeatures,Ee.numPoints,Ee.numSimplified),console.timeEnd("creation"));var ke="z"+M;this.stats[ke]=(this.stats[ke]||0)+1,this.total++}if(Ee.source=C,G){if(M===J.maxZoom||M===G)continue;var ot=1<<G-M;if(D!==Math.floor(ne/ot)||U!==Math.floor($/ot))continue}else if(M===J.indexMaxZoom||Ee.numPoints<=J.indexMaxPoints)continue;if(Ee.source=null,C.length!==0){se>1&&console.time("clipping");var We,Se,it,je,Ye,Bt,et=.5*J.buffer/J.extent,Yt=.5-et,Nt=.5+et,Ut=1+et;We=Se=it=je=null,Ye=un(C,ze,D-et,D+Nt,0,Ee.minX,Ee.maxX,J),Bt=un(C,ze,D+Yt,D+Ut,0,Ee.minX,Ee.maxX,J),C=null,Ye&&(We=un(Ye,ze,U-et,U+Nt,1,Ee.minY,Ee.maxY,J),Se=un(Ye,ze,U+Yt,U+Ut,1,Ee.minY,Ee.maxY,J),Ye=null),Bt&&(it=un(Bt,ze,U-et,U+Nt,1,Ee.minY,Ee.maxY,J),je=un(Bt,ze,U+Yt,U+Ut,1,Ee.minY,Ee.maxY,J),Bt=null),se>1&&console.timeEnd("clipping"),L.push(We||[],M+1,2*D,2*U),L.push(Se||[],M+1,2*D,2*U+1),L.push(it||[],M+1,2*D+1,2*U),L.push(je||[],M+1,2*D+1,2*U+1)}}},_n.prototype.getTile=function(C,M,D){var U=this.options,G=U.extent,ne=U.debug;if(C<0||C>24)return null;var $=1<<C,L=li(C,M=(M%$+$)%$,D);if(this.tiles[L])return bt(this.tiles[L],G);ne>1&&console.log("drilling down to z%d-%d-%d",C,M,D);for(var J,se=C,ze=M,Be=D;!J&&se>0;)se--,ze=Math.floor(ze/2),Be=Math.floor(Be/2),J=this.tiles[li(se,ze,Be)];return J&&J.source?(ne>1&&console.log("found parent tile z%d-%d-%d",se,ze,Be),ne>1&&console.time("drilling down"),this.splitTile(J.source,se,ze,Be,C,M,D),ne>1&&console.timeEnd("drilling down"),this.tiles[L]?bt(this.tiles[L],G):null):null};var xo=function(C){function M(D,U,G,ne){C.call(this,D,U,G,ti),ne&&(this.loadGeoJSON=ne)}return C&&(M.__proto__=C),(M.prototype=Object.create(C&&C.prototype)).constructor=M,M.prototype.loadData=function(D,U){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=U,this._pendingLoadDataParams=D,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},M.prototype._loadData=function(){var D=this;if(this._pendingCallback&&this._pendingLoadDataParams){var U=this._pendingCallback,G=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var ne=!!(G&&G.request&&G.request.collectResourceTiming)&&new l.RequestPerformance(G.request);this.loadGeoJSON(G,function($,L){if($||!L)return U($);if(typeof L!="object")return U(new Error("Input data given to '"+G.source+"' is not a valid GeoJSON object."));(function Ee(ke,ot){var We,Se=ke&&ke.type;if(Se==="FeatureCollection")for(We=0;We<ke.features.length;We++)Ee(ke.features[We],ot);else if(Se==="GeometryCollection")for(We=0;We<ke.geometries.length;We++)Ee(ke.geometries[We],ot);else if(Se==="Feature")Ee(ke.geometry,ot);else if(Se==="Polygon")or(ke.coordinates,ot);else if(Se==="MultiPolygon")for(We=0;We<ke.coordinates.length;We++)or(ke.coordinates[We],ot);return ke})(L,!0);try{if(G.filter){var J=l.createExpression(G.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(J.result==="error")throw new Error(J.value.map(function(Ee){return Ee.key+": "+Ee.message}).join(", "));var se=L.features.filter(function(Ee){return J.value.evaluate({zoom:0},Ee)});L={type:"FeatureCollection",features:se}}D._geoJSONIndex=G.cluster?new gn(function(Ee){var ke=Ee.superclusterOptions,ot=Ee.clusterProperties;if(!ot||!ke)return ke;for(var We={},Se={},it={accumulated:null,zoom:0},je={properties:null},Ye=Object.keys(ot),Bt=0,et=Ye;Bt<et.length;Bt+=1){var Yt=et[Bt],Nt=ot[Yt],Ut=Nt[0],Ht=l.createExpression(Nt[1]),rr=l.createExpression(typeof Ut=="string"?[Ut,["accumulated"],["get",Yt]]:Ut);We[Yt]=Ht.value,Se[Yt]=rr.value}return ke.map=function(Hr){je.properties=Hr;for(var cr={},zr=0,vr=Ye;zr<vr.length;zr+=1){var Zt=vr[zr];cr[Zt]=We[Zt].evaluate(it,je)}return cr},ke.reduce=function(Hr,cr){je.properties=cr;for(var zr=0,vr=Ye;zr<vr.length;zr+=1){var Zt=vr[zr];it.accumulated=Hr[Zt],Hr[Zt]=Se[Zt].evaluate(it,je)}},ke}(G)).load(L.features):function(Ee,ke){return new _n(Ee,ke)}(L,G.geojsonVtOptions)}catch(Ee){return U(Ee)}D.loaded={};var ze={};if(ne){var Be=ne.finish();Be&&(ze.resourceTiming={},ze.resourceTiming[G.source]=JSON.parse(JSON.stringify(Be)))}U(null,ze)})}},M.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},M.prototype.reloadTile=function(D,U){var G=this.loaded;return G&&G[D.uid]?C.prototype.reloadTile.call(this,D,U):this.loadTile(D,U)},M.prototype.loadGeoJSON=function(D,U){if(D.request)l.getJSON(D.request,U);else{if(typeof D.data!="string")return U(new Error("Input data given to '"+D.source+"' is not a valid GeoJSON object."));try{return U(null,JSON.parse(D.data))}catch{return U(new Error("Input data given to '"+D.source+"' is not a valid GeoJSON object."))}}},M.prototype.removeSource=function(D,U){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),U()},M.prototype.getClusterExpansionZoom=function(D,U){try{U(null,this._geoJSONIndex.getClusterExpansionZoom(D.clusterId))}catch(G){U(G)}},M.prototype.getClusterChildren=function(D,U){try{U(null,this._geoJSONIndex.getChildren(D.clusterId))}catch(G){U(G)}},M.prototype.getClusterLeaves=function(D,U){try{U(null,this._geoJSONIndex.getLeaves(D.clusterId,D.limit,D.offset))}catch(G){U(G)}},M}(nr),Ar=function(C){var M=this;this.self=C,this.actor=new l.Actor(C,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:nr,geojson:xo},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(D,U){if(M.workerSourceTypes[D])throw new Error('Worker source with name "'+D+'" already registered.');M.workerSourceTypes[D]=U},this.self.registerRTLTextPlugin=function(D){if(l.plugin.isParsed())throw new Error("RTL text plugin already registered.");l.plugin.applyArabicShaping=D.applyArabicShaping,l.plugin.processBidirectionalText=D.processBidirectionalText,l.plugin.processStyledBidirectionalText=D.processStyledBidirectionalText}};return Ar.prototype.setReferrer=function(C,M){this.referrer=M},Ar.prototype.setImages=function(C,M,D){for(var U in this.availableImages[C]=M,this.workerSources[C]){var G=this.workerSources[C][U];for(var ne in G)G[ne].availableImages=M}D()},Ar.prototype.setLayers=function(C,M,D){this.getLayerIndex(C).replace(M),D()},Ar.prototype.updateLayers=function(C,M,D){this.getLayerIndex(C).update(M.layers,M.removedIds),D()},Ar.prototype.loadTile=function(C,M,D){this.getWorkerSource(C,M.type,M.source).loadTile(M,D)},Ar.prototype.loadDEMTile=function(C,M,D){this.getDEMWorkerSource(C,M.source).loadTile(M,D)},Ar.prototype.reloadTile=function(C,M,D){this.getWorkerSource(C,M.type,M.source).reloadTile(M,D)},Ar.prototype.abortTile=function(C,M,D){this.getWorkerSource(C,M.type,M.source).abortTile(M,D)},Ar.prototype.removeTile=function(C,M,D){this.getWorkerSource(C,M.type,M.source).removeTile(M,D)},Ar.prototype.removeDEMTile=function(C,M){this.getDEMWorkerSource(C,M.source).removeTile(M)},Ar.prototype.removeSource=function(C,M,D){if(this.workerSources[C]&&this.workerSources[C][M.type]&&this.workerSources[C][M.type][M.source]){var U=this.workerSources[C][M.type][M.source];delete this.workerSources[C][M.type][M.source],U.removeSource!==void 0?U.removeSource(M,D):D()}},Ar.prototype.loadWorkerSource=function(C,M,D){try{this.self.importScripts(M.url),D()}catch(U){D(U.toString())}},Ar.prototype.syncRTLPluginState=function(C,M,D){try{l.plugin.setState(M);var U=l.plugin.getPluginURL();if(l.plugin.isLoaded()&&!l.plugin.isParsed()&&U!=null){this.self.importScripts(U);var G=l.plugin.isParsed();D(G?void 0:new Error("RTL Text Plugin failed to import scripts from "+U),G)}}catch(ne){D(ne.toString())}},Ar.prototype.getAvailableImages=function(C){var M=this.availableImages[C];return M||(M=[]),M},Ar.prototype.getLayerIndex=function(C){var M=this.layerIndexes[C];return M||(M=this.layerIndexes[C]=new Ur),M},Ar.prototype.getWorkerSource=function(C,M,D){var U=this;return this.workerSources[C]||(this.workerSources[C]={}),this.workerSources[C][M]||(this.workerSources[C][M]={}),this.workerSources[C][M][D]||(this.workerSources[C][M][D]=new this.workerSourceTypes[M]({send:function(G,ne,$){U.actor.send(G,ne,$,C)}},this.getLayerIndex(C),this.getAvailableImages(C))),this.workerSources[C][M][D]},Ar.prototype.getDEMWorkerSource=function(C,M){return this.demWorkerSources[C]||(this.demWorkerSources[C]={}),this.demWorkerSources[C][M]||(this.demWorkerSources[C][M]=new _t),this.demWorkerSources[C][M]},Ar.prototype.enforceCacheSizeLimit=function(C,M){l.enforceCacheSizeLimit(M)},typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Ar(self)),Ar}),Cr(["./shared"],function(l){var ur=l.createCommonjsModule(function(n){function o(p){return!i(p)}function i(p){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var m,_,S=new Blob([""],{type:"text/javascript"}),P=URL.createObjectURL(S);try{_=new Worker(P),m=!0}catch{m=!1}return _&&_.terminate(),URL.revokeObjectURL(P),m}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var m=document.createElement("canvas");m.width=m.height=1;var _=m.getContext("2d");if(!_)return!1;var S=_.getImageData(0,0,1,1);return S&&S.width===m.width}()?(s[d=p&&p.failIfMajorPerformanceCaveat]===void 0&&(s[d]=function(m){var _=function(P){var B=document.createElement("canvas"),F=Object.create(o.webGLContextAttributes);return F.failIfMajorPerformanceCaveat=P,B.probablySupportsContext?B.probablySupportsContext("webgl",F)||B.probablySupportsContext("experimental-webgl",F):B.supportsContext?B.supportsContext("webgl",F)||B.supportsContext("experimental-webgl",F):B.getContext("webgl",F)||B.getContext("experimental-webgl",F)}(m);if(!_)return!1;var S=_.createShader(_.VERTEX_SHADER);return!(!S||_.isContextLost())&&(_.shaderSource(S,"void main() {}"),_.compileShader(S),_.getShaderParameter(S,_.COMPILE_STATUS)===!0)}(d)),s[d]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var d}n.exports?n.exports=o:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=o,window.mapboxgl.notSupportedReason=i);var s={};o.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),Oe={create:function(n,o,i){var s=l.window.document.createElement(n);return o!==void 0&&(s.className=o),i&&i.appendChild(s),s},createNS:function(n,o){return l.window.document.createElementNS(n,o)}},Ur=l.window.document&&l.window.document.documentElement.style;function Rt(n){if(!Ur)return n[0];for(var o=0;o<n.length;o++)if(n[o]in Ur)return n[o];return n[0]}var Gr,Xe=Rt(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);Oe.disableDrag=function(){Ur&&Xe&&(Gr=Ur[Xe],Ur[Xe]="none")},Oe.enableDrag=function(){Ur&&Xe&&(Ur[Xe]=Gr)};var Nn=Rt(["transform","WebkitTransform"]);Oe.setTransform=function(n,o){n.style[Nn]=o};var nr=!1;try{var Or=Object.defineProperty({},"passive",{get:function(){nr=!0}});l.window.addEventListener("test",Or,Or),l.window.removeEventListener("test",Or,Or)}catch{nr=!1}Oe.addEventListener=function(n,o,i,s){s===void 0&&(s={}),n.addEventListener(o,i,"passive"in s&&nr?s:s.capture)},Oe.removeEventListener=function(n,o,i,s){s===void 0&&(s={}),n.removeEventListener(o,i,"passive"in s&&nr?s:s.capture)};var _t=function(n){n.preventDefault(),n.stopPropagation(),l.window.removeEventListener("click",_t,!0)};function or(n){var o=n.userImage;return!!(o&&o.render&&o.render())&&(n.data.replace(new Uint8Array(o.data.buffer)),!0)}Oe.suppressClick=function(){l.window.addEventListener("click",_t,!0),l.window.setTimeout(function(){l.window.removeEventListener("click",_t,!0)},0)},Oe.mousePos=function(n,o){var i=n.getBoundingClientRect();return new l.Point(o.clientX-i.left-n.clientLeft,o.clientY-i.top-n.clientTop)},Oe.touchPos=function(n,o){for(var i=n.getBoundingClientRect(),s=[],p=0;p<o.length;p++)s.push(new l.Point(o[p].clientX-i.left-n.clientLeft,o[p].clientY-i.top-n.clientTop));return s},Oe.mouseButton=function(n){return l.window.InstallTrigger!==void 0&&n.button===2&&n.ctrlKey&&l.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:n.button},Oe.remove=function(n){n.parentNode&&n.parentNode.removeChild(n)};var dr=function(n){function o(){n.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.RGBAImage({width:1,height:1}),this.dirty=!0}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.isLoaded=function(){return this.loaded},o.prototype.setLoaded=function(i){if(this.loaded!==i&&(this.loaded=i,i)){for(var s=0,p=this.requestors;s<p.length;s+=1){var d=p[s];this._notify(d.ids,d.callback)}this.requestors=[]}},o.prototype.getImage=function(i){return this.images[i]},o.prototype.addImage=function(i,s){this._validate(i,s)&&(this.images[i]=s)},o.prototype._validate=function(i,s){var p=!0;return this._validateStretch(s.stretchX,s.data&&s.data.width)||(this.fire(new l.ErrorEvent(new Error('Image "'+i+'" has invalid "stretchX" value'))),p=!1),this._validateStretch(s.stretchY,s.data&&s.data.height)||(this.fire(new l.ErrorEvent(new Error('Image "'+i+'" has invalid "stretchY" value'))),p=!1),this._validateContent(s.content,s)||(this.fire(new l.ErrorEvent(new Error('Image "'+i+'" has invalid "content" value'))),p=!1),p},o.prototype._validateStretch=function(i,s){if(!i)return!0;for(var p=0,d=0,m=i;d<m.length;d+=1){var _=m[d];if(_[0]<p||_[1]<_[0]||s<_[1])return!1;p=_[1]}return!0},o.prototype._validateContent=function(i,s){return!(i&&(i.length!==4||i[0]<0||s.data.width<i[0]||i[1]<0||s.data.height<i[1]||i[2]<0||s.data.width<i[2]||i[3]<0||s.data.height<i[3]||i[2]<i[0]||i[3]<i[1]))},o.prototype.updateImage=function(i,s){s.version=this.images[i].version+1,this.images[i]=s,this.updatedImages[i]=!0},o.prototype.removeImage=function(i){var s=this.images[i];delete this.images[i],delete this.patterns[i],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()},o.prototype.listImages=function(){return Object.keys(this.images)},o.prototype.getImages=function(i,s){var p=!0;if(!this.isLoaded())for(var d=0,m=i;d<m.length;d+=1)this.images[m[d]]||(p=!1);this.isLoaded()||p?this._notify(i,s):this.requestors.push({ids:i,callback:s})},o.prototype._notify=function(i,s){for(var p={},d=0,m=i;d<m.length;d+=1){var _=m[d];this.images[_]||this.fire(new l.Event("styleimagemissing",{id:_}));var S=this.images[_];S?p[_]={data:S.data.clone(),pixelRatio:S.pixelRatio,sdf:S.sdf,version:S.version,stretchX:S.stretchX,stretchY:S.stretchY,content:S.content,hasRenderCallback:!!(S.userImage&&S.userImage.render)}:l.warnOnce('Image "'+_+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}s(null,p)},o.prototype.getPixelSize=function(){var i=this.atlasImage;return{width:i.width,height:i.height}},o.prototype.getPattern=function(i){var s=this.patterns[i],p=this.getImage(i);if(!p)return null;if(s&&s.position.version===p.version)return s.position;if(s)s.position.version=p.version;else{var d={w:p.data.width+2,h:p.data.height+2,x:0,y:0},m=new l.ImagePosition(d,p);this.patterns[i]={bin:d,position:m}}return this._updatePatternAtlas(),this.patterns[i].position},o.prototype.bind=function(i){var s=i.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new l.Texture(i,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)},o.prototype._updatePatternAtlas=function(){var i=[];for(var s in this.patterns)i.push(this.patterns[s].bin);var p=l.potpack(i),d=p.w,m=p.h,_=this.atlasImage;for(var S in _.resize({width:d||1,height:m||1}),this.patterns){var P=this.patterns[S].bin,B=P.x+1,F=P.y+1,N=this.images[S].data,H=N.width,W=N.height;l.RGBAImage.copy(N,_,{x:0,y:0},{x:B,y:F},{width:H,height:W}),l.RGBAImage.copy(N,_,{x:0,y:W-1},{x:B,y:F-1},{width:H,height:1}),l.RGBAImage.copy(N,_,{x:0,y:0},{x:B,y:F+W},{width:H,height:1}),l.RGBAImage.copy(N,_,{x:H-1,y:0},{x:B-1,y:F},{width:1,height:W}),l.RGBAImage.copy(N,_,{x:0,y:0},{x:B+H,y:F},{width:1,height:W})}this.dirty=!0},o.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},o.prototype.dispatchRenderCallbacks=function(i){for(var s=0,p=i;s<p.length;s+=1){var d=p[s];if(!this.callbackDispatchedThisFrame[d]){this.callbackDispatchedThisFrame[d]=!0;var m=this.images[d];or(m)&&this.updateImage(d,m)}}},o}(l.Evented),Ji=Un,Rr=Un,Vr=1e20;function Un(n,o,i,s,p,d){this.fontSize=n||24,this.buffer=o===void 0?3:o,this.cutoff=s||.25,this.fontFamily=p||"sans-serif",this.fontWeight=d||"normal",this.radius=i||8;var m=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=m,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(m*m),this.gridInner=new Float64Array(m*m),this.f=new Float64Array(m),this.d=new Float64Array(m),this.z=new Float64Array(m+1),this.v=new Int16Array(m),this.middle=Math.round(m/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Qr(n,o,i,s,p,d,m){for(var _=0;_<o;_++){for(var S=0;S<i;S++)s[S]=n[S*o+_];for(zi(s,p,d,m,i),S=0;S<i;S++)n[S*o+_]=p[S]}for(S=0;S<i;S++){for(_=0;_<o;_++)s[_]=n[S*o+_];for(zi(s,p,d,m,o),_=0;_<o;_++)n[S*o+_]=Math.sqrt(p[_])}}function zi(n,o,i,s,p){i[0]=0,s[0]=-1e20,s[1]=1e20;for(var d=1,m=0;d<p;d++){for(var _=(n[d]+d*d-(n[i[m]]+i[m]*i[m]))/(2*d-2*i[m]);_<=s[m];)m--,_=(n[d]+d*d-(n[i[m]]+i[m]*i[m]))/(2*d-2*i[m]);i[++m]=d,s[m]=_,s[m+1]=1e20}for(d=0,m=0;d<p;d++){for(;s[m+1]<d;)m++;o[d]=(d-i[m])*(d-i[m])+n[i[m]]}}Un.prototype.draw=function(n){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(n,this.buffer,this.middle);for(var o=this.ctx.getImageData(0,0,this.size,this.size),i=new Uint8ClampedArray(this.size*this.size),s=0;s<this.size*this.size;s++){var p=o.data[4*s+3]/255;this.gridOuter[s]=p===1?0:p===0?Vr:Math.pow(Math.max(0,.5-p),2),this.gridInner[s]=p===1?Vr:p===0?0:Math.pow(Math.max(0,p-.5),2)}for(Qr(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),Qr(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),s=0;s<this.size*this.size;s++)i[s]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[s]-this.gridInner[s])/this.radius+this.cutoff))));return i},Ji.default=Rr;var bn=function(n,o){this.requestManager=n,this.localIdeographFontFamily=o,this.entries={}};bn.prototype.setURL=function(n){this.url=n},bn.prototype.getGlyphs=function(n,o){var i=this,s=[];for(var p in n)for(var d=0,m=n[p];d<m.length;d+=1)s.push({stack:p,id:m[d]});l.asyncAll(s,function(_,S){var P=_.stack,B=_.id,F=i.entries[P];F||(F=i.entries[P]={glyphs:{},requests:{},ranges:{}});var N=F.glyphs[B];if(N===void 0){if(N=i._tinySDF(F,P,B))return F.glyphs[B]=N,void S(null,{stack:P,id:B,glyph:N});var H=Math.floor(B/256);if(256*H>65535)S(new Error("glyphs > 65535 not supported"));else if(F.ranges[H])S(null,{stack:P,id:B,glyph:N});else{var W=F.requests[H];W||(W=F.requests[H]=[],bn.loadGlyphRange(P,H,i.url,i.requestManager,function(ee,q){if(q){for(var Q in q)i._doesCharSupportLocalGlyph(+Q)||(F.glyphs[+Q]=q[+Q]);F.ranges[H]=!0}for(var ae=0,me=W;ae<me.length;ae+=1)(0,me[ae])(ee,q);delete F.requests[H]})),W.push(function(ee,q){ee?S(ee):q&&S(null,{stack:P,id:B,glyph:q[B]||null})})}}else S(null,{stack:P,id:B,glyph:N})},function(_,S){if(_)o(_);else if(S){for(var P={},B=0,F=S;B<F.length;B+=1){var N=F[B],H=N.stack,W=N.id,ee=N.glyph;(P[H]||(P[H]={}))[W]=ee&&{id:ee.id,bitmap:ee.bitmap.clone(),metrics:ee.metrics}}o(null,P)}})},bn.prototype._doesCharSupportLocalGlyph=function(n){return!!this.localIdeographFontFamily&&(l.isChar["CJK Unified Ideographs"](n)||l.isChar["Hangul Syllables"](n)||l.isChar.Hiragana(n)||l.isChar.Katakana(n))},bn.prototype._tinySDF=function(n,o,i){var s=this.localIdeographFontFamily;if(s&&this._doesCharSupportLocalGlyph(i)){var p=n.tinySDF;if(!p){var d="400";/bold/i.test(o)?d="900":/medium/i.test(o)?d="500":/light/i.test(o)&&(d="200"),p=n.tinySDF=new bn.TinySDF(24,3,8,.25,s,d)}return{id:i,bitmap:new l.AlphaImage({width:30,height:30},p.draw(String.fromCharCode(i))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},bn.loadGlyphRange=function(n,o,i,s,p){var d=256*o,m=d+255,_=s.transformRequest(s.normalizeGlyphsURL(i).replace("{fontstack}",n).replace("{range}",d+"-"+m),l.ResourceType.Glyphs);l.getArrayBuffer(_,function(S,P){if(S)p(S);else if(P){for(var B={},F=0,N=l.parseGlyphPBF(P);F<N.length;F+=1){var H=N[F];B[H.id]=H}p(null,B)}})},bn.TinySDF=Ji;var vi=function(){this.specification=l.styleSpec.light.position};vi.prototype.possiblyEvaluate=function(n,o){return l.sphericalToCartesian(n.expression.evaluate(o))},vi.prototype.interpolate=function(n,o,i){return{x:l.number(n.x,o.x,i),y:l.number(n.y,o.y,i),z:l.number(n.z,o.z,i)}};var si=new l.Properties({anchor:new l.DataConstantProperty(l.styleSpec.light.anchor),position:new vi,color:new l.DataConstantProperty(l.styleSpec.light.color),intensity:new l.DataConstantProperty(l.styleSpec.light.intensity)}),_i=function(n){function o(i){n.call(this),this._transitionable=new l.Transitionable(si),this.setLight(i),this._transitioning=this._transitionable.untransitioned()}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getLight=function(){return this._transitionable.serialize()},o.prototype.setLight=function(i,s){if(s===void 0&&(s={}),!this._validate(l.validateLight,i,s))for(var p in i){var d=i[p];l.endsWith(p,"-transition")?this._transitionable.setTransition(p.slice(0,-11),d):this._transitionable.setValue(p,d)}},o.prototype.updateTransitions=function(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)},o.prototype.hasTransition=function(){return this._transitioning.hasTransition()},o.prototype.recalculate=function(i){this.properties=this._transitioning.possiblyEvaluate(i)},o.prototype._validate=function(i,s,p){return(!p||p.validate!==!1)&&l.emitValidationErrors(this,i.call(l.validateStyle,l.extend({value:s,style:{glyphs:!0,sprite:!0},styleSpec:l.styleSpec})))},o}(l.Evented),Sr=function(n,o){this.width=n,this.height=o,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};Sr.prototype.getDash=function(n,o){var i=n.join(",")+String(o);return this.dashEntry[i]||(this.dashEntry[i]=this.addDash(n,o)),this.dashEntry[i]},Sr.prototype.getDashRanges=function(n,o,i){var s=[],p=n.length%2==1?-n[n.length-1]*i:0,d=n[0]*i,m=!0;s.push({left:p,right:d,isDash:m,zeroLength:n[0]===0});for(var _=n[0],S=1;S<n.length;S++){var P=n[S];s.push({left:p=_*i,right:d=(_+=P)*i,isDash:m=!m,zeroLength:P===0})}return s},Sr.prototype.addRoundDash=function(n,o,i){for(var s=o/2,p=-i;p<=i;p++)for(var d=this.width*(this.nextRow+i+p),m=0,_=n[m],S=0;S<this.width;S++){S/_.right>1&&(_=n[++m]);var P=Math.abs(S-_.left),B=Math.abs(S-_.right),F=Math.min(P,B),N=void 0,H=p/i*(s+1);if(_.isDash){var W=s-Math.abs(H);N=Math.sqrt(F*F+W*W)}else N=s-Math.sqrt(F*F+H*H);this.data[d+S]=Math.max(0,Math.min(255,N+128))}},Sr.prototype.addRegularDash=function(n){for(var o=n.length-1;o>=0;--o){var i=n[o],s=n[o+1];i.zeroLength?n.splice(o,1):s&&s.isDash===i.isDash&&(s.left=i.left,n.splice(o,1))}var p=n[0],d=n[n.length-1];p.isDash===d.isDash&&(p.left=d.left-this.width,d.right=p.right+this.width);for(var m=this.width*this.nextRow,_=0,S=n[_],P=0;P<this.width;P++){P/S.right>1&&(S=n[++_]);var B=Math.abs(P-S.left),F=Math.abs(P-S.right),N=Math.min(B,F);this.data[m+P]=Math.max(0,Math.min(255,(S.isDash?N:-N)+128))}},Sr.prototype.addDash=function(n,o){var i=o?7:0,s=2*i+1;if(this.nextRow+s>this.height)return l.warnOnce("LineAtlas out of space"),null;for(var p=0,d=0;d<n.length;d++)p+=n[d];if(p!==0){var m=this.width/p,_=this.getDashRanges(n,this.width,m);o?this.addRoundDash(_,m,i):this.addRegularDash(_)}var S={y:(this.nextRow+i+.5)/this.height,height:2*i/this.height,width:p};return this.nextRow+=s,this.dirty=!0,S},Sr.prototype.bind=function(n){var o=n.gl;this.texture?(o.bindTexture(o.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,o.texSubImage2D(o.TEXTURE_2D,0,0,0,this.width,this.height,o.ALPHA,o.UNSIGNED_BYTE,this.data))):(this.texture=o.createTexture(),o.bindTexture(o.TEXTURE_2D,this.texture),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texImage2D(o.TEXTURE_2D,0,o.ALPHA,this.width,this.height,0,o.ALPHA,o.UNSIGNED_BYTE,this.data))};var Br=function n(o,i){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=l.uniqueId();for(var s=this.workerPool.acquire(this.id),p=0;p<s.length;p++){var d=new n.Actor(s[p],i,this.id);d.name="Worker "+p,this.actors.push(d)}};function Bo(n,o,i){var s=function(p,d){if(p)return i(p);if(d){var m=l.pick(l.extend(d,n),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);d.vector_layers&&(m.vectorLayers=d.vector_layers,m.vectorLayerIds=m.vectorLayers.map(function(_){return _.id})),m.tiles=o.canonicalizeTileset(m,n.url),i(null,m)}};return n.url?l.getJSON(o.transformRequest(o.normalizeSourceURL(n.url),l.ResourceType.Source),s):l.browser.frame(function(){return s(null,n)})}Br.prototype.broadcast=function(n,o,i){l.asyncAll(this.actors,function(s,p){s.send(n,o,p)},i=i||function(){})},Br.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Br.prototype.remove=function(){this.actors.forEach(function(n){n.remove()}),this.actors=[],this.workerPool.release(this.id)},Br.Actor=l.Actor;var yn=function(n,o,i){this.bounds=l.LngLatBounds.convert(this.validateBounds(n)),this.minzoom=o||0,this.maxzoom=i||24};yn.prototype.validateBounds=function(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]},yn.prototype.contains=function(n){var o=Math.pow(2,n.z),i=Math.floor(l.mercatorXfromLng(this.bounds.getWest())*o),s=Math.floor(l.mercatorYfromLat(this.bounds.getNorth())*o),p=Math.ceil(l.mercatorXfromLng(this.bounds.getEast())*o),d=Math.ceil(l.mercatorYfromLat(this.bounds.getSouth())*o);return n.x>=i&&n.x<p&&n.y>=s&&n.y<d};var vo=function(n){function o(i,s,p,d){if(n.call(this),this.id=i,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.extend(this,l.pick(s,["url","scheme","tileSize","promoteId"])),this._options=l.extend({type:"vector"},s),this._collectResourceTiming=s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(d)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.load=function(){var i=this;this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Bo(this._options,this.map._requestManager,function(s,p){i._tileJSONRequest=null,i._loaded=!0,s?i.fire(new l.ErrorEvent(s)):p&&(l.extend(i,p),p.bounds&&(i.tileBounds=new yn(p.bounds,i.minzoom,i.maxzoom)),l.postTurnstileEvent(p.tiles,i.map._requestManager._customAccessToken),l.postMapLoadEvent(p.tiles,i.map._getMapId(),i.map._requestManager._skuToken,i.map._requestManager._customAccessToken),i.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),i.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})))})},o.prototype.loaded=function(){return this._loaded},o.prototype.hasTile=function(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)},o.prototype.onAdd=function(i){this.map=i,this.load()},o.prototype.setSourceProperty=function(i){this._tileJSONRequest&&this._tileJSONRequest.cancel(),i(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},o.prototype.setTiles=function(i){var s=this;return this.setSourceProperty(function(){s._options.tiles=i}),this},o.prototype.setUrl=function(i){var s=this;return this.setSourceProperty(function(){s.url=i,s._options.url=i}),this},o.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},o.prototype.serialize=function(){return l.extend({},this._options)},o.prototype.loadTile=function(i,s){var p=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme)),d={request:this.map._requestManager.transformRequest(p,l.ResourceType.Tile),uid:i.uid,tileID:i.tileID,zoom:i.tileID.overscaledZ,tileSize:this.tileSize*i.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:l.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function m(_,S){return delete i.request,i.aborted?s(null):_&&_.status!==404?s(_):(S&&S.resourceTiming&&(i.resourceTiming=S.resourceTiming),this.map._refreshExpiredTiles&&S&&i.setExpiryData(S),i.loadVectorData(S,this.map.painter),l.cacheEntryPossiblyAdded(this.dispatcher),s(null),void(i.reloadCallback&&(this.loadTile(i,i.reloadCallback),i.reloadCallback=null)))}d.request.collectResourceTiming=this._collectResourceTiming,i.actor&&i.state!=="expired"?i.state==="loading"?i.reloadCallback=s:i.request=i.actor.send("reloadTile",d,m.bind(this)):(i.actor=this.dispatcher.getActor(),i.request=i.actor.send("loadTile",d,m.bind(this)))},o.prototype.abortTile=function(i){i.request&&(i.request.cancel(),delete i.request),i.actor&&i.actor.send("abortTile",{uid:i.uid,type:this.type,source:this.id},void 0)},o.prototype.unloadTile=function(i){i.unloadVectorData(),i.actor&&i.actor.send("removeTile",{uid:i.uid,type:this.type,source:this.id},void 0)},o.prototype.hasTransition=function(){return!1},o}(l.Evented),Vn=function(n){function o(i,s,p,d){n.call(this),this.id=i,this.dispatcher=p,this.setEventedParent(d),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.extend({type:"raster"},s),l.extend(this,l.pick(s,["url","scheme","tileSize"]))}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.load=function(){var i=this;this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Bo(this._options,this.map._requestManager,function(s,p){i._tileJSONRequest=null,i._loaded=!0,s?i.fire(new l.ErrorEvent(s)):p&&(l.extend(i,p),p.bounds&&(i.tileBounds=new yn(p.bounds,i.minzoom,i.maxzoom)),l.postTurnstileEvent(p.tiles),l.postMapLoadEvent(p.tiles,i.map._getMapId(),i.map._requestManager._skuToken),i.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),i.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})))})},o.prototype.loaded=function(){return this._loaded},o.prototype.onAdd=function(i){this.map=i,this.load()},o.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},o.prototype.serialize=function(){return l.extend({},this._options)},o.prototype.hasTile=function(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)},o.prototype.loadTile=function(i,s){var p=this,d=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);i.request=l.getImage(this.map._requestManager.transformRequest(d,l.ResourceType.Tile),function(m,_){if(delete i.request,i.aborted)i.state="unloaded",s(null);else if(m)i.state="errored",s(m);else if(_){p.map._refreshExpiredTiles&&i.setExpiryData(_),delete _.cacheControl,delete _.expires;var S=p.map.painter.context,P=S.gl;i.texture=p.map.painter.getTileTexture(_.width),i.texture?i.texture.update(_,{useMipmap:!0}):(i.texture=new l.Texture(S,_,P.RGBA,{useMipmap:!0}),i.texture.bind(P.LINEAR,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST),S.extTextureFilterAnisotropic&&P.texParameterf(P.TEXTURE_2D,S.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,S.extTextureFilterAnisotropicMax)),i.state="loaded",l.cacheEntryPossiblyAdded(p.dispatcher),s(null)}})},o.prototype.abortTile=function(i,s){i.request&&(i.request.cancel(),delete i.request),s()},o.prototype.unloadTile=function(i,s){i.texture&&this.map.painter.saveTileTexture(i.texture),s()},o.prototype.hasTransition=function(){return!1},o}(l.Evented),xi=function(n){function o(i,s,p,d){n.call(this,i,s,p,d),this.type="raster-dem",this.maxzoom=22,this._options=l.extend({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox"}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},o.prototype.loadTile=function(i,s){var p=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function d(m,_){m&&(i.state="errored",s(m)),_&&(i.dem=_,i.needsHillshadePrepare=!0,i.state="loaded",s(null))}i.request=l.getImage(this.map._requestManager.transformRequest(p,l.ResourceType.Tile),function(m,_){if(delete i.request,i.aborted)i.state="unloaded",s(null);else if(m)i.state="errored",s(m);else if(_){this.map._refreshExpiredTiles&&i.setExpiryData(_),delete _.cacheControl,delete _.expires;var S=l.window.ImageBitmap&&_ instanceof l.window.ImageBitmap&&l.offscreenCanvasSupported()?_:l.browser.getImageData(_,1),P={uid:i.uid,coord:i.tileID,source:this.id,rawImageData:S,encoding:this.encoding};i.actor&&i.state!=="expired"||(i.actor=this.dispatcher.getActor(),i.actor.send("loadDEMTile",P,d.bind(this)))}}.bind(this)),i.neighboringTiles=this._getNeighboringTiles(i.tileID)},o.prototype._getNeighboringTiles=function(i){var s=i.canonical,p=Math.pow(2,s.z),d=(s.x-1+p)%p,m=s.x===0?i.wrap-1:i.wrap,_=(s.x+1+p)%p,S=s.x+1===p?i.wrap+1:i.wrap,P={};return P[new l.OverscaledTileID(i.overscaledZ,m,s.z,d,s.y).key]={backfilled:!1},P[new l.OverscaledTileID(i.overscaledZ,S,s.z,_,s.y).key]={backfilled:!1},s.y>0&&(P[new l.OverscaledTileID(i.overscaledZ,m,s.z,d,s.y-1).key]={backfilled:!1},P[new l.OverscaledTileID(i.overscaledZ,i.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},P[new l.OverscaledTileID(i.overscaledZ,S,s.z,_,s.y-1).key]={backfilled:!1}),s.y+1<p&&(P[new l.OverscaledTileID(i.overscaledZ,m,s.z,d,s.y+1).key]={backfilled:!1},P[new l.OverscaledTileID(i.overscaledZ,i.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},P[new l.OverscaledTileID(i.overscaledZ,S,s.z,_,s.y+1).key]={backfilled:!1}),P},o.prototype.unloadTile=function(i){i.demTexture&&this.map.painter.saveTileTexture(i.demTexture),i.fbo&&(i.fbo.destroy(),delete i.fbo),i.dem&&delete i.dem,delete i.neighboringTiles,i.state="unloaded",i.actor&&i.actor.send("removeDEMTile",{uid:i.uid,source:this.id})},o}(Vn),Mn=function(n){function o(i,s,p,d){n.call(this),this.id=i,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=p.getActor(),this.setEventedParent(d),this._data=s.data,this._options=l.extend({},s),this._collectResourceTiming=s.collectResourceTiming,this._resourceTiming=[],s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;var m=l.EXTENT/this.tileSize;this.workerOptions=l.extend({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(s.buffer!==void 0?s.buffer:128)*m,tolerance:(s.tolerance!==void 0?s.tolerance:.375)*m,extent:l.EXTENT,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?Math.min(s.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:l.EXTENT,radius:(s.clusterRadius||50)*m,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.load=function(){var i=this;this.fire(new l.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(s){if(s)i.fire(new l.ErrorEvent(s));else{var p={dataType:"source",sourceDataType:"metadata"};i._collectResourceTiming&&i._resourceTiming&&i._resourceTiming.length>0&&(p.resourceTiming=i._resourceTiming,i._resourceTiming=[]),i.fire(new l.Event("data",p))}})},o.prototype.onAdd=function(i){this.map=i,this.load()},o.prototype.setData=function(i){var s=this;return this._data=i,this.fire(new l.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(p){if(p)s.fire(new l.ErrorEvent(p));else{var d={dataType:"source",sourceDataType:"content"};s._collectResourceTiming&&s._resourceTiming&&s._resourceTiming.length>0&&(d.resourceTiming=s._resourceTiming,s._resourceTiming=[]),s.fire(new l.Event("data",d))}}),this},o.prototype.getClusterExpansionZoom=function(i,s){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:i,source:this.id},s),this},o.prototype.getClusterChildren=function(i,s){return this.actor.send("geojson.getClusterChildren",{clusterId:i,source:this.id},s),this},o.prototype.getClusterLeaves=function(i,s,p,d){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:i,limit:s,offset:p},d),this},o.prototype._updateWorkerData=function(i){var s=this;this._loaded=!1;var p=l.extend({},this.workerOptions),d=this._data;typeof d=="string"?(p.request=this.map._requestManager.transformRequest(l.browser.resolveURL(d),l.ResourceType.Source),p.request.collectResourceTiming=this._collectResourceTiming):p.data=JSON.stringify(d),this.actor.send(this.type+".loadData",p,function(m,_){s._removed||_&&_.abandoned||(s._loaded=!0,_&&_.resourceTiming&&_.resourceTiming[s.id]&&(s._resourceTiming=_.resourceTiming[s.id].slice(0)),s.actor.send(s.type+".coalesce",{source:p.source},null),i(m))})},o.prototype.loaded=function(){return this._loaded},o.prototype.loadTile=function(i,s){var p=this,d=i.actor?"reloadTile":"loadTile";i.actor=this.actor,i.request=this.actor.send(d,{type:this.type,uid:i.uid,tileID:i.tileID,zoom:i.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:l.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(m,_){return delete i.request,i.unloadVectorData(),i.aborted?s(null):m?s(m):(i.loadVectorData(_,p.map.painter,d==="reloadTile"),s(null))})},o.prototype.abortTile=function(i){i.request&&(i.request.cancel(),delete i.request),i.aborted=!0},o.prototype.unloadTile=function(i){i.unloadVectorData(),this.actor.send("removeTile",{uid:i.uid,type:this.type,source:this.id})},o.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},o.prototype.serialize=function(){return l.extend({},this._options,{type:this.type,data:this._data})},o.prototype.hasTransition=function(){return!1},o}(l.Evented),$n=l.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),Di=function(n){function o(i,s,p,d){n.call(this),this.id=i,this.dispatcher=p,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(d),this.options=s}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.load=function(i,s){var p=this;this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this.url=this.options.url,l.getImage(this.map._requestManager.transformRequest(this.url,l.ResourceType.Image),function(d,m){p._loaded=!0,d?p.fire(new l.ErrorEvent(d)):m&&(p.image=m,i&&(p.coordinates=i),s&&s(),p._finishLoading())})},o.prototype.loaded=function(){return this._loaded},o.prototype.updateImage=function(i){var s=this;return this.image&&i.url?(this.options.url=i.url,this.load(i.coordinates,function(){s.texture=null}),this):this},o.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})))},o.prototype.onAdd=function(i){this.map=i,this.load()},o.prototype.setCoordinates=function(i){var s=this;this.coordinates=i;var p=i.map(l.MercatorCoordinate.fromLngLat);this.tileID=function(m){for(var _=1/0,S=1/0,P=-1/0,B=-1/0,F=0,N=m;F<N.length;F+=1){var H=N[F];_=Math.min(_,H.x),S=Math.min(S,H.y),P=Math.max(P,H.x),B=Math.max(B,H.y)}var W=Math.max(P-_,B-S),ee=Math.max(0,Math.floor(-Math.log(W)/Math.LN2)),q=Math.pow(2,ee);return new l.CanonicalTileID(ee,Math.floor((_+P)/2*q),Math.floor((S+B)/2*q))}(p),this.minzoom=this.maxzoom=this.tileID.z;var d=p.map(function(m){return s.tileID.getTilePoint(m)._round()});return this._boundsArray=new l.StructArrayLayout4i8,this._boundsArray.emplaceBack(d[0].x,d[0].y,0,0),this._boundsArray.emplaceBack(d[1].x,d[1].y,l.EXTENT,0),this._boundsArray.emplaceBack(d[3].x,d[3].y,0,l.EXTENT),this._boundsArray.emplaceBack(d[2].x,d[2].y,l.EXTENT,l.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})),this},o.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var i=this.map.painter.context,s=i.gl;for(var p in this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,$n.members)),this.boundsSegments||(this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new l.Texture(i,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE)),this.tiles){var d=this.tiles[p];d.state!=="loaded"&&(d.state="loaded",d.texture=this.texture)}}},o.prototype.loadTile=function(i,s){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={},s(null)):(i.state="errored",s(null))},o.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},o.prototype.hasTransition=function(){return!1},o}(l.Evented),Wn=function(n){function o(i,s,p,d){n.call(this,i,s,p,d),this.roundZoom=!0,this.type="video",this.options=s}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.load=function(){var i=this;this._loaded=!1;var s=this.options;this.urls=[];for(var p=0,d=s.urls;p<d.length;p+=1)this.urls.push(this.map._requestManager.transformRequest(d[p],l.ResourceType.Source).url);l.getVideo(this.urls,function(m,_){i._loaded=!0,m?i.fire(new l.ErrorEvent(m)):_&&(i.video=_,i.video.loop=!0,i.video.setAttribute("playsinline",""),i.video.addEventListener("playing",function(){i.map.triggerRepaint()}),i.map&&i.video.play(),i._finishLoading())})},o.prototype.pause=function(){this.video&&this.video.pause()},o.prototype.play=function(){this.video&&this.video.play()},o.prototype.seek=function(i){if(this.video){var s=this.video.seekable;i<s.start(0)||i>s.end(0)?this.fire(new l.ErrorEvent(new l.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+s.start(0)+" and "+s.end(0)+"-second mark."))):this.video.currentTime=i}},o.prototype.getVideo=function(){return this.video},o.prototype.onAdd=function(i){this.map||(this.map=i,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},o.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var i=this.map.painter.context,s=i.gl;for(var p in this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,$n.members)),this.boundsSegments||(this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new l.Texture(i,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE)),this.tiles){var d=this.tiles[p];d.state!=="loaded"&&(d.state="loaded",d.texture=this.texture)}}},o.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},o.prototype.hasTransition=function(){return this.video&&!this.video.paused},o}(Di),no=function(n){function o(i,s,p,d){n.call(this,i,s,p,d),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some(function(m){return!Array.isArray(m)||m.length!==2||m.some(function(_){return typeof _!="number"})})||this.fire(new l.ErrorEvent(new l.ValidationError("sources."+i,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.ErrorEvent(new l.ValidationError("sources."+i,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new l.ErrorEvent(new l.ValidationError("sources."+i,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof l.window.HTMLCanvasElement||this.fire(new l.ErrorEvent(new l.ValidationError("sources."+i,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.ErrorEvent(new l.ValidationError("sources."+i,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof l.window.HTMLCanvasElement?this.options.canvas:l.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},o.prototype.getCanvas=function(){return this.canvas},o.prototype.onAdd=function(i){this.map=i,this.load(),this.canvas&&this.animate&&this.play()},o.prototype.onRemove=function(){this.pause()},o.prototype.prepare=function(){var i=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,i=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,i=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var s=this.map.painter.context,p=s.gl;for(var d in this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,$n.members)),this.boundsSegments||(this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(i||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new l.Texture(s,this.canvas,p.RGBA,{premultiply:!0}),this.tiles){var m=this.tiles[d];m.state!=="loaded"&&(m.state="loaded",m.texture=this.texture)}}},o.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},o.prototype.hasTransition=function(){return this._playing},o.prototype._hasInvalidDimensions=function(){for(var i=0,s=[this.canvas.width,this.canvas.height];i<s.length;i+=1){var p=s[i];if(isNaN(p)||p<=0)return!0}return!1},o}(Di),bi={vector:vo,raster:Vn,"raster-dem":xi,geojson:Mn,video:Wn,image:Di,canvas:no};function Li(n,o){var i=l.identity([]);return l.translate(i,i,[1,1,0]),l.scale(i,i,[.5*n.width,.5*n.height,1]),l.multiply(i,i,n.calculatePosMatrix(o.toUnwrapped()))}function gn(n,o,i,s,p,d){var m=function(ee,q,Q){if(ee)for(var ae=0,me=ee;ae<me.length;ae+=1){var Ce=q[me[ae]];if(Ce&&Ce.source===Q&&Ce.type==="fill-extrusion")return!0}else for(var we in q){var Ae=q[we];if(Ae.source===Q&&Ae.type==="fill-extrusion")return!0}return!1}(p&&p.layers,o,n.id),_=d.maxPitchScaleFactor(),S=n.tilesIn(s,_,m);S.sort(wi);for(var P=[],B=0,F=S;B<F.length;B+=1){var N=F[B];P.push({wrappedTileID:N.tileID.wrapped().key,queryResults:N.tile.queryRenderedFeatures(o,i,n._state,N.queryGeometry,N.cameraQueryGeometry,N.scale,p,d,_,Li(n.transform,N.tileID))})}var H=function(ee){for(var q={},Q={},ae=0,me=ee;ae<me.length;ae+=1){var Ce=me[ae],we=Ce.queryResults,Ae=Ce.wrappedTileID,Re=Q[Ae]=Q[Ae]||{};for(var Ze in we)for(var qe=we[Ze],ct=Re[Ze]=Re[Ze]||{},Et=q[Ze]=q[Ze]||[],Ct=0,It=qe;Ct<It.length;Ct+=1){var mr=It[Ct];ct[mr.featureIndex]||(ct[mr.featureIndex]=!0,Et.push(mr))}}return q}(P);for(var W in H)H[W].forEach(function(ee){var q=ee.feature,Q=n.getFeatureState(q.layer["source-layer"],q.id);q.source=q.layer.source,q.layer["source-layer"]&&(q.sourceLayer=q.layer["source-layer"]),q.state=Q});return H}function wi(n,o){var i=n.tileID,s=o.tileID;return i.overscaledZ-s.overscaledZ||i.canonical.y-s.canonical.y||i.wrap-s.wrap||i.canonical.x-s.canonical.x}var Ke=function(n,o){this.max=n,this.onRemove=o,this.reset()};Ke.prototype.reset=function(){for(var n in this.data)for(var o=0,i=this.data[n];o<i.length;o+=1){var s=i[o];s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value)}return this.data={},this.order=[],this},Ke.prototype.add=function(n,o,i){var s=this,p=n.wrapped().key;this.data[p]===void 0&&(this.data[p]=[]);var d={value:o,timeout:void 0};if(i!==void 0&&(d.timeout=setTimeout(function(){s.remove(n,d)},i)),this.data[p].push(d),this.order.push(p),this.order.length>this.max){var m=this._getAndRemoveByKey(this.order[0]);m&&this.onRemove(m)}return this},Ke.prototype.has=function(n){return n.wrapped().key in this.data},Ke.prototype.getAndRemove=function(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null},Ke.prototype._getAndRemoveByKey=function(n){var o=this.data[n].shift();return o.timeout&&clearTimeout(o.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),o.value},Ke.prototype.getByKey=function(n){var o=this.data[n];return o?o[0].value:null},Ke.prototype.get=function(n){return this.has(n)?this.data[n.wrapped().key][0].value:null},Ke.prototype.remove=function(n,o){if(!this.has(n))return this;var i=n.wrapped().key,s=o===void 0?0:this.data[i].indexOf(o),p=this.data[i][s];return this.data[i].splice(s,1),p.timeout&&clearTimeout(p.timeout),this.data[i].length===0&&delete this.data[i],this.onRemove(p.value),this.order.splice(this.order.indexOf(i),1),this},Ke.prototype.setMaxSize=function(n){for(this.max=n;this.order.length>this.max;){var o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this},Ke.prototype.filter=function(n){var o=[];for(var i in this.data)for(var s=0,p=this.data[i];s<p.length;s+=1){var d=p[s];n(d.value)||o.push(d)}for(var m=0,_=o;m<_.length;m+=1){var S=_[m];this.remove(S.value.tileID,S)}};var wn=function(n,o,i){this.context=n;var s=n.gl;this.buffer=s.createBuffer(),this.dynamicDraw=!!i,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),s.bufferData(s.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?s.DYNAMIC_DRAW:s.STATIC_DRAW),this.dynamicDraw||delete o.arrayBuffer};wn.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},wn.prototype.updateData=function(n){var o=this.context.gl;this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)},wn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var En={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},qt=function(n,o,i,s){this.length=o.length,this.attributes=i,this.itemSize=o.bytesPerElement,this.dynamicDraw=s,this.context=n;var p=n.gl;this.buffer=p.createBuffer(),n.bindVertexBuffer.set(this.buffer),p.bufferData(p.ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete o.arrayBuffer};qt.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},qt.prototype.updateData=function(n){var o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,n.arrayBuffer)},qt.prototype.enableAttributes=function(n,o){for(var i=0;i<this.attributes.length;i++){var s=o.attributes[this.attributes[i].name];s!==void 0&&n.enableVertexAttribArray(s)}},qt.prototype.setVertexAttribPointers=function(n,o,i){for(var s=0;s<this.attributes.length;s++){var p=this.attributes[s],d=o.attributes[p.name];d!==void 0&&n.vertexAttribPointer(d,p.components,n[En[p.type]],!1,this.itemSize,p.offset+this.itemSize*(i||0))}},qt.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Wt=function(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};Wt.prototype.get=function(){return this.current},Wt.prototype.set=function(n){},Wt.prototype.getDefault=function(){return this.default},Wt.prototype.setDefault=function(){this.set(this.default)};var Ei=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){return l.Color.transparent},o.prototype.set=function(i){var s=this.current;(i.r!==s.r||i.g!==s.g||i.b!==s.b||i.a!==s.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)},o}(Wt),gr=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){return 1},o.prototype.set=function(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)},o}(Wt),jt=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){return 0},o.prototype.set=function(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)},o}(Wt),oa=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){return[!0,!0,!0,!0]},o.prototype.set=function(i){var s=this.current;(i[0]!==s[0]||i[1]!==s[1]||i[2]!==s[2]||i[3]!==s[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)},o}(Wt),Si=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){return!0},o.prototype.set=function(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)},o}(Wt),Jo=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){return 255},o.prototype.set=function(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)},o}(Wt),vn=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},o.prototype.set=function(i){var s=this.current;(i.func!==s.func||i.ref!==s.ref||i.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)},o}(Wt),zn=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){var i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]},o.prototype.set=function(i){var s=this.current;(i[0]!==s[0]||i[1]!==s[1]||i[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)},o}(Wt),br=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){return!1},o.prototype.set=function(i){if(i!==this.current||this.dirty){var s=this.gl;i?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=i,this.dirty=!1}},o}(Wt),Sn=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){return[0,1]},o.prototype.set=function(i){var s=this.current;(i[0]!==s[0]||i[1]!==s[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)},o}(Wt),Qn=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){return!1},o.prototype.set=function(i){if(i!==this.current||this.dirty){var s=this.gl;i?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=i,this.dirty=!1}},o}(Wt),Ti=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){return this.gl.LESS},o.prototype.set=function(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)},o}(Wt),un=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){return!1},o.prototype.set=function(i){if(i!==this.current||this.dirty){var s=this.gl;i?s.enable(s.BLEND):s.disable(s.BLEND),this.current=i,this.dirty=!1}},o}(Wt),Hn=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){var i=this.gl;return[i.ONE,i.ZERO]},o.prototype.set=function(i){var s=this.current;(i[0]!==s[0]||i[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(i[0],i[1]),this.current=i,this.dirty=!1)},o}(Wt),_o=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){return l.Color.transparent},o.prototype.set=function(i){var s=this.current;(i.r!==s.r||i.g!==s.g||i.b!==s.b||i.a!==s.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)},o}(Wt),Oi=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){return this.gl.FUNC_ADD},o.prototype.set=function(i){(i!==this.current||this.dirty)&&(this.gl.blendEquation(i),this.current=i,this.dirty=!1)},o}(Wt),Ri=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){return!1},o.prototype.set=function(i){if(i!==this.current||this.dirty){var s=this.gl;i?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=i,this.dirty=!1}},o}(Wt),Bi=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){return this.gl.BACK},o.prototype.set=function(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)},o}(Wt),Dn=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){return this.gl.CCW},o.prototype.set=function(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)},o}(Wt),Ii=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){return null},o.prototype.set=function(i){(i!==this.current||this.dirty)&&(this.gl.useProgram(i),this.current=i,this.dirty=!1)},o}(Wt),Fi=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){return this.gl.TEXTURE0},o.prototype.set=function(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)},o}(Wt),Ln=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){var i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]},o.prototype.set=function(i){var s=this.current;(i[0]!==s[0]||i[1]!==s[1]||i[2]!==s[2]||i[3]!==s[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)},o}(Wt),bt=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){return null},o.prototype.set=function(i){if(i!==this.current||this.dirty){var s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,i),this.current=i,this.dirty=!1}},o}(Wt),ui=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){return null},o.prototype.set=function(i){if(i!==this.current||this.dirty){var s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,i),this.current=i,this.dirty=!1}},o}(Wt),ei=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){return null},o.prototype.set=function(i){if(i!==this.current||this.dirty){var s=this.gl;s.bindTexture(s.TEXTURE_2D,i),this.current=i,this.dirty=!1}},o}(Wt),Ni=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){return null},o.prototype.set=function(i){if(i!==this.current||this.dirty){var s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}},o}(Wt),pt=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){return null},o.prototype.set=function(i){var s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1},o}(Wt),_n=function(n){function o(i){n.call(this,i),this.vao=i.extVertexArrayObject}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){return null},o.prototype.set=function(i){this.vao&&(i!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(i),this.current=i,this.dirty=!1)},o}(Wt),li=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){return 4},o.prototype.set=function(i){if(i!==this.current||this.dirty){var s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}},o}(Wt),ti=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){return!1},o.prototype.set=function(i){if(i!==this.current||this.dirty){var s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}},o}(Wt),xo=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){return!1},o.prototype.set=function(i){if(i!==this.current||this.dirty){var s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}},o}(Wt),Ar=function(n){function o(i,s){n.call(this,i),this.context=i,this.parent=s}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){return null},o}(Wt),C=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.setDirty=function(){this.dirty=!0},o.prototype.set=function(i){if(i!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}},o}(Ar),M=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.set=function(i){if(i!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,i),this.current=i,this.dirty=!1}},o}(Ar),D=function(n,o,i,s){this.context=n,this.width=o,this.height=i;var p=this.framebuffer=n.gl.createFramebuffer();this.colorAttachment=new C(n,p),s&&(this.depthAttachment=new M(n,p))};D.prototype.destroy=function(){var n=this.context.gl,o=this.colorAttachment.get();if(o&&n.deleteTexture(o),this.depthAttachment){var i=this.depthAttachment.get();i&&n.deleteRenderbuffer(i)}n.deleteFramebuffer(this.framebuffer)};var U=function(n,o,i){this.func=n,this.mask=o,this.range=i};U.ReadOnly=!1,U.ReadWrite=!0,U.disabled=new U(519,U.ReadOnly,[0,1]);var G=function(n,o,i,s,p,d){this.test=n,this.ref=o,this.mask=i,this.fail=s,this.depthFail=p,this.pass=d};G.disabled=new G({func:519,mask:0},0,0,7680,7680,7680);var ne=function(n,o,i){this.blendFunction=n,this.blendColor=o,this.mask=i};ne.disabled=new ne(ne.Replace=[1,0],l.Color.transparent,[!1,!1,!1,!1]),ne.unblended=new ne(ne.Replace,l.Color.transparent,[!0,!0,!0,!0]),ne.alphaBlended=new ne([1,771],l.Color.transparent,[!0,!0,!0,!0]);var $=function(n,o,i){this.enable=n,this.mode=o,this.frontFace=i};$.disabled=new $(!1,1029,2305),$.backCCW=new $(!0,1029,2305);var L=function(n){this.gl=n,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Ei(this),this.clearDepth=new gr(this),this.clearStencil=new jt(this),this.colorMask=new oa(this),this.depthMask=new Si(this),this.stencilMask=new Jo(this),this.stencilFunc=new vn(this),this.stencilOp=new zn(this),this.stencilTest=new br(this),this.depthRange=new Sn(this),this.depthTest=new Qn(this),this.depthFunc=new Ti(this),this.blend=new un(this),this.blendFunc=new Hn(this),this.blendColor=new _o(this),this.blendEquation=new Oi(this),this.cullFace=new Ri(this),this.cullFaceSide=new Bi(this),this.frontFace=new Dn(this),this.program=new Ii(this),this.activeTexture=new Fi(this),this.viewport=new Ln(this),this.bindFramebuffer=new bt(this),this.bindRenderbuffer=new ui(this),this.bindTexture=new ei(this),this.bindVertexBuffer=new Ni(this),this.bindElementBuffer=new pt(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new _n(this),this.pixelStoreUnpack=new li(this),this.pixelStoreUnpackPremultiplyAlpha=new ti(this),this.pixelStoreUnpackFlipY=new xo(this),this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=n.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(n.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE)};L.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},L.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},L.prototype.createIndexBuffer=function(n,o){return new wn(this,n,o)},L.prototype.createVertexBuffer=function(n,o,i){return new qt(this,n,o,i)},L.prototype.createRenderbuffer=function(n,o,i){var s=this.gl,p=s.createRenderbuffer();return this.bindRenderbuffer.set(p),s.renderbufferStorage(s.RENDERBUFFER,n,o,i),this.bindRenderbuffer.set(null),p},L.prototype.createFramebuffer=function(n,o,i){return new D(this,n,o,i)},L.prototype.clear=function(n){var o=n.color,i=n.depth,s=this.gl,p=0;o&&(p|=s.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set([!0,!0,!0,!0])),i!==void 0&&(p|=s.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(i),this.depthMask.set(!0)),s.clear(p)},L.prototype.setCullFace=function(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))},L.prototype.setDepthMode=function(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)},L.prototype.setStencilMode=function(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)},L.prototype.setColorMode=function(n){l.deepEqual(n.blendFunction,ne.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor)),this.colorMask.set(n.mask)},L.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var J=function(n){function o(i,s,p){var d=this;n.call(this),this.id=i,this.dispatcher=p,this.on("data",function(m){m.dataType==="source"&&m.sourceDataType==="metadata"&&(d._sourceLoaded=!0),d._sourceLoaded&&!d._paused&&m.dataType==="source"&&m.sourceDataType==="content"&&(d.reload(),d.transform&&d.update(d.transform))}),this.on("error",function(){d._sourceErrored=!0}),this._source=function(m,_,S,P){var B=new bi[_.type](m,_,S,P);if(B.id!==m)throw new Error("Expected Source id to be "+m+" instead of "+B.id);return l.bindAll(["load","abort","unload","serialize","prepare"],B),B}(i,s,p,this),this._tiles={},this._cache=new Ke(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new l.SourceFeatureState}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.onAdd=function(i){this.map=i,this._maxTileCacheSize=i?i._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(i)},o.prototype.onRemove=function(i){this._source&&this._source.onRemove&&this._source.onRemove(i)},o.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var i in this._tiles){var s=this._tiles[i];if(s.state!=="loaded"&&s.state!=="errored")return!1}return!0},o.prototype.getSource=function(){return this._source},o.prototype.pause=function(){this._paused=!0},o.prototype.resume=function(){if(this._paused){var i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform)}},o.prototype._loadTile=function(i,s){return this._source.loadTile(i,s)},o.prototype._unloadTile=function(i){if(this._source.unloadTile)return this._source.unloadTile(i,function(){})},o.prototype._abortTile=function(i){if(this._source.abortTile)return this._source.abortTile(i,function(){})},o.prototype.serialize=function(){return this._source.serialize()},o.prototype.prepare=function(i){for(var s in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var p=this._tiles[s];p.upload(i),p.prepare(this.map.style.imageManager)}},o.prototype.getIds=function(){return l.values(this._tiles).map(function(i){return i.tileID}).sort(se).map(function(i){return i.key})},o.prototype.getRenderableIds=function(i){var s=this,p=[];for(var d in this._tiles)this._isIdRenderable(d,i)&&p.push(this._tiles[d]);return i?p.sort(function(m,_){var S=m.tileID,P=_.tileID,B=new l.Point(S.canonical.x,S.canonical.y)._rotate(s.transform.angle),F=new l.Point(P.canonical.x,P.canonical.y)._rotate(s.transform.angle);return S.overscaledZ-P.overscaledZ||F.y-B.y||F.x-B.x}).map(function(m){return m.tileID.key}):p.map(function(m){return m.tileID}).sort(se).map(function(m){return m.key})},o.prototype.hasRenderableParent=function(i){var s=this.findLoadedParent(i,0);return!!s&&this._isIdRenderable(s.tileID.key)},o.prototype._isIdRenderable=function(i,s){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(s||!this._tiles[i].holdingForFade())},o.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var i in this._cache.reset(),this._tiles)this._tiles[i].state!=="errored"&&this._reloadTile(i,"reloading")},o.prototype._reloadTile=function(i,s){var p=this._tiles[i];p&&(p.state!=="loading"&&(p.state=s),this._loadTile(p,this._tileLoaded.bind(this,p,i,s)))},o.prototype._tileLoaded=function(i,s,p,d){if(d)return i.state="errored",void(d.status!==404?this._source.fire(new l.ErrorEvent(d,{tile:i})):this.update(this.transform));i.timeAdded=l.browser.now(),p==="expired"&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(s,i),this.getSource().type==="raster-dem"&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),this._source.fire(new l.Event("data",{dataType:"source",tile:i,coord:i.tileID}))},o.prototype._backfillDEM=function(i){for(var s=this.getRenderableIds(),p=0;p<s.length;p++){var d=s[p];if(i.neighboringTiles&&i.neighboringTiles[d]){var m=this.getTileByID(d);_(i,m),_(m,i)}}function _(S,P){S.needsHillshadePrepare=!0;var B=P.tileID.canonical.x-S.tileID.canonical.x,F=P.tileID.canonical.y-S.tileID.canonical.y,N=Math.pow(2,S.tileID.canonical.z),H=P.tileID.key;B===0&&F===0||Math.abs(F)>1||(Math.abs(B)>1&&(Math.abs(B+N)===1?B+=N:Math.abs(B-N)===1&&(B-=N)),P.dem&&S.dem&&(S.dem.backfillBorder(P.dem,B,F),S.neighboringTiles&&S.neighboringTiles[H]&&(S.neighboringTiles[H].backfilled=!0)))}},o.prototype.getTile=function(i){return this.getTileByID(i.key)},o.prototype.getTileByID=function(i){return this._tiles[i]},o.prototype._retainLoadedChildren=function(i,s,p,d){for(var m in this._tiles){var _=this._tiles[m];if(!(d[m]||!_.hasData()||_.tileID.overscaledZ<=s||_.tileID.overscaledZ>p)){for(var S=_.tileID;_&&_.tileID.overscaledZ>s+1;){var P=_.tileID.scaledTo(_.tileID.overscaledZ-1);(_=this._tiles[P.key])&&_.hasData()&&(S=P)}for(var B=S;B.overscaledZ>s;)if(i[(B=B.scaledTo(B.overscaledZ-1)).key]){d[S.key]=S;break}}}},o.prototype.findLoadedParent=function(i,s){if(i.key in this._loadedParentTiles){var p=this._loadedParentTiles[i.key];return p&&p.tileID.overscaledZ>=s?p:null}for(var d=i.overscaledZ-1;d>=s;d--){var m=i.scaledTo(d),_=this._getLoadedTile(m);if(_)return _}},o.prototype._getLoadedTile=function(i){var s=this._tiles[i.key];return s&&s.hasData()?s:this._cache.getByKey(i.wrapped().key)},o.prototype.updateCacheSize=function(i){var s=Math.ceil(i.width/this._source.tileSize)+1,p=Math.ceil(i.height/this._source.tileSize)+1,d=Math.floor(s*p*5),m=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,d):d;this._cache.setMaxSize(m)},o.prototype.handleWrapJump=function(i){var s=Math.round((i-(this._prevLng===void 0?i:this._prevLng))/360);if(this._prevLng=i,s){var p={};for(var d in this._tiles){var m=this._tiles[d];m.tileID=m.tileID.unwrapTo(m.tileID.wrap+s),p[m.tileID.key]=m}for(var _ in this._tiles=p,this._timers)clearTimeout(this._timers[_]),delete this._timers[_];for(var S in this._tiles)this._setTileReloadTimer(S,this._tiles[S])}},o.prototype.update=function(i){var s=this;if(this.transform=i,this._sourceLoaded&&!this._paused){var p;this.updateCacheSize(i),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?p=i.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(Re){return new l.OverscaledTileID(Re.canonical.z,Re.wrap,Re.canonical.z,Re.canonical.x,Re.canonical.y)}):(p=i.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(p=p.filter(function(Re){return s._source.hasTile(Re)}))):p=[];var d=i.coveringZoomLevel(this._source),m=Math.max(d-o.maxOverzooming,this._source.minzoom),_=Math.max(d+o.maxUnderzooming,this._source.minzoom),S=this._updateRetainedTiles(p,d);if(ze(this._source.type)){for(var P={},B={},F=0,N=Object.keys(S);F<N.length;F+=1){var H=N[F],W=S[H],ee=this._tiles[H];if(ee&&!(ee.fadeEndTime&&ee.fadeEndTime<=l.browser.now())){var q=this.findLoadedParent(W,m);q&&(this._addTile(q.tileID),P[q.tileID.key]=q.tileID),B[H]=W}}for(var Q in this._retainLoadedChildren(B,d,_,S),P)S[Q]||(this._coveredTiles[Q]=!0,S[Q]=P[Q])}for(var ae in S)this._tiles[ae].clearFadeHold();for(var me=0,Ce=l.keysDifference(this._tiles,S);me<Ce.length;me+=1){var we=Ce[me],Ae=this._tiles[we];Ae.hasSymbolBuckets&&!Ae.holdingForFade()?Ae.setHoldDuration(this.map._fadeDuration):Ae.hasSymbolBuckets&&!Ae.symbolFadeFinished()||this._removeTile(we)}this._updateLoadedParentTileCache()}},o.prototype.releaseSymbolFadeTiles=function(){for(var i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(i)},o.prototype._updateRetainedTiles=function(i,s){for(var p={},d={},m=Math.max(s-o.maxOverzooming,this._source.minzoom),_=Math.max(s+o.maxUnderzooming,this._source.minzoom),S={},P=0,B=i;P<B.length;P+=1){var F=B[P],N=this._addTile(F);p[F.key]=F,N.hasData()||s<this._source.maxzoom&&(S[F.key]=F)}this._retainLoadedChildren(S,s,_,p);for(var H=0,W=i;H<W.length;H+=1){var ee=W[H],q=this._tiles[ee.key];if(!q.hasData()){if(s+1>this._source.maxzoom){var Q=ee.children(this._source.maxzoom)[0],ae=this.getTile(Q);if(ae&&ae.hasData()){p[Q.key]=Q;continue}}else{var me=ee.children(this._source.maxzoom);if(p[me[0].key]&&p[me[1].key]&&p[me[2].key]&&p[me[3].key])continue}for(var Ce=q.wasRequested(),we=ee.overscaledZ-1;we>=m;--we){var Ae=ee.scaledTo(we);if(d[Ae.key]||(d[Ae.key]=!0,!(q=this.getTile(Ae))&&Ce&&(q=this._addTile(Ae)),q&&(p[Ae.key]=Ae,Ce=q.wasRequested(),q.hasData())))break}}}return p},o.prototype._updateLoadedParentTileCache=function(){for(var i in this._loadedParentTiles={},this._tiles){for(var s=[],p=void 0,d=this._tiles[i].tileID;d.overscaledZ>0;){if(d.key in this._loadedParentTiles){p=this._loadedParentTiles[d.key];break}s.push(d.key);var m=d.scaledTo(d.overscaledZ-1);if(p=this._getLoadedTile(m))break;d=m}for(var _=0,S=s;_<S.length;_+=1)this._loadedParentTiles[S[_]]=p}},o.prototype._addTile=function(i){var s=this._tiles[i.key];if(s)return s;(s=this._cache.getAndRemove(i))&&(this._setTileReloadTimer(i.key,s),s.tileID=i,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,s)));var p=!!s;return p||(s=new l.Tile(i,this._source.tileSize*i.overscaleFactor()),this._loadTile(s,this._tileLoaded.bind(this,s,i.key,s.state))),s?(s.uses++,this._tiles[i.key]=s,p||this._source.fire(new l.Event("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s):null},o.prototype._setTileReloadTimer=function(i,s){var p=this;i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);var d=s.getExpiryTimeout();d&&(this._timers[i]=setTimeout(function(){p._reloadTile(i,"expired"),delete p._timers[i]},d))},o.prototype._removeTile=function(i){var s=this._tiles[i];s&&(s.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),s.uses>0||(s.hasData()&&s.state!=="reloading"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))},o.prototype.clearTiles=function(){for(var i in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(i);this._cache.reset()},o.prototype.tilesIn=function(i,s,p){var d=this,m=[],_=this.transform;if(!_)return m;for(var S=p?_.getCameraQueryGeometry(i):i,P=i.map(function(we){return _.pointCoordinate(we)}),B=S.map(function(we){return _.pointCoordinate(we)}),F=this.getIds(),N=1/0,H=1/0,W=-1/0,ee=-1/0,q=0,Q=B;q<Q.length;q+=1){var ae=Q[q];N=Math.min(N,ae.x),H=Math.min(H,ae.y),W=Math.max(W,ae.x),ee=Math.max(ee,ae.y)}for(var me=function(we){var Ae=d._tiles[F[we]];if(!Ae.holdingForFade()){var Re=Ae.tileID,Ze=Math.pow(2,_.zoom-Ae.tileID.overscaledZ),qe=s*Ae.queryPadding*l.EXTENT/Ae.tileSize/Ze,ct=[Re.getTilePoint(new l.MercatorCoordinate(N,H)),Re.getTilePoint(new l.MercatorCoordinate(W,ee))];if(ct[0].x-qe<l.EXTENT&&ct[0].y-qe<l.EXTENT&&ct[1].x+qe>=0&&ct[1].y+qe>=0){var Et=P.map(function(It){return Re.getTilePoint(It)}),Ct=B.map(function(It){return Re.getTilePoint(It)});m.push({tile:Ae,tileID:Re,queryGeometry:Et,cameraQueryGeometry:Ct,scale:Ze})}}},Ce=0;Ce<F.length;Ce++)me(Ce);return m},o.prototype.getVisibleCoordinates=function(i){for(var s=this,p=this.getRenderableIds(i).map(function(S){return s._tiles[S].tileID}),d=0,m=p;d<m.length;d+=1){var _=m[d];_.posMatrix=this.transform.calculatePosMatrix(_.toUnwrapped())}return p},o.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(ze(this._source.type))for(var i in this._tiles){var s=this._tiles[i];if(s.fadeEndTime!==void 0&&s.fadeEndTime>=l.browser.now())return!0}return!1},o.prototype.setFeatureState=function(i,s,p){this._state.updateState(i=i||"_geojsonTileLayer",s,p)},o.prototype.removeFeatureState=function(i,s,p){this._state.removeFeatureState(i=i||"_geojsonTileLayer",s,p)},o.prototype.getFeatureState=function(i,s){return this._state.getState(i=i||"_geojsonTileLayer",s)},o.prototype.setDependencies=function(i,s,p){var d=this._tiles[i];d&&d.setDependencies(s,p)},o.prototype.reloadTilesForDependencies=function(i,s){for(var p in this._tiles)this._tiles[p].hasDependency(i,s)&&this._reloadTile(p,"reloading");this._cache.filter(function(d){return!d.hasDependency(i,s)})},o}(l.Evented);function se(n,o){var i=Math.abs(2*n.wrap)-+(n.wrap<0),s=Math.abs(2*o.wrap)-+(o.wrap<0);return n.overscaledZ-o.overscaledZ||s-i||o.canonical.y-n.canonical.y||o.canonical.x-n.canonical.x}function ze(n){return n==="raster"||n==="image"||n==="video"}function Be(){return new l.window.Worker(Qs.workerUrl)}J.maxOverzooming=10,J.maxUnderzooming=3;var Ee="mapboxgl_preloaded_worker_pool",ke=function(){this.active={}};ke.prototype.acquire=function(n){if(!this.workers)for(this.workers=[];this.workers.length<ke.workerCount;)this.workers.push(new Be);return this.active[n]=!0,this.workers.slice()},ke.prototype.release=function(n){delete this.active[n],this.numActive()===0&&(this.workers.forEach(function(o){o.terminate()}),this.workers=null)},ke.prototype.isPreloaded=function(){return!!this.active[Ee]},ke.prototype.numActive=function(){return Object.keys(this.active).length};var ot,We=Math.floor(l.browser.hardwareConcurrency/2);function Se(){return ot||(ot=new ke),ot}function it(n,o){var i={};for(var s in n)s!=="ref"&&(i[s]=n[s]);return l.refProperties.forEach(function(p){p in o&&(i[p]=o[p])}),i}function je(n){n=n.slice();for(var o=Object.create(null),i=0;i<n.length;i++)o[n[i].id]=n[i];for(var s=0;s<n.length;s++)"ref"in n[s]&&(n[s]=it(n[s],o[n[s].ref]));return n}ke.workerCount=Math.max(Math.min(We,6),1);var Ye={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Bt(n,o,i){i.push({command:Ye.addSource,args:[n,o[n]]})}function et(n,o,i){o.push({command:Ye.removeSource,args:[n]}),i[n]=!0}function Yt(n,o,i,s){et(n,i,s),Bt(n,o,i)}function Nt(n,o,i){var s;for(s in n[i])if(n[i].hasOwnProperty(s)&&s!=="data"&&!l.deepEqual(n[i][s],o[i][s]))return!1;for(s in o[i])if(o[i].hasOwnProperty(s)&&s!=="data"&&!l.deepEqual(n[i][s],o[i][s]))return!1;return!0}function Ut(n,o,i,s,p,d){var m;for(m in o=o||{},n=n||{})n.hasOwnProperty(m)&&(l.deepEqual(n[m],o[m])||i.push({command:d,args:[s,m,o[m],p]}));for(m in o)o.hasOwnProperty(m)&&!n.hasOwnProperty(m)&&(l.deepEqual(n[m],o[m])||i.push({command:d,args:[s,m,o[m],p]}))}function Ht(n){return n.id}function rr(n,o){return n[o.id]=o,n}var Hr=function(n,o){this.reset(n,o)};Hr.prototype.reset=function(n,o){this.points=n||[],this._distances=[0];for(var i=1;i<this.points.length;i++)this._distances[i]=this._distances[i-1]+this.points[i].dist(this.points[i-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,.5*this.length),this.paddedLength=this.length-2*this.padding},Hr.prototype.lerp=function(n){if(this.points.length===1)return this.points[0];n=l.clamp(n,0,1);for(var o=1,i=this._distances[o],s=n*this.paddedLength+this.padding;i<s&&o<this._distances.length;)i=this._distances[++o];var p=o-1,d=this._distances[p],m=i-d,_=m>0?(s-d)/m:0;return this.points[p].mult(1-_).add(this.points[o].mult(_))};var cr=function(n,o,i){var s=this.boxCells=[],p=this.circleCells=[];this.xCellCount=Math.ceil(n/i),this.yCellCount=Math.ceil(o/i);for(var d=0;d<this.xCellCount*this.yCellCount;d++)s.push([]),p.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=o,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/o,this.boxUid=0,this.circleUid=0};function zr(n,o,i,s,p){var d=l.create();return o?(l.scale(d,d,[1/p,1/p,1]),i||l.rotateZ(d,d,s.angle)):l.multiply(d,s.labelPlaneMatrix,n),d}function vr(n,o,i,s,p){if(o){var d=l.clone(n);return l.scale(d,d,[p,p,1]),i||l.rotateZ(d,d,-s.angle),d}return s.glCoordMatrix}function Zt(n,o){var i=[n.x,n.y,0,1];Ve(i,i,o);var s=i[3];return{point:new l.Point(i[0]/s,i[1]/s),signedDistanceFromCamera:s}}function pr(n,o){return .5+n/o*.5}function Jr(n,o){var i=n[0]/n[3],s=n[1]/n[3];return i>=-o[0]&&i<=o[0]&&s>=-o[1]&&s<=o[1]}function v(n,o,i,s,p,d,m,_){var S=s?n.textSizeData:n.iconSizeData,P=l.evaluateSizeForZoom(S,i.transform.zoom),B=[256/i.width*2+1,256/i.height*2+1],F=s?n.text.dynamicLayoutVertexArray:n.icon.dynamicLayoutVertexArray;F.clear();for(var N=n.lineVertexArray,H=s?n.text.placedSymbolArray:n.icon.placedSymbolArray,W=i.transform.width/i.transform.height,ee=!1,q=0;q<H.length;q++){var Q=H.get(q);if(Q.hidden||Q.writingMode===l.WritingMode.vertical&&!ee)Ge(Q.numGlyphs,F);else{ee=!1;var ae=[Q.anchorX,Q.anchorY,0,1];if(l.transformMat4(ae,ae,o),Jr(ae,B)){var me=pr(i.transform.cameraToCenterDistance,ae[3]),Ce=l.evaluateSizeForFeature(S,P,Q),we=m?Ce/me:Ce*me,Ae=new l.Point(Q.anchorX,Q.anchorY),Re=Zt(Ae,p).point,Ze={},qe=be(Q,we,!1,_,o,p,d,n.glyphOffsetArray,N,F,Re,Ae,Ze,W);ee=qe.useVertical,(qe.notEnoughRoom||ee||qe.needsFlipping&&be(Q,we,!0,_,o,p,d,n.glyphOffsetArray,N,F,Re,Ae,Ze,W).notEnoughRoom)&&Ge(Q.numGlyphs,F)}else Ge(Q.numGlyphs,F)}}s?n.text.dynamicLayoutVertexBuffer.updateData(F):n.icon.dynamicLayoutVertexBuffer.updateData(F)}function E(n,o,i,s,p,d,m,_,S,P,B){var F=_.glyphStartIndex+_.numGlyphs,N=_.lineStartIndex,H=_.lineStartIndex+_.lineLength,W=o.getoffsetX(_.glyphStartIndex),ee=o.getoffsetX(F-1),q=V(n*W,i,s,p,d,m,_.segment,N,H,S,P,B);if(!q)return null;var Q=V(n*ee,i,s,p,d,m,_.segment,N,H,S,P,B);return Q?{first:q,last:Q}:null}function j(n,o,i,s){return n===l.WritingMode.horizontal&&Math.abs(i.y-o.y)>Math.abs(i.x-o.x)*s?{useVertical:!0}:(n===l.WritingMode.vertical?o.y<i.y:o.x>i.x)?{needsFlipping:!0}:null}function be(n,o,i,s,p,d,m,_,S,P,B,F,N,H){var W,ee=o/24,q=n.lineOffsetX*ee,Q=n.lineOffsetY*ee;if(n.numGlyphs>1){var ae=n.glyphStartIndex+n.numGlyphs,me=n.lineStartIndex,Ce=n.lineStartIndex+n.lineLength,we=E(ee,_,q,Q,i,B,F,n,S,d,N);if(!we)return{notEnoughRoom:!0};var Ae=Zt(we.first.point,m).point,Re=Zt(we.last.point,m).point;if(s&&!i){var Ze=j(n.writingMode,Ae,Re,H);if(Ze)return Ze}W=[we.first];for(var qe=n.glyphStartIndex+1;qe<ae-1;qe++)W.push(V(ee*_.getoffsetX(qe),q,Q,i,B,F,n.segment,me,Ce,S,d,N));W.push(we.last)}else{if(s&&!i){var ct=Zt(F,p).point,Et=n.lineStartIndex+n.segment+1,Ct=new l.Point(S.getx(Et),S.gety(Et)),It=Zt(Ct,p),mr=It.signedDistanceFromCamera>0?It.point:ue(F,Ct,ct,1,p),dt=j(n.writingMode,ct,mr,H);if(dt)return dt}var Vt=V(ee*_.getoffsetX(n.glyphStartIndex),q,Q,i,B,F,n.segment,n.lineStartIndex,n.lineStartIndex+n.lineLength,S,d,N);if(!Vt)return{notEnoughRoom:!0};W=[Vt]}for(var Jt=0,Ft=W;Jt<Ft.length;Jt+=1){var Ot=Ft[Jt];l.addDynamicAttributes(P,Ot.point,Ot.angle)}return{}}function ue(n,o,i,s,p){var d=Zt(n.add(n.sub(o)._unit()),p).point,m=i.sub(d);return i.add(m._mult(s/m.mag()))}function V(n,o,i,s,p,d,m,_,S,P,B,F){var N=s?n-o:n+o,H=N>0?1:-1,W=0;s&&(H*=-1,W=Math.PI),H<0&&(W+=Math.PI);for(var ee=H>0?_+m:_+m+1,q=p,Q=p,ae=0,me=0,Ce=Math.abs(N),we=[];ae+me<=Ce;){if((ee+=H)<_||ee>=S)return null;if(Q=q,we.push(q),(q=F[ee])===void 0){var Ae=new l.Point(P.getx(ee),P.gety(ee)),Re=Zt(Ae,B);if(Re.signedDistanceFromCamera>0)q=F[ee]=Re.point;else{var Ze=ee-H;q=ue(ae===0?d:new l.Point(P.getx(Ze),P.gety(Ze)),Ae,Q,Ce-ae+1,B)}}ae+=me,me=Q.dist(q)}var qe=(Ce-ae)/me,ct=q.sub(Q),Et=ct.mult(qe)._add(Q);Et._add(ct._unit()._perp()._mult(i*H));var Ct=W+Math.atan2(q.y-Q.y,q.x-Q.x);return we.push(Et),{point:Et,angle:Ct,path:we}}cr.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},cr.prototype.insert=function(n,o,i,s,p){this._forEachCell(o,i,s,p,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(o),this.bboxes.push(i),this.bboxes.push(s),this.bboxes.push(p)},cr.prototype.insertCircle=function(n,o,i,s){this._forEachCell(o-s,i-s,o+s,i+s,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(o),this.circles.push(i),this.circles.push(s)},cr.prototype._insertBoxCell=function(n,o,i,s,p,d){this.boxCells[p].push(d)},cr.prototype._insertCircleCell=function(n,o,i,s,p,d){this.circleCells[p].push(d)},cr.prototype._query=function(n,o,i,s,p,d){if(i<0||n>this.width||s<0||o>this.height)return!p&&[];var m=[];if(n<=0&&o<=0&&this.width<=i&&this.height<=s){if(p)return!0;for(var _=0;_<this.boxKeys.length;_++)m.push({key:this.boxKeys[_],x1:this.bboxes[4*_],y1:this.bboxes[4*_+1],x2:this.bboxes[4*_+2],y2:this.bboxes[4*_+3]});for(var S=0;S<this.circleKeys.length;S++){var P=this.circles[3*S],B=this.circles[3*S+1],F=this.circles[3*S+2];m.push({key:this.circleKeys[S],x1:P-F,y1:B-F,x2:P+F,y2:B+F})}return d?m.filter(d):m}return this._forEachCell(n,o,i,s,this._queryCell,m,{hitTest:p,seenUids:{box:{},circle:{}}},d),p?m.length>0:m},cr.prototype._queryCircle=function(n,o,i,s,p){var d=n-i,m=n+i,_=o-i,S=o+i;if(m<0||d>this.width||S<0||_>this.height)return!s&&[];var P=[];return this._forEachCell(d,_,m,S,this._queryCellCircle,P,{hitTest:s,circle:{x:n,y:o,radius:i},seenUids:{box:{},circle:{}}},p),s?P.length>0:P},cr.prototype.query=function(n,o,i,s,p){return this._query(n,o,i,s,!1,p)},cr.prototype.hitTest=function(n,o,i,s,p){return this._query(n,o,i,s,!0,p)},cr.prototype.hitTestCircle=function(n,o,i,s){return this._queryCircle(n,o,i,!0,s)},cr.prototype._queryCell=function(n,o,i,s,p,d,m,_){var S=m.seenUids,P=this.boxCells[p];if(P!==null)for(var B=this.bboxes,F=0,N=P;F<N.length;F+=1){var H=N[F];if(!S.box[H]){S.box[H]=!0;var W=4*H;if(n<=B[W+2]&&o<=B[W+3]&&i>=B[W+0]&&s>=B[W+1]&&(!_||_(this.boxKeys[H]))){if(m.hitTest)return d.push(!0),!0;d.push({key:this.boxKeys[H],x1:B[W],y1:B[W+1],x2:B[W+2],y2:B[W+3]})}}}var ee=this.circleCells[p];if(ee!==null)for(var q=this.circles,Q=0,ae=ee;Q<ae.length;Q+=1){var me=ae[Q];if(!S.circle[me]){S.circle[me]=!0;var Ce=3*me;if(this._circleAndRectCollide(q[Ce],q[Ce+1],q[Ce+2],n,o,i,s)&&(!_||_(this.circleKeys[me]))){if(m.hitTest)return d.push(!0),!0;var we=q[Ce],Ae=q[Ce+1],Re=q[Ce+2];d.push({key:this.circleKeys[me],x1:we-Re,y1:Ae-Re,x2:we+Re,y2:Ae+Re})}}}},cr.prototype._queryCellCircle=function(n,o,i,s,p,d,m,_){var S=m.circle,P=m.seenUids,B=this.boxCells[p];if(B!==null)for(var F=this.bboxes,N=0,H=B;N<H.length;N+=1){var W=H[N];if(!P.box[W]){P.box[W]=!0;var ee=4*W;if(this._circleAndRectCollide(S.x,S.y,S.radius,F[ee+0],F[ee+1],F[ee+2],F[ee+3])&&(!_||_(this.boxKeys[W])))return d.push(!0),!0}}var q=this.circleCells[p];if(q!==null)for(var Q=this.circles,ae=0,me=q;ae<me.length;ae+=1){var Ce=me[ae];if(!P.circle[Ce]){P.circle[Ce]=!0;var we=3*Ce;if(this._circlesCollide(Q[we],Q[we+1],Q[we+2],S.x,S.y,S.radius)&&(!_||_(this.circleKeys[Ce])))return d.push(!0),!0}}},cr.prototype._forEachCell=function(n,o,i,s,p,d,m,_){for(var S=this._convertToXCellCoord(n),P=this._convertToYCellCoord(o),B=this._convertToXCellCoord(i),F=this._convertToYCellCoord(s),N=S;N<=B;N++)for(var H=P;H<=F;H++)if(p.call(this,n,o,i,s,this.xCellCount*H+N,d,m,_))return},cr.prototype._convertToXCellCoord=function(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))},cr.prototype._convertToYCellCoord=function(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))},cr.prototype._circlesCollide=function(n,o,i,s,p,d){var m=s-n,_=p-o,S=i+d;return S*S>m*m+_*_},cr.prototype._circleAndRectCollide=function(n,o,i,s,p,d,m){var _=(d-s)/2,S=Math.abs(n-(s+_));if(S>_+i)return!1;var P=(m-p)/2,B=Math.abs(o-(p+P));if(B>P+i)return!1;if(S<=_||B<=P)return!0;var F=S-_,N=B-P;return F*F+N*N<=i*i};var Ne=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ge(n,o){for(var i=0;i<n;i++){var s=o.length;o.resize(s+4),o.float32.set(Ne,3*s)}}function Ve(n,o,i){var s=o[0],p=o[1];return n[0]=i[0]*s+i[4]*p+i[12],n[1]=i[1]*s+i[5]*p+i[13],n[3]=i[3]*s+i[7]*p+i[15],n}var Le=function(n,o,i){o===void 0&&(o=new cr(n.width+200,n.height+200,25)),i===void 0&&(i=new cr(n.width+200,n.height+200,25)),this.transform=n,this.grid=o,this.ignoredGrid=i,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+100,this.screenBottomBoundary=n.height+100,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200};function st(n,o,i){return o*(l.EXTENT/(n.tileSize*Math.pow(2,i-n.tileID.overscaledZ)))}Le.prototype.placeCollisionBox=function(n,o,i,s,p){var d=this.projectAndGetPerspectiveRatio(s,n.anchorPointX,n.anchorPointY),m=i*d.perspectiveRatio,_=n.x1*m+d.point.x,S=n.y1*m+d.point.y,P=n.x2*m+d.point.x,B=n.y2*m+d.point.y;return!this.isInsideGrid(_,S,P,B)||!o&&this.grid.hitTest(_,S,P,B,p)?{box:[],offscreen:!1}:{box:[_,S,P,B],offscreen:this.isOffscreen(_,S,P,B)}},Le.prototype.placeCollisionCircles=function(n,o,i,s,p,d,m,_,S,P,B,F,N){var H=[],W=new l.Point(o.anchorX,o.anchorY),ee=Zt(W,d),q=pr(this.transform.cameraToCenterDistance,ee.signedDistanceFromCamera),Q=(P?p/q:p*q)/l.ONE_EM,ae=Zt(W,m).point,me=E(Q,s,o.lineOffsetX*Q,o.lineOffsetY*Q,!1,ae,W,o,i,m,{}),Ce=!1,we=!1,Ae=!0;if(me){for(var Re=.5*F*q+N,Ze=new l.Point(-100,-100),qe=new l.Point(this.screenRightBoundary,this.screenBottomBoundary),ct=new Hr,Et=me.first,Ct=me.last,It=[],mr=Et.path.length-1;mr>=1;mr--)It.push(Et.path[mr]);for(var dt=1;dt<Ct.path.length;dt++)It.push(Ct.path[dt]);var Vt=2.5*Re;if(_){var Jt=It.map(function(fo){return Zt(fo,_)});It=Jt.some(function(fo){return fo.signedDistanceFromCamera<=0})?[]:Jt.map(function(fo){return fo.point})}var Ft=[];if(It.length>0){for(var Ot=It[0].clone(),Xt=It[0].clone(),zt=1;zt<It.length;zt++)Ot.x=Math.min(Ot.x,It[zt].x),Ot.y=Math.min(Ot.y,It[zt].y),Xt.x=Math.max(Xt.x,It[zt].x),Xt.y=Math.max(Xt.y,It[zt].y);Ft=Ot.x>=Ze.x&&Xt.x<=qe.x&&Ot.y>=Ze.y&&Xt.y<=qe.y?[It]:Xt.x<Ze.x||Ot.x>qe.x||Xt.y<Ze.y||Ot.y>qe.y?[]:l.clipLine([It],Ze.x,Ze.y,qe.x,qe.y)}for(var kt=0,On=Ft;kt<On.length;kt+=1){var on;ct.reset(On[kt],.25*Re),on=ct.length<=.5*Re?1:Math.ceil(ct.paddedLength/Vt)+1;for(var ii=0;ii<on;ii++){var Zn=ii/Math.max(on-1,1),Yr=ct.lerp(Zn),hn=Yr.x+100,Xi=Yr.y+100;H.push(hn,Xi,Re,0);var di=hn-Re,ga=Xi-Re,Ai=hn+Re,Ro=Xi+Re;if(Ae=Ae&&this.isOffscreen(di,ga,Ai,Ro),we=we||this.isInsideGrid(di,ga,Ai,Ro),!n&&this.grid.hitTestCircle(hn,Xi,Re,B)&&(Ce=!0,!S))return{circles:[],offscreen:!1,collisionDetected:Ce}}}}return{circles:!S&&Ce||!we?[]:H,offscreen:Ae,collisionDetected:Ce}},Le.prototype.queryRenderedSymbols=function(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var o=[],i=1/0,s=1/0,p=-1/0,d=-1/0,m=0,_=n;m<_.length;m+=1){var S=_[m],P=new l.Point(S.x+100,S.y+100);i=Math.min(i,P.x),s=Math.min(s,P.y),p=Math.max(p,P.x),d=Math.max(d,P.y),o.push(P)}for(var B={},F={},N=0,H=this.grid.query(i,s,p,d).concat(this.ignoredGrid.query(i,s,p,d));N<H.length;N+=1){var W=H[N],ee=W.key;if(B[ee.bucketInstanceId]===void 0&&(B[ee.bucketInstanceId]={}),!B[ee.bucketInstanceId][ee.featureIndex]){var q=[new l.Point(W.x1,W.y1),new l.Point(W.x2,W.y1),new l.Point(W.x2,W.y2),new l.Point(W.x1,W.y2)];l.polygonIntersectsPolygon(o,q)&&(B[ee.bucketInstanceId][ee.featureIndex]=!0,F[ee.bucketInstanceId]===void 0&&(F[ee.bucketInstanceId]=[]),F[ee.bucketInstanceId].push(ee.featureIndex))}}return F},Le.prototype.insertCollisionBox=function(n,o,i,s,p){(o?this.ignoredGrid:this.grid).insert({bucketInstanceId:i,featureIndex:s,collisionGroupID:p},n[0],n[1],n[2],n[3])},Le.prototype.insertCollisionCircles=function(n,o,i,s,p){for(var d=o?this.ignoredGrid:this.grid,m={bucketInstanceId:i,featureIndex:s,collisionGroupID:p},_=0;_<n.length;_+=4)d.insertCircle(m,n[_],n[_+1],n[_+2])},Le.prototype.projectAndGetPerspectiveRatio=function(n,o,i){var s=[o,i,0,1];return Ve(s,s,n),{point:new l.Point((s[0]/s[3]+1)/2*this.transform.width+100,(-s[1]/s[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/s[3]*.5}},Le.prototype.isOffscreen=function(n,o,i,s){return i<100||n>=this.screenRightBoundary||s<100||o>this.screenBottomBoundary},Le.prototype.isInsideGrid=function(n,o,i,s){return i>=0&&n<this.gridRightBoundary&&s>=0&&o<this.gridBottomBoundary},Le.prototype.getViewportMatrix=function(){var n=l.identity([]);return l.translate(n,n,[-100,-100,0]),n};var At=function(n,o,i,s){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?o:-o))):s&&i?1:0,this.placed=i};At.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var er=function(n,o,i,s,p){this.text=new At(n?n.text:null,o,i,p),this.icon=new At(n?n.icon:null,o,s,p)};er.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var Tn=function(n,o,i){this.text=n,this.icon=o,this.skipFade=i},Dr=function(){this.invProjMatrix=l.create(),this.viewportMatrix=l.create(),this.circles=[]},Fe=function(n,o,i,s,p){this.bucketInstanceId=n,this.featureIndex=o,this.sourceLayerIndex=i,this.bucketIndex=s,this.tileID=p},yt=function(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}};function Kt(n,o,i,s,p){var d=l.getAnchorAlignment(n),m=-(d.horizontalAlign-.5)*o,_=-(d.verticalAlign-.5)*i,S=l.evaluateVariableOffset(n,s);return new l.Point(m+S[0]*p,_+S[1]*p)}function Dt(n,o,i,s,p,d){var m=n.x1,_=n.x2,S=n.y1,P=n.y2,B=n.anchorPointX,F=n.anchorPointY,N=new l.Point(o,i);return s&&N._rotate(p?d:-d),{x1:m+N.x,y1:S+N.y,x2:_+N.x,y2:P+N.y,anchorPointX:B,anchorPointY:F}}yt.prototype.get=function(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){var o=++this.maxGroupID;this.collisionGroups[n]={ID:o,predicate:function(i){return i.collisionGroupID===o}}}return this.collisionGroups[n]};var jr=function(n,o,i,s){this.transform=n.clone(),this.collisionIndex=new Le(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=o,this.retainedQueryData={},this.collisionGroups=new yt(i),this.collisionCircleArrays={},this.prevPlacement=s,s&&(s.prevPlacement=void 0),this.placedOrientations={}};function Ui(n,o,i,s,p){n.emplaceBack(o?1:0,i?1:0,s||0,p||0),n.emplaceBack(o?1:0,i?1:0,s||0,p||0),n.emplaceBack(o?1:0,i?1:0,s||0,p||0),n.emplaceBack(o?1:0,i?1:0,s||0,p||0)}jr.prototype.getBucketParts=function(n,o,i,s){var p=i.getBucket(o),d=i.latestFeatureIndex;if(p&&d&&o.id===p.layerIds[0]){var m=i.collisionBoxArray,_=p.layers[0].layout,S=Math.pow(2,this.transform.zoom-i.tileID.overscaledZ),P=i.tileSize/l.EXTENT,B=this.transform.calculatePosMatrix(i.tileID.toUnwrapped()),F=_.get("text-pitch-alignment")==="map",N=_.get("text-rotation-alignment")==="map",H=st(i,1,this.transform.zoom),W=zr(B,F,N,this.transform,H),ee=null;if(F){var q=vr(B,F,N,this.transform,H);ee=l.multiply([],this.transform.labelPlaneMatrix,q)}this.retainedQueryData[p.bucketInstanceId]=new Fe(p.bucketInstanceId,d,p.sourceLayerIndex,p.index,i.tileID);var Q={bucket:p,layout:_,posMatrix:B,textLabelPlaneMatrix:W,labelToScreenMatrix:ee,scale:S,textPixelRatio:P,holdingForFade:i.holdingForFade(),collisionBoxArray:m,partiallyEvaluatedTextSize:l.evaluateSizeForZoom(p.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(p.sourceID)};if(s)for(var ae=0,me=p.sortKeyRanges;ae<me.length;ae+=1){var Ce=me[ae];n.push({sortKey:Ce.sortKey,symbolInstanceStart:Ce.symbolInstanceStart,symbolInstanceEnd:Ce.symbolInstanceEnd,parameters:Q})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:p.symbolInstances.length,parameters:Q})}},jr.prototype.attemptAnchorPlacement=function(n,o,i,s,p,d,m,_,S,P,B,F,N,H,W){var ee,q=[F.textOffset0,F.textOffset1],Q=Kt(n,i,s,q,p),ae=this.collisionIndex.placeCollisionBox(Dt(o,Q.x,Q.y,d,m,this.transform.angle),B,_,S,P.predicate);if(!W||this.collisionIndex.placeCollisionBox(Dt(W,Q.x,Q.y,d,m,this.transform.angle),B,_,S,P.predicate).box.length!==0)return ae.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[F.crossTileID]&&this.prevPlacement.placements[F.crossTileID]&&this.prevPlacement.placements[F.crossTileID].text&&(ee=this.prevPlacement.variableOffsets[F.crossTileID].anchor),this.variableOffsets[F.crossTileID]={textOffset:q,width:i,height:s,anchor:n,textBoxScale:p,prevAnchor:ee},this.markUsedJustification(N,n,F,H),N.allowVerticalPlacement&&(this.markUsedOrientation(N,H,F),this.placedOrientations[F.crossTileID]=H),{shift:Q,placedGlyphBoxes:ae}):void 0},jr.prototype.placeLayerBucketPart=function(n,o,i){var s=this,p=n.parameters,d=p.bucket,m=p.layout,_=p.posMatrix,S=p.textLabelPlaneMatrix,P=p.labelToScreenMatrix,B=p.textPixelRatio,F=p.holdingForFade,N=p.collisionBoxArray,H=p.partiallyEvaluatedTextSize,W=p.collisionGroup,ee=m.get("text-optional"),q=m.get("icon-optional"),Q=m.get("text-allow-overlap"),ae=m.get("icon-allow-overlap"),me=m.get("text-rotation-alignment")==="map",Ce=m.get("text-pitch-alignment")==="map",we=m.get("icon-text-fit")!=="none",Ae=m.get("symbol-z-order")==="viewport-y",Re=Q&&(ae||!d.hasIconData()||q),Ze=ae&&(Q||!d.hasTextData()||ee);!d.collisionArrays&&N&&d.deserializeCollisionBoxes(N);var qe=function(dt,Vt){if(!o[dt.crossTileID])if(F)s.placements[dt.crossTileID]=new Tn(!1,!1,!1);else{var Jt,Ft=!1,Ot=!1,Xt=!0,zt=null,kt={box:null,offscreen:null},On={box:null,offscreen:null},on=null,ii=null,Zn=0,Yr=0,hn=0;Vt.textFeatureIndex?Zn=Vt.textFeatureIndex:dt.useRuntimeCollisionCircles&&(Zn=dt.featureIndex),Vt.verticalTextFeatureIndex&&(Yr=Vt.verticalTextFeatureIndex);var Xi=Vt.textBox;if(Xi){var di=function(Er){var to=l.WritingMode.horizontal;if(d.allowVerticalPlacement&&!Er&&s.prevPlacement){var Pi=s.prevPlacement.placedOrientations[dt.crossTileID];Pi&&(s.placedOrientations[dt.crossTileID]=Pi,s.markUsedOrientation(d,to=Pi,dt))}return to},ga=function(Er,to){if(d.allowVerticalPlacement&&dt.numVerticalGlyphVertices>0&&Vt.verticalTextBox)for(var Pi=0,Na=d.writingModes;Pi<Na.length&&(Na[Pi]===l.WritingMode.vertical?(kt=to(),On=kt):kt=Er(),!(kt&&kt.box&&kt.box.length));Pi+=1);else kt=Er()};if(m.get("text-variable-anchor")){var Ai=m.get("text-variable-anchor");if(s.prevPlacement&&s.prevPlacement.variableOffsets[dt.crossTileID]){var Ro=s.prevPlacement.variableOffsets[dt.crossTileID];Ai.indexOf(Ro.anchor)>0&&(Ai=Ai.filter(function(Er){return Er!==Ro.anchor})).unshift(Ro.anchor)}var fo=function(Er,to,Pi){for(var Na=Er.x2-Er.x1,Kl=Er.y2-Er.y1,eu=dt.textBoxScale,Xl=we&&!ae?to:null,Ps={box:[],offscreen:!1},hl=Q?2*Ai.length:Ai.length,ss=0;ss<hl;++ss){var tu=s.attemptAnchorPlacement(Ai[ss%Ai.length],Er,Na,Kl,eu,me,Ce,B,_,W,ss>=Ai.length,dt,d,Pi,Xl);if(tu&&(Ps=tu.placedGlyphBoxes)&&Ps.box&&Ps.box.length){Ft=!0,zt=tu.shift;break}}return Ps};ga(function(){return fo(Xi,Vt.iconBox,l.WritingMode.horizontal)},function(){var Er=Vt.verticalTextBox;return d.allowVerticalPlacement&&!(kt&&kt.box&&kt.box.length)&&dt.numVerticalGlyphVertices>0&&Er?fo(Er,Vt.verticalIconBox,l.WritingMode.vertical):{box:null,offscreen:null}}),kt&&(Ft=kt.box,Xt=kt.offscreen);var Is=di(kt&&kt.box);if(!Ft&&s.prevPlacement){var os=s.prevPlacement.variableOffsets[dt.crossTileID];os&&(s.variableOffsets[dt.crossTileID]=os,s.markUsedJustification(d,os.anchor,dt,Is))}}else{var va=function(Er,to){var Pi=s.collisionIndex.placeCollisionBox(Er,Q,B,_,W.predicate);return Pi&&Pi.box&&Pi.box.length&&(s.markUsedOrientation(d,to,dt),s.placedOrientations[dt.crossTileID]=to),Pi};ga(function(){return va(Xi,l.WritingMode.horizontal)},function(){var Er=Vt.verticalTextBox;return d.allowVerticalPlacement&&dt.numVerticalGlyphVertices>0&&Er?va(Er,l.WritingMode.vertical):{box:null,offscreen:null}}),di(kt&&kt.box&&kt.box.length)}}if(Ft=(Jt=kt)&&Jt.box&&Jt.box.length>0,Xt=Jt&&Jt.offscreen,dt.useRuntimeCollisionCircles){var as=d.text.placedSymbolArray.get(dt.centerJustifiedTextSymbolIndex),Cs=l.evaluateSizeForFeature(d.textSizeData,H,as),Xo=m.get("text-padding");on=s.collisionIndex.placeCollisionCircles(Q,as,d.lineVertexArray,d.glyphOffsetArray,Cs,_,S,P,i,Ce,W.predicate,dt.collisionCircleDiameter,Xo),Ft=Q||on.circles.length>0&&!on.collisionDetected,Xt=Xt&&on.offscreen}if(Vt.iconFeatureIndex&&(hn=Vt.iconFeatureIndex),Vt.iconBox){var As=function(Er){var to=we&&zt?Dt(Er,zt.x,zt.y,me,Ce,s.transform.angle):Er;return s.collisionIndex.placeCollisionBox(to,ae,B,_,W.predicate)};Ot=On&&On.box&&On.box.length&&Vt.verticalIconBox?(ii=As(Vt.verticalIconBox)).box.length>0:(ii=As(Vt.iconBox)).box.length>0,Xt=Xt&&ii.offscreen}var Wo=ee||dt.numHorizontalGlyphVertices===0&&dt.numVerticalGlyphVertices===0,Rn=q||dt.numIconVertices===0;if(Wo||Rn?Rn?Wo||(Ot=Ot&&Ft):Ft=Ot&&Ft:Ot=Ft=Ot&&Ft,Ft&&Jt&&Jt.box&&s.collisionIndex.insertCollisionBox(Jt.box,m.get("text-ignore-placement"),d.bucketInstanceId,On&&On.box&&Yr?Yr:Zn,W.ID),Ot&&ii&&s.collisionIndex.insertCollisionBox(ii.box,m.get("icon-ignore-placement"),d.bucketInstanceId,hn,W.ID),on&&(Ft&&s.collisionIndex.insertCollisionCircles(on.circles,m.get("text-ignore-placement"),d.bucketInstanceId,Zn,W.ID),i)){var ta=d.bucketInstanceId,_a=s.collisionCircleArrays[ta];_a===void 0&&(_a=s.collisionCircleArrays[ta]=new Dr);for(var Fa=0;Fa<on.circles.length;Fa+=4)_a.circles.push(on.circles[Fa+0]),_a.circles.push(on.circles[Fa+1]),_a.circles.push(on.circles[Fa+2]),_a.circles.push(on.collisionDetected?1:0)}s.placements[dt.crossTileID]=new Tn(Ft||Re,Ot||Ze,Xt||d.justReloaded),o[dt.crossTileID]=!0}};if(Ae)for(var ct=d.getSortedSymbolIndexes(this.transform.angle),Et=ct.length-1;Et>=0;--Et){var Ct=ct[Et];qe(d.symbolInstances.get(Ct),d.collisionArrays[Ct])}else for(var It=n.symbolInstanceStart;It<n.symbolInstanceEnd;It++)qe(d.symbolInstances.get(It),d.collisionArrays[It]);if(i&&d.bucketInstanceId in this.collisionCircleArrays){var mr=this.collisionCircleArrays[d.bucketInstanceId];l.invert(mr.invProjMatrix,_),mr.viewportMatrix=this.collisionIndex.getViewportMatrix()}d.justReloaded=!1},jr.prototype.markUsedJustification=function(n,o,i,s){var p;p=s===l.WritingMode.vertical?i.verticalPlacedTextSymbolIndex:{left:i.leftJustifiedTextSymbolIndex,center:i.centerJustifiedTextSymbolIndex,right:i.rightJustifiedTextSymbolIndex}[l.getAnchorJustification(o)];for(var d=0,m=[i.leftJustifiedTextSymbolIndex,i.centerJustifiedTextSymbolIndex,i.rightJustifiedTextSymbolIndex,i.verticalPlacedTextSymbolIndex];d<m.length;d+=1){var _=m[d];_>=0&&(n.text.placedSymbolArray.get(_).crossTileID=p>=0&&_!==p?0:i.crossTileID)}},jr.prototype.markUsedOrientation=function(n,o,i){for(var s=o===l.WritingMode.horizontal||o===l.WritingMode.horizontalOnly?o:0,p=o===l.WritingMode.vertical?o:0,d=0,m=[i.leftJustifiedTextSymbolIndex,i.centerJustifiedTextSymbolIndex,i.rightJustifiedTextSymbolIndex];d<m.length;d+=1)n.text.placedSymbolArray.get(m[d]).placedOrientation=s;i.verticalPlacedTextSymbolIndex&&(n.text.placedSymbolArray.get(i.verticalPlacedTextSymbolIndex).placedOrientation=p)},jr.prototype.commit=function(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;var o=this.prevPlacement,i=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;var s=o?o.symbolFadeChange(n):1,p=o?o.opacities:{},d=o?o.variableOffsets:{},m=o?o.placedOrientations:{};for(var _ in this.placements){var S=this.placements[_],P=p[_];P?(this.opacities[_]=new er(P,s,S.text,S.icon),i=i||S.text!==P.text.placed||S.icon!==P.icon.placed):(this.opacities[_]=new er(null,s,S.text,S.icon,S.skipFade),i=i||S.text||S.icon)}for(var B in p){var F=p[B];if(!this.opacities[B]){var N=new er(F,s,!1,!1);N.isHidden()||(this.opacities[B]=N,i=i||F.text.placed||F.icon.placed)}}for(var H in d)this.variableOffsets[H]||!this.opacities[H]||this.opacities[H].isHidden()||(this.variableOffsets[H]=d[H]);for(var W in m)this.placedOrientations[W]||!this.opacities[W]||this.opacities[W].isHidden()||(this.placedOrientations[W]=m[W]);i?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:n)},jr.prototype.updateLayerOpacities=function(n,o){for(var i={},s=0,p=o;s<p.length;s+=1){var d=p[s],m=d.getBucket(n);m&&d.latestFeatureIndex&&n.id===m.layerIds[0]&&this.updateBucketOpacities(m,i,d.collisionBoxArray)}},jr.prototype.updateBucketOpacities=function(n,o,i){var s=this;n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();var p=n.layers[0].layout,d=new er(null,0,!1,!1,!0),m=p.get("text-allow-overlap"),_=p.get("icon-allow-overlap"),S=p.get("text-variable-anchor"),P=p.get("text-rotation-alignment")==="map",B=p.get("text-pitch-alignment")==="map",F=p.get("icon-text-fit")!=="none",N=new er(null,0,m&&(_||!n.hasIconData()||p.get("icon-optional")),_&&(m||!n.hasTextData()||p.get("text-optional")),!0);!n.collisionArrays&&i&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(i);for(var H=function(Q,ae,me){for(var Ce=0;Ce<ae/4;Ce++)Q.opacityVertexArray.emplaceBack(me)},W=function(Q){var ae=n.symbolInstances.get(Q),me=ae.numHorizontalGlyphVertices,Ce=ae.numVerticalGlyphVertices,we=ae.crossTileID,Ae=s.opacities[we];o[we]?Ae=d:Ae||(s.opacities[we]=Ae=N),o[we]=!0;var Re=ae.numIconVertices>0,Ze=s.placedOrientations[ae.crossTileID],qe=Ze===l.WritingMode.vertical,ct=Ze===l.WritingMode.horizontal||Ze===l.WritingMode.horizontalOnly;if(me>0||Ce>0){var Et=In(Ae.text);H(n.text,me,qe?ri:Et),H(n.text,Ce,ct?ri:Et);var Ct=Ae.text.isHidden();[ae.rightJustifiedTextSymbolIndex,ae.centerJustifiedTextSymbolIndex,ae.leftJustifiedTextSymbolIndex].forEach(function(kt){kt>=0&&(n.text.placedSymbolArray.get(kt).hidden=Ct||qe?1:0)}),ae.verticalPlacedTextSymbolIndex>=0&&(n.text.placedSymbolArray.get(ae.verticalPlacedTextSymbolIndex).hidden=Ct||ct?1:0);var It=s.variableOffsets[ae.crossTileID];It&&s.markUsedJustification(n,It.anchor,ae,Ze);var mr=s.placedOrientations[ae.crossTileID];mr&&(s.markUsedJustification(n,"left",ae,mr),s.markUsedOrientation(n,mr,ae))}if(Re){var dt=In(Ae.icon),Vt=!(F&&ae.verticalPlacedIconSymbolIndex&&qe);ae.placedIconSymbolIndex>=0&&(H(n.icon,ae.numIconVertices,Vt?dt:ri),n.icon.placedSymbolArray.get(ae.placedIconSymbolIndex).hidden=Ae.icon.isHidden()),ae.verticalPlacedIconSymbolIndex>=0&&(H(n.icon,ae.numVerticalIconVertices,Vt?ri:dt),n.icon.placedSymbolArray.get(ae.verticalPlacedIconSymbolIndex).hidden=Ae.icon.isHidden())}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){var Jt=n.collisionArrays[Q];if(Jt){var Ft=new l.Point(0,0);if(Jt.textBox||Jt.verticalTextBox){var Ot=!0;if(S){var Xt=s.variableOffsets[we];Xt?(Ft=Kt(Xt.anchor,Xt.width,Xt.height,Xt.textOffset,Xt.textBoxScale),P&&Ft._rotate(B?s.transform.angle:-s.transform.angle)):Ot=!1}Jt.textBox&&Ui(n.textCollisionBox.collisionVertexArray,Ae.text.placed,!Ot||qe,Ft.x,Ft.y),Jt.verticalTextBox&&Ui(n.textCollisionBox.collisionVertexArray,Ae.text.placed,!Ot||ct,Ft.x,Ft.y)}var zt=!!(!ct&&Jt.verticalIconBox);Jt.iconBox&&Ui(n.iconCollisionBox.collisionVertexArray,Ae.icon.placed,zt,F?Ft.x:0,F?Ft.y:0),Jt.verticalIconBox&&Ui(n.iconCollisionBox.collisionVertexArray,Ae.icon.placed,!zt,F?Ft.x:0,F?Ft.y:0)}}},ee=0;ee<n.symbolInstances.length;ee++)W(ee);if(n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){var q=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=q.invProjMatrix,n.placementViewportMatrix=q.viewportMatrix,n.collisionCircleArray=q.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}},jr.prototype.symbolFadeChange=function(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},jr.prototype.zoomAdjustment=function(n){return Math.max(0,(this.transform.zoom-n)/1.5)},jr.prototype.hasTransitions=function(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration},jr.prototype.stillRecent=function(n,o){var i=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*i>n},jr.prototype.setStale=function(){this.stale=!0};var Ka=Math.pow(2,25),ln=Math.pow(2,24),Fo=Math.pow(2,17),Xa=Math.pow(2,16),bo=Math.pow(2,9),Bs=Math.pow(2,8),hs=Math.pow(2,1);function In(n){if(n.opacity===0&&!n.placed)return 0;if(n.opacity===1&&n.placed)return 4294967295;var o=n.placed?1:0,i=Math.floor(127*n.opacity);return i*Ka+o*ln+i*Fo+o*Xa+i*bo+o*Bs+i*hs+o}var ri=0,Yo=function(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&n.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};Yo.prototype.continuePlacement=function(n,o,i,s,p){for(var d=this._bucketParts;this._currentTileIndex<n.length;)if(o.getBucketParts(d,s,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,p())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,d.sort(function(m,_){return m.sortKey-_.sortKey}));this._currentPartIndex<d.length;)if(o.placeLayerBucketPart(d[this._currentPartIndex],this._seenCrossTileIDs,i),this._currentPartIndex++,p())return!0;return!1};var wo=function(n,o,i,s,p,d,m){this.placement=new jr(n,p,d,m),this._currentPlacementIndex=o.length-1,this._forceFullPlacement=i,this._showCollisionBoxes=s,this._done=!1};wo.prototype.isDone=function(){return this._done},wo.prototype.continuePlacement=function(n,o,i){for(var s=this,p=l.browser.now(),d=function(){var S=l.browser.now()-p;return!s._forceFullPlacement&&S>2};this._currentPlacementIndex>=0;){var m=o[n[this._currentPlacementIndex]],_=this.placement.collisionIndex.transform.zoom;if(m.type==="symbol"&&(!m.minzoom||m.minzoom<=_)&&(!m.maxzoom||m.maxzoom>_)){if(this._inProgressLayer||(this._inProgressLayer=new Yo(m)),this._inProgressLayer.continuePlacement(i[m.source],this.placement,this._showCollisionBoxes,m,d))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},wo.prototype.commit=function(n){return this.placement.commit(n),this.placement};var Wa=512/l.EXTENT/2,Yi=function(n,o,i){this.tileID=n,this.indexedSymbolInstances={},this.bucketInstanceId=i;for(var s=0;s<o.length;s++){var p=o.get(s),d=p.key;this.indexedSymbolInstances[d]||(this.indexedSymbolInstances[d]=[]),this.indexedSymbolInstances[d].push({crossTileID:p.crossTileID,coord:this.getScaledCoordinates(p,n)})}};Yi.prototype.getScaledCoordinates=function(n,o){var i=Wa/Math.pow(2,o.canonical.z-this.tileID.canonical.z);return{x:Math.floor((o.canonical.x*l.EXTENT+n.anchorX)*i),y:Math.floor((o.canonical.y*l.EXTENT+n.anchorY)*i)}},Yi.prototype.findMatches=function(n,o,i){for(var s=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z),p=0;p<n.length;p++){var d=n.get(p);if(!d.crossTileID){var m=this.indexedSymbolInstances[d.key];if(m)for(var _=this.getScaledCoordinates(d,o),S=0,P=m;S<P.length;S+=1){var B=P[S];if(Math.abs(B.coord.x-_.x)<=s&&Math.abs(B.coord.y-_.y)<=s&&!i[B.crossTileID]){i[B.crossTileID]=!0,d.crossTileID=B.crossTileID;break}}}}};var Vi=function(){this.maxCrossTileID=0};Vi.prototype.generate=function(){return++this.maxCrossTileID};var jn=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};jn.prototype.handleWrapJump=function(n){var o=Math.round((n-this.lng)/360);if(o!==0)for(var i in this.indexes){var s=this.indexes[i],p={};for(var d in s){var m=s[d];m.tileID=m.tileID.unwrapTo(m.tileID.wrap+o),p[m.tileID.key]=m}this.indexes[i]=p}this.lng=n},jn.prototype.addBucket=function(n,o,i){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(var s=0;s<o.symbolInstances.length;s++)o.symbolInstances.get(s).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]={});var p=this.usedCrossTileIDs[n.overscaledZ];for(var d in this.indexes){var m=this.indexes[d];if(Number(d)>n.overscaledZ)for(var _ in m){var S=m[_];S.tileID.isChildOf(n)&&S.findMatches(o.symbolInstances,n,p)}else{var P=m[n.scaledTo(Number(d)).key];P&&P.findMatches(o.symbolInstances,n,p)}}for(var B=0;B<o.symbolInstances.length;B++){var F=o.symbolInstances.get(B);F.crossTileID||(F.crossTileID=i.generate(),p[F.crossTileID]=!0)}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new Yi(n,o.symbolInstances,o.bucketInstanceId),!0},jn.prototype.removeBucketCrossTileIDs=function(n,o){for(var i in o.indexedSymbolInstances)for(var s=0,p=o.indexedSymbolInstances[i];s<p.length;s+=1)delete this.usedCrossTileIDs[n][p[s].crossTileID]},jn.prototype.removeStaleBuckets=function(n){var o=!1;for(var i in this.indexes){var s=this.indexes[i];for(var p in s)n[s[p].bucketInstanceId]||(this.removeBucketCrossTileIDs(i,s[p]),delete s[p],o=!0)}return o};var io=function(){this.layerIndexes={},this.crossTileIDs=new Vi,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};io.prototype.addLayer=function(n,o,i){var s=this.layerIndexes[n.id];s===void 0&&(s=this.layerIndexes[n.id]=new jn);var p=!1,d={};s.handleWrapJump(i);for(var m=0,_=o;m<_.length;m+=1){var S=_[m],P=S.getBucket(n);P&&n.id===P.layerIds[0]&&(P.bucketInstanceId||(P.bucketInstanceId=++this.maxBucketInstanceId),s.addBucket(S.tileID,P,this.crossTileIDs)&&(p=!0),d[P.bucketInstanceId]=!0)}return s.removeStaleBuckets(d)&&(p=!0),p},io.prototype.pruneUnusedLayers=function(n){var o={};for(var i in n.forEach(function(s){o[s]=!0}),this.layerIndexes)o[i]||delete this.layerIndexes[i]};var No=function(n,o){return l.emitValidationErrors(n,o&&o.filter(function(i){return i.identifier!=="source.canvas"}))},oo=l.pick(Ye,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),ji=l.pick(Ye,["setCenter","setZoom","setBearing","setPitch"]),aa=function(){var n={},o=l.styleSpec.$version;for(var i in l.styleSpec.$root){var s,p=l.styleSpec.$root[i];p.required&&(s=i==="version"?o:p.type==="array"?[]:{})!=null&&(n[i]=s)}return n}(),ni=function(n){function o(i,s){var p=this;s===void 0&&(s={}),n.call(this),this.map=i,this.dispatcher=new Br(Se(),this),this.imageManager=new dr,this.imageManager.setEventedParent(this),this.glyphManager=new bn(i._requestManager,s.localIdeographFontFamily),this.lineAtlas=new Sr(256,512),this.crossTileSymbolIndex=new io,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new l.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",l.getReferrer());var d=this;this._rtlTextPluginCallback=o.registerForPluginStateChange(function(m){d.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:m.pluginStatus,pluginURL:m.pluginURL},function(_,S){if(l.triggerPluginCompletionEvent(_),S&&S.every(function(B){return B}))for(var P in d.sourceCaches)d.sourceCaches[P].reload()})}),this.on("data",function(m){if(m.dataType==="source"&&m.sourceDataType==="metadata"){var _=p.sourceCaches[m.sourceId];if(_){var S=_.getSource();if(S&&S.vectorLayerIds)for(var P in p._layers){var B=p._layers[P];B.source===S.id&&p._validateLayer(B)}}}})}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.loadURL=function(i,s){var p=this;s===void 0&&(s={}),this.fire(new l.Event("dataloading",{dataType:"style"}));var d=typeof s.validate=="boolean"?s.validate:!l.isMapboxURL(i);i=this.map._requestManager.normalizeStyleURL(i,s.accessToken);var m=this.map._requestManager.transformRequest(i,l.ResourceType.Style);this._request=l.getJSON(m,function(_,S){p._request=null,_?p.fire(new l.ErrorEvent(_)):S&&p._load(S,d)})},o.prototype.loadJSON=function(i,s){var p=this;s===void 0&&(s={}),this.fire(new l.Event("dataloading",{dataType:"style"})),this._request=l.browser.frame(function(){p._request=null,p._load(i,s.validate!==!1)})},o.prototype.loadEmpty=function(){this.fire(new l.Event("dataloading",{dataType:"style"})),this._load(aa,!1)},o.prototype._load=function(i,s){if(!s||!No(this,l.validateStyle(i))){for(var p in this._loaded=!0,this.stylesheet=i,i.sources)this.addSource(p,i.sources[p],{validate:!1});i.sprite?this._loadSprite(i.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(i.glyphs);var d=je(this.stylesheet.layers);this._order=d.map(function(P){return P.id}),this._layers={},this._serializedLayers={};for(var m=0,_=d;m<_.length;m+=1){var S=_[m];(S=l.createStyleLayer(S)).setEventedParent(this,{layer:{id:S.id}}),this._layers[S.id]=S,this._serializedLayers[S.id]=S.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new _i(this.stylesheet.light),this.fire(new l.Event("data",{dataType:"style"})),this.fire(new l.Event("style.load"))}},o.prototype._loadSprite=function(i){var s=this;this._spriteRequest=function(p,d,m){var _,S,P,B=l.browser.devicePixelRatio>1?"@2x":"",F=l.getJSON(d.transformRequest(d.normalizeSpriteURL(p,B,".json"),l.ResourceType.SpriteJSON),function(W,ee){F=null,P||(P=W,_=ee,H())}),N=l.getImage(d.transformRequest(d.normalizeSpriteURL(p,B,".png"),l.ResourceType.SpriteImage),function(W,ee){N=null,P||(P=W,S=ee,H())});function H(){if(P)m(P);else if(_&&S){var W=l.browser.getImageData(S),ee={};for(var q in _){var Q=_[q],ae=Q.width,me=Q.height,Ce=Q.x,we=Q.y,Ae=Q.sdf,Re=Q.pixelRatio,Ze=Q.stretchX,qe=Q.stretchY,ct=Q.content,Et=new l.RGBAImage({width:ae,height:me});l.RGBAImage.copy(W,Et,{x:Ce,y:we},{x:0,y:0},{width:ae,height:me}),ee[q]={data:Et,pixelRatio:Re,sdf:Ae,stretchX:Ze,stretchY:qe,content:ct}}m(null,ee)}}return{cancel:function(){F&&(F.cancel(),F=null),N&&(N.cancel(),N=null)}}}(i,this.map._requestManager,function(p,d){if(s._spriteRequest=null,p)s.fire(new l.ErrorEvent(p));else if(d)for(var m in d)s.imageManager.addImage(m,d[m]);s.imageManager.setLoaded(!0),s._availableImages=s.imageManager.listImages(),s.dispatcher.broadcast("setImages",s._availableImages),s.fire(new l.Event("data",{dataType:"style"}))})},o.prototype._validateLayer=function(i){var s=this.sourceCaches[i.source];if(s){var p=i.sourceLayer;if(p){var d=s.getSource();(d.type==="geojson"||d.vectorLayerIds&&d.vectorLayerIds.indexOf(p)===-1)&&this.fire(new l.ErrorEvent(new Error('Source layer "'+p+'" does not exist on source "'+d.id+'" as specified by style layer "'+i.id+'"')))}}},o.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var i in this.sourceCaches)if(!this.sourceCaches[i].loaded())return!1;return!!this.imageManager.isLoaded()},o.prototype._serializeLayers=function(i){for(var s=[],p=0,d=i;p<d.length;p+=1){var m=this._layers[d[p]];m.type!=="custom"&&s.push(m.serialize())}return s},o.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var i in this.sourceCaches)if(this.sourceCaches[i].hasTransition())return!0;for(var s in this._layers)if(this._layers[s].hasTransition())return!0;return!1},o.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},o.prototype.update=function(i){if(this._loaded){var s=this._changed;if(this._changed){var p=Object.keys(this._updatedLayers),d=Object.keys(this._removedLayers);for(var m in(p.length||d.length)&&this._updateWorkerLayers(p,d),this._updatedSources){var _=this._updatedSources[m];_==="reload"?this._reloadSource(m):_==="clear"&&this._clearSource(m)}for(var S in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[S].updateTransitions(i);this.light.updateTransitions(i),this._resetUpdates()}var P={};for(var B in this.sourceCaches){var F=this.sourceCaches[B];P[B]=F.used,F.used=!1}for(var N=0,H=this._order;N<H.length;N+=1){var W=this._layers[H[N]];W.recalculate(i,this._availableImages),!W.isHidden(i.zoom)&&W.source&&(this.sourceCaches[W.source].used=!0)}for(var ee in P){var q=this.sourceCaches[ee];P[ee]!==q.used&&q.fire(new l.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:ee}))}this.light.recalculate(i),this.z=i.zoom,s&&this.fire(new l.Event("data",{dataType:"style"}))}},o.prototype._updateTilesForChangedImages=function(){var i=Object.keys(this._changedImages);if(i.length){for(var s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],i);this._changedImages={}}},o.prototype._updateWorkerLayers=function(i,s){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(i),removedIds:s})},o.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},o.prototype.setState=function(i){var s=this;if(this._checkLoaded(),No(this,l.validateStyle(i)))return!1;(i=l.clone$1(i)).layers=je(i.layers);var p=function(m,_){if(!m)return[{command:Ye.setStyle,args:[_]}];var S=[];try{if(!l.deepEqual(m.version,_.version))return[{command:Ye.setStyle,args:[_]}];l.deepEqual(m.center,_.center)||S.push({command:Ye.setCenter,args:[_.center]}),l.deepEqual(m.zoom,_.zoom)||S.push({command:Ye.setZoom,args:[_.zoom]}),l.deepEqual(m.bearing,_.bearing)||S.push({command:Ye.setBearing,args:[_.bearing]}),l.deepEqual(m.pitch,_.pitch)||S.push({command:Ye.setPitch,args:[_.pitch]}),l.deepEqual(m.sprite,_.sprite)||S.push({command:Ye.setSprite,args:[_.sprite]}),l.deepEqual(m.glyphs,_.glyphs)||S.push({command:Ye.setGlyphs,args:[_.glyphs]}),l.deepEqual(m.transition,_.transition)||S.push({command:Ye.setTransition,args:[_.transition]}),l.deepEqual(m.light,_.light)||S.push({command:Ye.setLight,args:[_.light]});var P={},B=[];(function(N,H,W,ee){var q;for(q in H=H||{},N=N||{})N.hasOwnProperty(q)&&(H.hasOwnProperty(q)||et(q,W,ee));for(q in H)H.hasOwnProperty(q)&&(N.hasOwnProperty(q)?l.deepEqual(N[q],H[q])||(N[q].type==="geojson"&&H[q].type==="geojson"&&Nt(N,H,q)?W.push({command:Ye.setGeoJSONSourceData,args:[q,H[q].data]}):Yt(q,H,W,ee)):Bt(q,H,W))})(m.sources,_.sources,B,P);var F=[];m.layers&&m.layers.forEach(function(N){P[N.source]?S.push({command:Ye.removeLayer,args:[N.id]}):F.push(N)}),S=S.concat(B),function(N,H,W){H=H||[];var ee,q,Q,ae,me,Ce,we,Ae=(N=N||[]).map(Ht),Re=H.map(Ht),Ze=N.reduce(rr,{}),qe=H.reduce(rr,{}),ct=Ae.slice(),Et=Object.create(null);for(ee=0,q=0;ee<Ae.length;ee++)qe.hasOwnProperty(Q=Ae[ee])?q++:(W.push({command:Ye.removeLayer,args:[Q]}),ct.splice(ct.indexOf(Q,q),1));for(ee=0,q=0;ee<Re.length;ee++)ct[ct.length-1-ee]!==(Q=Re[Re.length-1-ee])&&(Ze.hasOwnProperty(Q)?(W.push({command:Ye.removeLayer,args:[Q]}),ct.splice(ct.lastIndexOf(Q,ct.length-q),1)):q++,W.push({command:Ye.addLayer,args:[qe[Q],Ce=ct[ct.length-ee]]}),ct.splice(ct.length-ee,0,Q),Et[Q]=!0);for(ee=0;ee<Re.length;ee++)if(ae=Ze[Q=Re[ee]],me=qe[Q],!Et[Q]&&!l.deepEqual(ae,me))if(l.deepEqual(ae.source,me.source)&&l.deepEqual(ae["source-layer"],me["source-layer"])&&l.deepEqual(ae.type,me.type)){for(we in Ut(ae.layout,me.layout,W,Q,null,Ye.setLayoutProperty),Ut(ae.paint,me.paint,W,Q,null,Ye.setPaintProperty),l.deepEqual(ae.filter,me.filter)||W.push({command:Ye.setFilter,args:[Q,me.filter]}),l.deepEqual(ae.minzoom,me.minzoom)&&l.deepEqual(ae.maxzoom,me.maxzoom)||W.push({command:Ye.setLayerZoomRange,args:[Q,me.minzoom,me.maxzoom]}),ae)ae.hasOwnProperty(we)&&we!=="layout"&&we!=="paint"&&we!=="filter"&&we!=="metadata"&&we!=="minzoom"&&we!=="maxzoom"&&(we.indexOf("paint.")===0?Ut(ae[we],me[we],W,Q,we.slice(6),Ye.setPaintProperty):l.deepEqual(ae[we],me[we])||W.push({command:Ye.setLayerProperty,args:[Q,we,me[we]]}));for(we in me)me.hasOwnProperty(we)&&!ae.hasOwnProperty(we)&&we!=="layout"&&we!=="paint"&&we!=="filter"&&we!=="metadata"&&we!=="minzoom"&&we!=="maxzoom"&&(we.indexOf("paint.")===0?Ut(ae[we],me[we],W,Q,we.slice(6),Ye.setPaintProperty):l.deepEqual(ae[we],me[we])||W.push({command:Ye.setLayerProperty,args:[Q,we,me[we]]}))}else W.push({command:Ye.removeLayer,args:[Q]}),Ce=ct[ct.lastIndexOf(Q)+1],W.push({command:Ye.addLayer,args:[me,Ce]})}(F,_.layers,S)}catch(N){console.warn("Unable to compute style diff:",N),S=[{command:Ye.setStyle,args:[_]}]}return S}(this.serialize(),i).filter(function(m){return!(m.command in ji)});if(p.length===0)return!1;var d=p.filter(function(m){return!(m.command in oo)});if(d.length>0)throw new Error("Unimplemented: "+d.map(function(m){return m.command}).join(", ")+".");return p.forEach(function(m){m.command!=="setTransition"&&s[m.command].apply(s,m.args)}),this.stylesheet=i,!0},o.prototype.addImage=function(i,s){if(this.getImage(i))return this.fire(new l.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(i,s),this._afterImageUpdated(i)},o.prototype.updateImage=function(i,s){this.imageManager.updateImage(i,s)},o.prototype.getImage=function(i){return this.imageManager.getImage(i)},o.prototype.removeImage=function(i){if(!this.getImage(i))return this.fire(new l.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(i),this._afterImageUpdated(i)},o.prototype._afterImageUpdated=function(i){this._availableImages=this.imageManager.listImages(),this._changedImages[i]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.Event("data",{dataType:"style"}))},o.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},o.prototype.addSource=function(i,s,p){var d=this;if(p===void 0&&(p={}),this._checkLoaded(),this.sourceCaches[i]!==void 0)throw new Error("There is already a source with this ID");if(!s.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(s).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(l.validateStyle.source,"sources."+i,s,null,p))){this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);var m=this.sourceCaches[i]=new J(i,s,this.dispatcher);m.style=this,m.setEventedParent(this,function(){return{isSourceLoaded:d.loaded(),source:m.serialize(),sourceId:i}}),m.onAdd(this.map),this._changed=!0}},o.prototype.removeSource=function(i){if(this._checkLoaded(),this.sourceCaches[i]===void 0)throw new Error("There is no source with this ID");for(var s in this._layers)if(this._layers[s].source===i)return this.fire(new l.ErrorEvent(new Error('Source "'+i+'" cannot be removed while layer "'+s+'" is using it.')));var p=this.sourceCaches[i];delete this.sourceCaches[i],delete this._updatedSources[i],p.fire(new l.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:i})),p.setEventedParent(null),p.clearTiles(),p.onRemove&&p.onRemove(this.map),this._changed=!0},o.prototype.setGeoJSONSourceData=function(i,s){this._checkLoaded(),this.sourceCaches[i].getSource().setData(s),this._changed=!0},o.prototype.getSource=function(i){return this.sourceCaches[i]&&this.sourceCaches[i].getSource()},o.prototype.addLayer=function(i,s,p){p===void 0&&(p={}),this._checkLoaded();var d=i.id;if(this.getLayer(d))this.fire(new l.ErrorEvent(new Error('Layer with id "'+d+'" already exists on this map')));else{var m;if(i.type==="custom"){if(No(this,l.validateCustomStyleLayer(i)))return;m=l.createStyleLayer(i)}else{if(typeof i.source=="object"&&(this.addSource(d,i.source),i=l.clone$1(i),i=l.extend(i,{source:d})),this._validate(l.validateStyle.layer,"layers."+d,i,{arrayIndex:-1},p))return;m=l.createStyleLayer(i),this._validateLayer(m),m.setEventedParent(this,{layer:{id:d}}),this._serializedLayers[m.id]=m.serialize()}var _=s?this._order.indexOf(s):this._order.length;if(s&&_===-1)this.fire(new l.ErrorEvent(new Error('Layer with id "'+s+'" does not exist on this map.')));else{if(this._order.splice(_,0,d),this._layerOrderChanged=!0,this._layers[d]=m,this._removedLayers[d]&&m.source&&m.type!=="custom"){var S=this._removedLayers[d];delete this._removedLayers[d],S.type!==m.type?this._updatedSources[m.source]="clear":(this._updatedSources[m.source]="reload",this.sourceCaches[m.source].pause())}this._updateLayer(m),m.onAdd&&m.onAdd(this.map)}}},o.prototype.moveLayer=function(i,s){if(this._checkLoaded(),this._changed=!0,this._layers[i]){if(i!==s){var p=this._order.indexOf(i);this._order.splice(p,1);var d=s?this._order.indexOf(s):this._order.length;s&&d===-1?this.fire(new l.ErrorEvent(new Error('Layer with id "'+s+'" does not exist on this map.'))):(this._order.splice(d,0,i),this._layerOrderChanged=!0)}}else this.fire(new l.ErrorEvent(new Error("The layer '"+i+"' does not exist in the map's style and cannot be moved.")))},o.prototype.removeLayer=function(i){this._checkLoaded();var s=this._layers[i];if(s){s.setEventedParent(null);var p=this._order.indexOf(i);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[i]=s,delete this._layers[i],delete this._serializedLayers[i],delete this._updatedLayers[i],delete this._updatedPaintProps[i],s.onRemove&&s.onRemove(this.map)}else this.fire(new l.ErrorEvent(new Error("The layer '"+i+"' does not exist in the map's style and cannot be removed.")))},o.prototype.getLayer=function(i){return this._layers[i]},o.prototype.hasLayer=function(i){return i in this._layers},o.prototype.setLayerZoomRange=function(i,s,p){this._checkLoaded();var d=this.getLayer(i);d?d.minzoom===s&&d.maxzoom===p||(s!=null&&(d.minzoom=s),p!=null&&(d.maxzoom=p),this._updateLayer(d)):this.fire(new l.ErrorEvent(new Error("The layer '"+i+"' does not exist in the map's style and cannot have zoom extent.")))},o.prototype.setFilter=function(i,s,p){p===void 0&&(p={}),this._checkLoaded();var d=this.getLayer(i);if(d){if(!l.deepEqual(d.filter,s))return s==null?(d.filter=void 0,void this._updateLayer(d)):void(this._validate(l.validateStyle.filter,"layers."+d.id+".filter",s,null,p)||(d.filter=l.clone$1(s),this._updateLayer(d)))}else this.fire(new l.ErrorEvent(new Error("The layer '"+i+"' does not exist in the map's style and cannot be filtered.")))},o.prototype.getFilter=function(i){return l.clone$1(this.getLayer(i).filter)},o.prototype.setLayoutProperty=function(i,s,p,d){d===void 0&&(d={}),this._checkLoaded();var m=this.getLayer(i);m?l.deepEqual(m.getLayoutProperty(s),p)||(m.setLayoutProperty(s,p,d),this._updateLayer(m)):this.fire(new l.ErrorEvent(new Error("The layer '"+i+"' does not exist in the map's style and cannot be styled.")))},o.prototype.getLayoutProperty=function(i,s){var p=this.getLayer(i);if(p)return p.getLayoutProperty(s);this.fire(new l.ErrorEvent(new Error("The layer '"+i+"' does not exist in the map's style.")))},o.prototype.setPaintProperty=function(i,s,p,d){d===void 0&&(d={}),this._checkLoaded();var m=this.getLayer(i);m?l.deepEqual(m.getPaintProperty(s),p)||(m.setPaintProperty(s,p,d)&&this._updateLayer(m),this._changed=!0,this._updatedPaintProps[i]=!0):this.fire(new l.ErrorEvent(new Error("The layer '"+i+"' does not exist in the map's style and cannot be styled.")))},o.prototype.getPaintProperty=function(i,s){return this.getLayer(i).getPaintProperty(s)},o.prototype.setFeatureState=function(i,s){this._checkLoaded();var p=i.source,d=i.sourceLayer,m=this.sourceCaches[p];if(m!==void 0){var _=m.getSource().type;_==="geojson"&&d?this.fire(new l.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):_!=="vector"||d?(i.id===void 0&&this.fire(new l.ErrorEvent(new Error("The feature id parameter must be provided."))),m.setFeatureState(d,i.id,s)):this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new l.ErrorEvent(new Error("The source '"+p+"' does not exist in the map's style.")))},o.prototype.removeFeatureState=function(i,s){this._checkLoaded();var p=i.source,d=this.sourceCaches[p];if(d!==void 0){var m=d.getSource().type,_=m==="vector"?i.sourceLayer:void 0;m!=="vector"||_?s&&typeof i.id!="string"&&typeof i.id!="number"?this.fire(new l.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):d.removeFeatureState(_,i.id,s):this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new l.ErrorEvent(new Error("The source '"+p+"' does not exist in the map's style.")))},o.prototype.getFeatureState=function(i){this._checkLoaded();var s=i.source,p=i.sourceLayer,d=this.sourceCaches[s];if(d!==void 0){if(d.getSource().type!=="vector"||p)return i.id===void 0&&this.fire(new l.ErrorEvent(new Error("The feature id parameter must be provided."))),d.getFeatureState(p,i.id);this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new l.ErrorEvent(new Error("The source '"+s+"' does not exist in the map's style.")))},o.prototype.getTransition=function(){return l.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},o.prototype.serialize=function(){return l.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:l.mapObject(this.sourceCaches,function(i){return i.serialize()}),layers:this._serializeLayers(this._order)},function(i){return i!==void 0})},o.prototype._updateLayer=function(i){this._updatedLayers[i.id]=!0,i.source&&!this._updatedSources[i.source]&&this.sourceCaches[i.source].getSource().type!=="raster"&&(this._updatedSources[i.source]="reload",this.sourceCaches[i.source].pause()),this._changed=!0},o.prototype._flattenAndSortRenderedFeatures=function(i){for(var s=this,p=function(Ze){return s._layers[Ze].type==="fill-extrusion"},d={},m=[],_=this._order.length-1;_>=0;_--){var S=this._order[_];if(p(S)){d[S]=_;for(var P=0,B=i;P<B.length;P+=1){var F=B[P][S];if(F)for(var N=0,H=F;N<H.length;N+=1)m.push(H[N])}}}m.sort(function(Ze,qe){return qe.intersectionZ-Ze.intersectionZ});for(var W=[],ee=this._order.length-1;ee>=0;ee--){var q=this._order[ee];if(p(q))for(var Q=m.length-1;Q>=0;Q--){var ae=m[Q].feature;if(d[ae.layer.id]<ee)break;W.push(ae),m.pop()}else for(var me=0,Ce=i;me<Ce.length;me+=1){var we=Ce[me][q];if(we)for(var Ae=0,Re=we;Ae<Re.length;Ae+=1)W.push(Re[Ae].feature)}}return W},o.prototype.queryRenderedFeatures=function(i,s,p){s&&s.filter&&this._validate(l.validateStyle.filter,"queryRenderedFeatures.filter",s.filter,null,s);var d={};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new l.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var m=0,_=s.layers;m<_.length;m+=1){var S=_[m],P=this._layers[S];if(!P)return this.fire(new l.ErrorEvent(new Error("The layer '"+S+"' does not exist in the map's style and cannot be queried for features."))),[];d[P.source]=!0}}var B=[];for(var F in s.availableImages=this._availableImages,this.sourceCaches)s.layers&&!d[F]||B.push(gn(this.sourceCaches[F],this._layers,this._serializedLayers,i,s,p));return this.placement&&B.push(function(N,H,W,ee,q,Q,ae){for(var me={},Ce=Q.queryRenderedSymbols(ee),we=[],Ae=0,Re=Object.keys(Ce).map(Number);Ae<Re.length;Ae+=1)we.push(ae[Re[Ae]]);we.sort(wi);for(var Ze=function(){var It=ct[qe],mr=It.featureIndex.lookupSymbolFeatures(Ce[It.bucketInstanceId],H,It.bucketIndex,It.sourceLayerIndex,q.filter,q.layers,q.availableImages,N);for(var dt in mr){var Vt=me[dt]=me[dt]||[],Jt=mr[dt];Jt.sort(function(Xt,zt){var kt=It.featureSortOrder;if(kt){var On=kt.indexOf(Xt.featureIndex);return kt.indexOf(zt.featureIndex)-On}return zt.featureIndex-Xt.featureIndex});for(var Ft=0,Ot=Jt;Ft<Ot.length;Ft+=1)Vt.push(Ot[Ft])}},qe=0,ct=we;qe<ct.length;qe+=1)Ze();var Et=function(It){me[It].forEach(function(mr){var dt=mr.feature,Vt=W[N[It].source].getFeatureState(dt.layer["source-layer"],dt.id);dt.source=dt.layer.source,dt.layer["source-layer"]&&(dt.sourceLayer=dt.layer["source-layer"]),dt.state=Vt})};for(var Ct in me)Et(Ct);return me}(this._layers,this._serializedLayers,this.sourceCaches,i,s,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(B)},o.prototype.querySourceFeatures=function(i,s){s&&s.filter&&this._validate(l.validateStyle.filter,"querySourceFeatures.filter",s.filter,null,s);var p=this.sourceCaches[i];return p?function(d,m){for(var _=d.getRenderableIds().map(function(H){return d.getTileByID(H)}),S=[],P={},B=0;B<_.length;B++){var F=_[B],N=F.tileID.canonical.key;P[N]||(P[N]=!0,F.querySourceFeatures(S,m))}return S}(p,s):[]},o.prototype.addSourceType=function(i,s,p){return o.getSourceType(i)?p(new Error('A source type called "'+i+'" already exists.')):(o.setSourceType(i,s),s.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:i,url:s.workerSourceURL},p):p(null,null))},o.prototype.getLight=function(){return this.light.getLight()},o.prototype.setLight=function(i,s){s===void 0&&(s={}),this._checkLoaded();var p=this.light.getLight(),d=!1;for(var m in i)if(!l.deepEqual(i[m],p[m])){d=!0;break}if(d){var _={now:l.browser.now(),transition:l.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(i,s),this.light.updateTransitions(_)}},o.prototype._validate=function(i,s,p,d,m){return m===void 0&&(m={}),(!m||m.validate!==!1)&&No(this,i.call(l.validateStyle,l.extend({key:s,style:this.serialize(),value:p,styleSpec:l.styleSpec},d)))},o.prototype._remove=function(){for(var i in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),l.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[i].setEventedParent(null);for(var s in this.sourceCaches)this.sourceCaches[s].clearTiles(),this.sourceCaches[s].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},o.prototype._clearSource=function(i){this.sourceCaches[i].clearTiles()},o.prototype._reloadSource=function(i){this.sourceCaches[i].resume(),this.sourceCaches[i].reload()},o.prototype._updateSources=function(i){for(var s in this.sourceCaches)this.sourceCaches[s].update(i)},o.prototype._generateCollisionBoxes=function(){for(var i in this.sourceCaches)this._reloadSource(i)},o.prototype._updatePlacement=function(i,s,p,d,m){m===void 0&&(m=!1);for(var _=!1,S=!1,P={},B=0,F=this._order;B<F.length;B+=1){var N=this._layers[F[B]];if(N.type==="symbol"){if(!P[N.source]){var H=this.sourceCaches[N.source];P[N.source]=H.getRenderableIds(!0).map(function(ae){return H.getTileByID(ae)}).sort(function(ae,me){return me.tileID.overscaledZ-ae.tileID.overscaledZ||(ae.tileID.isLessThan(me.tileID)?-1:1)})}var W=this.crossTileSymbolIndex.addLayer(N,P[N.source],i.center.lng);_=_||W}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((m=m||this._layerOrderChanged||p===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(l.browser.now(),i.zoom))&&(this.pauseablePlacement=new wo(i,this._order,m,s,p,d,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,P),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(l.browser.now()),S=!0),_&&this.pauseablePlacement.placement.setStale()),S||_)for(var ee=0,q=this._order;ee<q.length;ee+=1){var Q=this._layers[q[ee]];Q.type==="symbol"&&this.placement.updateLayerOpacities(Q,P[Q.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(l.browser.now())},o.prototype._releaseSymbolFadeTiles=function(){for(var i in this.sourceCaches)this.sourceCaches[i].releaseSymbolFadeTiles()},o.prototype.getImages=function(i,s,p){this.imageManager.getImages(s.icons,p),this._updateTilesForChangedImages();var d=this.sourceCaches[s.source];d&&d.setDependencies(s.tileID.key,s.type,s.icons)},o.prototype.getGlyphs=function(i,s,p){this.glyphManager.getGlyphs(s.stacks,p)},o.prototype.getResource=function(i,s,p){return l.makeRequest(s,p)},o}(l.Evented);ni.getSourceType=function(n){return bi[n]},ni.setSourceType=function(n,o){bi[n]=o},ni.registerForPluginStateChange=l.registerForPluginStateChange;var en=l.createLayout([{name:"a_pos",type:"Int16",components:2}]),ao=wr(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),Fs=wr(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Au=wr(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Ha=wr(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),sa=wr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Ia=wr(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),fs=wr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),ds=wr("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),Ns=wr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),Ja=wr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),ms=wr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),ua=wr(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),Uo=wr(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),Ca=wr(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),cn=wr(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),Ya=wr(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),Vo=wr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),$i=wr(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),Eo=wr(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),So=wr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),so=wr(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),To=wr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),tn=wr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),qi=wr(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),la=wr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),ys=wr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function wr(n,o){var i=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,s=o.match(/attribute ([\w]+) ([\w]+)/g),p=n.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),d=o.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),m=d?d.concat(p):p,_={};return{fragmentSource:n=n.replace(i,function(S,P,B,F,N){return _[N]=!0,P==="define"?`
#ifndef HAS_UNIFORM_u_`+N+`
varying `+B+" "+F+" "+N+`;
#else
uniform `+B+" "+F+" u_"+N+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+N+`
    `+B+" "+F+" "+N+" = u_"+N+`;
#endif
`}),vertexSource:o=o.replace(i,function(S,P,B,F,N){var H=F==="float"?"vec2":"vec4",W=N.match(/color/)?"color":H;return _[N]?P==="define"?`
#ifndef HAS_UNIFORM_u_`+N+`
uniform lowp float u_`+N+`_t;
attribute `+B+" "+H+" a_"+N+`;
varying `+B+" "+F+" "+N+`;
#else
uniform `+B+" "+F+" u_"+N+`;
#endif
`:W==="vec4"?`
#ifndef HAS_UNIFORM_u_`+N+`
    `+N+" = a_"+N+`;
#else
    `+B+" "+F+" "+N+" = u_"+N+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+N+`
    `+N+" = unpack_mix_"+W+"(a_"+N+", u_"+N+`_t);
#else
    `+B+" "+F+" "+N+" = u_"+N+`;
#endif
`:P==="define"?`
#ifndef HAS_UNIFORM_u_`+N+`
uniform lowp float u_`+N+`_t;
attribute `+B+" "+H+" a_"+N+`;
#else
uniform `+B+" "+F+" u_"+N+`;
#endif
`:W==="vec4"?`
#ifndef HAS_UNIFORM_u_`+N+`
    `+B+" "+F+" "+N+" = a_"+N+`;
#else
    `+B+" "+F+" "+N+" = u_"+N+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+N+`
    `+B+" "+F+" "+N+" = unpack_mix_"+W+"(a_"+N+", u_"+N+`_t);
#else
    `+B+" "+F+" "+N+" = u_"+N+`;
#endif
`}),staticAttributes:s,staticUniforms:m}}var Us=Object.freeze({__proto__:null,prelude:ao,background:Fs,backgroundPattern:Au,circle:Ha,clippingMask:sa,heatmap:Ia,heatmapTexture:fs,collisionBox:ds,collisionCircle:Ns,debug:Ja,fill:ms,fillOutline:ua,fillOutlinePattern:Uo,fillPattern:Ca,fillExtrusion:cn,fillExtrusionPattern:Ya,hillshadePrepare:Vo,hillshade:$i,line:Eo,lineGradient:So,linePattern:so,lineSDF:To,raster:tn,symbolIcon:qi,symbolSDF:la,symbolTextAndIcon:ys}),Aa=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function Pa(n){for(var o=[],i=0;i<n.length;i++)if(n[i]!==null){var s=n[i].split(" ");o.push(s.pop())}return o}Aa.prototype.bind=function(n,o,i,s,p,d,m,_){this.context=n;for(var S=this.boundPaintVertexBuffers.length!==s.length,P=0;!S&&P<s.length;P++)this.boundPaintVertexBuffers[P]!==s[P]&&(S=!0);n.extVertexArrayObject&&this.vao&&this.boundProgram===o&&this.boundLayoutVertexBuffer===i&&!S&&this.boundIndexBuffer===p&&this.boundVertexOffset===d&&this.boundDynamicVertexBuffer===m&&this.boundDynamicVertexBuffer2===_?(n.bindVertexArrayOES.set(this.vao),m&&m.bind(),p&&p.dynamicDraw&&p.bind(),_&&_.bind()):this.freshBind(o,i,s,p,d,m,_)},Aa.prototype.freshBind=function(n,o,i,s,p,d,m){var _,S=n.numAttributes,P=this.context,B=P.gl;if(P.extVertexArrayObject)this.vao&&this.destroy(),this.vao=P.extVertexArrayObject.createVertexArrayOES(),P.bindVertexArrayOES.set(this.vao),_=0,this.boundProgram=n,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=i,this.boundIndexBuffer=s,this.boundVertexOffset=p,this.boundDynamicVertexBuffer=d,this.boundDynamicVertexBuffer2=m;else{_=P.currentNumAttributes||0;for(var F=S;F<_;F++)B.disableVertexAttribArray(F)}o.enableAttributes(B,n);for(var N=0,H=i;N<H.length;N+=1)H[N].enableAttributes(B,n);d&&d.enableAttributes(B,n),m&&m.enableAttributes(B,n),o.bind(),o.setVertexAttribPointers(B,n,p);for(var W=0,ee=i;W<ee.length;W+=1){var q=ee[W];q.bind(),q.setVertexAttribPointers(B,n,p)}d&&(d.bind(),d.setVertexAttribPointers(B,n,p)),s&&s.bind(),m&&(m.bind(),m.setVertexAttribPointers(B,n,p)),P.currentNumAttributes=S},Aa.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var $a=function(n,o,i,s,p,d){var m=n.gl;this.program=m.createProgram();for(var _=Pa(i.staticAttributes),S=s?s.getBinderAttributes():[],P=_.concat(S),B=i.staticUniforms?Pa(i.staticUniforms):[],F=s?s.getBinderUniforms():[],N=[],H=0,W=B.concat(F);H<W.length;H+=1){var ee=W[H];N.indexOf(ee)<0&&N.push(ee)}var q=s?s.defines():[];d&&q.push("#define OVERDRAW_INSPECTOR;");var Q=q.concat(ao.fragmentSource,i.fragmentSource).join(`
`),ae=q.concat(ao.vertexSource,i.vertexSource).join(`
`),me=m.createShader(m.FRAGMENT_SHADER);if(m.isContextLost())this.failedToCreate=!0;else{m.shaderSource(me,Q),m.compileShader(me),m.attachShader(this.program,me);var Ce=m.createShader(m.VERTEX_SHADER);if(m.isContextLost())this.failedToCreate=!0;else{m.shaderSource(Ce,ae),m.compileShader(Ce),m.attachShader(this.program,Ce),this.attributes={};var we={};this.numAttributes=P.length;for(var Ae=0;Ae<this.numAttributes;Ae++)P[Ae]&&(m.bindAttribLocation(this.program,Ae,P[Ae]),this.attributes[P[Ae]]=Ae);m.linkProgram(this.program),m.deleteShader(Ce),m.deleteShader(me);for(var Re=0;Re<N.length;Re++){var Ze=N[Re];if(Ze&&!we[Ze]){var qe=m.getUniformLocation(this.program,Ze);qe&&(we[Ze]=qe)}}this.fixedUniforms=p(n,we),this.binderUniforms=s?s.getUniforms(n,we):[]}}};function jo(n,o,i){var s=1/st(i,1,o.transform.tileZoom),p=Math.pow(2,i.tileID.overscaledZ),d=i.tileSize*Math.pow(2,o.transform.tileZoom)/p,m=d*(i.tileID.canonical.x+i.tileID.wrap*p),_=d*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture.size,u_scale:[s,n.fromScale,n.toScale],u_fade:n.t,u_pixel_coord_upper:[m>>16,_>>16],u_pixel_coord_lower:[65535&m,65535&_]}}$a.prototype.draw=function(n,o,i,s,p,d,m,_,S,P,B,F,N,H,W,ee){var q,Q=n.gl;if(!this.failedToCreate){for(var ae in n.program.set(this.program),n.setDepthMode(i),n.setStencilMode(s),n.setColorMode(p),n.setCullFace(d),this.fixedUniforms)this.fixedUniforms[ae].set(m[ae]);H&&H.setUniforms(n,this.binderUniforms,F,{zoom:N});for(var me=(q={},q[Q.LINES]=2,q[Q.TRIANGLES]=3,q[Q.LINE_STRIP]=1,q)[o],Ce=0,we=B.get();Ce<we.length;Ce+=1){var Ae=we[Ce],Re=Ae.vaos||(Ae.vaos={});(Re[_]||(Re[_]=new Aa)).bind(n,this,S,H?H.getPaintVertexBuffers():[],P,Ae.vertexOffset,W,ee),Q.drawElements(o,Ae.primitiveLength*me,Q.UNSIGNED_SHORT,Ae.primitiveOffset*me*2)}}};var Qa=function(n,o,i,s){var p=o.style.light,d=p.properties.get("position"),m=[d.x,d.y,d.z],_=l.create$1();p.properties.get("anchor")==="viewport"&&l.fromRotation(_,-o.transform.angle),l.transformMat3(m,m,_);var S=p.properties.get("color");return{u_matrix:n,u_lightpos:m,u_lightintensity:p.properties.get("intensity"),u_lightcolor:[S.r,S.g,S.b],u_vertical_gradient:+i,u_opacity:s}},Io=function(n,o,i,s,p,d,m){return l.extend(Qa(n,o,i,s),jo(d,o,m),{u_height_factor:-Math.pow(2,p.overscaledZ)/m.tileSize/8})},Qi=function(n){return{u_matrix:n}},Co=function(n,o,i,s){return l.extend(Qi(n),jo(i,o,s))},gs=function(n,o){return{u_matrix:n,u_world:o}},Vs=function(n,o,i,s,p){return l.extend(Co(n,o,i,s),{u_world:p})},ka=function(n,o,i,s){var p,d,m=n.transform;if(s.paint.get("circle-pitch-alignment")==="map"){var _=st(i,1,m.zoom);p=!0,d=[_,_]}else p=!1,d=m.pixelsToGLUnits;return{u_camera_to_center_distance:m.cameraToCenterDistance,u_scale_with_map:+(s.paint.get("circle-pitch-scale")==="map"),u_matrix:n.translatePosMatrix(o.posMatrix,i,s.paint.get("circle-translate"),s.paint.get("circle-translate-anchor")),u_pitch_with_map:+p,u_device_pixel_ratio:l.browser.devicePixelRatio,u_extrude_scale:d}},uo=function(n,o,i){var s=st(i,1,o.zoom),p=Math.pow(2,o.zoom-i.tileID.overscaledZ),d=i.tileID.overscaleFactor();return{u_matrix:n,u_camera_to_center_distance:o.cameraToCenterDistance,u_pixels_to_tile_units:s,u_extrude_scale:[o.pixelsToGLUnits[0]/(s*p),o.pixelsToGLUnits[1]/(s*p)],u_overscale_factor:d}},js=function(n,o,i){return{u_matrix:n,u_inv_matrix:o,u_camera_to_center_distance:i.cameraToCenterDistance,u_viewport_size:[i.width,i.height]}},Ao=function(n,o,i){return i===void 0&&(i=1),{u_matrix:n,u_color:o,u_overlay:0,u_overlay_scale:i}},Po=function(n){return{u_matrix:n}},qs=function(n,o,i,s){return{u_matrix:n,u_extrude_scale:st(o,1,i),u_intensity:s}},ca=function(n,o,i){var s=n.transform;return{u_matrix:vs(n,o,i),u_ratio:1/st(o,1,s.zoom),u_device_pixel_ratio:l.browser.devicePixelRatio,u_units_to_pixels:[1/s.pixelsToGLUnits[0],1/s.pixelsToGLUnits[1]]}},kr=function(n,o,i,s){return l.extend(ca(n,o,i),{u_image:0,u_image_height:s})},Ma=function(n,o,i,s){var p=n.transform,d=pa(o,p);return{u_matrix:vs(n,o,i),u_texsize:o.imageAtlasTexture.size,u_ratio:1/st(o,1,p.zoom),u_device_pixel_ratio:l.browser.devicePixelRatio,u_image:0,u_scale:[d,s.fromScale,s.toScale],u_fade:s.t,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},Zs=function(n,o,i,s,p){var d=n.lineAtlas,m=pa(o,n.transform),_=i.layout.get("line-cap")==="round",S=d.getDash(s.from,_),P=d.getDash(s.to,_),B=S.width*p.fromScale,F=P.width*p.toScale;return l.extend(ca(n,o,i),{u_patternscale_a:[m/B,-S.height/2],u_patternscale_b:[m/F,-P.height/2],u_sdfgamma:d.width/(256*Math.min(B,F)*l.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:S.y,u_tex_y_b:P.y,u_mix:p.t})};function pa(n,o){return 1/st(n,1,o.tileZoom)}function vs(n,o,i){return n.translatePosMatrix(o.tileID.posMatrix,o,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}var _s=function(n,o,i,s,p){return{u_matrix:n,u_tl_parent:o,u_scale_parent:i,u_buffer_scale:1,u_fade_t:s.mix,u_opacity:s.opacity*p.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:p.paint.get("raster-brightness-min"),u_brightness_high:p.paint.get("raster-brightness-max"),u_saturation_factor:(m=p.paint.get("raster-saturation"),m>0?1-1/(1.001-m):-m),u_contrast_factor:(d=p.paint.get("raster-contrast"),d>0?1/(1-d):1+d),u_spin_weights:xs(p.paint.get("raster-hue-rotate"))};var d,m};function xs(n){n*=Math.PI/180;var o=Math.sin(n),i=Math.cos(n);return[(2*i+1)/3,(-Math.sqrt(3)*o-i+1)/3,(Math.sqrt(3)*o-i+1)/3]}var za,ha=function(n,o,i,s,p,d,m,_,S,P){var B=p.transform;return{u_is_size_zoom_constant:+(n==="constant"||n==="source"),u_is_size_feature_constant:+(n==="constant"||n==="camera"),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:B.cameraToCenterDistance,u_pitch:B.pitch/360*2*Math.PI,u_rotate_symbol:+i,u_aspect_ratio:B.width/B.height,u_fade_change:p.options.fadeDuration?p.symbolFadeChange:1,u_matrix:d,u_label_plane_matrix:m,u_coord_matrix:_,u_is_text:+S,u_pitch_with_map:+s,u_texsize:P,u_texture:0}},Da=function(n,o,i,s,p,d,m,_,S,P,B){var F=p.transform;return l.extend(ha(n,o,i,s,p,d,m,_,S,P),{u_gamma_scale:s?Math.cos(F._pitch)*F.cameraToCenterDistance:1,u_device_pixel_ratio:l.browser.devicePixelRatio,u_is_halo:1})},es=function(n,o,i,s,p,d,m,_,S,P){return l.extend(Da(n,o,i,s,p,d,m,_,!0,S),{u_texsize_icon:P,u_texture_icon:1})},qo=function(n,o,i){return{u_matrix:n,u_opacity:o,u_color:i}},ci=function(n,o,i,s,p,d){return l.extend(function(m,_,S,P){var B=S.imageManager.getPattern(m.from.toString()),F=S.imageManager.getPattern(m.to.toString()),N=S.imageManager.getPixelSize(),H=N.width,W=N.height,ee=Math.pow(2,P.tileID.overscaledZ),q=P.tileSize*Math.pow(2,S.transform.tileZoom)/ee,Q=q*(P.tileID.canonical.x+P.tileID.wrap*ee),ae=q*P.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:B.tl,u_pattern_br_a:B.br,u_pattern_tl_b:F.tl,u_pattern_br_b:F.br,u_texsize:[H,W],u_mix:_.t,u_pattern_size_a:B.displaySize,u_pattern_size_b:F.displaySize,u_scale_a:_.fromScale,u_scale_b:_.toScale,u_tile_units_to_pixels:1/st(P,1,S.transform.tileZoom),u_pixel_coord_upper:[Q>>16,ae>>16],u_pixel_coord_lower:[65535&Q,65535&ae]}}(s,d,i,p),{u_matrix:n,u_opacity:o})},rn={fillExtrusion:function(n,o){return{u_matrix:new l.UniformMatrix4f(n,o.u_matrix),u_lightpos:new l.Uniform3f(n,o.u_lightpos),u_lightintensity:new l.Uniform1f(n,o.u_lightintensity),u_lightcolor:new l.Uniform3f(n,o.u_lightcolor),u_vertical_gradient:new l.Uniform1f(n,o.u_vertical_gradient),u_opacity:new l.Uniform1f(n,o.u_opacity)}},fillExtrusionPattern:function(n,o){return{u_matrix:new l.UniformMatrix4f(n,o.u_matrix),u_lightpos:new l.Uniform3f(n,o.u_lightpos),u_lightintensity:new l.Uniform1f(n,o.u_lightintensity),u_lightcolor:new l.Uniform3f(n,o.u_lightcolor),u_vertical_gradient:new l.Uniform1f(n,o.u_vertical_gradient),u_height_factor:new l.Uniform1f(n,o.u_height_factor),u_image:new l.Uniform1i(n,o.u_image),u_texsize:new l.Uniform2f(n,o.u_texsize),u_pixel_coord_upper:new l.Uniform2f(n,o.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(n,o.u_pixel_coord_lower),u_scale:new l.Uniform3f(n,o.u_scale),u_fade:new l.Uniform1f(n,o.u_fade),u_opacity:new l.Uniform1f(n,o.u_opacity)}},fill:function(n,o){return{u_matrix:new l.UniformMatrix4f(n,o.u_matrix)}},fillPattern:function(n,o){return{u_matrix:new l.UniformMatrix4f(n,o.u_matrix),u_image:new l.Uniform1i(n,o.u_image),u_texsize:new l.Uniform2f(n,o.u_texsize),u_pixel_coord_upper:new l.Uniform2f(n,o.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(n,o.u_pixel_coord_lower),u_scale:new l.Uniform3f(n,o.u_scale),u_fade:new l.Uniform1f(n,o.u_fade)}},fillOutline:function(n,o){return{u_matrix:new l.UniformMatrix4f(n,o.u_matrix),u_world:new l.Uniform2f(n,o.u_world)}},fillOutlinePattern:function(n,o){return{u_matrix:new l.UniformMatrix4f(n,o.u_matrix),u_world:new l.Uniform2f(n,o.u_world),u_image:new l.Uniform1i(n,o.u_image),u_texsize:new l.Uniform2f(n,o.u_texsize),u_pixel_coord_upper:new l.Uniform2f(n,o.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(n,o.u_pixel_coord_lower),u_scale:new l.Uniform3f(n,o.u_scale),u_fade:new l.Uniform1f(n,o.u_fade)}},circle:function(n,o){return{u_camera_to_center_distance:new l.Uniform1f(n,o.u_camera_to_center_distance),u_scale_with_map:new l.Uniform1i(n,o.u_scale_with_map),u_pitch_with_map:new l.Uniform1i(n,o.u_pitch_with_map),u_extrude_scale:new l.Uniform2f(n,o.u_extrude_scale),u_device_pixel_ratio:new l.Uniform1f(n,o.u_device_pixel_ratio),u_matrix:new l.UniformMatrix4f(n,o.u_matrix)}},collisionBox:function(n,o){return{u_matrix:new l.UniformMatrix4f(n,o.u_matrix),u_camera_to_center_distance:new l.Uniform1f(n,o.u_camera_to_center_distance),u_pixels_to_tile_units:new l.Uniform1f(n,o.u_pixels_to_tile_units),u_extrude_scale:new l.Uniform2f(n,o.u_extrude_scale),u_overscale_factor:new l.Uniform1f(n,o.u_overscale_factor)}},collisionCircle:function(n,o){return{u_matrix:new l.UniformMatrix4f(n,o.u_matrix),u_inv_matrix:new l.UniformMatrix4f(n,o.u_inv_matrix),u_camera_to_center_distance:new l.Uniform1f(n,o.u_camera_to_center_distance),u_viewport_size:new l.Uniform2f(n,o.u_viewport_size)}},debug:function(n,o){return{u_color:new l.UniformColor(n,o.u_color),u_matrix:new l.UniformMatrix4f(n,o.u_matrix),u_overlay:new l.Uniform1i(n,o.u_overlay),u_overlay_scale:new l.Uniform1f(n,o.u_overlay_scale)}},clippingMask:function(n,o){return{u_matrix:new l.UniformMatrix4f(n,o.u_matrix)}},heatmap:function(n,o){return{u_extrude_scale:new l.Uniform1f(n,o.u_extrude_scale),u_intensity:new l.Uniform1f(n,o.u_intensity),u_matrix:new l.UniformMatrix4f(n,o.u_matrix)}},heatmapTexture:function(n,o){return{u_matrix:new l.UniformMatrix4f(n,o.u_matrix),u_world:new l.Uniform2f(n,o.u_world),u_image:new l.Uniform1i(n,o.u_image),u_color_ramp:new l.Uniform1i(n,o.u_color_ramp),u_opacity:new l.Uniform1f(n,o.u_opacity)}},hillshade:function(n,o){return{u_matrix:new l.UniformMatrix4f(n,o.u_matrix),u_image:new l.Uniform1i(n,o.u_image),u_latrange:new l.Uniform2f(n,o.u_latrange),u_light:new l.Uniform2f(n,o.u_light),u_shadow:new l.UniformColor(n,o.u_shadow),u_highlight:new l.UniformColor(n,o.u_highlight),u_accent:new l.UniformColor(n,o.u_accent)}},hillshadePrepare:function(n,o){return{u_matrix:new l.UniformMatrix4f(n,o.u_matrix),u_image:new l.Uniform1i(n,o.u_image),u_dimension:new l.Uniform2f(n,o.u_dimension),u_zoom:new l.Uniform1f(n,o.u_zoom),u_unpack:new l.Uniform4f(n,o.u_unpack)}},line:function(n,o){return{u_matrix:new l.UniformMatrix4f(n,o.u_matrix),u_ratio:new l.Uniform1f(n,o.u_ratio),u_device_pixel_ratio:new l.Uniform1f(n,o.u_device_pixel_ratio),u_units_to_pixels:new l.Uniform2f(n,o.u_units_to_pixels)}},lineGradient:function(n,o){return{u_matrix:new l.UniformMatrix4f(n,o.u_matrix),u_ratio:new l.Uniform1f(n,o.u_ratio),u_device_pixel_ratio:new l.Uniform1f(n,o.u_device_pixel_ratio),u_units_to_pixels:new l.Uniform2f(n,o.u_units_to_pixels),u_image:new l.Uniform1i(n,o.u_image),u_image_height:new l.Uniform1f(n,o.u_image_height)}},linePattern:function(n,o){return{u_matrix:new l.UniformMatrix4f(n,o.u_matrix),u_texsize:new l.Uniform2f(n,o.u_texsize),u_ratio:new l.Uniform1f(n,o.u_ratio),u_device_pixel_ratio:new l.Uniform1f(n,o.u_device_pixel_ratio),u_image:new l.Uniform1i(n,o.u_image),u_units_to_pixels:new l.Uniform2f(n,o.u_units_to_pixels),u_scale:new l.Uniform3f(n,o.u_scale),u_fade:new l.Uniform1f(n,o.u_fade)}},lineSDF:function(n,o){return{u_matrix:new l.UniformMatrix4f(n,o.u_matrix),u_ratio:new l.Uniform1f(n,o.u_ratio),u_device_pixel_ratio:new l.Uniform1f(n,o.u_device_pixel_ratio),u_units_to_pixels:new l.Uniform2f(n,o.u_units_to_pixels),u_patternscale_a:new l.Uniform2f(n,o.u_patternscale_a),u_patternscale_b:new l.Uniform2f(n,o.u_patternscale_b),u_sdfgamma:new l.Uniform1f(n,o.u_sdfgamma),u_image:new l.Uniform1i(n,o.u_image),u_tex_y_a:new l.Uniform1f(n,o.u_tex_y_a),u_tex_y_b:new l.Uniform1f(n,o.u_tex_y_b),u_mix:new l.Uniform1f(n,o.u_mix)}},raster:function(n,o){return{u_matrix:new l.UniformMatrix4f(n,o.u_matrix),u_tl_parent:new l.Uniform2f(n,o.u_tl_parent),u_scale_parent:new l.Uniform1f(n,o.u_scale_parent),u_buffer_scale:new l.Uniform1f(n,o.u_buffer_scale),u_fade_t:new l.Uniform1f(n,o.u_fade_t),u_opacity:new l.Uniform1f(n,o.u_opacity),u_image0:new l.Uniform1i(n,o.u_image0),u_image1:new l.Uniform1i(n,o.u_image1),u_brightness_low:new l.Uniform1f(n,o.u_brightness_low),u_brightness_high:new l.Uniform1f(n,o.u_brightness_high),u_saturation_factor:new l.Uniform1f(n,o.u_saturation_factor),u_contrast_factor:new l.Uniform1f(n,o.u_contrast_factor),u_spin_weights:new l.Uniform3f(n,o.u_spin_weights)}},symbolIcon:function(n,o){return{u_is_size_zoom_constant:new l.Uniform1i(n,o.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(n,o.u_is_size_feature_constant),u_size_t:new l.Uniform1f(n,o.u_size_t),u_size:new l.Uniform1f(n,o.u_size),u_camera_to_center_distance:new l.Uniform1f(n,o.u_camera_to_center_distance),u_pitch:new l.Uniform1f(n,o.u_pitch),u_rotate_symbol:new l.Uniform1i(n,o.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(n,o.u_aspect_ratio),u_fade_change:new l.Uniform1f(n,o.u_fade_change),u_matrix:new l.UniformMatrix4f(n,o.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(n,o.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(n,o.u_coord_matrix),u_is_text:new l.Uniform1i(n,o.u_is_text),u_pitch_with_map:new l.Uniform1i(n,o.u_pitch_with_map),u_texsize:new l.Uniform2f(n,o.u_texsize),u_texture:new l.Uniform1i(n,o.u_texture)}},symbolSDF:function(n,o){return{u_is_size_zoom_constant:new l.Uniform1i(n,o.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(n,o.u_is_size_feature_constant),u_size_t:new l.Uniform1f(n,o.u_size_t),u_size:new l.Uniform1f(n,o.u_size),u_camera_to_center_distance:new l.Uniform1f(n,o.u_camera_to_center_distance),u_pitch:new l.Uniform1f(n,o.u_pitch),u_rotate_symbol:new l.Uniform1i(n,o.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(n,o.u_aspect_ratio),u_fade_change:new l.Uniform1f(n,o.u_fade_change),u_matrix:new l.UniformMatrix4f(n,o.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(n,o.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(n,o.u_coord_matrix),u_is_text:new l.Uniform1i(n,o.u_is_text),u_pitch_with_map:new l.Uniform1i(n,o.u_pitch_with_map),u_texsize:new l.Uniform2f(n,o.u_texsize),u_texture:new l.Uniform1i(n,o.u_texture),u_gamma_scale:new l.Uniform1f(n,o.u_gamma_scale),u_device_pixel_ratio:new l.Uniform1f(n,o.u_device_pixel_ratio),u_is_halo:new l.Uniform1i(n,o.u_is_halo)}},symbolTextAndIcon:function(n,o){return{u_is_size_zoom_constant:new l.Uniform1i(n,o.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(n,o.u_is_size_feature_constant),u_size_t:new l.Uniform1f(n,o.u_size_t),u_size:new l.Uniform1f(n,o.u_size),u_camera_to_center_distance:new l.Uniform1f(n,o.u_camera_to_center_distance),u_pitch:new l.Uniform1f(n,o.u_pitch),u_rotate_symbol:new l.Uniform1i(n,o.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(n,o.u_aspect_ratio),u_fade_change:new l.Uniform1f(n,o.u_fade_change),u_matrix:new l.UniformMatrix4f(n,o.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(n,o.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(n,o.u_coord_matrix),u_is_text:new l.Uniform1i(n,o.u_is_text),u_pitch_with_map:new l.Uniform1i(n,o.u_pitch_with_map),u_texsize:new l.Uniform2f(n,o.u_texsize),u_texsize_icon:new l.Uniform2f(n,o.u_texsize_icon),u_texture:new l.Uniform1i(n,o.u_texture),u_texture_icon:new l.Uniform1i(n,o.u_texture_icon),u_gamma_scale:new l.Uniform1f(n,o.u_gamma_scale),u_device_pixel_ratio:new l.Uniform1f(n,o.u_device_pixel_ratio),u_is_halo:new l.Uniform1i(n,o.u_is_halo)}},background:function(n,o){return{u_matrix:new l.UniformMatrix4f(n,o.u_matrix),u_opacity:new l.Uniform1f(n,o.u_opacity),u_color:new l.UniformColor(n,o.u_color)}},backgroundPattern:function(n,o){return{u_matrix:new l.UniformMatrix4f(n,o.u_matrix),u_opacity:new l.Uniform1f(n,o.u_opacity),u_image:new l.Uniform1i(n,o.u_image),u_pattern_tl_a:new l.Uniform2f(n,o.u_pattern_tl_a),u_pattern_br_a:new l.Uniform2f(n,o.u_pattern_br_a),u_pattern_tl_b:new l.Uniform2f(n,o.u_pattern_tl_b),u_pattern_br_b:new l.Uniform2f(n,o.u_pattern_br_b),u_texsize:new l.Uniform2f(n,o.u_texsize),u_mix:new l.Uniform1f(n,o.u_mix),u_pattern_size_a:new l.Uniform2f(n,o.u_pattern_size_a),u_pattern_size_b:new l.Uniform2f(n,o.u_pattern_size_b),u_scale_a:new l.Uniform1f(n,o.u_scale_a),u_scale_b:new l.Uniform1f(n,o.u_scale_b),u_pixel_coord_upper:new l.Uniform2f(n,o.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(n,o.u_pixel_coord_lower),u_tile_units_to_pixels:new l.Uniform1f(n,o.u_tile_units_to_pixels)}}};function ko(n,o,i,s,p,d,m){for(var _=n.context,S=_.gl,P=n.useProgram("collisionBox"),B=[],F=0,N=0,H=0;H<s.length;H++){var W=s[H],ee=o.getTile(W),q=ee.getBucket(i);if(q){var Q=W.posMatrix;p[0]===0&&p[1]===0||(Q=n.translatePosMatrix(W.posMatrix,ee,p,d));var ae=m?q.textCollisionBox:q.iconCollisionBox,me=q.collisionCircleArray;if(me.length>0){var Ce=l.create(),we=Q;l.mul(Ce,q.placementInvProjMatrix,n.transform.glCoordMatrix),l.mul(Ce,Ce,q.placementViewportMatrix),B.push({circleArray:me,circleOffset:N,transform:we,invTransform:Ce}),N=F+=me.length/4}ae&&P.draw(_,S.LINES,U.disabled,G.disabled,n.colorModeForRenderPass(),$.disabled,uo(Q,n.transform,ee),i.id,ae.layoutVertexBuffer,ae.indexBuffer,ae.segments,null,n.transform.zoom,null,null,ae.collisionVertexBuffer)}}if(m&&B.length){var Ae=n.useProgram("collisionCircle"),Re=new l.StructArrayLayout2f1f2i16;Re.resize(4*F),Re._trim();for(var Ze=0,qe=0,ct=B;qe<ct.length;qe+=1)for(var Et=ct[qe],Ct=0;Ct<Et.circleArray.length/4;Ct++){var It=4*Ct,mr=Et.circleArray[It+0],dt=Et.circleArray[It+1],Vt=Et.circleArray[It+2],Jt=Et.circleArray[It+3];Re.emplace(Ze++,mr,dt,Vt,Jt,0),Re.emplace(Ze++,mr,dt,Vt,Jt,1),Re.emplace(Ze++,mr,dt,Vt,Jt,2),Re.emplace(Ze++,mr,dt,Vt,Jt,3)}(!za||za.length<2*F)&&(za=function(on){var ii=2*on,Zn=new l.StructArrayLayout3ui6;Zn.resize(ii),Zn._trim();for(var Yr=0;Yr<ii;Yr++){var hn=6*Yr;Zn.uint16[hn+0]=4*Yr+0,Zn.uint16[hn+1]=4*Yr+1,Zn.uint16[hn+2]=4*Yr+2,Zn.uint16[hn+3]=4*Yr+2,Zn.uint16[hn+4]=4*Yr+3,Zn.uint16[hn+5]=4*Yr+0}return Zn}(F));for(var Ft=_.createIndexBuffer(za,!0),Ot=_.createVertexBuffer(Re,l.collisionCircleLayout.members,!0),Xt=0,zt=B;Xt<zt.length;Xt+=1){var kt=zt[Xt],On=js(kt.transform,kt.invTransform,n.transform);Ae.draw(_,S.TRIANGLES,U.disabled,G.disabled,n.colorModeForRenderPass(),$.disabled,On,i.id,Ot,Ft,l.SegmentVector.simpleSegment(0,2*kt.circleOffset,kt.circleArray.length,kt.circleArray.length/2),null,n.transform.zoom,null,null,null)}Ot.destroy(),Ft.destroy()}}var nn=l.identity(new Float32Array(16));function Gs(n,o,i,s,p,d){var m=l.getAnchorAlignment(n),_=-(m.horizontalAlign-.5)*o,S=-(m.verticalAlign-.5)*i,P=l.evaluateVariableOffset(n,s);return new l.Point((_/p+P[0])*d,(S/p+P[1])*d)}function ts(n,o,i,s,p,d,m,_,S,P,B){var F=n.text.placedSymbolArray,N=n.text.dynamicLayoutVertexArray,H=n.icon.dynamicLayoutVertexArray,W={};N.clear();for(var ee=0;ee<F.length;ee++){var q=F.get(ee),Q=q.hidden||!q.crossTileID||n.allowVerticalPlacement&&!q.placedOrientation?null:s[q.crossTileID];if(Q){var ae=new l.Point(q.anchorX,q.anchorY),me=Zt(ae,i?_:m),Ce=pr(d.cameraToCenterDistance,me.signedDistanceFromCamera),we=p.evaluateSizeForFeature(n.textSizeData,P,q)*Ce/l.ONE_EM;i&&(we*=n.tilePixelRatio/S);for(var Ae=Gs(Q.anchor,Q.width,Q.height,Q.textOffset,Q.textBoxScale,we),Re=i?Zt(ae.add(Ae),m).point:me.point.add(o?Ae.rotate(-d.angle):Ae),Ze=n.allowVerticalPlacement&&q.placedOrientation===l.WritingMode.vertical?Math.PI/2:0,qe=0;qe<q.numGlyphs;qe++)l.addDynamicAttributes(N,Re,Ze);B&&q.associatedIconIndex>=0&&(W[q.associatedIconIndex]={shiftedAnchor:Re,angle:Ze})}else Ge(q.numGlyphs,N)}if(B){H.clear();for(var ct=n.icon.placedSymbolArray,Et=0;Et<ct.length;Et++){var Ct=ct.get(Et);if(Ct.hidden)Ge(Ct.numGlyphs,H);else{var It=W[Et];if(It)for(var mr=0;mr<Ct.numGlyphs;mr++)l.addDynamicAttributes(H,It.shiftedAnchor,It.angle);else Ge(Ct.numGlyphs,H)}}n.icon.dynamicLayoutVertexBuffer.updateData(H)}n.text.dynamicLayoutVertexBuffer.updateData(N)}function bs(n,o,i){return i.iconsInText&&o?"symbolTextAndIcon":n?"symbolSDF":"symbolIcon"}function Ci(n,o,i,s,p,d,m,_,S,P,B,F){for(var N=n.context,H=N.gl,W=n.transform,ee=_==="map",q=S==="map",Q=ee&&i.layout.get("symbol-placement")!=="point",ae=ee&&!q&&!Q,me=i.layout.get("symbol-sort-key").constantOr(1)!==void 0,Ce=!1,we=n.depthModeForSublayer(0,U.ReadOnly),Ae=i.layout.get("text-variable-anchor"),Re=[],Ze=0,qe=s;Ze<qe.length;Ze+=1){var ct=qe[Ze],Et=o.getTile(ct),Ct=Et.getBucket(i);if(Ct){var It=p?Ct.text:Ct.icon;if(It&&It.segments.get().length){var mr=It.programConfigurations.get(i.id),dt=p||Ct.sdfIcons,Vt=p?Ct.textSizeData:Ct.iconSizeData,Jt=q||W.pitch!==0,Ft=n.useProgram(bs(dt,p,Ct),mr),Ot=l.evaluateSizeForZoom(Vt,W.zoom),Xt=void 0,zt=[0,0],kt=void 0,On=void 0,on=null,ii=void 0;if(p)kt=Et.glyphAtlasTexture,On=H.LINEAR,Xt=Et.glyphAtlasTexture.size,Ct.iconsInText&&(zt=Et.imageAtlasTexture.size,on=Et.imageAtlasTexture,ii=Jt||n.options.rotating||n.options.zooming||Vt.kind==="composite"||Vt.kind==="camera"?H.LINEAR:H.NEAREST);else{var Zn=i.layout.get("icon-size").constantOr(0)!==1||Ct.iconsNeedLinear;kt=Et.imageAtlasTexture,On=dt||n.options.rotating||n.options.zooming||Zn||Jt?H.LINEAR:H.NEAREST,Xt=Et.imageAtlasTexture.size}var Yr=st(Et,1,n.transform.zoom),hn=zr(ct.posMatrix,q,ee,n.transform,Yr),Xi=vr(ct.posMatrix,q,ee,n.transform,Yr),di=Ae&&Ct.hasTextData(),ga=i.layout.get("icon-text-fit")!=="none"&&di&&Ct.hasIconData();Q&&v(Ct,ct.posMatrix,n,p,hn,Xi,q,P);var Ai=n.translatePosMatrix(ct.posMatrix,Et,d,m),Ro=Q||p&&Ae||ga?nn:hn,fo=n.translatePosMatrix(Xi,Et,d,m,!0),Is=dt&&i.paint.get(p?"text-halo-width":"icon-halo-width").constantOr(1)!==0,os={program:Ft,buffers:It,uniformValues:dt?Ct.iconsInText?es(Vt.kind,Ot,ae,q,n,Ai,Ro,fo,Xt,zt):Da(Vt.kind,Ot,ae,q,n,Ai,Ro,fo,p,Xt):ha(Vt.kind,Ot,ae,q,n,Ai,Ro,fo,p,Xt),atlasTexture:kt,atlasTextureIcon:on,atlasInterpolation:On,atlasInterpolationIcon:ii,isSDF:dt,hasHalo:Is};if(me&&Ct.canOverlap){Ce=!0;for(var va=0,as=It.segments.get();va<as.length;va+=1){var Cs=as[va];Re.push({segments:new l.SegmentVector([Cs]),sortKey:Cs.sortKey,state:os})}}else Re.push({segments:It.segments,sortKey:0,state:os})}}}Ce&&Re.sort(function(_a,Fa){return _a.sortKey-Fa.sortKey});for(var Xo=0,As=Re;Xo<As.length;Xo+=1){var Wo=As[Xo],Rn=Wo.state;if(N.activeTexture.set(H.TEXTURE0),Rn.atlasTexture.bind(Rn.atlasInterpolation,H.CLAMP_TO_EDGE),Rn.atlasTextureIcon&&(N.activeTexture.set(H.TEXTURE1),Rn.atlasTextureIcon&&Rn.atlasTextureIcon.bind(Rn.atlasInterpolationIcon,H.CLAMP_TO_EDGE)),Rn.isSDF){var ta=Rn.uniformValues;Rn.hasHalo&&(ta.u_is_halo=1,$o(Rn.buffers,Wo.segments,i,n,Rn.program,we,B,F,ta)),ta.u_is_halo=0}$o(Rn.buffers,Wo.segments,i,n,Rn.program,we,B,F,Rn.uniformValues)}}function $o(n,o,i,s,p,d,m,_,S){var P=s.context;p.draw(P,P.gl.TRIANGLES,d,m,_,$.disabled,S,i.id,n.layoutVertexBuffer,n.indexBuffer,o,i.paint,s.transform.zoom,n.programConfigurations.get(i.id),n.dynamicLayoutVertexBuffer,n.opacityVertexBuffer)}function Mo(n,o,i,s,p,d,m){var _,S,P,B,F,N=n.context.gl,H=i.paint.get("fill-pattern"),W=H&&H.constantOr(1),ee=i.getCrossfadeParameters();m?(S=W&&!i.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",_=N.LINES):(S=W?"fillPattern":"fill",_=N.TRIANGLES);for(var q=0,Q=s;q<Q.length;q+=1){var ae=Q[q],me=o.getTile(ae);if(!W||me.patternsLoaded()){var Ce=me.getBucket(i);if(Ce){var we=Ce.programConfigurations.get(i.id),Ae=n.useProgram(S,we);W&&(n.context.activeTexture.set(N.TEXTURE0),me.imageAtlasTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),we.updatePaintBuffers(ee));var Re=H.constantOr(null);if(Re&&me.imageAtlas){var Ze=me.imageAtlas,qe=Ze.patternPositions[Re.to.toString()],ct=Ze.patternPositions[Re.from.toString()];qe&&ct&&we.setConstantPatternPositions(qe,ct)}var Et=n.translatePosMatrix(ae.posMatrix,me,i.paint.get("fill-translate"),i.paint.get("fill-translate-anchor"));if(m){B=Ce.indexBuffer2,F=Ce.segments2;var Ct=[N.drawingBufferWidth,N.drawingBufferHeight];P=S==="fillOutlinePattern"&&W?Vs(Et,n,ee,me,Ct):gs(Et,Ct)}else B=Ce.indexBuffer,F=Ce.segments,P=W?Co(Et,n,ee,me):Qi(Et);Ae.draw(n.context,_,p,n.stencilModeForClipping(ae),d,$.disabled,P,i.id,Ce.layoutVertexBuffer,B,F,i.paint,n.transform.zoom,we)}}}}function lo(n,o,i,s,p,d,m){for(var _=n.context,S=_.gl,P=i.paint.get("fill-extrusion-pattern"),B=P.constantOr(1),F=i.getCrossfadeParameters(),N=i.paint.get("fill-extrusion-opacity"),H=0,W=s;H<W.length;H+=1){var ee=W[H],q=o.getTile(ee),Q=q.getBucket(i);if(Q){var ae=Q.programConfigurations.get(i.id),me=n.useProgram(B?"fillExtrusionPattern":"fillExtrusion",ae);B&&(n.context.activeTexture.set(S.TEXTURE0),q.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),ae.updatePaintBuffers(F));var Ce=P.constantOr(null);if(Ce&&q.imageAtlas){var we=q.imageAtlas,Ae=we.patternPositions[Ce.to.toString()],Re=we.patternPositions[Ce.from.toString()];Ae&&Re&&ae.setConstantPatternPositions(Ae,Re)}var Ze=n.translatePosMatrix(ee.posMatrix,q,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),qe=i.paint.get("fill-extrusion-vertical-gradient"),ct=B?Io(Ze,n,qe,N,ee,F,q):Qa(Ze,n,qe,N);me.draw(_,_.gl.TRIANGLES,p,d,m,$.backCCW,ct,i.id,Q.layoutVertexBuffer,Q.indexBuffer,Q.segments,i.paint,n.transform.zoom,ae)}}}function La(n,o,i,s,p,d){var m=n.context,_=m.gl,S=o.fbo;if(S){var P=n.useProgram("hillshade");m.activeTexture.set(_.TEXTURE0),_.bindTexture(_.TEXTURE_2D,S.colorAttachment.get());var B=function(F,N,H){var W=H.paint.get("hillshade-shadow-color"),ee=H.paint.get("hillshade-highlight-color"),q=H.paint.get("hillshade-accent-color"),Q=H.paint.get("hillshade-illumination-direction")*(Math.PI/180);H.paint.get("hillshade-illumination-anchor")==="viewport"&&(Q-=F.transform.angle);var ae,me,Ce,we=!F.options.moving;return{u_matrix:F.transform.calculatePosMatrix(N.tileID.toUnwrapped(),we),u_image:0,u_latrange:(ae=N.tileID,me=Math.pow(2,ae.canonical.z),Ce=ae.canonical.y,[new l.MercatorCoordinate(0,Ce/me).toLngLat().lat,new l.MercatorCoordinate(0,(Ce+1)/me).toLngLat().lat]),u_light:[H.paint.get("hillshade-exaggeration"),Q],u_shadow:W,u_highlight:ee,u_accent:q}}(n,o,i);P.draw(m,_.TRIANGLES,s,p,d,$.disabled,B,i.id,n.rasterBoundsBuffer,n.quadTriangleIndexBuffer,n.rasterBoundsSegments)}}function h(n,o,i,s,p,d){var m=n.context,_=m.gl,S=o.dem;if(S&&S.data){var P=S.dim,B=S.stride,F=S.getPixels();if(m.activeTexture.set(_.TEXTURE1),m.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||n.getTileTexture(B),o.demTexture){var N=o.demTexture;N.update(F,{premultiply:!1}),N.bind(_.NEAREST,_.CLAMP_TO_EDGE)}else o.demTexture=new l.Texture(m,F,_.RGBA,{premultiply:!1}),o.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE);m.activeTexture.set(_.TEXTURE0);var H=o.fbo;if(!H){var W=new l.Texture(m,{width:P,height:P,data:null},_.RGBA);W.bind(_.LINEAR,_.CLAMP_TO_EDGE),(H=o.fbo=m.createFramebuffer(P,P,!0)).colorAttachment.set(W.texture)}m.bindFramebuffer.set(H.framebuffer),m.viewport.set([0,0,P,P]),n.useProgram("hillshadePrepare").draw(m,_.TRIANGLES,s,p,d,$.disabled,function(ee,q){var Q=q.stride,ae=l.create();return l.ortho(ae,0,l.EXTENT,-l.EXTENT,0,0,1),l.translate(ae,ae,[0,-l.EXTENT,0]),{u_matrix:ae,u_image:1,u_dimension:[Q,Q],u_zoom:ee.overscaledZ,u_unpack:q.getUnpackVector()}}(o.tileID,S),i.id,n.rasterBoundsBuffer,n.quadTriangleIndexBuffer,n.rasterBoundsSegments),o.needsHillshadePrepare=!1}}function g(n,o,i,s,p){var d=s.paint.get("raster-fade-duration");if(d>0){var m=l.browser.now(),_=(m-n.timeAdded)/d,S=o?(m-o.timeAdded)/d:-1,P=i.getSource(),B=p.coveringZoomLevel({tileSize:P.tileSize,roundZoom:P.roundZoom}),F=!o||Math.abs(o.tileID.overscaledZ-B)>Math.abs(n.tileID.overscaledZ-B),N=F&&n.refreshedUponExpiration?1:l.clamp(F?_:1-S,0,1);return n.refreshedUponExpiration&&_>=1&&(n.refreshedUponExpiration=!1),o?{opacity:1,mix:1-N}:{opacity:N,mix:0}}return{opacity:1,mix:0}}var b=new l.Color(1,0,0,1),T=new l.Color(0,1,0,1),k=new l.Color(0,0,1,1),R=new l.Color(1,0,1,1),K=new l.Color(0,1,1,1);function te(n,o,i,s){he(n,0,o+i/2,n.transform.width,i,s)}function le(n,o,i,s){he(n,o-i/2,0,i,n.transform.height,s)}function he(n,o,i,s,p,d){var m=n.context,_=m.gl;_.enable(_.SCISSOR_TEST),_.scissor(o*l.browser.devicePixelRatio,i*l.browser.devicePixelRatio,s*l.browser.devicePixelRatio,p*l.browser.devicePixelRatio),m.clear({color:d}),_.disable(_.SCISSOR_TEST)}function ge(n,o,i){var s=n.context,p=s.gl,d=i.posMatrix,m=n.useProgram("debug"),_=U.disabled,S=G.disabled,P=n.colorModeForRenderPass();s.activeTexture.set(p.TEXTURE0),n.emptyTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE),m.draw(s,p.LINE_STRIP,_,S,P,$.disabled,Ao(d,l.Color.red),"$debug",n.debugBuffer,n.tileBorderIndexBuffer,n.debugSegments);var B=o.getTileByID(i.key).latestRawTileData,F=Math.floor((B&&B.byteLength||0)/1024),N=o.getTile(i).tileSize,H=512/Math.min(N,512)*(i.overscaledZ/n.transform.zoom)*.5,W=i.canonical.toString();i.overscaledZ!==i.canonical.z&&(W+=" => "+i.overscaledZ),function(ee,q){ee.initDebugOverlayCanvas();var Q=ee.debugOverlayCanvas,ae=ee.context.gl,me=ee.debugOverlayCanvas.getContext("2d");me.clearRect(0,0,Q.width,Q.height),me.shadowColor="white",me.shadowBlur=2,me.lineWidth=1.5,me.strokeStyle="white",me.textBaseline="top",me.font="bold 36px Open Sans, sans-serif",me.fillText(q,5,5),me.strokeText(q,5,5),ee.debugOverlayTexture.update(Q),ee.debugOverlayTexture.bind(ae.LINEAR,ae.CLAMP_TO_EDGE)}(n,W+" "+F+"kb"),m.draw(s,p.TRIANGLES,_,S,ne.alphaBlended,$.disabled,Ao(d,l.Color.transparent,H),"$debug",n.debugBuffer,n.quadTriangleIndexBuffer,n.debugSegments)}var ie={symbol:function(n,o,i,s,p){if(n.renderPass==="translucent"){var d=G.disabled,m=n.colorModeForRenderPass();i.layout.get("text-variable-anchor")&&function(_,S,P,B,F,N,H){for(var W=S.transform,ee=F==="map",q=N==="map",Q=0,ae=_;Q<ae.length;Q+=1){var me=ae[Q],Ce=B.getTile(me),we=Ce.getBucket(P);if(we&&we.text&&we.text.segments.get().length){var Ae=l.evaluateSizeForZoom(we.textSizeData,W.zoom),Re=st(Ce,1,S.transform.zoom),Ze=zr(me.posMatrix,q,ee,S.transform,Re),qe=P.layout.get("icon-text-fit")!=="none"&&we.hasIconData();if(Ae){var ct=Math.pow(2,W.zoom-Ce.tileID.overscaledZ);ts(we,ee,q,H,l.symbolSize,W,Ze,me.posMatrix,ct,Ae,qe)}}}}(s,n,i,o,i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),p),i.paint.get("icon-opacity").constantOr(1)!==0&&Ci(n,o,i,s,!1,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),i.layout.get("icon-rotation-alignment"),i.layout.get("icon-pitch-alignment"),i.layout.get("icon-keep-upright"),d,m),i.paint.get("text-opacity").constantOr(1)!==0&&Ci(n,o,i,s,!0,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),i.layout.get("text-keep-upright"),d,m),o.map.showCollisionBoxes&&(ko(n,o,i,s,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),!0),ko(n,o,i,s,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),!1))}},circle:function(n,o,i,s){if(n.renderPass==="translucent"){var p=i.paint.get("circle-opacity"),d=i.paint.get("circle-stroke-width"),m=i.paint.get("circle-stroke-opacity"),_=i.layout.get("circle-sort-key").constantOr(1)!==void 0;if(p.constantOr(1)!==0||d.constantOr(1)!==0&&m.constantOr(1)!==0){for(var S=n.context,P=S.gl,B=n.depthModeForSublayer(0,U.ReadOnly),F=G.disabled,N=n.colorModeForRenderPass(),H=[],W=0;W<s.length;W++){var ee=s[W],q=o.getTile(ee),Q=q.getBucket(i);if(Q){var ae=Q.programConfigurations.get(i.id),me={programConfiguration:ae,program:n.useProgram("circle",ae),layoutVertexBuffer:Q.layoutVertexBuffer,indexBuffer:Q.indexBuffer,uniformValues:ka(n,ee,q,i)};if(_)for(var Ce=0,we=Q.segments.get();Ce<we.length;Ce+=1){var Ae=we[Ce];H.push({segments:new l.SegmentVector([Ae]),sortKey:Ae.sortKey,state:me})}else H.push({segments:Q.segments,sortKey:0,state:me})}}_&&H.sort(function(Et,Ct){return Et.sortKey-Ct.sortKey});for(var Re=0,Ze=H;Re<Ze.length;Re+=1){var qe=Ze[Re],ct=qe.state;ct.program.draw(S,P.TRIANGLES,B,F,N,$.disabled,ct.uniformValues,i.id,ct.layoutVertexBuffer,ct.indexBuffer,qe.segments,i.paint,n.transform.zoom,ct.programConfiguration)}}}},heatmap:function(n,o,i,s){if(i.paint.get("heatmap-opacity")!==0)if(n.renderPass==="offscreen"){var p=n.context,d=p.gl,m=G.disabled,_=new ne([d.ONE,d.ONE],l.Color.transparent,[!0,!0,!0,!0]);(function(H,W,ee){var q=H.gl;H.activeTexture.set(q.TEXTURE1),H.viewport.set([0,0,W.width/4,W.height/4]);var Q=ee.heatmapFbo;if(Q)q.bindTexture(q.TEXTURE_2D,Q.colorAttachment.get()),H.bindFramebuffer.set(Q.framebuffer);else{var ae=q.createTexture();q.bindTexture(q.TEXTURE_2D,ae),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MIN_FILTER,q.LINEAR),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MAG_FILTER,q.LINEAR),Q=ee.heatmapFbo=H.createFramebuffer(W.width/4,W.height/4,!1),function(me,Ce,we,Ae){var Re=me.gl;Re.texImage2D(Re.TEXTURE_2D,0,Re.RGBA,Ce.width/4,Ce.height/4,0,Re.RGBA,me.extRenderToTextureHalfFloat?me.extTextureHalfFloat.HALF_FLOAT_OES:Re.UNSIGNED_BYTE,null),Ae.colorAttachment.set(we)}(H,W,ae,Q)}})(p,n,i),p.clear({color:l.Color.transparent});for(var S=0;S<s.length;S++){var P=s[S];if(!o.hasRenderableParent(P)){var B=o.getTile(P),F=B.getBucket(i);if(F){var N=F.programConfigurations.get(i.id);n.useProgram("heatmap",N).draw(p,d.TRIANGLES,U.disabled,m,_,$.disabled,qs(P.posMatrix,B,n.transform.zoom,i.paint.get("heatmap-intensity")),i.id,F.layoutVertexBuffer,F.indexBuffer,F.segments,i.paint,n.transform.zoom,N)}}}p.viewport.set([0,0,n.width,n.height])}else n.renderPass==="translucent"&&(n.context.setColorMode(n.colorModeForRenderPass()),function(H,W){var ee=H.context,q=ee.gl,Q=W.heatmapFbo;if(Q){ee.activeTexture.set(q.TEXTURE0),q.bindTexture(q.TEXTURE_2D,Q.colorAttachment.get()),ee.activeTexture.set(q.TEXTURE1);var ae=W.colorRampTexture;ae||(ae=W.colorRampTexture=new l.Texture(ee,W.colorRamp,q.RGBA)),ae.bind(q.LINEAR,q.CLAMP_TO_EDGE),H.useProgram("heatmapTexture").draw(ee,q.TRIANGLES,U.disabled,G.disabled,H.colorModeForRenderPass(),$.disabled,function(me,Ce,we,Ae){var Re=l.create();l.ortho(Re,0,me.width,me.height,0,0,1);var Ze=me.context.gl;return{u_matrix:Re,u_world:[Ze.drawingBufferWidth,Ze.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:Ce.paint.get("heatmap-opacity")}}(H,W),W.id,H.viewportBuffer,H.quadTriangleIndexBuffer,H.viewportSegments,W.paint,H.transform.zoom)}}(n,i))},line:function(n,o,i,s){if(n.renderPass==="translucent"){var p=i.paint.get("line-opacity"),d=i.paint.get("line-width");if(p.constantOr(1)!==0&&d.constantOr(1)!==0)for(var m=n.depthModeForSublayer(0,U.ReadOnly),_=n.colorModeForRenderPass(),S=i.paint.get("line-dasharray"),P=i.paint.get("line-pattern"),B=P.constantOr(1),F=i.paint.get("line-gradient"),N=i.getCrossfadeParameters(),H=B?"linePattern":S?"lineSDF":F?"lineGradient":"line",W=n.context,ee=W.gl,q=!0,Q=0,ae=s;Q<ae.length;Q+=1){var me=ae[Q],Ce=o.getTile(me);if(!B||Ce.patternsLoaded()){var we=Ce.getBucket(i);if(we){var Ae=we.programConfigurations.get(i.id),Re=n.context.program.get(),Ze=n.useProgram(H,Ae),qe=q||Ze.program!==Re,ct=P.constantOr(null);if(ct&&Ce.imageAtlas){var Et=Ce.imageAtlas,Ct=Et.patternPositions[ct.to.toString()],It=Et.patternPositions[ct.from.toString()];Ct&&It&&Ae.setConstantPatternPositions(Ct,It)}var mr=B?Ma(n,Ce,i,N):S?Zs(n,Ce,i,S,N):F?kr(n,Ce,i,we.lineClipsArray.length):ca(n,Ce,i);if(B)W.activeTexture.set(ee.TEXTURE0),Ce.imageAtlasTexture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE),Ae.updatePaintBuffers(N);else if(S&&(qe||n.lineAtlas.dirty))W.activeTexture.set(ee.TEXTURE0),n.lineAtlas.bind(W);else if(F){var dt=we.gradients[i.id],Vt=dt.texture;if(i.gradientVersion!==dt.version){var Jt=256;if(i.stepInterpolant){var Ft=o.getSource().maxzoom,Ot=me.canonical.z===Ft?Math.ceil(1<<n.transform.maxZoom-me.canonical.z):1;Jt=l.clamp(l.nextPowerOfTwo(we.maxLineLength/l.EXTENT*1024*Ot),256,W.maxTextureSize)}dt.gradient=l.renderColorRamp({expression:i.gradientExpression(),evaluationKey:"lineProgress",resolution:Jt,image:dt.gradient||void 0,clips:we.lineClipsArray}),dt.texture?dt.texture.update(dt.gradient):dt.texture=new l.Texture(W,dt.gradient,ee.RGBA),dt.version=i.gradientVersion,Vt=dt.texture}W.activeTexture.set(ee.TEXTURE0),Vt.bind(i.stepInterpolant?ee.NEAREST:ee.LINEAR,ee.CLAMP_TO_EDGE)}Ze.draw(W,ee.TRIANGLES,m,n.stencilModeForClipping(me),_,$.disabled,mr,i.id,we.layoutVertexBuffer,we.indexBuffer,we.segments,i.paint,n.transform.zoom,Ae,we.layoutVertexBuffer2),q=!1}}}}},fill:function(n,o,i,s){var p=i.paint.get("fill-color"),d=i.paint.get("fill-opacity");if(d.constantOr(1)!==0){var m=n.colorModeForRenderPass(),_=i.paint.get("fill-pattern"),S=n.opaquePassEnabledForLayer()&&!_.constantOr(1)&&p.constantOr(l.Color.transparent).a===1&&d.constantOr(0)===1?"opaque":"translucent";if(n.renderPass===S){var P=n.depthModeForSublayer(1,n.renderPass==="opaque"?U.ReadWrite:U.ReadOnly);Mo(n,o,i,s,P,m,!1)}if(n.renderPass==="translucent"&&i.paint.get("fill-antialias")){var B=n.depthModeForSublayer(i.getPaintProperty("fill-outline-color")?2:0,U.ReadOnly);Mo(n,o,i,s,B,m,!0)}}},"fill-extrusion":function(n,o,i,s){var p=i.paint.get("fill-extrusion-opacity");if(p!==0&&n.renderPass==="translucent"){var d=new U(n.context.gl.LEQUAL,U.ReadWrite,n.depthRangeFor3D);if(p!==1||i.paint.get("fill-extrusion-pattern").constantOr(1))lo(n,o,i,s,d,G.disabled,ne.disabled),lo(n,o,i,s,d,n.stencilModeFor3D(),n.colorModeForRenderPass());else{var m=n.colorModeForRenderPass();lo(n,o,i,s,d,G.disabled,m)}}},hillshade:function(n,o,i,s){if(n.renderPass==="offscreen"||n.renderPass==="translucent"){for(var p=n.context,d=n.depthModeForSublayer(0,U.ReadOnly),m=n.colorModeForRenderPass(),_=n.renderPass==="translucent"?n.stencilConfigForOverlap(s):[{},s],S=_[0],P=0,B=_[1];P<B.length;P+=1){var F=B[P],N=o.getTile(F);N.needsHillshadePrepare&&n.renderPass==="offscreen"?h(n,N,i,d,G.disabled,m):n.renderPass==="translucent"&&La(n,N,i,d,S[F.overscaledZ],m)}p.viewport.set([0,0,n.width,n.height])}},raster:function(n,o,i,s){if(n.renderPass==="translucent"&&i.paint.get("raster-opacity")!==0&&s.length)for(var p=n.context,d=p.gl,m=o.getSource(),_=n.useProgram("raster"),S=n.colorModeForRenderPass(),P=m instanceof Di?[{},s]:n.stencilConfigForOverlap(s),B=P[0],F=P[1],N=F[F.length-1].overscaledZ,H=!n.options.moving,W=0,ee=F;W<ee.length;W+=1){var q=ee[W],Q=n.depthModeForSublayer(q.overscaledZ-N,i.paint.get("raster-opacity")===1?U.ReadWrite:U.ReadOnly,d.LESS),ae=o.getTile(q),me=n.transform.calculatePosMatrix(q.toUnwrapped(),H);ae.registerFadeDuration(i.paint.get("raster-fade-duration"));var Ce=o.findLoadedParent(q,0),we=g(ae,Ce,o,i,n.transform),Ae=void 0,Re=void 0,Ze=i.paint.get("raster-resampling")==="nearest"?d.NEAREST:d.LINEAR;p.activeTexture.set(d.TEXTURE0),ae.texture.bind(Ze,d.CLAMP_TO_EDGE,d.LINEAR_MIPMAP_NEAREST),p.activeTexture.set(d.TEXTURE1),Ce?(Ce.texture.bind(Ze,d.CLAMP_TO_EDGE,d.LINEAR_MIPMAP_NEAREST),Ae=Math.pow(2,Ce.tileID.overscaledZ-ae.tileID.overscaledZ),Re=[ae.tileID.canonical.x*Ae%1,ae.tileID.canonical.y*Ae%1]):ae.texture.bind(Ze,d.CLAMP_TO_EDGE,d.LINEAR_MIPMAP_NEAREST);var qe=_s(me,Re||[0,0],Ae||1,we,i);m instanceof Di?_.draw(p,d.TRIANGLES,Q,G.disabled,S,$.disabled,qe,i.id,m.boundsBuffer,n.quadTriangleIndexBuffer,m.boundsSegments):_.draw(p,d.TRIANGLES,Q,B[q.overscaledZ],S,$.disabled,qe,i.id,n.rasterBoundsBuffer,n.quadTriangleIndexBuffer,n.rasterBoundsSegments)}},background:function(n,o,i){var s=i.paint.get("background-color"),p=i.paint.get("background-opacity");if(p!==0){var d=n.context,m=d.gl,_=n.transform,S=_.tileSize,P=i.paint.get("background-pattern");if(!n.isPatternMissing(P)){var B=!P&&s.a===1&&p===1&&n.opaquePassEnabledForLayer()?"opaque":"translucent";if(n.renderPass===B){var F=G.disabled,N=n.depthModeForSublayer(0,B==="opaque"?U.ReadWrite:U.ReadOnly),H=n.colorModeForRenderPass(),W=n.useProgram(P?"backgroundPattern":"background"),ee=_.coveringTiles({tileSize:S});P&&(d.activeTexture.set(m.TEXTURE0),n.imageManager.bind(n.context));for(var q=i.getCrossfadeParameters(),Q=0,ae=ee;Q<ae.length;Q+=1){var me=ae[Q],Ce=n.transform.calculatePosMatrix(me.toUnwrapped()),we=P?ci(Ce,p,n,P,{tileID:me,tileSize:S},q):qo(Ce,p,s);W.draw(d,m.TRIANGLES,N,F,H,$.disabled,we,i.id,n.tileExtentBuffer,n.quadTriangleIndexBuffer,n.tileExtentSegments)}}}}},debug:function(n,o,i){for(var s=0;s<i.length;s++)ge(n,o,i[s])},custom:function(n,o,i){var s=n.context,p=i.implementation;if(n.renderPass==="offscreen"){var d=p.prerender;d&&(n.setCustomLayerDefaults(),s.setColorMode(n.colorModeForRenderPass()),d.call(p,s.gl,n.transform.customLayerMatrix()),s.setDirty(),n.setBaseState())}else if(n.renderPass==="translucent"){n.setCustomLayerDefaults(),s.setColorMode(n.colorModeForRenderPass()),s.setStencilMode(G.disabled);var m=p.renderingMode==="3d"?new U(n.context.gl.LEQUAL,U.ReadWrite,n.depthRangeFor3D):n.depthModeForSublayer(0,U.ReadOnly);s.setDepthMode(m),p.render(s.gl,n.transform.customLayerMatrix()),s.setDirty(),n.setBaseState(),s.bindFramebuffer.set(null)}}},fe=function(n,o){this.context=new L(n),this.transform=o,this._tileTextures={},this.setup(),this.numSublayers=J.maxUnderzooming+J.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new io,this.gpuTimers={}};fe.prototype.resize=function(n,o){if(this.width=n*l.browser.devicePixelRatio,this.height=o*l.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var i=0,s=this.style._order;i<s.length;i+=1)this.style._layers[s[i]].resize()},fe.prototype.setup=function(){var n=this.context,o=new l.StructArrayLayout2i4;o.emplaceBack(0,0),o.emplaceBack(l.EXTENT,0),o.emplaceBack(0,l.EXTENT),o.emplaceBack(l.EXTENT,l.EXTENT),this.tileExtentBuffer=n.createVertexBuffer(o,en.members),this.tileExtentSegments=l.SegmentVector.simpleSegment(0,0,4,2);var i=new l.StructArrayLayout2i4;i.emplaceBack(0,0),i.emplaceBack(l.EXTENT,0),i.emplaceBack(0,l.EXTENT),i.emplaceBack(l.EXTENT,l.EXTENT),this.debugBuffer=n.createVertexBuffer(i,en.members),this.debugSegments=l.SegmentVector.simpleSegment(0,0,4,5);var s=new l.StructArrayLayout4i8;s.emplaceBack(0,0,0,0),s.emplaceBack(l.EXTENT,0,l.EXTENT,0),s.emplaceBack(0,l.EXTENT,0,l.EXTENT),s.emplaceBack(l.EXTENT,l.EXTENT,l.EXTENT,l.EXTENT),this.rasterBoundsBuffer=n.createVertexBuffer(s,$n.members),this.rasterBoundsSegments=l.SegmentVector.simpleSegment(0,0,4,2);var p=new l.StructArrayLayout2i4;p.emplaceBack(0,0),p.emplaceBack(1,0),p.emplaceBack(0,1),p.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(p,en.members),this.viewportSegments=l.SegmentVector.simpleSegment(0,0,4,2);var d=new l.StructArrayLayout1ui2;d.emplaceBack(0),d.emplaceBack(1),d.emplaceBack(3),d.emplaceBack(2),d.emplaceBack(0),this.tileBorderIndexBuffer=n.createIndexBuffer(d);var m=new l.StructArrayLayout3ui6;m.emplaceBack(0,1,2),m.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(m),this.emptyTexture=new l.Texture(n,{width:1,height:1,data:new Uint8Array([0,0,0,0])},n.gl.RGBA);var _=this.context.gl;this.stencilClearMode=new G({func:_.ALWAYS,mask:0},0,255,_.ZERO,_.ZERO,_.ZERO)},fe.prototype.clearStencil=function(){var n=this.context,o=n.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var i=l.create();l.ortho(i,0,this.width,this.height,0,0,1),l.scale(i,i,[o.drawingBufferWidth,o.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(n,o.TRIANGLES,U.disabled,this.stencilClearMode,ne.disabled,$.disabled,Po(i),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},fe.prototype._renderTileClippingMasks=function(n,o){if(this.currentStencilSource!==n.source&&n.isTileClipped()&&o&&o.length){this.currentStencilSource=n.source;var i=this.context,s=i.gl;this.nextStencilID+o.length>256&&this.clearStencil(),i.setColorMode(ne.disabled),i.setDepthMode(U.disabled);var p=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var d=0,m=o;d<m.length;d+=1){var _=m[d],S=this._tileClippingMaskIDs[_.key]=this.nextStencilID++;p.draw(i,s.TRIANGLES,U.disabled,new G({func:s.ALWAYS,mask:0},S,255,s.KEEP,s.KEEP,s.REPLACE),ne.disabled,$.disabled,Po(_.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},fe.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var n=this.nextStencilID++,o=this.context.gl;return new G({func:o.NOTEQUAL,mask:255},n,255,o.KEEP,o.KEEP,o.REPLACE)},fe.prototype.stencilModeForClipping=function(n){var o=this.context.gl;return new G({func:o.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,o.KEEP,o.KEEP,o.REPLACE)},fe.prototype.stencilConfigForOverlap=function(n){var o,i=this.context.gl,s=n.sort(function(S,P){return P.overscaledZ-S.overscaledZ}),p=s[s.length-1].overscaledZ,d=s[0].overscaledZ-p+1;if(d>1){this.currentStencilSource=void 0,this.nextStencilID+d>256&&this.clearStencil();for(var m={},_=0;_<d;_++)m[_+p]=new G({func:i.GEQUAL,mask:255},_+this.nextStencilID,255,i.KEEP,i.KEEP,i.REPLACE);return this.nextStencilID+=d,[m,s]}return[(o={},o[p]=G.disabled,o),s]},fe.prototype.colorModeForRenderPass=function(){var n=this.context.gl;return this._showOverdrawInspector?new ne([n.CONSTANT_COLOR,n.ONE],new l.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?ne.unblended:ne.alphaBlended},fe.prototype.depthModeForSublayer=function(n,o,i){if(!this.opaquePassEnabledForLayer())return U.disabled;var s=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new U(i||this.context.gl.LEQUAL,o,[s,s])},fe.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},fe.prototype.render=function(n,o){var i=this;this.style=n,this.options=o,this.lineAtlas=n.lineAtlas,this.imageManager=n.imageManager,this.glyphManager=n.glyphManager,this.symbolFadeChange=n.placement.symbolFadeChange(l.browser.now()),this.imageManager.beginFrame();var s=this.style._order,p=this.style.sourceCaches;for(var d in p){var m=p[d];m.used&&m.prepare(this.context)}var _,S,P={},B={},F={};for(var N in p){var H=p[N];P[N]=H.getVisibleCoordinates(),B[N]=P[N].slice().reverse(),F[N]=H.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var W=0;W<s.length;W++)if(this.style._layers[s[W]].is3D()){this.opaquePassCutoff=W;break}this.renderPass="offscreen";for(var ee=0,q=s;ee<q.length;ee+=1){var Q=this.style._layers[q[ee]];if(Q.hasOffscreenPass()&&!Q.isHidden(this.transform.zoom)){var ae=B[Q.source];(Q.type==="custom"||ae.length)&&this.renderLayer(this,p[Q.source],Q,ae)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:o.showOverdrawInspector?l.Color.black:l.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=o.showOverdrawInspector,this.depthRangeFor3D=[0,1-(n._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=s.length-1;this.currentLayer>=0;this.currentLayer--){var me=this.style._layers[s[this.currentLayer]],Ce=p[me.source],we=P[me.source];this._renderTileClippingMasks(me,we),this.renderLayer(this,Ce,me,we)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<s.length;this.currentLayer++){var Ae=this.style._layers[s[this.currentLayer]],Re=p[Ae.source],Ze=(Ae.type==="symbol"?F:B)[Ae.source];this._renderTileClippingMasks(Ae,P[Ae.source]),this.renderLayer(this,Re,Ae,Ze)}this.options.showTileBoundaries&&(l.values(this.style._layers).forEach(function(qe){qe.source&&!qe.isHidden(i.transform.zoom)&&(qe.source!==(S&&S.id)&&(S=i.style.sourceCaches[qe.source]),(!_||_.getSource().maxzoom<S.getSource().maxzoom)&&(_=S))}),_&&ie.debug(this,_,_.getVisibleCoordinates())),this.options.showPadding&&function(qe){var ct=qe.transform.padding;te(qe,qe.transform.height-(ct.top||0),3,b),te(qe,ct.bottom||0,3,T),le(qe,ct.left||0,3,k),le(qe,qe.transform.width-(ct.right||0),3,R);var Et=qe.transform.centerPoint;(function(Ct,It,mr,dt){he(Ct,It-1,mr-10,2,20,dt),he(Ct,It-10,mr-1,20,2,dt)})(qe,Et.x,qe.transform.height-Et.y,K)}(this),this.context.setDefault()},fe.prototype.renderLayer=function(n,o,i,s){i.isHidden(this.transform.zoom)||(i.type==="background"||i.type==="custom"||s.length)&&(this.id=i.id,this.gpuTimingStart(i),ie[i.type](n,o,i,s,this.style.placement.variableOffsets),this.gpuTimingEnd())},fe.prototype.gpuTimingStart=function(n){if(this.options.gpuTiming){var o=this.context.extTimerQuery,i=this.gpuTimers[n.id];i||(i=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:o.createQueryEXT()}),i.calls++,o.beginQueryEXT(o.TIME_ELAPSED_EXT,i.query)}},fe.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}},fe.prototype.collectGpuTimers=function(){var n=this.gpuTimers;return this.gpuTimers={},n},fe.prototype.queryGpuTimers=function(n){var o={};for(var i in n){var s=n[i],p=this.context.extTimerQuery,d=p.getQueryObjectEXT(s.query,p.QUERY_RESULT_EXT)/1e6;p.deleteQueryEXT(s.query),o[i]=d}return o},fe.prototype.translatePosMatrix=function(n,o,i,s,p){if(!i[0]&&!i[1])return n;var d=p?s==="map"?this.transform.angle:0:s==="viewport"?-this.transform.angle:0;if(d){var m=Math.sin(d),_=Math.cos(d);i=[i[0]*_-i[1]*m,i[0]*m+i[1]*_]}var S=[p?i[0]:st(o,i[0],this.transform.zoom),p?i[1]:st(o,i[1],this.transform.zoom),0],P=new Float32Array(16);return l.translate(P,n,S),P},fe.prototype.saveTileTexture=function(n){var o=this._tileTextures[n.size[0]];o?o.push(n):this._tileTextures[n.size[0]]=[n]},fe.prototype.getTileTexture=function(n){var o=this._tileTextures[n];return o&&o.length>0?o.pop():null},fe.prototype.isPatternMissing=function(n){if(!n)return!1;if(!n.from||!n.to)return!0;var o=this.imageManager.getPattern(n.from.toString()),i=this.imageManager.getPattern(n.to.toString());return!o||!i},fe.prototype.useProgram=function(n,o){this.cache=this.cache||{};var i=""+n+(o?o.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[i]||(this.cache[i]=new $a(this.context,n,Us[n],o,rn[n],this._showOverdrawInspector)),this.cache[i]},fe.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},fe.prototype.setBaseState=function(){var n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)},fe.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=l.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new l.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},fe.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var pe=function(n,o){this.points=n,this.planes=o};pe.fromInvProjectionMatrix=function(n,o,i){var s=Math.pow(2,i),p=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(m){return l.transformMat4([],m,n)}).map(function(m){return l.scale$1([],m,1/m[3]/o*s)}),d=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(m){var _=l.sub([],p[m[0]],p[m[1]]),S=l.sub([],p[m[2]],p[m[1]]),P=l.normalize([],l.cross([],_,S)),B=-l.dot(P,p[m[1]]);return P.concat(B)});return new pe(p,d)};var de=function(n,o){this.min=n,this.max=o,this.center=l.scale$2([],l.add([],this.min,this.max),.5)};de.prototype.quadrant=function(n){for(var o=[n%2==0,n<2],i=l.clone$2(this.min),s=l.clone$2(this.max),p=0;p<o.length;p++)i[p]=o[p]?this.min[p]:this.center[p],s[p]=o[p]?this.center[p]:this.max[p];return s[2]=this.max[2],new de(i,s)},de.prototype.distanceX=function(n){return Math.max(Math.min(this.max[0],n[0]),this.min[0])-n[0]},de.prototype.distanceY=function(n){return Math.max(Math.min(this.max[1],n[1]),this.min[1])-n[1]},de.prototype.intersects=function(n){for(var o=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],i=!0,s=0;s<n.planes.length;s++){for(var p=n.planes[s],d=0,m=0;m<o.length;m++)d+=l.dot$1(p,o[m])>=0;if(d===0)return 0;d!==o.length&&(i=!1)}if(i)return 2;for(var _=0;_<3;_++){for(var S=Number.MAX_VALUE,P=-Number.MAX_VALUE,B=0;B<n.points.length;B++){var F=n.points[B][_]-this.min[_];S=Math.min(S,F),P=Math.max(P,F)}if(P<0||S>this.max[_]-this.min[_])return 0}return 1};var _e=function(n,o,i,s){if(n===void 0&&(n=0),o===void 0&&(o=0),i===void 0&&(i=0),s===void 0&&(s=0),isNaN(n)||n<0||isNaN(o)||o<0||isNaN(i)||i<0||isNaN(s)||s<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=o,this.left=i,this.right=s};_e.prototype.interpolate=function(n,o,i){return o.top!=null&&n.top!=null&&(this.top=l.number(n.top,o.top,i)),o.bottom!=null&&n.bottom!=null&&(this.bottom=l.number(n.bottom,o.bottom,i)),o.left!=null&&n.left!=null&&(this.left=l.number(n.left,o.left,i)),o.right!=null&&n.right!=null&&(this.right=l.number(n.right,o.right,i)),this},_e.prototype.getCenter=function(n,o){var i=l.clamp((this.left+n-this.right)/2,0,n),s=l.clamp((this.top+o-this.bottom)/2,0,o);return new l.Point(i,s)},_e.prototype.equals=function(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right},_e.prototype.clone=function(){return new _e(this.top,this.bottom,this.left,this.right)},_e.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var oe=function(n,o,i,s,p){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=p===void 0||p,this._minZoom=n||0,this._maxZoom=o||22,this._minPitch=i??0,this._maxPitch=s??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new l.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new _e,this._posMatrixCache={},this._alignedPosMatrixCache={}},ye={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};oe.prototype.clone=function(){var n=new oe(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return n.tileSize=this.tileSize,n.latRange=this.latRange,n.width=this.width,n.height=this.height,n._center=this._center,n.zoom=this.zoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._calcMatrices(),n},ye.minZoom.get=function(){return this._minZoom},ye.minZoom.set=function(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))},ye.maxZoom.get=function(){return this._maxZoom},ye.maxZoom.set=function(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))},ye.minPitch.get=function(){return this._minPitch},ye.minPitch.set=function(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))},ye.maxPitch.get=function(){return this._maxPitch},ye.maxPitch.set=function(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))},ye.renderWorldCopies.get=function(){return this._renderWorldCopies},ye.renderWorldCopies.set=function(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n},ye.worldSize.get=function(){return this.tileSize*this.scale},ye.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},ye.size.get=function(){return new l.Point(this.width,this.height)},ye.bearing.get=function(){return-this.angle/Math.PI*180},ye.bearing.set=function(n){var o=-l.wrap(n,-180,180)*Math.PI/180;this.angle!==o&&(this._unmodified=!1,this.angle=o,this._calcMatrices(),this.rotationMatrix=l.create$2(),l.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},ye.pitch.get=function(){return this._pitch/Math.PI*180},ye.pitch.set=function(n){var o=l.clamp(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==o&&(this._unmodified=!1,this._pitch=o,this._calcMatrices())},ye.fov.get=function(){return this._fov/Math.PI*180},ye.fov.set=function(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=n/180*Math.PI,this._calcMatrices())},ye.zoom.get=function(){return this._zoom},ye.zoom.set=function(n){var o=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==o&&(this._unmodified=!1,this._zoom=o,this.scale=this.zoomScale(o),this.tileZoom=Math.floor(o),this.zoomFraction=o-this.tileZoom,this._constrain(),this._calcMatrices())},ye.center.get=function(){return this._center},ye.center.set=function(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._constrain(),this._calcMatrices())},ye.padding.get=function(){return this._edgeInsets.toJSON()},ye.padding.set=function(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())},ye.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},oe.prototype.isPaddingEqual=function(n){return this._edgeInsets.equals(n)},oe.prototype.interpolatePadding=function(n,o,i){this._unmodified=!1,this._edgeInsets.interpolate(n,o,i),this._constrain(),this._calcMatrices()},oe.prototype.coveringZoomLevel=function(n){var o=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,o)},oe.prototype.getVisibleUnwrappedCoordinates=function(n){var o=[new l.UnwrappedTileID(0,n)];if(this._renderWorldCopies)for(var i=this.pointCoordinate(new l.Point(0,0)),s=this.pointCoordinate(new l.Point(this.width,0)),p=this.pointCoordinate(new l.Point(this.width,this.height)),d=this.pointCoordinate(new l.Point(0,this.height)),m=Math.floor(Math.min(i.x,s.x,p.x,d.x)),_=Math.floor(Math.max(i.x,s.x,p.x,d.x)),S=m-1;S<=_+1;S++)S!==0&&o.push(new l.UnwrappedTileID(S,n));return o},oe.prototype.coveringTiles=function(n){var o=this.coveringZoomLevel(n),i=o;if(n.minzoom!==void 0&&o<n.minzoom)return[];n.maxzoom!==void 0&&o>n.maxzoom&&(o=n.maxzoom);var s=l.MercatorCoordinate.fromLngLat(this.center),p=Math.pow(2,o),d=[p*s.x,p*s.y,0],m=pe.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,o),_=n.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(_=o);var S=function(qe){return{aabb:new de([qe*p,0,0],[(qe+1)*p,p,0]),zoom:0,x:0,y:0,wrap:qe,fullyVisible:!1}},P=[],B=[],F=o,N=n.reparseOverscaled?i:o;if(this._renderWorldCopies)for(var H=1;H<=3;H++)P.push(S(-H)),P.push(S(H));for(P.push(S(0));P.length>0;){var W=P.pop(),ee=W.x,q=W.y,Q=W.fullyVisible;if(!Q){var ae=W.aabb.intersects(m);if(ae===0)continue;Q=ae===2}var me=W.aabb.distanceX(d),Ce=W.aabb.distanceY(d),we=Math.max(Math.abs(me),Math.abs(Ce));if(W.zoom===F||we>3+(1<<F-W.zoom)-2&&W.zoom>=_)B.push({tileID:new l.OverscaledTileID(W.zoom===F?N:W.zoom,W.wrap,W.zoom,ee,q),distanceSq:l.sqrLen([d[0]-.5-ee,d[1]-.5-q])});else for(var Ae=0;Ae<4;Ae++){var Re=(ee<<1)+Ae%2,Ze=(q<<1)+(Ae>>1);P.push({aabb:W.aabb.quadrant(Ae),zoom:W.zoom+1,x:Re,y:Ze,wrap:W.wrap,fullyVisible:Q})}}return B.sort(function(qe,ct){return qe.distanceSq-ct.distanceSq}).map(function(qe){return qe.tileID})},oe.prototype.resize=function(n,o){this.width=n,this.height=o,this.pixelsToGLUnits=[2/n,-2/o],this._constrain(),this._calcMatrices()},ye.unmodified.get=function(){return this._unmodified},oe.prototype.zoomScale=function(n){return Math.pow(2,n)},oe.prototype.scaleZoom=function(n){return Math.log(n)/Math.LN2},oe.prototype.project=function(n){var o=l.clamp(n.lat,-this.maxValidLatitude,this.maxValidLatitude);return new l.Point(l.mercatorXfromLng(n.lng)*this.worldSize,l.mercatorYfromLat(o)*this.worldSize)},oe.prototype.unproject=function(n){return new l.MercatorCoordinate(n.x/this.worldSize,n.y/this.worldSize).toLngLat()},ye.point.get=function(){return this.project(this.center)},oe.prototype.setLocationAtPoint=function(n,o){var i=this.pointCoordinate(o),s=this.pointCoordinate(this.centerPoint),p=this.locationCoordinate(n),d=new l.MercatorCoordinate(p.x-(i.x-s.x),p.y-(i.y-s.y));this.center=this.coordinateLocation(d),this._renderWorldCopies&&(this.center=this.center.wrap())},oe.prototype.locationPoint=function(n){return this.coordinatePoint(this.locationCoordinate(n))},oe.prototype.pointLocation=function(n){return this.coordinateLocation(this.pointCoordinate(n))},oe.prototype.locationCoordinate=function(n){return l.MercatorCoordinate.fromLngLat(n)},oe.prototype.coordinateLocation=function(n){return n.toLngLat()},oe.prototype.pointCoordinate=function(n){var o=[n.x,n.y,0,1],i=[n.x,n.y,1,1];l.transformMat4(o,o,this.pixelMatrixInverse),l.transformMat4(i,i,this.pixelMatrixInverse);var s=o[3],p=i[3],d=o[1]/s,m=i[1]/p,_=o[2]/s,S=i[2]/p,P=_===S?0:(0-_)/(S-_);return new l.MercatorCoordinate(l.number(o[0]/s,i[0]/p,P)/this.worldSize,l.number(d,m,P)/this.worldSize)},oe.prototype.coordinatePoint=function(n){var o=[n.x*this.worldSize,n.y*this.worldSize,0,1];return l.transformMat4(o,o,this.pixelMatrix),new l.Point(o[0]/o[3],o[1]/o[3])},oe.prototype.getBounds=function(){return new l.LngLatBounds().extend(this.pointLocation(new l.Point(0,0))).extend(this.pointLocation(new l.Point(this.width,0))).extend(this.pointLocation(new l.Point(this.width,this.height))).extend(this.pointLocation(new l.Point(0,this.height)))},oe.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new l.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},oe.prototype.setMaxBounds=function(n){n?(this.lngRange=[n.getWest(),n.getEast()],this.latRange=[n.getSouth(),n.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},oe.prototype.calculatePosMatrix=function(n,o){o===void 0&&(o=!1);var i=n.key,s=o?this._alignedPosMatrixCache:this._posMatrixCache;if(s[i])return s[i];var p=n.canonical,d=this.worldSize/this.zoomScale(p.z),m=p.x+Math.pow(2,p.z)*n.wrap,_=l.identity(new Float64Array(16));return l.translate(_,_,[m*d,p.y*d,0]),l.scale(_,_,[d/l.EXTENT,d/l.EXTENT,1]),l.multiply(_,o?this.alignedProjMatrix:this.projMatrix,_),s[i]=new Float32Array(_),s[i]},oe.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},oe.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var n,o,i,s,p=-90,d=90,m=-180,_=180,S=this.size,P=this._unmodified;if(this.latRange){var B=this.latRange;p=l.mercatorYfromLat(B[1])*this.worldSize,n=(d=l.mercatorYfromLat(B[0])*this.worldSize)-p<S.y?S.y/(d-p):0}if(this.lngRange){var F=this.lngRange;m=l.mercatorXfromLng(F[0])*this.worldSize,o=(_=l.mercatorXfromLng(F[1])*this.worldSize)-m<S.x?S.x/(_-m):0}var N=this.point,H=Math.max(o||0,n||0);if(H)return this.center=this.unproject(new l.Point(o?(_+m)/2:N.x,n?(d+p)/2:N.y)),this.zoom+=this.scaleZoom(H),this._unmodified=P,void(this._constraining=!1);if(this.latRange){var W=N.y,ee=S.y/2;W-ee<p&&(s=p+ee),W+ee>d&&(s=d-ee)}if(this.lngRange){var q=N.x,Q=S.x/2;q-Q<m&&(i=m+Q),q+Q>_&&(i=_-Q)}i===void 0&&s===void 0||(this.center=this.unproject(new l.Point(i!==void 0?i:N.x,s!==void 0?s:N.y))),this._unmodified=P,this._constraining=!1}},oe.prototype._calcMatrices=function(){if(this.height){var n=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var o=Math.PI/2+this._pitch,i=this._fov*(.5+n.y/this.height),s=Math.sin(i)*this.cameraToCenterDistance/Math.sin(l.clamp(Math.PI-o-i,.01,Math.PI-.01)),p=this.point,d=p.x,m=p.y,_=1.01*(Math.cos(Math.PI/2-this._pitch)*s+this.cameraToCenterDistance),S=this.height/50,P=new Float64Array(16);l.perspective(P,this._fov,this.width/this.height,S,_),P[8]=2*-n.x/this.width,P[9]=2*n.y/this.height,l.scale(P,P,[1,-1,1]),l.translate(P,P,[0,0,-this.cameraToCenterDistance]),l.rotateX(P,P,this._pitch),l.rotateZ(P,P,this.angle),l.translate(P,P,[-d,-m,0]),this.mercatorMatrix=l.scale([],P,[this.worldSize,this.worldSize,this.worldSize]),l.scale(P,P,[1,1,l.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=P,this.invProjMatrix=l.invert([],this.projMatrix);var B=this.width%2/2,F=this.height%2/2,N=Math.cos(this.angle),H=Math.sin(this.angle),W=d-Math.round(d)+N*B+H*F,ee=m-Math.round(m)+N*F+H*B,q=new Float64Array(P);if(l.translate(q,q,[W>.5?W-1:W,ee>.5?ee-1:ee,0]),this.alignedProjMatrix=q,P=l.create(),l.scale(P,P,[this.width/2,-this.height/2,1]),l.translate(P,P,[1,-1,0]),this.labelPlaneMatrix=P,P=l.create(),l.scale(P,P,[1,-1,1]),l.translate(P,P,[-1,-1,0]),l.scale(P,P,[2/this.width,2/this.height,1]),this.glCoordMatrix=P,this.pixelMatrix=l.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(P=l.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=P,this._posMatrixCache={},this._alignedPosMatrixCache={}}},oe.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var n=this.pointCoordinate(new l.Point(0,0)),o=[n.x*this.worldSize,n.y*this.worldSize,0,1];return l.transformMat4(o,o,this.pixelMatrix)[3]/this.cameraToCenterDistance},oe.prototype.getCameraPoint=function(){var n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.Point(0,n))},oe.prototype.getCameraQueryGeometry=function(n){var o=this.getCameraPoint();if(n.length===1)return[n[0],o];for(var i=o.x,s=o.y,p=o.x,d=o.y,m=0,_=n;m<_.length;m+=1){var S=_[m];i=Math.min(i,S.x),s=Math.min(s,S.y),p=Math.max(p,S.x),d=Math.max(d,S.y)}return[new l.Point(i,s),new l.Point(p,s),new l.Point(p,d),new l.Point(i,d),new l.Point(i,s)]},Object.defineProperties(oe.prototype,ye);var Ie=function(n){var o,i,s,p;this._hashName=n&&encodeURIComponent(n),l.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(o=this._updateHashUnthrottled.bind(this),i=!1,s=null,p=function(){s=null,i&&(o(),s=setTimeout(p,300),i=!1)},function(){return i=!0,s||p(),s})};Ie.prototype.addTo=function(n){return this._map=n,l.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Ie.prototype.remove=function(){return l.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Ie.prototype.getHashString=function(n){var o=this._map.getCenter(),i=Math.round(100*this._map.getZoom())/100,s=Math.ceil((i*Math.LN2+Math.log(512/360/.5))/Math.LN10),p=Math.pow(10,s),d=Math.round(o.lng*p)/p,m=Math.round(o.lat*p)/p,_=this._map.getBearing(),S=this._map.getPitch(),P="";if(P+=n?"/"+d+"/"+m+"/"+i:i+"/"+m+"/"+d,(_||S)&&(P+="/"+Math.round(10*_)/10),S&&(P+="/"+Math.round(S)),this._hashName){var B=this._hashName,F=!1,N=l.window.location.hash.slice(1).split("&").map(function(H){var W=H.split("=")[0];return W===B?(F=!0,W+"="+P):H}).filter(function(H){return H});return F||N.push(B+"="+P),"#"+N.join("&")}return"#"+P},Ie.prototype._getCurrentHash=function(){var n,o=this,i=l.window.location.hash.replace("#","");return this._hashName?(i.split("&").map(function(s){return s.split("=")}).forEach(function(s){s[0]===o._hashName&&(n=s)}),(n&&n[1]||"").split("/")):i.split("/")},Ie.prototype._onHashChange=function(){var n=this._getCurrentHash();if(n.length>=3&&!n.some(function(i){return isNaN(i)})){var o=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(n[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:o,pitch:+(n[4]||0)}),!0}return!1},Ie.prototype._updateHashUnthrottled=function(){var n=l.window.location.href.replace(/(#.+)?$/,this.getHashString());try{l.window.history.replaceState(l.window.history.state,null,n)}catch{}};var Pe={linearity:.3,easing:l.bezier(0,0,.3,1)},De=l.extend({deceleration:2500,maxSpeed:1400},Pe),$e=l.extend({deceleration:20,maxSpeed:1400},Pe),ht=l.extend({deceleration:1e3,maxSpeed:360},Pe),tt=l.extend({deceleration:1e3,maxSpeed:90},Pe),rt=function(n){this._map=n,this.clear()};function ft(n,o){(!n.duration||n.duration<o.duration)&&(n.duration=o.duration,n.easing=o.easing)}function nt(n,o,i){var s=i.maxSpeed,p=i.linearity,d=i.deceleration,m=l.clamp(n*p/(o/1e3),-s,s),_=Math.abs(m)/(d*p);return{easing:i.easing,duration:1e3*_,amount:m*(_/2)}}rt.prototype.clear=function(){this._inertiaBuffer=[]},rt.prototype.record=function(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:l.browser.now(),settings:n})},rt.prototype._drainInertiaBuffer=function(){for(var n=this._inertiaBuffer,o=l.browser.now();n.length>0&&o-n[0].time>160;)n.shift()},rt.prototype._onMoveEnd=function(n){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var o={zoom:0,bearing:0,pitch:0,pan:new l.Point(0,0),pinchAround:void 0,around:void 0},i=0,s=this._inertiaBuffer;i<s.length;i+=1){var p=s[i].settings;o.zoom+=p.zoomDelta||0,o.bearing+=p.bearingDelta||0,o.pitch+=p.pitchDelta||0,p.panDelta&&o.pan._add(p.panDelta),p.around&&(o.around=p.around),p.pinchAround&&(o.pinchAround=p.pinchAround)}var d=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(o.pan.mag()){var _=nt(o.pan.mag(),d,l.extend({},De,n||{}));m.offset=o.pan.mult(_.amount/o.pan.mag()),m.center=this._map.transform.center,ft(m,_)}if(o.zoom){var S=nt(o.zoom,d,$e);m.zoom=this._map.transform.zoom+S.amount,ft(m,S)}if(o.bearing){var P=nt(o.bearing,d,ht);m.bearing=this._map.transform.bearing+l.clamp(P.amount,-179,179),ft(m,P)}if(o.pitch){var B=nt(o.pitch,d,tt);m.pitch=this._map.transform.pitch+B.amount,ft(m,B)}if(m.zoom||m.bearing){var F=o.pinchAround===void 0?o.around:o.pinchAround;m.around=F?this._map.unproject(F):this._map.getCenter()}return this.clear(),l.extend(m,{noMoveStart:!0})}};var at=function(n){function o(s,p,d,m){m===void 0&&(m={});var _=Oe.mousePos(p.getCanvasContainer(),d),S=p.unproject(_);n.call(this,s,l.extend({point:_,lngLat:S,originalEvent:d},m)),this._defaultPrevented=!1,this.target=p}n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o;var i={defaultPrevented:{configurable:!0}};return o.prototype.preventDefault=function(){this._defaultPrevented=!0},i.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(o.prototype,i),o}(l.Event),$t=function(n){function o(s,p,d){var m=s==="touchend"?d.changedTouches:d.touches,_=Oe.touchPos(p.getCanvasContainer(),m),S=_.map(function(F){return p.unproject(F)}),P=_.reduce(function(F,N,H,W){return F.add(N.div(W.length))},new l.Point(0,0)),B=p.unproject(P);n.call(this,s,{points:_,point:P,lngLats:S,lngLat:B,originalEvent:d}),this._defaultPrevented=!1}n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o;var i={defaultPrevented:{configurable:!0}};return o.prototype.preventDefault=function(){this._defaultPrevented=!0},i.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(o.prototype,i),o}(l.Event),hr=function(n){function o(s,p,d){n.call(this,s,{originalEvent:d}),this._defaultPrevented=!1}n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o;var i={defaultPrevented:{configurable:!0}};return o.prototype.preventDefault=function(){this._defaultPrevented=!0},i.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(o.prototype,i),o}(l.Event),Pt=function(n,o){this._map=n,this._clickTolerance=o.clickTolerance};Pt.prototype.reset=function(){delete this._mousedownPos},Pt.prototype.wheel=function(n){return this._firePreventable(new hr(n.type,this._map,n))},Pt.prototype.mousedown=function(n,o){return this._mousedownPos=o,this._firePreventable(new at(n.type,this._map,n))},Pt.prototype.mouseup=function(n){this._map.fire(new at(n.type,this._map,n))},Pt.prototype.click=function(n,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||this._map.fire(new at(n.type,this._map,n))},Pt.prototype.dblclick=function(n){return this._firePreventable(new at(n.type,this._map,n))},Pt.prototype.mouseover=function(n){this._map.fire(new at(n.type,this._map,n))},Pt.prototype.mouseout=function(n){this._map.fire(new at(n.type,this._map,n))},Pt.prototype.touchstart=function(n){return this._firePreventable(new $t(n.type,this._map,n))},Pt.prototype.touchmove=function(n){this._map.fire(new $t(n.type,this._map,n))},Pt.prototype.touchend=function(n){this._map.fire(new $t(n.type,this._map,n))},Pt.prototype.touchcancel=function(n){this._map.fire(new $t(n.type,this._map,n))},Pt.prototype._firePreventable=function(n){if(this._map.fire(n),n.defaultPrevented)return{}},Pt.prototype.isEnabled=function(){return!0},Pt.prototype.isActive=function(){return!1},Pt.prototype.enable=function(){},Pt.prototype.disable=function(){};var Qe=function(n){this._map=n};Qe.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},Qe.prototype.mousemove=function(n){this._map.fire(new at(n.type,this._map,n))},Qe.prototype.mousedown=function(){this._delayContextMenu=!0},Qe.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new at("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},Qe.prototype.contextmenu=function(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new at(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()},Qe.prototype.isEnabled=function(){return!0},Qe.prototype.isActive=function(){return!1},Qe.prototype.enable=function(){},Qe.prototype.disable=function(){};var Lt=function(n,o){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=o.clickTolerance||1};function Cn(n,o){for(var i={},s=0;s<n.length;s++)i[n[s].identifier]=o[s];return i}Lt.prototype.isEnabled=function(){return!!this._enabled},Lt.prototype.isActive=function(){return!!this._active},Lt.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},Lt.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Lt.prototype.mousedown=function(n,o){this.isEnabled()&&n.shiftKey&&n.button===0&&(Oe.disableDrag(),this._startPos=this._lastPos=o,this._active=!0)},Lt.prototype.mousemoveWindow=function(n,o){if(this._active){var i=o;if(!(this._lastPos.equals(i)||!this._box&&i.dist(this._startPos)<this._clickTolerance)){var s=this._startPos;this._lastPos=i,this._box||(this._box=Oe.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));var p=Math.min(s.x,i.x),d=Math.max(s.x,i.x),m=Math.min(s.y,i.y),_=Math.max(s.y,i.y);Oe.setTransform(this._box,"translate("+p+"px,"+m+"px)"),this._box.style.width=d-p+"px",this._box.style.height=_-m+"px"}}},Lt.prototype.mouseupWindow=function(n,o){var i=this;if(this._active&&n.button===0){var s=this._startPos,p=o;if(this.reset(),Oe.suppressClick(),s.x!==p.x||s.y!==p.y)return this._map.fire(new l.Event("boxzoomend",{originalEvent:n})),{cameraAnimation:function(d){return d.fitScreenCoordinates(s,p,i._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",n)}},Lt.prototype.keydown=function(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))},Lt.prototype.blur=function(){this.reset()},Lt.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(Oe.remove(this._box),this._box=null),Oe.enableDrag(),delete this._startPos,delete this._lastPos},Lt.prototype._fireEvent=function(n,o){return this._map.fire(new l.Event(n,{originalEvent:o}))};var pn=function(n){this.reset(),this.numTouches=n.numTouches};pn.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},pn.prototype.touchstart=function(n,o,i){(this.centroid||i.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=n.timeStamp),i.length===this.numTouches&&(this.centroid=function(s){for(var p=new l.Point(0,0),d=0,m=s;d<m.length;d+=1)p._add(m[d]);return p.div(s.length)}(o),this.touches=Cn(i,o)))},pn.prototype.touchmove=function(n,o,i){if(!this.aborted&&this.centroid){var s=Cn(i,o);for(var p in this.touches){var d=s[p];(!d||d.dist(this.touches[p])>30)&&(this.aborted=!0)}}},pn.prototype.touchend=function(n,o,i){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),i.length===0){var s=!this.aborted&&this.centroid;if(this.reset(),s)return s}};var pi=function(n){this.singleTap=new pn(n),this.numTaps=n.numTaps,this.reset()};pi.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},pi.prototype.touchstart=function(n,o,i){this.singleTap.touchstart(n,o,i)},pi.prototype.touchmove=function(n,o,i){this.singleTap.touchmove(n,o,i)},pi.prototype.touchend=function(n,o,i){var s=this.singleTap.touchend(n,o,i);if(s){var p=n.timeStamp-this.lastTime<500,d=!this.lastTap||this.lastTap.dist(s)<30;if(p&&d||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=s,this.count===this.numTaps)return this.reset(),s}};var Lr=function(){this._zoomIn=new pi({numTouches:1,numTaps:2}),this._zoomOut=new pi({numTouches:2,numTaps:1}),this.reset()};Lr.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},Lr.prototype.touchstart=function(n,o,i){this._zoomIn.touchstart(n,o,i),this._zoomOut.touchstart(n,o,i)},Lr.prototype.touchmove=function(n,o,i){this._zoomIn.touchmove(n,o,i),this._zoomOut.touchmove(n,o,i)},Lr.prototype.touchend=function(n,o,i){var s=this,p=this._zoomIn.touchend(n,o,i),d=this._zoomOut.touchend(n,o,i);return p?(this._active=!0,n.preventDefault(),setTimeout(function(){return s.reset()},0),{cameraAnimation:function(m){return m.easeTo({duration:300,zoom:m.getZoom()+1,around:m.unproject(p)},{originalEvent:n})}}):d?(this._active=!0,n.preventDefault(),setTimeout(function(){return s.reset()},0),{cameraAnimation:function(m){return m.easeTo({duration:300,zoom:m.getZoom()-1,around:m.unproject(d)},{originalEvent:n})}}):void 0},Lr.prototype.touchcancel=function(){this.reset()},Lr.prototype.enable=function(){this._enabled=!0},Lr.prototype.disable=function(){this._enabled=!1,this.reset()},Lr.prototype.isEnabled=function(){return this._enabled},Lr.prototype.isActive=function(){return this._active};var zo={0:1,2:2},He=function(n){this.reset(),this._clickTolerance=n.clickTolerance||1};He.prototype.blur=function(){this.reset()},He.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},He.prototype._correctButton=function(n,o){return!1},He.prototype._move=function(n,o){return{}},He.prototype.mousedown=function(n,o){if(!this._lastPoint){var i=Oe.mouseButton(n);this._correctButton(n,i)&&(this._lastPoint=o,this._eventButton=i)}},He.prototype.mousemoveWindow=function(n,o){var i=this._lastPoint;if(i){if(n.preventDefault(),function(s,p){var d=zo[p];return s.buttons===void 0||(s.buttons&d)!==d}(n,this._eventButton))this.reset();else if(this._moved||!(o.dist(i)<this._clickTolerance))return this._moved=!0,this._lastPoint=o,this._move(i,o)}},He.prototype.mouseupWindow=function(n){this._lastPoint&&Oe.mouseButton(n)===this._eventButton&&(this._moved&&Oe.suppressClick(),this.reset())},He.prototype.enable=function(){this._enabled=!0},He.prototype.disable=function(){this._enabled=!1,this.reset()},He.prototype.isEnabled=function(){return this._enabled},He.prototype.isActive=function(){return this._active};var Pu=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.mousedown=function(i,s){n.prototype.mousedown.call(this,i,s),this._lastPoint&&(this._active=!0)},o.prototype._correctButton=function(i,s){return s===0&&!i.ctrlKey},o.prototype._move=function(i,s){return{around:s,panDelta:s.sub(i)}},o}(He),Ks=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._correctButton=function(i,s){return s===0&&i.ctrlKey||s===2},o.prototype._move=function(i,s){var p=.8*(s.x-i.x);if(p)return this._active=!0,{bearingDelta:p}},o.prototype.contextmenu=function(i){i.preventDefault()},o}(He),ku=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._correctButton=function(i,s){return s===0&&i.ctrlKey||s===2},o.prototype._move=function(i,s){var p=-.5*(s.y-i.y);if(p)return this._active=!0,{pitchDelta:p}},o.prototype.contextmenu=function(i){i.preventDefault()},o}(He),co=function(n){this._minTouches=1,this._clickTolerance=n.clickTolerance||1,this.reset()};co.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new l.Point(0,0)},co.prototype.touchstart=function(n,o,i){return this._calculateTransform(n,o,i)},co.prototype.touchmove=function(n,o,i){if(this._active&&!(i.length<this._minTouches))return n.preventDefault(),this._calculateTransform(n,o,i)},co.prototype.touchend=function(n,o,i){this._calculateTransform(n,o,i),this._active&&i.length<this._minTouches&&this.reset()},co.prototype.touchcancel=function(){this.reset()},co.prototype._calculateTransform=function(n,o,i){i.length>0&&(this._active=!0);var s=Cn(i,o),p=new l.Point(0,0),d=new l.Point(0,0),m=0;for(var _ in s){var S=s[_],P=this._touches[_];P&&(p._add(S),d._add(S.sub(P)),m++,s[_]=S)}if(this._touches=s,!(m<this._minTouches)&&d.mag()){var B=d.div(m);if(this._sum._add(B),!(this._sum.mag()<this._clickTolerance))return{around:p.div(m),panDelta:B}}},co.prototype.enable=function(){this._enabled=!0},co.prototype.disable=function(){this._enabled=!1,this.reset()},co.prototype.isEnabled=function(){return this._enabled},co.prototype.isActive=function(){return this._active};var Zi=function(){this.reset()};function Xs(n,o,i){for(var s=0;s<n.length;s++)if(n[s].identifier===i)return o[s]}function Ws(n,o){return Math.log(n/o)/Math.LN2}Zi.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Zi.prototype._start=function(n){},Zi.prototype._move=function(n,o,i){return{}},Zi.prototype.touchstart=function(n,o,i){this._firstTwoTouches||i.length<2||(this._firstTwoTouches=[i[0].identifier,i[1].identifier],this._start([o[0],o[1]]))},Zi.prototype.touchmove=function(n,o,i){if(this._firstTwoTouches){n.preventDefault();var s=this._firstTwoTouches,p=s[1],d=Xs(i,o,s[0]),m=Xs(i,o,p);if(d&&m){var _=this._aroundCenter?null:d.add(m).div(2);return this._move([d,m],_,n)}}},Zi.prototype.touchend=function(n,o,i){if(this._firstTwoTouches){var s=this._firstTwoTouches,p=s[1],d=Xs(i,o,s[0]),m=Xs(i,o,p);d&&m||(this._active&&Oe.suppressClick(),this.reset())}},Zi.prototype.touchcancel=function(){this.reset()},Zi.prototype.enable=function(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"},Zi.prototype.disable=function(){this._enabled=!1,this.reset()},Zi.prototype.isEnabled=function(){return this._enabled},Zi.prototype.isActive=function(){return this._active};var Gi=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.reset=function(){n.prototype.reset.call(this),delete this._distance,delete this._startDistance},o.prototype._start=function(i){this._startDistance=this._distance=i[0].dist(i[1])},o.prototype._move=function(i,s){var p=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(Ws(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ws(this._distance,p),pinchAround:s}},o}(Zi);function Qo(n,o){return 180*n.angleWith(o)/Math.PI}var cl=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.reset=function(){n.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},o.prototype._start=function(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])},o.prototype._move=function(i,s){var p=this._vector;if(this._vector=i[0].sub(i[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Qo(this._vector,p),pinchAround:s}},o.prototype._isBelowThreshold=function(i){this._minDiameter=Math.min(this._minDiameter,i.mag());var s=25/(Math.PI*this._minDiameter)*360,p=Qo(i,this._startVector);return Math.abs(p)<s},o}(Zi);function ws(n){return Math.abs(n.y)>Math.abs(n.x)}var Mu=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.reset=function(){n.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},o.prototype._start=function(i){this._lastPoints=i,ws(i[0].sub(i[1]))&&(this._valid=!1)},o.prototype._move=function(i,s,p){var d=i[0].sub(this._lastPoints[0]),m=i[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(d,m,p.timeStamp),this._valid)return this._lastPoints=i,this._active=!0,{pitchDelta:(d.y+m.y)/2*-.5}},o.prototype.gestureBeginsVertically=function(i,s,p){if(this._valid!==void 0)return this._valid;var d=i.mag()>=2,m=s.mag()>=2;if(d||m){if(!d||!m)return this._firstMove===void 0&&(this._firstMove=p),p-this._firstMove<100&&void 0;var _=i.y>0==s.y>0;return ws(i)&&ws(s)&&_}},o}(Zi),zu={panStep:100,bearingStep:15,pitchStep:10},Do=function(){var n=zu;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1};function eo(n){return n*(2-n)}Do.prototype.blur=function(){this.reset()},Do.prototype.reset=function(){this._active=!1},Do.prototype.keydown=function(n){var o=this;if(!(n.altKey||n.ctrlKey||n.metaKey)){var i=0,s=0,p=0,d=0,m=0;switch(n.keyCode){case 61:case 107:case 171:case 187:i=1;break;case 189:case 109:case 173:i=-1;break;case 37:n.shiftKey?s=-1:(n.preventDefault(),d=-1);break;case 39:n.shiftKey?s=1:(n.preventDefault(),d=1);break;case 38:n.shiftKey?p=1:(n.preventDefault(),m=-1);break;case 40:n.shiftKey?p=-1:(n.preventDefault(),m=1);break;default:return}return this._rotationDisabled&&(s=0,p=0),{cameraAnimation:function(_){var S=_.getZoom();_.easeTo({duration:300,easeId:"keyboardHandler",easing:eo,zoom:i?Math.round(S)+i*(n.shiftKey?2:1):S,bearing:_.getBearing()+s*o._bearingStep,pitch:_.getPitch()+p*o._pitchStep,offset:[-d*o._panStep,-m*o._panStep],center:_.getCenter()},{originalEvent:n})}}}},Do.prototype.enable=function(){this._enabled=!0},Do.prototype.disable=function(){this._enabled=!1,this.reset()},Do.prototype.isEnabled=function(){return this._enabled},Do.prototype.isActive=function(){return this._active},Do.prototype.disableRotation=function(){this._rotationDisabled=!0},Do.prototype.enableRotation=function(){this._rotationDisabled=!1};var ar=function(n,o){this._map=n,this._el=n.getCanvasContainer(),this._handler=o,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,l.bindAll(["_onTimeout"],this)};ar.prototype.setZoomRate=function(n){this._defaultZoomRate=n},ar.prototype.setWheelZoomRate=function(n){this._wheelZoomRate=n},ar.prototype.isEnabled=function(){return!!this._enabled},ar.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},ar.prototype.isZooming=function(){return!!this._zooming},ar.prototype.enable=function(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=n&&n.around==="center")},ar.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},ar.prototype.wheel=function(n){if(this.isEnabled()){var o=n.deltaMode===l.window.WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY,i=l.browser.now(),s=i-(this._lastWheelEventTime||0);this._lastWheelEventTime=i,o!==0&&o%4.000244140625==0?this._type="wheel":o!==0&&Math.abs(o)<4?this._type="trackpad":s>400?(this._type=null,this._lastValue=o,this._timeout=setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(s*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),n.shiftKey&&o&&(o/=4),this._type&&(this._lastWheelEvent=n,this._delta-=o,this._active||this._start(n)),n.preventDefault()}},ar.prototype._onTimeout=function(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)},ar.prototype._start=function(n){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var o=Oe.mousePos(this._el,n);this._around=l.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(o)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},ar.prototype.renderFrame=function(){var n=this;if(this._frameId&&(this._frameId=null,this.isActive())){var o=this._map.transform;if(this._delta!==0){var i=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,s=2/(1+Math.exp(-Math.abs(this._delta*i)));this._delta<0&&s!==0&&(s=1/s);var p=typeof this._targetZoom=="number"?o.zoomScale(this._targetZoom):o.scale;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(p*s))),this._type==="wheel"&&(this._startZoom=o.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var d,m=typeof this._targetZoom=="number"?this._targetZoom:o.zoom,_=this._startZoom,S=this._easing,P=!1;if(this._type==="wheel"&&_&&S){var B=Math.min((l.browser.now()-this._lastWheelEventTime)/200,1),F=S(B);d=l.number(_,m,F),B<1?this._frameId||(this._frameId=!0):P=!0}else d=m,P=!0;return this._active=!0,P&&(this._active=!1,this._finishTimeout=setTimeout(function(){n._zooming=!1,n._handler._triggerRenderFrame(),delete n._targetZoom,delete n._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!P,zoomDelta:d-o.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},ar.prototype._smoothOutEasing=function(n){var o=l.ease;if(this._prevEase){var i=this._prevEase,s=(l.browser.now()-i.start)/i.duration,p=i.easing(s+.01)-i.easing(s),d=.27/Math.sqrt(p*p+1e-4)*.01,m=Math.sqrt(.0729-d*d);o=l.bezier(d,m,.25,1)}return this._prevEase={start:l.browser.now(),duration:n,easing:o},o},ar.prototype.blur=function(){this.reset()},ar.prototype.reset=function(){this._active=!1};var Zo=function(n,o){this._clickZoom=n,this._tapZoom=o};Zo.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},Zo.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},Zo.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},Zo.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var po=function(){this.reset()};po.prototype.reset=function(){this._active=!1},po.prototype.blur=function(){this.reset()},po.prototype.dblclick=function(n,o){return n.preventDefault(),{cameraAnimation:function(i){i.easeTo({duration:300,zoom:i.getZoom()+(n.shiftKey?-1:1),around:i.unproject(o)},{originalEvent:n})}}},po.prototype.enable=function(){this._enabled=!0},po.prototype.disable=function(){this._enabled=!1,this.reset()},po.prototype.isEnabled=function(){return this._enabled},po.prototype.isActive=function(){return this._active};var Jn=function(){this._tap=new pi({numTouches:1,numTaps:1}),this.reset()};Jn.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},Jn.prototype.touchstart=function(n,o,i){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?i.length>0&&(this._swipePoint=o[0],this._swipeTouch=i[0].identifier):this._tap.touchstart(n,o,i))},Jn.prototype.touchmove=function(n,o,i){if(this._tapTime){if(this._swipePoint){if(i[0].identifier!==this._swipeTouch)return;var s=o[0],p=s.y-this._swipePoint.y;return this._swipePoint=s,n.preventDefault(),this._active=!0,{zoomDelta:p/128}}}else this._tap.touchmove(n,o,i)},Jn.prototype.touchend=function(n,o,i){this._tapTime?this._swipePoint&&i.length===0&&this.reset():this._tap.touchend(n,o,i)&&(this._tapTime=n.timeStamp)},Jn.prototype.touchcancel=function(){this.reset()},Jn.prototype.enable=function(){this._enabled=!0},Jn.prototype.disable=function(){this._enabled=!1,this.reset()},Jn.prototype.isEnabled=function(){return this._enabled},Jn.prototype.isActive=function(){return this._active};var Oa=function(n,o,i){this._el=n,this._mousePan=o,this._touchPan=i};Oa.prototype.enable=function(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},Oa.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},Oa.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},Oa.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var fa=function(n,o,i){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=o,this._mousePitch=i};fa.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},fa.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},fa.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},fa.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var Lo=function(n,o,i,s){this._el=n,this._touchZoom=o,this._touchRotate=i,this._tapDragZoom=s,this._rotationDisabled=!1,this._enabled=!0};Lo.prototype.enable=function(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},Lo.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},Lo.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},Lo.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},Lo.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},Lo.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var hi=function(n){return n.zoom||n.drag||n.pitch||n.rotate},Es=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o}(l.Event);function wt(n){return n.panDelta&&n.panDelta.mag()||n.zoomDelta||n.bearingDelta||n.pitchDelta}var gt=function(n,o){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new rt(n),this._bearingSnap=o.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(o),l.bindAll(["handleEvent","handleWindowEvent"],this);var i=this._el;this._listeners=[[i,"touchstart",{passive:!0}],[i,"touchmove",{passive:!1}],[i,"touchend",void 0],[i,"touchcancel",void 0],[i,"mousedown",void 0],[i,"mousemove",void 0],[i,"mouseup",void 0],[l.window.document,"mousemove",{capture:!0}],[l.window.document,"mouseup",void 0],[i,"mouseover",void 0],[i,"mouseout",void 0],[i,"dblclick",void 0],[i,"click",void 0],[i,"keydown",{capture:!1}],[i,"keyup",void 0],[i,"wheel",{passive:!1}],[i,"contextmenu",void 0],[l.window,"blur",void 0]];for(var s=0,p=this._listeners;s<p.length;s+=1){var d=p[s],m=d[0];Oe.addEventListener(m,d[1],m===l.window.document?this.handleWindowEvent:this.handleEvent,d[2])}};gt.prototype.destroy=function(){for(var n=0,o=this._listeners;n<o.length;n+=1){var i=o[n],s=i[0];Oe.removeEventListener(s,i[1],s===l.window.document?this.handleWindowEvent:this.handleEvent,i[2])}},gt.prototype._addDefaultHandlers=function(n){var o=this._map,i=o.getCanvasContainer();this._add("mapEvent",new Pt(o,n));var s=o.boxZoom=new Lt(o,n);this._add("boxZoom",s);var p=new Lr,d=new po;o.doubleClickZoom=new Zo(d,p),this._add("tapZoom",p),this._add("clickZoom",d);var m=new Jn;this._add("tapDragZoom",m);var _=o.touchPitch=new Mu;this._add("touchPitch",_);var S=new Ks(n),P=new ku(n);o.dragRotate=new fa(n,S,P),this._add("mouseRotate",S,["mousePitch"]),this._add("mousePitch",P,["mouseRotate"]);var B=new Pu(n),F=new co(n);o.dragPan=new Oa(i,B,F),this._add("mousePan",B),this._add("touchPan",F,["touchZoom","touchRotate"]);var N=new cl,H=new Gi;o.touchZoomRotate=new Lo(i,H,N,m),this._add("touchRotate",N,["touchPan","touchZoom"]),this._add("touchZoom",H,["touchPan","touchRotate"]);var W=o.scrollZoom=new ar(o,this);this._add("scrollZoom",W,["mousePan"]);var ee=o.keyboard=new Do;this._add("keyboard",ee),this._add("blockableMapEvent",new Qe(o));for(var q=0,Q=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];q<Q.length;q+=1){var ae=Q[q];n.interactive&&n[ae]&&o[ae].enable(n[ae])}},gt.prototype._add=function(n,o,i){this._handlers.push({handlerName:n,handler:o,allowed:i}),this._handlersById[n]=o},gt.prototype.stop=function(n){if(!this._updatingCamera){for(var o=0,i=this._handlers;o<i.length;o+=1)i[o].handler.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[]}},gt.prototype.isActive=function(){for(var n=0,o=this._handlers;n<o.length;n+=1)if(o[n].handler.isActive())return!0;return!1},gt.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},gt.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},gt.prototype.isMoving=function(){return!!hi(this._eventsInProgress)||this.isZooming()},gt.prototype._blockedByActive=function(n,o,i){for(var s in n)if(s!==i&&(!o||o.indexOf(s)<0))return!0;return!1},gt.prototype.handleWindowEvent=function(n){this.handleEvent(n,n.type+"Window")},gt.prototype._getMapTouches=function(n){for(var o=[],i=0,s=n;i<s.length;i+=1){var p=s[i];this._el.contains(p.target)&&o.push(p)}return o},gt.prototype.handleEvent=function(n,o){this._updatingCamera=!0;for(var i=n.type==="renderFrame"?void 0:n,s={needsRenderFrame:!1},p={},d={},m=n.touches?this._getMapTouches(n.touches):void 0,_=m?Oe.touchPos(this._el,m):Oe.mousePos(this._el,n),S=0,P=this._handlers;S<P.length;S+=1){var B=P[S],F=B.handlerName,N=B.handler,H=B.allowed;if(N.isEnabled()){var W=void 0;this._blockedByActive(d,H,F)?N.reset():N[o||n.type]&&(W=N[o||n.type](n,_,m),this.mergeHandlerResult(s,p,W,F,i),W&&W.needsRenderFrame&&this._triggerRenderFrame()),(W||N.isActive())&&(d[F]=N)}}var ee={};for(var q in this._previousActiveHandlers)d[q]||(ee[q]=i);this._previousActiveHandlers=d,(Object.keys(ee).length||wt(s))&&(this._changes.push([s,p,ee]),this._triggerRenderFrame()),(Object.keys(d).length||wt(s))&&this._map._stop(!0),this._updatingCamera=!1;var Q=s.cameraAnimation;Q&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Q(this._map))},gt.prototype.mergeHandlerResult=function(n,o,i,s,p){if(i){l.extend(n,i);var d={handlerName:s,originalEvent:i.originalEvent||p};i.zoomDelta!==void 0&&(o.zoom=d),i.panDelta!==void 0&&(o.drag=d),i.pitchDelta!==void 0&&(o.pitch=d),i.bearingDelta!==void 0&&(o.rotate=d)}},gt.prototype._applyChanges=function(){for(var n={},o={},i={},s=0,p=this._changes;s<p.length;s+=1){var d=p[s],m=d[0],_=d[1],S=d[2];m.panDelta&&(n.panDelta=(n.panDelta||new l.Point(0,0))._add(m.panDelta)),m.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+m.pitchDelta),m.around!==void 0&&(n.around=m.around),m.pinchAround!==void 0&&(n.pinchAround=m.pinchAround),m.noInertia&&(n.noInertia=m.noInertia),l.extend(o,_),l.extend(i,S)}this._updateMapTransform(n,o,i),this._changes=[]},gt.prototype._updateMapTransform=function(n,o,i){var s=this._map,p=s.transform;if(!wt(n))return this._fireEvents(o,i,!0);var d=n.panDelta,m=n.zoomDelta,_=n.bearingDelta,S=n.pitchDelta,P=n.around,B=n.pinchAround;B!==void 0&&(P=B),s._stop(!0),P=P||s.transform.centerPoint;var F=p.pointLocation(d?P.sub(d):P);_&&(p.bearing+=_),S&&(p.pitch+=S),m&&(p.zoom+=m),p.setLocationAtPoint(F,P),this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(o,i,!0)},gt.prototype._fireEvents=function(n,o,i){var s=this,p=hi(this._eventsInProgress),d=hi(n),m={};for(var _ in n)this._eventsInProgress[_]||(m[_+"start"]=n[_].originalEvent),this._eventsInProgress[_]=n[_];for(var S in!p&&d&&this._fireEvent("movestart",d.originalEvent),m)this._fireEvent(S,m[S]);for(var P in d&&this._fireEvent("move",d.originalEvent),n)this._fireEvent(P,n[P].originalEvent);var B,F={};for(var N in this._eventsInProgress){var H=this._eventsInProgress[N],W=H.handlerName,ee=H.originalEvent;this._handlersById[W].isActive()||(delete this._eventsInProgress[N],F[N+"end"]=B=o[W]||ee)}for(var q in F)this._fireEvent(q,F[q]);var Q=hi(this._eventsInProgress);if(i&&(p||d)&&!Q){this._updatingCamera=!0;var ae=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),me=function(Ce){return Ce!==0&&-s._bearingSnap<Ce&&Ce<s._bearingSnap};ae?(me(ae.bearing||this._map.getBearing())&&(ae.bearing=0),this._map.easeTo(ae,{originalEvent:B})):(this._map.fire(new l.Event("moveend",{originalEvent:B})),me(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},gt.prototype._fireEvent=function(n,o){this._map.fire(new l.Event(n,o?{originalEvent:o}:{}))},gt.prototype._requestFrame=function(){var n=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(o){delete n._frameId,n.handleEvent(new Es("renderFrame",{timeStamp:o})),n._applyChanges()})},gt.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var Hs=function(n){function o(i,s){n.call(this),this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=s.bearingSnap,l.bindAll(["_renderFrameCallback"],this)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getCenter=function(){return new l.LngLat(this.transform.center.lng,this.transform.center.lat)},o.prototype.setCenter=function(i,s){return this.jumpTo({center:i},s)},o.prototype.panBy=function(i,s,p){return i=l.Point.convert(i).mult(-1),this.panTo(this.transform.center,l.extend({offset:i},s),p)},o.prototype.panTo=function(i,s,p){return this.easeTo(l.extend({center:i},s),p)},o.prototype.getZoom=function(){return this.transform.zoom},o.prototype.setZoom=function(i,s){return this.jumpTo({zoom:i},s),this},o.prototype.zoomTo=function(i,s,p){return this.easeTo(l.extend({zoom:i},s),p)},o.prototype.zoomIn=function(i,s){return this.zoomTo(this.getZoom()+1,i,s),this},o.prototype.zoomOut=function(i,s){return this.zoomTo(this.getZoom()-1,i,s),this},o.prototype.getBearing=function(){return this.transform.bearing},o.prototype.setBearing=function(i,s){return this.jumpTo({bearing:i},s),this},o.prototype.getPadding=function(){return this.transform.padding},o.prototype.setPadding=function(i,s){return this.jumpTo({padding:i},s),this},o.prototype.rotateTo=function(i,s,p){return this.easeTo(l.extend({bearing:i},s),p)},o.prototype.resetNorth=function(i,s){return this.rotateTo(0,l.extend({duration:1e3},i),s),this},o.prototype.resetNorthPitch=function(i,s){return this.easeTo(l.extend({bearing:0,pitch:0,duration:1e3},i),s),this},o.prototype.snapToNorth=function(i,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,s):this},o.prototype.getPitch=function(){return this.transform.pitch},o.prototype.setPitch=function(i,s){return this.jumpTo({pitch:i},s),this},o.prototype.cameraForBounds=function(i,s){i=l.LngLatBounds.convert(i);var p=s&&s.bearing||0;return this._cameraForBoxAndBearing(i.getNorthWest(),i.getSouthEast(),p,s)},o.prototype._cameraForBoxAndBearing=function(i,s,p,d){var m={top:0,bottom:0,right:0,left:0};if(typeof(d=l.extend({padding:m,offset:[0,0],maxZoom:this.transform.maxZoom},d)).padding=="number"){var _=d.padding;d.padding={top:_,bottom:_,right:_,left:_}}d.padding=l.extend(m,d.padding);var S=this.transform,P=S.padding,B=S.project(l.LngLat.convert(i)),F=S.project(l.LngLat.convert(s)),N=B.rotate(-p*Math.PI/180),H=F.rotate(-p*Math.PI/180),W=new l.Point(Math.max(N.x,H.x),Math.max(N.y,H.y)),ee=new l.Point(Math.min(N.x,H.x),Math.min(N.y,H.y)),q=W.sub(ee),Q=(S.width-(P.left+P.right+d.padding.left+d.padding.right))/q.x,ae=(S.height-(P.top+P.bottom+d.padding.top+d.padding.bottom))/q.y;if(!(ae<0||Q<0)){var me=Math.min(S.scaleZoom(S.scale*Math.min(Q,ae)),d.maxZoom),Ce=typeof d.offset.x=="number"?new l.Point(d.offset.x,d.offset.y):l.Point.convert(d.offset),we=new l.Point((d.padding.left-d.padding.right)/2,(d.padding.top-d.padding.bottom)/2).rotate(p*Math.PI/180),Ae=Ce.add(we).mult(S.scale/S.zoomScale(me));return{center:S.unproject(B.add(F).div(2).sub(Ae)),zoom:me,bearing:p}}l.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},o.prototype.fitBounds=function(i,s,p){return this._fitInternal(this.cameraForBounds(i,s),s,p)},o.prototype.fitScreenCoordinates=function(i,s,p,d,m){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(l.Point.convert(i)),this.transform.pointLocation(l.Point.convert(s)),p,d),d,m)},o.prototype._fitInternal=function(i,s,p){return i?(delete(s=l.extend(i,s)).padding,s.linear?this.easeTo(s,p):this.flyTo(s,p)):this},o.prototype.jumpTo=function(i,s){this.stop();var p=this.transform,d=!1,m=!1,_=!1;return"zoom"in i&&p.zoom!==+i.zoom&&(d=!0,p.zoom=+i.zoom),i.center!==void 0&&(p.center=l.LngLat.convert(i.center)),"bearing"in i&&p.bearing!==+i.bearing&&(m=!0,p.bearing=+i.bearing),"pitch"in i&&p.pitch!==+i.pitch&&(_=!0,p.pitch=+i.pitch),i.padding==null||p.isPaddingEqual(i.padding)||(p.padding=i.padding),this.fire(new l.Event("movestart",s)).fire(new l.Event("move",s)),d&&this.fire(new l.Event("zoomstart",s)).fire(new l.Event("zoom",s)).fire(new l.Event("zoomend",s)),m&&this.fire(new l.Event("rotatestart",s)).fire(new l.Event("rotate",s)).fire(new l.Event("rotateend",s)),_&&this.fire(new l.Event("pitchstart",s)).fire(new l.Event("pitch",s)).fire(new l.Event("pitchend",s)),this.fire(new l.Event("moveend",s))},o.prototype.easeTo=function(i,s){var p=this;this._stop(!1,i.easeId),((i=l.extend({offset:[0,0],duration:500,easing:l.ease},i)).animate===!1||!i.essential&&l.browser.prefersReducedMotion)&&(i.duration=0);var d=this.transform,m=this.getZoom(),_=this.getBearing(),S=this.getPitch(),P=this.getPadding(),B="zoom"in i?+i.zoom:m,F="bearing"in i?this._normalizeBearing(i.bearing,_):_,N="pitch"in i?+i.pitch:S,H="padding"in i?i.padding:d.padding,W=l.Point.convert(i.offset),ee=d.centerPoint.add(W),q=d.pointLocation(ee),Q=l.LngLat.convert(i.center||q);this._normalizeCenter(Q);var ae,me,Ce=d.project(q),we=d.project(Q).sub(Ce),Ae=d.zoomScale(B-m);i.around&&(ae=l.LngLat.convert(i.around),me=d.locationPoint(ae));var Re={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||B!==m,this._rotating=this._rotating||_!==F,this._pitching=this._pitching||N!==S,this._padding=!d.isPaddingEqual(H),this._easeId=i.easeId,this._prepareEase(s,i.noMoveStart,Re),this._ease(function(Ze){if(p._zooming&&(d.zoom=l.number(m,B,Ze)),p._rotating&&(d.bearing=l.number(_,F,Ze)),p._pitching&&(d.pitch=l.number(S,N,Ze)),p._padding&&(d.interpolatePadding(P,H,Ze),ee=d.centerPoint.add(W)),ae)d.setLocationAtPoint(ae,me);else{var qe=d.zoomScale(d.zoom-m),ct=B>m?Math.min(2,Ae):Math.max(.5,Ae),Et=Math.pow(ct,1-Ze),Ct=d.unproject(Ce.add(we.mult(Ze*Et)).mult(qe));d.setLocationAtPoint(d.renderWorldCopies?Ct.wrap():Ct,ee)}p._fireMoveEvents(s)},function(Ze){p._afterEase(s,Ze)},i),this},o.prototype._prepareEase=function(i,s,p){p===void 0&&(p={}),this._moving=!0,s||p.moving||this.fire(new l.Event("movestart",i)),this._zooming&&!p.zooming&&this.fire(new l.Event("zoomstart",i)),this._rotating&&!p.rotating&&this.fire(new l.Event("rotatestart",i)),this._pitching&&!p.pitching&&this.fire(new l.Event("pitchstart",i))},o.prototype._fireMoveEvents=function(i){this.fire(new l.Event("move",i)),this._zooming&&this.fire(new l.Event("zoom",i)),this._rotating&&this.fire(new l.Event("rotate",i)),this._pitching&&this.fire(new l.Event("pitch",i))},o.prototype._afterEase=function(i,s){if(!this._easeId||!s||this._easeId!==s){delete this._easeId;var p=this._zooming,d=this._rotating,m=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new l.Event("zoomend",i)),d&&this.fire(new l.Event("rotateend",i)),m&&this.fire(new l.Event("pitchend",i)),this.fire(new l.Event("moveend",i))}},o.prototype.flyTo=function(i,s){var p=this;if(!i.essential&&l.browser.prefersReducedMotion){var d=l.pick(i,["center","zoom","bearing","pitch","around"]);return this.jumpTo(d,s)}this.stop(),i=l.extend({offset:[0,0],speed:1.2,curve:1.42,easing:l.ease},i);var m=this.transform,_=this.getZoom(),S=this.getBearing(),P=this.getPitch(),B=this.getPadding(),F="zoom"in i?l.clamp(+i.zoom,m.minZoom,m.maxZoom):_,N="bearing"in i?this._normalizeBearing(i.bearing,S):S,H="pitch"in i?+i.pitch:P,W="padding"in i?i.padding:m.padding,ee=m.zoomScale(F-_),q=l.Point.convert(i.offset),Q=m.centerPoint.add(q),ae=m.pointLocation(Q),me=l.LngLat.convert(i.center||ae);this._normalizeCenter(me);var Ce=m.project(ae),we=m.project(me).sub(Ce),Ae=i.curve,Re=Math.max(m.width,m.height),Ze=Re/ee,qe=we.mag();if("minZoom"in i){var ct=l.clamp(Math.min(i.minZoom,_,F),m.minZoom,m.maxZoom),Et=Re/m.zoomScale(ct-_);Ae=Math.sqrt(Et/qe*2)}var Ct=Ae*Ae;function It(zt){var kt=(Ze*Ze-Re*Re+(zt?-1:1)*Ct*Ct*qe*qe)/(2*(zt?Ze:Re)*Ct*qe);return Math.log(Math.sqrt(kt*kt+1)-kt)}function mr(zt){return(Math.exp(zt)-Math.exp(-zt))/2}function dt(zt){return(Math.exp(zt)+Math.exp(-zt))/2}var Vt=It(0),Jt=function(zt){return dt(Vt)/dt(Vt+Ae*zt)},Ft=function(zt){return Re*((dt(Vt)*(mr(kt=Vt+Ae*zt)/dt(kt))-mr(Vt))/Ct)/qe;var kt},Ot=(It(1)-Vt)/Ae;if(Math.abs(qe)<1e-6||!isFinite(Ot)){if(Math.abs(Re-Ze)<1e-6)return this.easeTo(i,s);var Xt=Ze<Re?-1:1;Ot=Math.abs(Math.log(Ze/Re))/Ae,Ft=function(){return 0},Jt=function(zt){return Math.exp(Xt*Ae*zt)}}return i.duration="duration"in i?+i.duration:1e3*Ot/("screenSpeed"in i?+i.screenSpeed/Ae:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0),this._zooming=!0,this._rotating=S!==N,this._pitching=H!==P,this._padding=!m.isPaddingEqual(W),this._prepareEase(s,!1),this._ease(function(zt){var kt=zt*Ot,On=1/Jt(kt);m.zoom=zt===1?F:_+m.scaleZoom(On),p._rotating&&(m.bearing=l.number(S,N,zt)),p._pitching&&(m.pitch=l.number(P,H,zt)),p._padding&&(m.interpolatePadding(B,W,zt),Q=m.centerPoint.add(q));var on=zt===1?me:m.unproject(Ce.add(we.mult(Ft(kt))).mult(On));m.setLocationAtPoint(m.renderWorldCopies?on.wrap():on,Q),p._fireMoveEvents(s)},function(){return p._afterEase(s)},i),this},o.prototype.isEasing=function(){return!!this._easeFrameId},o.prototype.stop=function(){return this._stop()},o.prototype._stop=function(i,s){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var p=this._onEaseEnd;delete this._onEaseEnd,p.call(this,s)}if(!i){var d=this.handlers;d&&d.stop(!1)}return this},o.prototype._ease=function(i,s,p){p.animate===!1||p.duration===0?(i(1),s()):(this._easeStart=l.browser.now(),this._easeOptions=p,this._onEaseFrame=i,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},o.prototype._renderFrameCallback=function(){var i=Math.min((l.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(i)),i<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},o.prototype._normalizeBearing=function(i,s){i=l.wrap(i,-180,180);var p=Math.abs(i-s);return Math.abs(i-360-s)<p&&(i-=360),Math.abs(i+360-s)<p&&(i+=360),i},o.prototype._normalizeCenter=function(i){var s=this.transform;if(s.renderWorldCopies&&!s.lngRange){var p=i.lng-s.center.lng;i.lng+=p>180?-360:p<-180?360:0}},o}(l.Evented),fi=function(n){n===void 0&&(n={}),this.options=n,l.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};fi.prototype.getDefaultPosition=function(){return"bottom-right"},fi.prototype.onAdd=function(n){var o=this.options&&this.options.compact;return this._map=n,this._container=Oe.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Oe.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Oe.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),o&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),o===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},fi.prototype.onRemove=function(){Oe.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},fi.prototype._setElementTitle=function(n,o){var i=this._map._getUIString("AttributionControl."+o);n.title=i,n.setAttribute("aria-label",i)},fi.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},fi.prototype._updateEditLink=function(){var n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));var o=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||l.config.ACCESS_TOKEN}];if(n){var i=o.reduce(function(s,p,d){return p.value&&(s+=p.key+"="+p.value+(d<o.length-1?"&":"")),s},"?");n.href=l.config.FEEDBACK_URL+"/"+i+(this._map._hash?this._map._hash.getHashString(!0):""),n.rel="noopener nofollow",this._setElementTitle(n,"MapFeedback")}},fi.prototype._updateData=function(n){!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},fi.prototype._updateAttributions=function(){if(this._map.style){var n=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=n.concat(this.options.customAttribution.map(function(_){return typeof _!="string"?"":_})):typeof this.options.customAttribution=="string"&&n.push(this.options.customAttribution)),this._map.style.stylesheet){var o=this._map.style.stylesheet;this.styleOwner=o.owner,this.styleId=o.id}var i=this._map.style.sourceCaches;for(var s in i){var p=i[s];if(p.used){var d=p.getSource();d.attribution&&n.indexOf(d.attribution)<0&&n.push(d.attribution)}}n.sort(function(_,S){return _.length-S.length});var m=(n=n.filter(function(_,S){for(var P=S+1;P<n.length;P++)if(n[P].indexOf(_)>=0)return!1;return!0})).join(" | ");m!==this._attribHTML&&(this._attribHTML=m,n.length?(this._innerContainer.innerHTML=m,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},fi.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var Oo=function(){l.bindAll(["_updateLogo"],this),l.bindAll(["_updateCompact"],this)};Oo.prototype.onAdd=function(n){this._map=n,this._container=Oe.create("div","mapboxgl-ctrl");var o=Oe.create("a","mapboxgl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://www.mapbox.com/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},Oo.prototype.onRemove=function(){Oe.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},Oo.prototype.getDefaultPosition=function(){return"bottom-left"},Oo.prototype._updateLogo=function(n){n&&n.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},Oo.prototype._logoRequired=function(){if(this._map.style){var n=this._map.style.sourceCaches;for(var o in n)if(n[o].getSource().mapbox_logo)return!0;return!1}},Oo.prototype._updateCompact=function(){var n=this._container.children;if(n.length){var o=n[0];this._map.getCanvasContainer().offsetWidth<250?o.classList.add("mapboxgl-compact"):o.classList.remove("mapboxgl-compact")}};var Yn=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Yn.prototype.add=function(n){var o=++this._id;return this._queue.push({callback:n,id:o,cancelled:!1}),o},Yn.prototype.remove=function(n){for(var o=this._currentlyRunning,i=0,s=o?this._queue.concat(o):this._queue;i<s.length;i+=1){var p=s[i];if(p.id===n)return void(p.cancelled=!0)}},Yn.prototype.run=function(n){n===void 0&&(n=0);var o=this._currentlyRunning=this._queue;this._queue=[];for(var i=0,s=o;i<s.length;i+=1){var p=s[i];if(!p.cancelled&&(p.callback(n),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Yn.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var Go={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Du=l.window.HTMLImageElement,Js=l.window.HTMLElement,Tr=l.window.ImageBitmap,qn={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},pl=function(n){function o(s){var p=this;if((s=l.extend({},qn,s)).minZoom!=null&&s.maxZoom!=null&&s.minZoom>s.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(s.minPitch!=null&&s.maxPitch!=null&&s.minPitch>s.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(s.minPitch!=null&&s.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(s.maxPitch!=null&&s.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var d=new oe(s.minZoom,s.maxZoom,s.minPitch,s.maxPitch,s.renderWorldCopies);if(n.call(this,d,s),this._interactive=s.interactive,this._maxTileCacheSize=s.maxTileCacheSize,this._failIfMajorPerformanceCaveat=s.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=s.preserveDrawingBuffer,this._antialias=s.antialias,this._trackResize=s.trackResize,this._bearingSnap=s.bearingSnap,this._refreshExpiredTiles=s.refreshExpiredTiles,this._fadeDuration=s.fadeDuration,this._crossSourceCollisions=s.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=s.collectResourceTiming,this._renderTaskQueue=new Yn,this._controls=[],this._mapId=l.uniqueId(),this._locale=l.extend({},Go,s.locale),this._clickTolerance=s.clickTolerance,this._requestManager=new l.RequestManager(s.transformRequest,s.accessToken),typeof s.container=="string"){if(this._container=l.window.document.getElementById(s.container),!this._container)throw new Error("Container '"+s.container+"' not found.")}else{if(!(s.container instanceof Js))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=s.container}if(s.maxBounds&&this.setMaxBounds(s.maxBounds),l.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return p._update(!1)}),this.on("moveend",function(){return p._update(!1)}),this.on("zoom",function(){return p._update(!0)}),l.window!==void 0&&(l.window.addEventListener("online",this._onWindowOnline,!1),l.window.addEventListener("resize",this._onWindowResize,!1),l.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new gt(this,s),this._hash=s.hash&&new Ie(typeof s.hash=="string"&&s.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:s.center,zoom:s.zoom,bearing:s.bearing,pitch:s.pitch}),s.bounds&&(this.resize(),this.fitBounds(s.bounds,l.extend({},s.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=s.localIdeographFontFamily,s.style&&this.setStyle(s.style,{localIdeographFontFamily:s.localIdeographFontFamily}),s.attributionControl&&this.addControl(new fi({customAttribution:s.customAttribution})),this.addControl(new Oo,s.logoPosition),this.on("style.load",function(){p.transform.unmodified&&p.jumpTo(p.style.stylesheet)}),this.on("data",function(m){p._update(m.dataType==="style"),p.fire(new l.Event(m.dataType+"data",m))}),this.on("dataloading",function(m){p.fire(new l.Event(m.dataType+"dataloading",m))})}n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o;var i={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return o.prototype._getMapId=function(){return this._mapId},o.prototype.addControl=function(s,p){if(p===void 0&&(p=s.getDefaultPosition?s.getDefaultPosition():"top-right"),!s||!s.onAdd)return this.fire(new l.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var d=s.onAdd(this);this._controls.push(s);var m=this._controlPositions[p];return p.indexOf("bottom")!==-1?m.insertBefore(d,m.firstChild):m.appendChild(d),this},o.prototype.removeControl=function(s){if(!s||!s.onRemove)return this.fire(new l.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var p=this._controls.indexOf(s);return p>-1&&this._controls.splice(p,1),s.onRemove(this),this},o.prototype.hasControl=function(s){return this._controls.indexOf(s)>-1},o.prototype.resize=function(s){var p=this._containerDimensions(),d=p[0],m=p[1];if(d===this.transform.width&&m===this.transform.height)return this;this._resizeCanvas(d,m),this.transform.resize(d,m),this.painter.resize(d,m);var _=!this._moving;return _&&this.fire(new l.Event("movestart",s)).fire(new l.Event("move",s)),this.fire(new l.Event("resize",s)),_&&this.fire(new l.Event("moveend",s)),this},o.prototype.getBounds=function(){return this.transform.getBounds()},o.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},o.prototype.setMaxBounds=function(s){return this.transform.setMaxBounds(l.LngLatBounds.convert(s)),this._update()},o.prototype.setMinZoom=function(s){if((s=s??-2)>=-2&&s<=this.transform.maxZoom)return this.transform.minZoom=s,this._update(),this.getZoom()<s&&this.setZoom(s),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},o.prototype.getMinZoom=function(){return this.transform.minZoom},o.prototype.setMaxZoom=function(s){if((s=s??22)>=this.transform.minZoom)return this.transform.maxZoom=s,this._update(),this.getZoom()>s&&this.setZoom(s),this;throw new Error("maxZoom must be greater than the current minZoom")},o.prototype.getMaxZoom=function(){return this.transform.maxZoom},o.prototype.setMinPitch=function(s){if((s=s??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(s>=0&&s<=this.transform.maxPitch)return this.transform.minPitch=s,this._update(),this.getPitch()<s&&this.setPitch(s),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},o.prototype.getMinPitch=function(){return this.transform.minPitch},o.prototype.setMaxPitch=function(s){if((s=s??60)>60)throw new Error("maxPitch must be less than or equal to 60");if(s>=this.transform.minPitch)return this.transform.maxPitch=s,this._update(),this.getPitch()>s&&this.setPitch(s),this;throw new Error("maxPitch must be greater than the current minPitch")},o.prototype.getMaxPitch=function(){return this.transform.maxPitch},o.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},o.prototype.setRenderWorldCopies=function(s){return this.transform.renderWorldCopies=s,this._update()},o.prototype.project=function(s){return this.transform.locationPoint(l.LngLat.convert(s))},o.prototype.unproject=function(s){return this.transform.pointLocation(l.Point.convert(s))},o.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},o.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},o.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},o.prototype._createDelegatedListener=function(s,p,d){var m,_=this;if(s==="mouseenter"||s==="mouseover"){var S=!1;return{layer:p,listener:d,delegates:{mousemove:function(B){var F=_.getLayer(p)?_.queryRenderedFeatures(B.point,{layers:[p]}):[];F.length?S||(S=!0,d.call(_,new at(s,_,B.originalEvent,{features:F}))):S=!1},mouseout:function(){S=!1}}}}if(s==="mouseleave"||s==="mouseout"){var P=!1;return{layer:p,listener:d,delegates:{mousemove:function(B){(_.getLayer(p)?_.queryRenderedFeatures(B.point,{layers:[p]}):[]).length?P=!0:P&&(P=!1,d.call(_,new at(s,_,B.originalEvent)))},mouseout:function(B){P&&(P=!1,d.call(_,new at(s,_,B.originalEvent)))}}}}return{layer:p,listener:d,delegates:(m={},m[s]=function(B){var F=_.getLayer(p)?_.queryRenderedFeatures(B.point,{layers:[p]}):[];F.length&&(B.features=F,d.call(_,B),delete B.features)},m)}},o.prototype.on=function(s,p,d){if(d===void 0)return n.prototype.on.call(this,s,p);var m=this._createDelegatedListener(s,p,d);for(var _ in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[s]=this._delegatedListeners[s]||[],this._delegatedListeners[s].push(m),m.delegates)this.on(_,m.delegates[_]);return this},o.prototype.once=function(s,p,d){if(d===void 0)return n.prototype.once.call(this,s,p);var m=this._createDelegatedListener(s,p,d);for(var _ in m.delegates)this.once(_,m.delegates[_]);return this},o.prototype.off=function(s,p,d){var m=this;return d===void 0?n.prototype.off.call(this,s,p):(this._delegatedListeners&&this._delegatedListeners[s]&&function(_){for(var S=_[s],P=0;P<S.length;P++){var B=S[P];if(B.layer===p&&B.listener===d){for(var F in B.delegates)m.off(F,B.delegates[F]);return S.splice(P,1),m}}}(this._delegatedListeners),this)},o.prototype.queryRenderedFeatures=function(s,p){if(!this.style)return[];var d;if(p!==void 0||s===void 0||s instanceof l.Point||Array.isArray(s)||(p=s,s=void 0),p=p||{},(s=s||[[0,0],[this.transform.width,this.transform.height]])instanceof l.Point||typeof s[0]=="number")d=[l.Point.convert(s)];else{var m=l.Point.convert(s[0]),_=l.Point.convert(s[1]);d=[m,new l.Point(_.x,m.y),_,new l.Point(m.x,_.y),m]}return this.style.queryRenderedFeatures(d,p,this.transform)},o.prototype.querySourceFeatures=function(s,p){return this.style.querySourceFeatures(s,p)},o.prototype.setStyle=function(s,p){return(p=l.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},p)).diff!==!1&&p.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&s?(this._diffStyle(s,p),this):(this._localIdeographFontFamily=p.localIdeographFontFamily,this._updateStyle(s,p))},o.prototype._getUIString=function(s){var p=this._locale[s];if(p==null)throw new Error("Missing UI string '"+s+"'");return p},o.prototype._updateStyle=function(s,p){return this.style&&(this.style.setEventedParent(null),this.style._remove()),s?(this.style=new ni(this,p||{}),this.style.setEventedParent(this,{style:this.style}),typeof s=="string"?this.style.loadURL(s):this.style.loadJSON(s),this):(delete this.style,this)},o.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new ni(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},o.prototype._diffStyle=function(s,p){var d=this;if(typeof s=="string"){var m=this._requestManager.normalizeStyleURL(s),_=this._requestManager.transformRequest(m,l.ResourceType.Style);l.getJSON(_,function(S,P){S?d.fire(new l.ErrorEvent(S)):P&&d._updateDiff(P,p)})}else typeof s=="object"&&this._updateDiff(s,p)},o.prototype._updateDiff=function(s,p){try{this.style.setState(s)&&this._update(!0)}catch(d){l.warnOnce("Unable to perform style diff: "+(d.message||d.error||d)+".  Rebuilding the style from scratch."),this._updateStyle(s,p)}},o.prototype.getStyle=function(){if(this.style)return this.style.serialize()},o.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():l.warnOnce("There is no style added to the map.")},o.prototype.addSource=function(s,p){return this._lazyInitEmptyStyle(),this.style.addSource(s,p),this._update(!0)},o.prototype.isSourceLoaded=function(s){var p=this.style&&this.style.sourceCaches[s];if(p!==void 0)return p.loaded();this.fire(new l.ErrorEvent(new Error("There is no source with ID '"+s+"'")))},o.prototype.areTilesLoaded=function(){var s=this.style&&this.style.sourceCaches;for(var p in s){var d=s[p]._tiles;for(var m in d){var _=d[m];if(_.state!=="loaded"&&_.state!=="errored")return!1}}return!0},o.prototype.addSourceType=function(s,p,d){return this._lazyInitEmptyStyle(),this.style.addSourceType(s,p,d)},o.prototype.removeSource=function(s){return this.style.removeSource(s),this._update(!0)},o.prototype.getSource=function(s){return this.style.getSource(s)},o.prototype.addImage=function(s,p,d){d===void 0&&(d={});var m=d.pixelRatio;m===void 0&&(m=1);var _=d.sdf;_===void 0&&(_=!1);var S=d.stretchX,P=d.stretchY,B=d.content;if(this._lazyInitEmptyStyle(),p instanceof Du||Tr&&p instanceof Tr){var F=l.browser.getImageData(p);this.style.addImage(s,{data:new l.RGBAImage({width:F.width,height:F.height},F.data),pixelRatio:m,stretchX:S,stretchY:P,content:B,sdf:_,version:0})}else{if(p.width===void 0||p.height===void 0)return this.fire(new l.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var N=p;this.style.addImage(s,{data:new l.RGBAImage({width:p.width,height:p.height},new Uint8Array(p.data)),pixelRatio:m,stretchX:S,stretchY:P,content:B,sdf:_,version:0,userImage:N}),N.onAdd&&N.onAdd(this,s)}},o.prototype.updateImage=function(s,p){var d=this.style.getImage(s);if(!d)return this.fire(new l.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var m=p instanceof Du||Tr&&p instanceof Tr?l.browser.getImageData(p):p,_=m.width,S=m.height,P=m.data;return _===void 0||S===void 0?this.fire(new l.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):_!==d.data.width||S!==d.data.height?this.fire(new l.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(d.data.replace(P,!(p instanceof Du||Tr&&p instanceof Tr)),void this.style.updateImage(s,d))},o.prototype.hasImage=function(s){return s?!!this.style.getImage(s):(this.fire(new l.ErrorEvent(new Error("Missing required image id"))),!1)},o.prototype.removeImage=function(s){this.style.removeImage(s)},o.prototype.loadImage=function(s,p){l.getImage(this._requestManager.transformRequest(s,l.ResourceType.Image),p)},o.prototype.listImages=function(){return this.style.listImages()},o.prototype.addLayer=function(s,p){return this._lazyInitEmptyStyle(),this.style.addLayer(s,p),this._update(!0)},o.prototype.moveLayer=function(s,p){return this.style.moveLayer(s,p),this._update(!0)},o.prototype.removeLayer=function(s){return this.style.removeLayer(s),this._update(!0)},o.prototype.getLayer=function(s){return this.style.getLayer(s)},o.prototype.setLayerZoomRange=function(s,p,d){return this.style.setLayerZoomRange(s,p,d),this._update(!0)},o.prototype.setFilter=function(s,p,d){return d===void 0&&(d={}),this.style.setFilter(s,p,d),this._update(!0)},o.prototype.getFilter=function(s){return this.style.getFilter(s)},o.prototype.setPaintProperty=function(s,p,d,m){return m===void 0&&(m={}),this.style.setPaintProperty(s,p,d,m),this._update(!0)},o.prototype.getPaintProperty=function(s,p){return this.style.getPaintProperty(s,p)},o.prototype.setLayoutProperty=function(s,p,d,m){return m===void 0&&(m={}),this.style.setLayoutProperty(s,p,d,m),this._update(!0)},o.prototype.getLayoutProperty=function(s,p){return this.style.getLayoutProperty(s,p)},o.prototype.setLight=function(s,p){return p===void 0&&(p={}),this._lazyInitEmptyStyle(),this.style.setLight(s,p),this._update(!0)},o.prototype.getLight=function(){return this.style.getLight()},o.prototype.setFeatureState=function(s,p){return this.style.setFeatureState(s,p),this._update()},o.prototype.removeFeatureState=function(s,p){return this.style.removeFeatureState(s,p),this._update()},o.prototype.getFeatureState=function(s){return this.style.getFeatureState(s)},o.prototype.getContainer=function(){return this._container},o.prototype.getCanvasContainer=function(){return this._canvasContainer},o.prototype.getCanvas=function(){return this._canvas},o.prototype._containerDimensions=function(){var s=0,p=0;return this._container&&(s=this._container.clientWidth||400,p=this._container.clientHeight||300),[s,p]},o.prototype._detectMissingCSS=function(){l.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&l.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},o.prototype._setupContainer=function(){var s=this._container;s.classList.add("mapboxgl-map"),(this._missingCSSCanary=Oe.create("div","mapboxgl-canary",s)).style.visibility="hidden",this._detectMissingCSS();var p=this._canvasContainer=Oe.create("div","mapboxgl-canvas-container",s);this._interactive&&p.classList.add("mapboxgl-interactive"),this._canvas=Oe.create("canvas","mapboxgl-canvas",p),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var d=this._containerDimensions();this._resizeCanvas(d[0],d[1]);var m=this._controlContainer=Oe.create("div","mapboxgl-control-container",s),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(S){_[S]=Oe.create("div","mapboxgl-ctrl-"+S,m)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},o.prototype._resizeCanvas=function(s,p){var d=l.browser.devicePixelRatio||1;this._canvas.width=d*s,this._canvas.height=d*p,this._canvas.style.width=s+"px",this._canvas.style.height=p+"px"},o.prototype._setupPainter=function(){var s=l.extend({},ur.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),p=this._canvas.getContext("webgl",s)||this._canvas.getContext("experimental-webgl",s);p?(this.painter=new fe(p,this.transform),l.webpSupported.testSupport(p)):this.fire(new l.ErrorEvent(new Error("Failed to initialize WebGL")))},o.prototype._contextLost=function(s){s.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new l.Event("webglcontextlost",{originalEvent:s}))},o.prototype._contextRestored=function(s){this._setupPainter(),this.resize(),this._update(),this.fire(new l.Event("webglcontextrestored",{originalEvent:s}))},o.prototype._onMapScroll=function(s){if(s.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},o.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},o.prototype._update=function(s){return this.style?(this._styleDirty=this._styleDirty||s,this._sourcesDirty=!0,this.triggerRepaint(),this):this},o.prototype._requestRenderFrame=function(s){return this._update(),this._renderTaskQueue.add(s)},o.prototype._cancelRenderFrame=function(s){this._renderTaskQueue.remove(s)},o.prototype._render=function(s){var p,d=this,m=0,_=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(p=_.createQueryEXT(),_.beginQueryEXT(_.TIME_ELAPSED_EXT,p),m=l.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(s),!this._removed){var S=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var P=this.transform.zoom,B=l.browser.now();this.style.zoomHistory.update(P,B);var F=new l.EvaluationParameters(P,{now:B,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),N=F.crossFadingFactor();N===1&&N===this._crossFadingFactor||(S=!0,this._crossFadingFactor=N),this.style.update(F)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new l.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new l.Event("load"))),this.style&&(this.style.hasTransitions()||S)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var H=l.browser.now()-m;_.endQueryEXT(_.TIME_ELAPSED_EXT,p),setTimeout(function(){var q=_.getQueryObjectEXT(p,_.QUERY_RESULT_EXT)/1e6;_.deleteQueryEXT(p),d.fire(new l.Event("gpu-timing-frame",{cpuTime:H,gpuTime:q}))},50)}if(this.listens("gpu-timing-layer")){var W=this.painter.collectGpuTimers();setTimeout(function(){var q=d.painter.queryGpuTimers(W);d.fire(new l.Event("gpu-timing-layer",{layerTimes:q}))},50)}var ee=this._sourcesDirty||this._styleDirty||this._placementDirty;return ee||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.Event("idle")),!this._loaded||this._fullyLoaded||ee||(this._fullyLoaded=!0),this}},o.prototype.remove=function(){this._hash&&this._hash.remove();for(var s=0,p=this._controls;s<p.length;s+=1)p[s].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),l.window!==void 0&&(l.window.removeEventListener("resize",this._onWindowResize,!1),l.window.removeEventListener("orientationchange",this._onWindowResize,!1),l.window.removeEventListener("online",this._onWindowOnline,!1));var d=this.painter.context.gl.getExtension("WEBGL_lose_context");d&&d.loseContext(),Ra(this._canvasContainer),Ra(this._controlContainer),Ra(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new l.Event("remove"))},o.prototype.triggerRepaint=function(){var s=this;this.style&&!this._frame&&(this._frame=l.browser.frame(function(p){s._frame=null,s._render(p)}))},o.prototype._onWindowOnline=function(){this._update()},o.prototype._onWindowResize=function(s){this._trackResize&&this.resize({originalEvent:s})._update()},i.showTileBoundaries.get=function(){return!!this._showTileBoundaries},i.showTileBoundaries.set=function(s){this._showTileBoundaries!==s&&(this._showTileBoundaries=s,this._update())},i.showPadding.get=function(){return!!this._showPadding},i.showPadding.set=function(s){this._showPadding!==s&&(this._showPadding=s,this._update())},i.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},i.showCollisionBoxes.set=function(s){this._showCollisionBoxes!==s&&(this._showCollisionBoxes=s,s?this.style._generateCollisionBoxes():this._update())},i.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},i.showOverdrawInspector.set=function(s){this._showOverdrawInspector!==s&&(this._showOverdrawInspector=s,this._update())},i.repaint.get=function(){return!!this._repaint},i.repaint.set=function(s){this._repaint!==s&&(this._repaint=s,this.triggerRepaint())},i.vertices.get=function(){return!!this._vertices},i.vertices.set=function(s){this._vertices=s,this._update()},o.prototype._setCacheLimits=function(s,p){l.setCacheLimits(s,p)},i.version.get=function(){return l.version},Object.defineProperties(o.prototype,i),o}(Hs);function Ra(n){n.parentNode&&n.parentNode.removeChild(n)}var Lu={showCompass:!0,showZoom:!0,visualizePitch:!1},ea=function(n){var o=this;this.options=l.extend({},Lu,n),this._container=Oe.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(i){return i.preventDefault()}),this.options.showZoom&&(l.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(i){return o._map.zoomIn({},{originalEvent:i})}),Oe.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(i){return o._map.zoomOut({},{originalEvent:i})}),Oe.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(l.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(i){o.options.visualizePitch?o._map.resetNorthPitch({},{originalEvent:i}):o._map.resetNorth({},{originalEvent:i})}),this._compassIcon=Oe.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};ea.prototype._updateZoomButtons=function(){var n=this._map.getZoom(),o=n===this._map.getMaxZoom(),i=n===this._map.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=i,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",i.toString())},ea.prototype._rotateCompassArrow=function(){var n=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=n},ea.prototype.onAdd=function(n){return this._map=n,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ki(this._map,this._compass,this.options.visualizePitch)),this._container},ea.prototype.onRemove=function(){Oe.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},ea.prototype._createButton=function(n,o){var i=Oe.create("button",n,this._container);return i.type="button",i.addEventListener("click",o),i},ea.prototype._setButtonTitle=function(n,o){var i=this._map._getUIString("NavigationControl."+o);n.title=i,n.setAttribute("aria-label",i)};var Ki=function(n,o,i){i===void 0&&(i=!1),this._clickTolerance=10,this.element=o,this.mouseRotate=new Ks({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,i&&(this.mousePitch=new ku({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),l.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),Oe.addEventListener(o,"mousedown",this.mousedown),Oe.addEventListener(o,"touchstart",this.touchstart,{passive:!1}),Oe.addEventListener(o,"touchmove",this.touchmove),Oe.addEventListener(o,"touchend",this.touchend),Oe.addEventListener(o,"touchcancel",this.reset)};function rs(n,o,i){if(n=new l.LngLat(n.lng,n.lat),o){var s=new l.LngLat(n.lng-360,n.lat),p=new l.LngLat(n.lng+360,n.lat),d=i.locationPoint(n).distSqr(o);i.locationPoint(s).distSqr(o)<d?n=s:i.locationPoint(p).distSqr(o)<d&&(n=p)}for(;Math.abs(n.lng-i.center.lng)>180;){var m=i.locationPoint(n);if(m.x>=0&&m.y>=0&&m.x<=i.width&&m.y<=i.height)break;n.lng>i.center.lng?n.lng-=360:n.lng+=360}return n}Ki.prototype.down=function(n,o){this.mouseRotate.mousedown(n,o),this.mousePitch&&this.mousePitch.mousedown(n,o),Oe.disableDrag()},Ki.prototype.move=function(n,o){var i=this.map,s=this.mouseRotate.mousemoveWindow(n,o);if(s&&s.bearingDelta&&i.setBearing(i.getBearing()+s.bearingDelta),this.mousePitch){var p=this.mousePitch.mousemoveWindow(n,o);p&&p.pitchDelta&&i.setPitch(i.getPitch()+p.pitchDelta)}},Ki.prototype.off=function(){var n=this.element;Oe.removeEventListener(n,"mousedown",this.mousedown),Oe.removeEventListener(n,"touchstart",this.touchstart,{passive:!1}),Oe.removeEventListener(n,"touchmove",this.touchmove),Oe.removeEventListener(n,"touchend",this.touchend),Oe.removeEventListener(n,"touchcancel",this.reset),this.offTemp()},Ki.prototype.offTemp=function(){Oe.enableDrag(),Oe.removeEventListener(l.window,"mousemove",this.mousemove),Oe.removeEventListener(l.window,"mouseup",this.mouseup)},Ki.prototype.mousedown=function(n){this.down(l.extend({},n,{ctrlKey:!0,preventDefault:function(){return n.preventDefault()}}),Oe.mousePos(this.element,n)),Oe.addEventListener(l.window,"mousemove",this.mousemove),Oe.addEventListener(l.window,"mouseup",this.mouseup)},Ki.prototype.mousemove=function(n){this.move(n,Oe.mousePos(this.element,n))},Ki.prototype.mouseup=function(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()},Ki.prototype.touchstart=function(n){n.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Oe.touchPos(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return n.preventDefault()}},this._startPos))},Ki.prototype.touchmove=function(n){n.targetTouches.length!==1?this.reset():(this._lastPos=Oe.touchPos(this.element,n.targetTouches)[0],this.move({preventDefault:function(){return n.preventDefault()}},this._lastPos))},Ki.prototype.touchend=function(n){n.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},Ki.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var Ko={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ys(n,o,i){var s=n.classList;for(var p in Ko)s.remove("mapboxgl-"+i+"-anchor-"+p);s.add("mapboxgl-"+i+"-anchor-"+o)}var ns,Ss=function(n){function o(i,s){if(n.call(this),(i instanceof l.window.HTMLElement||s)&&(i=l.extend({element:i},s)),l.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&i.pitchAlignment!=="auto"?i.pitchAlignment:this._rotationAlignment,i&&i.element)this._element=i.element,this._offset=l.Point.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=Oe.create("div"),this._element.setAttribute("aria-label","Map marker");var p=Oe.createNS("http://www.w3.org/2000/svg","svg");p.setAttributeNS(null,"display","block"),p.setAttributeNS(null,"height","41px"),p.setAttributeNS(null,"width","27px"),p.setAttributeNS(null,"viewBox","0 0 27 41");var d=Oe.createNS("http://www.w3.org/2000/svg","g");d.setAttributeNS(null,"stroke","none"),d.setAttributeNS(null,"stroke-width","1"),d.setAttributeNS(null,"fill","none"),d.setAttributeNS(null,"fill-rule","evenodd");var m=Oe.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"fill-rule","nonzero");var _=Oe.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"transform","translate(3.0, 29.0)"),_.setAttributeNS(null,"fill","#000000");for(var S=0,P=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];S<P.length;S+=1){var B=P[S],F=Oe.createNS("http://www.w3.org/2000/svg","ellipse");F.setAttributeNS(null,"opacity","0.04"),F.setAttributeNS(null,"cx","10.5"),F.setAttributeNS(null,"cy","5.80029008"),F.setAttributeNS(null,"rx",B.rx),F.setAttributeNS(null,"ry",B.ry),_.appendChild(F)}var N=Oe.createNS("http://www.w3.org/2000/svg","g");N.setAttributeNS(null,"fill",this._color);var H=Oe.createNS("http://www.w3.org/2000/svg","path");H.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),N.appendChild(H);var W=Oe.createNS("http://www.w3.org/2000/svg","g");W.setAttributeNS(null,"opacity","0.25"),W.setAttributeNS(null,"fill","#000000");var ee=Oe.createNS("http://www.w3.org/2000/svg","path");ee.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),W.appendChild(ee);var q=Oe.createNS("http://www.w3.org/2000/svg","g");q.setAttributeNS(null,"transform","translate(6.0, 7.0)"),q.setAttributeNS(null,"fill","#FFFFFF");var Q=Oe.createNS("http://www.w3.org/2000/svg","g");Q.setAttributeNS(null,"transform","translate(8.0, 8.0)");var ae=Oe.createNS("http://www.w3.org/2000/svg","circle");ae.setAttributeNS(null,"fill","#000000"),ae.setAttributeNS(null,"opacity","0.25"),ae.setAttributeNS(null,"cx","5.5"),ae.setAttributeNS(null,"cy","5.5"),ae.setAttributeNS(null,"r","5.4999962");var me=Oe.createNS("http://www.w3.org/2000/svg","circle");me.setAttributeNS(null,"fill","#FFFFFF"),me.setAttributeNS(null,"cx","5.5"),me.setAttributeNS(null,"cy","5.5"),me.setAttributeNS(null,"r","5.4999962"),Q.appendChild(ae),Q.appendChild(me),m.appendChild(_),m.appendChild(N),m.appendChild(W),m.appendChild(q),m.appendChild(Q),p.appendChild(m),p.setAttributeNS(null,"height",41*this._scale+"px"),p.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(p),this._offset=l.Point.convert(i&&i.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(Ce){Ce.preventDefault()}),this._element.addEventListener("mousedown",function(Ce){Ce.preventDefault()}),Ys(this._element,this._anchor,"marker"),this._popup=null}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.addTo=function(i){return this.remove(),this._map=i,i.getCanvasContainer().appendChild(this._element),i.on("move",this._update),i.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},o.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),Oe.remove(this._element),this._popup&&this._popup.remove(),this},o.prototype.getLngLat=function(){return this._lngLat},o.prototype.setLngLat=function(i){return this._lngLat=l.LngLat.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},o.prototype.getElement=function(){return this._element},o.prototype.setPopup=function(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){var s=Math.sqrt(Math.pow(13.5,2)/2);i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[s,-1*(24.6+s)],"bottom-right":[-s,-1*(24.6+s)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=i,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},o.prototype._onKeyPress=function(i){var s=i.code,p=i.charCode||i.keyCode;s!=="Space"&&s!=="Enter"&&p!==32&&p!==13||this.togglePopup()},o.prototype._onMapClick=function(i){var s=i.originalEvent.target,p=this._element;this._popup&&(s===p||p.contains(s))&&this.togglePopup()},o.prototype.getPopup=function(){return this._popup},o.prototype.togglePopup=function(){var i=this._popup;return i?(i.isOpen()?i.remove():i.addTo(this._map),this):this},o.prototype._update=function(i){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=rs(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var s="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?s="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(s="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var p="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?p="rotateX(0deg)":this._pitchAlignment==="map"&&(p="rotateX("+this._map.getPitch()+"deg)"),i&&i.type!=="moveend"||(this._pos=this._pos.round()),Oe.setTransform(this._element,Ko[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+p+" "+s)}},o.prototype.getOffset=function(){return this._offset},o.prototype.setOffset=function(i){return this._offset=l.Point.convert(i),this._update(),this},o.prototype._onMove=function(i){if(!this._isDragging){var s=this._clickTolerance||this._map._clickTolerance;this._isDragging=i.point.dist(this._pointerdownPos)>=s}this._isDragging&&(this._pos=i.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.Event("dragstart"))),this.fire(new l.Event("drag")))},o.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.Event("dragend")),this._state="inactive"},o.prototype._addDragHandler=function(i){this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(this._pos).add(this._offset),this._pointerdownPos=i.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},o.prototype.setDraggable=function(i){return this._draggable=!!i,this._map&&(i?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},o.prototype.isDraggable=function(){return this._draggable},o.prototype.setRotation=function(i){return this._rotation=i||0,this._update(),this},o.prototype.getRotation=function(){return this._rotation},o.prototype.setRotationAlignment=function(i){return this._rotationAlignment=i||"auto",this._update(),this},o.prototype.getRotationAlignment=function(){return this._rotationAlignment},o.prototype.setPitchAlignment=function(i){return this._pitchAlignment=i&&i!=="auto"?i:this._rotationAlignment,this._update(),this},o.prototype.getPitchAlignment=function(){return this._pitchAlignment},o}(l.Evented),Ou={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},is=0,Ba=!1,Ru=function(n){function o(i){n.call(this),this.options=l.extend({},Ou,i),l.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.onAdd=function(i){var s;return this._map=i,this._container=Oe.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),s=this._setupUI,ns!==void 0?s(ns):l.window.navigator.permissions!==void 0?l.window.navigator.permissions.query({name:"geolocation"}).then(function(p){s(ns=p.state!=="denied")}):s(ns=!!l.window.navigator.geolocation),this._container},o.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(l.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),Oe.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,is=0,Ba=!1},o.prototype._isOutOfMapMaxBounds=function(i){var s=this._map.getMaxBounds(),p=i.coords;return s&&(p.longitude<s.getWest()||p.longitude>s.getEast()||p.latitude<s.getSouth()||p.latitude>s.getNorth())},o.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},o.prototype._onSuccess=function(i){if(this._map){if(this._isOutOfMapMaxBounds(i))return this._setErrorState(),this.fire(new l.Event("outofmaxbounds",i)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=i,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(i),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(i),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new l.Event("geolocate",i)),this._finish()}},o.prototype._updateCamera=function(i){var s=new l.LngLat(i.coords.longitude,i.coords.latitude),p=i.coords.accuracy,d=this._map.getBearing(),m=l.extend({bearing:d},this.options.fitBoundsOptions);this._map.fitBounds(s.toBounds(p),m,{geolocateSource:!0})},o.prototype._updateMarker=function(i){if(i){var s=new l.LngLat(i.coords.longitude,i.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=i.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},o.prototype._updateCircleRadius=function(){var i=this._map._container.clientHeight/2,s=this._map.unproject([0,i]),p=this._map.unproject([1,i]),d=s.distanceTo(p),m=Math.ceil(2*this._accuracy/d);this._circleElement.style.width=m+"px",this._circleElement.style.height=m+"px"},o.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},o.prototype._onError=function(i){if(this._map){if(this.options.trackUserLocation)if(i.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(i.code===3&&Ba)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new l.Event("error",i)),this._finish()}},o.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},o.prototype._setupUI=function(i){var s=this;if(this._container.addEventListener("contextmenu",function(m){return m.preventDefault()}),this._geolocateButton=Oe.create("button","mapboxgl-ctrl-geolocate",this._container),Oe.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",i===!1){l.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var p=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=p,this._geolocateButton.setAttribute("aria-label",p)}else{var d=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Oe.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new Ss(this._dotElement),this._circleElement=Oe.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ss({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(m){m.geolocateSource||s._watchState!=="ACTIVE_LOCK"||m.originalEvent&&m.originalEvent.type==="resize"||(s._watchState="BACKGROUND",s._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),s._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),s.fire(new l.Event("trackuserlocationend")))})},o.prototype.trigger=function(){if(!this._setup)return l.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":is--,Ba=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new l.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var i;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++is>1?(i={maximumAge:6e5,timeout:0},Ba=!0):(i=this.options.positionOptions,Ba=!1),this._geolocationWatchID=l.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,i)}}else l.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},o.prototype._clearWatch=function(){l.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},o}(l.Evented),da={maxWidth:100,unit:"metric"},ma=function(n){this.options=l.extend({},da,n),l.bindAll(["_onMove","setUnit"],this)};function $s(n,o,i){var s=i&&i.maxWidth||100,p=n._container.clientHeight/2,d=n.unproject([0,p]),m=n.unproject([s,p]),_=d.distanceTo(m);if(i&&i.unit==="imperial"){var S=3.2808*_;S>5280?ya(o,s,S/5280,n._getUIString("ScaleControl.Miles")):ya(o,s,S,n._getUIString("ScaleControl.Feet"))}else i&&i.unit==="nautical"?ya(o,s,_/1852,n._getUIString("ScaleControl.NauticalMiles")):_>=1e3?ya(o,s,_/1e3,n._getUIString("ScaleControl.Kilometers")):ya(o,s,_,n._getUIString("ScaleControl.Meters"))}function ya(n,o,i,s){var p,d,m,_=(p=i,(d=Math.pow(10,(""+Math.floor(p)).length-1))*(m=(m=p/d)>=10?10:m>=5?5:m>=3?3:m>=2?2:m>=1?1:function(S){var P=Math.pow(10,Math.ceil(-Math.log(S)/Math.LN10));return Math.round(S*P)/P}(m)));n.style.width=o*(_/i)+"px",n.innerHTML=_+"&nbsp;"+s}ma.prototype.getDefaultPosition=function(){return"bottom-left"},ma.prototype._onMove=function(){$s(this._map,this._container,this.options)},ma.prototype.onAdd=function(n){return this._map=n,this._container=Oe.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",n.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},ma.prototype.onRemove=function(){Oe.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},ma.prototype.setUnit=function(n){this.options.unit=n,$s(this._map,this._container,this.options)};var ho=function(n){this._fullscreen=!1,n&&n.container&&(n.container instanceof l.window.HTMLElement?this._container=n.container:l.warnOnce("Full screen control 'container' must be a DOM element.")),l.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in l.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in l.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in l.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in l.window.document&&(this._fullscreenchange="MSFullscreenChange")};ho.prototype.onAdd=function(n){return this._map=n,this._container||(this._container=this._map.getContainer()),this._controlContainer=Oe.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",l.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},ho.prototype.onRemove=function(){Oe.remove(this._controlContainer),this._map=null,l.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},ho.prototype._checkFullscreenSupport=function(){return!!(l.window.document.fullscreenEnabled||l.window.document.mozFullScreenEnabled||l.window.document.msFullscreenEnabled||l.window.document.webkitFullscreenEnabled)},ho.prototype._setupUI=function(){var n=this._fullscreenButton=Oe.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Oe.create("span","mapboxgl-ctrl-icon",n).setAttribute("aria-hidden",!0),n.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),l.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},ho.prototype._updateTitle=function(){var n=this._getTitle();this._fullscreenButton.setAttribute("aria-label",n),this._fullscreenButton.title=n},ho.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},ho.prototype._isFullscreen=function(){return this._fullscreen},ho.prototype._changeIcon=function(){(l.window.document.fullscreenElement||l.window.document.mozFullScreenElement||l.window.document.webkitFullscreenElement||l.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},ho.prototype._onClickFullscreen=function(){this._isFullscreen()?l.window.document.exitFullscreen?l.window.document.exitFullscreen():l.window.document.mozCancelFullScreen?l.window.document.mozCancelFullScreen():l.window.document.msExitFullscreen?l.window.document.msExitFullscreen():l.window.document.webkitCancelFullScreen&&l.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var Bu={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Ts=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Fu=function(n){function o(i){n.call(this),this.options=l.extend(Object.create(Bu),i),l.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.addTo=function(i){return this._map&&this.remove(),this._map=i,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new l.Event("open")),this},o.prototype.isOpen=function(){return!!this._map},o.prototype.remove=function(){return this._content&&Oe.remove(this._content),this._container&&(Oe.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new l.Event("close")),this},o.prototype.getLngLat=function(){return this._lngLat},o.prototype.setLngLat=function(i){return this._lngLat=l.LngLat.convert(i),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},o.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},o.prototype.getElement=function(){return this._container},o.prototype.setText=function(i){return this.setDOMContent(l.window.document.createTextNode(i))},o.prototype.setHTML=function(i){var s,p=l.window.document.createDocumentFragment(),d=l.window.document.createElement("body");for(d.innerHTML=i;s=d.firstChild;)p.appendChild(s);return this.setDOMContent(p)},o.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},o.prototype.setMaxWidth=function(i){return this.options.maxWidth=i,this._update(),this},o.prototype.setDOMContent=function(i){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Oe.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(i),this._createCloseButton(),this._update(),this._focusFirstElement(),this},o.prototype.addClassName=function(i){this._container&&this._container.classList.add(i)},o.prototype.removeClassName=function(i){this._container&&this._container.classList.remove(i)},o.prototype.setOffset=function(i){return this.options.offset=i,this._update(),this},o.prototype.toggleClassName=function(i){if(this._container)return this._container.classList.toggle(i)},o.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=Oe.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},o.prototype._onMouseUp=function(i){this._update(i.point)},o.prototype._onMouseMove=function(i){this._update(i.point)},o.prototype._onDrag=function(i){this._update(i.point)},o.prototype._update=function(i){var s=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=Oe.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=Oe.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(F){return s._container.classList.add(F)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=rs(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||i)){var p=this._pos=this._trackPointer&&i?i:this._map.project(this._lngLat),d=this.options.anchor,m=function F(N){if(N){if(typeof N=="number"){var H=Math.round(Math.sqrt(.5*Math.pow(N,2)));return{center:new l.Point(0,0),top:new l.Point(0,N),"top-left":new l.Point(H,H),"top-right":new l.Point(-H,H),bottom:new l.Point(0,-N),"bottom-left":new l.Point(H,-H),"bottom-right":new l.Point(-H,-H),left:new l.Point(N,0),right:new l.Point(-N,0)}}if(N instanceof l.Point||Array.isArray(N)){var W=l.Point.convert(N);return{center:W,top:W,"top-left":W,"top-right":W,bottom:W,"bottom-left":W,"bottom-right":W,left:W,right:W}}return{center:l.Point.convert(N.center||[0,0]),top:l.Point.convert(N.top||[0,0]),"top-left":l.Point.convert(N["top-left"]||[0,0]),"top-right":l.Point.convert(N["top-right"]||[0,0]),bottom:l.Point.convert(N.bottom||[0,0]),"bottom-left":l.Point.convert(N["bottom-left"]||[0,0]),"bottom-right":l.Point.convert(N["bottom-right"]||[0,0]),left:l.Point.convert(N.left||[0,0]),right:l.Point.convert(N.right||[0,0])}}return F(new l.Point(0,0))}(this.options.offset);if(!d){var _,S=this._container.offsetWidth,P=this._container.offsetHeight;_=p.y+m.bottom.y<P?["top"]:p.y>this._map.transform.height-P?["bottom"]:[],p.x<S/2?_.push("left"):p.x>this._map.transform.width-S/2&&_.push("right"),d=_.length===0?"bottom":_.join("-")}var B=p.add(m[d]).round();Oe.setTransform(this._container,Ko[d]+" translate("+B.x+"px,"+B.y+"px)"),Ys(this._container,d,"popup")}},o.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var i=this._container.querySelector(Ts);i&&i.focus()}},o.prototype._onClose=function(){this.remove()},o}(l.Evented),Qs={version:l.version,supported:ur,setRTLTextPlugin:l.setRTLTextPlugin,getRTLTextPluginStatus:l.getRTLTextPluginStatus,Map:pl,NavigationControl:ea,GeolocateControl:Ru,AttributionControl:fi,ScaleControl:ma,FullscreenControl:ho,Popup:Fu,Marker:Ss,Style:ni,LngLat:l.LngLat,LngLatBounds:l.LngLatBounds,Point:l.Point,MercatorCoordinate:l.MercatorCoordinate,Evented:l.Evented,config:l.config,prewarm:function(){Se().acquire(Ee)},clearPrewarmedResources:function(){var n=ot;n&&(n.isPreloaded()&&n.numActive()===1?(n.release(Ee),ot=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return l.config.ACCESS_TOKEN},set accessToken(n){l.config.ACCESS_TOKEN=n},get baseApiUrl(){return l.config.API_URL},set baseApiUrl(n){l.config.API_URL=n},get workerCount(){return ke.workerCount},set workerCount(n){ke.workerCount=n},get maxParallelImageRequests(){return l.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(n){l.config.MAX_PARALLEL_IMAGE_REQUESTS=n},clearStorage:function(n){l.clearTileCache(n)},workerUrl:""};return Qs}),lr})})(Wp);var Hp=Wp.exports;const Bf=Ic(Hp),ed=zf({__proto__:null,default:Bf},[Hp]),td=Hi(null),rd=Hi(null);function Ff(){const{subscribe:Zr,set:Nr,update:tr}=Hi([]);function mt(lr,Cr){const l=Zr(lr,Cr);return()=>{l()}}return{subscribe:mt,set:Nr,update:tr}}const nd=Ff();function Nf(){const{subscribe:Zr,set:Nr,update:tr}=Hi([],()=>()=>{});return{subscribe:Zr,set:Nr,update:tr}}const id=Nf();function Uf(){const{subscribe:Zr,set:Nr,update:tr}=Hi([],()=>()=>{});return{subscribe:Zr,set:Nr,update:tr}}const od=Uf(),ad=Hi({synchronizeMarkers:null,spinning:!1});function Vf(){const{subscribe:Zr,set:Nr,update:tr}=Hi(null);return{subscribe:Zr,set:Nr,update:tr,triggerLocationMarker:()=>tr(mt=>Date.now())}}const sd=Vf(),jf=(Zr,Nr)=>{const tr=Zr[Nr];return tr?typeof tr=="function"?tr():Promise.resolve(tr):new Promise((mt,lr)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(lr.bind(null,new Error("Unknown variable dynamic import: "+Nr)))})};function qf(){const{subscribe:Zr,set:Nr,update:tr}=Hi({id:null,coordinates:null,last_update:null,is_trailing:!1,vehicle_marker:{type:"simpleTractor",color:"red",size:"25px",swath:12,path:()=>Mf(()=>import("./SimpleTractor.Db3ZCE0C.js"),__vite__mapDeps([0,1,2]),import.meta.url)},heading:0});return{subscribe:Zr,set:Nr,update:tr,updateVehicleMarker:mt=>{tr(lr=>({...lr,vehicle_marker:{...lr.vehicle_marker,...mt,path:()=>jf(Object.assign({}),`../components/SVG/${mt.type}.svelte`)}}))}}}const ud=qf(),ld=Hi(!1),cd=Hi([]),pd=Hi([]),hd=Hi([]);var Jp={exports:{}};(function(Zr,Nr){var tr;tr=function(){const mt=function(v,E){const j={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},be={on(V,Ne,Ge){if(j[V]===void 0)throw new Error(`Invalid event type: ${V}`);j[V].push({selector:Ne,fn:Ge})},render(V){E.store.featureChanged(V)}},ue=function(V,Ne){const Ge=j[V];let Ve=Ge.length;for(;Ve--;){const Le=Ge[Ve];if(Le.selector(Ne)){Le.fn.call(be,Ne)||E.store.render(),E.ui.updateMapClasses();break}}};return v.start.call(be),{render:v.render,stop(){v.stop&&v.stop()},trash(){v.trash&&(v.trash(),E.store.render())},combineFeatures(){v.combineFeatures&&v.combineFeatures()},uncombineFeatures(){v.uncombineFeatures&&v.uncombineFeatures()},drag(V){ue("drag",V)},click(V){ue("click",V)},mousemove(V){ue("mousemove",V)},mousedown(V){ue("mousedown",V)},mouseup(V){ue("mouseup",V)},mouseout(V){ue("mouseout",V)},keydown(V){ue("keydown",V)},keyup(V){ue("keyup",V)},touchstart(V){ue("touchstart",V)},touchmove(V){ue("touchmove",V)},touchend(V){ue("touchend",V)},tap(V){ue("tap",V)}}};function lr(v){return v&&v.__esModule&&Object.prototype.hasOwnProperty.call(v,"default")?v.default:v}var Cr,l,ur={},Oe={};function Ur(){return Cr||(Cr=1,Oe.RADIUS=6378137,Oe.FLATTENING=1/298.257223563,Oe.POLAR_RADIUS=63567523142e-4),Oe}var Rt=function(){if(l)return ur;l=1;var v=Ur();function E(ue){var V=0;if(ue&&ue.length>0){V+=Math.abs(j(ue[0]));for(var Ne=1;Ne<ue.length;Ne++)V-=Math.abs(j(ue[Ne]))}return V}function j(ue){var V,Ne,Ge,Ve,Le,st,At=0,er=ue.length;if(er>2){for(st=0;st<er;st++)st===er-2?(Ge=er-2,Ve=er-1,Le=0):st===er-1?(Ge=er-1,Ve=0,Le=1):(Ge=st,Ve=st+1,Le=st+2),V=ue[Ge],Ne=ue[Ve],At+=(be(ue[Le][0])-be(V[0]))*Math.sin(be(Ne[1]));At=At*v.RADIUS*v.RADIUS/2}return At}function be(ue){return ue*Math.PI/180}return ur.geometry=function ue(V){var Ne,Ge=0;switch(V.type){case"Polygon":return E(V.coordinates);case"MultiPolygon":for(Ne=0;Ne<V.coordinates.length;Ne++)Ge+=E(V.coordinates[Ne]);return Ge;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(Ne=0;Ne<V.geometries.length;Ne++)Ge+=ue(V.geometries[Ne]);return Ge}},ur.ring=j,ur}(),Gr=lr(Rt);const Xe={CANVAS:"mapboxgl-canvas",CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},Nn={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},nr={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},Or={POLYGON:"polygon",LINE:"line_string",POINT:"point"},_t={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},or={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select"},dr={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},Ji={MOVE:"move",CHANGE_PROPERTIES:"change_properties",CHANGE_COORDINATES:"change_coordinates"},Rr={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},Vr={ACTIVE:"true",INACTIVE:"false"},Un=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],Qr=-85,zi=85;var bn=Object.freeze({__proto__:null,LAT_MAX:90,LAT_MIN:-90,LAT_RENDERED_MAX:zi,LAT_RENDERED_MIN:Qr,LNG_MAX:270,LNG_MIN:-270,activeStates:Vr,classes:Xe,cursors:nr,events:dr,geojsonTypes:_t,interactions:Un,meta:Rr,modes:or,sources:Nn,types:Or,updateActions:Ji});const vi={Point:0,LineString:1,MultiLineString:1,Polygon:2};function si(v,E){const j=vi[v.geometry.type]-vi[E.geometry.type];return j===0&&v.geometry.type===_t.POLYGON?v.area-E.area:j}function _i(v){return v.map(E=>(E.geometry.type===_t.POLYGON&&(E.area=Gr.geometry({type:_t.FEATURE,property:{},geometry:E.geometry})),E)).sort(si).map(E=>(delete E.area,E))}function Sr(v,E=0){return[[v.point.x-E,v.point.y-E],[v.point.x+E,v.point.y+E]]}function Br(v){if(this._items={},this._nums={},this._length=v?v.length:0,v)for(let E=0,j=v.length;E<j;E++)this.add(v[E]),v[E]!==void 0&&(typeof v[E]=="string"?this._items[v[E]]=E:this._nums[v[E]]=E)}Br.prototype.add=function(v){return this.has(v)||(this._length++,typeof v=="string"?this._items[v]=this._length:this._nums[v]=this._length),this},Br.prototype.delete=function(v){return this.has(v)===!1||(this._length--,delete this._items[v],delete this._nums[v]),this},Br.prototype.has=function(v){return!(typeof v!="string"&&typeof v!="number"||this._items[v]===void 0&&this._nums[v]===void 0)},Br.prototype.values=function(){const v=[];return Object.keys(this._items).forEach(E=>{v.push({k:E,v:this._items[E]})}),Object.keys(this._nums).forEach(E=>{v.push({k:JSON.parse(E),v:this._nums[E]})}),v.sort((E,j)=>E.v-j.v).map(E=>E.k)},Br.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};const Bo=[Rr.FEATURE,Rr.MIDPOINT,Rr.VERTEX];var yn={click:function(v,E,j){return vo(v,E,j,j.options.clickBuffer)},touch:function(v,E,j){return vo(v,E,j,j.options.touchBuffer)}};function vo(v,E,j,be){if(j.map===null)return[];const ue=v?Sr(v,be):E,V={};j.options.styles&&(V.layers=j.options.styles.map(Le=>Le.id).filter(Le=>j.map.getLayer(Le)!=null));const Ne=j.map.queryRenderedFeatures(ue,V).filter(Le=>Bo.indexOf(Le.properties.meta)!==-1),Ge=new Br,Ve=[];return Ne.forEach(Le=>{const st=Le.properties.id;Ge.has(st)||(Ge.add(st),Ve.push(Le))}),_i(Ve)}function Vn(v,E){const j=yn.click(v,null,E),be={mouse:nr.NONE};return j[0]&&(be.mouse=j[0].properties.active===Vr.ACTIVE?nr.MOVE:nr.POINTER,be.feature=j[0].properties.meta),E.events.currentModeName().indexOf("draw")!==-1&&(be.mouse=nr.ADD),E.ui.queueMapClasses(be),E.ui.updateMapClasses(),j[0]}function xi(v,E){const j=v.x-E.x,be=v.y-E.y;return Math.sqrt(j*j+be*be)}const Mn=4,$n=12,Di=500;function Wn(v,E,j={}){const be=j.fineTolerance!=null?j.fineTolerance:Mn,ue=j.grossTolerance!=null?j.grossTolerance:$n,V=j.interval!=null?j.interval:Di;v.point=v.point||E.point,v.time=v.time||E.time;const Ne=xi(v.point,E.point);return Ne<be||Ne<ue&&E.time-v.time<V}const no=25,bi=250;function Li(v,E,j={}){const be=j.tolerance!=null?j.tolerance:no,ue=j.interval!=null?j.interval:bi;return v.point=v.point||E.point,v.time=v.time||E.time,xi(v.point,E.point)<be&&E.time-v.time<ue}const gn=((v,E=21)=>(j=E)=>{let be="",ue=0|j;for(;ue--;)be+=v[Math.random()*v.length|0];return be})("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",32);function wi(){return gn()}const Ke=function(v,E){this.ctx=v,this.properties=E.properties||{},this.coordinates=E.geometry.coordinates,this.id=E.id||wi(),this.type=E.geometry.type};Ke.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},Ke.prototype.incomingCoords=function(v){this.setCoordinates(v)},Ke.prototype.setCoordinates=function(v){this.coordinates=v,this.changed()},Ke.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},Ke.prototype.setProperty=function(v,E){this.properties[v]=E},Ke.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:_t.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},Ke.prototype.internal=function(v){const E={id:this.id,meta:Rr.FEATURE,"meta:type":this.type,active:Vr.INACTIVE,mode:v};if(this.ctx.options.userProperties)for(const j in this.properties)E[`user_${j}`]=this.properties[j];return{type:_t.FEATURE,properties:E,geometry:{coordinates:this.getCoordinates(),type:this.type}}};const wn=function(v,E){Ke.call(this,v,E)};(wn.prototype=Object.create(Ke.prototype)).isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"},wn.prototype.updateCoordinate=function(v,E,j){this.coordinates=arguments.length===3?[E,j]:[v,E],this.changed()},wn.prototype.getCoordinate=function(){return this.getCoordinates()};const En=function(v,E){Ke.call(this,v,E)};(En.prototype=Object.create(Ke.prototype)).isValid=function(){return this.coordinates.length>1},En.prototype.addCoordinate=function(v,E,j){this.changed();const be=parseInt(v,10);this.coordinates.splice(be,0,[E,j])},En.prototype.getCoordinate=function(v){const E=parseInt(v,10);return JSON.parse(JSON.stringify(this.coordinates[E]))},En.prototype.removeCoordinate=function(v){this.changed(),this.coordinates.splice(parseInt(v,10),1)},En.prototype.updateCoordinate=function(v,E,j){const be=parseInt(v,10);this.coordinates[be]=[E,j],this.changed()};const qt=function(v,E){Ke.call(this,v,E),this.coordinates=this.coordinates.map(j=>j.slice(0,-1))};(qt.prototype=Object.create(Ke.prototype)).isValid=function(){return this.coordinates.length!==0&&this.coordinates.every(v=>v.length>2)},qt.prototype.incomingCoords=function(v){this.coordinates=v.map(E=>E.slice(0,-1)),this.changed()},qt.prototype.setCoordinates=function(v){this.coordinates=v,this.changed()},qt.prototype.addCoordinate=function(v,E,j){this.changed();const be=v.split(".").map(ue=>parseInt(ue,10));this.coordinates[be[0]].splice(be[1],0,[E,j])},qt.prototype.removeCoordinate=function(v){this.changed();const E=v.split(".").map(be=>parseInt(be,10)),j=this.coordinates[E[0]];j&&(j.splice(E[1],1),j.length<3&&this.coordinates.splice(E[0],1))},qt.prototype.getCoordinate=function(v){const E=v.split(".").map(be=>parseInt(be,10)),j=this.coordinates[E[0]];return JSON.parse(JSON.stringify(j[E[1]]))},qt.prototype.getCoordinates=function(){return this.coordinates.map(v=>v.concat([v[0]]))},qt.prototype.updateCoordinate=function(v,E,j){this.changed();const be=v.split("."),ue=parseInt(be[0],10),V=parseInt(be[1],10);this.coordinates[ue]===void 0&&(this.coordinates[ue]=[]),this.coordinates[ue][V]=[E,j]};const Wt={MultiPoint:wn,MultiLineString:En,MultiPolygon:qt},Ei=(v,E,j,be,ue)=>{const V=j.split("."),Ne=parseInt(V[0],10),Ge=V[1]?V.slice(1).join("."):null;return v[Ne][E](Ge,be,ue)},gr=function(v,E){if(Ke.call(this,v,E),delete this.coordinates,this.model=Wt[E.geometry.type],this.model===void 0)throw new TypeError(`${E.geometry.type} is not a valid type`);this.features=this._coordinatesToFeatures(E.geometry.coordinates)};function jt(v){this.map=v.map,this.drawConfig=JSON.parse(JSON.stringify(v.options||{})),this._ctx=v}(gr.prototype=Object.create(Ke.prototype))._coordinatesToFeatures=function(v){const E=this.model.bind(this);return v.map(j=>new E(this.ctx,{id:wi(),type:_t.FEATURE,properties:{},geometry:{coordinates:j,type:this.type.replace("Multi","")}}))},gr.prototype.isValid=function(){return this.features.every(v=>v.isValid())},gr.prototype.setCoordinates=function(v){this.features=this._coordinatesToFeatures(v),this.changed()},gr.prototype.getCoordinate=function(v){return Ei(this.features,"getCoordinate",v)},gr.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(v=>v.type===_t.POLYGON?v.getCoordinates():v.coordinates)))},gr.prototype.updateCoordinate=function(v,E,j){Ei(this.features,"updateCoordinate",v,E,j),this.changed()},gr.prototype.addCoordinate=function(v,E,j){Ei(this.features,"addCoordinate",v,E,j),this.changed()},gr.prototype.removeCoordinate=function(v){Ei(this.features,"removeCoordinate",v),this.changed()},gr.prototype.getFeatures=function(){return this.features},jt.prototype.setSelected=function(v){return this._ctx.store.setSelected(v)},jt.prototype.setSelectedCoordinates=function(v){this._ctx.store.setSelectedCoordinates(v),v.reduce((E,j)=>(E[j.feature_id]===void 0&&(E[j.feature_id]=!0,this._ctx.store.get(j.feature_id).changed()),E),{})},jt.prototype.getSelected=function(){return this._ctx.store.getSelected()},jt.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},jt.prototype.isSelected=function(v){return this._ctx.store.isSelected(v)},jt.prototype.getFeature=function(v){return this._ctx.store.get(v)},jt.prototype.select=function(v){return this._ctx.store.select(v)},jt.prototype.deselect=function(v){return this._ctx.store.deselect(v)},jt.prototype.deleteFeature=function(v,E={}){return this._ctx.store.delete(v,E)},jt.prototype.addFeature=function(v,E={}){return this._ctx.store.add(v,E)},jt.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},jt.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},jt.prototype.setActionableState=function(v={}){const E={trash:v.trash||!1,combineFeatures:v.combineFeatures||!1,uncombineFeatures:v.uncombineFeatures||!1};return this._ctx.events.actionable(E)},jt.prototype.changeMode=function(v,E={},j={}){return this._ctx.events.changeMode(v,E,j)},jt.prototype.fire=function(v,E){return this._ctx.events.fire(v,E)},jt.prototype.updateUIClasses=function(v){return this._ctx.ui.queueMapClasses(v)},jt.prototype.activateUIButton=function(v){return this._ctx.ui.setActiveButton(v)},jt.prototype.featuresAt=function(v,E,j="click"){if(j!=="click"&&j!=="touch")throw new Error("invalid buffer type");return yn[j](v,E,this._ctx)},jt.prototype.newFeature=function(v){const E=v.geometry.type;return E===_t.POINT?new wn(this._ctx,v):E===_t.LINE_STRING?new En(this._ctx,v):E===_t.POLYGON?new qt(this._ctx,v):new gr(this._ctx,v)},jt.prototype.isInstanceOf=function(v,E){if(v===_t.POINT)return E instanceof wn;if(v===_t.LINE_STRING)return E instanceof En;if(v===_t.POLYGON)return E instanceof qt;if(v==="MultiFeature")return E instanceof gr;throw new Error(`Unknown feature class: ${v}`)},jt.prototype.doRender=function(v){return this._ctx.store.featureChanged(v)},jt.prototype.onSetup=function(){},jt.prototype.onDrag=function(){},jt.prototype.onClick=function(){},jt.prototype.onMouseMove=function(){},jt.prototype.onMouseDown=function(){},jt.prototype.onMouseUp=function(){},jt.prototype.onMouseOut=function(){},jt.prototype.onKeyUp=function(){},jt.prototype.onKeyDown=function(){},jt.prototype.onTouchStart=function(){},jt.prototype.onTouchMove=function(){},jt.prototype.onTouchEnd=function(){},jt.prototype.onTap=function(){},jt.prototype.onStop=function(){},jt.prototype.onTrash=function(){},jt.prototype.onCombineFeature=function(){},jt.prototype.onUncombineFeature=function(){},jt.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};const oa={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},Si=Object.keys(oa);function Jo(v){const E=Object.keys(v);return function(j,be={}){let ue={};const V=E.reduce((Ne,Ge)=>(Ne[Ge]=v[Ge],Ne),new jt(j));return{start(){ue=V.onSetup(be),Si.forEach(Ne=>{const Ge=oa[Ne];let Ve=()=>!1;var Le;v[Ge]&&(Ve=()=>!0),this.on(Ne,Ve,(Le=Ge,st=>V[Le](ue,st)))})},stop(){V.onStop(ue)},trash(){V.onTrash(ue)},combineFeatures(){V.onCombineFeatures(ue)},uncombineFeatures(){V.onUncombineFeatures(ue)},render(Ne,Ge){V.toDisplayFeatures(ue,Ne,Ge)}}}}function vn(v){return[].concat(v).filter(E=>E!==void 0)}function zn(){const v=this;if(!v.ctx.map||v.ctx.map.getSource(Nn.HOT)===void 0)return Ge();const E=v.ctx.events.currentModeName();v.ctx.ui.queueMapClasses({mode:E});let j=[],be=[];v.isDirty?be=v.getAllIds():(j=v.getChangedIds().filter(Ve=>v.get(Ve)!==void 0),be=v.sources.hot.filter(Ve=>Ve.properties.id&&j.indexOf(Ve.properties.id)===-1&&v.get(Ve.properties.id)!==void 0).map(Ve=>Ve.properties.id)),v.sources.hot=[];const ue=v.sources.cold.length;v.sources.cold=v.isDirty?[]:v.sources.cold.filter(Ve=>{const Le=Ve.properties.id||Ve.properties.parent;return j.indexOf(Le)===-1});const V=ue!==v.sources.cold.length||be.length>0;function Ne(Ve,Le){const st=v.get(Ve).internal(E);v.ctx.events.currentModeRender(st,At=>{At.properties.mode=E,v.sources[Le].push(At)})}function Ge(){v.isDirty=!1,v.clearChangedIds()}j.forEach(Ve=>Ne(Ve,"hot")),be.forEach(Ve=>Ne(Ve,"cold")),V&&v.ctx.map.getSource(Nn.COLD).setData({type:_t.FEATURE_COLLECTION,features:v.sources.cold}),v.ctx.map.getSource(Nn.HOT).setData({type:_t.FEATURE_COLLECTION,features:v.sources.hot}),Ge()}function br(v){let E;this._features={},this._featureIds=new Br,this._selectedFeatureIds=new Br,this._selectedCoordinates=[],this._changedFeatureIds=new Br,this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=v,this.sources={hot:[],cold:[]},this.render=()=>{E||(E=requestAnimationFrame(()=>{E=null,zn.call(this),this._emitSelectionChange&&(this.ctx.events.fire(dr.SELECTION_CHANGE,{features:this.getSelected().map(j=>j.toGeoJSON()),points:this.getSelectedCoordinates().map(j=>({type:_t.FEATURE,properties:{},geometry:{type:_t.POINT,coordinates:j.coordinates}}))}),this._emitSelectionChange=!1),this.ctx.events.fire(dr.RENDER,{})}))},this.isDirty=!1}function Sn(v,E={}){const j=v._selectedCoordinates.filter(be=>v._selectedFeatureIds.has(be.feature_id));v._selectedCoordinates.length===j.length||E.silent||(v._emitSelectionChange=!0),v._selectedCoordinates=j}br.prototype.createRenderBatch=function(){const v=this.render;let E=0;return this.render=function(){E++},()=>{this.render=v,E>0&&this.render()}},br.prototype.setDirty=function(){return this.isDirty=!0,this},br.prototype.featureCreated=function(v,E={}){if(this._changedFeatureIds.add(v),(E.silent!=null?E.silent:this.ctx.options.suppressAPIEvents)!==!0){const j=this.get(v);this.ctx.events.fire(dr.CREATE,{features:[j.toGeoJSON()]})}return this},br.prototype.featureChanged=function(v,E={}){return this._changedFeatureIds.add(v),(E.silent!=null?E.silent:this.ctx.options.suppressAPIEvents)!==!0&&this.ctx.events.fire(dr.UPDATE,{action:E.action?E.action:Ji.CHANGE_COORDINATES,features:[this.get(v).toGeoJSON()]}),this},br.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},br.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},br.prototype.getAllIds=function(){return this._featureIds.values()},br.prototype.add=function(v,E={}){return this._features[v.id]=v,this._featureIds.add(v.id),this.featureCreated(v.id,{silent:E.silent}),this},br.prototype.delete=function(v,E={}){const j=[];return vn(v).forEach(be=>{this._featureIds.has(be)&&(this._featureIds.delete(be),this._selectedFeatureIds.delete(be),E.silent||j.indexOf(this._features[be])===-1&&j.push(this._features[be].toGeoJSON()),delete this._features[be],this.isDirty=!0)}),j.length&&this.ctx.events.fire(dr.DELETE,{features:j}),Sn(this,E),this},br.prototype.get=function(v){return this._features[v]},br.prototype.getAll=function(){return Object.keys(this._features).map(v=>this._features[v])},br.prototype.select=function(v,E={}){return vn(v).forEach(j=>{this._selectedFeatureIds.has(j)||(this._selectedFeatureIds.add(j),this._changedFeatureIds.add(j),E.silent||(this._emitSelectionChange=!0))}),this},br.prototype.deselect=function(v,E={}){return vn(v).forEach(j=>{this._selectedFeatureIds.has(j)&&(this._selectedFeatureIds.delete(j),this._changedFeatureIds.add(j),E.silent||(this._emitSelectionChange=!0))}),Sn(this,E),this},br.prototype.clearSelected=function(v={}){return this.deselect(this._selectedFeatureIds.values(),{silent:v.silent}),this},br.prototype.setSelected=function(v,E={}){return v=vn(v),this.deselect(this._selectedFeatureIds.values().filter(j=>v.indexOf(j)===-1),{silent:E.silent}),this.select(v.filter(j=>!this._selectedFeatureIds.has(j)),{silent:E.silent}),this},br.prototype.setSelectedCoordinates=function(v){return this._selectedCoordinates=v,this._emitSelectionChange=!0,this},br.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},br.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},br.prototype.getSelected=function(){return this.getSelectedIds().map(v=>this.get(v))},br.prototype.getSelectedCoordinates=function(){return this._selectedCoordinates.map(v=>({coordinates:this.get(v.feature_id).getCoordinate(v.coord_path)}))},br.prototype.isSelected=function(v){return this._selectedFeatureIds.has(v)},br.prototype.setFeatureProperty=function(v,E,j,be={}){this.get(v).setProperty(E,j),this.featureChanged(v,{silent:be.silent,action:Ji.CHANGE_PROPERTIES})},br.prototype.storeMapConfig=function(){Un.forEach(v=>{this.ctx.map[v]&&(this._mapInitialConfig[v]=this.ctx.map[v].isEnabled())})},br.prototype.restoreMapConfig=function(){Object.keys(this._mapInitialConfig).forEach(v=>{this._mapInitialConfig[v]?this.ctx.map[v].enable():this.ctx.map[v].disable()})},br.prototype.getInitialConfigValue=function(v){return this._mapInitialConfig[v]===void 0||this._mapInitialConfig[v]};const Qn=["mode","feature","mouse"];function Ti(v){let E=null,j=null;const be={onRemove(){return v.map.off("load",be.connect),clearInterval(j),be.removeLayers(),v.store.restoreMapConfig(),v.ui.removeButtons(),v.events.removeEventListeners(),v.ui.clearMapClasses(),v.boxZoomInitial&&v.map.boxZoom.enable(),v.map=null,v.container=null,v.store=null,E&&E.parentNode&&E.parentNode.removeChild(E),E=null,this},connect(){v.map.off("load",be.connect),clearInterval(j),be.addLayers(),v.store.storeMapConfig(),v.events.addEventListeners()},onAdd(ue){if(v.map=ue,v.events=function(V){const Ne=Object.keys(V.options.modes).reduce((Fe,yt)=>(Fe[yt]=Jo(V.options.modes[yt]),Fe),{});let Ge={},Ve={};const Le={};let st=null,At=null;Le.drag=function(Fe,yt){yt({point:Fe.point,time:new Date().getTime()})?(V.ui.queueMapClasses({mouse:nr.DRAG}),At.drag(Fe)):Fe.originalEvent.stopPropagation()},Le.mousedrag=function(Fe){Le.drag(Fe,yt=>!Wn(Ge,yt))},Le.touchdrag=function(Fe){Le.drag(Fe,yt=>!Li(Ve,yt))},Le.mousemove=function(Fe){if((Fe.originalEvent.buttons!==void 0?Fe.originalEvent.buttons:Fe.originalEvent.which)===1)return Le.mousedrag(Fe);const yt=Vn(Fe,V);Fe.featureTarget=yt,At.mousemove(Fe)},Le.mousedown=function(Fe){Ge={time:new Date().getTime(),point:Fe.point};const yt=Vn(Fe,V);Fe.featureTarget=yt,At.mousedown(Fe)},Le.mouseup=function(Fe){const yt=Vn(Fe,V);Fe.featureTarget=yt,Wn(Ge,{point:Fe.point,time:new Date().getTime()})?At.click(Fe):At.mouseup(Fe)},Le.mouseout=function(Fe){At.mouseout(Fe)},Le.touchstart=function(Fe){if(!V.options.touchEnabled)return;Ve={time:new Date().getTime(),point:Fe.point};const yt=yn.touch(Fe,null,V)[0];Fe.featureTarget=yt,At.touchstart(Fe)},Le.touchmove=function(Fe){if(V.options.touchEnabled)return At.touchmove(Fe),Le.touchdrag(Fe)},Le.touchend=function(Fe){if(Fe.originalEvent.preventDefault(),!V.options.touchEnabled)return;const yt=yn.touch(Fe,null,V)[0];Fe.featureTarget=yt,Li(Ve,{time:new Date().getTime(),point:Fe.point})?At.tap(Fe):At.touchend(Fe)};const er=Fe=>!(Fe===8||Fe===46||Fe>=48&&Fe<=57);function Tn(Fe,yt,Kt={}){At.stop();const Dt=Ne[Fe];if(Dt===void 0)throw new Error(`${Fe} is not valid`);st=Fe;const jr=Dt(V,yt);At=mt(jr,V),Kt.silent||V.map.fire(dr.MODE_CHANGE,{mode:Fe}),V.store.setDirty(),V.store.render()}Le.keydown=function(Fe){(Fe.srcElement||Fe.target).classList.contains(Xe.CANVAS)&&(Fe.keyCode!==8&&Fe.keyCode!==46||!V.options.controls.trash?er(Fe.keyCode)?At.keydown(Fe):Fe.keyCode===49&&V.options.controls.point?Tn(or.DRAW_POINT):Fe.keyCode===50&&V.options.controls.line_string?Tn(or.DRAW_LINE_STRING):Fe.keyCode===51&&V.options.controls.polygon&&Tn(or.DRAW_POLYGON):(Fe.preventDefault(),At.trash()))},Le.keyup=function(Fe){er(Fe.keyCode)&&At.keyup(Fe)},Le.zoomend=function(){V.store.changeZoom()},Le.data=function(Fe){if(Fe.dataType==="style"){const{setup:yt,map:Kt,options:Dt,store:jr}=V;Dt.styles.some(Ui=>Kt.getLayer(Ui.id))||(yt.addLayers(),jr.setDirty(),jr.render())}};const Dr={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start(){st=V.options.defaultMode,At=mt(Ne[st](V),V)},changeMode:Tn,actionable:function(Fe){let yt=!1;Object.keys(Fe).forEach(Kt=>{if(Dr[Kt]===void 0)throw new Error("Invalid action type");Dr[Kt]!==Fe[Kt]&&(yt=!0),Dr[Kt]=Fe[Kt]}),yt&&V.map.fire(dr.ACTIONABLE,{actions:Dr})},currentModeName:()=>st,currentModeRender:(Fe,yt)=>At.render(Fe,yt),fire(Fe,yt){V.map&&V.map.fire(Fe,yt)},addEventListeners(){V.map.on("mousemove",Le.mousemove),V.map.on("mousedown",Le.mousedown),V.map.on("mouseup",Le.mouseup),V.map.on("data",Le.data),V.map.on("touchmove",Le.touchmove),V.map.on("touchstart",Le.touchstart),V.map.on("touchend",Le.touchend),V.container.addEventListener("mouseout",Le.mouseout),V.options.keybindings&&(V.container.addEventListener("keydown",Le.keydown),V.container.addEventListener("keyup",Le.keyup))},removeEventListeners(){V.map.off("mousemove",Le.mousemove),V.map.off("mousedown",Le.mousedown),V.map.off("mouseup",Le.mouseup),V.map.off("data",Le.data),V.map.off("touchmove",Le.touchmove),V.map.off("touchstart",Le.touchstart),V.map.off("touchend",Le.touchend),V.container.removeEventListener("mouseout",Le.mouseout),V.options.keybindings&&(V.container.removeEventListener("keydown",Le.keydown),V.container.removeEventListener("keyup",Le.keyup))},trash(Fe){At.trash(Fe)},combineFeatures(){At.combineFeatures()},uncombineFeatures(){At.uncombineFeatures()},getMode:()=>st}}(v),v.ui=function(V){const Ne={};let Ge=null,Ve={mode:null,feature:null,mouse:null},Le={mode:null,feature:null,mouse:null};function st(Fe){Le=Object.assign(Le,Fe)}function At(){if(!V.container)return;const Fe=[],yt=[];Qn.forEach(Kt=>{Le[Kt]!==Ve[Kt]&&(Fe.push(`${Kt}-${Ve[Kt]}`),Le[Kt]!==null&&yt.push(`${Kt}-${Le[Kt]}`))}),Fe.length>0&&V.container.classList.remove(...Fe),yt.length>0&&V.container.classList.add(...yt),Ve=Object.assign(Ve,Le)}function er(Fe,yt={}){const Kt=document.createElement("button");return Kt.className=`${Xe.CONTROL_BUTTON} ${yt.className}`,Kt.setAttribute("title",yt.title),yt.container.appendChild(Kt),Kt.addEventListener("click",Dt=>{if(Dt.preventDefault(),Dt.stopPropagation(),Dt.target===Ge)return Tn(),void yt.onDeactivate();Dr(Fe),yt.onActivate()},!0),Kt}function Tn(){Ge&&(Ge.classList.remove(Xe.ACTIVE_BUTTON),Ge=null)}function Dr(Fe){Tn();const yt=Ne[Fe];yt&&yt&&Fe!=="trash"&&(yt.classList.add(Xe.ACTIVE_BUTTON),Ge=yt)}return{setActiveButton:Dr,queueMapClasses:st,updateMapClasses:At,clearMapClasses:function(){st({mode:null,feature:null,mouse:null}),At()},addButtons:function(){const Fe=V.options.controls,yt=document.createElement("div");return yt.className=`${Xe.CONTROL_GROUP} ${Xe.CONTROL_BASE}`,Fe&&(Fe[Or.LINE]&&(Ne[Or.LINE]=er(Or.LINE,{container:yt,className:Xe.CONTROL_BUTTON_LINE,title:"LineString tool "+(V.options.keybindings?"(l)":""),onActivate:()=>V.events.changeMode(or.DRAW_LINE_STRING),onDeactivate:()=>V.events.trash()})),Fe[Or.POLYGON]&&(Ne[Or.POLYGON]=er(Or.POLYGON,{container:yt,className:Xe.CONTROL_BUTTON_POLYGON,title:"Polygon tool "+(V.options.keybindings?"(p)":""),onActivate:()=>V.events.changeMode(or.DRAW_POLYGON),onDeactivate:()=>V.events.trash()})),Fe[Or.POINT]&&(Ne[Or.POINT]=er(Or.POINT,{container:yt,className:Xe.CONTROL_BUTTON_POINT,title:"Marker tool "+(V.options.keybindings?"(m)":""),onActivate:()=>V.events.changeMode(or.DRAW_POINT),onDeactivate:()=>V.events.trash()})),Fe.trash&&(Ne.trash=er("trash",{container:yt,className:Xe.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:()=>{V.events.trash()}})),Fe.combine_features&&(Ne.combine_features=er("combineFeatures",{container:yt,className:Xe.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:()=>{V.events.combineFeatures()}})),Fe.uncombine_features&&(Ne.uncombine_features=er("uncombineFeatures",{container:yt,className:Xe.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:()=>{V.events.uncombineFeatures()}}))),yt},removeButtons:function(){Object.keys(Ne).forEach(Fe=>{const yt=Ne[Fe];yt.parentNode&&yt.parentNode.removeChild(yt),delete Ne[Fe]})}}}(v),v.container=ue.getContainer(),v.store=new br(v),E=v.ui.addButtons(),v.options.boxSelect){v.boxZoomInitial=ue.boxZoom.isEnabled(),ue.boxZoom.disable();const V=ue.dragPan.isEnabled();ue.dragPan.disable(),ue.dragPan.enable(),V||ue.dragPan.disable()}return ue.loaded()?be.connect():(ue.on("load",be.connect),j=setInterval(()=>{ue.loaded()&&be.connect()},16)),v.events.start(),E},addLayers(){v.map.addSource(Nn.COLD,{data:{type:_t.FEATURE_COLLECTION,features:[]},type:"geojson"}),v.map.addSource(Nn.HOT,{data:{type:_t.FEATURE_COLLECTION,features:[]},type:"geojson"}),v.options.styles.forEach(ue=>{v.map.addLayer(ue)}),v.store.setDirty(!0),v.store.render()},removeLayers(){v.options.styles.forEach(ue=>{v.map.getLayer(ue.id)&&v.map.removeLayer(ue.id)}),v.map.getSource(Nn.COLD)&&v.map.removeSource(Nn.COLD),v.map.getSource(Nn.HOT)&&v.map.removeSource(Nn.HOT)}};return v.setup=be,be}const un="#3bb2d0",Hn="#fbb03b",_o="#fff";var Oi=[{id:"gl-draw-polygon-fill",type:"fill",filter:["all",["==","$type","Polygon"]],paint:{"fill-color":["case",["==",["get","active"],"true"],Hn,un],"fill-opacity":.1}},{id:"gl-draw-lines",type:"line",filter:["any",["==","$type","LineString"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["case",["==",["get","active"],"true"],Hn,un],"line-dasharray":["case",["==",["get","active"],"true"],[.2,2],[2,0]],"line-width":2}},{id:"gl-draw-point-outer",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],7,5],"circle-color":_o}},{id:"gl-draw-point-inner",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],5,3],"circle-color":["case",["==",["get","active"],"true"],Hn,un]}},{id:"gl-draw-vertex-outer",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"],["!=","mode","simple_select"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],7,5],"circle-color":_o}},{id:"gl-draw-vertex-inner",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"],["!=","mode","simple_select"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],5,3],"circle-color":Hn}},{id:"gl-draw-midpoint",type:"circle",filter:["all",["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":Hn}}];function Ri(v){return function(E){const j=E.featureTarget;return!!j&&!!j.properties&&j.properties.meta===v}}function Bi(v){return!!v.originalEvent&&!!v.originalEvent.shiftKey&&v.originalEvent.button===0}function Dn(v){return!!v.featureTarget&&!!v.featureTarget.properties&&v.featureTarget.properties.active===Vr.ACTIVE&&v.featureTarget.properties.meta===Rr.FEATURE}function Ii(v){return!!v.featureTarget&&!!v.featureTarget.properties&&v.featureTarget.properties.active===Vr.INACTIVE&&v.featureTarget.properties.meta===Rr.FEATURE}function Fi(v){return v.featureTarget===void 0}function Ln(v){return!!v.featureTarget&&!!v.featureTarget.properties&&v.featureTarget.properties.meta===Rr.FEATURE}function bt(v){const E=v.featureTarget;return!!E&&!!E.properties&&E.properties.meta===Rr.VERTEX}function ui(v){return!!v.originalEvent&&v.originalEvent.shiftKey===!0}function ei(v){return v.keyCode===27}function Ni(v){return v.keyCode===13}var pt=Object.freeze({__proto__:null,isActiveFeature:Dn,isEnterKey:Ni,isEscapeKey:ei,isFeature:Ln,isInactiveFeature:Ii,isOfMetaType:Ri,isShiftDown:ui,isShiftMousedown:Bi,isTrue:function(){return!0},isVertex:bt,noTarget:Fi});function _n(v,E){this.x=v,this.y=E}function li(v,E){const j=E.getBoundingClientRect();return new _n(v.clientX-j.left-(E.clientLeft||0),v.clientY-j.top-(E.clientTop||0))}function ti(v,E,j,be){return{type:_t.FEATURE,properties:{meta:Rr.VERTEX,parent:v,coord_path:j,active:be?Vr.ACTIVE:Vr.INACTIVE},geometry:{type:_t.POINT,coordinates:E}}}function xo(v,E,j){const be=E.geometry.coordinates,ue=j.geometry.coordinates;if(be[1]>zi||be[1]<Qr||ue[1]>zi||ue[1]<Qr)return null;const V={lng:(be[0]+ue[0])/2,lat:(be[1]+ue[1])/2};return{type:_t.FEATURE,properties:{meta:Rr.MIDPOINT,parent:v,lng:V.lng,lat:V.lat,coord_path:j.properties.coord_path},geometry:{type:_t.POINT,coordinates:[V.lng,V.lat]}}}function Ar(v,E={},j=null){const{type:be,coordinates:ue}=v.geometry,V=v.properties&&v.properties.id;let Ne=[];function Ge(Le,st){let At="",er=null;Le.forEach((Tn,Dr)=>{const Fe=st!=null?`${st}.${Dr}`:String(Dr),yt=ti(V,Tn,Fe,Ve(Fe));if(E.midpoints&&er){const Dt=xo(V,er,yt);Dt&&Ne.push(Dt)}er=yt;const Kt=JSON.stringify(Tn);At!==Kt&&Ne.push(yt),Dr===0&&(At=Kt)})}function Ve(Le){return!!E.selectedPaths&&E.selectedPaths.indexOf(Le)!==-1}return be===_t.POINT?Ne.push(ti(V,ue,j,Ve(j))):be===_t.POLYGON?ue.forEach((Le,st)=>{Ge(Le,j!==null?`${j}.${st}`:String(st))}):be===_t.LINE_STRING?Ge(ue,j):be.indexOf(_t.MULTI_PREFIX)===0&&function(){const Le=be.replace(_t.MULTI_PREFIX,"");ue.forEach((st,At)=>{const er={type:_t.FEATURE,properties:v.properties,geometry:{type:Le,coordinates:st}};Ne=Ne.concat(Ar(er,E,At))})}(),Ne}_n.prototype={clone(){return new _n(this.x,this.y)},add(v){return this.clone()._add(v)},sub(v){return this.clone()._sub(v)},multByPoint(v){return this.clone()._multByPoint(v)},divByPoint(v){return this.clone()._divByPoint(v)},mult(v){return this.clone()._mult(v)},div(v){return this.clone()._div(v)},rotate(v){return this.clone()._rotate(v)},rotateAround(v,E){return this.clone()._rotateAround(v,E)},matMult(v){return this.clone()._matMult(v)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(v){return this.x===v.x&&this.y===v.y},dist(v){return Math.sqrt(this.distSqr(v))},distSqr(v){const E=v.x-this.x,j=v.y-this.y;return E*E+j*j},angle(){return Math.atan2(this.y,this.x)},angleTo(v){return Math.atan2(this.y-v.y,this.x-v.x)},angleWith(v){return this.angleWithSep(v.x,v.y)},angleWithSep(v,E){return Math.atan2(this.x*E-this.y*v,this.x*v+this.y*E)},_matMult(v){const E=v[0]*this.x+v[1]*this.y,j=v[2]*this.x+v[3]*this.y;return this.x=E,this.y=j,this},_add(v){return this.x+=v.x,this.y+=v.y,this},_sub(v){return this.x-=v.x,this.y-=v.y,this},_mult(v){return this.x*=v,this.y*=v,this},_div(v){return this.x/=v,this.y/=v,this},_multByPoint(v){return this.x*=v.x,this.y*=v.y,this},_divByPoint(v){return this.x/=v.x,this.y/=v.y,this},_unit(){return this._div(this.mag()),this},_perp(){const v=this.y;return this.y=this.x,this.x=-v,this},_rotate(v){const E=Math.cos(v),j=Math.sin(v),be=E*this.x-j*this.y,ue=j*this.x+E*this.y;return this.x=be,this.y=ue,this},_rotateAround(v,E){const j=Math.cos(v),be=Math.sin(v),ue=E.x+j*(this.x-E.x)-be*(this.y-E.y),V=E.y+be*(this.x-E.x)+j*(this.y-E.y);return this.x=ue,this.y=V,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:_n},_n.convert=function(v){if(v instanceof _n)return v;if(Array.isArray(v))return new _n(+v[0],+v[1]);if(v.x!==void 0&&v.y!==void 0)return new _n(+v.x,+v.y);throw new Error("Expected [x, y] or {x, y} point format")};var C={enable(v){setTimeout(()=>{v.map&&v.map.doubleClickZoom&&v._ctx&&v._ctx.store&&v._ctx.store.getInitialConfigValue&&v._ctx.store.getInitialConfigValue("doubleClickZoom")&&v.map.doubleClickZoom.enable()},0)},disable(v){setTimeout(()=>{v.map&&v.map.doubleClickZoom&&v.map.doubleClickZoom.disable()},0)}};const{LAT_MIN:M,LAT_MAX:D,LAT_RENDERED_MIN:U,LAT_RENDERED_MAX:G,LNG_MIN:ne,LNG_MAX:$}=bn;function L(v,E){let j=M,be=D,ue=M,V=D,Ne=$,Ge=ne;v.forEach(Le=>{const st=function(Fe){const yt={Point:0,LineString:1,Polygon:2,MultiPoint:1,MultiLineString:2,MultiPolygon:3}[Fe.geometry.type],Kt=[Fe.geometry.coordinates].flat(yt),Dt=Kt.map(ln=>ln[0]),jr=Kt.map(ln=>ln[1]),Ui=ln=>Math.min.apply(null,ln),Ka=ln=>Math.max.apply(null,ln);return[Ui(Dt),Ui(jr),Ka(Dt),Ka(jr)]}(Le),At=st[1],er=st[3],Tn=st[0],Dr=st[2];At>j&&(j=At),er<be&&(be=er),er>ue&&(ue=er),At<V&&(V=At),Tn<Ne&&(Ne=Tn),Dr>Ge&&(Ge=Dr)});const Ve=E;return j+Ve.lat>G&&(Ve.lat=G-j),ue+Ve.lat>D&&(Ve.lat=D-ue),be+Ve.lat<U&&(Ve.lat=U-be),V+Ve.lat<M&&(Ve.lat=M-V),Ne+Ve.lng<=ne&&(Ve.lng+=360*Math.ceil(Math.abs(Ve.lng)/360)),Ge+Ve.lng>=$&&(Ve.lng-=360*Math.ceil(Math.abs(Ve.lng)/360)),Ve}function J(v,E){const j=L(v.map(be=>be.toGeoJSON()),E);v.forEach(be=>{const ue=be.getCoordinates(),V=Le=>{const st={lng:Le[0]+j.lng,lat:Le[1]+j.lat};return[st.lng,st.lat]},Ne=Le=>Le.map(st=>V(st)),Ge=Le=>Le.map(st=>Ne(st));let Ve;be.type===_t.POINT?Ve=V(ue):be.type===_t.LINE_STRING||be.type===_t.MULTI_POINT?Ve=ue.map(V):be.type===_t.POLYGON||be.type===_t.MULTI_LINE_STRING?Ve=ue.map(Ne):be.type===_t.MULTI_POLYGON&&(Ve=ue.map(Ge)),be.incomingCoords(Ve)})}const se={onSetup:function(v){const E={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initialDragPanState:this.map.dragPan.isEnabled(),initiallySelectedFeatureIds:v.featureIds||[]};return this.setSelected(E.initiallySelectedFeatureIds.filter(j=>this.getFeature(j)!==void 0)),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),E},fireUpdate:function(){this.fire(dr.UPDATE,{action:Ji.MOVE,features:this.getSelected().map(v=>v.toGeoJSON())})},fireActionable:function(){const v=this.getSelected(),E=v.filter(V=>this.isInstanceOf("MultiFeature",V));let j=!1;if(v.length>1){j=!0;const V=v[0].type.replace("Multi","");v.forEach(Ne=>{Ne.type.replace("Multi","")!==V&&(j=!1)})}const be=E.length>0,ue=v.length>0;this.setActionableState({combineFeatures:j,uncombineFeatures:be,trash:ue})},getUniqueIds:function(v){return v.length?v.map(E=>E.properties.id).filter(E=>E!==void 0).reduce((E,j)=>(E.add(j),E),new Br).values():[]},stopExtendedInteractions:function(v){v.boxSelectElement&&(v.boxSelectElement.parentNode&&v.boxSelectElement.parentNode.removeChild(v.boxSelectElement),v.boxSelectElement=null),(v.canDragMove||v.canBoxSelect)&&v.initialDragPanState===!0&&this.map.dragPan.enable(),v.boxSelecting=!1,v.canBoxSelect=!1,v.dragMoving=!1,v.canDragMove=!1},onStop:function(){C.enable(this)},onMouseMove:function(v,E){return Ln(E)&&v.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(v),!0},onMouseOut:function(v){return!v.dragMoving||this.fireUpdate()}};se.onTap=se.onClick=function(v,E){return Fi(E)?this.clickAnywhere(v,E):Ri(Rr.VERTEX)(E)?this.clickOnVertex(v,E):Ln(E)?this.clickOnFeature(v,E):void 0},se.clickAnywhere=function(v){const E=this.getSelectedIds();E.length&&(this.clearSelectedFeatures(),E.forEach(j=>this.doRender(j))),C.enable(this),this.stopExtendedInteractions(v)},se.clickOnVertex=function(v,E){this.changeMode(or.DIRECT_SELECT,{featureId:E.featureTarget.properties.parent,coordPath:E.featureTarget.properties.coord_path,startPos:E.lngLat}),this.updateUIClasses({mouse:nr.MOVE})},se.startOnActiveFeature=function(v,E){this.stopExtendedInteractions(v),this.map.dragPan.disable(),this.doRender(E.featureTarget.properties.id),v.canDragMove=!0,v.dragMoveLocation=E.lngLat},se.clickOnFeature=function(v,E){C.disable(this),this.stopExtendedInteractions(v);const j=ui(E),be=this.getSelectedIds(),ue=E.featureTarget.properties.id,V=this.isSelected(ue);if(!j&&V&&this.getFeature(ue).type!==_t.POINT)return this.changeMode(or.DIRECT_SELECT,{featureId:ue});V&&j?(this.deselect(ue),this.updateUIClasses({mouse:nr.POINTER}),be.length===1&&C.enable(this)):!V&&j?(this.select(ue),this.updateUIClasses({mouse:nr.MOVE})):V||j||(be.forEach(Ne=>this.doRender(Ne)),this.setSelected(ue),this.updateUIClasses({mouse:nr.MOVE})),this.doRender(ue)},se.onMouseDown=function(v,E){return v.initialDragPanState=this.map.dragPan.isEnabled(),Dn(E)?this.startOnActiveFeature(v,E):this.drawConfig.boxSelect&&Bi(E)?this.startBoxSelect(v,E):void 0},se.startBoxSelect=function(v,E){this.stopExtendedInteractions(v),this.map.dragPan.disable(),v.boxSelectStartLocation=li(E.originalEvent,this.map.getContainer()),v.canBoxSelect=!0},se.onTouchStart=function(v,E){if(Dn(E))return this.startOnActiveFeature(v,E)},se.onDrag=function(v,E){return v.canDragMove?this.dragMove(v,E):this.drawConfig.boxSelect&&v.canBoxSelect?this.whileBoxSelect(v,E):void 0},se.whileBoxSelect=function(v,E){v.boxSelecting=!0,this.updateUIClasses({mouse:nr.ADD}),v.boxSelectElement||(v.boxSelectElement=document.createElement("div"),v.boxSelectElement.classList.add(Xe.BOX_SELECT),this.map.getContainer().appendChild(v.boxSelectElement));const j=li(E.originalEvent,this.map.getContainer()),be=Math.min(v.boxSelectStartLocation.x,j.x),ue=Math.max(v.boxSelectStartLocation.x,j.x),V=Math.min(v.boxSelectStartLocation.y,j.y),Ne=Math.max(v.boxSelectStartLocation.y,j.y),Ge=`translate(${be}px, ${V}px)`;v.boxSelectElement.style.transform=Ge,v.boxSelectElement.style.WebkitTransform=Ge,v.boxSelectElement.style.width=ue-be+"px",v.boxSelectElement.style.height=Ne-V+"px"},se.dragMove=function(v,E){v.dragMoving=!0,E.originalEvent.stopPropagation();const j={lng:E.lngLat.lng-v.dragMoveLocation.lng,lat:E.lngLat.lat-v.dragMoveLocation.lat};J(this.getSelected(),j),v.dragMoveLocation=E.lngLat},se.onTouchEnd=se.onMouseUp=function(v,E){if(v.dragMoving)this.fireUpdate();else if(v.boxSelecting){const j=[v.boxSelectStartLocation,li(E.originalEvent,this.map.getContainer())],be=this.featuresAt(null,j,"click"),ue=this.getUniqueIds(be).filter(V=>!this.isSelected(V));ue.length&&(this.select(ue),ue.forEach(V=>this.doRender(V)),this.updateUIClasses({mouse:nr.MOVE}))}this.stopExtendedInteractions(v)},se.toDisplayFeatures=function(v,E,j){E.properties.active=this.isSelected(E.properties.id)?Vr.ACTIVE:Vr.INACTIVE,j(E),this.fireActionable(),E.properties.active===Vr.ACTIVE&&E.geometry.type!==_t.POINT&&Ar(E).forEach(j)},se.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},se.onCombineFeatures=function(){const v=this.getSelected();if(v.length===0||v.length<2)return;const E=[],j=[],be=v[0].type.replace("Multi","");for(let ue=0;ue<v.length;ue++){const V=v[ue];if(V.type.replace("Multi","")!==be)return;V.type.includes("Multi")?V.getCoordinates().forEach(Ne=>{E.push(Ne)}):E.push(V.getCoordinates()),j.push(V.toGeoJSON())}if(j.length>1){const ue=this.newFeature({type:_t.FEATURE,properties:j[0].properties,geometry:{type:`Multi${be}`,coordinates:E}});this.addFeature(ue),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([ue.id]),this.fire(dr.COMBINE_FEATURES,{createdFeatures:[ue.toGeoJSON()],deletedFeatures:j})}this.fireActionable()},se.onUncombineFeatures=function(){const v=this.getSelected();if(v.length===0)return;const E=[],j=[];for(let be=0;be<v.length;be++){const ue=v[be];this.isInstanceOf("MultiFeature",ue)&&(ue.getFeatures().forEach(V=>{this.addFeature(V),V.properties=ue.properties,E.push(V.toGeoJSON()),this.select([V.id])}),this.deleteFeature(ue.id,{silent:!0}),j.push(ue.toGeoJSON()))}E.length>1&&this.fire(dr.UNCOMBINE_FEATURES,{createdFeatures:E,deletedFeatures:j}),this.fireActionable()};const ze=Ri(Rr.VERTEX),Be=Ri(Rr.MIDPOINT),Ee={fireUpdate:function(){this.fire(dr.UPDATE,{action:Ji.CHANGE_COORDINATES,features:this.getSelected().map(v=>v.toGeoJSON())})},fireActionable:function(v){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:v.selectedCoordPaths.length>0})},startDragging:function(v,E){v.initialDragPanState=this.map.dragPan.isEnabled(),this.map.dragPan.disable(),v.canDragMove=!0,v.dragMoveLocation=E.lngLat},stopDragging:function(v){v.canDragMove&&v.initialDragPanState===!0&&this.map.dragPan.enable(),v.dragMoving=!1,v.canDragMove=!1,v.dragMoveLocation=null},onVertex:function(v,E){this.startDragging(v,E);const j=E.featureTarget.properties,be=v.selectedCoordPaths.indexOf(j.coord_path);ui(E)||be!==-1?ui(E)&&be===-1&&v.selectedCoordPaths.push(j.coord_path):v.selectedCoordPaths=[j.coord_path];const ue=this.pathsToCoordinates(v.featureId,v.selectedCoordPaths);this.setSelectedCoordinates(ue)},onMidpoint:function(v,E){this.startDragging(v,E);const j=E.featureTarget.properties;v.feature.addCoordinate(j.coord_path,j.lng,j.lat),this.fireUpdate(),v.selectedCoordPaths=[j.coord_path]},pathsToCoordinates:function(v,E){return E.map(j=>({feature_id:v,coord_path:j}))},onFeature:function(v,E){v.selectedCoordPaths.length===0?this.startDragging(v,E):this.stopDragging(v)},dragFeature:function(v,E,j){J(this.getSelected(),j),v.dragMoveLocation=E.lngLat},dragVertex:function(v,E,j){const be=v.selectedCoordPaths.map(V=>v.feature.getCoordinate(V)),ue=L(be.map(V=>({type:_t.FEATURE,properties:{},geometry:{type:_t.POINT,coordinates:V}})),j);for(let V=0;V<be.length;V++){const Ne=be[V];v.feature.updateCoordinate(v.selectedCoordPaths[V],Ne[0]+ue.lng,Ne[1]+ue.lat)}},clickNoTarget:function(){this.changeMode(or.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(or.SIMPLE_SELECT)},clickActiveFeature:function(v){v.selectedCoordPaths=[],this.clearSelectedCoordinates(),v.feature.changed()},onSetup:function(v){const E=v.featureId,j=this.getFeature(E);if(!j)throw new Error("You must provide a featureId to enter direct_select mode");if(j.type===_t.POINT)throw new TypeError("direct_select mode doesn't handle point features");const be={featureId:E,feature:j,dragMoveLocation:v.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:v.coordPath?[v.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(E,be.selectedCoordPaths)),this.setSelected(E),C.disable(this),this.setActionableState({trash:!0}),be},onStop:function(){C.enable(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(v,E,j){v.featureId===E.properties.id?(E.properties.active=Vr.ACTIVE,j(E),Ar(E,{map:this.map,midpoints:!0,selectedPaths:v.selectedCoordPaths}).forEach(j)):(E.properties.active=Vr.INACTIVE,j(E)),this.fireActionable(v)},onTrash:function(v){v.selectedCoordPaths.sort((E,j)=>j.localeCompare(E,"en",{numeric:!0})).forEach(E=>v.feature.removeCoordinate(E)),this.fireUpdate(),v.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(v),v.feature.isValid()===!1&&(this.deleteFeature([v.featureId]),this.changeMode(or.SIMPLE_SELECT,{}))},onMouseMove:function(v,E){const j=Dn(E),be=ze(E),ue=Be(E),V=v.selectedCoordPaths.length===0;return j&&V||be&&!V?this.updateUIClasses({mouse:nr.MOVE}):this.updateUIClasses({mouse:nr.NONE}),(be||j||ue)&&v.dragMoving&&this.fireUpdate(),this.stopDragging(v),!0},onMouseOut:function(v){return v.dragMoving&&this.fireUpdate(),!0}};Ee.onTouchStart=Ee.onMouseDown=function(v,E){return ze(E)?this.onVertex(v,E):Dn(E)?this.onFeature(v,E):Be(E)?this.onMidpoint(v,E):void 0},Ee.onDrag=function(v,E){if(v.canDragMove!==!0)return;v.dragMoving=!0,E.originalEvent.stopPropagation();const j={lng:E.lngLat.lng-v.dragMoveLocation.lng,lat:E.lngLat.lat-v.dragMoveLocation.lat};v.selectedCoordPaths.length>0?this.dragVertex(v,E,j):this.dragFeature(v,E,j),v.dragMoveLocation=E.lngLat},Ee.onClick=function(v,E){return Fi(E)?this.clickNoTarget(v,E):Dn(E)?this.clickActiveFeature(v,E):Ii(E)?this.clickInactive(v,E):void this.stopDragging(v)},Ee.onTap=function(v,E){return Fi(E)?this.clickNoTarget(v,E):Dn(E)?this.clickActiveFeature(v,E):Ii(E)?this.clickInactive(v,E):void 0},Ee.onTouchEnd=Ee.onMouseUp=function(v){v.dragMoving&&this.fireUpdate(),this.stopDragging(v)};const ke={};function ot(v,E){return!!v.lngLat&&v.lngLat.lng===E[0]&&v.lngLat.lat===E[1]}ke.onSetup=function(){const v=this.newFeature({type:_t.FEATURE,properties:{},geometry:{type:_t.POINT,coordinates:[]}});return this.addFeature(v),this.clearSelectedFeatures(),this.updateUIClasses({mouse:nr.ADD}),this.activateUIButton(Or.POINT),this.setActionableState({trash:!0}),{point:v}},ke.stopDrawingAndRemove=function(v){this.deleteFeature([v.point.id],{silent:!0}),this.changeMode(or.SIMPLE_SELECT)},ke.onTap=ke.onClick=function(v,E){this.updateUIClasses({mouse:nr.MOVE}),v.point.updateCoordinate("",E.lngLat.lng,E.lngLat.lat),this.fire(dr.CREATE,{features:[v.point.toGeoJSON()]}),this.changeMode(or.SIMPLE_SELECT,{featureIds:[v.point.id]})},ke.onStop=function(v){this.activateUIButton(),v.point.getCoordinate().length||this.deleteFeature([v.point.id],{silent:!0})},ke.toDisplayFeatures=function(v,E,j){const be=E.properties.id===v.point.id;if(E.properties.active=be?Vr.ACTIVE:Vr.INACTIVE,!be)return j(E)},ke.onTrash=ke.stopDrawingAndRemove,ke.onKeyUp=function(v,E){if(ei(E)||Ni(E))return this.stopDrawingAndRemove(v,E)};const We={onSetup:function(){const v=this.newFeature({type:_t.FEATURE,properties:{},geometry:{type:_t.POLYGON,coordinates:[[]]}});return this.addFeature(v),this.clearSelectedFeatures(),C.disable(this),this.updateUIClasses({mouse:nr.ADD}),this.activateUIButton(Or.POLYGON),this.setActionableState({trash:!0}),{polygon:v,currentVertexPosition:0}},clickAnywhere:function(v,E){if(v.currentVertexPosition>0&&ot(E,v.polygon.coordinates[0][v.currentVertexPosition-1]))return this.changeMode(or.SIMPLE_SELECT,{featureIds:[v.polygon.id]});this.updateUIClasses({mouse:nr.ADD}),v.polygon.updateCoordinate(`0.${v.currentVertexPosition}`,E.lngLat.lng,E.lngLat.lat),v.currentVertexPosition++,v.polygon.updateCoordinate(`0.${v.currentVertexPosition}`,E.lngLat.lng,E.lngLat.lat)},clickOnVertex:function(v){return this.changeMode(or.SIMPLE_SELECT,{featureIds:[v.polygon.id]})},onMouseMove:function(v,E){v.polygon.updateCoordinate(`0.${v.currentVertexPosition}`,E.lngLat.lng,E.lngLat.lat),bt(E)&&this.updateUIClasses({mouse:nr.POINTER})}};We.onTap=We.onClick=function(v,E){return bt(E)?this.clickOnVertex(v,E):this.clickAnywhere(v,E)},We.onKeyUp=function(v,E){ei(E)?(this.deleteFeature([v.polygon.id],{silent:!0}),this.changeMode(or.SIMPLE_SELECT)):Ni(E)&&this.changeMode(or.SIMPLE_SELECT,{featureIds:[v.polygon.id]})},We.onStop=function(v){this.updateUIClasses({mouse:nr.NONE}),C.enable(this),this.activateUIButton(),this.getFeature(v.polygon.id)!==void 0&&(v.polygon.removeCoordinate(`0.${v.currentVertexPosition}`),v.polygon.isValid()?this.fire(dr.CREATE,{features:[v.polygon.toGeoJSON()]}):(this.deleteFeature([v.polygon.id],{silent:!0}),this.changeMode(or.SIMPLE_SELECT,{},{silent:!0})))},We.toDisplayFeatures=function(v,E,j){const be=E.properties.id===v.polygon.id;if(E.properties.active=be?Vr.ACTIVE:Vr.INACTIVE,!be)return j(E);if(E.geometry.coordinates.length===0)return;const ue=E.geometry.coordinates[0].length;if(!(ue<3)){if(E.properties.meta=Rr.FEATURE,j(ti(v.polygon.id,E.geometry.coordinates[0][0],"0.0",!1)),ue>3){const V=E.geometry.coordinates[0].length-3;j(ti(v.polygon.id,E.geometry.coordinates[0][V],`0.${V}`,!1))}if(ue<=4){const V=[[E.geometry.coordinates[0][0][0],E.geometry.coordinates[0][0][1]],[E.geometry.coordinates[0][1][0],E.geometry.coordinates[0][1][1]]];if(j({type:_t.FEATURE,properties:E.properties,geometry:{coordinates:V,type:_t.LINE_STRING}}),ue===3)return}return j(E)}},We.onTrash=function(v){this.deleteFeature([v.polygon.id],{silent:!0}),this.changeMode(or.SIMPLE_SELECT)};const Se={onSetup:function(v){const E=(v=v||{}).featureId;let j,be,ue="forward";if(E){if(j=this.getFeature(E),!j)throw new Error("Could not find a feature with the provided featureId");let V=v.from;if(V&&V.type==="Feature"&&V.geometry&&V.geometry.type==="Point"&&(V=V.geometry),V&&V.type==="Point"&&V.coordinates&&V.coordinates.length===2&&(V=V.coordinates),!V||!Array.isArray(V))throw new Error("Please use the `from` property to indicate which point to continue the line from");const Ne=j.coordinates.length-1;if(j.coordinates[Ne][0]===V[0]&&j.coordinates[Ne][1]===V[1])be=Ne+1,j.addCoordinate(be,...j.coordinates[Ne]);else{if(j.coordinates[0][0]!==V[0]||j.coordinates[0][1]!==V[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");ue="backwards",be=0,j.addCoordinate(be,...j.coordinates[0])}}else j=this.newFeature({type:_t.FEATURE,properties:{},geometry:{type:_t.LINE_STRING,coordinates:[]}}),be=0,this.addFeature(j);return this.clearSelectedFeatures(),C.disable(this),this.updateUIClasses({mouse:nr.ADD}),this.activateUIButton(Or.LINE),this.setActionableState({trash:!0}),{line:j,currentVertexPosition:be,direction:ue}},clickAnywhere:function(v,E){if(v.currentVertexPosition>0&&ot(E,v.line.coordinates[v.currentVertexPosition-1])||v.direction==="backwards"&&ot(E,v.line.coordinates[v.currentVertexPosition+1]))return this.changeMode(or.SIMPLE_SELECT,{featureIds:[v.line.id]});this.updateUIClasses({mouse:nr.ADD}),v.line.updateCoordinate(v.currentVertexPosition,E.lngLat.lng,E.lngLat.lat),v.direction==="forward"?(v.currentVertexPosition++,v.line.updateCoordinate(v.currentVertexPosition,E.lngLat.lng,E.lngLat.lat)):v.line.addCoordinate(0,E.lngLat.lng,E.lngLat.lat)},clickOnVertex:function(v){return this.changeMode(or.SIMPLE_SELECT,{featureIds:[v.line.id]})},onMouseMove:function(v,E){v.line.updateCoordinate(v.currentVertexPosition,E.lngLat.lng,E.lngLat.lat),bt(E)&&this.updateUIClasses({mouse:nr.POINTER})}};Se.onTap=Se.onClick=function(v,E){if(bt(E))return this.clickOnVertex(v,E);this.clickAnywhere(v,E)},Se.onKeyUp=function(v,E){Ni(E)?this.changeMode(or.SIMPLE_SELECT,{featureIds:[v.line.id]}):ei(E)&&(this.deleteFeature([v.line.id],{silent:!0}),this.changeMode(or.SIMPLE_SELECT))},Se.onStop=function(v){C.enable(this),this.activateUIButton(),this.getFeature(v.line.id)!==void 0&&(v.line.removeCoordinate(`${v.currentVertexPosition}`),v.line.isValid()?this.fire(dr.CREATE,{features:[v.line.toGeoJSON()]}):(this.deleteFeature([v.line.id],{silent:!0}),this.changeMode(or.SIMPLE_SELECT,{},{silent:!0})))},Se.onTrash=function(v){this.deleteFeature([v.line.id],{silent:!0}),this.changeMode(or.SIMPLE_SELECT)},Se.toDisplayFeatures=function(v,E,j){const be=E.properties.id===v.line.id;if(E.properties.active=be?Vr.ACTIVE:Vr.INACTIVE,!be)return j(E);E.geometry.coordinates.length<2||(E.properties.meta=Rr.FEATURE,j(ti(v.line.id,E.geometry.coordinates[v.direction==="forward"?E.geometry.coordinates.length-2:1],""+(v.direction==="forward"?E.geometry.coordinates.length-2:1),!1)),j(E))};var it={simple_select:se,direct_select:Ee,draw_point:ke,draw_polygon:We,draw_line_string:Se};const je={defaultMode:or.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:Oi,modes:it,controls:{},userProperties:!1,suppressAPIEvents:!0},Ye={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},Bt={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function et(v,E){return v.map(j=>j.source?j:Object.assign({},j,{id:`${j.id}.${E}`,source:E==="hot"?Nn.HOT:Nn.COLD}))}var Yt,Nt,Ut,Ht,rr=lr(Nt?Yt:(Nt=1,Yt=function v(E,j){if(E===j)return!0;if(E&&j&&typeof E=="object"&&typeof j=="object"){if(E.constructor!==j.constructor)return!1;var be,ue,V;if(Array.isArray(E)){if((be=E.length)!=j.length)return!1;for(ue=be;ue--!=0;)if(!v(E[ue],j[ue]))return!1;return!0}if(E.constructor===RegExp)return E.source===j.source&&E.flags===j.flags;if(E.valueOf!==Object.prototype.valueOf)return E.valueOf()===j.valueOf();if(E.toString!==Object.prototype.toString)return E.toString()===j.toString();if((be=(V=Object.keys(E)).length)!==Object.keys(j).length)return!1;for(ue=be;ue--!=0;)if(!Object.prototype.hasOwnProperty.call(j,V[ue]))return!1;for(ue=be;ue--!=0;){var Ne=V[ue];if(!v(E[Ne],j[Ne]))return!1}return!0}return E!=E&&j!=j})),Hr=function(){if(Ht)return Ut;Ht=1,Ut=function(E){if(!E||!E.type)return null;var j=v[E.type];return j?j==="geometry"?{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:E}]}:j==="feature"?{type:"FeatureCollection",features:[E]}:j==="featurecollection"?E:void 0:null};var v={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"};return Ut}(),cr=lr(Hr);function zr(v,E){return v.length===E.length&&JSON.stringify(v.map(j=>j).sort())===JSON.stringify(E.map(j=>j).sort())}const vr={Polygon:qt,LineString:En,Point:wn,MultiPolygon:gr,MultiLineString:gr,MultiPoint:gr};var Zt=Object.freeze({__proto__:null,CommonSelectors:pt,ModeHandler:mt,StringSet:Br,constrainFeatureMovement:L,createMidPoint:xo,createSupplementaryPoints:Ar,createVertex:ti,doubleClickZoom:C,euclideanDistance:xi,featuresAt:yn,getFeatureAtAndSetCursors:Vn,isClick:Wn,isEventAtCoordinates:ot,isTap:Li,mapEventToBoundingBox:Sr,moveFeatures:J,sortFeatures:_i,stringSetsAreEqual:zr,theme:Oi,toDenseArray:vn});const pr=function(v,E){const j={options:v=function(ue={}){let V=Object.assign({},ue);return ue.controls||(V.controls={}),ue.displayControlsDefault===!1?V.controls=Object.assign({},Bt,ue.controls):V.controls=Object.assign({},Ye,ue.controls),V=Object.assign({},je,V),V.styles=et(V.styles,"cold").concat(et(V.styles,"hot")),V}(v)};E=function(ue,V){V.modes=or;const Ne=ue.options.suppressAPIEvents===void 0||!!ue.options.suppressAPIEvents;return V.getFeatureIdsAt=function(Ge){return yn.click({point:Ge},null,ue).map(Ve=>Ve.properties.id)},V.getSelectedIds=function(){return ue.store.getSelectedIds()},V.getSelected=function(){return{type:_t.FEATURE_COLLECTION,features:ue.store.getSelectedIds().map(Ge=>ue.store.get(Ge)).map(Ge=>Ge.toGeoJSON())}},V.getSelectedPoints=function(){return{type:_t.FEATURE_COLLECTION,features:ue.store.getSelectedCoordinates().map(Ge=>({type:_t.FEATURE,properties:{},geometry:{type:_t.POINT,coordinates:Ge.coordinates}}))}},V.set=function(Ge){if(Ge.type===void 0||Ge.type!==_t.FEATURE_COLLECTION||!Array.isArray(Ge.features))throw new Error("Invalid FeatureCollection");const Ve=ue.store.createRenderBatch();let Le=ue.store.getAllIds().slice();const st=V.add(Ge),At=new Br(st);return Le=Le.filter(er=>!At.has(er)),Le.length&&V.delete(Le),Ve(),st},V.add=function(Ge){const Ve=JSON.parse(JSON.stringify(cr(Ge))).features.map(Le=>{if(Le.id=Le.id||wi(),Le.geometry===null)throw new Error("Invalid geometry: null");if(ue.store.get(Le.id)===void 0||ue.store.get(Le.id).type!==Le.geometry.type){const st=vr[Le.geometry.type];if(st===void 0)throw new Error(`Invalid geometry type: ${Le.geometry.type}.`);const At=new st(ue,Le);ue.store.add(At,{silent:Ne})}else{const st=ue.store.get(Le.id),At=st.properties;st.properties=Le.properties,rr(At,Le.properties)||ue.store.featureChanged(st.id,{silent:Ne}),rr(st.getCoordinates(),Le.geometry.coordinates)||st.incomingCoords(Le.geometry.coordinates)}return Le.id});return ue.store.render(),Ve},V.get=function(Ge){const Ve=ue.store.get(Ge);if(Ve)return Ve.toGeoJSON()},V.getAll=function(){return{type:_t.FEATURE_COLLECTION,features:ue.store.getAll().map(Ge=>Ge.toGeoJSON())}},V.delete=function(Ge){return ue.store.delete(Ge,{silent:Ne}),V.getMode()!==or.DIRECT_SELECT||ue.store.getSelectedIds().length?ue.store.render():ue.events.changeMode(or.SIMPLE_SELECT,void 0,{silent:Ne}),V},V.deleteAll=function(){return ue.store.delete(ue.store.getAllIds(),{silent:Ne}),V.getMode()===or.DIRECT_SELECT?ue.events.changeMode(or.SIMPLE_SELECT,void 0,{silent:Ne}):ue.store.render(),V},V.changeMode=function(Ge,Ve={}){return Ge===or.SIMPLE_SELECT&&V.getMode()===or.SIMPLE_SELECT?(zr(Ve.featureIds||[],ue.store.getSelectedIds())||(ue.store.setSelected(Ve.featureIds,{silent:Ne}),ue.store.render()),V):(Ge===or.DIRECT_SELECT&&V.getMode()===or.DIRECT_SELECT&&Ve.featureId===ue.store.getSelectedIds()[0]||ue.events.changeMode(Ge,Ve,{silent:Ne}),V)},V.getMode=function(){return ue.events.getMode()},V.trash=function(){return ue.events.trash({silent:Ne}),V},V.combineFeatures=function(){return ue.events.combineFeatures({silent:Ne}),V},V.uncombineFeatures=function(){return ue.events.uncombineFeatures({silent:Ne}),V},V.setFeatureProperty=function(Ge,Ve,Le){return ue.store.setFeatureProperty(Ge,Ve,Le,{silent:Ne}),V},V}(j,E),j.api=E;const be=Ti(j);return E.onAdd=be.onAdd,E.onRemove=be.onRemove,E.types=Or,E.options=v,E};function Jr(v){pr(v,this)}return Jr.modes=it,Jr.constants=bn,Jr.lib=Zt,Jr},Zr.exports=tr()})(Jp);var Zf=Jp.exports;const fd=Ic(Zf);var Yp={exports:{}};(function(Zr,Nr){(function(tr,mt){Zr.exports=mt()})(Sc,function(){var tr=function(h,g){return(tr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(b,T){b.__proto__=T}||function(b,T){for(var k in T)Object.prototype.hasOwnProperty.call(T,k)&&(b[k]=T[k])})(h,g)},mt=function(){return(mt=Object.assign||function(h){for(var g,b=1,T=arguments.length;b<T;b++)for(var k in g=arguments[b])Object.prototype.hasOwnProperty.call(g,k)&&(h[k]=g[k]);return h}).apply(this,arguments)};function lr(h,g,b){for(var T,k=0,R=g.length;k<R;k++)!T&&k in g||((T=T||Array.prototype.slice.call(g,0,k))[k]=g[k]);return h.concat(T||Array.prototype.slice.call(g))}var Cr=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:Sc,l=Object.keys,ur=Array.isArray;function Oe(h,g){return typeof g!="object"||l(g).forEach(function(b){h[b]=g[b]}),h}typeof Promise>"u"||Cr.Promise||(Cr.Promise=Promise);var Ur=Object.getPrototypeOf,Rt={}.hasOwnProperty;function Gr(h,g){return Rt.call(h,g)}function Xe(h,g){typeof g=="function"&&(g=g(Ur(h))),(typeof Reflect>"u"?l:Reflect.ownKeys)(g).forEach(function(b){nr(h,b,g[b])})}var Nn=Object.defineProperty;function nr(h,g,b,T){Nn(h,g,Oe(b&&Gr(b,"get")&&typeof b.get=="function"?{get:b.get,set:b.set,configurable:!0}:{value:b,configurable:!0,writable:!0},T))}function Or(h){return{from:function(g){return h.prototype=Object.create(g.prototype),nr(h.prototype,"constructor",h),{extend:Xe.bind(null,h.prototype)}}}}var _t=Object.getOwnPropertyDescriptor,or=[].slice;function dr(h,g,b){return or.call(h,g,b)}function Ji(h,g){return g(h)}function Rr(h){if(!h)throw new Error("Assertion Failed")}function Vr(h){Cr.setImmediate?setImmediate(h):setTimeout(h,0)}function Un(h,g){if(typeof g=="string"&&Gr(h,g))return h[g];if(!g)return h;if(typeof g!="string"){for(var b=[],T=0,k=g.length;T<k;++T){var R=Un(h,g[T]);b.push(R)}return b}var K=g.indexOf(".");if(K!==-1){var te=h[g.substr(0,K)];return te==null?void 0:Un(te,g.substr(K+1))}}function Qr(h,g,b){if(h&&g!==void 0&&!("isFrozen"in Object&&Object.isFrozen(h)))if(typeof g!="string"&&"length"in g){Rr(typeof b!="string"&&"length"in b);for(var T=0,k=g.length;T<k;++T)Qr(h,g[T],b[T])}else{var R,K,te=g.indexOf(".");te!==-1?(R=g.substr(0,te),(K=g.substr(te+1))===""?b===void 0?ur(h)&&!isNaN(parseInt(R))?h.splice(R,1):delete h[R]:h[R]=b:Qr(te=!(te=h[R])||!Gr(h,R)?h[R]={}:te,K,b)):b===void 0?ur(h)&&!isNaN(parseInt(g))?h.splice(g,1):delete h[g]:h[g]=b}}function zi(h){var g,b={};for(g in h)Gr(h,g)&&(b[g]=h[g]);return b}var bn=[].concat;function vi(h){return bn.apply([],h)}var un="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(vi([8,16,32,64].map(function(h){return["Int","Uint","Float"].map(function(g){return g+h+"Array"})}))).filter(function(h){return Cr[h]}),si=new Set(un.map(function(h){return Cr[h]})),_i=null;function Sr(h){return _i=new WeakMap,h=function g(b){if(!b||typeof b!="object")return b;var T=_i.get(b);if(T)return T;if(ur(b)){T=[],_i.set(b,T);for(var k=0,R=b.length;k<R;++k)T.push(g(b[k]))}else if(si.has(b.constructor))T=b;else{var K,te=Ur(b);for(K in T=te===Object.prototype?{}:Object.create(te),_i.set(b,T),b)Gr(b,K)&&(T[K]=g(b[K]))}return T}(h),_i=null,h}var Br={}.toString;function Bo(h){return Br.call(h).slice(8,-1)}var yn=typeof Symbol<"u"?Symbol.iterator:"@@iterator",vo=typeof yn=="symbol"?function(h){var g;return h!=null&&(g=h[yn])&&g.apply(h)}:function(){return null};function Vn(h,g){return g=h.indexOf(g),0<=g&&h.splice(g,1),0<=g}var xi={};function Mn(h){var g,b,T,k;if(arguments.length===1){if(ur(h))return h.slice();if(this===xi&&typeof h=="string")return[h];if(k=vo(h)){for(b=[];!(T=k.next()).done;)b.push(T.value);return b}if(h==null)return[h];if(typeof(g=h.length)!="number")return[h];for(b=new Array(g);g--;)b[g]=h[g];return b}for(g=arguments.length,b=new Array(g);g--;)b[g]=arguments[g];return b}var $n=typeof Symbol<"u"?function(h){return h[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},Ti=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],nn=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(Ti),Di={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Wn(h,g){this.name=h,this.message=g}function no(h,g){return h+". Errors: "+Object.keys(g).map(function(b){return g[b].toString()}).filter(function(b,T,k){return k.indexOf(b)===T}).join(`
`)}function bi(h,g,b,T){this.failures=g,this.failedKeys=T,this.successCount=b,this.message=no(h,g)}function Li(h,g){this.name="BulkError",this.failures=Object.keys(g).map(function(b){return g[b]}),this.failuresByPos=g,this.message=no(h,this.failures)}Or(Wn).from(Error).extend({toString:function(){return this.name+": "+this.message}}),Or(bi).from(Wn),Or(Li).from(Wn);var gn=nn.reduce(function(h,g){return h[g]=g+"Error",h},{}),wi=Wn,Ke=nn.reduce(function(h,g){var b=g+"Error";function T(k,R){this.name=b,k?typeof k=="string"?(this.message="".concat(k).concat(R?`
 `+R:""),this.inner=R||null):typeof k=="object"&&(this.message="".concat(k.name," ").concat(k.message),this.inner=k):(this.message=Di[g]||b,this.inner=null)}return Or(T).from(wi),h[g]=T,h},{});Ke.Syntax=SyntaxError,Ke.Type=TypeError,Ke.Range=RangeError;var wn=Ti.reduce(function(h,g){return h[g+"Error"]=Ke[g],h},{}),En=nn.reduce(function(h,g){return["Syntax","Type","Range"].indexOf(g)===-1&&(h[g+"Error"]=Ke[g]),h},{});function qt(){}function Wt(h){return h}function Ei(h,g){return h==null||h===Wt?g:function(b){return g(h(b))}}function gr(h,g){return function(){h.apply(this,arguments),g.apply(this,arguments)}}function jt(h,g){return h===qt?g:function(){var b=h.apply(this,arguments);b!==void 0&&(arguments[0]=b);var T=this.onsuccess,k=this.onerror;this.onsuccess=null,this.onerror=null;var R=g.apply(this,arguments);return T&&(this.onsuccess=this.onsuccess?gr(T,this.onsuccess):T),k&&(this.onerror=this.onerror?gr(k,this.onerror):k),R!==void 0?R:b}}function oa(h,g){return h===qt?g:function(){h.apply(this,arguments);var b=this.onsuccess,T=this.onerror;this.onsuccess=this.onerror=null,g.apply(this,arguments),b&&(this.onsuccess=this.onsuccess?gr(b,this.onsuccess):b),T&&(this.onerror=this.onerror?gr(T,this.onerror):T)}}function Si(h,g){return h===qt?g:function(b){var T=h.apply(this,arguments);Oe(b,T);var k=this.onsuccess,R=this.onerror;return this.onsuccess=null,this.onerror=null,b=g.apply(this,arguments),k&&(this.onsuccess=this.onsuccess?gr(k,this.onsuccess):k),R&&(this.onerror=this.onerror?gr(R,this.onerror):R),T===void 0?b===void 0?void 0:b:Oe(T,b)}}function Jo(h,g){return h===qt?g:function(){return g.apply(this,arguments)!==!1&&h.apply(this,arguments)}}function vn(h,g){return h===qt?g:function(){var b=h.apply(this,arguments);if(b&&typeof b.then=="function"){for(var T=this,k=arguments.length,R=new Array(k);k--;)R[k]=arguments[k];return b.then(function(){return g.apply(T,R)})}return g.apply(this,arguments)}}En.ModifyError=bi,En.DexieError=Wn,En.BulkError=Li;var zn=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function br(h){zn=h}var Sn={},Qn=100,un=typeof Promise>"u"?[]:function(){var h=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[h,Ur(h),h];var g=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[g,Ur(g),h]}(),Ti=un[0],nn=un[1],un=un[2],nn=nn&&nn.then,Hn=Ti&&Ti.constructor,_o=!!un,Oi=function(h,g){ui.push([h,g]),Bi&&(queueMicrotask(M),Bi=!1)},Ri=!0,Bi=!0,Dn=[],Ii=[],Fi=Wt,Ln={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:qt,pgp:!1,env:{},finalize:qt},bt=Ln,ui=[],ei=0,Ni=[];function pt(h){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var g=this._PSD=bt;if(typeof h!="function"){if(h!==Sn)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&ti(this,this._value))}this._state=null,this._value=null,++g.ref,function b(T,k){try{k(function(R){if(T._state===null){if(R===T)throw new TypeError("A promise cannot be resolved with itself.");var K=T._lib&&D();R&&typeof R.then=="function"?b(T,function(te,le){R instanceof pt?R._then(te,le):R.then(te,le)}):(T._state=!0,T._value=R,xo(T)),K&&U()}},ti.bind(null,T))}catch(R){ti(T,R)}}(this,h)}var _n={get:function(){var h=bt,g=Be;function b(T,k){var R=this,K=!h.global&&(h!==bt||g!==Be),te=K&&!We(),le=new pt(function(he,ge){Ar(R,new li(et(T,h,K,te),et(k,h,K,te),he,ge,h))});return this._consoleTask&&(le._consoleTask=this._consoleTask),le}return b.prototype=Sn,b},set:function(h){nr(this,"then",h&&h.prototype===Sn?_n:{get:function(){return h},set:_n.set})}};function li(h,g,b,T,k){this.onFulfilled=typeof h=="function"?h:null,this.onRejected=typeof g=="function"?g:null,this.resolve=b,this.reject=T,this.psd=k}function ti(h,g){var b,T;Ii.push(g),h._state===null&&(b=h._lib&&D(),g=Fi(g),h._state=!1,h._value=g,T=h,Dn.some(function(k){return k._value===T._value})||Dn.push(T),xo(h),b&&U())}function xo(h){var g=h._listeners;h._listeners=[];for(var b=0,T=g.length;b<T;++b)Ar(h,g[b]);var k=h._PSD;--k.ref||k.finalize(),ei===0&&(++ei,Oi(function(){--ei==0&&G()},[]))}function Ar(h,g){if(h._state!==null){var b=h._state?g.onFulfilled:g.onRejected;if(b===null)return(h._state?g.resolve:g.reject)(h._value);++g.psd.ref,++ei,Oi(C,[b,h,g])}else h._listeners.push(g)}function C(h,g,b){try{var T,k=g._value;!g._state&&Ii.length&&(Ii=[]),T=zn&&g._consoleTask?g._consoleTask.run(function(){return h(k)}):h(k),g._state||Ii.indexOf(k)!==-1||function(R){for(var K=Dn.length;K;)if(Dn[--K]._value===R._value)return Dn.splice(K,1)}(g),b.resolve(T)}catch(R){b.reject(R)}finally{--ei==0&&G(),--b.psd.ref||b.psd.finalize()}}function M(){Bt(Ln,function(){D()&&U()})}function D(){var h=Ri;return Bi=Ri=!1,h}function U(){var h,g,b;do for(;0<ui.length;)for(h=ui,ui=[],b=h.length,g=0;g<b;++g){var T=h[g];T[0].apply(null,T[1])}while(0<ui.length);Bi=Ri=!0}function G(){var h=Dn;Dn=[],h.forEach(function(T){T._PSD.onunhandled.call(null,T._value,T)});for(var g=Ni.slice(0),b=g.length;b;)g[--b]()}function ne(h){return new pt(Sn,!1,h)}function $(h,g){var b=bt;return function(){var T=D(),k=bt;try{return je(b,!0),h.apply(this,arguments)}catch(R){g&&g(R)}finally{je(k,!1),T&&U()}}}Xe(pt.prototype,{then:_n,_then:function(h,g){Ar(this,new li(null,null,h,g,bt))},catch:function(h){if(arguments.length===1)return this.then(null,h);var g=h,b=arguments[1];return typeof g=="function"?this.then(null,function(T){return(T instanceof g?b:ne)(T)}):this.then(null,function(T){return(T&&T.name===g?b:ne)(T)})},finally:function(h){return this.then(function(g){return pt.resolve(h()).then(function(){return g})},function(g){return pt.resolve(h()).then(function(){return ne(g)})})},timeout:function(h,g){var b=this;return h<1/0?new pt(function(T,k){var R=setTimeout(function(){return k(new Ke.Timeout(g))},h);b.then(T,k).finally(clearTimeout.bind(null,R))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&nr(pt.prototype,Symbol.toStringTag,"Dexie.Promise"),Ln.env=Ye(),Xe(pt,{all:function(){var h=Mn.apply(null,arguments).map(Se);return new pt(function(g,b){h.length===0&&g([]);var T=h.length;h.forEach(function(k,R){return pt.resolve(k).then(function(K){h[R]=K,--T||g(h)},b)})})},resolve:function(h){return h instanceof pt?h:h&&typeof h.then=="function"?new pt(function(g,b){h.then(g,b)}):new pt(Sn,!0,h)},reject:ne,race:function(){var h=Mn.apply(null,arguments).map(Se);return new pt(function(g,b){h.map(function(T){return pt.resolve(T).then(g,b)})})},PSD:{get:function(){return bt},set:function(h){return bt=h}},totalEchoes:{get:function(){return Be}},newPSD:ke,usePSD:Bt,scheduler:{get:function(){return Oi},set:function(h){Oi=h}},rejectionMapper:{get:function(){return Fi},set:function(h){Fi=h}},follow:function(h,g){return new pt(function(b,T){return ke(function(k,R){var K=bt;K.unhandleds=[],K.onunhandled=R,K.finalize=gr(function(){var te,le=this;te=function(){le.unhandleds.length===0?k():R(le.unhandleds[0])},Ni.push(function he(){te(),Ni.splice(Ni.indexOf(he),1)}),++ei,Oi(function(){--ei==0&&G()},[])},K.finalize),h()},g,b,T)})}}),Hn&&(Hn.allSettled&&nr(pt,"allSettled",function(){var h=Mn.apply(null,arguments).map(Se);return new pt(function(g){h.length===0&&g([]);var b=h.length,T=new Array(b);h.forEach(function(k,R){return pt.resolve(k).then(function(K){return T[R]={status:"fulfilled",value:K}},function(K){return T[R]={status:"rejected",reason:K}}).then(function(){return--b||g(T)})})})}),Hn.any&&typeof AggregateError<"u"&&nr(pt,"any",function(){var h=Mn.apply(null,arguments).map(Se);return new pt(function(g,b){h.length===0&&b(new AggregateError([]));var T=h.length,k=new Array(T);h.forEach(function(R,K){return pt.resolve(R).then(function(te){return g(te)},function(te){k[K]=te,--T||b(new AggregateError(k))})})})}),Hn.withResolvers&&(pt.withResolvers=Hn.withResolvers));var L={awaits:0,echoes:0,id:0},J=0,se=[],ze=0,Be=0,Ee=0;function ke(h,g,b,T){var k=bt,R=Object.create(k);return R.parent=k,R.ref=0,R.global=!1,R.id=++Ee,Ln.env,R.env=_o?{Promise:pt,PromiseProp:{value:pt,configurable:!0,writable:!0},all:pt.all,race:pt.race,allSettled:pt.allSettled,any:pt.any,resolve:pt.resolve,reject:pt.reject}:{},g&&Oe(R,g),++k.ref,R.finalize=function(){--this.parent.ref||this.parent.finalize()},T=Bt(R,h,b,T),R.ref===0&&R.finalize(),T}function ot(){return L.id||(L.id=++J),++L.awaits,L.echoes+=Qn,L.id}function We(){return!!L.awaits&&(--L.awaits==0&&(L.id=0),L.echoes=L.awaits*Qn,!0)}function Se(h){return L.echoes&&h&&h.constructor===Hn?(ot(),h.then(function(g){return We(),g},function(g){return We(),Nt(g)})):h}function it(){var h=se[se.length-1];se.pop(),je(h,!1)}function je(h,g){var b,T=bt;(g?!L.echoes||ze++&&h===bt:!ze||--ze&&h===bt)||queueMicrotask(g?function(k){++Be,L.echoes&&--L.echoes!=0||(L.echoes=L.awaits=L.id=0),se.push(bt),je(k,!0)}.bind(null,h):it),h!==bt&&(bt=h,T===Ln&&(Ln.env=Ye()),_o&&(b=Ln.env.Promise,g=h.env,(T.global||h.global)&&(Object.defineProperty(Cr,"Promise",g.PromiseProp),b.all=g.all,b.race=g.race,b.resolve=g.resolve,b.reject=g.reject,g.allSettled&&(b.allSettled=g.allSettled),g.any&&(b.any=g.any))))}function Ye(){var h=Cr.Promise;return _o?{Promise:h,PromiseProp:Object.getOwnPropertyDescriptor(Cr,"Promise"),all:h.all,race:h.race,allSettled:h.allSettled,any:h.any,resolve:h.resolve,reject:h.reject}:{}}function Bt(h,g,b,T,k){var R=bt;try{return je(h,!0),g(b,T,k)}finally{je(R,!1)}}function et(h,g,b,T){return typeof h!="function"?h:function(){var k=bt;b&&ot(),je(g,!0);try{return h.apply(this,arguments)}finally{je(k,!1),T&&queueMicrotask(We)}}}function Yt(h){Promise===Hn&&L.echoes===0?ze===0?h():enqueueNativeMicroTask(h):setTimeout(h,0)}(""+nn).indexOf("[native code]")===-1&&(ot=We=qt);var Nt=pt.reject,Ut="￿",Ht="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",rr="String expected.",Hr=[],cr="__dbnames",zr="readonly",vr="readwrite";function Zt(h,g){return h?g?function(){return h.apply(this,arguments)&&g.apply(this,arguments)}:h:g}var pr={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Jr(h){return typeof h!="string"||/\./.test(h)?function(g){return g}:function(g){return g[h]===void 0&&h in g&&delete(g=Sr(g))[h],g}}function v(){throw Ke.Type()}function E(h,g){try{var b=j(h),T=j(g);if(b!==T)return b==="Array"?1:T==="Array"?-1:b==="binary"?1:T==="binary"?-1:b==="string"?1:T==="string"?-1:b==="Date"?1:T!=="Date"?NaN:-1;switch(b){case"number":case"Date":case"string":return g<h?1:h<g?-1:0;case"binary":return function(k,R){for(var K=k.length,te=R.length,le=K<te?K:te,he=0;he<le;++he)if(k[he]!==R[he])return k[he]<R[he]?-1:1;return K===te?0:K<te?-1:1}(be(h),be(g));case"Array":return function(k,R){for(var K=k.length,te=R.length,le=K<te?K:te,he=0;he<le;++he){var ge=E(k[he],R[he]);if(ge!==0)return ge}return K===te?0:K<te?-1:1}(h,g)}}catch{}return NaN}function j(h){var g=typeof h;return g!="object"?g:ArrayBuffer.isView(h)?"binary":(h=Bo(h),h==="ArrayBuffer"?"binary":h)}function be(h){return h instanceof Uint8Array?h:ArrayBuffer.isView(h)?new Uint8Array(h.buffer,h.byteOffset,h.byteLength):new Uint8Array(h)}var ue=(V.prototype._trans=function(h,g,b){var T=this._tx||bt.trans,k=this.name,R=zn&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(h==="readonly"?"read":"write"," ").concat(this.name));function K(he,ge,ie){if(!ie.schema[k])throw new Ke.NotFound("Table "+k+" not part of transaction");return g(ie.idbtrans,ie)}var te=D();try{var le=T&&T.db._novip===this.db._novip?T===bt.trans?T._promise(h,K,b):ke(function(){return T._promise(h,K,b)},{trans:T,transless:bt.transless||bt}):function he(ge,ie,fe,pe){if(ge.idbdb&&(ge._state.openComplete||bt.letThrough||ge._vip)){var de=ge._createTransaction(ie,fe,ge._dbSchema);try{de.create(),ge._state.PR1398_maxLoop=3}catch(_e){return _e.name===gn.InvalidState&&ge.isOpen()&&0<--ge._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),ge.close({disableAutoOpen:!1}),ge.open().then(function(){return he(ge,ie,fe,pe)})):Nt(_e)}return de._promise(ie,function(_e,oe){return ke(function(){return bt.trans=de,pe(_e,oe,de)})}).then(function(_e){if(ie==="readwrite")try{de.idbtrans.commit()}catch{}return ie==="readonly"?_e:de._completion.then(function(){return _e})})}if(ge._state.openComplete)return Nt(new Ke.DatabaseClosed(ge._state.dbOpenError));if(!ge._state.isBeingOpened){if(!ge._state.autoOpen)return Nt(new Ke.DatabaseClosed);ge.open().catch(qt)}return ge._state.dbReadyPromise.then(function(){return he(ge,ie,fe,pe)})}(this.db,h,[this.name],K);return R&&(le._consoleTask=R,le=le.catch(function(he){return console.trace(he),Nt(he)})),le}finally{te&&U()}},V.prototype.get=function(h,g){var b=this;return h&&h.constructor===Object?this.where(h).first(g):h==null?Nt(new Ke.Type("Invalid argument to Table.get()")):this._trans("readonly",function(T){return b.core.get({trans:T,key:h}).then(function(k){return b.hook.reading.fire(k)})}).then(g)},V.prototype.where=function(h){if(typeof h=="string")return new this.db.WhereClause(this,h);if(ur(h))return new this.db.WhereClause(this,"[".concat(h.join("+"),"]"));var g=l(h);if(g.length===1)return this.where(g[0]).equals(h[g[0]]);var b=this.schema.indexes.concat(this.schema.primKey).filter(function(te){if(te.compound&&g.every(function(he){return 0<=te.keyPath.indexOf(he)})){for(var le=0;le<g.length;++le)if(g.indexOf(te.keyPath[le])===-1)return!1;return!0}return!1}).sort(function(te,le){return te.keyPath.length-le.keyPath.length})[0];if(b&&this.db._maxKey!==Ut){var R=b.keyPath.slice(0,g.length);return this.where(R).equals(R.map(function(le){return h[le]}))}!b&&zn&&console.warn("The query ".concat(JSON.stringify(h)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(g.join("+"),"]"));var T=this.schema.idxByName;function k(te,le){return E(te,le)===0}var K=g.reduce(function(ie,le){var he=ie[0],ge=ie[1],ie=T[le],fe=h[le];return[he||ie,he||!ie?Zt(ge,ie&&ie.multi?function(pe){return pe=Un(pe,le),ur(pe)&&pe.some(function(de){return k(fe,de)})}:function(pe){return k(fe,Un(pe,le))}):ge]},[null,null]),R=K[0],K=K[1];return R?this.where(R.name).equals(h[R.keyPath]).filter(K):b?this.filter(K):this.where(g).equals("")},V.prototype.filter=function(h){return this.toCollection().and(h)},V.prototype.count=function(h){return this.toCollection().count(h)},V.prototype.offset=function(h){return this.toCollection().offset(h)},V.prototype.limit=function(h){return this.toCollection().limit(h)},V.prototype.each=function(h){return this.toCollection().each(h)},V.prototype.toArray=function(h){return this.toCollection().toArray(h)},V.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},V.prototype.orderBy=function(h){return new this.db.Collection(new this.db.WhereClause(this,ur(h)?"[".concat(h.join("+"),"]"):h))},V.prototype.reverse=function(){return this.toCollection().reverse()},V.prototype.mapToClass=function(h){var g,b=this.db,T=this.name;function k(){return g!==null&&g.apply(this,arguments)||this}(this.schema.mappedClass=h).prototype instanceof v&&(function(le,he){if(typeof he!="function"&&he!==null)throw new TypeError("Class extends value "+String(he)+" is not a constructor or null");function ge(){this.constructor=le}tr(le,he),le.prototype=he===null?Object.create(he):(ge.prototype=he.prototype,new ge)}(k,g=h),Object.defineProperty(k.prototype,"db",{get:function(){return b},enumerable:!1,configurable:!0}),k.prototype.table=function(){return T},h=k);for(var R=new Set,K=h.prototype;K;K=Ur(K))Object.getOwnPropertyNames(K).forEach(function(le){return R.add(le)});function te(le){if(!le)return le;var he,ge=Object.create(h.prototype);for(he in le)if(!R.has(he))try{ge[he]=le[he]}catch{}return ge}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=te,this.hook("reading",te),h},V.prototype.defineClass=function(){return this.mapToClass(function(h){Oe(this,h)})},V.prototype.add=function(h,g){var b=this,T=this.schema.primKey,k=T.auto,R=T.keyPath,K=h;return R&&k&&(K=Jr(R)(h)),this._trans("readwrite",function(te){return b.core.mutate({trans:te,type:"add",keys:g!=null?[g]:null,values:[K]})}).then(function(te){return te.numFailures?pt.reject(te.failures[0]):te.lastResult}).then(function(te){if(R)try{Qr(h,R,te)}catch{}return te})},V.prototype.update=function(h,g){return typeof h!="object"||ur(h)?this.where(":id").equals(h).modify(g):(h=Un(h,this.schema.primKey.keyPath),h===void 0?Nt(new Ke.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(h).modify(g))},V.prototype.put=function(h,g){var b=this,T=this.schema.primKey,k=T.auto,R=T.keyPath,K=h;return R&&k&&(K=Jr(R)(h)),this._trans("readwrite",function(te){return b.core.mutate({trans:te,type:"put",values:[K],keys:g!=null?[g]:null})}).then(function(te){return te.numFailures?pt.reject(te.failures[0]):te.lastResult}).then(function(te){if(R)try{Qr(h,R,te)}catch{}return te})},V.prototype.delete=function(h){var g=this;return this._trans("readwrite",function(b){return g.core.mutate({trans:b,type:"delete",keys:[h]})}).then(function(b){return b.numFailures?pt.reject(b.failures[0]):void 0})},V.prototype.clear=function(){var h=this;return this._trans("readwrite",function(g){return h.core.mutate({trans:g,type:"deleteRange",range:pr})}).then(function(g){return g.numFailures?pt.reject(g.failures[0]):void 0})},V.prototype.bulkGet=function(h){var g=this;return this._trans("readonly",function(b){return g.core.getMany({keys:h,trans:b}).then(function(T){return T.map(function(k){return g.hook.reading.fire(k)})})})},V.prototype.bulkAdd=function(h,g,b){var T=this,k=Array.isArray(g)?g:void 0,R=(b=b||(k?void 0:g))?b.allKeys:void 0;return this._trans("readwrite",function(K){var he=T.schema.primKey,te=he.auto,he=he.keyPath;if(he&&k)throw new Ke.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(k&&k.length!==h.length)throw new Ke.InvalidArgument("Arguments objects and keys must have the same length");var le=h.length,he=he&&te?h.map(Jr(he)):h;return T.core.mutate({trans:K,type:"add",keys:k,values:he,wantResults:R}).then(function(de){var ie=de.numFailures,fe=de.results,pe=de.lastResult,de=de.failures;if(ie===0)return R?fe:pe;throw new Li("".concat(T.name,".bulkAdd(): ").concat(ie," of ").concat(le," operations failed"),de)})})},V.prototype.bulkPut=function(h,g,b){var T=this,k=Array.isArray(g)?g:void 0,R=(b=b||(k?void 0:g))?b.allKeys:void 0;return this._trans("readwrite",function(K){var he=T.schema.primKey,te=he.auto,he=he.keyPath;if(he&&k)throw new Ke.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(k&&k.length!==h.length)throw new Ke.InvalidArgument("Arguments objects and keys must have the same length");var le=h.length,he=he&&te?h.map(Jr(he)):h;return T.core.mutate({trans:K,type:"put",keys:k,values:he,wantResults:R}).then(function(de){var ie=de.numFailures,fe=de.results,pe=de.lastResult,de=de.failures;if(ie===0)return R?fe:pe;throw new Li("".concat(T.name,".bulkPut(): ").concat(ie," of ").concat(le," operations failed"),de)})})},V.prototype.bulkUpdate=function(h){var g=this,b=this.core,T=h.map(function(K){return K.key}),k=h.map(function(K){return K.changes}),R=[];return this._trans("readwrite",function(K){return b.getMany({trans:K,keys:T,cache:"clone"}).then(function(te){var le=[],he=[];h.forEach(function(ie,fe){var pe=ie.key,de=ie.changes,_e=te[fe];if(_e){for(var oe=0,ye=Object.keys(de);oe<ye.length;oe++){var Ie=ye[oe],Pe=de[Ie];if(Ie===g.schema.primKey.keyPath){if(E(Pe,pe)!==0)throw new Ke.Constraint("Cannot update primary key in bulkUpdate()")}else Qr(_e,Ie,Pe)}R.push(fe),le.push(pe),he.push(_e)}});var ge=le.length;return b.mutate({trans:K,type:"put",keys:le,values:he,updates:{keys:T,changeSpecs:k}}).then(function(ie){var fe=ie.numFailures,pe=ie.failures;if(fe===0)return ge;for(var de=0,_e=Object.keys(pe);de<_e.length;de++){var oe,ye=_e[de],Ie=R[Number(ye)];Ie!=null&&(oe=pe[ye],delete pe[ye],pe[Ie]=oe)}throw new Li("".concat(g.name,".bulkUpdate(): ").concat(fe," of ").concat(ge," operations failed"),pe)})})})},V.prototype.bulkDelete=function(h){var g=this,b=h.length;return this._trans("readwrite",function(T){return g.core.mutate({trans:T,type:"delete",keys:h})}).then(function(K){var k=K.numFailures,R=K.lastResult,K=K.failures;if(k===0)return R;throw new Li("".concat(g.name,".bulkDelete(): ").concat(k," of ").concat(b," operations failed"),K)})},V);function V(){}function Ne(h){function g(K,te){if(te){for(var le=arguments.length,he=new Array(le-1);--le;)he[le-1]=arguments[le];return b[K].subscribe.apply(null,he),h}if(typeof K=="string")return b[K]}var b={};g.addEventType=R;for(var T=1,k=arguments.length;T<k;++T)R(arguments[T]);return g;function R(K,te,le){if(typeof K!="object"){var he;te=te||Jo;var ge={subscribers:[],fire:le=le||qt,subscribe:function(ie){ge.subscribers.indexOf(ie)===-1&&(ge.subscribers.push(ie),ge.fire=te(ge.fire,ie))},unsubscribe:function(ie){ge.subscribers=ge.subscribers.filter(function(fe){return fe!==ie}),ge.fire=ge.subscribers.reduce(te,le)}};return b[K]=g[K]=ge}l(he=K).forEach(function(ie){var fe=he[ie];if(ur(fe))R(ie,he[ie][0],he[ie][1]);else{if(fe!=="asap")throw new Ke.InvalidArgument("Invalid event config");var pe=R(ie,Wt,function(){for(var de=arguments.length,_e=new Array(de);de--;)_e[de]=arguments[de];pe.subscribers.forEach(function(oe){Vr(function(){oe.apply(null,_e)})})})}})}}function Ge(h,g){return Or(g).from({prototype:h}),g}function Ve(h,g){return!(h.filter||h.algorithm||h.or)&&(g?h.justLimit:!h.replayFilter)}function Le(h,g){h.filter=Zt(h.filter,g)}function st(h,g,b){var T=h.replayFilter;h.replayFilter=T?function(){return Zt(T(),g())}:g,h.justLimit=b&&!T}function At(h,g){if(h.isPrimKey)return g.primaryKey;var b=g.getIndexByKeyPath(h.index);if(!b)throw new Ke.Schema("KeyPath "+h.index+" on object store "+g.name+" is not indexed");return b}function er(h,g,b){var T=At(h,g.schema);return g.openCursor({trans:b,values:!h.keysOnly,reverse:h.dir==="prev",unique:!!h.unique,query:{index:T,range:h.range}})}function Tn(h,g,b,T){var k=h.replayFilter?Zt(h.filter,h.replayFilter()):h.filter;if(h.or){var R={},K=function(te,le,he){var ge,ie;k&&!k(le,he,function(fe){return le.stop(fe)},function(fe){return le.fail(fe)})||((ie=""+(ge=le.primaryKey))=="[object ArrayBuffer]"&&(ie=""+new Uint8Array(ge)),Gr(R,ie)||(R[ie]=!0,g(te,le,he)))};return Promise.all([h.or._iterate(K,b),Dr(er(h,T,b),h.algorithm,K,!h.keysOnly&&h.valueMapper)])}return Dr(er(h,T,b),Zt(h.algorithm,k),g,!h.keysOnly&&h.valueMapper)}function Dr(h,g,b,T){var k=$(T?function(R,K,te){return b(T(R),K,te)}:b);return h.then(function(R){if(R)return R.start(function(){var K=function(){return R.continue()};g&&!g(R,function(te){return K=te},function(te){R.stop(te),K=qt},function(te){R.fail(te),K=qt})||k(R.value,R,function(te){return K=te}),K()})})}var Fe=(yt.prototype.execute=function(h){var g=this["@@propmod"];if(g.add!==void 0){var b=g.add;if(ur(b))return lr(lr([],ur(h)?h:[],!0),b).sort();if(typeof b=="number")return(Number(h)||0)+b;if(typeof b=="bigint")try{return BigInt(h)+b}catch{return BigInt(0)+b}throw new TypeError("Invalid term ".concat(b))}if(g.remove!==void 0){var T=g.remove;if(ur(T))return ur(h)?h.filter(function(k){return!T.includes(k)}).sort():[];if(typeof T=="number")return Number(h)-T;if(typeof T=="bigint")try{return BigInt(h)-T}catch{return BigInt(0)-T}throw new TypeError("Invalid subtrahend ".concat(T))}return b=(b=g.replacePrefix)===null||b===void 0?void 0:b[0],b&&typeof h=="string"&&h.startsWith(b)?g.replacePrefix[1]+h.substring(b.length):h},yt);function yt(h){this["@@propmod"]=h}var Kt=(Dt.prototype._read=function(h,g){var b=this._ctx;return b.error?b.table._trans(null,Nt.bind(null,b.error)):b.table._trans("readonly",h).then(g)},Dt.prototype._write=function(h){var g=this._ctx;return g.error?g.table._trans(null,Nt.bind(null,g.error)):g.table._trans("readwrite",h,"locked")},Dt.prototype._addAlgorithm=function(h){var g=this._ctx;g.algorithm=Zt(g.algorithm,h)},Dt.prototype._iterate=function(h,g){return Tn(this._ctx,h,g,this._ctx.table.core)},Dt.prototype.clone=function(h){var g=Object.create(this.constructor.prototype),b=Object.create(this._ctx);return h&&Oe(b,h),g._ctx=b,g},Dt.prototype.raw=function(){return this._ctx.valueMapper=null,this},Dt.prototype.each=function(h){var g=this._ctx;return this._read(function(b){return Tn(g,h,b,g.table.core)})},Dt.prototype.count=function(h){var g=this;return this._read(function(b){var T=g._ctx,k=T.table.core;if(Ve(T,!0))return k.count({trans:b,query:{index:At(T,k.schema),range:T.range}}).then(function(K){return Math.min(K,T.limit)});var R=0;return Tn(T,function(){return++R,!1},b,k).then(function(){return R})}).then(h)},Dt.prototype.sortBy=function(h,g){var b=h.split(".").reverse(),T=b[0],k=b.length-1;function R(le,he){return he?R(le[b[he]],he-1):le[T]}var K=this._ctx.dir==="next"?1:-1;function te(le,he){return E(R(le,k),R(he,k))*K}return this.toArray(function(le){return le.sort(te)}).then(g)},Dt.prototype.toArray=function(h){var g=this;return this._read(function(b){var T=g._ctx;if(T.dir==="next"&&Ve(T,!0)&&0<T.limit){var k=T.valueMapper,R=At(T,T.table.core.schema);return T.table.core.query({trans:b,limit:T.limit,values:!0,query:{index:R,range:T.range}}).then(function(te){return te=te.result,k?te.map(k):te})}var K=[];return Tn(T,function(te){return K.push(te)},b,T.table.core).then(function(){return K})},h)},Dt.prototype.offset=function(h){var g=this._ctx;return h<=0||(g.offset+=h,Ve(g)?st(g,function(){var b=h;return function(T,k){return b===0||(b===1?--b:k(function(){T.advance(b),b=0}),!1)}}):st(g,function(){var b=h;return function(){return--b<0}})),this},Dt.prototype.limit=function(h){return this._ctx.limit=Math.min(this._ctx.limit,h),st(this._ctx,function(){var g=h;return function(b,T,k){return--g<=0&&T(k),0<=g}},!0),this},Dt.prototype.until=function(h,g){return Le(this._ctx,function(b,T,k){return!h(b.value)||(T(k),g)}),this},Dt.prototype.first=function(h){return this.limit(1).toArray(function(g){return g[0]}).then(h)},Dt.prototype.last=function(h){return this.reverse().first(h)},Dt.prototype.filter=function(h){var g;return Le(this._ctx,function(b){return h(b.value)}),(g=this._ctx).isMatch=Zt(g.isMatch,h),this},Dt.prototype.and=function(h){return this.filter(h)},Dt.prototype.or=function(h){return new this.db.WhereClause(this._ctx.table,h,this)},Dt.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},Dt.prototype.desc=function(){return this.reverse()},Dt.prototype.eachKey=function(h){var g=this._ctx;return g.keysOnly=!g.isMatch,this.each(function(b,T){h(T.key,T)})},Dt.prototype.eachUniqueKey=function(h){return this._ctx.unique="unique",this.eachKey(h)},Dt.prototype.eachPrimaryKey=function(h){var g=this._ctx;return g.keysOnly=!g.isMatch,this.each(function(b,T){h(T.primaryKey,T)})},Dt.prototype.keys=function(h){var g=this._ctx;g.keysOnly=!g.isMatch;var b=[];return this.each(function(T,k){b.push(k.key)}).then(function(){return b}).then(h)},Dt.prototype.primaryKeys=function(h){var g=this._ctx;if(g.dir==="next"&&Ve(g,!0)&&0<g.limit)return this._read(function(T){var k=At(g,g.table.core.schema);return g.table.core.query({trans:T,values:!1,limit:g.limit,query:{index:k,range:g.range}})}).then(function(T){return T.result}).then(h);g.keysOnly=!g.isMatch;var b=[];return this.each(function(T,k){b.push(k.primaryKey)}).then(function(){return b}).then(h)},Dt.prototype.uniqueKeys=function(h){return this._ctx.unique="unique",this.keys(h)},Dt.prototype.firstKey=function(h){return this.limit(1).keys(function(g){return g[0]}).then(h)},Dt.prototype.lastKey=function(h){return this.reverse().firstKey(h)},Dt.prototype.distinct=function(){var h=this._ctx,h=h.index&&h.table.schema.idxByName[h.index];if(!h||!h.multi)return this;var g={};return Le(this._ctx,function(k){var T=k.primaryKey.toString(),k=Gr(g,T);return g[T]=!0,!k}),this},Dt.prototype.modify=function(h){var g=this,b=this._ctx;return this._write(function(T){var k,R,K;K=typeof h=="function"?h:(k=l(h),R=k.length,function(oe){for(var ye=!1,Ie=0;Ie<R;++Ie){var Pe=k[Ie],De=h[Pe],$e=Un(oe,Pe);De instanceof Fe?(Qr(oe,Pe,De.execute($e)),ye=!0):$e!==De&&(Qr(oe,Pe,De),ye=!0)}return ye});var te=b.table.core,ie=te.schema.primaryKey,le=ie.outbound,he=ie.extractKey,ge=200,ie=g.db._options.modifyChunkSize;ie&&(ge=typeof ie=="object"?ie[te.name]||ie["*"]||200:ie);function fe(oe,Pe){var Ie=Pe.failures,Pe=Pe.numFailures;de+=oe-Pe;for(var De=0,$e=l(Ie);De<$e.length;De++){var ht=$e[De];pe.push(Ie[ht])}}var pe=[],de=0,_e=[];return g.clone().primaryKeys().then(function(oe){function ye(Pe){var De=Math.min(ge,oe.length-Pe);return te.getMany({trans:T,keys:oe.slice(Pe,Pe+De),cache:"immutable"}).then(function($e){for(var ht=[],tt=[],rt=le?[]:null,ft=[],nt=0;nt<De;++nt){var at=$e[nt],$t={value:Sr(at),primKey:oe[Pe+nt]};K.call($t,$t.value,$t)!==!1&&($t.value==null?ft.push(oe[Pe+nt]):le||E(he(at),he($t.value))===0?(tt.push($t.value),le&&rt.push(oe[Pe+nt])):(ft.push(oe[Pe+nt]),ht.push($t.value)))}return Promise.resolve(0<ht.length&&te.mutate({trans:T,type:"add",values:ht}).then(function(hr){for(var Pt in hr.failures)ft.splice(parseInt(Pt),1);fe(ht.length,hr)})).then(function(){return(0<tt.length||Ie&&typeof h=="object")&&te.mutate({trans:T,type:"put",keys:rt,values:tt,criteria:Ie,changeSpec:typeof h!="function"&&h,isAdditionalChunk:0<Pe}).then(function(hr){return fe(tt.length,hr)})}).then(function(){return(0<ft.length||Ie&&h===jr)&&te.mutate({trans:T,type:"delete",keys:ft,criteria:Ie,isAdditionalChunk:0<Pe}).then(function(hr){return fe(ft.length,hr)})}).then(function(){return oe.length>Pe+De&&ye(Pe+ge)})})}var Ie=Ve(b)&&b.limit===1/0&&(typeof h!="function"||h===jr)&&{index:b.index,range:b.range};return ye(0).then(function(){if(0<pe.length)throw new bi("Error modifying one or more objects",pe,de,_e);return oe.length})})})},Dt.prototype.delete=function(){var h=this._ctx,g=h.range;return Ve(h)&&(h.isPrimKey||g.type===3)?this._write(function(b){var T=h.table.core.schema.primaryKey,k=g;return h.table.core.count({trans:b,query:{index:T,range:k}}).then(function(R){return h.table.core.mutate({trans:b,type:"deleteRange",range:k}).then(function(K){var te=K.failures;if(K.lastResult,K.results,K=K.numFailures,K)throw new bi("Could not delete some values",Object.keys(te).map(function(le){return te[le]}),R-K);return R-K})})}):this.modify(jr)},Dt);function Dt(){}var jr=function(h,g){return g.value=null};function Ui(h,g){return h<g?-1:h===g?0:1}function Ka(h,g){return g<h?-1:h===g?0:1}function ln(h,g,b){return h=h instanceof hs?new h.Collection(h):h,h._ctx.error=new(b||TypeError)(g),h}function Fo(h){return new h.Collection(h,function(){return Bs("")}).limit(0)}function Xa(h,g,b,T){var k,R,K,te,le,he,ge,ie=b.length;if(!b.every(function(de){return typeof de=="string"}))return ln(h,rr);function fe(de){k=de==="next"?function(oe){return oe.toUpperCase()}:function(oe){return oe.toLowerCase()},R=de==="next"?function(oe){return oe.toLowerCase()}:function(oe){return oe.toUpperCase()},K=de==="next"?Ui:Ka;var _e=b.map(function(oe){return{lower:R(oe),upper:k(oe)}}).sort(function(oe,ye){return K(oe.lower,ye.lower)});te=_e.map(function(oe){return oe.upper}),le=_e.map(function(oe){return oe.lower}),ge=(he=de)==="next"?"":T}fe("next"),h=new h.Collection(h,function(){return bo(te[0],le[ie-1]+T)}),h._ondirectionchange=function(de){fe(de)};var pe=0;return h._addAlgorithm(function(de,_e,oe){var ye=de.key;if(typeof ye!="string")return!1;var Ie=R(ye);if(g(Ie,le,pe))return!0;for(var Pe=null,De=pe;De<ie;++De){var $e=function(ht,tt,rt,ft,nt,at){for(var $t=Math.min(ht.length,ft.length),hr=-1,Pt=0;Pt<$t;++Pt){var Qe=tt[Pt];if(Qe!==ft[Pt])return nt(ht[Pt],rt[Pt])<0?ht.substr(0,Pt)+rt[Pt]+rt.substr(Pt+1):nt(ht[Pt],ft[Pt])<0?ht.substr(0,Pt)+ft[Pt]+rt.substr(Pt+1):0<=hr?ht.substr(0,hr)+tt[hr]+rt.substr(hr+1):null;nt(ht[Pt],Qe)<0&&(hr=Pt)}return $t<ft.length&&at==="next"?ht+rt.substr(ht.length):$t<ht.length&&at==="prev"?ht.substr(0,rt.length):hr<0?null:ht.substr(0,hr)+ft[hr]+rt.substr(hr+1)}(ye,Ie,te[De],le[De],K,he);$e===null&&Pe===null?pe=De+1:(Pe===null||0<K(Pe,$e))&&(Pe=$e)}return _e(Pe!==null?function(){de.continue(Pe+ge)}:oe),!1}),h}function bo(h,g,b,T){return{type:2,lower:h,upper:g,lowerOpen:b,upperOpen:T}}function Bs(h){return{type:1,lower:h,upper:h}}var hs=(Object.defineProperty(In.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),In.prototype.between=function(h,g,b,T){b=b!==!1,T=T===!0;try{return 0<this._cmp(h,g)||this._cmp(h,g)===0&&(b||T)&&(!b||!T)?Fo(this):new this.Collection(this,function(){return bo(h,g,!b,!T)})}catch{return ln(this,Ht)}},In.prototype.equals=function(h){return h==null?ln(this,Ht):new this.Collection(this,function(){return Bs(h)})},In.prototype.above=function(h){return h==null?ln(this,Ht):new this.Collection(this,function(){return bo(h,void 0,!0)})},In.prototype.aboveOrEqual=function(h){return h==null?ln(this,Ht):new this.Collection(this,function(){return bo(h,void 0,!1)})},In.prototype.below=function(h){return h==null?ln(this,Ht):new this.Collection(this,function(){return bo(void 0,h,!1,!0)})},In.prototype.belowOrEqual=function(h){return h==null?ln(this,Ht):new this.Collection(this,function(){return bo(void 0,h)})},In.prototype.startsWith=function(h){return typeof h!="string"?ln(this,rr):this.between(h,h+Ut,!0,!0)},In.prototype.startsWithIgnoreCase=function(h){return h===""?this.startsWith(h):Xa(this,function(g,b){return g.indexOf(b[0])===0},[h],Ut)},In.prototype.equalsIgnoreCase=function(h){return Xa(this,function(g,b){return g===b[0]},[h],"")},In.prototype.anyOfIgnoreCase=function(){var h=Mn.apply(xi,arguments);return h.length===0?Fo(this):Xa(this,function(g,b){return b.indexOf(g)!==-1},h,"")},In.prototype.startsWithAnyOfIgnoreCase=function(){var h=Mn.apply(xi,arguments);return h.length===0?Fo(this):Xa(this,function(g,b){return b.some(function(T){return g.indexOf(T)===0})},h,Ut)},In.prototype.anyOf=function(){var h=this,g=Mn.apply(xi,arguments),b=this._cmp;try{g.sort(b)}catch{return ln(this,Ht)}if(g.length===0)return Fo(this);var T=new this.Collection(this,function(){return bo(g[0],g[g.length-1])});T._ondirectionchange=function(R){b=R==="next"?h._ascending:h._descending,g.sort(b)};var k=0;return T._addAlgorithm(function(R,K,te){for(var le=R.key;0<b(le,g[k]);)if(++k===g.length)return K(te),!1;return b(le,g[k])===0||(K(function(){R.continue(g[k])}),!1)}),T},In.prototype.notEqual=function(h){return this.inAnyRange([[-1/0,h],[h,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},In.prototype.noneOf=function(){var h=Mn.apply(xi,arguments);if(h.length===0)return new this.Collection(this);try{h.sort(this._ascending)}catch{return ln(this,Ht)}var g=h.reduce(function(b,T){return b?b.concat([[b[b.length-1][1],T]]):[[-1/0,T]]},null);return g.push([h[h.length-1],this.db._maxKey]),this.inAnyRange(g,{includeLowers:!1,includeUppers:!1})},In.prototype.inAnyRange=function(ye,g){var b=this,T=this._cmp,k=this._ascending,R=this._descending,K=this._min,te=this._max;if(ye.length===0)return Fo(this);if(!ye.every(function(Ie){return Ie[0]!==void 0&&Ie[1]!==void 0&&k(Ie[0],Ie[1])<=0}))return ln(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",Ke.InvalidArgument);var le=!g||g.includeLowers!==!1,he=g&&g.includeUppers===!0,ge,ie=k;function fe(Ie,Pe){return ie(Ie[0],Pe[0])}try{(ge=ye.reduce(function(Ie,Pe){for(var De=0,$e=Ie.length;De<$e;++De){var ht=Ie[De];if(T(Pe[0],ht[1])<0&&0<T(Pe[1],ht[0])){ht[0]=K(ht[0],Pe[0]),ht[1]=te(ht[1],Pe[1]);break}}return De===$e&&Ie.push(Pe),Ie},[])).sort(fe)}catch{return ln(this,Ht)}var pe=0,de=he?function(Ie){return 0<k(Ie,ge[pe][1])}:function(Ie){return 0<=k(Ie,ge[pe][1])},_e=le?function(Ie){return 0<R(Ie,ge[pe][0])}:function(Ie){return 0<=R(Ie,ge[pe][0])},oe=de,ye=new this.Collection(this,function(){return bo(ge[0][0],ge[ge.length-1][1],!le,!he)});return ye._ondirectionchange=function(Ie){ie=Ie==="next"?(oe=de,k):(oe=_e,R),ge.sort(fe)},ye._addAlgorithm(function(Ie,Pe,De){for(var $e,ht=Ie.key;oe(ht);)if(++pe===ge.length)return Pe(De),!1;return!de($e=ht)&&!_e($e)||(b._cmp(ht,ge[pe][1])===0||b._cmp(ht,ge[pe][0])===0||Pe(function(){ie===k?Ie.continue(ge[pe][0]):Ie.continue(ge[pe][1])}),!1)}),ye},In.prototype.startsWithAnyOf=function(){var h=Mn.apply(xi,arguments);return h.every(function(g){return typeof g=="string"})?h.length===0?Fo(this):this.inAnyRange(h.map(function(g){return[g,g+Ut]})):ln(this,"startsWithAnyOf() only works with strings")},In);function In(){}function ri(h){return $(function(g){return Yo(g),h(g.target.error),!1})}function Yo(h){h.stopPropagation&&h.stopPropagation(),h.preventDefault&&h.preventDefault()}var wo="storagemutated",Wa="x-storagemutated-1",Yi=Ne(null,wo),Vi=(jn.prototype._lock=function(){return Rr(!bt.global),++this._reculock,this._reculock!==1||bt.global||(bt.lockOwnerFor=this),this},jn.prototype._unlock=function(){if(Rr(!bt.global),--this._reculock==0)for(bt.global||(bt.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var h=this._blockedFuncs.shift();try{Bt(h[1],h[0])}catch{}}return this},jn.prototype._locked=function(){return this._reculock&&bt.lockOwnerFor!==this},jn.prototype.create=function(h){var g=this;if(!this.mode)return this;var b=this.db.idbdb,T=this.db._state.dbOpenError;if(Rr(!this.idbtrans),!h&&!b)switch(T&&T.name){case"DatabaseClosedError":throw new Ke.DatabaseClosed(T);case"MissingAPIError":throw new Ke.MissingAPI(T.message,T);default:throw new Ke.OpenFailed(T)}if(!this.active)throw new Ke.TransactionInactive;return Rr(this._completion._state===null),(h=this.idbtrans=h||(this.db.core||b).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=$(function(k){Yo(k),g._reject(h.error)}),h.onabort=$(function(k){Yo(k),g.active&&g._reject(new Ke.Abort(h.error)),g.active=!1,g.on("abort").fire(k)}),h.oncomplete=$(function(){g.active=!1,g._resolve(),"mutatedParts"in h&&Yi.storagemutated.fire(h.mutatedParts)}),this},jn.prototype._promise=function(h,g,b){var T=this;if(h==="readwrite"&&this.mode!=="readwrite")return Nt(new Ke.ReadOnly("Transaction is readonly"));if(!this.active)return Nt(new Ke.TransactionInactive);if(this._locked())return new pt(function(R,K){T._blockedFuncs.push([function(){T._promise(h,g,b).then(R,K)},bt])});if(b)return ke(function(){var R=new pt(function(K,te){T._lock();var le=g(K,te,T);le&&le.then&&le.then(K,te)});return R.finally(function(){return T._unlock()}),R._lib=!0,R});var k=new pt(function(R,K){var te=g(R,K,T);te&&te.then&&te.then(R,K)});return k._lib=!0,k},jn.prototype._root=function(){return this.parent?this.parent._root():this},jn.prototype.waitFor=function(h){var g,b=this._root(),T=pt.resolve(h);b._waitingFor?b._waitingFor=b._waitingFor.then(function(){return T}):(b._waitingFor=T,b._waitingQueue=[],g=b.idbtrans.objectStore(b.storeNames[0]),function R(){for(++b._spinCount;b._waitingQueue.length;)b._waitingQueue.shift()();b._waitingFor&&(g.get(-1/0).onsuccess=R)}());var k=b._waitingFor;return new pt(function(R,K){T.then(function(te){return b._waitingQueue.push($(R.bind(null,te)))},function(te){return b._waitingQueue.push($(K.bind(null,te)))}).finally(function(){b._waitingFor===k&&(b._waitingFor=null)})})},jn.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new Ke.Abort))},jn.prototype.table=function(h){var g=this._memoizedTables||(this._memoizedTables={});if(Gr(g,h))return g[h];var b=this.schema[h];if(!b)throw new Ke.NotFound("Table "+h+" not part of transaction");return b=new this.db.Table(h,b,this),b.core=this.db.core.table(h),g[h]=b},jn);function jn(){}function io(h,g,b,T,k,R,K){return{name:h,keyPath:g,unique:b,multi:T,auto:k,compound:R,src:(b&&!K?"&":"")+(T?"*":"")+(k?"++":"")+No(g)}}function No(h){return typeof h=="string"?h:h?"["+[].join.call(h,"+")+"]":""}function oo(h,g,b){return{name:h,primKey:g,indexes:b,mappedClass:null,idxByName:(T=function(k){return[k.name,k]},b.reduce(function(k,R,K){return K=T(R,K),K&&(k[K[0]]=K[1]),k},{}))};var T}var ji=function(h){try{return h.only([[]]),ji=function(){return[[]]},[[]]}catch{return ji=function(){return Ut},Ut}};function aa(h){return h==null?function(){}:typeof h=="string"?(g=h).split(".").length===1?function(b){return b[g]}:function(b){return Un(b,g)}:function(b){return Un(b,h)};var g}function ni(h){return[].slice.call(h)}var en=0;function ao(h){return h==null?":id":typeof h=="string"?h:"[".concat(h.join("+"),"]")}function Fs(h,g,le){function T(oe){if(oe.type===3)return null;if(oe.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var pe=oe.lower,de=oe.upper,_e=oe.lowerOpen,oe=oe.upperOpen;return pe===void 0?de===void 0?null:g.upperBound(de,!!oe):de===void 0?g.lowerBound(pe,!!_e):g.bound(pe,de,!!_e,!!oe)}function k(fe){var pe,de=fe.name;return{name:de,schema:fe,mutate:function(_e){var oe=_e.trans,ye=_e.type,Ie=_e.keys,Pe=_e.values,De=_e.range;return new Promise(function($e,ht){$e=$($e);var tt=oe.objectStore(de),rt=tt.keyPath==null,ft=ye==="put"||ye==="add";if(!ft&&ye!=="delete"&&ye!=="deleteRange")throw new Error("Invalid operation type: "+ye);var nt,at=(Ie||Pe||{length:1}).length;if(Ie&&Pe&&Ie.length!==Pe.length)throw new Error("Given keys array must have same length as given values array.");if(at===0)return $e({numFailures:0,failures:{},results:[],lastResult:void 0});function $t(Lr){++Qe,Yo(Lr)}var hr=[],Pt=[],Qe=0;if(ye==="deleteRange"){if(De.type===4)return $e({numFailures:Qe,failures:Pt,results:[],lastResult:void 0});De.type===3?hr.push(nt=tt.clear()):hr.push(nt=tt.delete(T(De)))}else{var rt=ft?rt?[Pe,Ie]:[Pe,null]:[Ie,null],Lt=rt[0],Cn=rt[1];if(ft)for(var pn=0;pn<at;++pn)hr.push(nt=Cn&&Cn[pn]!==void 0?tt[ye](Lt[pn],Cn[pn]):tt[ye](Lt[pn])),nt.onerror=$t;else for(pn=0;pn<at;++pn)hr.push(nt=tt[ye](Lt[pn])),nt.onerror=$t}function pi(Lr){Lr=Lr.target.result,hr.forEach(function(zo,He){return zo.error!=null&&(Pt[He]=zo.error)}),$e({numFailures:Qe,failures:Pt,results:ye==="delete"?Ie:hr.map(function(zo){return zo.result}),lastResult:Lr})}nt.onerror=function(Lr){$t(Lr),pi(Lr)},nt.onsuccess=pi})},getMany:function(_e){var oe=_e.trans,ye=_e.keys;return new Promise(function(Ie,Pe){Ie=$(Ie);for(var De,$e=oe.objectStore(de),ht=ye.length,tt=new Array(ht),rt=0,ft=0,nt=function(hr){hr=hr.target,tt[hr._pos]=hr.result,++ft===rt&&Ie(tt)},at=ri(Pe),$t=0;$t<ht;++$t)ye[$t]!=null&&((De=$e.get(ye[$t]))._pos=$t,De.onsuccess=nt,De.onerror=at,++rt);rt===0&&Ie(tt)})},get:function(_e){var oe=_e.trans,ye=_e.key;return new Promise(function(Ie,Pe){Ie=$(Ie);var De=oe.objectStore(de).get(ye);De.onsuccess=function($e){return Ie($e.target.result)},De.onerror=ri(Pe)})},query:(pe=he,function(_e){return new Promise(function(oe,ye){oe=$(oe);var Ie,Pe,De,rt=_e.trans,$e=_e.values,ht=_e.limit,nt=_e.query,tt=ht===1/0?void 0:ht,ft=nt.index,nt=nt.range,rt=rt.objectStore(de),ft=ft.isPrimaryKey?rt:rt.index(ft.name),nt=T(nt);if(ht===0)return oe({result:[]});pe?((tt=$e?ft.getAll(nt,tt):ft.getAllKeys(nt,tt)).onsuccess=function(at){return oe({result:at.target.result})},tt.onerror=ri(ye)):(Ie=0,Pe=!$e&&"openKeyCursor"in ft?ft.openKeyCursor(nt):ft.openCursor(nt),De=[],Pe.onsuccess=function(at){var $t=Pe.result;return $t?(De.push($e?$t.value:$t.primaryKey),++Ie===ht?oe({result:De}):void $t.continue()):oe({result:De})},Pe.onerror=ri(ye))})}),openCursor:function(_e){var oe=_e.trans,ye=_e.values,Ie=_e.query,Pe=_e.reverse,De=_e.unique;return new Promise(function($e,ht){$e=$($e);var ft=Ie.index,tt=Ie.range,rt=oe.objectStore(de),rt=ft.isPrimaryKey?rt:rt.index(ft.name),ft=Pe?De?"prevunique":"prev":De?"nextunique":"next",nt=!ye&&"openKeyCursor"in rt?rt.openKeyCursor(T(tt),ft):rt.openCursor(T(tt),ft);nt.onerror=ri(ht),nt.onsuccess=$(function(at){var $t,hr,Pt,Qe,Lt=nt.result;Lt?(Lt.___id=++en,Lt.done=!1,$t=Lt.continue.bind(Lt),hr=(hr=Lt.continuePrimaryKey)&&hr.bind(Lt),Pt=Lt.advance.bind(Lt),Qe=function(){throw new Error("Cursor not stopped")},Lt.trans=oe,Lt.stop=Lt.continue=Lt.continuePrimaryKey=Lt.advance=function(){throw new Error("Cursor not started")},Lt.fail=$(ht),Lt.next=function(){var Cn=this,pn=1;return this.start(function(){return pn--?Cn.continue():Cn.stop()}).then(function(){return Cn})},Lt.start=function(Cn){function pn(){if(nt.result)try{Cn()}catch(Lr){Lt.fail(Lr)}else Lt.done=!0,Lt.start=function(){throw new Error("Cursor behind last entry")},Lt.stop()}var pi=new Promise(function(Lr,zo){Lr=$(Lr),nt.onerror=ri(zo),Lt.fail=zo,Lt.stop=function(He){Lt.stop=Lt.continue=Lt.continuePrimaryKey=Lt.advance=Qe,Lr(He)}});return nt.onsuccess=$(function(Lr){nt.onsuccess=pn,pn()}),Lt.continue=$t,Lt.continuePrimaryKey=hr,Lt.advance=Pt,pn(),pi},$e(Lt)):$e(null)},ht)})},count:function(_e){var oe=_e.query,ye=_e.trans,Ie=oe.index,Pe=oe.range;return new Promise(function(De,$e){var ht=ye.objectStore(de),tt=Ie.isPrimaryKey?ht:ht.index(Ie.name),ht=T(Pe),tt=ht?tt.count(ht):tt.count();tt.onsuccess=$(function(rt){return De(rt.target.result)}),tt.onerror=ri($e)})}}}var R,K,te,ge=(K=le,te=ni((R=h).objectStoreNames),{schema:{name:R.name,tables:te.map(function(fe){return K.objectStore(fe)}).map(function(fe){var pe=fe.keyPath,oe=fe.autoIncrement,de=ur(pe),_e={},oe={name:fe.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:pe==null,compound:de,keyPath:pe,autoIncrement:oe,unique:!0,extractKey:aa(pe)},indexes:ni(fe.indexNames).map(function(ye){return fe.index(ye)}).map(function(De){var Ie=De.name,Pe=De.unique,$e=De.multiEntry,De=De.keyPath,$e={name:Ie,compound:ur(De),keyPath:De,unique:Pe,multiEntry:$e,extractKey:aa(De)};return _e[ao(De)]=$e}),getIndexByKeyPath:function(ye){return _e[ao(ye)]}};return _e[":id"]=oe.primaryKey,pe!=null&&(_e[ao(pe)]=oe.primaryKey),oe})},hasGetAll:0<te.length&&"getAll"in K.objectStore(te[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),le=ge.schema,he=ge.hasGetAll,ge=le.tables.map(k),ie={};return ge.forEach(function(fe){return ie[fe.name]=fe}),{stack:"dbcore",transaction:h.transaction.bind(h),table:function(fe){if(!ie[fe])throw new Error("Table '".concat(fe,"' not found"));return ie[fe]},MIN_KEY:-1/0,MAX_KEY:ji(g),schema:le}}function Au(h,g,b,T){var k=b.IDBKeyRange;return b.indexedDB,{dbcore:(T=Fs(g,k,T),h.dbcore.reduce(function(R,K){return K=K.create,mt(mt({},R),K(R))},T))}}function Ha(h,T){var b=T.db,T=Au(h._middlewares,b,h._deps,T);h.core=T.dbcore,h.tables.forEach(function(k){var R=k.name;h.core.schema.tables.some(function(K){return K.name===R})&&(k.core=h.core.table(R),h[R]instanceof h.Table&&(h[R].core=k.core))})}function sa(h,g,b,T){b.forEach(function(k){var R=T[k];g.forEach(function(K){var te=function le(he,ge){return _t(he,ge)||(he=Ur(he))&&le(he,ge)}(K,k);(!te||"value"in te&&te.value===void 0)&&(K===h.Transaction.prototype||K instanceof h.Transaction?nr(K,k,{get:function(){return this.table(k)},set:function(le){Nn(this,k,{value:le,writable:!0,configurable:!0,enumerable:!0})}}):K[k]=new h.Table(k,R))})})}function Ia(h,g){g.forEach(function(b){for(var T in b)b[T]instanceof h.Table&&delete b[T]})}function fs(h,g){return h._cfg.version-g._cfg.version}function ds(h,g,b,T){var k=h._dbSchema;b.objectStoreNames.contains("$meta")&&!k.$meta&&(k.$meta=oo("$meta",Ya("")[0],[]),h._storeNames.push("$meta"));var R=h._createTransaction("readwrite",h._storeNames,k);R.create(b),R._completion.catch(T);var K=R._reject.bind(R),te=bt.transless||bt;ke(function(){return bt.trans=R,bt.transless=te,g!==0?(Ha(h,b),he=g,((le=R).storeNames.includes("$meta")?le.table("$meta").get("version").then(function(ge){return ge??he}):pt.resolve(he)).then(function(ge){return fe=ge,pe=R,de=b,_e=[],ge=(ie=h)._versions,oe=ie._dbSchema=Ca(0,ie.idbdb,de),(ge=ge.filter(function(ye){return ye._cfg.version>=fe})).length!==0?(ge.forEach(function(ye){_e.push(function(){var Ie=oe,Pe=ye._cfg.dbschema;cn(ie,Ie,de),cn(ie,Pe,de),oe=ie._dbSchema=Pe;var De=Ja(Ie,Pe);De.add.forEach(function(ft){ms(de,ft[0],ft[1].primKey,ft[1].indexes)}),De.change.forEach(function(ft){if(ft.recreate)throw new Ke.Upgrade("Not yet support for changing primary key");var nt=de.objectStore(ft.name);ft.add.forEach(function(at){return Uo(nt,at)}),ft.change.forEach(function(at){nt.deleteIndex(at.name),Uo(nt,at)}),ft.del.forEach(function(at){return nt.deleteIndex(at)})});var $e=ye._cfg.contentUpgrade;if($e&&ye._cfg.version>fe){Ha(ie,de),pe._memoizedTables={};var ht=zi(Pe);De.del.forEach(function(ft){ht[ft]=Ie[ft]}),Ia(ie,[ie.Transaction.prototype]),sa(ie,[ie.Transaction.prototype],l(ht),ht),pe.schema=ht;var tt,rt=$n($e);return rt&&ot(),De=pt.follow(function(){var ft;(tt=$e(pe))&&rt&&(ft=We.bind(null,null),tt.then(ft,ft))}),tt&&typeof tt.then=="function"?pt.resolve(tt):De.then(function(){return tt})}}),_e.push(function(Ie){var Pe,De,$e=ye._cfg.dbschema;Pe=$e,De=Ie,[].slice.call(De.db.objectStoreNames).forEach(function(ht){return Pe[ht]==null&&De.db.deleteObjectStore(ht)}),Ia(ie,[ie.Transaction.prototype]),sa(ie,[ie.Transaction.prototype],ie._storeNames,ie._dbSchema),pe.schema=ie._dbSchema}),_e.push(function(Ie){ie.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(ie.idbdb.version/10)===ye._cfg.version?(ie.idbdb.deleteObjectStore("$meta"),delete ie._dbSchema.$meta,ie._storeNames=ie._storeNames.filter(function(Pe){return Pe!=="$meta"})):Ie.objectStore("$meta").put(ye._cfg.version,"version"))})}),function ye(){return _e.length?pt.resolve(_e.shift()(pe.idbtrans)).then(ye):pt.resolve()}().then(function(){ua(oe,de)})):pt.resolve();var ie,fe,pe,de,_e,oe}).catch(K)):(l(k).forEach(function(ge){ms(b,ge,k[ge].primKey,k[ge].indexes)}),Ha(h,b),void pt.follow(function(){return h.on.populate.fire(R)}).catch(K));var le,he})}function Ns(h,g){ua(h._dbSchema,g),g.db.version%10!=0||g.objectStoreNames.contains("$meta")||g.db.createObjectStore("$meta").add(Math.ceil(g.db.version/10-1),"version");var b=Ca(0,h.idbdb,g);cn(h,h._dbSchema,g);for(var T=0,k=Ja(b,h._dbSchema).change;T<k.length;T++){var R=function(K){if(K.change.length||K.recreate)return console.warn("Unable to patch indexes of table ".concat(K.name," because it has changes on the type of index or primary key.")),{value:void 0};var te=g.objectStore(K.name);K.add.forEach(function(le){zn&&console.debug("Dexie upgrade patch: Creating missing index ".concat(K.name,".").concat(le.src)),Uo(te,le)})}(k[T]);if(typeof R=="object")return R.value}}function Ja(h,g){var b,T={del:[],add:[],change:[]};for(b in h)g[b]||T.del.push(b);for(b in g){var k=h[b],R=g[b];if(k){var K={name:b,def:R,recreate:!1,del:[],add:[],change:[]};if(""+(k.primKey.keyPath||"")!=""+(R.primKey.keyPath||"")||k.primKey.auto!==R.primKey.auto)K.recreate=!0,T.change.push(K);else{var te=k.idxByName,le=R.idxByName,he=void 0;for(he in te)le[he]||K.del.push(he);for(he in le){var ge=te[he],ie=le[he];ge?ge.src!==ie.src&&K.change.push(ie):K.add.push(ie)}(0<K.del.length||0<K.add.length||0<K.change.length)&&T.change.push(K)}}else T.add.push([b,R])}return T}function ms(h,g,b,T){var k=h.db.createObjectStore(g,b.keyPath?{keyPath:b.keyPath,autoIncrement:b.auto}:{autoIncrement:b.auto});return T.forEach(function(R){return Uo(k,R)}),k}function ua(h,g){l(h).forEach(function(b){g.db.objectStoreNames.contains(b)||(zn&&console.debug("Dexie: Creating missing table",b),ms(g,b,h[b].primKey,h[b].indexes))})}function Uo(h,g){h.createIndex(g.name,g.keyPath,{unique:g.unique,multiEntry:g.multi})}function Ca(h,g,b){var T={};return dr(g.objectStoreNames,0).forEach(function(k){for(var R=b.objectStore(k),K=io(No(he=R.keyPath),he||"",!0,!1,!!R.autoIncrement,he&&typeof he!="string",!0),te=[],le=0;le<R.indexNames.length;++le){var ge=R.index(R.indexNames[le]),he=ge.keyPath,ge=io(ge.name,he,!!ge.unique,!!ge.multiEntry,!1,he&&typeof he!="string",!1);te.push(ge)}T[k]=oo(k,K,te)}),T}function cn(h,g,b){for(var T=b.db.objectStoreNames,k=0;k<T.length;++k){var R=T[k],K=b.objectStore(R);h._hasGetAll="getAll"in K;for(var te=0;te<K.indexNames.length;++te){var le=K.indexNames[te],he=K.index(le).keyPath,ge=typeof he=="string"?he:"["+dr(he).join("+")+"]";!g[R]||(he=g[R].idxByName[ge])&&(he.name=le,delete g[R].idxByName[ge],g[R].idxByName[le]=he)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&Cr.WorkerGlobalScope&&Cr instanceof Cr.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(h._hasGetAll=!1)}function Ya(h){return h.split(",").map(function(g,b){var T=(g=g.trim()).replace(/([&*]|\+\+)/g,""),k=/^\[/.test(T)?T.match(/^\[(.*)\]$/)[1].split("+"):T;return io(T,k||null,/\&/.test(g),/\*/.test(g),/\+\+/.test(g),ur(k),b===0)})}var Vo=($i.prototype._parseStoresSpec=function(h,g){l(h).forEach(function(b){if(h[b]!==null){var T=Ya(h[b]),k=T.shift();if(k.unique=!0,k.multi)throw new Ke.Schema("Primary key cannot be multi-valued");T.forEach(function(R){if(R.auto)throw new Ke.Schema("Only primary key can be marked as autoIncrement (++)");if(!R.keyPath)throw new Ke.Schema("Index must have a name and cannot be an empty string")}),g[b]=oo(b,k,T)}})},$i.prototype.stores=function(b){var g=this.db;this._cfg.storesSource=this._cfg.storesSource?Oe(this._cfg.storesSource,b):b;var b=g._versions,T={},k={};return b.forEach(function(R){Oe(T,R._cfg.storesSource),k=R._cfg.dbschema={},R._parseStoresSpec(T,k)}),g._dbSchema=k,Ia(g,[g._allTables,g,g.Transaction.prototype]),sa(g,[g._allTables,g,g.Transaction.prototype,this._cfg.tables],l(k),k),g._storeNames=l(k),this},$i.prototype.upgrade=function(h){return this._cfg.contentUpgrade=vn(this._cfg.contentUpgrade||qt,h),this},$i);function $i(){}function Eo(h,g){var b=h._dbNamesDB;return b||(b=h._dbNamesDB=new ci(cr,{addons:[],indexedDB:h,IDBKeyRange:g})).version(1).stores({dbnames:"name"}),b.table("dbnames")}function So(h){return h&&typeof h.databases=="function"}function so(h){return ke(function(){return bt.letThrough=!0,h()})}function To(h){return!("from"in h)}var tn=function(h,g){if(!this){var b=new tn;return h&&"d"in h&&Oe(b,h),b}Oe(this,arguments.length?{d:1,from:h,to:1<arguments.length?g:h}:{d:0})};function qi(h,g,b){var T=E(g,b);if(!isNaN(T)){if(0<T)throw RangeError();if(To(h))return Oe(h,{from:g,to:b,d:1});var k=h.l,T=h.r;if(E(b,h.from)<0)return k?qi(k,g,b):h.l={from:g,to:b,d:1,l:null,r:null},Us(h);if(0<E(g,h.to))return T?qi(T,g,b):h.r={from:g,to:b,d:1,l:null,r:null},Us(h);E(g,h.from)<0&&(h.from=g,h.l=null,h.d=T?T.d+1:1),0<E(b,h.to)&&(h.to=b,h.r=null,h.d=h.l?h.l.d+1:1),b=!h.r,k&&!h.l&&la(h,k),T&&b&&la(h,T)}}function la(h,g){To(g)||function b(T,le){var R=le.from,K=le.to,te=le.l,le=le.r;qi(T,R,K),te&&b(T,te),le&&b(T,le)}(h,g)}function ys(h,g){var b=wr(g),T=b.next();if(T.done)return!1;for(var k=T.value,R=wr(h),K=R.next(k.from),te=K.value;!T.done&&!K.done;){if(E(te.from,k.to)<=0&&0<=E(te.to,k.from))return!0;E(k.from,te.from)<0?k=(T=b.next(te.from)).value:te=(K=R.next(k.from)).value}return!1}function wr(h){var g=To(h)?null:{s:0,n:h};return{next:function(b){for(var T=0<arguments.length;g;)switch(g.s){case 0:if(g.s=1,T)for(;g.n.l&&E(b,g.n.from)<0;)g={up:g,n:g.n.l,s:1};else for(;g.n.l;)g={up:g,n:g.n.l,s:1};case 1:if(g.s=2,!T||E(b,g.n.to)<=0)return{value:g.n,done:!1};case 2:if(g.n.r){g.s=3,g={up:g,n:g.n.r,s:0};continue}case 3:g=g.up}return{done:!0}}}}function Us(h){var g,b,T=(((g=h.r)===null||g===void 0?void 0:g.d)||0)-(((b=h.l)===null||b===void 0?void 0:b.d)||0),k=1<T?"r":T<-1?"l":"";k&&(g=k=="r"?"l":"r",b=mt({},h),T=h[k],h.from=T.from,h.to=T.to,h[k]=T[k],b[k]=T[g],(h[g]=b).d=Aa(b)),h.d=Aa(h)}function Aa(b){var g=b.r,b=b.l;return(g?b?Math.max(g.d,b.d):g.d:b?b.d:0)+1}function Pa(h,g){return l(g).forEach(function(b){h[b]?la(h[b],g[b]):h[b]=function T(k){var R,K,te={};for(R in k)Gr(k,R)&&(K=k[R],te[R]=!K||typeof K!="object"||si.has(K.constructor)?K:T(K));return te}(g[b])}),h}function $a(h,g){return h.all||g.all||Object.keys(h).some(function(b){return g[b]&&ys(g[b],h[b])})}Xe(tn.prototype,((nn={add:function(h){return la(this,h),this},addKey:function(h){return qi(this,h,h),this},addKeys:function(h){var g=this;return h.forEach(function(b){return qi(g,b,b)}),this},hasKey:function(h){var g=wr(this).next(h).value;return g&&E(g.from,h)<=0&&0<=E(g.to,h)}})[yn]=function(){return wr(this)},nn));var jo={},Qa={},Io=!1;function Qi(h){Pa(Qa,h),Io||(Io=!0,setTimeout(function(){Io=!1,Co(Qa,!(Qa={}))},0))}function Co(h,g){g===void 0&&(g=!1);var b=new Set;if(h.all)for(var T=0,k=Object.values(jo);T<k.length;T++)gs(K=k[T],h,b,g);else for(var R in h){var K,te=/^idb\:\/\/(.*)\/(.*)\//.exec(R);te&&(R=te[1],te=te[2],(K=jo["idb://".concat(R,"/").concat(te)])&&gs(K,h,b,g))}b.forEach(function(le){return le()})}function gs(h,g,b,T){for(var k=[],R=0,K=Object.entries(h.queries.query);R<K.length;R++){for(var te=K[R],le=te[0],he=[],ge=0,ie=te[1];ge<ie.length;ge++){var fe=ie[ge];$a(g,fe.obsSet)?fe.subscribers.forEach(function(oe){return b.add(oe)}):T&&he.push(fe)}T&&k.push([le,he])}if(T)for(var pe=0,de=k;pe<de.length;pe++){var _e=de[pe],le=_e[0],he=_e[1];h.queries.query[le]=he}}function Vs(h){var g=h._state,b=h._deps.indexedDB;if(g.isBeingOpened||h.idbdb)return g.dbReadyPromise.then(function(){return g.dbOpenError?Nt(g.dbOpenError):h});g.isBeingOpened=!0,g.dbOpenError=null,g.openComplete=!1;var T=g.openCanceller,k=Math.round(10*h.verno),R=!1;function K(){if(g.openCanceller!==T)throw new Ke.DatabaseClosed("db.open() was cancelled")}function te(){return new pt(function(fe,pe){if(K(),!b)throw new Ke.MissingAPI;var de=h.name,_e=g.autoSchema||!k?b.open(de):b.open(de,k);if(!_e)throw new Ke.MissingAPI;_e.onerror=ri(pe),_e.onblocked=$(h._fireOnBlocked),_e.onupgradeneeded=$(function(oe){var ye;ge=_e.transaction,g.autoSchema&&!h._options.allowEmptyDB?(_e.onerror=Yo,ge.abort(),_e.result.close(),(ye=b.deleteDatabase(de)).onsuccess=ye.onerror=$(function(){pe(new Ke.NoSuchDatabase("Database ".concat(de," doesnt exist")))})):(ge.onerror=ri(pe),oe=oe.oldVersion>Math.pow(2,62)?0:oe.oldVersion,ie=oe<1,h.idbdb=_e.result,R&&Ns(h,ge),ds(h,oe/10,ge,pe))},pe),_e.onsuccess=$(function(){ge=null;var oe,ye,Ie,Pe,De,$e=h.idbdb=_e.result,ht=dr($e.objectStoreNames);if(0<ht.length)try{var tt=$e.transaction((Pe=ht).length===1?Pe[0]:Pe,"readonly");if(g.autoSchema)ye=$e,Ie=tt,(oe=h).verno=ye.version/10,Ie=oe._dbSchema=Ca(0,ye,Ie),oe._storeNames=dr(ye.objectStoreNames,0),sa(oe,[oe._allTables],l(Ie),Ie);else if(cn(h,h._dbSchema,tt),((De=Ja(Ca(0,(De=h).idbdb,tt),De._dbSchema)).add.length||De.change.some(function(rt){return rt.add.length||rt.change.length}))&&!R)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),$e.close(),k=$e.version+1,R=!0,fe(te());Ha(h,tt)}catch{}Hr.push(h),$e.onversionchange=$(function(rt){g.vcFired=!0,h.on("versionchange").fire(rt)}),$e.onclose=$(function(rt){h.on("close").fire(rt)}),ie&&(De=h._deps,tt=de,$e=De.indexedDB,De=De.IDBKeyRange,So($e)||tt===cr||Eo($e,De).put({name:tt}).catch(qt)),fe()},pe)}).catch(function(fe){switch(fe?.name){case"UnknownError":if(0<g.PR1398_maxLoop)return g.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),te();break;case"VersionError":if(0<k)return k=0,te()}return pt.reject(fe)})}var le,he=g.dbReadyResolve,ge=null,ie=!1;return pt.race([T,(typeof navigator>"u"?pt.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(fe){function pe(){return indexedDB.databases().finally(fe)}le=setInterval(pe,100),pe()}).finally(function(){return clearInterval(le)}):Promise.resolve()).then(te)]).then(function(){return K(),g.onReadyBeingFired=[],pt.resolve(so(function(){return h.on.ready.fire(h.vip)})).then(function fe(){if(0<g.onReadyBeingFired.length){var pe=g.onReadyBeingFired.reduce(vn,qt);return g.onReadyBeingFired=[],pt.resolve(so(function(){return pe(h.vip)})).then(fe)}})}).finally(function(){g.openCanceller===T&&(g.onReadyBeingFired=null,g.isBeingOpened=!1)}).catch(function(fe){g.dbOpenError=fe;try{ge&&ge.abort()}catch{}return T===g.openCanceller&&h._close(),Nt(fe)}).finally(function(){g.openComplete=!0,he()}).then(function(){var fe;return ie&&(fe={},h.tables.forEach(function(pe){pe.schema.indexes.forEach(function(de){de.name&&(fe["idb://".concat(h.name,"/").concat(pe.name,"/").concat(de.name)]=new tn(-1/0,[[[]]]))}),fe["idb://".concat(h.name,"/").concat(pe.name,"/")]=fe["idb://".concat(h.name,"/").concat(pe.name,"/:dels")]=new tn(-1/0,[[[]]])}),Yi(wo).fire(fe),Co(fe,!0)),h})}function ka(h){function g(R){return h.next(R)}var b=k(g),T=k(function(R){return h.throw(R)});function k(R){return function(le){var te=R(le),le=te.value;return te.done?le:le&&typeof le.then=="function"?le.then(b,T):ur(le)?Promise.all(le).then(b,T):b(le)}}return k(g)()}function uo(h,g,b){for(var T=ur(h)?h.slice():[h],k=0;k<b;++k)T.push(g);return T}var js={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(h){return mt(mt({},h),{table:function(g){var b=h.table(g),T=b.schema,k={},R=[];function K(ie,fe,pe){var de=ao(ie),_e=k[de]=k[de]||[],oe=ie==null?0:typeof ie=="string"?1:ie.length,ye=0<fe,ye=mt(mt({},pe),{name:ye?"".concat(de,"(virtual-from:").concat(pe.name,")"):pe.name,lowLevelIndex:pe,isVirtual:ye,keyTail:fe,keyLength:oe,extractKey:aa(ie),unique:!ye&&pe.unique});return _e.push(ye),ye.isPrimaryKey||R.push(ye),1<oe&&K(oe===2?ie[0]:ie.slice(0,oe-1),fe+1,pe),_e.sort(function(Ie,Pe){return Ie.keyTail-Pe.keyTail}),ye}g=K(T.primaryKey.keyPath,0,T.primaryKey),k[":id"]=[g];for(var te=0,le=T.indexes;te<le.length;te++){var he=le[te];K(he.keyPath,0,he)}function ge(ie){var fe,pe=ie.query.index;return pe.isVirtual?mt(mt({},ie),{query:{index:pe.lowLevelIndex,range:(fe=ie.query.range,pe=pe.keyTail,{type:fe.type===1?2:fe.type,lower:uo(fe.lower,fe.lowerOpen?h.MAX_KEY:h.MIN_KEY,pe),lowerOpen:!0,upper:uo(fe.upper,fe.upperOpen?h.MIN_KEY:h.MAX_KEY,pe),upperOpen:!0})}}):ie}return mt(mt({},b),{schema:mt(mt({},T),{primaryKey:g,indexes:R,getIndexByKeyPath:function(ie){return(ie=k[ao(ie)])&&ie[0]}}),count:function(ie){return b.count(ge(ie))},query:function(ie){return b.query(ge(ie))},openCursor:function(ie){var fe=ie.query.index,pe=fe.keyTail,de=fe.isVirtual,_e=fe.keyLength;return de?b.openCursor(ge(ie)).then(function(ye){return ye&&oe(ye)}):b.openCursor(ie);function oe(ye){return Object.create(ye,{continue:{value:function(Ie){Ie!=null?ye.continue(uo(Ie,ie.reverse?h.MAX_KEY:h.MIN_KEY,pe)):ie.unique?ye.continue(ye.key.slice(0,_e).concat(ie.reverse?h.MIN_KEY:h.MAX_KEY,pe)):ye.continue()}},continuePrimaryKey:{value:function(Ie,Pe){ye.continuePrimaryKey(uo(Ie,h.MAX_KEY,pe),Pe)}},primaryKey:{get:function(){return ye.primaryKey}},key:{get:function(){var Ie=ye.key;return _e===1?Ie[0]:Ie.slice(0,_e)}},value:{get:function(){return ye.value}}})}}})}})}};function Ao(h,g,b,T){return b=b||{},T=T||"",l(h).forEach(function(k){var R,K,te;Gr(g,k)?(R=h[k],K=g[k],typeof R=="object"&&typeof K=="object"&&R&&K?(te=Bo(R))!==Bo(K)?b[T+k]=g[k]:te==="Object"?Ao(R,K,b,T+k+"."):R!==K&&(b[T+k]=g[k]):R!==K&&(b[T+k]=g[k])):b[T+k]=void 0}),l(g).forEach(function(k){Gr(h,k)||(b[T+k]=g[k])}),b}function Po(h,g){return g.type==="delete"?g.keys:g.keys||g.values.map(h.extractKey)}var qs={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(h){return mt(mt({},h),{table:function(g){var b=h.table(g),T=b.schema.primaryKey;return mt(mt({},b),{mutate:function(k){var R=bt.trans,K=R.table(g).hook,te=K.deleting,le=K.creating,he=K.updating;switch(k.type){case"add":if(le.fire===qt)break;return R._promise("readwrite",function(){return ge(k)},!0);case"put":if(le.fire===qt&&he.fire===qt)break;return R._promise("readwrite",function(){return ge(k)},!0);case"delete":if(te.fire===qt)break;return R._promise("readwrite",function(){return ge(k)},!0);case"deleteRange":if(te.fire===qt)break;return R._promise("readwrite",function(){return function ie(fe,pe,de){return b.query({trans:fe,values:!1,query:{index:T,range:pe},limit:de}).then(function(_e){var oe=_e.result;return ge({type:"delete",keys:oe,trans:fe}).then(function(ye){return 0<ye.numFailures?Promise.reject(ye.failures[0]):oe.length<de?{failures:[],numFailures:0,lastResult:void 0}:ie(fe,mt(mt({},pe),{lower:oe[oe.length-1],lowerOpen:!0}),de)})})}(k.trans,k.range,1e4)},!0)}return b.mutate(k);function ge(ie){var fe,pe,de,_e=bt.trans,oe=ie.keys||Po(T,ie);if(!oe)throw new Error("Keys missing");return(ie=ie.type==="add"||ie.type==="put"?mt(mt({},ie),{keys:oe}):mt({},ie)).type!=="delete"&&(ie.values=lr([],ie.values)),ie.keys&&(ie.keys=lr([],ie.keys)),fe=b,de=oe,((pe=ie).type==="add"?Promise.resolve([]):fe.getMany({trans:pe.trans,keys:de,cache:"immutable"})).then(function(ye){var Ie=oe.map(function(Pe,De){var $e,ht,tt,rt=ye[De],ft={onerror:null,onsuccess:null};return ie.type==="delete"?te.fire.call(ft,Pe,rt,_e):ie.type==="add"||rt===void 0?($e=le.fire.call(ft,Pe,ie.values[De],_e),Pe==null&&$e!=null&&(ie.keys[De]=Pe=$e,T.outbound||Qr(ie.values[De],T.keyPath,Pe))):($e=Ao(rt,ie.values[De]),(ht=he.fire.call(ft,$e,Pe,rt,_e))&&(tt=ie.values[De],Object.keys(ht).forEach(function(nt){Gr(tt,nt)?tt[nt]=ht[nt]:Qr(tt,nt,ht[nt])}))),ft});return b.mutate(ie).then(function(Pe){for(var De=Pe.failures,$e=Pe.results,ht=Pe.numFailures,Pe=Pe.lastResult,tt=0;tt<oe.length;++tt){var rt=($e||oe)[tt],ft=Ie[tt];rt==null?ft.onerror&&ft.onerror(De[tt]):ft.onsuccess&&ft.onsuccess(ie.type==="put"&&ye[tt]?ie.values[tt]:rt)}return{failures:De,results:$e,numFailures:ht,lastResult:Pe}}).catch(function(Pe){return Ie.forEach(function(De){return De.onerror&&De.onerror(Pe)}),Promise.reject(Pe)})})}}})}})}};function ca(h,g,b){try{if(!g||g.keys.length<h.length)return null;for(var T=[],k=0,R=0;k<g.keys.length&&R<h.length;++k)E(g.keys[k],h[R])===0&&(T.push(b?Sr(g.values[k]):g.values[k]),++R);return T.length===h.length?T:null}catch{return null}}var kr={stack:"dbcore",level:-1,create:function(h){return{table:function(g){var b=h.table(g);return mt(mt({},b),{getMany:function(T){if(!T.cache)return b.getMany(T);var k=ca(T.keys,T.trans._cache,T.cache==="clone");return k?pt.resolve(k):b.getMany(T).then(function(R){return T.trans._cache={keys:T.keys,values:T.cache==="clone"?Sr(R):R},R})},mutate:function(T){return T.type!=="add"&&(T.trans._cache=null),b.mutate(T)}})}}}};function Ma(h,g){return h.trans.mode==="readonly"&&!!h.subscr&&!h.trans.explicit&&h.trans.db._options.cache!=="disabled"&&!g.schema.primaryKey.outbound}function Zs(h,g){switch(h){case"query":return g.values&&!g.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var pa={stack:"dbcore",level:0,name:"Observability",create:function(h){var g=h.schema.name,b=new tn(h.MIN_KEY,h.MAX_KEY);return mt(mt({},h),{transaction:function(T,k,R){if(bt.subscr&&k!=="readonly")throw new Ke.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(bt.querier));return h.transaction(T,k,R)},table:function(T){var k=h.table(T),R=k.schema,K=R.primaryKey,ie=R.indexes,te=K.extractKey,le=K.outbound,he=K.autoIncrement&&ie.filter(function(pe){return pe.compound&&pe.keyPath.includes(K.keyPath)}),ge=mt(mt({},k),{mutate:function(pe){function de(nt){return nt="idb://".concat(g,"/").concat(T,"/").concat(nt),Pe[nt]||(Pe[nt]=new tn)}var _e,oe,ye,Ie=pe.trans,Pe=pe.mutatedParts||(pe.mutatedParts={}),De=de(""),$e=de(":dels"),ht=pe.type,ft=pe.type==="deleteRange"?[pe.range]:pe.type==="delete"?[pe.keys]:pe.values.length<50?[Po(K,pe).filter(function(nt){return nt}),pe.values]:[],tt=ft[0],rt=ft[1],ft=pe.trans._cache;return ur(tt)?(De.addKeys(tt),(ft=ht==="delete"||tt.length===rt.length?ca(tt,ft):null)||$e.addKeys(tt),(ft||rt)&&(_e=de,oe=ft,ye=rt,R.indexes.forEach(function(nt){var at=_e(nt.name||"");function $t(Pt){return Pt!=null?nt.extractKey(Pt):null}function hr(Pt){return nt.multiEntry&&ur(Pt)?Pt.forEach(function(Qe){return at.addKey(Qe)}):at.addKey(Pt)}(oe||ye).forEach(function(Pt,Cn){var Lt=oe&&$t(oe[Cn]),Cn=ye&&$t(ye[Cn]);E(Lt,Cn)!==0&&(Lt!=null&&hr(Lt),Cn!=null&&hr(Cn))})}))):tt?(rt={from:(rt=tt.lower)!==null&&rt!==void 0?rt:h.MIN_KEY,to:(rt=tt.upper)!==null&&rt!==void 0?rt:h.MAX_KEY},$e.add(rt),De.add(rt)):(De.add(b),$e.add(b),R.indexes.forEach(function(nt){return de(nt.name).add(b)})),k.mutate(pe).then(function(nt){return!tt||pe.type!=="add"&&pe.type!=="put"||(De.addKeys(nt.results),he&&he.forEach(function(at){for(var $t=pe.values.map(function(Lt){return at.extractKey(Lt)}),hr=at.keyPath.findIndex(function(Lt){return Lt===K.keyPath}),Pt=0,Qe=nt.results.length;Pt<Qe;++Pt)$t[Pt][hr]=nt.results[Pt];de(at.name).addKeys($t)})),Ie.mutatedParts=Pa(Ie.mutatedParts||{},Pe),nt})}}),ie=function(de){var _e=de.query,de=_e.index,_e=_e.range;return[de,new tn((de=_e.lower)!==null&&de!==void 0?de:h.MIN_KEY,(_e=_e.upper)!==null&&_e!==void 0?_e:h.MAX_KEY)]},fe={get:function(pe){return[K,new tn(pe.key)]},getMany:function(pe){return[K,new tn().addKeys(pe.keys)]},count:ie,query:ie,openCursor:ie};return l(fe).forEach(function(pe){ge[pe]=function(de){var _e=bt.subscr,oe=!!_e,ye=Ma(bt,k)&&Zs(pe,de)?de.obsSet={}:_e;if(oe){var Ie=function(rt){return rt="idb://".concat(g,"/").concat(T,"/").concat(rt),ye[rt]||(ye[rt]=new tn)},Pe=Ie(""),De=Ie(":dels"),_e=fe[pe](de),oe=_e[0],_e=_e[1];if((pe==="query"&&oe.isPrimaryKey&&!de.values?De:Ie(oe.name||"")).add(_e),!oe.isPrimaryKey){if(pe!=="count"){var $e=pe==="query"&&le&&de.values&&k.query(mt(mt({},de),{values:!1}));return k[pe].apply(this,arguments).then(function(rt){if(pe==="query"){if(le&&de.values)return $e.then(function($t){return $t=$t.result,Pe.addKeys($t),rt});var ft=de.values?rt.result.map(te):rt.result;(de.values?Pe:De).addKeys(ft)}else if(pe==="openCursor"){var nt=rt,at=de.values;return nt&&Object.create(nt,{key:{get:function(){return De.addKey(nt.primaryKey),nt.key}},primaryKey:{get:function(){var $t=nt.primaryKey;return De.addKey($t),$t}},value:{get:function(){return at&&Pe.addKey(nt.primaryKey),nt.value}}})}return rt})}De.add(b)}}return k[pe].apply(this,arguments)}}),ge}})}};function vs(h,g,b){if(b.numFailures===0)return g;if(g.type==="deleteRange")return null;var T=g.keys?g.keys.length:"values"in g&&g.values?g.values.length:1;return b.numFailures===T?null:(g=mt({},g),ur(g.keys)&&(g.keys=g.keys.filter(function(k,R){return!(R in b.failures)})),"values"in g&&ur(g.values)&&(g.values=g.values.filter(function(k,R){return!(R in b.failures)})),g)}function _s(h,g){return b=h,((T=g).lower===void 0||(T.lowerOpen?0<E(b,T.lower):0<=E(b,T.lower)))&&(h=h,(g=g).upper===void 0||(g.upperOpen?E(h,g.upper)<0:E(h,g.upper)<=0));var b,T}function xs(h,g,fe,T,k,R){if(!fe||fe.length===0)return h;var K=g.query.index,te=K.multiEntry,le=g.query.range,he=T.schema.primaryKey.extractKey,ge=K.extractKey,ie=(K.lowLevelIndex||K).extractKey,fe=fe.reduce(function(pe,de){var _e=pe,oe=[];if(de.type==="add"||de.type==="put")for(var ye=new tn,Ie=de.values.length-1;0<=Ie;--Ie){var Pe,De=de.values[Ie],$e=he(De);ye.hasKey($e)||(Pe=ge(De),(te&&ur(Pe)?Pe.some(function(nt){return _s(nt,le)}):_s(Pe,le))&&(ye.addKey($e),oe.push(De)))}switch(de.type){case"add":var ht=new tn().addKeys(g.values?pe.map(function(at){return he(at)}):pe),_e=pe.concat(g.values?oe.filter(function(at){return at=he(at),!ht.hasKey(at)&&(ht.addKey(at),!0)}):oe.map(function(at){return he(at)}).filter(function(at){return!ht.hasKey(at)&&(ht.addKey(at),!0)}));break;case"put":var tt=new tn().addKeys(de.values.map(function(at){return he(at)}));_e=pe.filter(function(at){return!tt.hasKey(g.values?he(at):at)}).concat(g.values?oe:oe.map(function(at){return he(at)}));break;case"delete":var rt=new tn().addKeys(de.keys);_e=pe.filter(function(at){return!rt.hasKey(g.values?he(at):at)});break;case"deleteRange":var ft=de.range;_e=pe.filter(function(at){return!_s(he(at),ft)})}return _e},h);return fe===h?h:(fe.sort(function(pe,de){return E(ie(pe),ie(de))||E(he(pe),he(de))}),g.limit&&g.limit<1/0&&(fe.length>g.limit?fe.length=g.limit:h.length===g.limit&&fe.length<g.limit&&(k.dirty=!0)),R?Object.freeze(fe):fe)}function za(h,g){return E(h.lower,g.lower)===0&&E(h.upper,g.upper)===0&&!!h.lowerOpen==!!g.lowerOpen&&!!h.upperOpen==!!g.upperOpen}function ha(h,g){return function(b,T,k,R){if(b===void 0)return T!==void 0?-1:0;if(T===void 0)return 1;if((T=E(b,T))===0){if(k&&R)return 0;if(k)return 1;if(R)return-1}return T}(h.lower,g.lower,h.lowerOpen,g.lowerOpen)<=0&&0<=function(b,T,k,R){if(b===void 0)return T!==void 0?1:0;if(T===void 0)return-1;if((T=E(b,T))===0){if(k&&R)return 0;if(k)return-1;if(R)return 1}return T}(h.upper,g.upper,h.upperOpen,g.upperOpen)}function Da(h,g,b,T){h.subscribers.add(b),T.addEventListener("abort",function(){var k,R;h.subscribers.delete(b),h.subscribers.size===0&&(k=h,R=g,setTimeout(function(){k.subscribers.size===0&&Vn(R,k)},3e3))})}var es={stack:"dbcore",level:0,name:"Cache",create:function(h){var g=h.schema.name;return mt(mt({},h),{transaction:function(b,T,k){var R,K,te=h.transaction(b,T,k);return T==="readwrite"&&(K=(R=new AbortController).signal,k=function(le){return function(){if(R.abort(),T==="readwrite"){for(var he=new Set,ge=0,ie=b;ge<ie.length;ge++){var fe=ie[ge],pe=jo["idb://".concat(g,"/").concat(fe)];if(pe){var de=h.table(fe),_e=pe.optimisticOps.filter(function(at){return at.trans===te});if(te._explicit&&le&&te.mutatedParts)for(var oe=0,ye=Object.values(pe.queries.query);oe<ye.length;oe++)for(var Ie=0,Pe=(ht=ye[oe]).slice();Ie<Pe.length;Ie++)$a((tt=Pe[Ie]).obsSet,te.mutatedParts)&&(Vn(ht,tt),tt.subscribers.forEach(function(at){return he.add(at)}));else if(0<_e.length){pe.optimisticOps=pe.optimisticOps.filter(function(at){return at.trans!==te});for(var De=0,$e=Object.values(pe.queries.query);De<$e.length;De++)for(var ht,tt,rt,ft=0,nt=(ht=$e[De]).slice();ft<nt.length;ft++)(tt=nt[ft]).res!=null&&te.mutatedParts&&(le&&!tt.dirty?(rt=Object.isFrozen(tt.res),rt=xs(tt.res,tt.req,_e,de,tt,rt),tt.dirty?(Vn(ht,tt),tt.subscribers.forEach(function(at){return he.add(at)})):rt!==tt.res&&(tt.res=rt,tt.promise=pt.resolve({result:rt}))):(tt.dirty&&Vn(ht,tt),tt.subscribers.forEach(function(at){return he.add(at)})))}}}he.forEach(function(at){return at()})}}},te.addEventListener("abort",k(!1),{signal:K}),te.addEventListener("error",k(!1),{signal:K}),te.addEventListener("complete",k(!0),{signal:K})),te},table:function(b){var T=h.table(b),k=T.schema.primaryKey;return mt(mt({},T),{mutate:function(R){var K=bt.trans;if(k.outbound||K.db._options.cache==="disabled"||K.explicit||K.idbtrans.mode!=="readwrite")return T.mutate(R);var te=jo["idb://".concat(g,"/").concat(b)];return te?(K=T.mutate(R),R.type!=="add"&&R.type!=="put"||!(50<=R.values.length||Po(k,R).some(function(le){return le==null}))?(te.optimisticOps.push(R),R.mutatedParts&&Qi(R.mutatedParts),K.then(function(le){0<le.numFailures&&(Vn(te.optimisticOps,R),(le=vs(0,R,le))&&te.optimisticOps.push(le),R.mutatedParts&&Qi(R.mutatedParts))}),K.catch(function(){Vn(te.optimisticOps,R),R.mutatedParts&&Qi(R.mutatedParts)})):K.then(function(le){var he=vs(0,mt(mt({},R),{values:R.values.map(function(ge,ie){var fe;return le.failures[ie]?ge:(ge=(fe=k.keyPath)!==null&&fe!==void 0&&fe.includes(".")?Sr(ge):mt({},ge),Qr(ge,k.keyPath,le.results[ie]),ge)})}),le);te.optimisticOps.push(he),queueMicrotask(function(){return R.mutatedParts&&Qi(R.mutatedParts)})}),K):T.mutate(R)},query:function(R){if(!Ma(bt,T)||!Zs("query",R))return T.query(R);var K=((he=bt.trans)===null||he===void 0?void 0:he.db._options.cache)==="immutable",ie=bt,te=ie.requery,le=ie.signal,he=function(de,_e,oe,ye){var Ie=jo["idb://".concat(de,"/").concat(_e)];if(!Ie)return[];if(!(_e=Ie.queries[oe]))return[null,!1,Ie,null];var Pe=_e[(ye.query?ye.query.index.name:null)||""];if(!Pe)return[null,!1,Ie,null];switch(oe){case"query":var De=Pe.find(function($e){return $e.req.limit===ye.limit&&$e.req.values===ye.values&&za($e.req.query.range,ye.query.range)});return De?[De,!0,Ie,Pe]:[Pe.find(function($e){return("limit"in $e.req?$e.req.limit:1/0)>=ye.limit&&(!ye.values||$e.req.values)&&ha($e.req.query.range,ye.query.range)}),!1,Ie,Pe];case"count":return De=Pe.find(function($e){return za($e.req.query.range,ye.query.range)}),[De,!!De,Ie,Pe]}}(g,b,"query",R),ge=he[0],ie=he[1],fe=he[2],pe=he[3];return ge&&ie?ge.obsSet=R.obsSet:(ie=T.query(R).then(function(de){var _e=de.result;if(ge&&(ge.res=_e),K){for(var oe=0,ye=_e.length;oe<ye;++oe)Object.freeze(_e[oe]);Object.freeze(_e)}else de.result=Sr(_e);return de}).catch(function(de){return pe&&ge&&Vn(pe,ge),Promise.reject(de)}),ge={obsSet:R.obsSet,promise:ie,subscribers:new Set,type:"query",req:R,dirty:!1},pe?pe.push(ge):(pe=[ge],(fe=fe||(jo["idb://".concat(g,"/").concat(b)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[R.query.index.name||""]=pe)),Da(ge,pe,te,le),ge.promise.then(function(de){return{result:xs(de.result,R,fe?.optimisticOps,T,ge,K)}})}})}})}};function qo(h,g){return new Proxy(h,{get:function(b,T,k){return T==="db"?g:Reflect.get(b,T,k)}})}var ci=(rn.prototype.version=function(h){if(isNaN(h)||h<.1)throw new Ke.Type("Given version is not a positive number");if(h=Math.round(10*h)/10,this.idbdb||this._state.isBeingOpened)throw new Ke.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,h);var g=this._versions,b=g.filter(function(T){return T._cfg.version===h})[0];return b||(b=new this.Version(h),g.push(b),g.sort(fs),b.stores({}),this._state.autoSchema=!1,b)},rn.prototype._whenReady=function(h){var g=this;return this.idbdb&&(this._state.openComplete||bt.letThrough||this._vip)?h():new pt(function(b,T){if(g._state.openComplete)return T(new Ke.DatabaseClosed(g._state.dbOpenError));if(!g._state.isBeingOpened){if(!g._state.autoOpen)return void T(new Ke.DatabaseClosed);g.open().catch(qt)}g._state.dbReadyPromise.then(b,T)}).then(h)},rn.prototype.use=function(h){var g=h.stack,b=h.create,T=h.level,k=h.name;return k&&this.unuse({stack:g,name:k}),h=this._middlewares[g]||(this._middlewares[g]=[]),h.push({stack:g,create:b,level:T??10,name:k}),h.sort(function(R,K){return R.level-K.level}),this},rn.prototype.unuse=function(h){var g=h.stack,b=h.name,T=h.create;return g&&this._middlewares[g]&&(this._middlewares[g]=this._middlewares[g].filter(function(k){return T?k.create!==T:!!b&&k.name!==b})),this},rn.prototype.open=function(){var h=this;return Bt(Ln,function(){return Vs(h)})},rn.prototype._close=function(){var h=this._state,g=Hr.indexOf(this);if(0<=g&&Hr.splice(g,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}h.isBeingOpened||(h.dbReadyPromise=new pt(function(b){h.dbReadyResolve=b}),h.openCanceller=new pt(function(b,T){h.cancelOpen=T}))},rn.prototype.close=function(b){var g=(b===void 0?{disableAutoOpen:!0}:b).disableAutoOpen,b=this._state;g?(b.isBeingOpened&&b.cancelOpen(new Ke.DatabaseClosed),this._close(),b.autoOpen=!1,b.dbOpenError=new Ke.DatabaseClosed):(this._close(),b.autoOpen=this._options.autoOpen||b.isBeingOpened,b.openComplete=!1,b.dbOpenError=null)},rn.prototype.delete=function(h){var g=this;h===void 0&&(h={disableAutoOpen:!0});var b=0<arguments.length&&typeof arguments[0]!="object",T=this._state;return new pt(function(k,R){function K(){g.close(h);var te=g._deps.indexedDB.deleteDatabase(g.name);te.onsuccess=$(function(){var le,he,ge;le=g._deps,he=g.name,ge=le.indexedDB,le=le.IDBKeyRange,So(ge)||he===cr||Eo(ge,le).delete(he).catch(qt),k()}),te.onerror=ri(R),te.onblocked=g._fireOnBlocked}if(b)throw new Ke.InvalidArgument("Invalid closeOptions argument to db.delete()");T.isBeingOpened?T.dbReadyPromise.then(K):K()})},rn.prototype.backendDB=function(){return this.idbdb},rn.prototype.isOpen=function(){return this.idbdb!==null},rn.prototype.hasBeenClosed=function(){var h=this._state.dbOpenError;return h&&h.name==="DatabaseClosed"},rn.prototype.hasFailed=function(){return this._state.dbOpenError!==null},rn.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(rn.prototype,"tables",{get:function(){var h=this;return l(this._allTables).map(function(g){return h._allTables[g]})},enumerable:!1,configurable:!0}),rn.prototype.transaction=function(){var h=function(g,b,T){var k=arguments.length;if(k<2)throw new Ke.InvalidArgument("Too few arguments");for(var R=new Array(k-1);--k;)R[k-1]=arguments[k];return T=R.pop(),[g,vi(R),T]}.apply(this,arguments);return this._transaction.apply(this,h)},rn.prototype._transaction=function(h,g,b){var T=this,k=bt.trans;k&&k.db===this&&h.indexOf("!")===-1||(k=null);var R,K,te=h.indexOf("?")!==-1;h=h.replace("!","").replace("?","");try{if(K=g.map(function(he){if(he=he instanceof T.Table?he.name:he,typeof he!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return he}),h=="r"||h===zr)R=zr;else{if(h!="rw"&&h!=vr)throw new Ke.InvalidArgument("Invalid transaction mode: "+h);R=vr}if(k){if(k.mode===zr&&R===vr){if(!te)throw new Ke.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");k=null}k&&K.forEach(function(he){if(k&&k.storeNames.indexOf(he)===-1){if(!te)throw new Ke.SubTransaction("Table "+he+" not included in parent transaction.");k=null}}),te&&k&&!k.active&&(k=null)}}catch(he){return k?k._promise(null,function(ge,ie){ie(he)}):Nt(he)}var le=function he(ge,ie,fe,pe,de){return pt.resolve().then(function(){var _e=bt.transless||bt,oe=ge._createTransaction(ie,fe,ge._dbSchema,pe);if(oe.explicit=!0,_e={trans:oe,transless:_e},pe)oe.idbtrans=pe.idbtrans;else try{oe.create(),oe.idbtrans._explicit=!0,ge._state.PR1398_maxLoop=3}catch(Pe){return Pe.name===gn.InvalidState&&ge.isOpen()&&0<--ge._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),ge.close({disableAutoOpen:!1}),ge.open().then(function(){return he(ge,ie,fe,null,de)})):Nt(Pe)}var ye,Ie=$n(de);return Ie&&ot(),_e=pt.follow(function(){var Pe;(ye=de.call(oe,oe))&&(Ie?(Pe=We.bind(null,null),ye.then(Pe,Pe)):typeof ye.next=="function"&&typeof ye.throw=="function"&&(ye=ka(ye)))},_e),(ye&&typeof ye.then=="function"?pt.resolve(ye).then(function(Pe){return oe.active?Pe:Nt(new Ke.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):_e.then(function(){return ye})).then(function(Pe){return pe&&oe._resolve(),oe._completion.then(function(){return Pe})}).catch(function(Pe){return oe._reject(Pe),Nt(Pe)})})}.bind(null,this,R,K,k,b);return k?k._promise(R,le,"lock"):bt.trans?Bt(bt.transless,function(){return T._whenReady(le)}):this._whenReady(le)},rn.prototype.table=function(h){if(!Gr(this._allTables,h))throw new Ke.InvalidTable("Table ".concat(h," does not exist"));return this._allTables[h]},rn);function rn(h,g){var b=this;this._middlewares={},this.verno=0;var T=rn.dependencies;this._options=g=mt({addons:rn.addons,autoOpen:!0,indexedDB:T.indexedDB,IDBKeyRange:T.IDBKeyRange,cache:"cloned"},g),this._deps={indexedDB:g.indexedDB,IDBKeyRange:g.IDBKeyRange},T=g.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var k,R,K,te,le,he={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:qt,dbReadyPromise:null,cancelOpen:qt,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:g.autoOpen};he.dbReadyPromise=new pt(function(ie){he.dbReadyResolve=ie}),he.openCanceller=new pt(function(ie,fe){he.cancelOpen=fe}),this._state=he,this.name=h,this.on=Ne(this,"populate","blocked","versionchange","close",{ready:[vn,qt]}),this.on.ready.subscribe=Ji(this.on.ready.subscribe,function(ie){return function(fe,pe){rn.vip(function(){var de,_e=b._state;_e.openComplete?(_e.dbOpenError||pt.resolve().then(fe),pe&&ie(fe)):_e.onReadyBeingFired?(_e.onReadyBeingFired.push(fe),pe&&ie(fe)):(ie(fe),de=b,pe||ie(function oe(){de.on.ready.unsubscribe(fe),de.on.ready.unsubscribe(oe)}))})}}),this.Collection=(k=this,Ge(Kt.prototype,function(ye,oe){this.db=k;var pe=pr,de=null;if(oe)try{pe=oe()}catch(Ie){de=Ie}var _e=ye._ctx,oe=_e.table,ye=oe.hook.reading.fire;this._ctx={table:oe,index:_e.index,isPrimKey:!_e.index||oe.schema.primKey.keyPath&&_e.index===oe.schema.primKey.name,range:pe,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:de,or:_e.or,valueMapper:ye!==Wt?ye:null}})),this.Table=(R=this,Ge(ue.prototype,function(ie,fe,pe){this.db=R,this._tx=pe,this.name=ie,this.schema=fe,this.hook=R._allTables[ie]?R._allTables[ie].hook:Ne(null,{creating:[jt,qt],reading:[Ei,Wt],updating:[Si,qt],deleting:[oa,qt]})})),this.Transaction=(K=this,Ge(Vi.prototype,function(ie,fe,pe,de,_e){var oe=this;this.db=K,this.mode=ie,this.storeNames=fe,this.schema=pe,this.chromeTransactionDurability=de,this.idbtrans=null,this.on=Ne(this,"complete","error","abort"),this.parent=_e||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new pt(function(ye,Ie){oe._resolve=ye,oe._reject=Ie}),this._completion.then(function(){oe.active=!1,oe.on.complete.fire()},function(ye){var Ie=oe.active;return oe.active=!1,oe.on.error.fire(ye),oe.parent?oe.parent._reject(ye):Ie&&oe.idbtrans&&oe.idbtrans.abort(),Nt(ye)})})),this.Version=(te=this,Ge(Vo.prototype,function(ie){this.db=te,this._cfg={version:ie,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(le=this,Ge(hs.prototype,function(ie,fe,pe){if(this.db=le,this._ctx={table:ie,index:fe===":id"?null:fe,or:pe},this._cmp=this._ascending=E,this._descending=function(de,_e){return E(_e,de)},this._max=function(de,_e){return 0<E(de,_e)?de:_e},this._min=function(de,_e){return E(de,_e)<0?de:_e},this._IDBKeyRange=le._deps.IDBKeyRange,!this._IDBKeyRange)throw new Ke.MissingAPI})),this.on("versionchange",function(ie){0<ie.newVersion?console.warn("Another connection wants to upgrade database '".concat(b.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(b.name,"'. Closing db now to resume the delete request.")),b.close({disableAutoOpen:!1})}),this.on("blocked",function(ie){!ie.newVersion||ie.newVersion<ie.oldVersion?console.warn("Dexie.delete('".concat(b.name,"') was blocked")):console.warn("Upgrade '".concat(b.name,"' blocked by other connection holding version ").concat(ie.oldVersion/10))}),this._maxKey=ji(g.IDBKeyRange),this._createTransaction=function(ie,fe,pe,de){return new b.Transaction(ie,fe,pe,b._options.chromeTransactionDurability,de)},this._fireOnBlocked=function(ie){b.on("blocked").fire(ie),Hr.filter(function(fe){return fe.name===b.name&&fe!==b&&!fe._state.vcFired}).map(function(fe){return fe.on("versionchange").fire(ie)})},this.use(kr),this.use(es),this.use(pa),this.use(js),this.use(qs);var ge=new Proxy(this,{get:function(ie,fe,pe){if(fe==="_vip")return!0;if(fe==="table")return function(_e){return qo(b.table(_e),ge)};var de=Reflect.get(ie,fe,pe);return de instanceof ue?qo(de,ge):fe==="tables"?de.map(function(_e){return qo(_e,ge)}):fe==="_createTransaction"?function(){return qo(de.apply(this,arguments),ge)}:de}});this.vip=ge,T.forEach(function(ie){return ie(b)})}var ko,nn=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",Gs=(ts.prototype.subscribe=function(h,g,b){return this._subscribe(h&&typeof h!="function"?h:{next:h,error:g,complete:b})},ts.prototype[nn]=function(){return this},ts);function ts(h){this._subscribe=h}try{ko={indexedDB:Cr.indexedDB||Cr.mozIndexedDB||Cr.webkitIndexedDB||Cr.msIndexedDB,IDBKeyRange:Cr.IDBKeyRange||Cr.webkitIDBKeyRange}}catch{ko={indexedDB:null,IDBKeyRange:null}}function bs(h){var g,b=!1,T=new Gs(function(k){var R=$n(h),K,te=!1,le={},he={},ge={get closed(){return te},unsubscribe:function(){te||(te=!0,K&&K.abort(),ie&&Yi.storagemutated.unsubscribe(pe))}};k.start&&k.start(ge);var ie=!1,fe=function(){return Yt(de)},pe=function(_e){Pa(le,_e),$a(he,le)&&fe()},de=function(){var _e,oe,ye;!te&&ko.indexedDB&&(le={},_e={},K&&K.abort(),K=new AbortController,ye=function(Ie){var Pe=D();try{R&&ot();var De=ke(h,Ie);return De=R?De.finally(We):De}finally{Pe&&U()}}(oe={subscr:_e,signal:K.signal,requery:fe,querier:h,trans:null}),Promise.resolve(ye).then(function(Ie){b=!0,g=Ie,te||oe.signal.aborted||(le={},function(Pe){for(var De in Pe)if(Gr(Pe,De))return;return 1}(he=_e)||ie||(Yi(wo,pe),ie=!0),Yt(function(){return!te&&k.next&&k.next(Ie)}))},function(Ie){b=!1,["DatabaseClosedError","AbortError"].includes(Ie?.name)||te||Yt(function(){te||k.error&&k.error(Ie)})}))};return setTimeout(fe,0),ge});return T.hasValue=function(){return b},T.getValue=function(){return g},T}var Ci=ci;function $o(h){var g=lo;try{lo=!0,Yi.storagemutated.fire(h),Co(h,!0)}finally{lo=g}}Xe(Ci,mt(mt({},En),{delete:function(h){return new Ci(h,{addons:[]}).delete()},exists:function(h){return new Ci(h,{addons:[]}).open().then(function(g){return g.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(h){try{return g=Ci.dependencies,b=g.indexedDB,g=g.IDBKeyRange,(So(b)?Promise.resolve(b.databases()).then(function(T){return T.map(function(k){return k.name}).filter(function(k){return k!==cr})}):Eo(b,g).toCollection().primaryKeys()).then(h)}catch{return Nt(new Ke.MissingAPI)}var g,b},defineClass:function(){return function(h){Oe(this,h)}},ignoreTransaction:function(h){return bt.trans?Bt(bt.transless,h):h()},vip:so,async:function(h){return function(){try{var g=ka(h.apply(this,arguments));return g&&typeof g.then=="function"?g:pt.resolve(g)}catch(b){return Nt(b)}}},spawn:function(h,g,b){try{var T=ka(h.apply(b,g||[]));return T&&typeof T.then=="function"?T:pt.resolve(T)}catch(k){return Nt(k)}},currentTransaction:{get:function(){return bt.trans||null}},waitFor:function(h,g){return g=pt.resolve(typeof h=="function"?Ci.ignoreTransaction(h):h).timeout(g||6e4),bt.trans?bt.trans.waitFor(g):g},Promise:pt,debug:{get:function(){return zn},set:function(h){br(h)}},derive:Or,extend:Oe,props:Xe,override:Ji,Events:Ne,on:Yi,liveQuery:bs,extendObservabilitySet:Pa,getByKeyPath:Un,setByKeyPath:Qr,delByKeyPath:function(h,g){typeof g=="string"?Qr(h,g,void 0):"length"in g&&[].map.call(g,function(b){Qr(h,b,void 0)})},shallowClone:zi,deepClone:Sr,getObjectDiff:Ao,cmp:E,asap:Vr,minKey:-1/0,addons:[],connections:Hr,errnames:gn,dependencies:ko,cache:jo,semVer:"4.0.11",version:"4.0.11".split(".").map(function(h){return parseInt(h)}).reduce(function(h,g,b){return h+g/Math.pow(10,2*b)})})),Ci.maxKey=ji(Ci.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Yi(wo,function(h){lo||(h=new CustomEvent(Wa,{detail:h}),lo=!0,dispatchEvent(h),lo=!1)}),addEventListener(Wa,function(h){h=h.detail,lo||$o(h)}));var Mo,lo=!1,La=function(){};return typeof BroadcastChannel<"u"&&((La=function(){(Mo=new BroadcastChannel(Wa)).onmessage=function(h){return h.data&&$o(h.data)}})(),typeof Mo.unref=="function"&&Mo.unref(),Yi(wo,function(h){lo||Mo.postMessage(h)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(h){if(!ci.disableBfCache&&h.persisted){zn&&console.debug("Dexie: handling persisted pagehide"),Mo?.close();for(var g=0,b=Hr;g<b.length;g++)b[g].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(h){!ci.disableBfCache&&h.persisted&&(zn&&console.debug("Dexie: handling persisted pageshow"),La(),$o({all:new tn(-1/0,[[]])}))})),pt.rejectionMapper=function(h,g){return!h||h instanceof Wn||h instanceof TypeError||h instanceof SyntaxError||!h.name||!wn[h.name]?h:(g=new wn[h.name](g||h.message,h),"stack"in h&&nr(g,"stack",{get:function(){return this.inner.stack}}),g)},br(zn),mt(ci,Object.freeze({__proto__:null,Dexie:ci,liveQuery:bs,Entity:v,cmp:E,PropModification:Fe,replacePrefix:function(h,g){return new Fe({replacePrefix:[h,g]})},add:function(h){return new Fe({add:h})},remove:function(h){return new Fe({remove:h})},default:ci,RangeSet:tn,mergeRanges:la,rangesOverlap:ys}),{default:ci}),ci})})(Yp);var Gf=Yp.exports;const Tc=Ic(Gf),Xp=Symbol.for("Dexie"),Gl=globalThis[Xp]||(globalThis[Xp]=Tc);if(Tc.semVer!==Gl.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${Tc.semVer} and ${Gl.semVer}`);const{liveQuery:dd,mergeRanges:md,rangesOverlap:yd,RangeSet:gd,cmp:vd,Entity:_d,PropModification:xd,replacePrefix:bd,add:wd,remove:Ed}=Gl,Kf=new Gl("VehicleTrackerDB");Kf.version(1).stores({TrailData:"++id, vehicleId, timestamp, coordinates, synced"});export{fd as M,Yf as a,Qf as b,Jf as c,nd as d,Hp as e,ud as f,ad as g,ld as h,ed as i,cd as j,pd as k,sd as l,od as m,td as n,hd as o,Kf as p,id as r,rd as s,$f as u};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./SimpleTractor.Db3ZCE0C.js","./scheduler.BVGjjnGO.js","./index.Vv2yv23T.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
