import{e as bc,g as Sc}from"./index.39e7d0dd.js";var Xp={exports:{}};(function(Tu,Tc){(function(zo,je){Tu.exports=je()})(bc,function(){var zo,je,Do;function pn(l,sr){if(!zo)zo=sr;else if(!je)je=sr;else{var Ot="var sharedChunk = {}; ("+zo+")(sharedChunk); ("+je+")(sharedChunk);",Br={};zo(Br),Do=sr(Br),typeof window<"u"&&(Do.workerUrl=window.URL.createObjectURL(new Blob([Ot],{type:"text/javascript"})))}}return pn(["exports"],function(l){function sr(t,e){return t(e={exports:{}},e.exports),e.exports}var Ot=Br;function Br(t,e,r,a){this.cx=3*t,this.bx=3*(r-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(a-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=a,this.p2x=r,this.p2y=a}Br.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},Br.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},Br.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},Br.prototype.solveCurveX=function(t,e){var r,a,u,c,f;for(e===void 0&&(e=1e-6),u=t,f=0;f<8;f++){if(c=this.sampleCurveX(u)-t,Math.abs(c)<e)return u;var y=this.sampleCurveDerivativeX(u);if(Math.abs(y)<1e-6)break;u-=c/y}if((u=t)<(r=0))return r;if(u>(a=1))return a;for(;r<a;){if(c=this.sampleCurveX(u),Math.abs(c-t)<e)return u;t>c?r=u:a=u,u=.5*(a-r)+r}return u},Br.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))};var Oe=Ur;function Ur(t,e){this.x=t,this.y=e}Ur.prototype={clone:function(){return new Ur(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,r=t.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),r=Math.sin(t),a=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=a,this},_rotateAround:function(t,e){var r=Math.cos(t),a=Math.sin(t),u=e.y+a*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-a*(this.y-e.y),this.y=u,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ur.convert=function(t){return t instanceof Ur?t:Array.isArray(t)?new Ur(t[0],t[1]):t};var Xt=typeof self<"u"?self:{},On=Math.pow(2,53)-1;function rr(t,e,r,a){var u=new Ot(t,e,r,a);return function(c){return u.solve(c)}}var Dr=rr(.25,.1,.25,1);function ve(t,e,r){return Math.min(r,Math.max(e,t))}function ir(t,e,r){var a=r-e,u=((t-e)%a+a)%a+e;return u===e?r:u}function hr(t){for(var e=[],r=arguments.length-1;r-- >0;)e[r]=arguments[r+1];for(var a=0,u=e;a<u.length;a+=1){var c=u[a];for(var f in c)t[f]=c[f]}return t}var Gi=1;function Lr(){return Gi++}function Cr(){return function t(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function Rn(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function Wr(t,e){t.forEach(function(r){e[r]&&(e[r]=e[r].bind(e))})}function Ai(t,e){return t.indexOf(e,t.length-e.length)!==-1}function gn(t,e,r){var a={};for(var u in t)a[u]=e.call(r||this,t[u],u,t);return a}function di(t,e,r){var a={};for(var u in t)e.call(r||this,t[u],u,t)&&(a[u]=t[u]);return a}function ni(t){return Array.isArray(t)?t.map(ni):typeof t=="object"&&t?gn(t,ni):t}var mi={};function wr(t){mi[t]||(typeof console<"u"&&console.warn(t),mi[t]=!0)}function Or(t,e,r){return(r.y-t.y)*(e.x-t.x)>(e.y-t.y)*(r.x-t.x)}function Lo(t){for(var e=0,r=0,a=t.length,u=a-1,c=void 0,f=void 0;r<a;u=r++)e+=((f=t[u]).x-(c=t[r]).x)*(c.y+f.y);return e}function hn(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function ho(t){var e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(a,u,c,f){var y=c||f;return e[u]=!y||y.toLowerCase(),""}),e["max-age"]){var r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}var Bn=null;function yi(t){if(Bn==null){var e=t.navigator?t.navigator.userAgent:null;Bn=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Bn}function Cn(t){try{var e=Xt[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}var Wn,Pi,Zn,$i,gi=Xt.performance&&Xt.performance.now?Xt.performance.now.bind(Xt.performance):Date.now.bind(Date),ki=Xt.requestAnimationFrame||Xt.mozRequestAnimationFrame||Xt.webkitRequestAnimationFrame||Xt.msRequestAnimationFrame,fn=Xt.cancelAnimationFrame||Xt.mozCancelAnimationFrame||Xt.webkitCancelAnimationFrame||Xt.msCancelAnimationFrame,vi={now:gi,frame:function(t){var e=ki(t);return{cancel:function(){return fn(e)}}},getImageData:function(t,e){e===void 0&&(e=0);var r=Xt.document.createElement("canvas"),a=r.getContext("2d");if(!a)throw new Error("failed to create canvas 2d context");return r.width=t.width,r.height=t.height,a.drawImage(t,0,0,t.width,t.height),a.getImageData(-e,-e,t.width+2*e,t.height+2*e)},resolveURL:function(t){return Wn||(Wn=Xt.document.createElement("a")),Wn.href=t,Wn.href},hardwareConcurrency:Xt.navigator&&Xt.navigator.hardwareConcurrency||4,get devicePixelRatio(){return Xt.devicePixelRatio},get prefersReducedMotion(){return!!Xt.matchMedia&&(Pi==null&&(Pi=Xt.matchMedia("(prefers-reduced-motion: reduce)")),Pi.matches)}},Kt={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},vn={supported:!1,testSupport:function(t){!_n&&$i&&(qe?We(t):Zn=t)}},_n=!1,qe=!1;function We(t){var e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,$i),t.isContextLost())return;vn.supported=!0}catch{}t.deleteTexture(e),_n=!0}Xt.document&&(($i=Xt.document.createElement("img")).onload=function(){Zn&&We(Zn),Zn=null,qe=!0},$i.onerror=function(){_n=!0,Zn=null},$i.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var _i="01",mr=function(t,e){this._transformRequestFn=t,this._customAccessToken=e,this._createSkuToken()};function Ve(t){return t.indexOf("mapbox:")===0}mr.prototype._createSkuToken=function(){var t=function(){for(var e="",r=0;r<10;r++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",_i,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt},mr.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},mr.prototype.transformRequest=function(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}},mr.prototype.normalizeStyleURL=function(t,e){if(!Ve(t))return t;var r=dn(t);return r.path="/styles/v1"+r.path,this._makeAPIURL(r,this._customAccessToken||e)},mr.prototype.normalizeGlyphsURL=function(t,e){if(!Ve(t))return t;var r=dn(t);return r.path="/fonts/v1"+r.path,this._makeAPIURL(r,this._customAccessToken||e)},mr.prototype.normalizeSourceURL=function(t,e){if(!Ve(t))return t;var r=dn(t);return r.path="/v4/"+r.authority+".json",r.params.push("secure"),this._makeAPIURL(r,this._customAccessToken||e)},mr.prototype.normalizeSpriteURL=function(t,e,r,a){var u=dn(t);return Ve(t)?(u.path="/styles/v1"+u.path+"/sprite"+e+r,this._makeAPIURL(u,this._customAccessToken||a)):(u.path+=""+e+r,An(u))},mr.prototype.normalizeTileURL=function(t,e){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!Ve(t))return t;var r=dn(t);r.path=r.path.replace(/(\.(png|jpg)\d*)(?=$)/,(vi.devicePixelRatio>=2||e===512?"@2x":"")+(vn.supported?".webp":"$1")),r.path=r.path.replace(/^.+\/v4\//,"/"),r.path="/v4"+r.path;var a=this._customAccessToken||function(u){for(var c=0,f=u;c<f.length;c+=1){var y=f[c].match(/^access_token=(.*)$/);if(y)return y[1]}return null}(r.params)||Kt.ACCESS_TOKEN;return Kt.REQUIRE_ACCESS_TOKEN&&a&&this._skuToken&&r.params.push("sku="+this._skuToken),this._makeAPIURL(r,a)},mr.prototype.canonicalizeTileURL=function(t,e){var r=dn(t);if(!r.path.match(/(^\/v4\/)/)||!r.path.match(/\.[\w]+$/))return t;var a="mapbox://tiles/";a+=r.path.replace("/v4/","");var u=r.params;return e&&(u=u.filter(function(c){return!c.match(/^access_token=/)})),u.length&&(a+="?"+u.join("&")),a},mr.prototype.canonicalizeTileset=function(t,e){for(var r=!!e&&Ve(e),a=[],u=0,c=t.tiles||[];u<c.length;u+=1){var f=c[u];xi(f)?a.push(this.canonicalizeTileURL(f,r)):a.push(f)}return a},mr.prototype._makeAPIURL=function(t,e){var r="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",a=dn(Kt.API_URL);if(t.protocol=a.protocol,t.authority=a.authority,t.protocol==="http"){var u=t.params.indexOf("secure");u>=0&&t.params.splice(u,1)}if(a.path!=="/"&&(t.path=""+a.path+t.path),!Kt.REQUIRE_ACCESS_TOKEN)return An(t);if(!(e=e||Kt.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+r);if(e[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+r);return t.params=t.params.filter(function(c){return c.indexOf("access_token")===-1}),t.params.push("access_token="+e),An(t)};var ra=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function xi(t){return ra.test(t)}var Xo=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function dn(t){var e=t.match(Xo);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function An(t){var e=t.params.length?"?"+t.params.join("&"):"";return t.protocol+"://"+t.authority+t.path+e}function _r(t){if(!t)return null;var e=t.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(Xt.atob(e[1]).split("").map(function(r){return"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch{return null}}var xn=function(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};xn.prototype.getStorageKey=function(t){var e,r=_r(Kt.ACCESS_TOKEN);return e=r&&r.u?Xt.btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,function(a,u){return String.fromCharCode(+("0x"+u))})):Kt.ACCESS_TOKEN||"",t?"mapbox.eventData."+t+":"+e:"mapbox.eventData:"+e},xn.prototype.fetchEventData=function(){var t=Cn("localStorage"),e=this.getStorageKey(),r=this.getStorageKey("uuid");if(t)try{var a=Xt.localStorage.getItem(e);a&&(this.eventData=JSON.parse(a));var u=Xt.localStorage.getItem(r);u&&(this.anonId=u)}catch{wr("Unable to read from LocalStorage")}},xn.prototype.saveEventData=function(){var t=Cn("localStorage"),e=this.getStorageKey(),r=this.getStorageKey("uuid");if(t)try{Xt.localStorage.setItem(r,this.anonId),Object.keys(this.eventData).length>=1&&Xt.localStorage.setItem(e,JSON.stringify(this.eventData))}catch{wr("Unable to write to LocalStorage")}},xn.prototype.processRequests=function(t){},xn.prototype.postEvent=function(t,e,r,a){var u=this;if(Kt.EVENTS_URL){var c=dn(Kt.EVENTS_URL);c.params.push("access_token="+(a||Kt.ACCESS_TOKEN||""));var f={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.3",skuId:_i,userId:this.anonId},y=e?hr(f,e):f,x={url:An(c),headers:{"Content-Type":"text/plain"},body:JSON.stringify([y])};this.pendingRequest=Tr(x,function(w){u.pendingRequest=null,r(w),u.saveEventData(),u.processRequests(a)})}},xn.prototype.queueRequest=function(t,e){this.queue.push(t),this.processRequests(e)};var Hn,bi,rn=function(t){function e(){t.call(this,"map.load"),this.success={},this.skuToken=""}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.postMapLoadEvent=function(r,a,u,c){this.skuToken=u;var f=!(!c&&!Kt.ACCESS_TOKEN),y=Array.isArray(r)&&r.some(function(x){return Ve(x)||xi(x)});Kt.EVENTS_URL&&f&&y&&this.queueRequest({id:a,timestamp:Date.now()},c)},e.prototype.processRequests=function(r){var a=this;if(!this.pendingRequest&&this.queue.length!==0){var u=this.queue.shift(),c=u.id,f=u.timestamp;c&&this.success[c]||(this.anonId||this.fetchEventData(),Rn(this.anonId)||(this.anonId=Cr()),this.postEvent(f,{skuToken:this.skuToken},function(y){y||c&&(a.success[c]=!0)},r))}},e}(xn),Gn=new(function(t){function e(r){t.call(this,"appUserTurnstile"),this._customAccessToken=r}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.postTurnstileEvent=function(r,a){Kt.EVENTS_URL&&Kt.ACCESS_TOKEN&&Array.isArray(r)&&r.some(function(u){return Ve(u)||xi(u)})&&this.queueRequest(Date.now(),a)},e.prototype.processRequests=function(r){var a=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var u=_r(Kt.ACCESS_TOKEN),c=u?u.u:Kt.ACCESS_TOKEN,f=c!==this.eventData.tokenU;Rn(this.anonId)||(this.anonId=Cr(),f=!0);var y=this.queue.shift();if(this.eventData.lastSuccess){var x=new Date(this.eventData.lastSuccess),w=new Date(y),I=(y-this.eventData.lastSuccess)/864e5;f=f||I>=1||I<-1||x.getDate()!==w.getDate()}else f=!0;if(!f)return this.processRequests();this.postEvent(y,{"enabled.telemetry":!1},function(A){A||(a.eventData.lastSuccess=y,a.eventData.tokenU=c)},r)}},e}(xn)),fo=Gn.postTurnstileEvent.bind(Gn),Mi=new rn,zi=Mi.postMapLoadEvent.bind(Mi),Di=500,Pn=50;function wi(){Xt.caches&&!Hn&&(Hn=Xt.caches.open("mapbox-tiles"))}function Li(t){var e=t.indexOf("?");return e<0?t:t.slice(0,e)}var kn,xe=1/0;function ii(){return kn==null&&(kn=Xt.OffscreenCanvas&&new Xt.OffscreenCanvas(1,1).getContext("2d")&&typeof Xt.createImageBitmap=="function"),kn}var Jn={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Jn);var Oi=function(t){function e(r,a,u){a===401&&xi(u)&&(r+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),t.call(this,r),this.status=a,this.url=u,this.name=this.constructor.name,this.message=r}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},e}(Error),pe=hn()?function(){return self.worker&&self.worker.referrer}:function(){return(Xt.location.protocol==="blob:"?Xt.parent:Xt).location.href},mn,oi,Yn=function(t,e){if(!(/^file:/.test(r=t.url)||/^file:/.test(pe())&&!/^\w+:/.test(r))){if(Xt.fetch&&Xt.Request&&Xt.AbortController&&Xt.Request.prototype.hasOwnProperty("signal"))return function(a,u){var c,f=new Xt.AbortController,y=new Xt.Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:pe(),signal:f.signal}),x=!1,w=!1,I=(c=y.url).indexOf("sku=")>0&&xi(c);a.type==="json"&&y.headers.set("Accept","application/json");var A=function(O,Z,X){if(!w){if(O&&O.message!=="SecurityError"&&wr(O),Z&&X)return z(Z);var rt=Date.now();Xt.fetch(y).then(function(Y){if(Y.ok){var ct=I?Y.clone():null;return z(Y,ct,rt)}return u(new Oi(Y.statusText,Y.status,a.url))}).catch(function(Y){Y.code!==20&&u(new Error(Y.message))})}},z=function(O,Z,X){(a.type==="arrayBuffer"?O.arrayBuffer():a.type==="json"?O.json():O.text()).then(function(rt){w||(Z&&X&&function(Y,ct,vt){if(wi(),Hn){var xt={status:ct.status,statusText:ct.statusText,headers:new Xt.Headers};ct.headers.forEach(function(Mt,Ut){return xt.headers.set(Ut,Mt)});var Tt=ho(ct.headers.get("Cache-Control")||"");Tt["no-store"]||(Tt["max-age"]&&xt.headers.set("Expires",new Date(vt+1e3*Tt["max-age"]).toUTCString()),new Date(xt.headers.get("Expires")).getTime()-vt<42e4||function(Mt,Ut){if(bi===void 0)try{new Response(new ReadableStream),bi=!0}catch{bi=!1}bi?Ut(Mt.body):Mt.blob().then(Ut)}(ct,function(Mt){var Ut=new Xt.Response(Mt,xt);wi(),Hn&&Hn.then(function(Jt){return Jt.put(Li(Y.url),Ut)}).catch(function(Jt){return wr(Jt.message)})}))}}(y,Z,X),x=!0,u(null,rt,O.headers.get("Cache-Control"),O.headers.get("Expires")))}).catch(function(rt){w||u(new Error(rt.message))})};return I?function(O,Z){if(wi(),!Hn)return Z(null);var X=Li(O.url);Hn.then(function(rt){rt.match(X).then(function(Y){var ct=function(vt){if(!vt)return!1;var xt=new Date(vt.headers.get("Expires")||0),Tt=ho(vt.headers.get("Cache-Control")||"");return xt>Date.now()&&!Tt["no-cache"]}(Y);rt.delete(X),ct&&rt.put(X,Y.clone()),Z(null,Y,ct)}).catch(Z)}).catch(Z)}(y,A):A(null,null),{cancel:function(){w=!0,x||f.abort()}}}(t,e);if(hn()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var r;return function(a,u){var c=new Xt.XMLHttpRequest;for(var f in c.open(a.method||"GET",a.url,!0),a.type==="arrayBuffer"&&(c.responseType="arraybuffer"),a.headers)c.setRequestHeader(f,a.headers[f]);return a.type==="json"&&(c.responseType="text",c.setRequestHeader("Accept","application/json")),c.withCredentials=a.credentials==="include",c.onerror=function(){u(new Error(c.statusText))},c.onload=function(){if((c.status>=200&&c.status<300||c.status===0)&&c.response!==null){var y=c.response;if(a.type==="json")try{y=JSON.parse(c.response)}catch(x){return u(x)}u(null,y,c.getResponseHeader("Cache-Control"),c.getResponseHeader("Expires"))}else u(new Oi(c.statusText,c.status,a.url))},c.send(a.body),{cancel:function(){return c.abort()}}}(t,e)},mo=function(t,e){return Yn(hr(t,{type:"arrayBuffer"}),e)},Tr=function(t,e){return Yn(hr(t,{method:"POST"}),e)},C="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";mn=[],oi=0;var M=function(t,e){if(vn.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),oi>=Kt.MAX_PARALLEL_IMAGE_REQUESTS){var r={requestParameters:t,callback:e,cancelled:!1,cancel:function(){this.cancelled=!0}};return mn.push(r),r}oi++;var a=!1,u=function(){if(!a)for(a=!0,oi--;mn.length&&oi<Kt.MAX_PARALLEL_IMAGE_REQUESTS;){var f=mn.shift();f.cancelled||(f.cancel=M(f.requestParameters,f.callback).cancel)}},c=mo(t,function(f,y,x,w){u(),f?e(f):y&&(ii()?function(I,A){var z=new Xt.Blob([new Uint8Array(I)],{type:"image/png"});Xt.createImageBitmap(z).then(function(O){A(null,O)}).catch(function(O){A(new Error("Could not load image because of "+O.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(y,e):function(I,A,z,O){var Z=new Xt.Image,X=Xt.URL;Z.onload=function(){A(null,Z),X.revokeObjectURL(Z.src),Z.onload=null,Xt.requestAnimationFrame(function(){Z.src=C})},Z.onerror=function(){return A(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var rt=new Xt.Blob([new Uint8Array(I)],{type:"image/png"});Z.cacheControl=z,Z.expires=O,Z.src=I.byteLength?X.createObjectURL(rt):C}(y,e,x,w))});return{cancel:function(){c.cancel(),u()}}};function D(t,e,r){r[t]&&r[t].indexOf(e)!==-1||(r[t]=r[t]||[],r[t].push(e))}function U(t,e,r){if(r&&r[t]){var a=r[t].indexOf(e);a!==-1&&r[t].splice(a,1)}}var G=function(t,e){e===void 0&&(e={}),hr(this,e),this.type=t},nt=function(t){function e(r,a){a===void 0&&(a={}),t.call(this,"error",hr({error:r},a))}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(G),$=function(){};$.prototype.on=function(t,e){return this._listeners=this._listeners||{},D(t,e,this._listeners),this},$.prototype.off=function(t,e){return U(t,e,this._listeners),U(t,e,this._oneTimeListeners),this},$.prototype.once=function(t,e){return this._oneTimeListeners=this._oneTimeListeners||{},D(t,e,this._oneTimeListeners),this},$.prototype.fire=function(t,e){typeof t=="string"&&(t=new G(t,e||{}));var r=t.type;if(this.listens(r)){t.target=this;for(var a=0,u=this._listeners&&this._listeners[r]?this._listeners[r].slice():[];a<u.length;a+=1)u[a].call(this,t);for(var c=0,f=this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[];c<f.length;c+=1){var y=f[c];U(r,y,this._oneTimeListeners),y.call(this,t)}var x=this._eventedParent;x&&(hr(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),x.fire(t))}else t instanceof nt&&console.error(t.error);return this},$.prototype.listens=function(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)},$.prototype.setEventedParent=function(t,e){return this._eventedParent=t,this._eventedParentData=e,this};var L={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},J=function(t,e,r,a){this.message=(t?t+": ":"")+r,a&&(this.identifier=a),e!=null&&e.__line__&&(this.line=e.__line__)};function st(t){var e=t.value;return e?[new J(t.key,e,"constants have been deprecated as of v8")]:[]}function zt(t){for(var e=[],r=arguments.length-1;r-- >0;)e[r]=arguments[r+1];for(var a=0,u=e;a<u.length;a+=1){var c=u[a];for(var f in c)t[f]=c[f]}return t}function Bt(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Et(t){if(Array.isArray(t))return t.map(Et);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){var e={};for(var r in t)e[r]=Et(t[r]);return e}return Bt(t)}var kt=function(t){function e(r,a){t.call(this,a),this.message=a,this.key=r}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(Error),oe=function(t,e){e===void 0&&(e=[]),this.parent=t,this.bindings={};for(var r=0,a=e;r<a.length;r+=1){var u=a[r];this.bindings[u[0]]=u[1]}};oe.prototype.concat=function(t){return new oe(this,t)},oe.prototype.get=function(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")},oe.prototype.has=function(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)};var Wt={kind:"null"},St={kind:"number"},ie={kind:"string"},jt={kind:"boolean"},Yt={kind:"color"},Re={kind:"object"},te={kind:"value"},Ye={kind:"collator"},Fe={kind:"formatted"},Ne={kind:"resolvedImage"};function He(t,e){return{kind:"array",itemType:t,N:e}}function er(t){if(t.kind==="array"){var e=er(t.itemType);return typeof t.N=="number"?"array<"+e+", "+t.N+">":t.itemType.kind==="value"?"array":"array<"+e+">"}return t.kind}var Zr=[Wt,St,ie,jt,Yt,Fe,Re,He(te),Ne];function ur(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!ur(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(var r=0,a=Zr;r<a.length;r+=1)if(!ur(a[r],e))return null}}return"Expected "+er(t)+" but found "+er(e)+" instead."}function kr(t,e){return e.some(function(r){return r.kind===t.kind})}function yr(t,e){return e.some(function(r){return r==="null"?t===null:r==="array"?Array.isArray(t):r==="object"?t&&!Array.isArray(t)&&typeof t=="object":r===typeof t})}var Ze=sr(function(t,e){var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function a(y){return(y=Math.round(y))<0?0:y>255?255:y}function u(y){return a(y[y.length-1]==="%"?parseFloat(y)/100*255:parseInt(y))}function c(y){return(x=y[y.length-1]==="%"?parseFloat(y)/100:parseFloat(y))<0?0:x>1?1:x;var x}function f(y,x,w){return w<0?w+=1:w>1&&(w-=1),6*w<1?y+(x-y)*w*6:2*w<1?x:3*w<2?y+(x-y)*(2/3-w)*6:y}try{e.parseCSSColor=function(y){var x,w=y.replace(/ /g,"").toLowerCase();if(w in r)return r[w].slice();if(w[0]==="#")return w.length===4?(x=parseInt(w.substr(1),16))>=0&&x<=4095?[(3840&x)>>4|(3840&x)>>8,240&x|(240&x)>>4,15&x|(15&x)<<4,1]:null:w.length===7&&(x=parseInt(w.substr(1),16))>=0&&x<=16777215?[(16711680&x)>>16,(65280&x)>>8,255&x,1]:null;var I=w.indexOf("("),A=w.indexOf(")");if(I!==-1&&A+1===w.length){var z=w.substr(0,I),O=w.substr(I+1,A-(I+1)).split(","),Z=1;switch(z){case"rgba":if(O.length!==4)return null;Z=c(O.pop());case"rgb":return O.length!==3?null:[u(O[0]),u(O[1]),u(O[2]),Z];case"hsla":if(O.length!==4)return null;Z=c(O.pop());case"hsl":if(O.length!==3)return null;var X=(parseFloat(O[0])%360+360)%360/360,rt=c(O[1]),Y=c(O[2]),ct=Y<=.5?Y*(rt+1):Y+rt-Y*rt,vt=2*Y-ct;return[a(255*f(vt,ct,X+1/3)),a(255*f(vt,ct,X)),a(255*f(vt,ct,X-1/3)),Z];default:return null}}return null}}catch{}}).parseCSSColor,lr=function(t,e,r,a){a===void 0&&(a=1),this.r=t,this.g=e,this.b=r,this.a=a};lr.parse=function(t){if(t){if(t instanceof lr)return t;if(typeof t=="string"){var e=Ze(t);if(e)return new lr(e[0]/255*e[3],e[1]/255*e[3],e[2]/255*e[3],e[3])}}},lr.prototype.toString=function(){var t=this.toArray(),e=t[1],r=t[2],a=t[3];return"rgba("+Math.round(t[0])+","+Math.round(e)+","+Math.round(r)+","+a+")"},lr.prototype.toArray=function(){var t=this.a;return t===0?[0,0,0,0]:[255*this.r/t,255*this.g/t,255*this.b/t,t]},lr.black=new lr(0,0,0,1),lr.white=new lr(1,1,1,1),lr.transparent=new lr(0,0,0,0),lr.red=new lr(1,0,0,1);var Gr=function(t,e,r){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Gr.prototype.compare=function(t,e){return this.collator.compare(t,e)},Gr.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var v=function(t,e,r,a,u){this.text=t,this.image=e,this.scale=r,this.fontStack=a,this.textColor=u},E=function(t){this.sections=t};E.fromString=function(t){return new E([new v(t,null,null,null,null)])},E.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(t){return t.text.length!==0||t.image&&t.image.name.length!==0})},E.factory=function(t){return t instanceof E?t:E.fromString(t)},E.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(t){return t.text}).join("")},E.prototype.serialize=function(){for(var t=["format"],e=0,r=this.sections;e<r.length;e+=1){var a=r[e];if(a.image)t.push(["image",a.image.name]);else{t.push(a.text);var u={};a.fontStack&&(u["text-font"]=["literal",a.fontStack.split(",")]),a.scale&&(u["font-scale"]=a.scale),a.textColor&&(u["text-color"]=["rgba"].concat(a.textColor.toArray())),t.push(u)}}return t};var j=function(t){this.name=t.name,this.available=t.available};function bt(t,e,r,a){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:"Invalid rgba value ["+[t,e,r,a].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof a=="number"?[t,e,r,a]:[t,e,r]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function ut(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof lr||t instanceof Gr||t instanceof E||t instanceof j)return!0;if(Array.isArray(t)){for(var e=0,r=t;e<r.length;e+=1)if(!ut(r[e]))return!1;return!0}if(typeof t=="object"){for(var a in t)if(!ut(t[a]))return!1;return!0}return!1}function V(t){if(t===null)return Wt;if(typeof t=="string")return ie;if(typeof t=="boolean")return jt;if(typeof t=="number")return St;if(t instanceof lr)return Yt;if(t instanceof Gr)return Ye;if(t instanceof E)return Fe;if(t instanceof j)return Ne;if(Array.isArray(t)){for(var e,r=t.length,a=0,u=t;a<u.length;a+=1){var c=V(u[a]);if(e){if(e===c)continue;e=te;break}e=c}return He(e||te,r)}return Re}function Nt(t){var e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof lr||t instanceof E||t instanceof j?t.toString():JSON.stringify(t)}j.prototype.toString=function(){return this.name},j.fromString=function(t){return t?new j({name:t,available:!1}):null},j.prototype.serialize=function(){return["image",this.name]};var Gt=function(t,e){this.type=t,this.value=e};Gt.parse=function(t,e){if(t.length!==2)return e.error("'literal' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(!ut(t[1]))return e.error("invalid value");var r=t[1],a=V(r),u=e.expectedType;return a.kind!=="array"||a.N!==0||!u||u.kind!=="array"||typeof u.N=="number"&&u.N!==0||(a=u),new Gt(a,r)},Gt.prototype.evaluate=function(){return this.value},Gt.prototype.eachChild=function(){},Gt.prototype.outputDefined=function(){return!0},Gt.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof lr?["rgba"].concat(this.value.toArray()):this.value instanceof E?this.value.serialize():this.value};var Vt=function(t){this.name="ExpressionEvaluationError",this.message=t};Vt.prototype.toJSON=function(){return this.message};var Lt={string:ie,number:St,boolean:jt,object:Re},se=function(t,e){this.type=t,this.args=e};se.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var r,a=1,u=t[0];if(u==="array"){var c,f;if(t.length>2){var y=t[1];if(typeof y!="string"||!(y in Lt)||y==="object")return e.error('The item type argument of "array" must be one of string, number, boolean',1);c=Lt[y],a++}else c=te;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return e.error('The length argument to "array" must be a positive integer literal',2);f=t[2],a++}r=He(c,f)}else r=Lt[u];for(var x=[];a<t.length;a++){var w=e.parse(t[a],a,te);if(!w)return null;x.push(w)}return new se(r,x)},se.prototype.evaluate=function(t){for(var e=0;e<this.args.length;e++){var r=this.args[e].evaluate(t);if(!ur(this.type,V(r)))return r;if(e===this.args.length-1)throw new Vt("Expected value to be of type "+er(this.type)+", but found "+er(V(r))+" instead.")}return null},se.prototype.eachChild=function(t){this.args.forEach(t)},se.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},se.prototype.serialize=function(){var t=this.type,e=[t.kind];if(t.kind==="array"){var r=t.itemType;if(r.kind==="string"||r.kind==="number"||r.kind==="boolean"){e.push(r.kind);var a=t.N;(typeof a=="number"||this.args.length>1)&&e.push(a)}}return e.concat(this.args.map(function(u){return u.serialize()}))};var Ce=function(t){this.type=Fe,this.sections=t};Ce.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var r=t[1];if(!Array.isArray(r)&&typeof r=="object")return e.error("First argument must be an image or text section.");for(var a=[],u=!1,c=1;c<=t.length-1;++c){var f=t[c];if(u&&typeof f=="object"&&!Array.isArray(f)){u=!1;var y=null;if(f["font-scale"]&&!(y=e.parse(f["font-scale"],1,St)))return null;var x=null;if(f["text-font"]&&!(x=e.parse(f["text-font"],1,He(ie))))return null;var w=null;if(f["text-color"]&&!(w=e.parse(f["text-color"],1,Yt)))return null;var I=a[a.length-1];I.scale=y,I.font=x,I.textColor=w}else{var A=e.parse(t[c],1,te);if(!A)return null;var z=A.type.kind;if(z!=="string"&&z!=="value"&&z!=="null"&&z!=="resolvedImage")return e.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");u=!0,a.push({content:A,scale:null,font:null,textColor:null})}}return new Ce(a)},Ce.prototype.evaluate=function(t){return new E(this.sections.map(function(e){var r=e.content.evaluate(t);return V(r)===Ne?new v("",r,null,null,null):new v(Nt(r),null,e.scale?e.scale.evaluate(t):null,e.font?e.font.evaluate(t).join(","):null,e.textColor?e.textColor.evaluate(t):null)}))},Ce.prototype.eachChild=function(t){for(var e=0,r=this.sections;e<r.length;e+=1){var a=r[e];t(a.content),a.scale&&t(a.scale),a.font&&t(a.font),a.textColor&&t(a.textColor)}},Ce.prototype.outputDefined=function(){return!1},Ce.prototype.serialize=function(){for(var t=["format"],e=0,r=this.sections;e<r.length;e+=1){var a=r[e];t.push(a.content.serialize());var u={};a.scale&&(u["font-scale"]=a.scale.serialize()),a.font&&(u["text-font"]=a.font.serialize()),a.textColor&&(u["text-color"]=a.textColor.serialize()),t.push(u)}return t};var tr=function(t){this.type=Ne,this.input=t};tr.parse=function(t,e){if(t.length!==2)return e.error("Expected two arguments.");var r=e.parse(t[1],1,ie);return r?new tr(r):e.error("No image name provided.")},tr.prototype.evaluate=function(t){var e=this.input.evaluate(t),r=j.fromString(e);return r&&t.availableImages&&(r.available=t.availableImages.indexOf(e)>-1),r},tr.prototype.eachChild=function(t){t(this.input)},tr.prototype.outputDefined=function(){return!1},tr.prototype.serialize=function(){return["image",this.input.serialize()]};var bn={"to-boolean":jt,"to-color":Yt,"to-number":St,"to-string":ie},Mr=function(t,e){this.type=t,this.args=e};Mr.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var r=t[0];if((r==="to-boolean"||r==="to-string")&&t.length!==2)return e.error("Expected one argument.");for(var a=bn[r],u=[],c=1;c<t.length;c++){var f=e.parse(t[c],c,te);if(!f)return null;u.push(f)}return new Mr(a,u)},Mr.prototype.evaluate=function(t){if(this.type.kind==="boolean")return!!this.args[0].evaluate(t);if(this.type.kind==="color"){for(var e,r,a=0,u=this.args;a<u.length;a+=1){if(r=null,(e=u[a].evaluate(t))instanceof lr)return e;if(typeof e=="string"){var c=t.parseColor(e);if(c)return c}else if(Array.isArray(e)&&!(r=e.length<3||e.length>4?"Invalid rbga value "+JSON.stringify(e)+": expected an array containing either three or four numeric values.":bt(e[0],e[1],e[2],e[3])))return new lr(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new Vt(r||"Could not parse color from value '"+(typeof e=="string"?e:String(JSON.stringify(e)))+"'")}if(this.type.kind==="number"){for(var f=null,y=0,x=this.args;y<x.length;y+=1){if((f=x[y].evaluate(t))===null)return 0;var w=Number(f);if(!isNaN(w))return w}throw new Vt("Could not convert "+JSON.stringify(f)+" to number.")}return this.type.kind==="formatted"?E.fromString(Nt(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?j.fromString(Nt(this.args[0].evaluate(t))):Nt(this.args[0].evaluate(t))},Mr.prototype.eachChild=function(t){this.args.forEach(t)},Mr.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},Mr.prototype.serialize=function(){if(this.type.kind==="formatted")return new Ce([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new tr(this.args[0]).serialize();var t=["to-"+this.type.kind];return this.eachChild(function(e){t.push(e.serialize())}),t};var Ft=["Unknown","Point","LineString","Polygon"],me=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};me.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},me.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?Ft[this.feature.type]:this.feature.type:null},me.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},me.prototype.canonicalID=function(){return this.canonical},me.prototype.properties=function(){return this.feature&&this.feature.properties||{}},me.prototype.parseColor=function(t){var e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=lr.parse(t)),e};var Ke=function(t,e,r,a){this.name=t,this.type=e,this._evaluate=r,this.args=a};Ke.prototype.evaluate=function(t){return this._evaluate(t,this.args)},Ke.prototype.eachChild=function(t){this.args.forEach(t)},Ke.prototype.outputDefined=function(){return!1},Ke.prototype.serialize=function(){return[this.name].concat(this.args.map(function(t){return t.serialize()}))},Ke.parse=function(t,e){var r,a=t[0],u=Ke.definitions[a];if(!u)return e.error('Unknown expression "'+a+'". If you wanted a literal array, use ["literal", [...]].',0);for(var c=Array.isArray(u)?u[0]:u.type,f=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,y=f.filter(function(Ee){var le=Ee[0];return!Array.isArray(le)||le.length===t.length-1}),x=null,w=0,I=y;w<I.length;w+=1){var A=I[w],z=A[0],O=A[1];x=new Fi(e.registry,e.path,null,e.scope);for(var Z=[],X=!1,rt=1;rt<t.length;rt++){var Y=t[rt],ct=Array.isArray(z)?z[rt-1]:z.type,vt=x.parse(Y,1+Z.length,ct);if(!vt){X=!0;break}Z.push(vt)}if(!X)if(Array.isArray(z)&&z.length!==Z.length)x.error("Expected "+z.length+" arguments, but found "+Z.length+" instead.");else{for(var xt=0;xt<Z.length;xt++){var Tt=Array.isArray(z)?z[xt]:z.type,Mt=Z[xt];x.concat(xt+1).checkSubtype(Tt,Mt.type)}if(x.errors.length===0)return new Ke(a,c,O,Z)}}if(y.length===1)(r=e.errors).push.apply(r,x.errors);else{for(var Ut=(y.length?y:f).map(function(Ee){var le;return le=Ee[0],Array.isArray(le)?"("+le.map(er).join(", ")+")":"("+er(le.type)+"...)"}).join(" | "),Jt=[],_e=1;_e<t.length;_e++){var ue=e.parse(t[_e],1+Jt.length);if(!ue)return null;Jt.push(er(ue.type))}e.error("Expected arguments of type "+Ut+", but found ("+Jt.join(", ")+") instead.")}return null},Ke.register=function(t,e){for(var r in Ke.definitions=e,e)t[r]=Ke};var ze=function(t,e,r){this.type=Ye,this.locale=r,this.caseSensitive=t,this.diacriticSensitive=e};function Fr(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function Ri(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function qa(t,e){var r=(180+t[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(r*u*8192),Math.round(a*u*8192)]}function nn(t,e,r){return e[1]>t[1]!=r[1]>t[1]&&t[0]<(r[0]-e[0])*(t[1]-e[1])/(r[1]-e[1])+e[0]}function Oo(t,e){for(var r,a,u,c,f,y,x,w=!1,I=0,A=e.length;I<A;I++)for(var z=e[I],O=0,Z=z.length;O<Z-1;O++){if((c=(r=t)[0]-(a=z[O])[0])*(x=r[1]-(u=z[O+1])[1])-(y=r[0]-u[0])*(f=r[1]-a[1])==0&&c*y<=0&&f*x<=0)return!1;nn(t,z[O],z[O+1])&&(w=!w)}return w}function Za(t,e){for(var r=0;r<e.length;r++)if(Oo(t,e[r]))return!0;return!1}function yo(t,e,r,a){var u=a[0]-r[0],c=a[1]-r[1],f=(t[0]-r[0])*c-u*(t[1]-r[1]),y=(e[0]-r[0])*c-u*(e[1]-r[1]);return f>0&&y<0||f<0&&y>0}function Ls(t,e,r){for(var a=0,u=r;a<u.length;a+=1)for(var c=u[a],f=0;f<c.length-1;++f)if((A=[(I=c[f+1])[0]-(w=c[f])[0],I[1]-w[1]])[0]*(z=[(x=e)[0]-(y=t)[0],x[1]-y[1]])[1]-A[1]*z[0]!=0&&yo(y,x,w,I)&&yo(w,I,y,x))return!0;var y,x,w,I,A,z;return!1}function ls(t,e){for(var r=0;r<t.length;++r)if(!Oo(t[r],e))return!1;for(var a=0;a<t.length-1;++a)if(Ls(t[a],t[a+1],e))return!1;return!0}function wn(t,e){for(var r=0;r<e.length;r++)if(ls(t,e[r]))return!0;return!1}function $n(t,e,r){for(var a=[],u=0;u<t.length;u++){for(var c=[],f=0;f<t[u].length;f++){var y=qa(t[u][f],r);Fr(e,y),c.push(y)}a.push(c)}return a}function Wo(t,e,r){for(var a=[],u=0;u<t.length;u++){var c=$n(t[u],e,r);a.push(c)}return a}function go(t,e,r,a){if(t[0]<r[0]||t[0]>r[2]){var u=.5*a,c=t[0]-r[0]>u?-a:r[0]-t[0]>u?a:0;c===0&&(c=t[0]-r[2]>u?-a:r[2]-t[0]>u?a:0),t[0]+=c}Fr(e,t)}function Ga(t,e,r,a){for(var u=8192*Math.pow(2,a.z),c=[8192*a.x,8192*a.y],f=[],y=0,x=t;y<x.length;y+=1)for(var w=0,I=x[y];w<I.length;w+=1){var A=I[w],z=[A.x+c[0],A.y+c[1]];go(z,e,r,u),f.push(z)}return f}function Ki(t,e,r,a){for(var u,c=8192*Math.pow(2,a.z),f=[8192*a.x,8192*a.y],y=[],x=0,w=t;x<w.length;x+=1){for(var I=[],A=0,z=w[x];A<z.length;A+=1){var O=z[A],Z=[O.x+f[0],O.y+f[1]];Fr(e,Z),I.push(Z)}y.push(I)}if(e[2]-e[0]<=c/2){(u=e)[0]=u[1]=1/0,u[2]=u[3]=-1/0;for(var X=0,rt=y;X<rt.length;X+=1)for(var Y=0,ct=rt[X];Y<ct.length;Y+=1)go(ct[Y],e,r,c)}return y}ze.parse=function(t,e){if(t.length!==2)return e.error("Expected one argument.");var r=t[1];if(typeof r!="object"||Array.isArray(r))return e.error("Collator options argument must be an object.");var a=e.parse(r["case-sensitive"]!==void 0&&r["case-sensitive"],1,jt);if(!a)return null;var u=e.parse(r["diacritic-sensitive"]!==void 0&&r["diacritic-sensitive"],1,jt);if(!u)return null;var c=null;return r.locale&&!(c=e.parse(r.locale,1,ie))?null:new ze(a,u,c)},ze.prototype.evaluate=function(t){return new Gr(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)},ze.prototype.eachChild=function(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)},ze.prototype.outputDefined=function(){return!1},ze.prototype.serialize=function(){var t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]};var Bi=function(t,e){this.type=jt,this.geojson=t,this.geometries=e};function Fn(t){if(t instanceof Ke&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof Bi)return!1;var e=!0;return t.eachChild(function(r){e&&!Fn(r)&&(e=!1)}),e}function Qi(t){if(t instanceof Ke&&t.name==="feature-state")return!1;var e=!0;return t.eachChild(function(r){e&&!Qi(r)&&(e=!1)}),e}function Ro(t,e){if(t instanceof Ke&&e.indexOf(t.name)>=0)return!1;var r=!0;return t.eachChild(function(a){r&&!Ro(a,e)&&(r=!1)}),r}Bi.parse=function(t,e){if(t.length!==2)return e.error("'within' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(ut(t[1])){var r=t[1];if(r.type==="FeatureCollection")for(var a=0;a<r.features.length;++a){var u=r.features[a].geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new Bi(r,r.features[a].geometry)}else if(r.type==="Feature"){var c=r.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new Bi(r,r.geometry)}else if(r.type==="Polygon"||r.type==="MultiPolygon")return new Bi(r,r)}return e.error("'within' expression requires valid geojson object that contains polygon geometry type.")},Bi.prototype.evaluate=function(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(e,r){var a=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],c=e.canonicalID();if(r.type==="Polygon"){var f=$n(r.coordinates,u,c),y=Ga(e.geometry(),a,u,c);if(!Ri(a,u))return!1;for(var x=0,w=y;x<w.length;x+=1)if(!Oo(w[x],f))return!1}if(r.type==="MultiPolygon"){var I=Wo(r.coordinates,u,c),A=Ga(e.geometry(),a,u,c);if(!Ri(a,u))return!1;for(var z=0,O=A;z<O.length;z+=1)if(!Za(O[z],I))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(e,r){var a=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],c=e.canonicalID();if(r.type==="Polygon"){var f=$n(r.coordinates,u,c),y=Ki(e.geometry(),a,u,c);if(!Ri(a,u))return!1;for(var x=0,w=y;x<w.length;x+=1)if(!ls(w[x],f))return!1}if(r.type==="MultiPolygon"){var I=Wo(r.coordinates,u,c),A=Ki(e.geometry(),a,u,c);if(!Ri(a,u))return!1;for(var z=0,O=A;z<O.length;z+=1)if(!wn(O[z],I))return!1}return!0}(t,this.geometries)}return!1},Bi.prototype.eachChild=function(){},Bi.prototype.outputDefined=function(){return!0},Bi.prototype.serialize=function(){return["within",this.geojson]};var to=function(t,e){this.type=e.type,this.name=t,this.boundExpression=e};to.parse=function(t,e){if(t.length!==2||typeof t[1]!="string")return e.error("'var' expression requires exactly one string literal argument.");var r=t[1];return e.scope.has(r)?new to(r,e.scope.get(r)):e.error('Unknown variable "'+r+'". Make sure "'+r+'" has been bound in an enclosing "let" expression before using it.',1)},to.prototype.evaluate=function(t){return this.boundExpression.evaluate(t)},to.prototype.eachChild=function(){},to.prototype.outputDefined=function(){return!1},to.prototype.serialize=function(){return["var",this.name]};var Fi=function(t,e,r,a,u){e===void 0&&(e=[]),a===void 0&&(a=new oe),u===void 0&&(u=[]),this.registry=t,this.path=e,this.key=e.map(function(c){return"["+c+"]"}).join(""),this.scope=a,this.errors=u,this.expectedType=r};function na(t,e){for(var r,a=t.length-1,u=0,c=a,f=0;u<=c;)if((r=t[f=Math.floor((u+c)/2)])<=e){if(f===a||e<t[f+1])return f;u=f+1}else{if(!(r>e))throw new Vt("Input is not a number.");c=f-1}return 0}Fi.prototype.parse=function(t,e,r,a,u){return u===void 0&&(u={}),e?this.concat(e,r,a)._parse(t,u):this._parse(t,u)},Fi.prototype._parse=function(t,e){function r(w,I,A){return A==="assert"?new se(I,[w]):A==="coerce"?new Mr(I,[w]):w}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var a=t[0];if(typeof a!="string")return this.error("Expression name must be a string, but found "+typeof a+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var u=this.registry[a];if(u){var c=u.parse(t,this);if(!c)return null;if(this.expectedType){var f=this.expectedType,y=c.type;if(f.kind!=="string"&&f.kind!=="number"&&f.kind!=="boolean"&&f.kind!=="object"&&f.kind!=="array"||y.kind!=="value")if(f.kind!=="color"&&f.kind!=="formatted"&&f.kind!=="resolvedImage"||y.kind!=="value"&&y.kind!=="string"){if(this.checkSubtype(f,y))return null}else c=r(c,f,e.typeAnnotation||"coerce");else c=r(c,f,e.typeAnnotation||"assert")}if(!(c instanceof Gt)&&c.type.kind!=="resolvedImage"&&function w(I){if(I instanceof to)return w(I.boundExpression);if(I instanceof Ke&&I.name==="error"||I instanceof ze||I instanceof Bi)return!1;var A=I instanceof Mr||I instanceof se,z=!0;return I.eachChild(function(O){z=A?z&&w(O):z&&O instanceof Gt}),!!z&&Fn(I)&&Ro(I,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(c)){var x=new me;try{c=new Gt(c.type,c.evaluate(x))}catch(w){return this.error(w.message),null}}return c}return this.error('Unknown expression "'+a+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof t+" instead.")},Fi.prototype.concat=function(t,e,r){var a=typeof t=="number"?this.path.concat(t):this.path,u=r?this.scope.concat(r):this.scope;return new Fi(this.registry,a,e||null,u,this.errors)},Fi.prototype.error=function(t){for(var e=[],r=arguments.length-1;r-- >0;)e[r]=arguments[r+1];var a=""+this.key+e.map(function(u){return"["+u+"]"}).join("");this.errors.push(new kt(a,t))},Fi.prototype.checkSubtype=function(t,e){var r=ur(t,e);return r&&this.error(r),r};var Qn=function(t,e,r){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(var a=0,u=r;a<u.length;a+=1){var c=u[a],f=c[1];this.labels.push(c[0]),this.outputs.push(f)}};function Hr(t,e,r){return t*(1-r)+e*r}Qn.parse=function(t,e){if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");var r=e.parse(t[1],1,St);if(!r)return null;var a=[],u=null;e.expectedType&&e.expectedType.kind!=="value"&&(u=e.expectedType);for(var c=1;c<t.length;c+=2){var f=c===1?-1/0:t[c],y=t[c+1],x=c,w=c+1;if(typeof f!="number")return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',x);if(a.length&&a[a.length-1][0]>=f)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',x);var I=e.parse(y,w,u);if(!I)return null;u=u||I.type,a.push([f,I])}return new Qn(u,r,a)},Qn.prototype.evaluate=function(t){var e=this.labels,r=this.outputs;if(e.length===1)return r[0].evaluate(t);var a=this.input.evaluate(t);if(a<=e[0])return r[0].evaluate(t);var u=e.length;return a>=e[u-1]?r[u-1].evaluate(t):r[na(e,a)].evaluate(t)},Qn.prototype.eachChild=function(t){t(this.input);for(var e=0,r=this.outputs;e<r.length;e+=1)t(r[e])},Qn.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},Qn.prototype.serialize=function(){for(var t=["step",this.input.serialize()],e=0;e<this.labels.length;e++)e>0&&t.push(this.labels[e]),t.push(this.outputs[e].serialize());return t};var eo=Object.freeze({__proto__:null,number:Hr,color:function(t,e,r){return new lr(Hr(t.r,e.r,r),Hr(t.g,e.g,r),Hr(t.b,e.b,r),Hr(t.a,e.a,r))},array:function(t,e,r){return t.map(function(a,u){return Hr(a,e[u],r)})}}),Os=6/29*3*(6/29),Iu=Math.PI/180,Ka=180/Math.PI;function ia(t){return t>.008856451679035631?Math.pow(t,1/3):t/Os+4/29}function Ea(t){return t>6/29?t*t*t:Os*(t-4/29)}function cs(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function ps(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Rs(t){var e=ps(t.r),r=ps(t.g),a=ps(t.b),u=ia((.4124564*e+.3575761*r+.1804375*a)/.95047),c=ia((.2126729*e+.7151522*r+.072175*a)/1);return{l:116*c-16,a:500*(u-c),b:200*(c-ia((.0193339*e+.119192*r+.9503041*a)/1.08883)),alpha:t.a}}function Xa(t){var e=(t.l+16)/116,r=isNaN(t.a)?e:e+t.a/500,a=isNaN(t.b)?e:e-t.b/200;return e=1*Ea(e),r=.95047*Ea(r),a=1.08883*Ea(a),new lr(cs(3.2404542*r-1.5371385*e-.4985314*a),cs(-.969266*r+1.8760108*e+.041556*a),cs(.0556434*r-.2040259*e+1.0572252*a),t.alpha)}function hs(t,e,r){var a=e-t;return t+r*(a>180||a<-180?a-360*Math.round(a/360):a)}var oa={forward:Rs,reverse:Xa,interpolate:function(t,e,r){return{l:Hr(t.l,e.l,r),a:Hr(t.a,e.a,r),b:Hr(t.b,e.b,r),alpha:Hr(t.alpha,e.alpha,r)}}},Bo={forward:function(t){var e=Rs(t),r=e.l,a=e.a,u=e.b,c=Math.atan2(u,a)*Ka;return{h:c<0?c+360:c,c:Math.sqrt(a*a+u*u),l:r,alpha:t.a}},reverse:function(t){var e=t.h*Iu,r=t.c;return Xa({l:t.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:t.alpha})},interpolate:function(t,e,r){return{h:hs(t.h,e.h,r),c:Hr(t.c,e.c,r),l:Hr(t.l,e.l,r),alpha:Hr(t.alpha,e.alpha,r)}}},Sa=Object.freeze({__proto__:null,lab:oa,hcl:Bo}),on=function(t,e,r,a,u){this.type=t,this.operator=e,this.interpolation=r,this.input=a,this.labels=[],this.outputs=[];for(var c=0,f=u;c<f.length;c+=1){var y=f[c],x=y[1];this.labels.push(y[0]),this.outputs.push(x)}};function Wa(t,e,r,a){var u=a-r,c=t-r;return u===0?0:e===1?c/u:(Math.pow(e,c)-1)/(Math.pow(e,u)-1)}on.interpolationFactor=function(t,e,r,a){var u=0;if(t.name==="exponential")u=Wa(e,t.base,r,a);else if(t.name==="linear")u=Wa(e,1,r,a);else if(t.name==="cubic-bezier"){var c=t.controlPoints;u=new Ot(c[0],c[1],c[2],c[3]).solve(Wa(e,1,r,a))}return u},on.parse=function(t,e){var r=t[0],a=t[1],u=t[2],c=t.slice(3);if(!Array.isArray(a)||a.length===0)return e.error("Expected an interpolation type expression.",1);if(a[0]==="linear")a={name:"linear"};else if(a[0]==="exponential"){var f=a[1];if(typeof f!="number")return e.error("Exponential interpolation requires a numeric base.",1,1);a={name:"exponential",base:f}}else{if(a[0]!=="cubic-bezier")return e.error("Unknown interpolation type "+String(a[0]),1,0);var y=a.slice(1);if(y.length!==4||y.some(function(rt){return typeof rt!="number"||rt<0||rt>1}))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);a={name:"cubic-bezier",controlPoints:y}}if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(!(u=e.parse(u,2,St)))return null;var x=[],w=null;r==="interpolate-hcl"||r==="interpolate-lab"?w=Yt:e.expectedType&&e.expectedType.kind!=="value"&&(w=e.expectedType);for(var I=0;I<c.length;I+=2){var A=c[I],z=c[I+1],O=I+3,Z=I+4;if(typeof A!="number")return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',O);if(x.length&&x[x.length-1][0]>=A)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',O);var X=e.parse(z,Z,w);if(!X)return null;w=w||X.type,x.push([A,X])}return w.kind==="number"||w.kind==="color"||w.kind==="array"&&w.itemType.kind==="number"&&typeof w.N=="number"?new on(w,r,a,u,x):e.error("Type "+er(w)+" is not interpolatable.")},on.prototype.evaluate=function(t){var e=this.labels,r=this.outputs;if(e.length===1)return r[0].evaluate(t);var a=this.input.evaluate(t);if(a<=e[0])return r[0].evaluate(t);var u=e.length;if(a>=e[u-1])return r[u-1].evaluate(t);var c=na(e,a),f=on.interpolationFactor(this.interpolation,a,e[c],e[c+1]),y=r[c].evaluate(t),x=r[c+1].evaluate(t);return this.operator==="interpolate"?eo[this.type.kind.toLowerCase()](y,x,f):this.operator==="interpolate-hcl"?Bo.reverse(Bo.interpolate(Bo.forward(y),Bo.forward(x),f)):oa.reverse(oa.interpolate(oa.forward(y),oa.forward(x),f))},on.prototype.eachChild=function(t){t(this.input);for(var e=0,r=this.outputs;e<r.length;e+=1)t(r[e])},on.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},on.prototype.serialize=function(){var t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var e=[this.operator,t,this.input.serialize()],r=0;r<this.labels.length;r++)e.push(this.labels[r],this.outputs[r].serialize());return e};var Fo=function(t,e){this.type=t,this.args=e};Fo.parse=function(t,e){if(t.length<2)return e.error("Expectected at least one argument.");var r=null,a=e.expectedType;a&&a.kind!=="value"&&(r=a);for(var u=[],c=0,f=t.slice(1);c<f.length;c+=1){var y=e.parse(f[c],1+u.length,r,void 0,{typeAnnotation:"omit"});if(!y)return null;r=r||y.type,u.push(y)}var x=a&&u.some(function(w){return ur(a,w.type)});return new Fo(x?te:r,u)},Fo.prototype.evaluate=function(t){for(var e,r=null,a=0,u=0,c=this.args;u<c.length&&(a++,(r=c[u].evaluate(t))&&r instanceof j&&!r.available&&(e||(e=r.name),r=null,a===this.args.length&&(r=e)),r===null);u+=1);return r},Fo.prototype.eachChild=function(t){this.args.forEach(t)},Fo.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},Fo.prototype.serialize=function(){var t=["coalesce"];return this.eachChild(function(e){t.push(e.serialize())}),t};var Xi=function(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e};Xi.prototype.evaluate=function(t){return this.result.evaluate(t)},Xi.prototype.eachChild=function(t){for(var e=0,r=this.bindings;e<r.length;e+=1)t(r[e][1]);t(this.result)},Xi.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found "+(t.length-1)+" instead.");for(var r=[],a=1;a<t.length-1;a+=2){var u=t[a];if(typeof u!="string")return e.error("Expected string, but found "+typeof u+" instead.",a);if(/[^a-zA-Z0-9_]/.test(u))return e.error("Variable names must contain only alphanumeric characters or '_'.",a);var c=e.parse(t[a+1],a+1);if(!c)return null;r.push([u,c])}var f=e.parse(t[t.length-1],t.length-1,e.expectedType,r);return f?new Xi(r,f):null},Xi.prototype.outputDefined=function(){return this.result.outputDefined()},Xi.prototype.serialize=function(){for(var t=["let"],e=0,r=this.bindings;e<r.length;e+=1){var a=r[e];t.push(a[0],a[1].serialize())}return t.push(this.result.serialize()),t};var vo=function(t,e,r){this.type=t,this.index=e,this.input=r};vo.parse=function(t,e){if(t.length!==3)return e.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var r=e.parse(t[1],1,St),a=e.parse(t[2],2,He(e.expectedType||te));return r&&a?new vo(a.type.itemType,r,a):null},vo.prototype.evaluate=function(t){var e=this.index.evaluate(t),r=this.input.evaluate(t);if(e<0)throw new Vt("Array index out of bounds: "+e+" < 0.");if(e>=r.length)throw new Vt("Array index out of bounds: "+e+" > "+(r.length-1)+".");if(e!==Math.floor(e))throw new Vt("Array index must be an integer, but found "+e+" instead.");return r[e]},vo.prototype.eachChild=function(t){t(this.index),t(this.input)},vo.prototype.outputDefined=function(){return!1},vo.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var _o=function(t,e){this.type=jt,this.needle=t,this.haystack=e};_o.parse=function(t,e){if(t.length!==3)return e.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var r=e.parse(t[1],1,te),a=e.parse(t[2],2,te);return r&&a?kr(r.type,[jt,ie,St,Wt,te])?new _o(r,a):e.error("Expected first argument to be of type boolean, string, number or null, but found "+er(r.type)+" instead"):null},_o.prototype.evaluate=function(t){var e=this.needle.evaluate(t),r=this.haystack.evaluate(t);if(!r)return!1;if(!yr(e,["boolean","string","number","null"]))throw new Vt("Expected first argument to be of type boolean, string, number or null, but found "+er(V(e))+" instead.");if(!yr(r,["string","array"]))throw new Vt("Expected second argument to be of type array or string, but found "+er(V(r))+" instead.");return r.indexOf(e)>=0},_o.prototype.eachChild=function(t){t(this.needle),t(this.haystack)},_o.prototype.outputDefined=function(){return!0},_o.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var ro=function(t,e,r){this.type=St,this.needle=t,this.haystack=e,this.fromIndex=r};ro.parse=function(t,e){if(t.length<=2||t.length>=5)return e.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var r=e.parse(t[1],1,te),a=e.parse(t[2],2,te);if(!r||!a)return null;if(!kr(r.type,[jt,ie,St,Wt,te]))return e.error("Expected first argument to be of type boolean, string, number or null, but found "+er(r.type)+" instead");if(t.length===4){var u=e.parse(t[3],3,St);return u?new ro(r,a,u):null}return new ro(r,a)},ro.prototype.evaluate=function(t){var e=this.needle.evaluate(t),r=this.haystack.evaluate(t);if(!yr(e,["boolean","string","number","null"]))throw new Vt("Expected first argument to be of type boolean, string, number or null, but found "+er(V(e))+" instead.");if(!yr(r,["string","array"]))throw new Vt("Expected second argument to be of type array or string, but found "+er(V(r))+" instead.");if(this.fromIndex){var a=this.fromIndex.evaluate(t);return r.indexOf(e,a)}return r.indexOf(e)},ro.prototype.eachChild=function(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)},ro.prototype.outputDefined=function(){return!1},ro.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var xo=function(t,e,r,a,u,c){this.inputType=t,this.type=e,this.input=r,this.cases=a,this.outputs=u,this.otherwise=c};xo.parse=function(t,e){if(t.length<5)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if(t.length%2!=1)return e.error("Expected an even number of arguments.");var r,a;e.expectedType&&e.expectedType.kind!=="value"&&(a=e.expectedType);for(var u={},c=[],f=2;f<t.length-1;f+=2){var y=t[f],x=t[f+1];Array.isArray(y)||(y=[y]);var w=e.concat(f);if(y.length===0)return w.error("Expected at least one branch label.");for(var I=0,A=y;I<A.length;I+=1){var z=A[I];if(typeof z!="number"&&typeof z!="string")return w.error("Branch labels must be numbers or strings.");if(typeof z=="number"&&Math.abs(z)>Number.MAX_SAFE_INTEGER)return w.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof z=="number"&&Math.floor(z)!==z)return w.error("Numeric branch labels must be integer values.");if(r){if(w.checkSubtype(r,V(z)))return null}else r=V(z);if(u[String(z)]!==void 0)return w.error("Branch labels must be unique.");u[String(z)]=c.length}var O=e.parse(x,f,a);if(!O)return null;a=a||O.type,c.push(O)}var Z=e.parse(t[1],1,te);if(!Z)return null;var X=e.parse(t[t.length-1],t.length-1,a);return X?Z.type.kind!=="value"&&e.concat(1).checkSubtype(r,Z.type)?null:new xo(r,a,Z,u,c,X):null},xo.prototype.evaluate=function(t){var e=this.input.evaluate(t);return(V(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise).evaluate(t)},xo.prototype.eachChild=function(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)},xo.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})&&this.otherwise.outputDefined()},xo.prototype.serialize=function(){for(var t=this,e=["match",this.input.serialize()],r=[],a={},u=0,c=Object.keys(this.cases).sort();u<c.length;u+=1){var f=c[u];(A=a[this.cases[f]])===void 0?(a[this.cases[f]]=r.length,r.push([this.cases[f],[f]])):r[A][1].push(f)}for(var y=function(O){return t.inputType.kind==="number"?Number(O):O},x=0,w=r;x<w.length;x+=1){var I=w[x],A=I[0],z=I[1];e.push(z.length===1?y(z[0]):z.map(y)),e.push(this.outputs[outputIndex$1].serialize())}return e.push(this.otherwise.serialize()),e};var Jr=function(t,e,r){this.type=t,this.branches=e,this.otherwise=r};Jr.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found only "+(t.length-1)+".");if(t.length%2!=0)return e.error("Expected an odd number of arguments.");var r;e.expectedType&&e.expectedType.kind!=="value"&&(r=e.expectedType);for(var a=[],u=1;u<t.length-1;u+=2){var c=e.parse(t[u],u,jt);if(!c)return null;var f=e.parse(t[u+1],u+1,r);if(!f)return null;a.push([c,f]),r=r||f.type}var y=e.parse(t[t.length-1],t.length-1,r);return y?new Jr(r,a,y):null},Jr.prototype.evaluate=function(t){for(var e=0,r=this.branches;e<r.length;e+=1){var a=r[e],u=a[1];if(a[0].evaluate(t))return u.evaluate(t)}return this.otherwise.evaluate(t)},Jr.prototype.eachChild=function(t){for(var e=0,r=this.branches;e<r.length;e+=1){var a=r[e],u=a[1];t(a[0]),t(u)}t(this.otherwise)},Jr.prototype.outputDefined=function(){return this.branches.every(function(t){return t[1].outputDefined()})&&this.otherwise.outputDefined()},Jr.prototype.serialize=function(){var t=["case"];return this.eachChild(function(e){t.push(e.serialize())}),t};var Ni=function(t,e,r,a){this.type=t,this.input=e,this.beginIndex=r,this.endIndex=a};function aa(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function fs(t,e,r,a){return a.compare(e,r)===0}function xr(t,e,r){var a=t!=="=="&&t!=="!=";return function(){function u(c,f,y){this.type=jt,this.lhs=c,this.rhs=f,this.collator=y,this.hasUntypedArgument=c.type.kind==="value"||f.type.kind==="value"}return u.parse=function(c,f){if(c.length!==3&&c.length!==4)return f.error("Expected two or three arguments.");var y=c[0],x=f.parse(c[1],1,te);if(!x)return null;if(!aa(y,x.type))return f.concat(1).error('"'+y+`" comparisons are not supported for type '`+er(x.type)+"'.");var w=f.parse(c[2],2,te);if(!w)return null;if(!aa(y,w.type))return f.concat(2).error('"'+y+`" comparisons are not supported for type '`+er(w.type)+"'.");if(x.type.kind!==w.type.kind&&x.type.kind!=="value"&&w.type.kind!=="value")return f.error("Cannot compare types '"+er(x.type)+"' and '"+er(w.type)+"'.");a&&(x.type.kind==="value"&&w.type.kind!=="value"?x=new se(w.type,[x]):x.type.kind!=="value"&&w.type.kind==="value"&&(w=new se(x.type,[w])));var I=null;if(c.length===4){if(x.type.kind!=="string"&&w.type.kind!=="string"&&x.type.kind!=="value"&&w.type.kind!=="value")return f.error("Cannot use collator to compare non-string types.");if(!(I=f.parse(c[3],3,Ye)))return null}return new u(x,w,I)},u.prototype.evaluate=function(c){var f=this.lhs.evaluate(c),y=this.rhs.evaluate(c);if(a&&this.hasUntypedArgument){var x=V(f),w=V(y);if(x.kind!==w.kind||x.kind!=="string"&&x.kind!=="number")throw new Vt('Expected arguments for "'+t+'" to be (string, string) or (number, number), but found ('+x.kind+", "+w.kind+") instead.")}if(this.collator&&!a&&this.hasUntypedArgument){var I=V(f),A=V(y);if(I.kind!=="string"||A.kind!=="string")return e(c,f,y)}return this.collator?r(c,f,y,this.collator.evaluate(c)):e(c,f,y)},u.prototype.eachChild=function(c){c(this.lhs),c(this.rhs),this.collator&&c(this.collator)},u.prototype.outputDefined=function(){return!0},u.prototype.serialize=function(){var c=[t];return this.eachChild(function(f){c.push(f.serialize())}),c},u}()}Ni.parse=function(t,e){if(t.length<=2||t.length>=5)return e.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var r=e.parse(t[1],1,te),a=e.parse(t[2],2,St);if(!r||!a)return null;if(!kr(r.type,[He(te),ie,te]))return e.error("Expected first argument to be of type array or string, but found "+er(r.type)+" instead");if(t.length===4){var u=e.parse(t[3],3,St);return u?new Ni(r.type,r,a,u):null}return new Ni(r.type,r,a)},Ni.prototype.evaluate=function(t){var e=this.input.evaluate(t),r=this.beginIndex.evaluate(t);if(!yr(e,["string","array"]))throw new Vt("Expected first argument to be of type array or string, but found "+er(V(e))+" instead.");if(this.endIndex){var a=this.endIndex.evaluate(t);return e.slice(r,a)}return e.slice(r)},Ni.prototype.eachChild=function(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)},Ni.prototype.outputDefined=function(){return!1},Ni.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var Bs=xr("==",function(t,e,r){return e===r},fs),Ta=xr("!=",function(t,e,r){return e!==r},function(t,e,r,a){return!fs(0,e,r,a)}),Ia=xr("<",function(t,e,r){return e<r},function(t,e,r,a){return a.compare(e,r)<0}),Ha=xr(">",function(t,e,r){return e>r},function(t,e,r,a){return a.compare(e,r)>0}),No=xr("<=",function(t,e,r){return e<=r},function(t,e,r,a){return a.compare(e,r)<=0}),Ja=xr(">=",function(t,e,r){return e>=r},function(t,e,r,a){return a.compare(e,r)>=0}),bo=function(t,e,r,a,u){this.type=ie,this.number=t,this.locale=e,this.currency=r,this.minFractionDigits=a,this.maxFractionDigits=u};bo.parse=function(t,e){if(t.length!==3)return e.error("Expected two arguments.");var r=e.parse(t[1],1,St);if(!r)return null;var a=t[2];if(typeof a!="object"||Array.isArray(a))return e.error("NumberFormat options argument must be an object.");var u=null;if(a.locale&&!(u=e.parse(a.locale,1,ie)))return null;var c=null;if(a.currency&&!(c=e.parse(a.currency,1,ie)))return null;var f=null;if(a["min-fraction-digits"]&&!(f=e.parse(a["min-fraction-digits"],1,St)))return null;var y=null;return a["max-fraction-digits"]&&!(y=e.parse(a["max-fraction-digits"],1,St))?null:new bo(r,u,c,f,y)},bo.prototype.evaluate=function(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))},bo.prototype.eachChild=function(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)},bo.prototype.outputDefined=function(){return!1},bo.prototype.serialize=function(){var t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]};var Wi=function(t){this.type=St,this.input=t};Wi.parse=function(t,e){if(t.length!==2)return e.error("Expected 1 argument, but found "+(t.length-1)+" instead.");var r=e.parse(t[1],1);return r?r.type.kind!=="array"&&r.type.kind!=="string"&&r.type.kind!=="value"?e.error("Expected argument of type string or array, but found "+er(r.type)+" instead."):new Wi(r):null},Wi.prototype.evaluate=function(t){var e=this.input.evaluate(t);if(typeof e=="string"||Array.isArray(e))return e.length;throw new Vt("Expected value to be of type string or array, but found "+er(V(e))+" instead.")},Wi.prototype.eachChild=function(t){t(this.input)},Wi.prototype.outputDefined=function(){return!1},Wi.prototype.serialize=function(){var t=["length"];return this.eachChild(function(e){t.push(e.serialize())}),t};var wo={"==":Bs,"!=":Ta,">":Ha,"<":Ia,">=":Ja,"<=":No,array:se,at:vo,boolean:se,case:Jr,coalesce:Fo,collator:ze,format:Ce,image:tr,in:_o,"index-of":ro,interpolate:on,"interpolate-hcl":on,"interpolate-lab":on,length:Wi,let:Xi,literal:Gt,match:xo,number:se,"number-format":bo,object:se,slice:Ni,step:Qn,string:se,"to-boolean":Mr,"to-color":Mr,"to-number":Mr,"to-string":Mr,var:to,within:Bi};function ds(t,e){var r=e[0],a=e[1],u=e[2],c=e[3];r=r.evaluate(t),a=a.evaluate(t),u=u.evaluate(t);var f=c?c.evaluate(t):1,y=bt(r,a,u,f);if(y)throw new Vt(y);return new lr(r/255*f,a/255*f,u/255*f,f)}function Fs(t,e){return t in e}function Ca(t,e){var r=e[t];return r===void 0?null:r}function no(t){return{type:t}}function Ns(t){return{result:"success",value:t}}function Eo(t){return{result:"error",value:t}}function So(t){return t["property-type"]==="data-driven"||t["property-type"]==="cross-faded-data-driven"}function Us(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function sa(t){return!!t.expression&&t.expression.interpolated}function Ar(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}function Aa(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function Vs(t){return t}function ua(t,e,r){return t!==void 0?t:e!==void 0?e:r!==void 0?r:void 0}function ms(t,e,r,a,u){return ua(typeof r===u?a[r]:void 0,t.default,e.default)}function ys(t,e,r){if(Ar(r)!=="number")return ua(t.default,e.default);var a=t.stops.length;if(a===1||r<=t.stops[0][0])return t.stops[0][1];if(r>=t.stops[a-1][0])return t.stops[a-1][1];var u=na(t.stops.map(function(c){return c[0]}),r);return t.stops[u][1]}function gs(t,e,r){var a=t.base!==void 0?t.base:1;if(Ar(r)!=="number")return ua(t.default,e.default);var u=t.stops.length;if(u===1||r<=t.stops[0][0])return t.stops[0][1];if(r>=t.stops[u-1][0])return t.stops[u-1][1];var c=na(t.stops.map(function(A){return A[0]}),r),f=function(A,z,O,Z){var X=Z-O,rt=A-O;return X===0?0:z===1?rt/X:(Math.pow(z,rt)-1)/(Math.pow(z,X)-1)}(r,a,t.stops[c][0],t.stops[c+1][0]),y=t.stops[c][1],x=t.stops[c+1][1],w=eo[e.type]||Vs;if(t.colorSpace&&t.colorSpace!=="rgb"){var I=Sa[t.colorSpace];w=function(A,z){return I.reverse(I.interpolate(I.forward(A),I.forward(z),f))}}return typeof y.evaluate=="function"?{evaluate:function(){for(var A=[],z=arguments.length;z--;)A[z]=arguments[z];var O=y.evaluate.apply(void 0,A),Z=x.evaluate.apply(void 0,A);if(O!==void 0&&Z!==void 0)return w(O,Z,f)}}:w(y,x,f)}function Pa(t,e,r){return e.type==="color"?r=lr.parse(r):e.type==="formatted"?r=E.fromString(r.toString()):e.type==="resolvedImage"?r=j.fromString(r.toString()):Ar(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0),ua(r,t.default,e.default)}Ke.register(wo,{error:[{kind:"error"},[ie],function(t,e){throw new Vt(e[0].evaluate(t))}],typeof:[ie,[te],function(t,e){return er(V(e[0].evaluate(t)))}],"to-rgba":[He(St,4),[Yt],function(t,e){return e[0].evaluate(t).toArray()}],rgb:[Yt,[St,St,St],ds],rgba:[Yt,[St,St,St,St],ds],has:{type:jt,overloads:[[[ie],function(t,e){return Fs(e[0].evaluate(t),t.properties())}],[[ie,Re],function(t,e){var r=e[1];return Fs(e[0].evaluate(t),r.evaluate(t))}]]},get:{type:te,overloads:[[[ie],function(t,e){return Ca(e[0].evaluate(t),t.properties())}],[[ie,Re],function(t,e){var r=e[1];return Ca(e[0].evaluate(t),r.evaluate(t))}]]},"feature-state":[te,[ie],function(t,e){return Ca(e[0].evaluate(t),t.featureState||{})}],properties:[Re,[],function(t){return t.properties()}],"geometry-type":[ie,[],function(t){return t.geometryType()}],id:[te,[],function(t){return t.id()}],zoom:[St,[],function(t){return t.globals.zoom}],"heatmap-density":[St,[],function(t){return t.globals.heatmapDensity||0}],"line-progress":[St,[],function(t){return t.globals.lineProgress||0}],accumulated:[te,[],function(t){return t.globals.accumulated===void 0?null:t.globals.accumulated}],"+":[St,no(St),function(t,e){for(var r=0,a=0,u=e;a<u.length;a+=1)r+=u[a].evaluate(t);return r}],"*":[St,no(St),function(t,e){for(var r=1,a=0,u=e;a<u.length;a+=1)r*=u[a].evaluate(t);return r}],"-":{type:St,overloads:[[[St,St],function(t,e){var r=e[1];return e[0].evaluate(t)-r.evaluate(t)}],[[St],function(t,e){return-e[0].evaluate(t)}]]},"/":[St,[St,St],function(t,e){var r=e[1];return e[0].evaluate(t)/r.evaluate(t)}],"%":[St,[St,St],function(t,e){var r=e[1];return e[0].evaluate(t)%r.evaluate(t)}],ln2:[St,[],function(){return Math.LN2}],pi:[St,[],function(){return Math.PI}],e:[St,[],function(){return Math.E}],"^":[St,[St,St],function(t,e){var r=e[1];return Math.pow(e[0].evaluate(t),r.evaluate(t))}],sqrt:[St,[St],function(t,e){return Math.sqrt(e[0].evaluate(t))}],log10:[St,[St],function(t,e){return Math.log(e[0].evaluate(t))/Math.LN10}],ln:[St,[St],function(t,e){return Math.log(e[0].evaluate(t))}],log2:[St,[St],function(t,e){return Math.log(e[0].evaluate(t))/Math.LN2}],sin:[St,[St],function(t,e){return Math.sin(e[0].evaluate(t))}],cos:[St,[St],function(t,e){return Math.cos(e[0].evaluate(t))}],tan:[St,[St],function(t,e){return Math.tan(e[0].evaluate(t))}],asin:[St,[St],function(t,e){return Math.asin(e[0].evaluate(t))}],acos:[St,[St],function(t,e){return Math.acos(e[0].evaluate(t))}],atan:[St,[St],function(t,e){return Math.atan(e[0].evaluate(t))}],min:[St,no(St),function(t,e){return Math.min.apply(Math,e.map(function(r){return r.evaluate(t)}))}],max:[St,no(St),function(t,e){return Math.max.apply(Math,e.map(function(r){return r.evaluate(t)}))}],abs:[St,[St],function(t,e){return Math.abs(e[0].evaluate(t))}],round:[St,[St],function(t,e){var r=e[0].evaluate(t);return r<0?-Math.round(-r):Math.round(r)}],floor:[St,[St],function(t,e){return Math.floor(e[0].evaluate(t))}],ceil:[St,[St],function(t,e){return Math.ceil(e[0].evaluate(t))}],"filter-==":[jt,[ie,te],function(t,e){var r=e[0],a=e[1];return t.properties()[r.value]===a.value}],"filter-id-==":[jt,[te],function(t,e){var r=e[0];return t.id()===r.value}],"filter-type-==":[jt,[ie],function(t,e){var r=e[0];return t.geometryType()===r.value}],"filter-<":[jt,[ie,te],function(t,e){var r=e[0],a=e[1],u=t.properties()[r.value],c=a.value;return typeof u==typeof c&&u<c}],"filter-id-<":[jt,[te],function(t,e){var r=e[0],a=t.id(),u=r.value;return typeof a==typeof u&&a<u}],"filter->":[jt,[ie,te],function(t,e){var r=e[0],a=e[1],u=t.properties()[r.value],c=a.value;return typeof u==typeof c&&u>c}],"filter-id->":[jt,[te],function(t,e){var r=e[0],a=t.id(),u=r.value;return typeof a==typeof u&&a>u}],"filter-<=":[jt,[ie,te],function(t,e){var r=e[0],a=e[1],u=t.properties()[r.value],c=a.value;return typeof u==typeof c&&u<=c}],"filter-id-<=":[jt,[te],function(t,e){var r=e[0],a=t.id(),u=r.value;return typeof a==typeof u&&a<=u}],"filter->=":[jt,[ie,te],function(t,e){var r=e[0],a=e[1],u=t.properties()[r.value],c=a.value;return typeof u==typeof c&&u>=c}],"filter-id->=":[jt,[te],function(t,e){var r=e[0],a=t.id(),u=r.value;return typeof a==typeof u&&a>=u}],"filter-has":[jt,[te],function(t,e){return e[0].value in t.properties()}],"filter-has-id":[jt,[],function(t){return t.id()!==null&&t.id()!==void 0}],"filter-type-in":[jt,[He(ie)],function(t,e){return e[0].value.indexOf(t.geometryType())>=0}],"filter-id-in":[jt,[He(te)],function(t,e){return e[0].value.indexOf(t.id())>=0}],"filter-in-small":[jt,[ie,He(te)],function(t,e){var r=e[0];return e[1].value.indexOf(t.properties()[r.value])>=0}],"filter-in-large":[jt,[ie,He(te)],function(t,e){var r=e[0],a=e[1];return function(u,c,f,y){for(;f<=y;){var x=f+y>>1;if(c[x]===u)return!0;c[x]>u?y=x-1:f=x+1}return!1}(t.properties()[r.value],a.value,0,a.value.length-1)}],all:{type:jt,overloads:[[[jt,jt],function(t,e){var r=e[1];return e[0].evaluate(t)&&r.evaluate(t)}],[no(jt),function(t,e){for(var r=0,a=e;r<a.length;r+=1)if(!a[r].evaluate(t))return!1;return!0}]]},any:{type:jt,overloads:[[[jt,jt],function(t,e){var r=e[1];return e[0].evaluate(t)||r.evaluate(t)}],[no(jt),function(t,e){for(var r=0,a=e;r<a.length;r+=1)if(a[r].evaluate(t))return!0;return!1}]]},"!":[jt,[jt],function(t,e){return!e[0].evaluate(t)}],"is-supported-script":[jt,[ie],function(t,e){var r=t.globals&&t.globals.isSupportedScript;return!r||r(e[0].evaluate(t))}],upcase:[ie,[ie],function(t,e){return e[0].evaluate(t).toUpperCase()}],downcase:[ie,[ie],function(t,e){return e[0].evaluate(t).toLowerCase()}],concat:[ie,no(te),function(t,e){return e.map(function(r){return Nt(r.evaluate(t))}).join("")}],"resolved-locale":[ie,[Ye],function(t,e){return e[0].evaluate(t).resolvedLocale()}]});var la=function(t,e){this.expression=t,this._warningHistory={},this._evaluator=new me,this._defaultValue=e?function(r){return r.type==="color"&&Aa(r.default)?new lr(0,0,0,0):r.type==="color"?lr.parse(r.default)||null:r.default===void 0?null:r.default}(e):null,this._enumValues=e&&e.type==="enum"?e.values:null};function ka(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in wo}function Ya(t,e){var r=new Fi(wo,[],e?function(u){var c={color:Yt,string:ie,number:St,enum:ie,boolean:jt,formatted:Fe,resolvedImage:Ne};return u.type==="array"?He(c[u.value]||te,u.length):c[u.type]}(e):void 0),a=r.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return a?Ns(new la(a,e)):Eo(r.errors)}la.prototype.evaluateWithoutErrorHandling=function(t,e,r,a,u,c){return this._evaluator.globals=t,this._evaluator.feature=e,this._evaluator.featureState=r,this._evaluator.canonical=a,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=c,this.expression.evaluate(this._evaluator)},la.prototype.evaluate=function(t,e,r,a,u,c){this._evaluator.globals=t,this._evaluator.feature=e||null,this._evaluator.featureState=r||null,this._evaluator.canonical=a,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=c||null;try{var f=this.expression.evaluate(this._evaluator);if(f==null||typeof f=="number"&&f!=f)return this._defaultValue;if(this._enumValues&&!(f in this._enumValues))throw new Vt("Expected value to be one of "+Object.keys(this._enumValues).map(function(y){return JSON.stringify(y)}).join(", ")+", but found "+JSON.stringify(f)+" instead.");return f}catch(y){return this._warningHistory[y.message]||(this._warningHistory[y.message]=!0,typeof console<"u"&&console.warn(y.message)),this._defaultValue}};var Uo=function(t,e){this.kind=t,this._styleExpression=e,this.isStateDependent=t!=="constant"&&!Qi(e.expression)};Uo.prototype.evaluateWithoutErrorHandling=function(t,e,r,a,u,c){return this._styleExpression.evaluateWithoutErrorHandling(t,e,r,a,u,c)},Uo.prototype.evaluate=function(t,e,r,a,u,c){return this._styleExpression.evaluate(t,e,r,a,u,c)};var ai=function(t,e,r,a){this.kind=t,this.zoomStops=r,this._styleExpression=e,this.isStateDependent=t!=="camera"&&!Qi(e.expression),this.interpolationType=a};function Yr(t,e){if((t=Ya(t,e)).result==="error")return t;var r=t.value.expression,a=Fn(r);if(!a&&!So(e))return Eo([new kt("","data expressions not supported")]);var u=Ro(r,["zoom"]);if(!u&&!Us(e))return Eo([new kt("","zoom expressions not supported")]);var c=function f(y){var x=null;if(y instanceof Xi)x=f(y.result);else if(y instanceof Fo)for(var w=0,I=y.args;w<I.length&&!(x=f(I[w]));w+=1);else(y instanceof Qn||y instanceof on)&&y.input instanceof Ke&&y.input.name==="zoom"&&(x=y);return x instanceof kt||y.eachChild(function(A){var z=f(A);z instanceof kt?x=z:!x&&z?x=new kt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):x&&z&&x!==z&&(x=new kt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),x}(r);return c||u?c instanceof kt?Eo([c]):c instanceof on&&!sa(e)?Eo([new kt("",'"interpolate" expressions cannot be used with this property')]):Ns(c?new ai(a?"camera":"composite",t.value,c.labels,c instanceof on?c.interpolation:void 0):new Uo(a?"constant":"source",t.value)):Eo([new kt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}ai.prototype.evaluateWithoutErrorHandling=function(t,e,r,a,u,c){return this._styleExpression.evaluateWithoutErrorHandling(t,e,r,a,u,c)},ai.prototype.evaluate=function(t,e,r,a,u,c){return this._styleExpression.evaluate(t,e,r,a,u,c)},ai.prototype.interpolationFactor=function(t,e,r){return this.interpolationType?on.interpolationFactor(this.interpolationType,t,e,r):0};var To=function(t,e){this._parameters=t,this._specification=e,zt(this,function r(a,u){var c,f,y,x=u.type==="color",w=a.stops&&typeof a.stops[0][0]=="object",I=w||!(w||a.property!==void 0),A=a.type||(sa(u)?"exponential":"interval");if(x&&((a=zt({},a)).stops&&(a.stops=a.stops.map(function(ue){return[ue[0],lr.parse(ue[1])]})),a.default=lr.parse(a.default?a.default:u.default)),a.colorSpace&&a.colorSpace!=="rgb"&&!Sa[a.colorSpace])throw new Error("Unknown color space: "+a.colorSpace);if(A==="exponential")c=gs;else if(A==="interval")c=ys;else if(A==="categorical"){c=ms,f=Object.create(null);for(var z=0,O=a.stops;z<O.length;z+=1){var Z=O[z];f[Z[0]]=Z[1]}y=typeof a.stops[0][0]}else{if(A!=="identity")throw new Error('Unknown function type "'+A+'"');c=Pa}if(w){for(var X={},rt=[],Y=0;Y<a.stops.length;Y++){var ct=a.stops[Y],vt=ct[0].zoom;X[vt]===void 0&&(X[vt]={zoom:vt,type:a.type,property:a.property,default:a.default,stops:[]},rt.push(vt)),X[vt].stops.push([ct[0].value,ct[1]])}for(var xt=[],Tt=0,Mt=rt;Tt<Mt.length;Tt+=1){var Ut=Mt[Tt];xt.push([X[Ut].zoom,r(X[Ut],u)])}var Jt={name:"linear"};return{kind:"composite",interpolationType:Jt,interpolationFactor:on.interpolationFactor.bind(void 0,Jt),zoomStops:xt.map(function(ue){return ue[0]}),evaluate:function(ue,Ee){var le=ue.zoom;return gs({stops:xt,base:a.base},u,le).evaluate(le,Ee)}}}if(I){var _e=A==="exponential"?{name:"exponential",base:a.base!==void 0?a.base:1}:null;return{kind:"camera",interpolationType:_e,interpolationFactor:on.interpolationFactor.bind(void 0,_e),zoomStops:a.stops.map(function(ue){return ue[0]}),evaluate:function(ue){return c(a,u,ue.zoom,f,y)}}}return{kind:"source",evaluate:function(ue,Ee){var le=Ee&&Ee.properties?Ee.properties[a.property]:void 0;return le===void 0?ua(a.default,u.default):c(a,u,le,f,y)}}}(this._parameters,this._specification))};function $r(t){var e=t.key,r=t.value,a=t.valueSpec||{},u=t.objectElementValidators||{},c=t.style,f=t.styleSpec,y=[],x=Ar(r);if(x!=="object")return[new J(e,r,"object expected, "+x+" found")];for(var w in r){var I=w.split(".")[0],A=a[I]||a["*"],z=void 0;if(u[I])z=u[I];else if(a[I])z=ot;else if(u["*"])z=u["*"];else{if(!a["*"]){y.push(new J(e,r[w],'unknown property "'+w+'"'));continue}z=ot}y=y.concat(z({key:(e&&e+".")+w,value:r[w],valueSpec:A,style:c,styleSpec:f,object:r,objectKey:w},r))}for(var O in a)u[O]||a[O].required&&a[O].default===void 0&&r[O]===void 0&&y.push(new J(e,r,'missing required property "'+O+'"'));return y}function js(t){var e=t.value,r=t.valueSpec,a=t.style,u=t.styleSpec,c=t.key,f=t.arrayElementValidator||ot;if(Ar(e)!=="array")return[new J(c,e,"array expected, "+Ar(e)+" found")];if(r.length&&e.length!==r.length)return[new J(c,e,"array length "+r.length+" expected, length "+e.length+" found")];if(r["min-length"]&&e.length<r["min-length"])return[new J(c,e,"array length at least "+r["min-length"]+" expected, length "+e.length+" found")];var y={type:r.value,values:r.values};u.$version<7&&(y.function=r.function),Ar(r.value)==="object"&&(y=r.value);for(var x=[],w=0;w<e.length;w++)x=x.concat(f({array:e,arrayIndex:w,value:e[w],valueSpec:y,style:a,styleSpec:u,key:c+"["+w+"]"}));return x}function $a(t){var e=t.key,r=t.value,a=t.valueSpec,u=Ar(r);return u==="number"&&r!=r&&(u="NaN"),u!=="number"?[new J(e,r,"number expected, "+u+" found")]:"minimum"in a&&r<a.minimum?[new J(e,r,r+" is less than the minimum value "+a.minimum)]:"maximum"in a&&r>a.maximum?[new J(e,r,r+" is greater than the maximum value "+a.maximum)]:[]}function vs(t){var e,r,a,u=t.valueSpec,c=Bt(t.value.type),f={},y=c!=="categorical"&&t.value.property===void 0,x=!y,w=Ar(t.value.stops)==="array"&&Ar(t.value.stops[0])==="array"&&Ar(t.value.stops[0][0])==="object",I=$r({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(O){if(c==="identity")return[new J(O.key,O.value,'identity function may not have a "stops" property')];var Z=[],X=O.value;return Z=Z.concat(js({key:O.key,value:X,valueSpec:O.valueSpec,style:O.style,styleSpec:O.styleSpec,arrayElementValidator:A})),Ar(X)==="array"&&X.length===0&&Z.push(new J(O.key,X,"array must have at least one stop")),Z},default:function(O){return ot({key:O.key,value:O.value,valueSpec:u,style:O.style,styleSpec:O.styleSpec})}}});return c==="identity"&&y&&I.push(new J(t.key,t.value,'missing required property "property"')),c==="identity"||t.value.stops||I.push(new J(t.key,t.value,'missing required property "stops"')),c==="exponential"&&t.valueSpec.expression&&!sa(t.valueSpec)&&I.push(new J(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(x&&!So(t.valueSpec)?I.push(new J(t.key,t.value,"property functions not supported")):y&&!Us(t.valueSpec)&&I.push(new J(t.key,t.value,"zoom functions not supported"))),c!=="categorical"&&!w||t.value.property!==void 0||I.push(new J(t.key,t.value,'"property" property is required')),I;function A(O){var Z=[],X=O.value,rt=O.key;if(Ar(X)!=="array")return[new J(rt,X,"array expected, "+Ar(X)+" found")];if(X.length!==2)return[new J(rt,X,"array length 2 expected, length "+X.length+" found")];if(w){if(Ar(X[0])!=="object")return[new J(rt,X,"object expected, "+Ar(X[0])+" found")];if(X[0].zoom===void 0)return[new J(rt,X,"object stop key must have zoom")];if(X[0].value===void 0)return[new J(rt,X,"object stop key must have value")];if(a&&a>Bt(X[0].zoom))return[new J(rt,X[0].zoom,"stop zoom values must appear in ascending order")];Bt(X[0].zoom)!==a&&(a=Bt(X[0].zoom),r=void 0,f={}),Z=Z.concat($r({key:rt+"[0]",value:X[0],valueSpec:{zoom:{}},style:O.style,styleSpec:O.styleSpec,objectElementValidators:{zoom:$a,value:z}}))}else Z=Z.concat(z({key:rt+"[0]",value:X[0],valueSpec:{},style:O.style,styleSpec:O.styleSpec},X));return ka(Et(X[1]))?Z.concat([new J(rt+"[1]",X[1],"expressions are not allowed in function stops.")]):Z.concat(ot({key:rt+"[1]",value:X[1],valueSpec:u,style:O.style,styleSpec:O.styleSpec}))}function z(O,Z){var X=Ar(O.value),rt=Bt(O.value),Y=O.value!==null?O.value:Z;if(e){if(X!==e)return[new J(O.key,Y,X+" stop domain type must match previous stop domain type "+e)]}else e=X;if(X!=="number"&&X!=="string"&&X!=="boolean")return[new J(O.key,Y,"stop domain value must be a number, string, or boolean")];if(X!=="number"&&c!=="categorical"){var ct="number expected, "+X+" found";return So(u)&&c===void 0&&(ct+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new J(O.key,Y,ct)]}return c!=="categorical"||X!=="number"||isFinite(rt)&&Math.floor(rt)===rt?c!=="categorical"&&X==="number"&&r!==void 0&&rt<r?[new J(O.key,Y,"stop domain values must appear in ascending order")]:(r=rt,c==="categorical"&&rt in f?[new J(O.key,Y,"stop domain values must be unique")]:(f[rt]=!0,[])):[new J(O.key,Y,"integer expected, found "+rt)]}}function Ei(t){var e=(t.expressionContext==="property"?Yr:Ya)(Et(t.value),t.valueSpec);if(e.result==="error")return e.value.map(function(a){return new J(""+t.key+a.key,t.value,a.message)});var r=e.value.expression||e.value._styleExpression.expression;if(t.expressionContext==="property"&&t.propertyKey==="text-font"&&!r.outputDefined())return[new J(t.key,t.value,'Invalid data expression for "'+t.propertyKey+'". Output values must be contained as literals within the expression.')];if(t.expressionContext==="property"&&t.propertyType==="layout"&&!Qi(r))return[new J(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if(t.expressionContext==="filter"&&!Qi(r))return[new J(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&t.expressionContext.indexOf("cluster")===0){if(!Ro(r,["zoom","feature-state"]))return[new J(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(t.expressionContext==="cluster-initial"&&!Fn(r))return[new J(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ho(t){var e=t.key,r=t.value,a=t.valueSpec,u=[];return Array.isArray(a.values)?a.values.indexOf(Bt(r))===-1&&u.push(new J(e,r,"expected one of ["+a.values.join(", ")+"], "+JSON.stringify(r)+" found")):Object.keys(a.values).indexOf(Bt(r))===-1&&u.push(new J(e,r,"expected one of ["+Object.keys(a.values).join(", ")+"], "+JSON.stringify(r)+" found")),u}function Io(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(var e=0,r=t.slice(1);e<r.length;e+=1){var a=r[e];if(!Io(a)&&typeof a!="boolean")return!1}return!0;default:return!0}}To.deserialize=function(t){return new To(t._parameters,t._specification)},To.serialize=function(t){return{_parameters:t._parameters,_specification:t._specification}};var io={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ma(t){if(t==null)return{filter:function(){return!0},needGeometry:!1};Io(t)||(t=g(t));var e=Ya(t,io);if(e.result==="error")throw new Error(e.value.map(function(r){return r.key+": "+r.message}).join(", "));return{filter:function(r,a,u){return e.value.evaluate(r,a,{},u)},needGeometry:function r(a){if(!Array.isArray(a))return!1;if(a[0]==="within")return!0;for(var u=1;u<a.length;u++)if(r(a[u]))return!0;return!1}(t)}}function h(t,e){return t<e?-1:t>e?1:0}function g(t){if(!t)return!0;var e,r=t[0];return t.length<=1?r!=="any":r==="=="?b(t[1],t[2],"=="):r==="!="?R(b(t[1],t[2],"==")):r==="<"||r===">"||r==="<="||r===">="?b(t[1],t[2],r):r==="any"?(e=t.slice(1),["any"].concat(e.map(g))):r==="all"?["all"].concat(t.slice(1).map(g)):r==="none"?["all"].concat(t.slice(1).map(g).map(R)):r==="in"?T(t[1],t.slice(2)):r==="!in"?R(T(t[1],t.slice(2))):r==="has"?k(t[1]):r==="!has"?R(k(t[1])):r!=="within"||t}function b(t,e,r){switch(t){case"$type":return["filter-type-"+r,e];case"$id":return["filter-id-"+r,e];default:return["filter-"+r,t,e]}}function T(t,e){if(e.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(function(r){return typeof r!=typeof e[0]})?["filter-in-large",t,["literal",e.sort(h)]]:["filter-in-small",t,["literal",e]]}}function k(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function R(t){return["!",t]}function K(t){return Io(Et(t.value))?Ei(zt({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function e(r){var a=r.value,u=r.key;if(Ar(a)!=="array")return[new J(u,a,"array expected, "+Ar(a)+" found")];var c,f=r.styleSpec,y=[];if(a.length<1)return[new J(u,a,"filter array must have at least 1 element")];switch(y=y.concat(Ho({key:u+"[0]",value:a[0],valueSpec:f.filter_operator,style:r.style,styleSpec:r.styleSpec})),Bt(a[0])){case"<":case"<=":case">":case">=":a.length>=2&&Bt(a[1])==="$type"&&y.push(new J(u,a,'"$type" cannot be use with operator "'+a[0]+'"'));case"==":case"!=":a.length!==3&&y.push(new J(u,a,'filter array for operator "'+a[0]+'" must have 3 elements'));case"in":case"!in":a.length>=2&&(c=Ar(a[1]))!=="string"&&y.push(new J(u+"[1]",a[1],"string expected, "+c+" found"));for(var x=2;x<a.length;x++)c=Ar(a[x]),Bt(a[1])==="$type"?y=y.concat(Ho({key:u+"["+x+"]",value:a[x],valueSpec:f.geometry_type,style:r.style,styleSpec:r.styleSpec})):c!=="string"&&c!=="number"&&c!=="boolean"&&y.push(new J(u+"["+x+"]",a[x],"string, number, or boolean expected, "+c+" found"));break;case"any":case"all":case"none":for(var w=1;w<a.length;w++)y=y.concat(e({key:u+"["+w+"]",value:a[w],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":c=Ar(a[1]),a.length!==2?y.push(new J(u,a,'filter array for "'+a[0]+'" operator must have 2 elements')):c!=="string"&&y.push(new J(u+"[1]",a[1],"string expected, "+c+" found"));break;case"within":c=Ar(a[1]),a.length!==2?y.push(new J(u,a,'filter array for "'+a[0]+'" operator must have 2 elements')):c!=="object"&&y.push(new J(u+"[1]",a[1],"object expected, "+c+" found"))}return y}(t)}function et(t,e){var r=t.key,a=t.style,u=t.styleSpec,c=t.value,f=t.objectKey,y=u[e+"_"+t.layerType];if(!y)return[];var x=f.match(/^(.*)-transition$/);if(e==="paint"&&x&&y[x[1]]&&y[x[1]].transition)return ot({key:r,value:c,valueSpec:u.transition,style:a,styleSpec:u});var w,I=t.valueSpec||y[f];if(!I)return[new J(r,c,'unknown property "'+f+'"')];if(Ar(c)==="string"&&So(I)&&!I.tokens&&(w=/^{([^}]+)}$/.exec(c)))return[new J(r,c,'"'+f+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(w[1])+" }`.")];var A=[];return t.layerType==="symbol"&&(f==="text-field"&&a&&!a.glyphs&&A.push(new J(r,c,'use of "text-field" requires a style "glyphs" property')),f==="text-font"&&Aa(Et(c))&&Bt(c.type)==="identity"&&A.push(new J(r,c,'"text-font" does not support identity functions'))),A.concat(ot({key:t.key,value:c,valueSpec:I,style:a,styleSpec:u,expressionContext:"property",propertyType:e,propertyKey:f}))}function lt(t){return et(t,"paint")}function ht(t){return et(t,"layout")}function gt(t){var e=[],r=t.value,a=t.key,u=t.style,c=t.styleSpec;r.type||r.ref||e.push(new J(a,r,'either "type" or "ref" is required'));var f,y=Bt(r.type),x=Bt(r.ref);if(r.id)for(var w=Bt(r.id),I=0;I<t.arrayIndex;I++){var A=u.layers[I];Bt(A.id)===w&&e.push(new J(a,r.id,'duplicate layer id "'+r.id+'", previously used at line '+A.id.__line__))}if("ref"in r)["type","source","source-layer","filter","layout"].forEach(function(Z){Z in r&&e.push(new J(a,r[Z],'"'+Z+'" is prohibited for ref layers'))}),u.layers.forEach(function(Z){Bt(Z.id)===x&&(f=Z)}),f?f.ref?e.push(new J(a,r.ref,"ref cannot reference another ref layer")):y=Bt(f.type):e.push(new J(a,r.ref,'ref layer "'+x+'" not found'));else if(y!=="background")if(r.source){var z=u.sources&&u.sources[r.source],O=z&&Bt(z.type);z?O==="vector"&&y==="raster"?e.push(new J(a,r.source,'layer "'+r.id+'" requires a raster source')):O==="raster"&&y!=="raster"?e.push(new J(a,r.source,'layer "'+r.id+'" requires a vector source')):O!=="vector"||r["source-layer"]?O==="raster-dem"&&y!=="hillshade"?e.push(new J(a,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):y!=="line"||!r.paint||!r.paint["line-gradient"]||O==="geojson"&&z.lineMetrics||e.push(new J(a,r,'layer "'+r.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):e.push(new J(a,r,'layer "'+r.id+'" must specify a "source-layer"')):e.push(new J(a,r.source,'source "'+r.source+'" not found'))}else e.push(new J(a,r,'missing required property "source"'));return e=e.concat($r({key:a,value:r,valueSpec:c.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return ot({key:a+".type",value:r.type,valueSpec:c.layer.type,style:t.style,styleSpec:t.styleSpec,object:r,objectKey:"type"})},filter:K,layout:function(Z){return $r({layer:r,key:Z.key,value:Z.value,style:Z.style,styleSpec:Z.styleSpec,objectElementValidators:{"*":function(X){return ht(zt({layerType:y},X))}}})},paint:function(Z){return $r({layer:r,key:Z.key,value:Z.value,style:Z.style,styleSpec:Z.styleSpec,objectElementValidators:{"*":function(X){return lt(zt({layerType:y},X))}}})}}}))}function it(t){var e=t.value,r=t.key,a=Ar(e);return a!=="string"?[new J(r,e,"string expected, "+a+" found")]:[]}var ft={promoteId:function(t){var e=t.key,r=t.value;if(Ar(r)==="string")return it({key:e,value:r});var a=[];for(var u in r)a.push.apply(a,it({key:e+"."+u,value:r[u]}));return a}};function pt(t){var e=t.value,r=t.key,a=t.styleSpec,u=t.style;if(!e.type)return[new J(r,e,'"type" is required')];var c,f=Bt(e.type);switch(f){case"vector":case"raster":case"raster-dem":return $r({key:r,value:e,valueSpec:a["source_"+f.replace("-","_")],style:t.style,styleSpec:a,objectElementValidators:ft});case"geojson":if(c=$r({key:r,value:e,valueSpec:a.source_geojson,style:u,styleSpec:a,objectElementValidators:ft}),e.cluster)for(var y in e.clusterProperties){var x=e.clusterProperties[y],w=x[0],I=typeof w=="string"?[w,["accumulated"],["get",y]]:w;c.push.apply(c,Ei({key:r+"."+y+".map",value:x[1],expressionContext:"cluster-map"})),c.push.apply(c,Ei({key:r+"."+y+".reduce",value:I,expressionContext:"cluster-reduce"}))}return c;case"video":return $r({key:r,value:e,valueSpec:a.source_video,style:u,styleSpec:a});case"image":return $r({key:r,value:e,valueSpec:a.source_image,style:u,styleSpec:a});case"canvas":return[new J(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ho({key:r+".type",value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:u,styleSpec:a})}}function dt(t){var e=t.value,r=t.styleSpec,a=r.light,u=t.style,c=[],f=Ar(e);if(e===void 0)return c;if(f!=="object")return c.concat([new J("light",e,"object expected, "+f+" found")]);for(var y in e){var x=y.match(/^(.*)-transition$/);c=c.concat(x&&a[x[1]]&&a[x[1]].transition?ot({key:y,value:e[y],valueSpec:r.transition,style:u,styleSpec:r}):a[y]?ot({key:y,value:e[y],valueSpec:a[y],style:u,styleSpec:r}):[new J(y,e[y],'unknown property "'+y+'"')])}return c}var _t={"*":function(){return[]},array:js,boolean:function(t){var e=t.value,r=t.key,a=Ar(e);return a!=="boolean"?[new J(r,e,"boolean expected, "+a+" found")]:[]},number:$a,color:function(t){var e=t.key,r=t.value,a=Ar(r);return a!=="string"?[new J(e,r,"color expected, "+a+" found")]:Ze(r)===null?[new J(e,r,'color expected, "'+r+'" found')]:[]},constants:st,enum:Ho,filter:K,function:vs,layer:gt,object:$r,source:pt,light:dt,string:it,formatted:function(t){return it(t).length===0?[]:Ei(t)},resolvedImage:function(t){return it(t).length===0?[]:Ei(t)}};function ot(t){var e=t.value,r=t.valueSpec,a=t.styleSpec;return r.expression&&Aa(Bt(e))?vs(t):r.expression&&ka(Et(e))?Ei(t):r.type&&_t[r.type]?_t[r.type](t):$r(zt({},t,{valueSpec:r.type?a[r.type]:r}))}function yt(t){var e=t.value,r=t.key,a=it(t);return a.length||(e.indexOf("{fontstack}")===-1&&a.push(new J(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&a.push(new J(r,e,'"glyphs" url must include a "{range}" token'))),a}function It(t,e){e===void 0&&(e=L);var r=[];return r=r.concat(ot({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:yt,"*":function(){return[]}}})),t.constants&&(r=r.concat(st({key:"constants",value:t.constants,style:t,styleSpec:e}))),Pt(r)}function Pt(t){return[].concat(t).sort(function(e,r){return e.line-r.line})}function Dt(t){return function(){for(var e=[],r=arguments.length;r--;)e[r]=arguments[r];return Pt(t.apply(this,e))}}It.source=Dt(pt),It.light=Dt(dt),It.layer=Dt(gt),It.filter=Dt(K),It.paintProperty=Dt(lt),It.layoutProperty=Dt(ht);var $t=It,he=$t.light,ee=$t.paintProperty,re=$t.layoutProperty;function fe(t,e){var r=!1;if(e&&e.length)for(var a=0,u=e;a<u.length;a+=1)t.fire(new nt(new Error(u[a].message))),r=!0;return r}var ne=ae;function ae(t,e,r){var a=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var u=new Int32Array(this.arrayBuffer);t=u[0],this.d=(e=u[1])+2*(r=u[2]);for(var c=0;c<this.d*this.d;c++){var f=u[3+c],y=u[3+c+1];a.push(f===y?null:u.subarray(f,y))}var x=u[3+a.length+1];this.keys=u.subarray(u[3+a.length],x),this.bboxes=u.subarray(x),this.insert=this._insertReadonly}else{this.d=e+2*r;for(var w=0;w<this.d*this.d;w++)a.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=r,this.scale=e/t,this.uid=0;var I=r/e*t;this.min=-I,this.max=t+I}ae.prototype.insert=function(t,e,r,a,u){this._forEachCell(e,r,a,u,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(r),this.bboxes.push(a),this.bboxes.push(u)},ae.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ae.prototype._insertCell=function(t,e,r,a,u,c){this.cells[u].push(c)},ae.prototype.query=function(t,e,r,a,u){var c=this.min,f=this.max;if(t<=c&&e<=c&&f<=r&&f<=a&&!u)return Array.prototype.slice.call(this.keys);var y=[];return this._forEachCell(t,e,r,a,this._queryCell,y,{},u),y},ae.prototype._queryCell=function(t,e,r,a,u,c,f,y){var x=this.cells[u];if(x!==null)for(var w=this.keys,I=this.bboxes,A=0;A<x.length;A++){var z=x[A];if(f[z]===void 0){var O=4*z;(y?y(I[O+0],I[O+1],I[O+2],I[O+3]):t<=I[O+2]&&e<=I[O+3]&&r>=I[O+0]&&a>=I[O+1])?(f[z]=!0,c.push(w[z])):f[z]=!1}}},ae.prototype._forEachCell=function(t,e,r,a,u,c,f,y){for(var x=this._convertToCellCoord(t),w=this._convertToCellCoord(e),I=this._convertToCellCoord(r),A=this._convertToCellCoord(a),z=x;z<=I;z++)for(var O=w;O<=A;O++){var Z=this.d*O+z;if((!y||y(this._convertFromCellCoord(z),this._convertFromCellCoord(O),this._convertFromCellCoord(z+1),this._convertFromCellCoord(O+1)))&&u.call(this,t,e,r,a,Z,c,f,y))return}},ae.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},ae.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},ae.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=3+this.cells.length+1+1,r=0,a=0;a<this.cells.length;a++)r+=this.cells[a].length;var u=new Int32Array(e+r+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;for(var c=e,f=0;f<t.length;f++){var y=t[f];u[3+f]=c,u.set(y,c),c+=y.length}return u[3+t.length]=c,u.set(this.keys,c),u[3+t.length+1]=c+=this.keys.length,u.set(this.bboxes,c),c+=this.bboxes.length,u.buffer};var $e=Xt.ImageData,cr=Xt.ImageBitmap,Ae={};function Qt(t,e,r){r===void 0&&(r={}),Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),Ae[t]={klass:e,omit:r.omit||[],shallow:r.shallow||[]}}for(var De in Qt("Object",Object),ne.serialize=function(t,e){var r=t.toArrayBuffer();return e&&e.push(r),{buffer:r}},ne.deserialize=function(t){return new ne(t.buffer)},Qt("Grid",ne),Qt("Color",lr),Qt("Error",Error),Qt("ResolvedImage",j),Qt("StylePropertyFunction",To),Qt("StyleExpression",la,{omit:["_evaluator"]}),Qt("ZoomDependentExpression",ai),Qt("ZoomConstantExpression",Uo),Qt("CompoundExpression",Ke,{omit:["_evaluate"]}),wo)wo[De]._classRegistryKey||Qt("Expression_"+De,wo[De]);function En(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function an(t){return cr&&t instanceof cr}function si(t,e){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(En(t)||an(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){var r=t;return e&&e.push(r.buffer),r}if(t instanceof $e)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){for(var a=[],u=0,c=t;u<c.length;u+=1)a.push(si(c[u],e));return a}if(typeof t=="object"){var f=t.constructor,y=f._classRegistryKey;if(!y)throw new Error("can't serialize object of unregistered class");var x=f.serialize?f.serialize(t,e):{};if(!f.serialize){for(var w in t)if(t.hasOwnProperty(w)&&!(Ae[y].omit.indexOf(w)>=0)){var I=t[w];x[w]=Ae[y].shallow.indexOf(w)>=0?I:si(I,e)}t instanceof Error&&(x.message=t.message)}if(x.$name)throw new Error("$name property is reserved for worker serialization logic.");return y!=="Object"&&(x.$name=y),x}throw new Error("can't serialize object of type "+typeof t)}function zr(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||En(t)||an(t)||ArrayBuffer.isView(t)||t instanceof $e)return t;if(Array.isArray(t))return t.map(zr);if(typeof t=="object"){var e=t.$name||"Object",r=Ae[e].klass;if(!r)throw new Error("can't deserialize unregistered class "+e);if(r.deserialize)return r.deserialize(t);for(var a=Object.create(r.prototype),u=0,c=Object.keys(t);u<c.length;u+=1){var f=c[u];if(f!=="$name"){var y=t[f];a[f]=Ae[e].shallow.indexOf(f)>=0?y:zr(y)}}return a}throw new Error("can't deserialize object of type "+typeof t)}var Co=function(){this.first=!0};Co.prototype.update=function(t,e){var r=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=r,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=r,!0):(this.lastFloorZoom>r?(this.lastIntegerZoom=r+1,this.lastIntegerZoomTime=e):this.lastFloorZoom<r&&(this.lastIntegerZoom=r,this.lastIntegerZoomTime=e),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=r,!0))};var Ht={"Latin-1 Supplement":function(t){return t>=128&&t<=255},Arabic:function(t){return t>=1536&&t<=1791},"Arabic Supplement":function(t){return t>=1872&&t<=1919},"Arabic Extended-A":function(t){return t>=2208&&t<=2303},"Hangul Jamo":function(t){return t>=4352&&t<=4607},"Unified Canadian Aboriginal Syllabics":function(t){return t>=5120&&t<=5759},Khmer:function(t){return t>=6016&&t<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(t){return t>=6320&&t<=6399},"General Punctuation":function(t){return t>=8192&&t<=8303},"Letterlike Symbols":function(t){return t>=8448&&t<=8527},"Number Forms":function(t){return t>=8528&&t<=8591},"Miscellaneous Technical":function(t){return t>=8960&&t<=9215},"Control Pictures":function(t){return t>=9216&&t<=9279},"Optical Character Recognition":function(t){return t>=9280&&t<=9311},"Enclosed Alphanumerics":function(t){return t>=9312&&t<=9471},"Geometric Shapes":function(t){return t>=9632&&t<=9727},"Miscellaneous Symbols":function(t){return t>=9728&&t<=9983},"Miscellaneous Symbols and Arrows":function(t){return t>=11008&&t<=11263},"CJK Radicals Supplement":function(t){return t>=11904&&t<=12031},"Kangxi Radicals":function(t){return t>=12032&&t<=12255},"Ideographic Description Characters":function(t){return t>=12272&&t<=12287},"CJK Symbols and Punctuation":function(t){return t>=12288&&t<=12351},Hiragana:function(t){return t>=12352&&t<=12447},Katakana:function(t){return t>=12448&&t<=12543},Bopomofo:function(t){return t>=12544&&t<=12591},"Hangul Compatibility Jamo":function(t){return t>=12592&&t<=12687},Kanbun:function(t){return t>=12688&&t<=12703},"Bopomofo Extended":function(t){return t>=12704&&t<=12735},"CJK Strokes":function(t){return t>=12736&&t<=12783},"Katakana Phonetic Extensions":function(t){return t>=12784&&t<=12799},"Enclosed CJK Letters and Months":function(t){return t>=12800&&t<=13055},"CJK Compatibility":function(t){return t>=13056&&t<=13311},"CJK Unified Ideographs Extension A":function(t){return t>=13312&&t<=19903},"Yijing Hexagram Symbols":function(t){return t>=19904&&t<=19967},"CJK Unified Ideographs":function(t){return t>=19968&&t<=40959},"Yi Syllables":function(t){return t>=40960&&t<=42127},"Yi Radicals":function(t){return t>=42128&&t<=42191},"Hangul Jamo Extended-A":function(t){return t>=43360&&t<=43391},"Hangul Syllables":function(t){return t>=44032&&t<=55215},"Hangul Jamo Extended-B":function(t){return t>=55216&&t<=55295},"Private Use Area":function(t){return t>=57344&&t<=63743},"CJK Compatibility Ideographs":function(t){return t>=63744&&t<=64255},"Arabic Presentation Forms-A":function(t){return t>=64336&&t<=65023},"Vertical Forms":function(t){return t>=65040&&t<=65055},"CJK Compatibility Forms":function(t){return t>=65072&&t<=65103},"Small Form Variants":function(t){return t>=65104&&t<=65135},"Arabic Presentation Forms-B":function(t){return t>=65136&&t<=65279},"Halfwidth and Fullwidth Forms":function(t){return t>=65280&&t<=65519}};function Cu(t){for(var e=0,r=t;e<r.length;e+=1)if(qs(r[e].charCodeAt(0)))return!0;return!1}function qs(t){return!(t!==746&&t!==747&&(t<4352||!(Ht["Bopomofo Extended"](t)||Ht.Bopomofo(t)||Ht["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||Ht["CJK Compatibility Ideographs"](t)||Ht["CJK Compatibility"](t)||Ht["CJK Radicals Supplement"](t)||Ht["CJK Strokes"](t)||!(!Ht["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||Ht["CJK Unified Ideographs Extension A"](t)||Ht["CJK Unified Ideographs"](t)||Ht["Enclosed CJK Letters and Months"](t)||Ht["Hangul Compatibility Jamo"](t)||Ht["Hangul Jamo Extended-A"](t)||Ht["Hangul Jamo Extended-B"](t)||Ht["Hangul Jamo"](t)||Ht["Hangul Syllables"](t)||Ht.Hiragana(t)||Ht["Ideographic Description Characters"](t)||Ht.Kanbun(t)||Ht["Kangxi Radicals"](t)||Ht["Katakana Phonetic Extensions"](t)||Ht.Katakana(t)&&t!==12540||!(!Ht["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!Ht["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||Ht["Unified Canadian Aboriginal Syllabics"](t)||Ht["Unified Canadian Aboriginal Syllabics Extended"](t)||Ht["Vertical Forms"](t)||Ht["Yijing Hexagram Symbols"](t)||Ht["Yi Syllables"](t)||Ht["Yi Radicals"](t))))}function Au(t){return!(qs(t)||function(e){return!!(Ht["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Ht["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Ht["Letterlike Symbols"](e)||Ht["Number Forms"](e)||Ht["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Ht["Control Pictures"](e)&&e!==9251||Ht["Optical Character Recognition"](e)||Ht["Enclosed Alphanumerics"](e)||Ht["Geometric Shapes"](e)||Ht["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Ht["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Ht["CJK Symbols and Punctuation"](e)||Ht.Katakana(e)||Ht["Private Use Area"](e)||Ht["CJK Compatibility Forms"](e)||Ht["Small Form Variants"](e)||Ht["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(t))}function oo(t){return t>=1424&&t<=2303||Ht["Arabic Presentation Forms-A"](t)||Ht["Arabic Presentation Forms-B"](t)}function Ui(t,e){return!(!e&&oo(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||Ht.Khmer(t))}function Zs(t){for(var e=0,r=t;e<r.length;e+=1)if(oo(r[e].charCodeAt(0)))return!0;return!1}var Gs=null,Vi="unavailable",Jo=null,ul=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(Vi="error"),Gs&&Gs(t)};function _s(){Pu.fire(new G("pluginStateChange",{pluginStatus:Vi,pluginURL:Jo}))}var Pu=new $,ku=function(){return Vi},Ao=function(){if(Vi!=="deferred"||!Jo)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Vi="loading",_s(),Jo&&mo({url:Jo},function(t){t?ul(t):(Vi="loaded",_s())})},Hi={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Vi==="loaded"||Hi.applyArabicShaping!=null},isLoading:function(){return Vi==="loading"},setState:function(t){Vi=t.pluginStatus,Jo=t.pluginURL},isParsed:function(){return Hi.applyArabicShaping!=null&&Hi.processBidirectionalText!=null&&Hi.processStyledBidirectionalText!=null},getPluginURL:function(){return Jo}},or=function(t,e){this.zoom=t,e?(this.now=e.now,this.fadeDuration=e.fadeDuration,this.zoomHistory=e.zoomHistory,this.transition=e.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Co,this.transition={})};or.prototype.isSupportedScript=function(t){return function(e,r){for(var a=0,u=e;a<u.length;a+=1)if(!Ui(u[a].charCodeAt(0),r))return!1;return!0}(t,Hi.isLoaded())},or.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},or.prototype.getCrossfadeParameters=function(){var t=this.zoom,e=t-Math.floor(t),r=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:e+(1-e)*r}:{fromScale:.5,toScale:1,t:1-(1-r)*e}};var Vo=function(t,e){this.property=t,this.value=e,this.expression=function(r,a){if(Aa(r))return new To(r,a);if(ka(r)){var u=Yr(r,a);if(u.result==="error")throw new Error(u.value.map(function(f){return f.key+": "+f.message}).join(", "));return u.value}var c=r;return typeof r=="string"&&a.type==="color"&&(c=lr.parse(r)),{kind:"constant",evaluate:function(){return c}}}(e===void 0?t.specification.default:e,t.specification)};Vo.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},Vo.prototype.possiblyEvaluate=function(t,e,r){return this.property.possiblyEvaluate(this,t,e,r)};var ao=function(t){this.property=t,this.value=new Vo(t,void 0)};ao.prototype.transitioned=function(t,e){return new za(this.property,this.value,e,hr({},t.transition,this.transition),t.now)},ao.prototype.untransitioned=function(){return new za(this.property,this.value,null,{},0)};var Kn=function(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)};Kn.prototype.getValue=function(t){return ni(this._values[t].value.value)},Kn.prototype.setValue=function(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new ao(this._values[t].property)),this._values[t].value=new Vo(this._values[t].property,e===null?void 0:ni(e))},Kn.prototype.getTransition=function(t){return ni(this._values[t].transition)},Kn.prototype.setTransition=function(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new ao(this._values[t].property)),this._values[t].transition=ni(e)||void 0},Kn.prototype.serialize=function(){for(var t={},e=0,r=Object.keys(this._values);e<r.length;e+=1){var a=r[e],u=this.getValue(a);u!==void 0&&(t[a]=u);var c=this.getTransition(a);c!==void 0&&(t[a+"-transition"]=c)}return t},Kn.prototype.transitioned=function(t,e){for(var r=new ca(this._properties),a=0,u=Object.keys(this._values);a<u.length;a+=1){var c=u[a];r._values[c]=this._values[c].transitioned(t,e._values[c])}return r},Kn.prototype.untransitioned=function(){for(var t=new ca(this._properties),e=0,r=Object.keys(this._values);e<r.length;e+=1){var a=r[e];t._values[a]=this._values[a].untransitioned()}return t};var za=function(t,e,r,a,u){this.property=t,this.value=e,this.begin=u+a.delay||0,this.end=this.begin+a.duration||0,t.specification.transition&&(a.delay||a.duration)&&(this.prior=r)};za.prototype.possiblyEvaluate=function(t,e,r){var a=t.now||0,u=this.value.possiblyEvaluate(t,e,r),c=this.prior;if(c){if(a>this.end)return this.prior=null,u;if(this.value.isDataDriven())return this.prior=null,u;if(a<this.begin)return c.possiblyEvaluate(t,e,r);var f=(a-this.begin)/(this.end-this.begin);return this.property.interpolate(c.possiblyEvaluate(t,e,r),u,function(y){if(y<=0)return 0;if(y>=1)return 1;var x=y*y,w=x*y;return 4*(y<.5?w:3*(y-x)+w-.75)}(f))}return u};var ca=function(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)};ca.prototype.possiblyEvaluate=function(t,e,r){for(var a=new xs(this._properties),u=0,c=Object.keys(this._values);u<c.length;u+=1){var f=c[u];a._values[f]=this._values[f].possiblyEvaluate(t,e,r)}return a},ca.prototype.hasTransition=function(){for(var t=0,e=Object.keys(this._values);t<e.length;t+=1)if(this._values[e[t]].prior)return!0;return!1};var Po=function(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)};Po.prototype.getValue=function(t){return ni(this._values[t].value)},Po.prototype.setValue=function(t,e){this._values[t]=new Vo(this._values[t].property,e===null?void 0:ni(e))},Po.prototype.serialize=function(){for(var t={},e=0,r=Object.keys(this._values);e<r.length;e+=1){var a=r[e],u=this.getValue(a);u!==void 0&&(t[a]=u)}return t},Po.prototype.possiblyEvaluate=function(t,e,r){for(var a=new xs(this._properties),u=0,c=Object.keys(this._values);u<c.length;u+=1){var f=c[u];a._values[f]=this._values[f].possiblyEvaluate(t,e,r)}return a};var ui=function(t,e,r){this.property=t,this.value=e,this.parameters=r};ui.prototype.isConstant=function(){return this.value.kind==="constant"},ui.prototype.constantOr=function(t){return this.value.kind==="constant"?this.value.value:t},ui.prototype.evaluate=function(t,e,r,a){return this.property.evaluate(this.value,this.parameters,t,e,r,a)};var xs=function(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)};xs.prototype.get=function(t){return this._values[t]};var be=function(t){this.specification=t};be.prototype.possiblyEvaluate=function(t,e){return t.expression.evaluate(e)},be.prototype.interpolate=function(t,e,r){var a=eo[this.specification.type];return a?a(t,e,r):t};var ye=function(t,e){this.specification=t,this.overrides=e};ye.prototype.possiblyEvaluate=function(t,e,r,a){return new ui(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(e,null,{},r,a)}:t.expression,e)},ye.prototype.interpolate=function(t,e,r){if(t.value.kind!=="constant"||e.value.kind!=="constant")return t;if(t.value.value===void 0||e.value.value===void 0)return new ui(this,{kind:"constant",value:void 0},t.parameters);var a=eo[this.specification.type];return a?new ui(this,{kind:"constant",value:a(t.value.value,e.value.value,r)},t.parameters):t},ye.prototype.evaluate=function(t,e,r,a,u,c){return t.kind==="constant"?t.value:t.evaluate(e,r,a,u,c)};var Ks=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.possiblyEvaluate=function(r,a,u,c){if(r.value===void 0)return new ui(this,{kind:"constant",value:void 0},a);if(r.expression.kind==="constant"){var f=r.expression.evaluate(a,null,{},u,c),y=r.property.specification.type==="resolvedImage"&&typeof f!="string"?f.name:f,x=this._calculate(y,y,y,a);return new ui(this,{kind:"constant",value:x},a)}if(r.expression.kind==="camera"){var w=this._calculate(r.expression.evaluate({zoom:a.zoom-1}),r.expression.evaluate({zoom:a.zoom}),r.expression.evaluate({zoom:a.zoom+1}),a);return new ui(this,{kind:"constant",value:w},a)}return new ui(this,r.expression,a)},e.prototype.evaluate=function(r,a,u,c,f,y){if(r.kind==="source"){var x=r.evaluate(a,u,c,f,y);return this._calculate(x,x,x,a)}return r.kind==="composite"?this._calculate(r.evaluate({zoom:Math.floor(a.zoom)-1},u,c),r.evaluate({zoom:Math.floor(a.zoom)},u,c),r.evaluate({zoom:Math.floor(a.zoom)+1},u,c),a):r.value},e.prototype._calculate=function(r,a,u,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:r,to:a}:{from:u,to:a}},e.prototype.interpolate=function(r){return r},e}(ye),li=function(t){this.specification=t};li.prototype.possiblyEvaluate=function(t,e,r,a){if(t.value!==void 0){if(t.expression.kind==="constant"){var u=t.expression.evaluate(e,null,{},r,a);return this._calculate(u,u,u,e)}return this._calculate(t.expression.evaluate(new or(Math.floor(e.zoom-1),e)),t.expression.evaluate(new or(Math.floor(e.zoom),e)),t.expression.evaluate(new or(Math.floor(e.zoom+1),e)),e)}},li.prototype._calculate=function(t,e,r,a){return a.zoom>a.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:r,to:e}},li.prototype.interpolate=function(t){return t};var ko=function(t){this.specification=t};ko.prototype.possiblyEvaluate=function(t,e,r,a){return!!t.expression.evaluate(e,null,{},r,a)},ko.prototype.interpolate=function(){return!1};var Xn=function(t){for(var e in this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],t){var r=t[e];r.specification.overridable&&this.overridableProperties.push(e);var a=this.defaultPropertyValues[e]=new Vo(r,void 0),u=this.defaultTransitionablePropertyValues[e]=new ao(r);this.defaultTransitioningPropertyValues[e]=u.untransitioned(),this.defaultPossiblyEvaluatedValues[e]=a.possiblyEvaluate({})}};Qt("DataDrivenProperty",ye),Qt("DataConstantProperty",be),Qt("CrossFadedDataDrivenProperty",Ks),Qt("CrossFadedProperty",li),Qt("ColorRampProperty",ko);var jo=function(t){function e(r,a){if(t.call(this),this.id=r.id,this.type=r.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},r.type!=="custom"&&(this.metadata=(r=r).metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type!=="background"&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),a.layout&&(this._unevaluatedLayout=new Po(a.layout)),a.paint)){for(var u in this._transitionablePaint=new Kn(a.paint),r.paint)this.setPaintProperty(u,r.paint[u],{validate:!1});for(var c in r.layout)this.setLayoutProperty(c,r.layout[c],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new xs(a.paint)}}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},e.prototype.getLayoutProperty=function(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)},e.prototype.setLayoutProperty=function(r,a,u){u===void 0&&(u={}),a!=null&&this._validate(re,"layers."+this.id+".layout."+r,r,a,u)||(r!=="visibility"?this._unevaluatedLayout.setValue(r,a):this.visibility=a)},e.prototype.getPaintProperty=function(r){return Ai(r,"-transition")?this._transitionablePaint.getTransition(r.slice(0,-11)):this._transitionablePaint.getValue(r)},e.prototype.setPaintProperty=function(r,a,u){if(u===void 0&&(u={}),a!=null&&this._validate(ee,"layers."+this.id+".paint."+r,r,a,u))return!1;if(Ai(r,"-transition"))return this._transitionablePaint.setTransition(r.slice(0,-11),a||void 0),!1;var c=this._transitionablePaint._values[r],f=c.property.specification["property-type"]==="cross-faded-data-driven",y=c.value.isDataDriven(),x=c.value;this._transitionablePaint.setValue(r,a),this._handleSpecialPaintPropertyUpdate(r);var w=this._transitionablePaint._values[r].value;return w.isDataDriven()||y||f||this._handleOverridablePaintPropertyUpdate(r,x,w)},e.prototype._handleSpecialPaintPropertyUpdate=function(r){},e.prototype._handleOverridablePaintPropertyUpdate=function(r,a,u){return!1},e.prototype.isHidden=function(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||this.visibility==="none"},e.prototype.updateTransitions=function(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)},e.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},e.prototype.recalculate=function(r,a){r.getCrossfadeParameters&&(this._crossfadeParameters=r.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,a)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,a)},e.prototype.serialize=function(){var r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),di(r,function(a,u){return!(a===void 0||u==="layout"&&!Object.keys(a).length||u==="paint"&&!Object.keys(a).length)})},e.prototype._validate=function(r,a,u,c,f){return f===void 0&&(f={}),(!f||f.validate!==!1)&&fe(this,r.call($t,{key:a,layerType:this.type,objectKey:u,value:c,styleSpec:L,style:{glyphs:!0,sprite:!0}}))},e.prototype.is3D=function(){return!1},e.prototype.isTileClipped=function(){return!1},e.prototype.hasOffscreenPass=function(){return!1},e.prototype.resize=function(){},e.prototype.isStateDependent=function(){for(var r in this.paint._values){var a=this.paint.get(r);if(a instanceof ui&&So(a.property.specification)&&(a.value.kind==="source"||a.value.kind==="composite")&&a.value.isStateDependent)return!0}return!1},e}($),Mu={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Xs=function(t,e){this._structArray=t,this._pos1=e*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},Er=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function Nn(t,e){e===void 0&&(e=1);var r=0,a=0;return{members:t.map(function(u){var c=Mu[u.type].BYTES_PER_ELEMENT,f=r=ll(r,Math.max(e,c)),y=u.components||1;return a=Math.max(a,c),r+=c*y,{name:u.name,type:u.type,components:y,offset:f}}),size:ll(r,Math.max(a,e)),alignment:e}}function ll(t,e){return Math.ceil(t/e)*e}Er.serialize=function(t,e){return t._trim(),e&&(t.isTransferred=!0,e.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}},Er.deserialize=function(t){var e=Object.create(this.prototype);return e.arrayBuffer=t.arrayBuffer,e.length=t.length,e.capacity=t.arrayBuffer.byteLength/e.bytesPerElement,e._refreshViews(),e},Er.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},Er.prototype.clear=function(){this.length=0},Er.prototype.resize=function(t){this.reserve(t),this.length=t},Er.prototype.reserve=function(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var e=this.uint8;this._refreshViews(),e&&this.uint8.set(e)}},Er.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Da=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(r,a){var u=this.length;return this.resize(u+1),this.emplace(u,r,a)},e.prototype.emplace=function(r,a,u){var c=2*r;return this.int16[c+0]=a,this.int16[c+1]=u,r},e}(Er);Da.prototype.bytesPerElement=4,Qt("StructArrayLayout2i4",Da);var zu=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(r,a,u,c){var f=this.length;return this.resize(f+1),this.emplace(f,r,a,u,c)},e.prototype.emplace=function(r,a,u,c,f){var y=4*r;return this.int16[y+0]=a,this.int16[y+1]=u,this.int16[y+2]=c,this.int16[y+3]=f,r},e}(Er);zu.prototype.bytesPerElement=8,Qt("StructArrayLayout4i8",zu);var Yo=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(r,a,u,c,f,y){var x=this.length;return this.resize(x+1),this.emplace(x,r,a,u,c,f,y)},e.prototype.emplace=function(r,a,u,c,f,y,x){var w=6*r;return this.int16[w+0]=a,this.int16[w+1]=u,this.int16[w+2]=c,this.int16[w+3]=f,this.int16[w+4]=y,this.int16[w+5]=x,r},e}(Er);Yo.prototype.bytesPerElement=12,Qt("StructArrayLayout2i4i12",Yo);var ji=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(r,a,u,c,f,y){var x=this.length;return this.resize(x+1),this.emplace(x,r,a,u,c,f,y)},e.prototype.emplace=function(r,a,u,c,f,y,x){var w=4*r,I=8*r;return this.int16[w+0]=a,this.int16[w+1]=u,this.uint8[I+4]=c,this.uint8[I+5]=f,this.uint8[I+6]=y,this.uint8[I+7]=x,r},e}(Er);ji.prototype.bytesPerElement=8,Qt("StructArrayLayout2i4ub8",ji);var Qa=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(r,a){var u=this.length;return this.resize(u+1),this.emplace(u,r,a)},e.prototype.emplace=function(r,a,u){var c=2*r;return this.float32[c+0]=a,this.float32[c+1]=u,r},e}(Er);Qa.prototype.bytesPerElement=8,Qt("StructArrayLayout2f8",Qa);var qo=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(r,a,u,c,f,y,x,w,I,A){var z=this.length;return this.resize(z+1),this.emplace(z,r,a,u,c,f,y,x,w,I,A)},e.prototype.emplace=function(r,a,u,c,f,y,x,w,I,A,z){var O=10*r;return this.uint16[O+0]=a,this.uint16[O+1]=u,this.uint16[O+2]=c,this.uint16[O+3]=f,this.uint16[O+4]=y,this.uint16[O+5]=x,this.uint16[O+6]=w,this.uint16[O+7]=I,this.uint16[O+8]=A,this.uint16[O+9]=z,r},e}(Er);qo.prototype.bytesPerElement=20,Qt("StructArrayLayout10ui20",qo);var Ws=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(r,a,u,c,f,y,x,w,I,A,z,O){var Z=this.length;return this.resize(Z+1),this.emplace(Z,r,a,u,c,f,y,x,w,I,A,z,O)},e.prototype.emplace=function(r,a,u,c,f,y,x,w,I,A,z,O,Z){var X=12*r;return this.int16[X+0]=a,this.int16[X+1]=u,this.int16[X+2]=c,this.int16[X+3]=f,this.uint16[X+4]=y,this.uint16[X+5]=x,this.uint16[X+6]=w,this.uint16[X+7]=I,this.int16[X+8]=A,this.int16[X+9]=z,this.int16[X+10]=O,this.int16[X+11]=Z,r},e}(Er);Ws.prototype.bytesPerElement=24,Qt("StructArrayLayout4i4ui4i24",Ws);var ts=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(r,a,u){var c=this.length;return this.resize(c+1),this.emplace(c,r,a,u)},e.prototype.emplace=function(r,a,u,c){var f=3*r;return this.float32[f+0]=a,this.float32[f+1]=u,this.float32[f+2]=c,r},e}(Er);ts.prototype.bytesPerElement=12,Qt("StructArrayLayout3f12",ts);var bs=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(r){var a=this.length;return this.resize(a+1),this.emplace(a,r)},e.prototype.emplace=function(r,a){return this.uint32[1*r+0]=a,r},e}(Er);bs.prototype.bytesPerElement=4,Qt("StructArrayLayout1ul4",bs);var Du=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(r,a,u,c,f,y,x,w,I){var A=this.length;return this.resize(A+1),this.emplace(A,r,a,u,c,f,y,x,w,I)},e.prototype.emplace=function(r,a,u,c,f,y,x,w,I,A){var z=10*r,O=5*r;return this.int16[z+0]=a,this.int16[z+1]=u,this.int16[z+2]=c,this.int16[z+3]=f,this.int16[z+4]=y,this.int16[z+5]=x,this.uint32[O+3]=w,this.uint16[z+8]=I,this.uint16[z+9]=A,r},e}(Er);Du.prototype.bytesPerElement=20,Qt("StructArrayLayout6i1ul2ui20",Du);var es=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(r,a,u,c,f,y){var x=this.length;return this.resize(x+1),this.emplace(x,r,a,u,c,f,y)},e.prototype.emplace=function(r,a,u,c,f,y,x){var w=6*r;return this.int16[w+0]=a,this.int16[w+1]=u,this.int16[w+2]=c,this.int16[w+3]=f,this.int16[w+4]=y,this.int16[w+5]=x,r},e}(Er);es.prototype.bytesPerElement=12,Qt("StructArrayLayout2i2i2i12",es);var La=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(r,a,u,c,f){var y=this.length;return this.resize(y+1),this.emplace(y,r,a,u,c,f)},e.prototype.emplace=function(r,a,u,c,f,y){var x=4*r,w=8*r;return this.float32[x+0]=a,this.float32[x+1]=u,this.float32[x+2]=c,this.int16[w+6]=f,this.int16[w+7]=y,r},e}(Er);La.prototype.bytesPerElement=16,Qt("StructArrayLayout2f1f2i16",La);var Lu=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(r,a,u,c){var f=this.length;return this.resize(f+1),this.emplace(f,r,a,u,c)},e.prototype.emplace=function(r,a,u,c,f){var y=12*r,x=3*r;return this.uint8[y+0]=a,this.uint8[y+1]=u,this.float32[x+1]=c,this.float32[x+2]=f,r},e}(Er);Lu.prototype.bytesPerElement=12,Qt("StructArrayLayout2ub2f12",Lu);var pa=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(r,a,u){var c=this.length;return this.resize(c+1),this.emplace(c,r,a,u)},e.prototype.emplace=function(r,a,u,c){var f=3*r;return this.uint16[f+0]=a,this.uint16[f+1]=u,this.uint16[f+2]=c,r},e}(Er);pa.prototype.bytesPerElement=6,Qt("StructArrayLayout3ui6",pa);var ha=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(r,a,u,c,f,y,x,w,I,A,z,O,Z,X,rt,Y,ct){var vt=this.length;return this.resize(vt+1),this.emplace(vt,r,a,u,c,f,y,x,w,I,A,z,O,Z,X,rt,Y,ct)},e.prototype.emplace=function(r,a,u,c,f,y,x,w,I,A,z,O,Z,X,rt,Y,ct,vt){var xt=24*r,Tt=12*r,Mt=48*r;return this.int16[xt+0]=a,this.int16[xt+1]=u,this.uint16[xt+2]=c,this.uint16[xt+3]=f,this.uint32[Tt+2]=y,this.uint32[Tt+3]=x,this.uint32[Tt+4]=w,this.uint16[xt+10]=I,this.uint16[xt+11]=A,this.uint16[xt+12]=z,this.float32[Tt+7]=O,this.float32[Tt+8]=Z,this.uint8[Mt+36]=X,this.uint8[Mt+37]=rt,this.uint8[Mt+38]=Y,this.uint32[Tt+10]=ct,this.int16[xt+22]=vt,r},e}(Er);ha.prototype.bytesPerElement=48,Qt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ha);var Hs=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(r,a,u,c,f,y,x,w,I,A,z,O,Z,X,rt,Y,ct,vt,xt,Tt,Mt,Ut,Jt,_e,ue,Ee,le,Qe){var ke=this.length;return this.resize(ke+1),this.emplace(ke,r,a,u,c,f,y,x,w,I,A,z,O,Z,X,rt,Y,ct,vt,xt,Tt,Mt,Ut,Jt,_e,ue,Ee,le,Qe)},e.prototype.emplace=function(r,a,u,c,f,y,x,w,I,A,z,O,Z,X,rt,Y,ct,vt,xt,Tt,Mt,Ut,Jt,_e,ue,Ee,le,Qe,ke){var ge=34*r,nr=17*r;return this.int16[ge+0]=a,this.int16[ge+1]=u,this.int16[ge+2]=c,this.int16[ge+3]=f,this.int16[ge+4]=y,this.int16[ge+5]=x,this.int16[ge+6]=w,this.int16[ge+7]=I,this.uint16[ge+8]=A,this.uint16[ge+9]=z,this.uint16[ge+10]=O,this.uint16[ge+11]=Z,this.uint16[ge+12]=X,this.uint16[ge+13]=rt,this.uint16[ge+14]=Y,this.uint16[ge+15]=ct,this.uint16[ge+16]=vt,this.uint16[ge+17]=xt,this.uint16[ge+18]=Tt,this.uint16[ge+19]=Mt,this.uint16[ge+20]=Ut,this.uint16[ge+21]=Jt,this.uint16[ge+22]=_e,this.uint32[nr+12]=ue,this.float32[nr+13]=Ee,this.float32[nr+14]=le,this.float32[nr+15]=Qe,this.float32[nr+16]=ke,r},e}(Er);Hs.prototype.bytesPerElement=68,Qt("StructArrayLayout8i15ui1ul4f68",Hs);var fa=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(r){var a=this.length;return this.resize(a+1),this.emplace(a,r)},e.prototype.emplace=function(r,a){return this.float32[1*r+0]=a,r},e}(Er);fa.prototype.bytesPerElement=4,Qt("StructArrayLayout1f4",fa);var so=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(r,a,u){var c=this.length;return this.resize(c+1),this.emplace(c,r,a,u)},e.prototype.emplace=function(r,a,u,c){var f=3*r;return this.int16[f+0]=a,this.int16[f+1]=u,this.int16[f+2]=c,r},e}(Er);so.prototype.bytesPerElement=6,Qt("StructArrayLayout3i6",so);var Ou=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(r,a,u){var c=this.length;return this.resize(c+1),this.emplace(c,r,a,u)},e.prototype.emplace=function(r,a,u,c){var f=4*r;return this.uint32[2*r+0]=a,this.uint16[f+2]=u,this.uint16[f+3]=c,r},e}(Er);Ou.prototype.bytesPerElement=8,Qt("StructArrayLayout1ul2ui8",Ou);var ws=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(r,a){var u=this.length;return this.resize(u+1),this.emplace(u,r,a)},e.prototype.emplace=function(r,a,u){var c=2*r;return this.uint16[c+0]=a,this.uint16[c+1]=u,r},e}(Er);ws.prototype.bytesPerElement=4,Qt("StructArrayLayout2ui4",ws);var Ru=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(r){var a=this.length;return this.resize(a+1),this.emplace(a,r)},e.prototype.emplace=function(r,a){return this.uint16[1*r+0]=a,r},e}(Er);Ru.prototype.bytesPerElement=2,Qt("StructArrayLayout1ui2",Ru);var Js=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(r,a,u,c){var f=this.length;return this.resize(f+1),this.emplace(f,r,a,u,c)},e.prototype.emplace=function(r,a,u,c,f){var y=4*r;return this.float32[y+0]=a,this.float32[y+1]=u,this.float32[y+2]=c,this.float32[y+3]=f,r},e}(Er);Js.prototype.bytesPerElement=16,Qt("StructArrayLayout4f16",Js);var n=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var r={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return r.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},r.x1.get=function(){return this._structArray.int16[this._pos2+2]},r.y1.get=function(){return this._structArray.int16[this._pos2+3]},r.x2.get=function(){return this._structArray.int16[this._pos2+4]},r.y2.get=function(){return this._structArray.int16[this._pos2+5]},r.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},r.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},r.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},r.anchorPoint.get=function(){return new Oe(this.anchorPointX,this.anchorPointY)},Object.defineProperties(e.prototype,r),e}(Xs);n.prototype.size=20;var o=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(r){return new n(this,r)},e}(Du);Qt("CollisionBoxArray",o);var i=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var r={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return r.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},r.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},r.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},r.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},r.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},r.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},r.segment.get=function(){return this._structArray.uint16[this._pos2+10]},r.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},r.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},r.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},r.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},r.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},r.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},r.placedOrientation.set=function(a){this._structArray.uint8[this._pos1+37]=a},r.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},r.hidden.set=function(a){this._structArray.uint8[this._pos1+38]=a},r.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},r.crossTileID.set=function(a){this._structArray.uint32[this._pos4+10]=a},r.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(e.prototype,r),e}(Xs);i.prototype.size=48;var s=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(r){return new i(this,r)},e}(ha);Qt("PlacedSymbolArray",s);var p=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var r={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return r.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},r.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},r.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},r.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},r.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},r.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},r.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},r.key.get=function(){return this._structArray.uint16[this._pos2+8]},r.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},r.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},r.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},r.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},r.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},r.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},r.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},r.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},r.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},r.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},r.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},r.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},r.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},r.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},r.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},r.crossTileID.set=function(a){this._structArray.uint32[this._pos4+12]=a},r.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},r.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},r.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},r.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(e.prototype,r),e}(Xs);p.prototype.size=68;var d=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(r){return new p(this,r)},e}(Hs);Qt("SymbolInstanceArray",d);var m=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getoffsetX=function(r){return this.float32[1*r+0]},e}(fa);Qt("GlyphOffsetArray",m);var _=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getx=function(r){return this.int16[3*r+0]},e.prototype.gety=function(r){return this.int16[3*r+1]},e.prototype.gettileUnitDistanceFromAnchor=function(r){return this.int16[3*r+2]},e}(so);Qt("SymbolLineVertexArray",_);var S=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var r={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return r.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},r.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},r.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(e.prototype,r),e}(Xs);S.prototype.size=8;var P=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(r){return new S(this,r)},e}(Ou);Qt("FeatureIndexArray",P);var B=Nn([{name:"a_pos",components:2,type:"Int16"}],4).members,F=function(t){t===void 0&&(t=[]),this.segments=t};function N(t,e){return 256*(t=ve(Math.floor(t),0,255))+ve(Math.floor(e),0,255)}F.prototype.prepareSegment=function(t,e,r,a){var u=this.segments[this.segments.length-1];return t>F.MAX_VERTEX_ARRAY_LENGTH&&wr("Max vertices per segment is "+F.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+t),(!u||u.vertexLength+t>F.MAX_VERTEX_ARRAY_LENGTH||u.sortKey!==a)&&(u={vertexOffset:e.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0},a!==void 0&&(u.sortKey=a),this.segments.push(u)),u},F.prototype.get=function(){return this.segments},F.prototype.destroy=function(){for(var t=0,e=this.segments;t<e.length;t+=1){var r=e[t];for(var a in r.vaos)r.vaos[a].destroy()}},F.simpleSegment=function(t,e,r,a){return new F([{vertexOffset:t,primitiveOffset:e,vertexLength:r,primitiveLength:a,vaos:{},sortKey:0}])},F.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Qt("SegmentVector",F);var H=Nn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),W=sr(function(t){t.exports=function(e,r){var a,u,c,f,y,x,w,I;for(u=e.length-(a=3&e.length),c=r,y=3432918353,x=461845907,I=0;I<u;)w=255&e.charCodeAt(I)|(255&e.charCodeAt(++I))<<8|(255&e.charCodeAt(++I))<<16|(255&e.charCodeAt(++I))<<24,++I,c=27492+(65535&(f=5*(65535&(c=(c^=w=(65535&(w=(w=(65535&w)*y+(((w>>>16)*y&65535)<<16)&4294967295)<<15|w>>>17))*x+(((w>>>16)*x&65535)<<16)&4294967295)<<13|c>>>19))+((5*(c>>>16)&65535)<<16)&4294967295))+((58964+(f>>>16)&65535)<<16);switch(w=0,a){case 3:w^=(255&e.charCodeAt(I+2))<<16;case 2:w^=(255&e.charCodeAt(I+1))<<8;case 1:c^=w=(65535&(w=(w=(65535&(w^=255&e.charCodeAt(I)))*y+(((w>>>16)*y&65535)<<16)&4294967295)<<15|w>>>17))*x+(((w>>>16)*x&65535)<<16)&4294967295}return c^=e.length,c=2246822507*(65535&(c^=c>>>16))+((2246822507*(c>>>16)&65535)<<16)&4294967295,c=3266489909*(65535&(c^=c>>>13))+((3266489909*(c>>>16)&65535)<<16)&4294967295,(c^=c>>>16)>>>0}}),tt=sr(function(t){t.exports=function(e,r){for(var a,u=e.length,c=r^u,f=0;u>=4;)a=1540483477*(65535&(a=255&e.charCodeAt(f)|(255&e.charCodeAt(++f))<<8|(255&e.charCodeAt(++f))<<16|(255&e.charCodeAt(++f))<<24))+((1540483477*(a>>>16)&65535)<<16),c=1540483477*(65535&c)+((1540483477*(c>>>16)&65535)<<16)^(a=1540483477*(65535&(a^=a>>>24))+((1540483477*(a>>>16)&65535)<<16)),u-=4,++f;switch(u){case 3:c^=(255&e.charCodeAt(f+2))<<16;case 2:c^=(255&e.charCodeAt(f+1))<<8;case 1:c=1540483477*(65535&(c^=255&e.charCodeAt(f)))+((1540483477*(c>>>16)&65535)<<16)}return c=1540483477*(65535&(c^=c>>>13))+((1540483477*(c>>>16)&65535)<<16),(c^=c>>>15)>>>0}}),q=W,Q=tt;q.murmur3=W,q.murmur2=Q;var at=function(){this.ids=[],this.positions=[],this.indexed=!1};at.prototype.add=function(t,e,r,a){this.ids.push(Ct(t)),this.positions.push(e,r,a)},at.prototype.getPositions=function(t){for(var e=Ct(t),r=0,a=this.ids.length-1;r<a;){var u=r+a>>1;this.ids[u]>=e?a=u:r=u+1}for(var c=[];this.ids[r]===e;)c.push({index:this.positions[3*r],start:this.positions[3*r+1],end:this.positions[3*r+2]}),r++;return c},at.serialize=function(t,e){var r=new Float64Array(t.ids),a=new Uint32Array(t.positions);return function u(c,f,y,x){for(;y<x;){for(var w=c[y+x>>1],I=y-1,A=x+1;;){do I++;while(c[I]<w);do A--;while(c[A]>w);if(I>=A)break;wt(c,I,A),wt(f,3*I,3*A),wt(f,3*I+1,3*A+1),wt(f,3*I+2,3*A+2)}A-y<x-A?(u(c,f,y,A),y=A+1):(u(c,f,A+1,x),x=A)}}(r,a,0,r.length-1),e&&e.push(r.buffer,a.buffer),{ids:r,positions:a}},at.deserialize=function(t){var e=new at;return e.ids=t.ids,e.positions=t.positions,e.indexed=!0,e};var mt=Math.pow(2,53)-1;function Ct(t){var e=+t;return!isNaN(e)&&e<=mt?e:q(String(t))}function wt(t,e,r){var a=t[e];t[e]=t[r],t[r]=a}Qt("FeaturePositionMap",at);var At=function(t,e){this.gl=t.gl,this.location=e},Rt=function(t){function e(r,a){t.call(this,r,a),this.current=0}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))},e}(At),Zt=function(t){function e(r,a){t.call(this,r,a),this.current=0}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(r){this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))},e}(At),qt=function(t){function e(r,a){t.call(this,r,a),this.current=[0,0]}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))},e}(At),ce=function(t){function e(r,a){t.call(this,r,a),this.current=[0,0,0]}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))},e}(At),we=function(t){function e(r,a){t.call(this,r,a),this.current=[0,0,0,0]}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3]))},e}(At),Ie=function(t){function e(r,a){t.call(this,r,a),this.current=lr.transparent}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(r){r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a))},e}(At),Te=new Float32Array(16),fr=function(t){function e(r,a){t.call(this,r,a),this.current=Te}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(var a=1;a<16;a++)if(r[a]!==this.current[a]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}},e}(At);function de(t){return[N(255*t.r,255*t.g),N(255*t.b,255*t.a)]}var Ue=function(t,e,r){this.value=t,this.uniformNames=e.map(function(a){return"u_"+a}),this.type=r};Ue.prototype.setUniform=function(t,e,r){t.set(r.constantOr(this.value))},Ue.prototype.getBinding=function(t,e,r){return this.type==="color"?new Ie(t,e):new Zt(t,e)};var Je=function(t,e){this.uniformNames=e.map(function(r){return"u_"+r}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};Je.prototype.setConstantPatternPositions=function(t,e){this.pixelRatioFrom=e.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=e.tlbr,this.patternTo=t.tlbr},Je.prototype.setUniform=function(t,e,r,a){var u=a==="u_pattern_to"?this.patternTo:a==="u_pattern_from"?this.patternFrom:a==="u_pixel_ratio_to"?this.pixelRatioTo:a==="u_pixel_ratio_from"?this.pixelRatioFrom:null;u&&t.set(u)},Je.prototype.getBinding=function(t,e,r){return r.substr(0,9)==="u_pattern"?new we(t,e):new Zt(t,e)};var Be=function(t,e,r,a){this.expression=t,this.type=r,this.maxValue=0,this.paintVertexAttributes=e.map(function(u){return{name:"a_"+u,type:"Float32",components:r==="color"?2:1,offset:0}}),this.paintVertexArray=new a};Be.prototype.populatePaintArray=function(t,e,r,a,u){var c=this.paintVertexArray.length,f=this.expression.evaluate(new or(0),e,{},a,[],u);this.paintVertexArray.resize(t),this._setPaintValue(c,t,f)},Be.prototype.updatePaintArray=function(t,e,r,a){var u=this.expression.evaluate({zoom:0},r,a);this._setPaintValue(t,e,u)},Be.prototype._setPaintValue=function(t,e,r){if(this.type==="color")for(var a=de(r),u=t;u<e;u++)this.paintVertexArray.emplace(u,a[0],a[1]);else{for(var c=t;c<e;c++)this.paintVertexArray.emplace(c,r);this.maxValue=Math.max(this.maxValue,Math.abs(r))}},Be.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Be.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Le=function(t,e,r,a,u,c){this.expression=t,this.uniformNames=e.map(function(f){return"u_"+f+"_t"}),this.type=r,this.useIntegerZoom=a,this.zoom=u,this.maxValue=0,this.paintVertexAttributes=e.map(function(f){return{name:"a_"+f,type:"Float32",components:r==="color"?4:2,offset:0}}),this.paintVertexArray=new c};Le.prototype.populatePaintArray=function(t,e,r,a,u){var c=this.expression.evaluate(new or(this.zoom),e,{},a,[],u),f=this.expression.evaluate(new or(this.zoom+1),e,{},a,[],u),y=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(y,t,c,f)},Le.prototype.updatePaintArray=function(t,e,r,a){var u=this.expression.evaluate({zoom:this.zoom},r,a),c=this.expression.evaluate({zoom:this.zoom+1},r,a);this._setPaintValue(t,e,u,c)},Le.prototype._setPaintValue=function(t,e,r,a){if(this.type==="color")for(var u=de(r),c=de(a),f=t;f<e;f++)this.paintVertexArray.emplace(f,u[0],u[1],c[0],c[1]);else{for(var y=t;y<e;y++)this.paintVertexArray.emplace(y,r,a);this.maxValue=Math.max(this.maxValue,Math.abs(r),Math.abs(a))}},Le.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Le.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Le.prototype.setUniform=function(t,e){var r=this.useIntegerZoom?Math.floor(e.zoom):e.zoom,a=ve(this.expression.interpolationFactor(r,this.zoom,this.zoom+1),0,1);t.set(a)},Le.prototype.getBinding=function(t,e,r){return new Zt(t,e)};var Xe=function(t,e,r,a,u,c){this.expression=t,this.type=e,this.useIntegerZoom=r,this.zoom=a,this.layerId=c,this.zoomInPaintVertexArray=new u,this.zoomOutPaintVertexArray=new u};Xe.prototype.populatePaintArray=function(t,e,r){var a=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(a,t,e.patterns&&e.patterns[this.layerId],r)},Xe.prototype.updatePaintArray=function(t,e,r,a,u){this._setPaintValues(t,e,r.patterns&&r.patterns[this.layerId],u)},Xe.prototype._setPaintValues=function(t,e,r,a){if(a&&r){var u=a[r.min],c=a[r.mid],f=a[r.max];if(u&&c&&f)for(var y=t;y<e;y++)this.zoomInPaintVertexArray.emplace(y,c.tl[0],c.tl[1],c.br[0],c.br[1],u.tl[0],u.tl[1],u.br[0],u.br[1],c.pixelRatio,u.pixelRatio),this.zoomOutPaintVertexArray.emplace(y,c.tl[0],c.tl[1],c.br[0],c.br[1],f.tl[0],f.tl[1],f.br[0],f.br[1],c.pixelRatio,f.pixelRatio)}},Xe.prototype.upload=function(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,H.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,H.members,this.expression.isStateDependent))},Xe.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var Me=function(t,e,r){this.binders={},this._buffers=[];var a=[];for(var u in t.paint._values)if(r(u)){var c=t.paint.get(u);if(c instanceof ui&&So(c.property.specification)){var f=Mn(u,t.type),y=c.value,x=c.property.specification.type,w=c.property.useIntegerZoom,I=c.property.specification["property-type"],A=I==="cross-faded"||I==="cross-faded-data-driven";if(y.kind==="constant")this.binders[u]=A?new Je(y.value,f):new Ue(y.value,f,x),a.push("/u_"+u);else if(y.kind==="source"||A){var z=Qr(u,x,"source");this.binders[u]=A?new Xe(y,x,w,e,z,t.id):new Be(y,f,x,z),a.push("/a_"+u)}else{var O=Qr(u,x,"composite");this.binders[u]=new Le(y,f,x,w,e,O),a.push("/z_"+u)}}}this.cacheKey=a.sort().join("")};Me.prototype.getMaxValue=function(t){var e=this.binders[t];return e instanceof Be||e instanceof Le?e.maxValue:0},Me.prototype.populatePaintArrays=function(t,e,r,a,u){for(var c in this.binders){var f=this.binders[c];(f instanceof Be||f instanceof Le||f instanceof Xe)&&f.populatePaintArray(t,e,r,a,u)}},Me.prototype.setConstantPatternPositions=function(t,e){for(var r in this.binders){var a=this.binders[r];a instanceof Je&&a.setConstantPatternPositions(t,e)}},Me.prototype.updatePaintArrays=function(t,e,r,a,u){var c=!1;for(var f in t)for(var y=0,x=e.getPositions(f);y<x.length;y+=1){var w=x[y],I=r.feature(w.index);for(var A in this.binders){var z=this.binders[A];if((z instanceof Be||z instanceof Le||z instanceof Xe)&&z.expression.isStateDependent===!0){var O=a.paint.get(A);z.expression=O.value,z.updatePaintArray(w.start,w.end,I,t[f],u),c=!0}}}return c},Me.prototype.defines=function(){var t=[];for(var e in this.binders){var r=this.binders[e];(r instanceof Ue||r instanceof Je)&&t.push.apply(t,r.uniformNames.map(function(a){return"#define HAS_UNIFORM_"+a}))}return t},Me.prototype.getBinderAttributes=function(){var t=[];for(var e in this.binders){var r=this.binders[e];if(r instanceof Be||r instanceof Le)for(var a=0;a<r.paintVertexAttributes.length;a++)t.push(r.paintVertexAttributes[a].name);else if(r instanceof Xe)for(var u=0;u<H.members.length;u++)t.push(H.members[u].name)}return t},Me.prototype.getBinderUniforms=function(){var t=[];for(var e in this.binders){var r=this.binders[e];if(r instanceof Ue||r instanceof Je||r instanceof Le)for(var a=0,u=r.uniformNames;a<u.length;a+=1)t.push(u[a])}return t},Me.prototype.getPaintVertexBuffers=function(){return this._buffers},Me.prototype.getUniforms=function(t,e){var r=[];for(var a in this.binders){var u=this.binders[a];if(u instanceof Ue||u instanceof Je||u instanceof Le)for(var c=0,f=u.uniformNames;c<f.length;c+=1){var y=f[c];if(e[y]){var x=u.getBinding(t,e[y],y);r.push({name:y,property:a,binding:x})}}}return r},Me.prototype.setUniforms=function(t,e,r,a){for(var u=0,c=e;u<c.length;u+=1){var f=c[u],y=f.name,x=f.property;this.binders[x].setUniform(f.binding,a,r.get(x),y)}},Me.prototype.updatePaintBuffers=function(t){for(var e in this._buffers=[],this.binders){var r=this.binders[e];if(t&&r instanceof Xe){var a=t.fromScale===2?r.zoomInPaintVertexBuffer:r.zoomOutPaintVertexBuffer;a&&this._buffers.push(a)}else(r instanceof Be||r instanceof Le)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}},Me.prototype.upload=function(t){for(var e in this.binders){var r=this.binders[e];(r instanceof Be||r instanceof Le||r instanceof Xe)&&r.upload(t)}this.updatePaintBuffers()},Me.prototype.destroy=function(){for(var t in this.binders){var e=this.binders[t];(e instanceof Be||e instanceof Le||e instanceof Xe)&&e.destroy()}};var Pe=function(t,e,r){r===void 0&&(r=function(){return!0}),this.programConfigurations={};for(var a=0,u=t;a<u.length;a+=1){var c=u[a];this.programConfigurations[c.id]=new Me(c,e,r)}this.needsUpload=!1,this._featureMap=new at,this._bufferOffset=0};function Mn(t,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[t]||[t.replace(e+"-","").replace(/-/g,"_")]}function Qr(t,e,r){var a={color:{source:Qa,composite:Js},number:{source:fa,composite:Qa}},u=function(c){return{"line-pattern":{source:qo,composite:qo},"fill-pattern":{source:qo,composite:qo},"fill-extrusion-pattern":{source:qo,composite:qo}}[c]}(t);return u&&u[r]||a[e][r]}Pe.prototype.populatePaintArrays=function(t,e,r,a,u,c){for(var f in this.programConfigurations)this.programConfigurations[f].populatePaintArrays(t,e,a,u,c);e.id!==void 0&&this._featureMap.add(e.id,r,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0},Pe.prototype.updatePaintArrays=function(t,e,r,a){for(var u=0,c=r;u<c.length;u+=1){var f=c[u];this.needsUpload=this.programConfigurations[f.id].updatePaintArrays(t,this._featureMap,e,f,a)||this.needsUpload}},Pe.prototype.get=function(t){return this.programConfigurations[t]},Pe.prototype.upload=function(t){if(this.needsUpload){for(var e in this.programConfigurations)this.programConfigurations[e].upload(t);this.needsUpload=!1}},Pe.prototype.destroy=function(){for(var t in this.programConfigurations)this.programConfigurations[t].destroy()},Qt("ConstantBinder",Ue),Qt("CrossFadedConstantBinder",Je),Qt("SourceExpressionBinder",Be),Qt("CrossFadedCompositeBinder",Xe),Qt("CompositeExpressionBinder",Le),Qt("ProgramConfiguration",Me,{omit:["_buffers"]}),Qt("ProgramConfigurationSet",Pe);var ti=Math.pow(2,14)-1,Un=-ti-1;function Kr(t){for(var e=8192/t.extent,r=t.loadGeometry(),a=0;a<r.length;a++)for(var u=r[a],c=0;c<u.length;c++){var f=u[c],y=Math.round(f.x*e),x=Math.round(f.y*e);f.x=ve(y,Un,ti),f.y=ve(x,Un,ti),(y<f.x||y>f.x+1||x<f.y||x>f.y+1)&&wr("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return r}function sn(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?Kr(t):[]}}function qi(t,e,r,a,u){t.emplaceBack(2*e+(a+1)/2,2*r+(u+1)/2)}var ci=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(e){return e.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Da,this.indexArray=new pa,this.segments=new F,this.programConfigurations=new Pe(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(function(e){return e.isStateDependent()}).map(function(e){return e.id})};function da(t,e){for(var r=0;r<t.length;r++)if(Zo(e,t[r]))return!0;for(var a=0;a<e.length;a++)if(Zo(t,e[a]))return!0;return!!Es(t,e)}function Si(t,e,r){return!!Zo(t,e)||!!ma(e,t,r)}function Mo(t,e){if(t.length===1)return Ss(e,t[0]);for(var r=0;r<e.length;r++)for(var a=e[r],u=0;u<a.length;u++)if(Zo(t,a[u]))return!0;for(var c=0;c<t.length;c++)if(Ss(e,t[c]))return!0;for(var f=0;f<e.length;f++)if(Es(t,e[f]))return!0;return!1}function uo(t,e,r){if(t.length>1){if(Es(t,e))return!0;for(var a=0;a<e.length;a++)if(ma(e[a],t,r))return!0}for(var u=0;u<t.length;u++)if(ma(t[u],e,r))return!0;return!1}function Es(t,e){if(t.length===0||e.length===0)return!1;for(var r=0;r<t.length-1;r++)for(var a=t[r],u=t[r+1],c=0;c<e.length-1;c++)if(rs(a,u,e[c],e[c+1]))return!0;return!1}function rs(t,e,r,a){return Or(t,r,a)!==Or(e,r,a)&&Or(t,e,r)!==Or(t,e,a)}function ma(t,e,r){var a=r*r;if(e.length===1)return t.distSqr(e[0])<a;for(var u=1;u<e.length;u++)if(ns(t,e[u-1],e[u])<a)return!0;return!1}function ns(t,e,r){var a=e.distSqr(r);if(a===0)return t.distSqr(e);var u=((t.x-e.x)*(r.x-e.x)+(t.y-e.y)*(r.y-e.y))/a;return t.distSqr(u<0?e:u>1?r:r.sub(e)._mult(u)._add(e))}function Ss(t,e){for(var r,a,u,c=!1,f=0;f<t.length;f++)for(var y=0,x=(r=t[f]).length-1;y<r.length;x=y++)(a=r[y]).y>e.y!=(u=r[x]).y>e.y&&e.x<(u.x-a.x)*(e.y-a.y)/(u.y-a.y)+a.x&&(c=!c);return c}function Zo(t,e){for(var r=!1,a=0,u=t.length-1;a<t.length;u=a++){var c=t[a],f=t[u];c.y>e.y!=f.y>e.y&&e.x<(f.x-c.x)*(e.y-c.y)/(f.y-c.y)+c.x&&(r=!r)}return r}function Ts(t,e,r){var a=r[0],u=r[2];if(t.x<a.x&&e.x<a.x||t.x>u.x&&e.x>u.x||t.y<a.y&&e.y<a.y||t.y>u.y&&e.y>u.y)return!1;var c=Or(t,e,r[0]);return c!==Or(t,e,r[1])||c!==Or(t,e,r[2])||c!==Or(t,e,r[3])}function Go(t,e,r){var a=e.paint.get(t).value;return a.kind==="constant"?a.value:r.programConfigurations.get(e.id).getMaxValue(t)}function zn(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function $o(t,e,r,a,u){if(!e[0]&&!e[1])return t;var c=Oe.convert(e)._mult(u);r==="viewport"&&c._rotate(-a);for(var f=[],y=0;y<t.length;y++)f.push(t[y].sub(c));return f}ci.prototype.populate=function(t,e,r){var a=this.layers[0],u=[],c=null;a.type==="circle"&&(c=a.layout.get("circle-sort-key"));for(var f=0,y=t;f<y.length;f+=1){var x=y[f],w=x.feature,I=x.id,A=x.index,z=x.sourceLayerIndex,O=this.layers[0]._featureFilter.needGeometry,Z=sn(w,O);if(this.layers[0]._featureFilter.filter(new or(this.zoom),Z,r)){var X=c?c.evaluate(Z,{},r):void 0,rt={id:I,properties:w.properties,type:w.type,sourceLayerIndex:z,index:A,geometry:O?Z.geometry:Kr(w),patterns:{},sortKey:X};u.push(rt)}}c&&u.sort(function(Jt,_e){return Jt.sortKey-_e.sortKey});for(var Y=0,ct=u;Y<ct.length;Y+=1){var vt=ct[Y],xt=vt.geometry,Tt=vt.index,Mt=vt.sourceLayerIndex,Ut=t[Tt].feature;this.addFeature(vt,xt,Tt,r),e.featureIndex.insert(Ut,xt,Tt,Mt,this.index)}},ci.prototype.update=function(t,e,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,r)},ci.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ci.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ci.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,B),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},ci.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},ci.prototype.addFeature=function(t,e,r,a){for(var u=0,c=e;u<c.length;u+=1)for(var f=0,y=c[u];f<y.length;f+=1){var x=y[f],w=x.x,I=x.y;if(!(w<0||w>=8192||I<0||I>=8192)){var A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),z=A.vertexLength;qi(this.layoutVertexArray,w,I,-1,-1),qi(this.layoutVertexArray,w,I,1,-1),qi(this.layoutVertexArray,w,I,1,1),qi(this.layoutVertexArray,w,I,-1,1),this.indexArray.emplaceBack(z,z+1,z+2),this.indexArray.emplaceBack(z,z+3,z+2),A.vertexLength+=4,A.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r,{},a)},Qt("CircleBucket",ci,{omit:["layers"]});var ya=new Xn({"circle-sort-key":new ye(L.layout_circle["circle-sort-key"])}),Oa={paint:new Xn({"circle-radius":new ye(L.paint_circle["circle-radius"]),"circle-color":new ye(L.paint_circle["circle-color"]),"circle-blur":new ye(L.paint_circle["circle-blur"]),"circle-opacity":new ye(L.paint_circle["circle-opacity"]),"circle-translate":new be(L.paint_circle["circle-translate"]),"circle-translate-anchor":new be(L.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new be(L.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new be(L.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ye(L.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ye(L.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ye(L.paint_circle["circle-stroke-opacity"])}),layout:ya},br=typeof Float32Array<"u"?Float32Array:Array;function Ji(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Ti(t,e,r){var a=e[0],u=e[1],c=e[2],f=e[3],y=e[4],x=e[5],w=e[6],I=e[7],A=e[8],z=e[9],O=e[10],Z=e[11],X=e[12],rt=e[13],Y=e[14],ct=e[15],vt=r[0],xt=r[1],Tt=r[2],Mt=r[3];return t[0]=vt*a+xt*y+Tt*A+Mt*X,t[1]=vt*u+xt*x+Tt*z+Mt*rt,t[2]=vt*c+xt*w+Tt*O+Mt*Y,t[3]=vt*f+xt*I+Tt*Z+Mt*ct,t[4]=(vt=r[4])*a+(xt=r[5])*y+(Tt=r[6])*A+(Mt=r[7])*X,t[5]=vt*u+xt*x+Tt*z+Mt*rt,t[6]=vt*c+xt*w+Tt*O+Mt*Y,t[7]=vt*f+xt*I+Tt*Z+Mt*ct,t[8]=(vt=r[8])*a+(xt=r[9])*y+(Tt=r[10])*A+(Mt=r[11])*X,t[9]=vt*u+xt*x+Tt*z+Mt*rt,t[10]=vt*c+xt*w+Tt*O+Mt*Y,t[11]=vt*f+xt*I+Tt*Z+Mt*ct,t[12]=(vt=r[12])*a+(xt=r[13])*y+(Tt=r[14])*A+(Mt=r[15])*X,t[13]=vt*u+xt*x+Tt*z+Mt*rt,t[14]=vt*c+xt*w+Tt*O+Mt*Y,t[15]=vt*f+xt*I+Tt*Z+Mt*ct,t}Math.hypot||(Math.hypot=function(){for(var t=arguments,e=0,r=arguments.length;r--;)e+=t[r]*t[r];return Math.sqrt(e)});var Ra,ql=Ti;function Ys(t,e,r){var a=e[0],u=e[1],c=e[2],f=e[3];return t[0]=r[0]*a+r[4]*u+r[8]*c+r[12]*f,t[1]=r[1]*a+r[5]*u+r[9]*c+r[13]*f,t[2]=r[2]*a+r[6]*u+r[10]*c+r[14]*f,t[3]=r[3]*a+r[7]*u+r[11]*c+r[15]*f,t}Ra=new br(3),br!=Float32Array&&(Ra[0]=0,Ra[1]=0,Ra[2]=0),function(){var t=new br(4);br!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}();var Zl=(function(){var t=new br(2);br!=Float32Array&&(t[0]=0,t[1]=0)}(),function(t){function e(r){t.call(this,r,Oa)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.createBucket=function(r){return new ci(r)},e.prototype.queryRadius=function(r){var a=r;return Go("circle-radius",this,a)+Go("circle-stroke-width",this,a)+zn(this.paint.get("circle-translate"))},e.prototype.queryIntersectsFeature=function(r,a,u,c,f,y,x,w){for(var I=$o(r,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),y.angle,x),A=this.paint.get("circle-radius").evaluate(a,u)+this.paint.get("circle-stroke-width").evaluate(a,u),z=this.paint.get("circle-pitch-alignment")==="map",O=z?I:function(Ut,Jt){return Ut.map(function(_e){return Is(_e,Jt)})}(I,w),Z=z?A*x:A,X=0,rt=c;X<rt.length;X+=1)for(var Y=0,ct=rt[X];Y<ct.length;Y+=1){var vt=ct[Y],xt=z?vt:Is(vt,w),Tt=Z,Mt=Ys([],[vt.x,vt.y,0,1],w);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Tt*=Mt[3]/y.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Tt*=y.cameraToCenterDistance/Mt[3]),Si(O,xt,Tt))return!0}return!1},e}(jo));function Is(t,e){var r=Ys([],[t.x,t.y,0,1],e);return new Oe(r[0]/r[3],r[1]/r[3])}var cl=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(ci);function is(t,e,r,a){var u=e.width,c=e.height;if(a){if(a instanceof Uint8ClampedArray)a=new Uint8Array(a.buffer);else if(a.length!==u*c*r)throw new RangeError("mismatched image size")}else a=new Uint8Array(u*c*r);return t.width=u,t.height=c,t.data=a,t}function $s(t,e,r){var a=e.width,u=e.height;if(a!==t.width||u!==t.height){var c=is({},{width:a,height:u},r);Gl(t,c,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,a),height:Math.min(t.height,u)},r),t.width=a,t.height=u,t.data=c.data}}function Gl(t,e,r,a,u,c){if(u.width===0||u.height===0)return e;if(u.width>t.width||u.height>t.height||r.x>t.width-u.width||r.y>t.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||a.x>e.width-u.width||a.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");for(var f=t.data,y=e.data,x=0;x<u.height;x++)for(var w=((r.y+x)*t.width+r.x)*c,I=((a.y+x)*e.width+a.x)*c,A=0;A<u.width*c;A++)y[I+A]=f[w+A];return e}Qt("HeatmapBucket",cl,{omit:["layers"]});var Cs=function(t,e){is(this,t,1,e)};Cs.prototype.resize=function(t){$s(this,t,1)},Cs.prototype.clone=function(){return new Cs({width:this.width,height:this.height},new Uint8Array(this.data))},Cs.copy=function(t,e,r,a,u){Gl(t,e,r,a,u,1)};var Zi=function(t,e){is(this,t,4,e)};Zi.prototype.resize=function(t){$s(this,t,4)},Zi.prototype.replace=function(t,e){e?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t},Zi.prototype.clone=function(){return new Zi({width:this.width,height:this.height},new Uint8Array(this.data))},Zi.copy=function(t,e,r,a,u){Gl(t,e,r,a,u,4)},Qt("AlphaImage",Cs),Qt("RGBAImage",Zi);var Jp={paint:new Xn({"heatmap-radius":new ye(L.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ye(L.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new be(L.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ko(L.paint_heatmap["heatmap-color"]),"heatmap-opacity":new be(L.paint_heatmap["heatmap-opacity"])})};function Ic(t){var e={},r=t.resolution||256,a=t.clips?t.clips.length:1,u=t.image||new Zi({width:r,height:a}),c=function(Z,X,rt){e[t.evaluationKey]=rt;var Y=t.expression.evaluate(e);u.data[Z+X+0]=Math.floor(255*Y.r/Y.a),u.data[Z+X+1]=Math.floor(255*Y.g/Y.a),u.data[Z+X+2]=Math.floor(255*Y.b/Y.a),u.data[Z+X+3]=Math.floor(255*Y.a)};if(t.clips)for(var f=0,y=0;f<a;++f,y+=4*r)for(var x=0,w=0;x<r;x++,w+=4){var I=x/(r-1),A=t.clips[f];c(y,w,A.start*(1-I)+A.end*I)}else for(var z=0,O=0;z<r;z++,O+=4)c(0,O,z/(r-1));return u}var Yp=function(t){function e(r){t.call(this,r,Jp),this._updateColorRamp()}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.createBucket=function(r){return new cl(r)},e.prototype._handleSpecialPaintPropertyUpdate=function(r){r==="heatmap-color"&&this._updateColorRamp()},e.prototype._updateColorRamp=function(){this.colorRamp=Ic({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},e.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},e.prototype.queryRadius=function(){return 0},e.prototype.queryIntersectsFeature=function(){return!1},e.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},e}(jo),$p={paint:new Xn({"hillshade-illumination-direction":new be(L.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new be(L.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new be(L.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new be(L.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new be(L.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new be(L.paint_hillshade["hillshade-accent-color"])})},Qp=function(t){function e(r){t.call(this,r,$p)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},e}(jo),th=Nn([{name:"a_pos",components:2,type:"Int16"}],4).members,Kl=pl,eh=pl;function pl(t,e,r){r=r||2;var a,u,c,f,y,x,w,I=e&&e.length,A=I?e[0]*r:t.length,z=Cc(t,0,A,r,!0),O=[];if(!z||z.next===z.prev)return O;if(I&&(z=function(X,rt,Y,ct){var vt,xt,Tt,Mt=[];for(vt=0,xt=rt.length;vt<xt;vt++)(Tt=Cc(X,rt[vt]*ct,vt<xt-1?rt[vt+1]*ct:X.length,ct,!1))===Tt.next&&(Tt.steiner=!0),Mt.push(lh(Tt));for(Mt.sort(ah),vt=0;vt<Mt.length;vt++)sh(Mt[vt],Y),Y=os(Y,Y.next);return Y}(t,e,z,r)),t.length>80*r){a=c=t[0],u=f=t[1];for(var Z=r;Z<A;Z+=r)(y=t[Z])<a&&(a=y),(x=t[Z+1])<u&&(u=x),y>c&&(c=y),x>f&&(f=x);w=(w=Math.max(c-a,f-u))!==0?1/w:0}return Bu(z,O,r,a,u,w),O}function Cc(t,e,r,a,u){var c,f;if(u===Hl(t,e,r,a)>0)for(c=e;c<r;c+=a)f=kc(c,t[c],t[c+1],f);else for(c=r-a;c>=e;c-=a)f=kc(c,t[c],t[c+1],f);return f&&hl(f,f.next)&&(Nu(f),f=f.next),f}function os(t,e){if(!t)return t;e||(e=t);var r,a=t;do if(r=!1,a.steiner||!hl(a,a.next)&&Sn(a.prev,a,a.next)!==0)a=a.next;else{if(Nu(a),(a=e=a.prev)===a.next)break;r=!0}while(r||a!==e);return e}function Bu(t,e,r,a,u,c,f){if(t){!f&&c&&function(I,A,z,O){var Z=I;do Z.z===null&&(Z.z=Xl(Z.x,Z.y,A,z,O)),Z.prevZ=Z.prev,Z.nextZ=Z.next,Z=Z.next;while(Z!==I);Z.prevZ.nextZ=null,Z.prevZ=null,function(X){var rt,Y,ct,vt,xt,Tt,Mt,Ut,Jt=1;do{for(Y=X,X=null,xt=null,Tt=0;Y;){for(Tt++,ct=Y,Mt=0,rt=0;rt<Jt&&(Mt++,ct=ct.nextZ);rt++);for(Ut=Jt;Mt>0||Ut>0&&ct;)Mt!==0&&(Ut===0||!ct||Y.z<=ct.z)?(vt=Y,Y=Y.nextZ,Mt--):(vt=ct,ct=ct.nextZ,Ut--),xt?xt.nextZ=vt:X=vt,vt.prevZ=xt,xt=vt;Y=ct}xt.nextZ=null,Jt*=2}while(Tt>1)}(Z)}(t,a,u,c);for(var y,x,w=t;t.prev!==t.next;)if(y=t.prev,x=t.next,c?nh(t,a,u,c):rh(t))e.push(y.i/r),e.push(t.i/r),e.push(x.i/r),Nu(t),t=x.next,w=x.next;else if((t=x)===w){f?f===1?Bu(t=ih(os(t),e,r),e,r,a,u,c,2):f===2&&oh(t,e,r,a,u,c):Bu(os(t),e,r,a,u,c,1);break}}}function rh(t){var e=t.prev,r=t,a=t.next;if(Sn(e,r,a)>=0)return!1;for(var u=t.next.next;u!==t.prev;){if(Qs(e.x,e.y,r.x,r.y,a.x,a.y,u.x,u.y)&&Sn(u.prev,u,u.next)>=0)return!1;u=u.next}return!0}function nh(t,e,r,a){var u=t.prev,c=t,f=t.next;if(Sn(u,c,f)>=0)return!1;for(var y=u.x>c.x?u.x>f.x?u.x:f.x:c.x>f.x?c.x:f.x,x=u.y>c.y?u.y>f.y?u.y:f.y:c.y>f.y?c.y:f.y,w=Xl(u.x<c.x?u.x<f.x?u.x:f.x:c.x<f.x?c.x:f.x,u.y<c.y?u.y<f.y?u.y:f.y:c.y<f.y?c.y:f.y,e,r,a),I=Xl(y,x,e,r,a),A=t.prevZ,z=t.nextZ;A&&A.z>=w&&z&&z.z<=I;){if(A!==t.prev&&A!==t.next&&Qs(u.x,u.y,c.x,c.y,f.x,f.y,A.x,A.y)&&Sn(A.prev,A,A.next)>=0||(A=A.prevZ,z!==t.prev&&z!==t.next&&Qs(u.x,u.y,c.x,c.y,f.x,f.y,z.x,z.y)&&Sn(z.prev,z,z.next)>=0))return!1;z=z.nextZ}for(;A&&A.z>=w;){if(A!==t.prev&&A!==t.next&&Qs(u.x,u.y,c.x,c.y,f.x,f.y,A.x,A.y)&&Sn(A.prev,A,A.next)>=0)return!1;A=A.prevZ}for(;z&&z.z<=I;){if(z!==t.prev&&z!==t.next&&Qs(u.x,u.y,c.x,c.y,f.x,f.y,z.x,z.y)&&Sn(z.prev,z,z.next)>=0)return!1;z=z.nextZ}return!0}function ih(t,e,r){var a=t;do{var u=a.prev,c=a.next.next;!hl(u,c)&&Ac(u,a,a.next,c)&&Fu(u,c)&&Fu(c,u)&&(e.push(u.i/r),e.push(a.i/r),e.push(c.i/r),Nu(a),Nu(a.next),a=t=c),a=a.next}while(a!==t);return os(a)}function oh(t,e,r,a,u,c){var f=t;do{for(var y=f.next.next;y!==f.prev;){if(f.i!==y.i&&ch(f,y)){var x=Pc(f,y);return f=os(f,f.next),x=os(x,x.next),Bu(f,e,r,a,u,c),void Bu(x,e,r,a,u,c)}y=y.next}f=f.next}while(f!==t)}function ah(t,e){return t.x-e.x}function sh(t,e){if(e=function(a,u){var c,f=u,y=a.x,x=a.y,w=-1/0;do{if(x<=f.y&&x>=f.next.y&&f.next.y!==f.y){var I=f.x+(x-f.y)*(f.next.x-f.x)/(f.next.y-f.y);if(I<=y&&I>w){if(w=I,I===y){if(x===f.y)return f;if(x===f.next.y)return f.next}c=f.x<f.next.x?f:f.next}}f=f.next}while(f!==u);if(!c)return null;if(y===w)return c;var A,z=c,O=c.x,Z=c.y,X=1/0;f=c;do y>=f.x&&f.x>=O&&y!==f.x&&Qs(x<Z?y:w,x,O,Z,x<Z?w:y,x,f.x,f.y)&&(A=Math.abs(x-f.y)/(y-f.x),Fu(f,a)&&(A<X||A===X&&(f.x>c.x||f.x===c.x&&uh(c,f)))&&(c=f,X=A)),f=f.next;while(f!==z);return c}(t,e)){var r=Pc(e,t);os(e,e.next),os(r,r.next)}}function uh(t,e){return Sn(t.prev,t,e.prev)<0&&Sn(e.next,t,t.next)<0}function Xl(t,e,r,a,u){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*u)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-a)*u)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function lh(t){var e=t,r=t;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==t);return r}function Qs(t,e,r,a,u,c,f,y){return(u-f)*(e-y)-(t-f)*(c-y)>=0&&(t-f)*(a-y)-(r-f)*(e-y)>=0&&(r-f)*(c-y)-(u-f)*(a-y)>=0}function ch(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(r,a){var u=r;do{if(u.i!==r.i&&u.next.i!==r.i&&u.i!==a.i&&u.next.i!==a.i&&Ac(u,u.next,r,a))return!0;u=u.next}while(u!==r);return!1}(t,e)&&(Fu(t,e)&&Fu(e,t)&&function(r,a){var u=r,c=!1,f=(r.x+a.x)/2,y=(r.y+a.y)/2;do u.y>y!=u.next.y>y&&u.next.y!==u.y&&f<(u.next.x-u.x)*(y-u.y)/(u.next.y-u.y)+u.x&&(c=!c),u=u.next;while(u!==r);return c}(t,e)&&(Sn(t.prev,t,e.prev)||Sn(t,e.prev,e))||hl(t,e)&&Sn(t.prev,t,t.next)>0&&Sn(e.prev,e,e.next)>0)}function Sn(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function hl(t,e){return t.x===e.x&&t.y===e.y}function Ac(t,e,r,a){var u=dl(Sn(t,e,r)),c=dl(Sn(t,e,a)),f=dl(Sn(r,a,t)),y=dl(Sn(r,a,e));return u!==c&&f!==y||!(u!==0||!fl(t,r,e))||!(c!==0||!fl(t,a,e))||!(f!==0||!fl(r,t,a))||!(y!==0||!fl(r,e,a))}function fl(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function dl(t){return t>0?1:t<0?-1:0}function Fu(t,e){return Sn(t.prev,t,t.next)<0?Sn(t,e,t.next)>=0&&Sn(t,t.prev,e)>=0:Sn(t,e,t.prev)<0||Sn(t,t.next,e)<0}function Pc(t,e){var r=new Wl(t.i,t.x,t.y),a=new Wl(e.i,e.x,e.y),u=t.next,c=e.prev;return t.next=e,e.prev=t,r.next=u,u.prev=r,a.next=r,r.prev=a,c.next=a,a.prev=c,a}function kc(t,e,r,a){var u=new Wl(t,e,r);return a?(u.next=a.next,u.prev=a,a.next.prev=u,a.next=u):(u.prev=u,u.next=u),u}function Nu(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Wl(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Hl(t,e,r,a){for(var u=0,c=e,f=r-a;c<r;c+=a)u+=(t[f]-t[c])*(t[c+1]+t[f+1]),f=c;return u}function ph(t,e,r,a,u){(function c(f,y,x,w,I){for(;w>x;){if(w-x>600){var A=w-x+1,z=y-x+1,O=Math.log(A),Z=.5*Math.exp(2*O/3),X=.5*Math.sqrt(O*Z*(A-Z)/A)*(z-A/2<0?-1:1);c(f,y,Math.max(x,Math.floor(y-z*Z/A+X)),Math.min(w,Math.floor(y+(A-z)*Z/A+X)),I)}var rt=f[y],Y=x,ct=w;for(Uu(f,x,y),I(f[w],rt)>0&&Uu(f,x,w);Y<ct;){for(Uu(f,Y,ct),Y++,ct--;I(f[Y],rt)<0;)Y++;for(;I(f[ct],rt)>0;)ct--}I(f[x],rt)===0?Uu(f,x,ct):Uu(f,++ct,w),ct<=y&&(x=ct+1),y<=ct&&(w=ct-1)}})(t,e,r||0,a||t.length-1,u||hh)}function Uu(t,e,r){var a=t[e];t[e]=t[r],t[r]=a}function hh(t,e){return t<e?-1:t>e?1:0}function Jl(t,e){var r=t.length;if(r<=1)return[t];for(var a,u,c=[],f=0;f<r;f++){var y=Lo(t[f]);y!==0&&(t[f].area=Math.abs(y),u===void 0&&(u=y<0),u===y<0?(a&&c.push(a),a=[t[f]]):a.push(t[f]))}if(a&&c.push(a),e>1)for(var x=0;x<c.length;x++)c[x].length<=e||(ph(c[x],e,1,c[x].length-1,fh),c[x]=c[x].slice(0,e));return c}function fh(t,e){return e.area-t.area}function Yl(t,e,r){for(var a=r.patternDependencies,u=!1,c=0,f=e;c<f.length;c+=1){var y=f[c].paint.get(t+"-pattern");y.isConstant()||(u=!0);var x=y.constantOr(null);x&&(u=!0,a[x.to]=!0,a[x.from]=!0)}return u}function $l(t,e,r,a,u){for(var c=u.patternDependencies,f=0,y=e;f<y.length;f+=1){var x=y[f],w=x.paint.get(t+"-pattern").value;if(w.kind!=="constant"){var I=w.evaluate({zoom:a-1},r,{},u.availableImages),A=w.evaluate({zoom:a},r,{},u.availableImages),z=w.evaluate({zoom:a+1},r,{},u.availableImages);A=A&&A.name?A.name:A,z=z&&z.name?z.name:z,c[I=I&&I.name?I.name:I]=!0,c[A]=!0,c[z]=!0,r.patterns[x.id]={min:I,mid:A,max:z}}}return r}pl.deviation=function(t,e,r,a){var u=e&&e.length,c=Math.abs(Hl(t,0,u?e[0]*r:t.length,r));if(u)for(var f=0,y=e.length;f<y;f++)c-=Math.abs(Hl(t,e[f]*r,f<y-1?e[f+1]*r:t.length,r));var x=0;for(f=0;f<a.length;f+=3){var w=a[f]*r,I=a[f+1]*r,A=a[f+2]*r;x+=Math.abs((t[w]-t[A])*(t[I+1]-t[w+1])-(t[w]-t[I])*(t[A+1]-t[w+1]))}return c===0&&x===0?0:Math.abs((x-c)/c)},pl.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},a=0,u=0;u<t.length;u++){for(var c=0;c<t[u].length;c++)for(var f=0;f<e;f++)r.vertices.push(t[u][c][f]);u>0&&r.holes.push(a+=t[u-1].length)}return r},Kl.default=eh;var Qo=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(e){return e.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Da,this.indexArray=new pa,this.indexArray2=new ws,this.programConfigurations=new Pe(t.layers,t.zoom),this.segments=new F,this.segments2=new F,this.stateDependentLayerIds=this.layers.filter(function(e){return e.isStateDependent()}).map(function(e){return e.id})};Qo.prototype.populate=function(t,e,r){this.hasPattern=Yl("fill",this.layers,e);for(var a=this.layers[0].layout.get("fill-sort-key"),u=[],c=0,f=t;c<f.length;c+=1){var y=f[c],x=y.feature,w=y.id,I=y.index,A=y.sourceLayerIndex,z=this.layers[0]._featureFilter.needGeometry,O=sn(x,z);if(this.layers[0]._featureFilter.filter(new or(this.zoom),O,r)){var Z=a?a.evaluate(O,{},r,e.availableImages):void 0,X={id:w,properties:x.properties,type:x.type,sourceLayerIndex:A,index:I,geometry:z?O.geometry:Kr(x),patterns:{},sortKey:Z};u.push(X)}}a&&u.sort(function(Ut,Jt){return Ut.sortKey-Jt.sortKey});for(var rt=0,Y=u;rt<Y.length;rt+=1){var ct=Y[rt],vt=ct.geometry,xt=ct.index,Tt=ct.sourceLayerIndex;if(this.hasPattern){var Mt=$l("fill",this.layers,ct,this.zoom,e);this.patternFeatures.push(Mt)}else this.addFeature(ct,vt,xt,r,{});e.featureIndex.insert(t[xt].feature,vt,xt,Tt,this.index)}},Qo.prototype.update=function(t,e,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,r)},Qo.prototype.addFeatures=function(t,e,r){for(var a=0,u=this.patternFeatures;a<u.length;a+=1){var c=u[a];this.addFeature(c,c.geometry,c.index,e,r)}},Qo.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Qo.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Qo.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,th),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0},Qo.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},Qo.prototype.addFeature=function(t,e,r,a,u){for(var c=0,f=Jl(e,500);c<f.length;c+=1){for(var y=f[c],x=0,w=0,I=y;w<I.length;w+=1)x+=I[w].length;for(var A=this.segments.prepareSegment(x,this.layoutVertexArray,this.indexArray),z=A.vertexLength,O=[],Z=[],X=0,rt=y;X<rt.length;X+=1){var Y=rt[X];if(Y.length!==0){Y!==y[0]&&Z.push(O.length/2);var ct=this.segments2.prepareSegment(Y.length,this.layoutVertexArray,this.indexArray2),vt=ct.vertexLength;this.layoutVertexArray.emplaceBack(Y[0].x,Y[0].y),this.indexArray2.emplaceBack(vt+Y.length-1,vt),O.push(Y[0].x),O.push(Y[0].y);for(var xt=1;xt<Y.length;xt++)this.layoutVertexArray.emplaceBack(Y[xt].x,Y[xt].y),this.indexArray2.emplaceBack(vt+xt-1,vt+xt),O.push(Y[xt].x),O.push(Y[xt].y);ct.vertexLength+=Y.length,ct.primitiveLength+=Y.length}}for(var Tt=Kl(O,Z),Mt=0;Mt<Tt.length;Mt+=3)this.indexArray.emplaceBack(z+Tt[Mt],z+Tt[Mt+1],z+Tt[Mt+2]);A.vertexLength+=x,A.primitiveLength+=Tt.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r,u,a)},Qt("FillBucket",Qo,{omit:["layers","patternFeatures"]});var dh=new Xn({"fill-sort-key":new ye(L.layout_fill["fill-sort-key"])}),mh={paint:new Xn({"fill-antialias":new be(L.paint_fill["fill-antialias"]),"fill-opacity":new ye(L.paint_fill["fill-opacity"]),"fill-color":new ye(L.paint_fill["fill-color"]),"fill-outline-color":new ye(L.paint_fill["fill-outline-color"]),"fill-translate":new be(L.paint_fill["fill-translate"]),"fill-translate-anchor":new be(L.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ks(L.paint_fill["fill-pattern"])}),layout:dh},yh=function(t){function e(r){t.call(this,r,mh)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.recalculate=function(r,a){t.prototype.recalculate.call(this,r,a);var u=this.paint._values["fill-outline-color"];u.value.kind==="constant"&&u.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},e.prototype.createBucket=function(r){return new Qo(r)},e.prototype.queryRadius=function(){return zn(this.paint.get("fill-translate"))},e.prototype.queryIntersectsFeature=function(r,a,u,c,f,y,x){return Mo($o(r,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),y.angle,x),c)},e.prototype.isTileClipped=function(){return!0},e}(jo),gh=Nn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,Mc=tu;function tu(t,e,r,a,u){this.properties={},this.extent=r,this.type=0,this._pbf=t,this._geometry=-1,this._keys=a,this._values=u,t.readFields(vh,this,e)}function vh(t,e,r){t==1?e.id=r.readVarint():t==2?function(a,u){for(var c=a.readVarint()+a.pos;a.pos<c;){var f=u._keys[a.readVarint()],y=u._values[a.readVarint()];u.properties[f]=y}}(r,e):t==3?e.type=r.readVarint():t==4&&(e._geometry=r.pos)}function _h(t){for(var e,r,a=0,u=0,c=t.length,f=c-1;u<c;f=u++)a+=((r=t[f]).x-(e=t[u]).x)*(e.y+r.y);return a}tu.types=["Unknown","Point","LineString","Polygon"],tu.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,r=t.readVarint()+t.pos,a=1,u=0,c=0,f=0,y=[];t.pos<r;){if(u<=0){var x=t.readVarint();a=7&x,u=x>>3}if(u--,a===1||a===2)c+=t.readSVarint(),f+=t.readSVarint(),a===1&&(e&&y.push(e),e=[]),e.push(new Oe(c,f));else{if(a!==7)throw new Error("unknown command "+a);e&&e.push(e[0].clone())}}return e&&y.push(e),y},tu.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,r=1,a=0,u=0,c=0,f=1/0,y=-1/0,x=1/0,w=-1/0;t.pos<e;){if(a<=0){var I=t.readVarint();r=7&I,a=I>>3}if(a--,r===1||r===2)(u+=t.readSVarint())<f&&(f=u),u>y&&(y=u),(c+=t.readSVarint())<x&&(x=c),c>w&&(w=c);else if(r!==7)throw new Error("unknown command "+r)}return[f,x,y,w]},tu.prototype.toGeoJSON=function(t,e,r){var a,u,c=this.extent*Math.pow(2,r),f=this.extent*t,y=this.extent*e,x=this.loadGeometry(),w=tu.types[this.type];function I(O){for(var Z=0;Z<O.length;Z++){var X=O[Z];O[Z]=[360*(X.x+f)/c-180,360/Math.PI*Math.atan(Math.exp((180-360*(X.y+y)/c)*Math.PI/180))-90]}}switch(this.type){case 1:var A=[];for(a=0;a<x.length;a++)A[a]=x[a][0];I(x=A);break;case 2:for(a=0;a<x.length;a++)I(x[a]);break;case 3:for(x=function(O){var Z=O.length;if(Z<=1)return[O];for(var X,rt,Y=[],ct=0;ct<Z;ct++){var vt=_h(O[ct]);vt!==0&&(rt===void 0&&(rt=vt<0),rt===vt<0?(X&&Y.push(X),X=[O[ct]]):X.push(O[ct]))}return X&&Y.push(X),Y}(x),a=0;a<x.length;a++)for(u=0;u<x[a].length;u++)I(x[a][u])}x.length===1?x=x[0]:w="Multi"+w;var z={type:"Feature",geometry:{type:w,coordinates:x},properties:this.properties};return"id"in this&&(z.id=this.id),z};var zc=Dc;function Dc(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(xh,this,e),this.length=this._features.length}function xh(t,e,r){t===15?e.version=r.readVarint():t===1?e.name=r.readString():t===5?e.extent=r.readVarint():t===2?e._features.push(r.pos):t===3?e._keys.push(r.readString()):t===4&&e._values.push(function(a){for(var u=null,c=a.readVarint()+a.pos;a.pos<c;){var f=a.readVarint()>>3;u=f===1?a.readString():f===2?a.readFloat():f===3?a.readDouble():f===4?a.readVarint64():f===5?a.readVarint():f===6?a.readSVarint():f===7?a.readBoolean():null}return u}(r))}function bh(t,e,r){if(t===3){var a=new zc(r,r.readVarint()+r.pos);a.length&&(e[a.name]=a)}}Dc.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new Mc(this._pbf,e,this.extent,this._keys,this._values)};var eu={VectorTile:function(t,e){this.layers=t.readFields(bh,{},e)},VectorTileFeature:Mc,VectorTileLayer:zc},wh=eu.VectorTileFeature.types,Ql=Math.pow(2,13);function Vu(t,e,r,a,u,c,f,y){t.emplaceBack(e,r,2*Math.floor(a*Ql)+f,u*Ql*2,c*Ql*2,Math.round(y))}var ta=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(e){return e.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Yo,this.indexArray=new pa,this.programConfigurations=new Pe(t.layers,t.zoom),this.segments=new F,this.stateDependentLayerIds=this.layers.filter(function(e){return e.isStateDependent()}).map(function(e){return e.id})};function Eh(t,e){return t.x===e.x&&(t.x<0||t.x>8192)||t.y===e.y&&(t.y<0||t.y>8192)}ta.prototype.populate=function(t,e,r){this.features=[],this.hasPattern=Yl("fill-extrusion",this.layers,e);for(var a=0,u=t;a<u.length;a+=1){var c=u[a],f=c.feature,y=c.id,x=c.index,w=c.sourceLayerIndex,I=this.layers[0]._featureFilter.needGeometry,A=sn(f,I);if(this.layers[0]._featureFilter.filter(new or(this.zoom),A,r)){var z={id:y,sourceLayerIndex:w,index:x,geometry:I?A.geometry:Kr(f),properties:f.properties,type:f.type,patterns:{}};this.hasPattern?this.features.push($l("fill-extrusion",this.layers,z,this.zoom,e)):this.addFeature(z,z.geometry,x,r,{}),e.featureIndex.insert(f,z.geometry,x,w,this.index,!0)}}},ta.prototype.addFeatures=function(t,e,r){for(var a=0,u=this.features;a<u.length;a+=1){var c=u[a];this.addFeature(c,c.geometry,c.index,e,r)}},ta.prototype.update=function(t,e,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,r)},ta.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ta.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ta.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,gh),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},ta.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},ta.prototype.addFeature=function(t,e,r,a,u){for(var c=0,f=Jl(e,500);c<f.length;c+=1){for(var y=f[c],x=0,w=0,I=y;w<I.length;w+=1)x+=I[w].length;for(var A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),z=0,O=y;z<O.length;z+=1){var Z=O[z];if(Z.length!==0&&!((nr=Z).every(function(Ge){return Ge.x<0})||nr.every(function(Ge){return Ge.x>8192})||nr.every(function(Ge){return Ge.y<0})||nr.every(function(Ge){return Ge.y>8192})))for(var X=0,rt=0;rt<Z.length;rt++){var Y=Z[rt];if(rt>=1){var ct=Z[rt-1];if(!Eh(Y,ct)){A.vertexLength+4>F.MAX_VERTEX_ARRAY_LENGTH&&(A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var vt=Y.sub(ct)._perp()._unit(),xt=ct.dist(Y);X+xt>32768&&(X=0),Vu(this.layoutVertexArray,Y.x,Y.y,vt.x,vt.y,0,0,X),Vu(this.layoutVertexArray,Y.x,Y.y,vt.x,vt.y,0,1,X),Vu(this.layoutVertexArray,ct.x,ct.y,vt.x,vt.y,0,0,X+=xt),Vu(this.layoutVertexArray,ct.x,ct.y,vt.x,vt.y,0,1,X);var Tt=A.vertexLength;this.indexArray.emplaceBack(Tt,Tt+2,Tt+1),this.indexArray.emplaceBack(Tt+1,Tt+2,Tt+3),A.vertexLength+=4,A.primitiveLength+=2}}}}if(A.vertexLength+x>F.MAX_VERTEX_ARRAY_LENGTH&&(A=this.segments.prepareSegment(x,this.layoutVertexArray,this.indexArray)),wh[t.type]==="Polygon"){for(var Mt=[],Ut=[],Jt=A.vertexLength,_e=0,ue=y;_e<ue.length;_e+=1){var Ee=ue[_e];if(Ee.length!==0){Ee!==y[0]&&Ut.push(Mt.length/2);for(var le=0;le<Ee.length;le++){var Qe=Ee[le];Vu(this.layoutVertexArray,Qe.x,Qe.y,0,0,1,1,0),Mt.push(Qe.x),Mt.push(Qe.y)}}}for(var ke=Kl(Mt,Ut),ge=0;ge<ke.length;ge+=3)this.indexArray.emplaceBack(Jt+ke[ge],Jt+ke[ge+2],Jt+ke[ge+1]);A.primitiveLength+=ke.length/3,A.vertexLength+=x}}var nr;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r,u,a)},Qt("FillExtrusionBucket",ta,{omit:["layers","features"]});var Sh={paint:new Xn({"fill-extrusion-opacity":new be(L["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ye(L["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new be(L["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new be(L["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ks(L["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ye(L["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ye(L["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new be(L["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},Th=function(t){function e(r){t.call(this,r,Sh)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.createBucket=function(r){return new ta(r)},e.prototype.queryRadius=function(){return zn(this.paint.get("fill-extrusion-translate"))},e.prototype.is3D=function(){return!0},e.prototype.queryIntersectsFeature=function(r,a,u,c,f,y,x,w){var I=$o(r,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),y.angle,x),A=this.paint.get("fill-extrusion-height").evaluate(a,u),z=this.paint.get("fill-extrusion-base").evaluate(a,u),O=function(X,rt,Y,ct){for(var vt=[],xt=0,Tt=X;xt<Tt.length;xt+=1){var Mt=Tt[xt],Ut=[Mt.x,Mt.y,0,1];Ys(Ut,Ut,rt),vt.push(new Oe(Ut[0]/Ut[3],Ut[1]/Ut[3]))}return vt}(I,w),Z=function(X,rt,Y,ct){for(var vt=[],xt=[],Tt=ct[8]*rt,Mt=ct[9]*rt,Ut=ct[10]*rt,Jt=ct[11]*rt,_e=ct[8]*Y,ue=ct[9]*Y,Ee=ct[10]*Y,le=ct[11]*Y,Qe=0,ke=X;Qe<ke.length;Qe+=1){for(var ge=[],nr=[],Ge=0,pr=ke[Qe];Ge<pr.length;Ge+=1){var Se=pr[Ge],gr=Se.x,jr=Se.y,tn=ct[0]*gr+ct[4]*jr+ct[12],Xr=ct[1]*gr+ct[5]*jr+ct[13],qr=ct[2]*gr+ct[6]*jr+ct[14],en=ct[3]*gr+ct[7]*jr+ct[15],Dn=qr+Ut,Ln=en+Jt,hi=tn+_e,jn=Xr+ue,fi=qr+Ee,un=en+le,qn=new Oe((tn+Tt)/Ln,(Xr+Mt)/Ln);qn.z=Dn/Ln,ge.push(qn);var ar=new Oe(hi/un,jn/un);ar.z=fi/un,nr.push(ar)}vt.push(ge),xt.push(nr)}return[vt,xt]}(c,z,A,w);return function(X,rt,Y){var ct=1/0;Mo(Y,rt)&&(ct=Lc(Y,rt[0]));for(var vt=0;vt<rt.length;vt++)for(var xt=rt[vt],Tt=X[vt],Mt=0;Mt<xt.length-1;Mt++){var Ut=xt[Mt],Jt=[Ut,xt[Mt+1],Tt[Mt+1],Tt[Mt],Ut];da(Y,Jt)&&(ct=Math.min(ct,Lc(Y,Jt)))}return ct!==1/0&&ct}(Z[0],Z[1],O)},e}(jo);function ju(t,e){return t.x*e.x+t.y*e.y}function Lc(t,e){if(t.length===1){for(var r,a=0,u=e[a++];!r||u.equals(r);)if(!(r=e[a++]))return 1/0;for(;a<e.length;a++){var c=e[a],f=t[0],y=r.sub(u),x=c.sub(u),w=f.sub(u),I=ju(y,y),A=ju(y,x),z=ju(x,x),O=ju(w,y),Z=ju(w,x),X=I*z-A*A,rt=(z*O-A*Z)/X,Y=(I*Z-A*O)/X,ct=u.z*(1-rt-Y)+r.z*rt+c.z*Y;if(isFinite(ct))return ct}return 1/0}for(var vt=1/0,xt=0,Tt=e;xt<Tt.length;xt+=1)vt=Math.min(vt,Tt[xt].z);return vt}var Ih=Nn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,Ch=Nn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,Ah=eu.VectorTileFeature.types,Ph=Math.cos(Math.PI/180*37.5),Oc=Math.pow(2,14)/.5,Ii=function(t){var e=this;this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(r){return r.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(r){e.gradients[r.id]={}}),this.layoutVertexArray=new ji,this.layoutVertexArray2=new Qa,this.indexArray=new pa,this.programConfigurations=new Pe(t.layers,t.zoom),this.segments=new F,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(r){return r.isStateDependent()}).map(function(r){return r.id})};Ii.prototype.populate=function(t,e,r){this.hasPattern=Yl("line",this.layers,e);for(var a=this.layers[0].layout.get("line-sort-key"),u=[],c=0,f=t;c<f.length;c+=1){var y=f[c],x=y.feature,w=y.id,I=y.index,A=y.sourceLayerIndex,z=this.layers[0]._featureFilter.needGeometry,O=sn(x,z);if(this.layers[0]._featureFilter.filter(new or(this.zoom),O,r)){var Z=a?a.evaluate(O,{},r):void 0,X={id:w,properties:x.properties,type:x.type,sourceLayerIndex:A,index:I,geometry:z?O.geometry:Kr(x),patterns:{},sortKey:Z};u.push(X)}}a&&u.sort(function(Ut,Jt){return Ut.sortKey-Jt.sortKey});for(var rt=0,Y=u;rt<Y.length;rt+=1){var ct=Y[rt],vt=ct.geometry,xt=ct.index,Tt=ct.sourceLayerIndex;if(this.hasPattern){var Mt=$l("line",this.layers,ct,this.zoom,e);this.patternFeatures.push(Mt)}else this.addFeature(ct,vt,xt,r,{});e.featureIndex.insert(t[xt].feature,vt,xt,Tt,this.index)}},Ii.prototype.update=function(t,e,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,r)},Ii.prototype.addFeatures=function(t,e,r){for(var a=0,u=this.patternFeatures;a<u.length;a+=1){var c=u[a];this.addFeature(c,c.geometry,c.index,e,r)}},Ii.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Ii.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ii.prototype.upload=function(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Ch)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ih),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Ii.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Ii.prototype.lineFeatureClips=function(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}},Ii.prototype.addFeature=function(t,e,r,a,u){var c=this.layers[0].layout,f=c.get("line-join").evaluate(t,{}),y=c.get("line-cap"),x=c.get("line-miter-limit"),w=c.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(var I=0,A=e;I<A.length;I+=1)this.addLine(A[I],t,f,y,x,w);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r,u,a)},Ii.prototype.addLine=function(t,e,r,a,u,c){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var f=0;f<t.length-1;f++)this.totalDistance+=t[f].dist(t[f+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var y=Ah[e.type]==="Polygon",x=t.length;x>=2&&t[x-1].equals(t[x-2]);)x--;for(var w=0;w<x-1&&t[w].equals(t[w+1]);)w++;if(!(x<(y?3:2))){r==="bevel"&&(u=1.05);var I,A=this.overscaling<=16?122880/(512*this.overscaling):0,z=this.segments.prepareSegment(10*x,this.layoutVertexArray,this.indexArray),O=void 0,Z=void 0,X=void 0,rt=void 0;this.e1=this.e2=-1,y&&(rt=t[w].sub(I=t[x-2])._unit()._perp());for(var Y=w;Y<x;Y++)if(!(Z=Y===x-1?y?t[w+1]:void 0:t[Y+1])||!t[Y].equals(Z)){rt&&(X=rt),I&&(O=I),I=t[Y],rt=Z?Z.sub(I)._unit()._perp():X;var ct=(X=X||rt).add(rt);ct.x===0&&ct.y===0||ct._unit();var vt=X.x*rt.x+X.y*rt.y,xt=ct.x*rt.x+ct.y*rt.y,Tt=xt!==0?1/xt:1/0,Mt=2*Math.sqrt(2-2*xt),Ut=xt<Ph&&O&&Z,Jt=X.x*rt.y-X.y*rt.x>0;if(Ut&&Y>w){var _e=I.dist(O);if(_e>2*A){var ue=I.sub(I.sub(O)._mult(A/_e)._round());this.updateDistance(O,ue),this.addCurrentVertex(ue,X,0,0,z),O=ue}}var Ee=O&&Z,le=Ee?r:y?"butt":a;if(Ee&&le==="round"&&(Tt<c?le="miter":Tt<=2&&(le="fakeround")),le==="miter"&&Tt>u&&(le="bevel"),le==="bevel"&&(Tt>2&&(le="flipbevel"),Tt<u&&(le="miter")),O&&this.updateDistance(O,I),le==="miter")ct._mult(Tt),this.addCurrentVertex(I,ct,0,0,z);else if(le==="flipbevel"){if(Tt>100)ct=rt.mult(-1);else{var Qe=Tt*X.add(rt).mag()/X.sub(rt).mag();ct._perp()._mult(Qe*(Jt?-1:1))}this.addCurrentVertex(I,ct,0,0,z),this.addCurrentVertex(I,ct.mult(-1),0,0,z)}else if(le==="bevel"||le==="fakeround"){var ke=-Math.sqrt(Tt*Tt-1),ge=Jt?ke:0,nr=Jt?0:ke;if(O&&this.addCurrentVertex(I,X,ge,nr,z),le==="fakeround")for(var Ge=Math.round(180*Mt/Math.PI/20),pr=1;pr<Ge;pr++){var Se=pr/Ge;if(Se!==.5){var gr=Se-.5;Se+=Se*gr*(Se-1)*((1.0904+vt*(vt*(3.55645-1.43519*vt)-3.2452))*gr*gr+(.848013+vt*(.215638*vt-1.06021)))}var jr=rt.sub(X)._mult(Se)._add(X)._unit()._mult(Jt?-1:1);this.addHalfVertex(I,jr.x,jr.y,!1,Jt,0,z)}Z&&this.addCurrentVertex(I,rt,-ge,-nr,z)}else if(le==="butt")this.addCurrentVertex(I,ct,0,0,z);else if(le==="square"){var tn=O?1:-1;this.addCurrentVertex(I,ct,tn,tn,z)}else le==="round"&&(O&&(this.addCurrentVertex(I,X,0,0,z),this.addCurrentVertex(I,X,1,1,z,!0)),Z&&(this.addCurrentVertex(I,rt,-1,-1,z,!0),this.addCurrentVertex(I,rt,0,0,z)));if(Ut&&Y<x-1){var Xr=I.dist(Z);if(Xr>2*A){var qr=I.add(Z.sub(I)._mult(A/Xr)._round());this.updateDistance(I,qr),this.addCurrentVertex(qr,rt,0,0,z),I=qr}}}}},Ii.prototype.addCurrentVertex=function(t,e,r,a,u,c){c===void 0&&(c=!1);var f=e.y*a-e.x,y=-e.y-e.x*a;this.addHalfVertex(t,e.x+e.y*r,e.y-e.x*r,c,!1,r,u),this.addHalfVertex(t,f,y,c,!0,-a,u),this.distance>Oc/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(t,e,r,a,u,c))},Ii.prototype.addHalfVertex=function(t,e,r,a,u,c,f){var y=.5*(this.lineClips?this.scaledDistance*(Oc-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t.x<<1)+(a?1:0),(t.y<<1)+(u?1:0),Math.round(63*e)+128,Math.round(63*r)+128,1+(c===0?0:c<0?-1:1)|(63&y)<<2,y>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var x=f.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,x),f.primitiveLength++),u?this.e2=x:this.e1=x},Ii.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},Ii.prototype.updateDistance=function(t,e){this.distance+=t.dist(e),this.updateScaledDistance()},Qt("LineBucket",Ii,{omit:["layers","patternFeatures"]});var kh=new Xn({"line-cap":new be(L.layout_line["line-cap"]),"line-join":new ye(L.layout_line["line-join"]),"line-miter-limit":new be(L.layout_line["line-miter-limit"]),"line-round-limit":new be(L.layout_line["line-round-limit"]),"line-sort-key":new ye(L.layout_line["line-sort-key"])}),Rc={paint:new Xn({"line-opacity":new ye(L.paint_line["line-opacity"]),"line-color":new ye(L.paint_line["line-color"]),"line-translate":new be(L.paint_line["line-translate"]),"line-translate-anchor":new be(L.paint_line["line-translate-anchor"]),"line-width":new ye(L.paint_line["line-width"]),"line-gap-width":new ye(L.paint_line["line-gap-width"]),"line-offset":new ye(L.paint_line["line-offset"]),"line-blur":new ye(L.paint_line["line-blur"]),"line-dasharray":new li(L.paint_line["line-dasharray"]),"line-pattern":new Ks(L.paint_line["line-pattern"]),"line-gradient":new ko(L.paint_line["line-gradient"])}),layout:kh},Bc=new(function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.possiblyEvaluate=function(r,a){return a=new or(Math.floor(a.zoom),{now:a.now,fadeDuration:a.fadeDuration,zoomHistory:a.zoomHistory,transition:a.transition}),t.prototype.possiblyEvaluate.call(this,r,a)},e.prototype.evaluate=function(r,a,u,c){return a=hr({},a,{zoom:Math.floor(a.zoom)}),t.prototype.evaluate.call(this,r,a,u,c)},e}(ye))(Rc.paint.properties["line-width"].specification);Bc.useIntegerZoom=!0;var Mh=function(t){function e(r){t.call(this,r,Rc),this.gradientVersion=0}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._handleSpecialPaintPropertyUpdate=function(r){r==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Qn,this.gradientVersion=(this.gradientVersion+1)%On)},e.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},e.prototype.recalculate=function(r,a){t.prototype.recalculate.call(this,r,a),this.paint._values["line-floorwidth"]=Bc.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)},e.prototype.createBucket=function(r){return new Ii(r)},e.prototype.queryRadius=function(r){var a=r,u=Fc(Go("line-width",this,a),Go("line-gap-width",this,a)),c=Go("line-offset",this,a);return u/2+Math.abs(c)+zn(this.paint.get("line-translate"))},e.prototype.queryIntersectsFeature=function(r,a,u,c,f,y,x){var w=$o(r,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),y.angle,x),I=x/2*Fc(this.paint.get("line-width").evaluate(a,u),this.paint.get("line-gap-width").evaluate(a,u)),A=this.paint.get("line-offset").evaluate(a,u);return A&&(c=function(z,O){for(var Z=[],X=new Oe(0,0),rt=0;rt<z.length;rt++){for(var Y=z[rt],ct=[],vt=0;vt<Y.length;vt++){var xt=Y[vt],Tt=Y[vt+1],Mt=vt===0?X:xt.sub(Y[vt-1])._unit()._perp(),Ut=vt===Y.length-1?X:Tt.sub(xt)._unit()._perp(),Jt=Mt._add(Ut)._unit();Jt._mult(1/(Jt.x*Ut.x+Jt.y*Ut.y)),ct.push(Jt._mult(O)._add(xt))}Z.push(ct)}return Z}(c,A*x)),function(z,O,Z){for(var X=0;X<O.length;X++){var rt=O[X];if(z.length>=3){for(var Y=0;Y<rt.length;Y++)if(Zo(z,rt[Y]))return!0}if(uo(z,rt,Z))return!0}return!1}(w,c,I)},e.prototype.isTileClipped=function(){return!0},e}(jo);function Fc(t,e){return e>0?e+2*t:t}var zh=Nn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Dh=Nn([{name:"a_projected_pos",components:3,type:"Float32"}],4),Lh=(Nn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Nn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Nc=(Nn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),Nn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Oh=Nn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Rh(t,e,r){return t.sections.forEach(function(a){a.text=function(u,c,f){var y=c.layout.get("text-transform").evaluate(f,{});return y==="uppercase"?u=u.toLocaleUpperCase():y==="lowercase"&&(u=u.toLocaleLowerCase()),Hi.applyArabicShaping&&(u=Hi.applyArabicShaping(u)),u}(a.text,e,r)}),t}Nn([{name:"triangle",components:3,type:"Uint16"}]),Nn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Nn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Nn([{type:"Float32",name:"offsetX"}]),Nn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var qu={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""},Uc=function(t,e,r,a,u){var c,f,y=8*u-a-1,x=(1<<y)-1,w=x>>1,I=-7,A=r?u-1:0,z=r?-1:1,O=t[e+A];for(A+=z,c=O&(1<<-I)-1,O>>=-I,I+=y;I>0;c=256*c+t[e+A],A+=z,I-=8);for(f=c&(1<<-I)-1,c>>=-I,I+=a;I>0;f=256*f+t[e+A],A+=z,I-=8);if(c===0)c=1-w;else{if(c===x)return f?NaN:1/0*(O?-1:1);f+=Math.pow(2,a),c-=w}return(O?-1:1)*f*Math.pow(2,c-a)},Vc=function(t,e,r,a,u,c){var f,y,x,w=8*c-u-1,I=(1<<w)-1,A=I>>1,z=u===23?Math.pow(2,-24)-Math.pow(2,-77):0,O=a?0:c-1,Z=a?1:-1,X=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(y=isNaN(e)?1:0,f=I):(f=Math.floor(Math.log(e)/Math.LN2),e*(x=Math.pow(2,-f))<1&&(f--,x*=2),(e+=f+A>=1?z/x:z*Math.pow(2,1-A))*x>=2&&(f++,x/=2),f+A>=I?(y=0,f=I):f+A>=1?(y=(e*x-1)*Math.pow(2,u),f+=A):(y=e*Math.pow(2,A-1)*Math.pow(2,u),f=0));u>=8;t[r+O]=255&y,O+=Z,y/=256,u-=8);for(f=f<<u|y,w+=u;w>0;t[r+O]=255&f,O+=Z,f/=256,w-=8);t[r+O-Z]|=128*X},ml=Rr;function Rr(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Rr.Varint=0,Rr.Fixed64=1,Rr.Bytes=2,Rr.Fixed32=5;var jc=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Ba(t){return t.type===Rr.Bytes?t.readVarint()+t.pos:t.pos+1}function ru(t,e,r){return r?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function qc(t,e,r){var a=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(a);for(var u=r.pos-1;u>=t;u--)r.buf[u+a]=r.buf[u]}function Bh(t,e){for(var r=0;r<t.length;r++)e.writeVarint(t[r])}function Fh(t,e){for(var r=0;r<t.length;r++)e.writeSVarint(t[r])}function Nh(t,e){for(var r=0;r<t.length;r++)e.writeFloat(t[r])}function Uh(t,e){for(var r=0;r<t.length;r++)e.writeDouble(t[r])}function Vh(t,e){for(var r=0;r<t.length;r++)e.writeBoolean(t[r])}function jh(t,e){for(var r=0;r<t.length;r++)e.writeFixed32(t[r])}function qh(t,e){for(var r=0;r<t.length;r++)e.writeSFixed32(t[r])}function Zh(t,e){for(var r=0;r<t.length;r++)e.writeFixed64(t[r])}function Gh(t,e){for(var r=0;r<t.length;r++)e.writeSFixed64(t[r])}function yl(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function nu(t,e,r){t[r]=e,t[r+1]=e>>>8,t[r+2]=e>>>16,t[r+3]=e>>>24}function Zc(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function Kh(t,e,r){t===1&&r.readMessage(Xh,e)}function Xh(t,e,r){if(t===3){var a=r.readMessage(Wh,{}),u=a.width,c=a.height,f=a.left,y=a.top,x=a.advance;e.push({id:a.id,bitmap:new Cs({width:u+6,height:c+6},a.bitmap),metrics:{width:u,height:c,left:f,top:y,advance:x}})}}function Wh(t,e,r){t===1?e.id=r.readVarint():t===2?e.bitmap=r.readBytes():t===3?e.width=r.readVarint():t===4?e.height=r.readVarint():t===5?e.left=r.readSVarint():t===6?e.top=r.readSVarint():t===7&&(e.advance=r.readVarint())}function Gc(t){for(var e=0,r=0,a=0,u=t;a<u.length;a+=1){var c=u[a];e+=c.w*c.h,r=Math.max(r,c.w)}t.sort(function(X,rt){return rt.h-X.h});for(var f=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}],y=0,x=0,w=0,I=t;w<I.length;w+=1)for(var A=I[w],z=f.length-1;z>=0;z--){var O=f[z];if(!(A.w>O.w||A.h>O.h)){if(A.x=O.x,A.y=O.y,x=Math.max(x,A.y+A.h),y=Math.max(y,A.x+A.w),A.w===O.w&&A.h===O.h){var Z=f.pop();z<f.length&&(f[z]=Z)}else A.h===O.h?(O.x+=A.w,O.w-=A.w):A.w===O.w?(O.y+=A.h,O.h-=A.h):(f.push({x:O.x+A.w,y:O.y,w:O.w-A.w,h:A.h}),O.y+=A.h,O.h-=A.h);break}}return{w:y,h:x,fill:e/(y*x)||0}}Rr.prototype={destroy:function(){this.buf=null},readFields:function(t,e,r){for(r=r||this.length;this.pos<r;){var a=this.readVarint(),u=a>>3,c=this.pos;this.type=7&a,t(u,e,this),this.pos===c&&this.skip(a)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=yl(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Zc(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=yl(this.buf,this.pos)+4294967296*yl(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=yl(this.buf,this.pos)+4294967296*Zc(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=Uc(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Uc(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,r,a=this.buf;return e=127&(r=a[this.pos++]),r<128?e:(e|=(127&(r=a[this.pos++]))<<7,r<128?e:(e|=(127&(r=a[this.pos++]))<<14,r<128?e:(e|=(127&(r=a[this.pos++]))<<21,r<128?e:function(u,c,f){var y,x,w=f.buf;if(y=(112&(x=w[f.pos++]))>>4,x<128||(y|=(127&(x=w[f.pos++]))<<3,x<128)||(y|=(127&(x=w[f.pos++]))<<10,x<128)||(y|=(127&(x=w[f.pos++]))<<17,x<128)||(y|=(127&(x=w[f.pos++]))<<24,x<128)||(y|=(1&(x=w[f.pos++]))<<31,x<128))return ru(u,y,c);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=a[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&jc?function(r,a,u){return jc.decode(r.subarray(a,u))}(this.buf,e,t):function(r,a,u){for(var c="",f=a;f<u;){var y,x,w,I=r[f],A=null,z=I>239?4:I>223?3:I>191?2:1;if(f+z>u)break;z===1?I<128&&(A=I):z===2?(192&(y=r[f+1]))==128&&(A=(31&I)<<6|63&y)<=127&&(A=null):z===3?(x=r[f+2],(192&(y=r[f+1]))==128&&(192&x)==128&&((A=(15&I)<<12|(63&y)<<6|63&x)<=2047||A>=55296&&A<=57343)&&(A=null)):z===4&&(x=r[f+2],w=r[f+3],(192&(y=r[f+1]))==128&&(192&x)==128&&(192&w)==128&&((A=(15&I)<<18|(63&y)<<12|(63&x)<<6|63&w)<=65535||A>=1114112)&&(A=null)),A===null?(A=65533,z=1):A>65535&&(A-=65536,c+=String.fromCharCode(A>>>10&1023|55296),A=56320|1023&A),c+=String.fromCharCode(A),f+=z}return c}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==Rr.Bytes)return t.push(this.readVarint(e));var r=Ba(this);for(t=t||[];this.pos<r;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==Rr.Bytes)return t.push(this.readSVarint());var e=Ba(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Rr.Bytes)return t.push(this.readBoolean());var e=Ba(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Rr.Bytes)return t.push(this.readFloat());var e=Ba(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Rr.Bytes)return t.push(this.readDouble());var e=Ba(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Rr.Bytes)return t.push(this.readFixed32());var e=Ba(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Rr.Bytes)return t.push(this.readSFixed32());var e=Ba(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Rr.Bytes)return t.push(this.readFixed64());var e=Ba(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Rr.Bytes)return t.push(this.readSFixed64());var e=Ba(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Rr.Varint)for(;this.buf[this.pos++]>127;);else if(e===Rr.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Rr.Fixed32)this.pos+=4;else{if(e!==Rr.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),nu(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),nu(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),nu(this.buf,-1&t,this.pos),nu(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),nu(this.buf,-1&t,this.pos),nu(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,r){var a,u;if(e>=0?(a=e%4294967296|0,u=e/4294967296|0):(u=~(-e/4294967296),4294967295^(a=~(-e%4294967296))?a=a+1|0:(a=0,u=u+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(c,f,y){y.buf[y.pos++]=127&c|128,c>>>=7,y.buf[y.pos++]=127&c|128,c>>>=7,y.buf[y.pos++]=127&c|128,c>>>=7,y.buf[y.pos++]=127&c|128,y.buf[y.pos]=127&(c>>>=7)}(a,0,r),function(c,f){var y=(7&c)<<4;f.buf[f.pos++]|=y|((c>>>=3)?128:0),c&&(f.buf[f.pos++]=127&c|((c>>>=7)?128:0),c&&(f.buf[f.pos++]=127&c|((c>>>=7)?128:0),c&&(f.buf[f.pos++]=127&c|((c>>>=7)?128:0),c&&(f.buf[f.pos++]=127&c|((c>>>=7)?128:0),c&&(f.buf[f.pos++]=127&c)))))}(u,r)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(a,u,c){for(var f,y,x=0;x<u.length;x++){if((f=u.charCodeAt(x))>55295&&f<57344){if(!y){f>56319||x+1===u.length?(a[c++]=239,a[c++]=191,a[c++]=189):y=f;continue}if(f<56320){a[c++]=239,a[c++]=191,a[c++]=189,y=f;continue}f=y-55296<<10|f-56320|65536,y=null}else y&&(a[c++]=239,a[c++]=191,a[c++]=189,y=null);f<128?a[c++]=f:(f<2048?a[c++]=f>>6|192:(f<65536?a[c++]=f>>12|224:(a[c++]=f>>18|240,a[c++]=f>>12&63|128),a[c++]=f>>6&63|128),a[c++]=63&f|128)}return c}(this.buf,t,this.pos);var r=this.pos-e;r>=128&&qc(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(t){this.realloc(4),Vc(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Vc(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=t[r]},writeRawMessage:function(t,e){this.pos++;var r=this.pos;t(e,this);var a=this.pos-r;a>=128&&qc(r,a,this),this.pos=r-1,this.writeVarint(a),this.pos+=a},writeMessage:function(t,e,r){this.writeTag(t,Rr.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,Bh,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,Fh,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,Vh,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,Nh,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,Uh,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,jh,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,qh,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,Zh,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,Gh,e)},writeBytesField:function(t,e){this.writeTag(t,Rr.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Rr.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Rr.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Rr.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Rr.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Rr.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Rr.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Rr.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Rr.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Rr.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};var gl=function(t,e){var r=e.pixelRatio,a=e.version,u=e.stretchX,c=e.stretchY,f=e.content;this.paddedRect=t,this.pixelRatio=r,this.stretchX=u,this.stretchY=c,this.content=f,this.version=a},Zu={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};Zu.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},Zu.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},Zu.tlbr.get=function(){return this.tl.concat(this.br)},Zu.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(gl.prototype,Zu);var Gu=function(t,e){var r={},a={};this.haveRenderCallbacks=[];var u=[];this.addImages(t,r,u),this.addImages(e,a,u);var c=Gc(u),f=new Zi({width:c.w||1,height:c.h||1});for(var y in t){var x=t[y],w=r[y].paddedRect;Zi.copy(x.data,f,{x:0,y:0},{x:w.x+1,y:w.y+1},x.data)}for(var I in e){var A=e[I],z=a[I].paddedRect,O=z.x+1,Z=z.y+1,X=A.data.width,rt=A.data.height;Zi.copy(A.data,f,{x:0,y:0},{x:O,y:Z},A.data),Zi.copy(A.data,f,{x:0,y:rt-1},{x:O,y:Z-1},{width:X,height:1}),Zi.copy(A.data,f,{x:0,y:0},{x:O,y:Z+rt},{width:X,height:1}),Zi.copy(A.data,f,{x:X-1,y:0},{x:O-1,y:Z},{width:1,height:rt}),Zi.copy(A.data,f,{x:0,y:0},{x:O+X,y:Z},{width:1,height:rt})}this.image=f,this.iconPositions=r,this.patternPositions=a};Gu.prototype.addImages=function(t,e,r){for(var a in t){var u=t[a],c={x:0,y:0,w:u.data.width+2,h:u.data.height+2};r.push(c),e[a]=new gl(c,u),u.hasRenderCallback&&this.haveRenderCallbacks.push(a)}},Gu.prototype.patchUpdatedImages=function(t,e){for(var r in t.dispatchRenderCallbacks(this.haveRenderCallbacks),t.updatedImages)this.patchUpdatedImage(this.iconPositions[r],t.getImage(r),e),this.patchUpdatedImage(this.patternPositions[r],t.getImage(r),e)},Gu.prototype.patchUpdatedImage=function(t,e,r){if(t&&e&&t.version!==e.version){t.version=e.version;var a=t.tl;r.update(e.data,void 0,{x:a[0],y:a[1]})}},Qt("ImagePosition",gl),Qt("ImageAtlas",Gu);var lo={horizontal:1,vertical:2,horizontalOnly:3},iu=function(){this.scale=1,this.fontStack="",this.imageName=null};iu.forText=function(t,e){var r=new iu;return r.scale=t||1,r.fontStack=e,r},iu.forImage=function(t){var e=new iu;return e.imageName=t,e};var pi=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function vl(t,e,r,a,u,c,f,y,x,w,I,A,z,O,Z,X){var rt,Y=pi.fromFeature(t,u);A===lo.vertical&&Y.verticalizePunctuation();var ct=Hi.processBidirectionalText,vt=Hi.processStyledBidirectionalText;if(ct&&Y.sections.length===1){rt=[];for(var xt=0,Tt=ct(Y.toString(),tc(Y,w,c,e,a,O,Z));xt<Tt.length;xt+=1){var Mt=Tt[xt],Ut=new pi;Ut.text=Mt,Ut.sections=Y.sections;for(var Jt=0;Jt<Mt.length;Jt++)Ut.sectionIndex.push(0);rt.push(Ut)}}else if(vt){rt=[];for(var _e=0,ue=vt(Y.text,Y.sectionIndex,tc(Y,w,c,e,a,O,Z));_e<ue.length;_e+=1){var Ee=ue[_e],le=new pi;le.text=Ee[0],le.sectionIndex=Ee[1],le.sections=Y.sections,rt.push(le)}}else rt=function(ge,nr){for(var Ge=[],pr=ge.text,Se=0,gr=0,jr=nr;gr<jr.length;gr+=1){var tn=jr[gr];Ge.push(ge.substring(Se,tn)),Se=tn}return Se<pr.length&&Ge.push(ge.substring(Se,pr.length)),Ge}(Y,tc(Y,w,c,e,a,O,Z));var Qe=[],ke={positionedLines:Qe,text:Y.toString(),top:I[1],bottom:I[1],left:I[0],right:I[0],writingMode:A,iconsInText:!1,verticalizable:!1};return function(ge,nr,Ge,pr,Se,gr,jr,tn,Xr,qr,en,Dn){for(var Ln=0,hi=-17,jn=0,fi=0,un=tn==="right"?1:tn==="left"?0:.5,qn=0,ar=0,Pr=Se;ar<Pr.length;ar+=1){var Sr=Pr[ar];Sr.trim();var dr=Sr.getMaxScale(),Ci=24*(dr-1),ei={positionedGlyphs:[],lineOffset:0};ge.positionedLines[qn]=ei;var Nr=ei.positionedGlyphs,yn=0;if(Sr.length()){for(var ri=0;ri<Sr.length();ri++){var vr=Sr.getSection(ri),ga=Sr.getSectionIndex(ri),co=Sr.getCharCode(ri),va=0,ln=null,_a=null,Ko=null,hu=24,Ms=!(Xr===lo.horizontal||!en&&!qs(co)||en&&(_l[co]||(Va=co,Ht.Arabic(Va)||Ht["Arabic Supplement"](Va)||Ht["Arabic Extended-A"](Va)||Ht["Arabic Presentation Forms-A"](Va)||Ht["Arabic Presentation Forms-B"](Va))));if(vr.imageName){var fu=pr[vr.imageName];if(!fu)continue;Ko=vr.imageName,ge.iconsInText=ge.iconsInText||!0,_a=fu.paddedRect;var Ua=fu.displaySize;vr.scale=24*vr.scale/Dn,va=Ci+(24-Ua[1]*vr.scale),hu=(ln={width:Ua[0],height:Ua[1],left:1,top:-3,advance:Ms?Ua[1]:Ua[0]}).advance;var du=Ms?Ua[0]*vr.scale-24*dr:Ua[1]*vr.scale-24*dr;du>0&&du>yn&&(yn=du)}else{var Al=Ge[vr.fontStack],mu=Al&&Al[co];if(mu&&mu.rect)_a=mu.rect,ln=mu.metrics;else{var Wu=nr[vr.fontStack],Pl=Wu&&Wu[co];if(!Pl)continue;ln=Pl.metrics}va=24*(dr-vr.scale)}Ms?(ge.verticalizable=!0,Nr.push({glyph:co,imageName:Ko,x:Ln,y:hi+va,vertical:Ms,scale:vr.scale,fontStack:vr.fontStack,sectionIndex:ga,metrics:ln,rect:_a}),Ln+=hu*vr.scale+qr):(Nr.push({glyph:co,imageName:Ko,x:Ln,y:hi+va,vertical:Ms,scale:vr.scale,fontStack:vr.fontStack,sectionIndex:ga,metrics:ln,rect:_a}),Ln+=ln.advance*vr.scale+qr)}Nr.length!==0&&(jn=Math.max(Ln-qr,jn),Jh(Nr,0,Nr.length-1,un,yn)),Ln=0;var kl=gr*dr+yn;ei.lineOffset=Math.max(yn,Ci),hi+=kl,fi=Math.max(kl,fi),++qn}else hi+=gr,++qn}var Va,Hu=hi- -17,yu=ec(jr),ss=yu.horizontalAlign,gu=yu.verticalAlign;(function(Ml,zl,Ju,Yu,Dl,$u,Qu,tl,Ll){var vu,Ol=(zl-Ju)*Dl;vu=$u!==Qu?-tl*Yu- -17:(-Yu*Ll+.5)*Qu;for(var _u=0,el=Ml;_u<el.length;_u+=1)for(var zs=0,rl=el[_u].positionedGlyphs;zs<rl.length;zs+=1){var xu=rl[zs];xu.x+=Ol,xu.y+=vu}})(ge.positionedLines,un,ss,gu,jn,fi,gr,Hu,Se.length),ge.top+=-gu*Hu,ge.bottom=ge.top+Hu,ge.left+=-ss*jn,ge.right=ge.left+jn}(ke,e,r,a,rt,f,y,x,A,w,z,X),!function(ge){for(var nr=0,Ge=ge;nr<Ge.length;nr+=1)if(Ge[nr].positionedGlyphs.length!==0)return!1;return!0}(Qe)&&ke}pi.fromFeature=function(t,e){for(var r=new pi,a=0;a<t.sections.length;a++){var u=t.sections[a];u.image?r.addImageSection(u):r.addTextSection(u,e)}return r},pi.prototype.length=function(){return this.text.length},pi.prototype.getSection=function(t){return this.sections[this.sectionIndex[t]]},pi.prototype.getSectionIndex=function(t){return this.sectionIndex[t]},pi.prototype.getCharCode=function(t){return this.text.charCodeAt(t)},pi.prototype.verticalizePunctuation=function(){this.text=function(t){for(var e="",r=0;r<t.length;r++){var a=t.charCodeAt(r+1)||null,u=t.charCodeAt(r-1)||null;e+=a&&Au(a)&&!qu[t[r+1]]||u&&Au(u)&&!qu[t[r-1]]||!qu[t[r]]?t[r]:qu[t[r]]}return e}(this.text)},pi.prototype.trim=function(){for(var t=0,e=0;e<this.text.length&&_l[this.text.charCodeAt(e)];e++)t++;for(var r=this.text.length,a=this.text.length-1;a>=0&&a>=t&&_l[this.text.charCodeAt(a)];a--)r--;this.text=this.text.substring(t,r),this.sectionIndex=this.sectionIndex.slice(t,r)},pi.prototype.substring=function(t,e){var r=new pi;return r.text=this.text.substring(t,e),r.sectionIndex=this.sectionIndex.slice(t,e),r.sections=this.sections,r},pi.prototype.toString=function(){return this.text},pi.prototype.getMaxScale=function(){var t=this;return this.sectionIndex.reduce(function(e,r){return Math.max(e,t.sections[r].scale)},0)},pi.prototype.addTextSection=function(t,e){this.text+=t.text,this.sections.push(iu.forText(t.scale,t.fontStack||e));for(var r=this.sections.length-1,a=0;a<t.text.length;++a)this.sectionIndex.push(r)},pi.prototype.addImageSection=function(t){var e=t.image?t.image.name:"";if(e.length!==0){var r=this.getNextImageSectionCharCode();r?(this.text+=String.fromCharCode(r),this.sections.push(iu.forImage(e)),this.sectionIndex.push(this.sections.length-1)):wr("Reached maximum number of images 6401")}else wr("Can't add FormattedSection with an empty image.")},pi.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var _l={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Yi={};function Kc(t,e,r,a,u,c){if(e.imageName){var f=a[e.imageName];return f?f.displaySize[0]*e.scale*24/c+u:0}var y=r[e.fontStack],x=y&&y[t];return x?x.metrics.advance*e.scale+u:0}function Xc(t,e,r,a){var u=Math.pow(t-e,2);return a?t<e?u/2:2*u:u+Math.abs(r)*r}function Hh(t,e,r){var a=0;return t===10&&(a-=1e4),r&&(a+=150),t!==40&&t!==65288||(a+=50),e!==41&&e!==65289||(a+=50),a}function Wc(t,e,r,a,u,c){for(var f=null,y=Xc(e,r,u,c),x=0,w=a;x<w.length;x+=1){var I=w[x],A=Xc(e-I.x,r,u,c)+I.badness;A<=y&&(f=I,y=A)}return{index:t,x:e,priorBreak:f,badness:y}}function tc(t,e,r,a,u,c,f){if(c!=="point")return[];if(!t)return[];for(var y,x=[],w=function(rt,Y,ct,vt,xt,Tt){for(var Mt=0,Ut=0;Ut<rt.length();Ut++){var Jt=rt.getSection(Ut);Mt+=Kc(rt.getCharCode(Ut),Jt,vt,xt,Y,Tt)}return Mt/Math.max(1,Math.ceil(Mt/ct))}(t,e,r,a,u,f),I=t.text.indexOf("")>=0,A=0,z=0;z<t.length();z++){var O=t.getSection(z),Z=t.getCharCode(z);if(_l[Z]||(A+=Kc(Z,O,a,u,e,f)),z<t.length()-1){var X=!((y=Z)<11904||!(Ht["Bopomofo Extended"](y)||Ht.Bopomofo(y)||Ht["CJK Compatibility Forms"](y)||Ht["CJK Compatibility Ideographs"](y)||Ht["CJK Compatibility"](y)||Ht["CJK Radicals Supplement"](y)||Ht["CJK Strokes"](y)||Ht["CJK Symbols and Punctuation"](y)||Ht["CJK Unified Ideographs Extension A"](y)||Ht["CJK Unified Ideographs"](y)||Ht["Enclosed CJK Letters and Months"](y)||Ht["Halfwidth and Fullwidth Forms"](y)||Ht.Hiragana(y)||Ht["Ideographic Description Characters"](y)||Ht["Kangxi Radicals"](y)||Ht["Katakana Phonetic Extensions"](y)||Ht.Katakana(y)||Ht["Vertical Forms"](y)||Ht["Yi Radicals"](y)||Ht["Yi Syllables"](y)));(Yi[Z]||X||O.imageName)&&x.push(Wc(z+1,A,w,x,Hh(Z,t.getCharCode(z+1),X&&I),!1))}}return function rt(Y){return Y?rt(Y.priorBreak).concat(Y.index):[]}(Wc(t.length(),A,w,x,0,!0))}function ec(t){var e=.5,r=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function Jh(t,e,r,a,u){if(a||u)for(var c=t[r],f=(t[r].x+c.metrics.advance*c.scale)*a,y=e;y<=r;y++)t[y].x-=f,t[y].y+=u}function Hc(t,e,r,a,u,c){var f,y=t.image;if(y.content){var x=y.content,w=y.pixelRatio||1;f=[x[0]/w,x[1]/w,y.displaySize[0]-x[2]/w,y.displaySize[1]-x[3]/w]}var I,A,z,O,Z=e.left*c,X=e.right*c;r==="width"||r==="both"?(O=u[0]+Z-a[3],A=u[0]+X+a[1]):A=(O=u[0]+(Z+X-y.displaySize[0])/2)+y.displaySize[0];var rt=e.top*c,Y=e.bottom*c;return r==="height"||r==="both"?(I=u[1]+rt-a[0],z=u[1]+Y+a[2]):z=(I=u[1]+(rt+Y-y.displaySize[1])/2)+y.displaySize[1],{image:y,top:I,right:A,bottom:z,left:O,collisionPadding:f}}Yi[10]=!0,Yi[32]=!0,Yi[38]=!0,Yi[40]=!0,Yi[41]=!0,Yi[43]=!0,Yi[45]=!0,Yi[47]=!0,Yi[173]=!0,Yi[183]=!0,Yi[8203]=!0,Yi[8208]=!0,Yi[8211]=!0,Yi[8231]=!0;var ou=function(t){function e(r,a,u,c){t.call(this,r,a),this.angle=u,c!==void 0&&(this.segment=c)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.clone=function(){return new e(this.x,this.y,this.angle,this.segment)},e}(Oe);function rc(t,e){var r=e.expression;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new or(t+1))};if(r.kind==="source")return{kind:"source"};for(var a=r.zoomStops,u=r.interpolationType,c=0;c<a.length&&a[c]<=t;)c++;for(var f=c=Math.max(0,c-1);f<a.length&&a[f]<t+1;)f++;f=Math.min(a.length-1,f);var y=a[c],x=a[f];return r.kind==="composite"?{kind:"composite",minZoom:y,maxZoom:x,interpolationType:u}:{kind:"camera",minZoom:y,maxZoom:x,minSize:r.evaluate(new or(y)),maxSize:r.evaluate(new or(x)),interpolationType:u}}function Jc(t,e,r){var a=e.uSize,u=r.lowerSize;return t.kind==="source"?u/128:t.kind==="composite"?Hr(u/128,r.upperSize/128,e.uSizeT):a}function Yc(t,e){var r=0,a=0;if(t.kind==="constant")a=t.layoutSize;else if(t.kind!=="source"){var u=t.interpolationType,c=u?ve(on.interpolationFactor(u,e,t.minZoom,t.maxZoom),0,1):0;t.kind==="camera"?a=Hr(t.minSize,t.maxSize,c):r=c}return{uSizeT:r,uSize:a}}Qt("Anchor",ou);var Yh=Object.freeze({__proto__:null,getSizeData:rc,evaluateSizeForFeature:Jc,evaluateSizeForZoom:Yc,SIZE_PACK_FACTOR:128});function $c(t,e,r,a,u){if(e.segment===void 0)return!0;for(var c=e,f=e.segment+1,y=0;y>-r/2;){if(--f<0)return!1;y-=t[f].dist(c),c=t[f]}y+=t[f].dist(t[f+1]),f++;for(var x=[],w=0;y<r/2;){var I=t[f],A=t[f+1];if(!A)return!1;var z=t[f-1].angleTo(I)-I.angleTo(A);for(z=Math.abs((z+3*Math.PI)%(2*Math.PI)-Math.PI),x.push({distance:y,angleDelta:z}),w+=z;y-x[0].distance>a;)w-=x.shift().angleDelta;if(w>u)return!1;f++,y+=I.dist(A)}return!0}function Qc(t){for(var e=0,r=0;r<t.length-1;r++)e+=t[r].dist(t[r+1]);return e}function tp(t,e,r){return t?.6*e*r:0}function ep(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function $h(t,e,r,a,u,c){for(var f=tp(r,u,c),y=ep(r,a)*c,x=0,w=Qc(t)/2,I=0;I<t.length-1;I++){var A=t[I],z=t[I+1],O=A.dist(z);if(x+O>w){var Z=(w-x)/O,X=Hr(A.x,z.x,Z),rt=Hr(A.y,z.y,Z),Y=new ou(X,rt,z.angleTo(A),I);return Y._round(),!f||$c(t,Y,y,f,e)?Y:void 0}x+=O}}function Qh(t,e,r,a,u,c,f,y,x){var w=tp(a,c,f),I=ep(a,u),A=I*f,z=t[0].x===0||t[0].x===x||t[0].y===0||t[0].y===x;return e-A<e/4&&(e=A+e/4),function O(Z,X,rt,Y,ct,vt,xt,Tt,Mt){for(var Ut=vt/2,Jt=Qc(Z),_e=0,ue=X-rt,Ee=[],le=0;le<Z.length-1;le++){for(var Qe=Z[le],ke=Z[le+1],ge=Qe.dist(ke),nr=ke.angleTo(Qe);ue+rt<_e+ge;){var Ge=((ue+=rt)-_e)/ge,pr=Hr(Qe.x,ke.x,Ge),Se=Hr(Qe.y,ke.y,Ge);if(pr>=0&&pr<Mt&&Se>=0&&Se<Mt&&ue-Ut>=0&&ue+Ut<=Jt){var gr=new ou(pr,Se,nr,le);gr._round(),Y&&!$c(Z,gr,vt,Y,ct)||Ee.push(gr)}}_e+=ge}return Tt||Ee.length||xt||(Ee=O(Z,_e/2,rt,Y,ct,vt,xt,!0,Mt)),Ee}(t,z?e/2*y%e:(I/2+2*c)*f*y%e,e,w,r,A,z,!1,x)}function rp(t,e,r,a,u){for(var c=[],f=0;f<t.length;f++)for(var y=t[f],x=void 0,w=0;w<y.length-1;w++){var I=y[w],A=y[w+1];I.x<e&&A.x<e||(I.x<e?I=new Oe(e,I.y+(e-I.x)/(A.x-I.x)*(A.y-I.y))._round():A.x<e&&(A=new Oe(e,I.y+(e-I.x)/(A.x-I.x)*(A.y-I.y))._round()),I.y<r&&A.y<r||(I.y<r?I=new Oe(I.x+(r-I.y)/(A.y-I.y)*(A.x-I.x),r)._round():A.y<r&&(A=new Oe(I.x+(r-I.y)/(A.y-I.y)*(A.x-I.x),r)._round()),I.x>=a&&A.x>=a||(I.x>=a?I=new Oe(a,I.y+(a-I.x)/(A.x-I.x)*(A.y-I.y))._round():A.x>=a&&(A=new Oe(a,I.y+(a-I.x)/(A.x-I.x)*(A.y-I.y))._round()),I.y>=u&&A.y>=u||(I.y>=u?I=new Oe(I.x+(u-I.y)/(A.y-I.y)*(A.x-I.x),u)._round():A.y>=u&&(A=new Oe(I.x+(u-I.y)/(A.y-I.y)*(A.x-I.x),u)._round()),x&&I.equals(x[x.length-1])||c.push(x=[I]),x.push(A)))))}return c}function np(t,e,r,a){var u=[],c=t.image,f=c.pixelRatio,y=c.paddedRect.w-2,x=c.paddedRect.h-2,w=t.right-t.left,I=t.bottom-t.top,A=c.stretchX||[[0,y]],z=c.stretchY||[[0,x]],O=function(pr,Se){return pr+Se[1]-Se[0]},Z=A.reduce(O,0),X=z.reduce(O,0),rt=y-Z,Y=x-X,ct=0,vt=Z,xt=0,Tt=X,Mt=0,Ut=rt,Jt=0,_e=Y;if(c.content&&a){var ue=c.content;ct=xl(A,0,ue[0]),xt=xl(z,0,ue[1]),vt=xl(A,ue[0],ue[2]),Tt=xl(z,ue[1],ue[3]),Mt=ue[0]-ct,Jt=ue[1]-xt,Ut=ue[2]-ue[0]-vt,_e=ue[3]-ue[1]-Tt}var Ee=function(pr,Se,gr,jr){var tn=bl(pr.stretch-ct,vt,w,t.left),Xr=wl(pr.fixed-Mt,Ut,pr.stretch,Z),qr=bl(Se.stretch-xt,Tt,I,t.top),en=wl(Se.fixed-Jt,_e,Se.stretch,X),Dn=bl(gr.stretch-ct,vt,w,t.left),Ln=wl(gr.fixed-Mt,Ut,gr.stretch,Z),hi=bl(jr.stretch-xt,Tt,I,t.top),jn=wl(jr.fixed-Jt,_e,jr.stretch,X),fi=new Oe(tn,qr),un=new Oe(Dn,qr),qn=new Oe(Dn,hi),ar=new Oe(tn,hi),Pr=new Oe(Xr/f,en/f),Sr=new Oe(Ln/f,jn/f),dr=e*Math.PI/180;if(dr){var Ci=Math.sin(dr),ei=Math.cos(dr),Nr=[ei,-Ci,Ci,ei];fi._matMult(Nr),un._matMult(Nr),ar._matMult(Nr),qn._matMult(Nr)}var yn=pr.stretch+pr.fixed,ri=Se.stretch+Se.fixed;return{tl:fi,tr:un,bl:ar,br:qn,tex:{x:c.paddedRect.x+1+yn,y:c.paddedRect.y+1+ri,w:gr.stretch+gr.fixed-yn,h:jr.stretch+jr.fixed-ri},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Pr,pixelOffsetBR:Sr,minFontScaleX:Ut/f/w,minFontScaleY:_e/f/I,isSDF:r}};if(a&&(c.stretchX||c.stretchY))for(var le=ip(A,rt,Z),Qe=ip(z,Y,X),ke=0;ke<le.length-1;ke++)for(var ge=le[ke],nr=le[ke+1],Ge=0;Ge<Qe.length-1;Ge++)u.push(Ee(ge,Qe[Ge],nr,Qe[Ge+1]));else u.push(Ee({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:x+1}));return u}function xl(t,e,r){for(var a=0,u=0,c=t;u<c.length;u+=1){var f=c[u];a+=Math.max(e,Math.min(r,f[1]))-Math.max(e,Math.min(r,f[0]))}return a}function ip(t,e,r){for(var a=[{fixed:-1,stretch:0}],u=0,c=t;u<c.length;u+=1){var f=c[u],y=f[0],x=f[1],w=a[a.length-1];a.push({fixed:y-w.stretch,stretch:w.stretch}),a.push({fixed:y-w.stretch,stretch:w.stretch+(x-y)})}return a.push({fixed:e+1,stretch:r}),a}function bl(t,e,r,a){return t/e*r+a}function wl(t,e,r,a){return t-e*r/a}var El=function(t,e,r,a,u,c,f,y,x,w){if(this.boxStartIndex=t.length,x){var I=c.top,A=c.bottom,z=c.collisionPadding;z&&(I-=z[1],A+=z[3]);var O=A-I;O>0&&(O=Math.max(10,O),this.circleDiameter=O)}else{var Z=c.top*f-y,X=c.bottom*f+y,rt=c.left*f-y,Y=c.right*f+y,ct=c.collisionPadding;if(ct&&(rt-=ct[0]*f,Z-=ct[1]*f,Y+=ct[2]*f,X+=ct[3]*f),w){var vt=new Oe(rt,Z),xt=new Oe(Y,Z),Tt=new Oe(rt,X),Mt=new Oe(Y,X),Ut=w*Math.PI/180;vt._rotate(Ut),xt._rotate(Ut),Tt._rotate(Ut),Mt._rotate(Ut),rt=Math.min(vt.x,xt.x,Tt.x,Mt.x),Y=Math.max(vt.x,xt.x,Tt.x,Mt.x),Z=Math.min(vt.y,xt.y,Tt.y,Mt.y),X=Math.max(vt.y,xt.y,Tt.y,Mt.y)}t.emplaceBack(e.x,e.y,rt,Z,Y,X,r,a,u)}this.boxEndIndex=t.length},au=function(t,e){if(t===void 0&&(t=[]),e===void 0&&(e=tf),this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(var r=(this.length>>1)-1;r>=0;r--)this._down(r)};function tf(t,e){return t<e?-1:t>e?1:0}function ef(t,e,r){e===void 0&&(e=1),r===void 0&&(r=!1);for(var a=1/0,u=1/0,c=-1/0,f=-1/0,y=t[0],x=0;x<y.length;x++){var w=y[x];(!x||w.x<a)&&(a=w.x),(!x||w.y<u)&&(u=w.y),(!x||w.x>c)&&(c=w.x),(!x||w.y>f)&&(f=w.y)}var I=Math.min(c-a,f-u),A=I/2,z=new au([],rf);if(I===0)return new Oe(a,u);for(var O=a;O<c;O+=I)for(var Z=u;Z<f;Z+=I)z.push(new su(O+A,Z+A,A,t));for(var X=function(ct){for(var vt=0,xt=0,Tt=0,Mt=ct[0],Ut=0,Jt=Mt.length,_e=Jt-1;Ut<Jt;_e=Ut++){var ue=Mt[Ut],Ee=Mt[_e],le=ue.x*Ee.y-Ee.x*ue.y;xt+=(ue.x+Ee.x)*le,Tt+=(ue.y+Ee.y)*le,vt+=3*le}return new su(xt/vt,Tt/vt,0,ct)}(t),rt=z.length;z.length;){var Y=z.pop();(Y.d>X.d||!X.d)&&(X=Y,r&&console.log("found best %d after %d probes",Math.round(1e4*Y.d)/1e4,rt)),Y.max-X.d<=e||(z.push(new su(Y.p.x-(A=Y.h/2),Y.p.y-A,A,t)),z.push(new su(Y.p.x+A,Y.p.y-A,A,t)),z.push(new su(Y.p.x-A,Y.p.y+A,A,t)),z.push(new su(Y.p.x+A,Y.p.y+A,A,t)),rt+=4)}return r&&(console.log("num probes: "+rt),console.log("best distance: "+X.d)),X.p}function rf(t,e){return e.max-t.max}function su(t,e,r,a){this.p=new Oe(t,e),this.h=r,this.d=function(u,c){for(var f=!1,y=1/0,x=0;x<c.length;x++)for(var w=c[x],I=0,A=w.length,z=A-1;I<A;z=I++){var O=w[I],Z=w[z];O.y>u.y!=Z.y>u.y&&u.x<(Z.x-O.x)*(u.y-O.y)/(Z.y-O.y)+O.x&&(f=!f),y=Math.min(y,ns(u,O,Z))}return(f?1:-1)*Math.sqrt(y)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}au.prototype.push=function(t){this.data.push(t),this.length++,this._up(this.length-1)},au.prototype.pop=function(){if(this.length!==0){var t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}},au.prototype.peek=function(){return this.data[0]},au.prototype._up=function(t){for(var e=this.data,r=this.compare,a=e[t];t>0;){var u=t-1>>1,c=e[u];if(r(a,c)>=0)break;e[t]=c,t=u}e[t]=a},au.prototype._down=function(t){for(var e=this.data,r=this.compare,a=this.length>>1,u=e[t];t<a;){var c=1+(t<<1),f=e[c],y=c+1;if(y<this.length&&r(e[y],f)<0&&(c=y,f=e[y]),r(f,u)>=0)break;e[t]=f,t=c}e[t]=u};var nc=Number.POSITIVE_INFINITY;function op(t,e){return e[1]!==nc?function(r,a,u){var c=0,f=0;switch(a=Math.abs(a),u=Math.abs(u),r){case"top-right":case"top-left":case"top":f=u-7;break;case"bottom-right":case"bottom-left":case"bottom":f=7-u}switch(r){case"top-right":case"bottom-right":case"right":c=-a;break;case"top-left":case"bottom-left":case"left":c=a}return[c,f]}(t,e[0],e[1]):function(r,a){var u=0,c=0;a<0&&(a=0);var f=a/Math.sqrt(2);switch(r){case"top-right":case"top-left":c=f-7;break;case"bottom-right":case"bottom-left":c=7-f;break;case"bottom":c=7-a;break;case"top":c=a-7}switch(r){case"top-right":case"bottom-right":u=-f;break;case"top-left":case"bottom-left":u=f;break;case"left":u=a;break;case"right":u=-a}return[u,c]}(t,e[0])}function ic(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function ap(t,e,r,a,u,c,f,y,x,w,I,A,z,O,Z){var X=function(xt,Tt,Mt,Ut,Jt,_e,ue,Ee){for(var le=Ut.layout.get("text-rotate").evaluate(_e,{})*Math.PI/180,Qe=[],ke=0,ge=Tt.positionedLines;ke<ge.length;ke+=1)for(var nr=ge[ke],Ge=0,pr=nr.positionedGlyphs;Ge<pr.length;Ge+=1){var Se=pr[Ge];if(Se.rect){var gr=Se.rect||{},jr=4,tn=!0,Xr=1,qr=0,en=(Jt||Ee)&&Se.vertical,Dn=Se.metrics.advance*Se.scale/2;if(Ee&&Tt.verticalizable&&(qr=nr.lineOffset/2-(Se.imageName?-(24-Se.metrics.width*Se.scale)/2:24*(Se.scale-1))),Se.imageName){var Ln=ue[Se.imageName];tn=Ln.sdf,jr=1/(Xr=Ln.pixelRatio)}var hi=Jt?[Se.x+Dn,Se.y]:[0,0],jn=Jt?[0,0]:[Se.x+Dn+Mt[0],Se.y+Mt[1]-qr],fi=[0,0];en&&(fi=jn,jn=[0,0]);var un=(Se.metrics.left-jr)*Se.scale-Dn+jn[0],qn=(-Se.metrics.top-jr)*Se.scale+jn[1],ar=un+gr.w*Se.scale/Xr,Pr=qn+gr.h*Se.scale/Xr,Sr=new Oe(un,qn),dr=new Oe(ar,qn),Ci=new Oe(un,Pr),ei=new Oe(ar,Pr);if(en){var Nr=new Oe(-Dn,Dn- -17),yn=-Math.PI/2,ri=12-Dn,vr=new Oe(22-ri,-(Se.imageName?ri:0)),ga=new(Function.prototype.bind.apply(Oe,[null].concat(fi)));Sr._rotateAround(yn,Nr)._add(vr)._add(ga),dr._rotateAround(yn,Nr)._add(vr)._add(ga),Ci._rotateAround(yn,Nr)._add(vr)._add(ga),ei._rotateAround(yn,Nr)._add(vr)._add(ga)}if(le){var co=Math.sin(le),va=Math.cos(le),ln=[va,-co,co,va];Sr._matMult(ln),dr._matMult(ln),Ci._matMult(ln),ei._matMult(ln)}var _a=new Oe(0,0),Ko=new Oe(0,0);Qe.push({tl:Sr,tr:dr,bl:Ci,br:ei,tex:gr,writingMode:Tt.writingMode,glyphOffset:hi,sectionIndex:Se.sectionIndex,isSDF:tn,pixelOffsetTL:_a,pixelOffsetBR:Ko,minFontScaleX:0,minFontScaleY:0})}}return Qe}(0,r,y,u,c,f,a,t.allowVerticalPlacement),rt=t.textSizeData,Y=null;rt.kind==="source"?(Y=[128*u.layout.get("text-size").evaluate(f,{})])[0]>32640&&wr(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):rt.kind==="composite"&&((Y=[128*O.compositeTextSizes[0].evaluate(f,{},Z),128*O.compositeTextSizes[1].evaluate(f,{},Z)])[0]>32640||Y[1]>32640)&&wr(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),t.addSymbols(t.text,X,Y,y,c,f,w,e,x.lineStartIndex,x.lineLength,z,Z);for(var ct=0,vt=I;ct<vt.length;ct+=1)A[vt[ct]]=t.text.placedSymbolArray.length-1;return 4*X.length}function sp(t){for(var e in t)return t[e];return null}function nf(t,e,r,a){var u=t.compareText;if(e in u){for(var c=u[e],f=c.length-1;f>=0;f--)if(a.dist(c[f])<r)return!0}else u[e]=[];return u[e].push(a),!1}var of=eu.VectorTileFeature.types,af=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Sl(t,e,r,a,u,c,f,y,x,w,I,A,z){var O=y?Math.min(32640,Math.round(y[0])):0,Z=y?Math.min(32640,Math.round(y[1])):0;t.emplaceBack(e,r,Math.round(32*a),Math.round(32*u),c,f,(O<<1)+(x?1:0),Z,16*w,16*I,256*A,256*z)}function oc(t,e,r){t.emplaceBack(e.x,e.y,r),t.emplaceBack(e.x,e.y,r),t.emplaceBack(e.x,e.y,r),t.emplaceBack(e.x,e.y,r)}function sf(t){for(var e=0,r=t.sections;e<r.length;e+=1)if(Zs(r[e].text))return!0;return!1}var uu=function(t){this.layoutVertexArray=new Ws,this.indexArray=new pa,this.programConfigurations=t,this.segments=new F,this.dynamicLayoutVertexArray=new ts,this.opacityVertexArray=new bs,this.placedSymbolArray=new s};uu.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},uu.prototype.upload=function(t,e,r,a){this.isEmpty()||(r&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,zh.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,e),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Dh.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,af,!0),this.opacityVertexBuffer.itemSize=1),(r||a)&&this.programConfigurations.upload(t))},uu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},Qt("SymbolBuffers",uu);var Ku=function(t,e,r){this.layoutVertexArray=new t,this.layoutAttributes=e,this.indexArray=new r,this.segments=new F,this.collisionVertexArray=new Lu};Ku.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Lh.members,!0)},Ku.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},Qt("CollisionBuffers",Ku);var Ir=function(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(c){return c.id}),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ji([]),this.placementViewportMatrix=Ji([]);var e=this.layers[0]._unevaluatedLayout._values;this.textSizeData=rc(this.zoom,e["text-size"]),this.iconSizeData=rc(this.zoom,e["icon-size"]);var r=this.layers[0].layout,a=r.get("symbol-sort-key"),u=r.get("symbol-z-order");this.canOverlap=r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey=u!=="viewport-y"&&a.constantOr(1)!==void 0,this.sortFeaturesByY=(u==="viewport-y"||u==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,r.get("symbol-placement")==="point"&&(this.writingModes=r.get("text-writing-mode").map(function(c){return lo[c]})),this.stateDependentLayerIds=this.layers.filter(function(c){return c.isStateDependent()}).map(function(c){return c.id}),this.sourceID=t.sourceID};Ir.prototype.createArrays=function(){this.text=new uu(new Pe(this.layers,this.zoom,function(t){return/^text/.test(t)})),this.icon=new uu(new Pe(this.layers,this.zoom,function(t){return/^icon/.test(t)})),this.glyphOffsetArray=new m,this.lineVertexArray=new _,this.symbolInstances=new d},Ir.prototype.calculateGlyphDependencies=function(t,e,r,a,u){for(var c=0;c<t.length;c++)if(e[t.charCodeAt(c)]=!0,(r||a)&&u){var f=qu[t.charAt(c)];f&&(e[f.charCodeAt(0)]=!0)}},Ir.prototype.populate=function(t,e,r){var a=this.layers[0],u=a.layout,c=u.get("text-font"),f=u.get("text-field"),y=u.get("icon-image"),x=(f.value.kind!=="constant"||f.value.value instanceof E&&!f.value.value.isEmpty()||f.value.value.toString().length>0)&&(c.value.kind!=="constant"||c.value.value.length>0),w=y.value.kind!=="constant"||!!y.value.value||Object.keys(y.parameters).length>0,I=u.get("symbol-sort-key");if(this.features=[],x||w){for(var A=e.iconDependencies,z=e.glyphDependencies,O=e.availableImages,Z=new or(this.zoom),X=0,rt=t;X<rt.length;X+=1){var Y=rt[X],ct=Y.feature,vt=Y.id,xt=Y.index,Tt=Y.sourceLayerIndex,Mt=a._featureFilter.needGeometry,Ut=sn(ct,Mt);if(a._featureFilter.filter(Z,Ut,r)){Mt||(Ut.geometry=Kr(ct));var Jt=void 0;if(x){var _e=a.getValueAndResolveTokens("text-field",Ut,r,O),ue=E.factory(_e);sf(ue)&&(this.hasRTLText=!0),(!this.hasRTLText||ku()==="unavailable"||this.hasRTLText&&Hi.isParsed())&&(Jt=Rh(ue,a,Ut))}var Ee=void 0;if(w){var le=a.getValueAndResolveTokens("icon-image",Ut,r,O);Ee=le instanceof j?le:j.fromString(le)}if(Jt||Ee){var Qe=this.sortFeaturesByKey?I.evaluate(Ut,{},r):void 0;if(this.features.push({id:vt,text:Jt,icon:Ee,index:xt,sourceLayerIndex:Tt,geometry:Ut.geometry,properties:ct.properties,type:of[ct.type],sortKey:Qe}),Ee&&(A[Ee.name]=!0),Jt){var ke=c.evaluate(Ut,{},r).join(","),ge=u.get("text-rotation-alignment")==="map"&&u.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(lo.vertical)>=0;for(var nr=0,Ge=Jt.sections;nr<Ge.length;nr+=1){var pr=Ge[nr];if(pr.image)A[pr.image.name]=!0;else{var Se=Cu(Jt.toString()),gr=pr.fontStack||ke,jr=z[gr]=z[gr]||{};this.calculateGlyphDependencies(pr.text,jr,ge,this.allowVerticalPlacement,Se)}}}}}}u.get("symbol-placement")==="line"&&(this.features=function(tn){var Xr={},qr={},en=[],Dn=0;function Ln(Nr){en.push(tn[Nr]),Dn++}function hi(Nr,yn,ri){var vr=qr[Nr];return delete qr[Nr],qr[yn]=vr,en[vr].geometry[0].pop(),en[vr].geometry[0]=en[vr].geometry[0].concat(ri[0]),vr}function jn(Nr,yn,ri){var vr=Xr[yn];return delete Xr[yn],Xr[Nr]=vr,en[vr].geometry[0].shift(),en[vr].geometry[0]=ri[0].concat(en[vr].geometry[0]),vr}function fi(Nr,yn,ri){var vr=ri?yn[0][yn[0].length-1]:yn[0][0];return Nr+":"+vr.x+":"+vr.y}for(var un=0;un<tn.length;un++){var qn=tn[un],ar=qn.geometry,Pr=qn.text?qn.text.toString():null;if(Pr){var Sr=fi(Pr,ar),dr=fi(Pr,ar,!0);if(Sr in qr&&dr in Xr&&qr[Sr]!==Xr[dr]){var Ci=jn(Sr,dr,ar),ei=hi(Sr,dr,en[Ci].geometry);delete Xr[Sr],delete qr[dr],qr[fi(Pr,en[ei].geometry,!0)]=ei,en[Ci].geometry=null}else Sr in qr?hi(Sr,dr,ar):dr in Xr?jn(Sr,dr,ar):(Ln(un),Xr[Sr]=Dn-1,qr[dr]=Dn-1)}else Ln(un)}return en.filter(function(Nr){return Nr.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(tn,Xr){return tn.sortKey-Xr.sortKey})}},Ir.prototype.update=function(t,e,r){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,e,this.layers,r),this.icon.programConfigurations.updatePaintArrays(t,e,this.layers,r))},Ir.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},Ir.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},Ir.prototype.upload=function(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},Ir.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},Ir.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},Ir.prototype.addToLineVertexArray=function(t,e){var r=this.lineVertexArray.length;if(t.segment!==void 0){for(var a=t.dist(e[t.segment+1]),u=t.dist(e[t.segment]),c={},f=t.segment+1;f<e.length;f++)c[f]={x:e[f].x,y:e[f].y,tileUnitDistanceFromAnchor:a},f<e.length-1&&(a+=e[f+1].dist(e[f]));for(var y=t.segment||0;y>=0;y--)c[y]={x:e[y].x,y:e[y].y,tileUnitDistanceFromAnchor:u},y>0&&(u+=e[y-1].dist(e[y]));for(var x=0;x<e.length;x++){var w=c[x];this.lineVertexArray.emplaceBack(w.x,w.y,w.tileUnitDistanceFromAnchor)}}return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}},Ir.prototype.addSymbols=function(t,e,r,a,u,c,f,y,x,w,I,A){for(var z=t.indexArray,O=t.layoutVertexArray,Z=t.segments.prepareSegment(4*e.length,O,z,this.canOverlap?c.sortKey:void 0),X=this.glyphOffsetArray.length,rt=Z.vertexLength,Y=this.allowVerticalPlacement&&f===lo.vertical?Math.PI/2:0,ct=c.text&&c.text.sections,vt=0;vt<e.length;vt++){var xt=e[vt],Tt=xt.tl,Mt=xt.tr,Ut=xt.bl,Jt=xt.br,_e=xt.tex,ue=xt.pixelOffsetTL,Ee=xt.pixelOffsetBR,le=xt.minFontScaleX,Qe=xt.minFontScaleY,ke=xt.glyphOffset,ge=xt.isSDF,nr=xt.sectionIndex,Ge=Z.vertexLength,pr=ke[1];Sl(O,y.x,y.y,Tt.x,pr+Tt.y,_e.x,_e.y,r,ge,ue.x,ue.y,le,Qe),Sl(O,y.x,y.y,Mt.x,pr+Mt.y,_e.x+_e.w,_e.y,r,ge,Ee.x,ue.y,le,Qe),Sl(O,y.x,y.y,Ut.x,pr+Ut.y,_e.x,_e.y+_e.h,r,ge,ue.x,Ee.y,le,Qe),Sl(O,y.x,y.y,Jt.x,pr+Jt.y,_e.x+_e.w,_e.y+_e.h,r,ge,Ee.x,Ee.y,le,Qe),oc(t.dynamicLayoutVertexArray,y,Y),z.emplaceBack(Ge,Ge+1,Ge+2),z.emplaceBack(Ge+1,Ge+2,Ge+3),Z.vertexLength+=4,Z.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ke[0]),vt!==e.length-1&&nr===e[vt+1].sectionIndex||t.programConfigurations.populatePaintArrays(O.length,c,c.index,{},A,ct&&ct[nr])}t.placedSymbolArray.emplaceBack(y.x,y.y,X,this.glyphOffsetArray.length-X,rt,x,w,y.segment,r?r[0]:0,r?r[1]:0,a[0],a[1],f,0,!1,0,I)},Ir.prototype._addCollisionDebugVertex=function(t,e,r,a,u,c){return e.emplaceBack(0,0),t.emplaceBack(r.x,r.y,a,u,Math.round(c.x),Math.round(c.y))},Ir.prototype.addCollisionDebugVertices=function(t,e,r,a,u,c,f){var y=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),x=y.vertexLength,w=u.layoutVertexArray,I=u.collisionVertexArray,A=f.anchorX,z=f.anchorY;this._addCollisionDebugVertex(w,I,c,A,z,new Oe(t,e)),this._addCollisionDebugVertex(w,I,c,A,z,new Oe(r,e)),this._addCollisionDebugVertex(w,I,c,A,z,new Oe(r,a)),this._addCollisionDebugVertex(w,I,c,A,z,new Oe(t,a)),y.vertexLength+=4;var O=u.indexArray;O.emplaceBack(x,x+1),O.emplaceBack(x+1,x+2),O.emplaceBack(x+2,x+3),O.emplaceBack(x+3,x),y.primitiveLength+=4},Ir.prototype.addDebugCollisionBoxes=function(t,e,r,a){for(var u=t;u<e;u++){var c=this.collisionBoxArray.get(u);this.addCollisionDebugVertices(c.x1,c.y1,c.x2,c.y2,a?this.textCollisionBox:this.iconCollisionBox,c.anchorPoint,r)}},Ir.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Ku(es,Nc.members,ws),this.iconCollisionBox=new Ku(es,Nc.members,ws);for(var t=0;t<this.symbolInstances.length;t++){var e=this.symbolInstances.get(t);this.addDebugCollisionBoxes(e.textBoxStartIndex,e.textBoxEndIndex,e,!0),this.addDebugCollisionBoxes(e.verticalTextBoxStartIndex,e.verticalTextBoxEndIndex,e,!0),this.addDebugCollisionBoxes(e.iconBoxStartIndex,e.iconBoxEndIndex,e,!1),this.addDebugCollisionBoxes(e.verticalIconBoxStartIndex,e.verticalIconBoxEndIndex,e,!1)}},Ir.prototype._deserializeCollisionBoxesForSymbol=function(t,e,r,a,u,c,f,y,x){for(var w={},I=e;I<r;I++){var A=t.get(I);w.textBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,anchorPointX:A.anchorPointX,anchorPointY:A.anchorPointY},w.textFeatureIndex=A.featureIndex;break}for(var z=a;z<u;z++){var O=t.get(z);w.verticalTextBox={x1:O.x1,y1:O.y1,x2:O.x2,y2:O.y2,anchorPointX:O.anchorPointX,anchorPointY:O.anchorPointY},w.verticalTextFeatureIndex=O.featureIndex;break}for(var Z=c;Z<f;Z++){var X=t.get(Z);w.iconBox={x1:X.x1,y1:X.y1,x2:X.x2,y2:X.y2,anchorPointX:X.anchorPointX,anchorPointY:X.anchorPointY},w.iconFeatureIndex=X.featureIndex;break}for(var rt=y;rt<x;rt++){var Y=t.get(rt);w.verticalIconBox={x1:Y.x1,y1:Y.y1,x2:Y.x2,y2:Y.y2,anchorPointX:Y.anchorPointX,anchorPointY:Y.anchorPointY},w.verticalIconFeatureIndex=Y.featureIndex;break}return w},Ir.prototype.deserializeCollisionBoxes=function(t){this.collisionArrays=[];for(var e=0;e<this.symbolInstances.length;e++){var r=this.symbolInstances.get(e);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex))}},Ir.prototype.hasTextData=function(){return this.text.segments.get().length>0},Ir.prototype.hasIconData=function(){return this.icon.segments.get().length>0},Ir.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},Ir.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},Ir.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},Ir.prototype.addIndicesForPlacedSymbol=function(t,e){for(var r=t.placedSymbolArray.get(e),a=r.vertexStartIndex+4*r.numGlyphs,u=r.vertexStartIndex;u<a;u+=4)t.indexArray.emplaceBack(u,u+1,u+2),t.indexArray.emplaceBack(u+1,u+2,u+3)},Ir.prototype.getSortedSymbolIndexes=function(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var e=Math.sin(t),r=Math.cos(t),a=[],u=[],c=[],f=0;f<this.symbolInstances.length;++f){c.push(f);var y=this.symbolInstances.get(f);a.push(0|Math.round(e*y.anchorX+r*y.anchorY)),u.push(y.featureIndex)}return c.sort(function(x,w){return a[x]-a[w]||u[w]-u[x]}),c},Ir.prototype.addToSortKeyRanges=function(t,e){var r=this.sortKeyRanges[this.sortKeyRanges.length-1];r&&r.sortKey===e?r.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:e,symbolInstanceStart:t,symbolInstanceEnd:t+1})},Ir.prototype.sortFeatures=function(t){var e=this;if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var r=0,a=this.symbolInstanceIndexes;r<a.length;r+=1){var u=this.symbolInstances.get(a[r]);this.featureSortOrder.push(u.featureIndex),[u.rightJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.leftJustifiedTextSymbolIndex].forEach(function(c,f,y){c>=0&&y.indexOf(c)===f&&e.addIndicesForPlacedSymbol(e.text,c)}),u.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,u.verticalPlacedTextSymbolIndex),u.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,u.placedIconSymbolIndex),u.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,u.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},Qt("SymbolBucket",Ir,{omit:["layers","collisionBoxArray","features","compareText"]}),Ir.MAX_GLYPHS=65535,Ir.addDynamicAttributes=oc;var uf=new Xn({"symbol-placement":new be(L.layout_symbol["symbol-placement"]),"symbol-spacing":new be(L.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new be(L.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ye(L.layout_symbol["symbol-sort-key"]),"symbol-z-order":new be(L.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new be(L.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new be(L.layout_symbol["icon-ignore-placement"]),"icon-optional":new be(L.layout_symbol["icon-optional"]),"icon-rotation-alignment":new be(L.layout_symbol["icon-rotation-alignment"]),"icon-size":new ye(L.layout_symbol["icon-size"]),"icon-text-fit":new be(L.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new be(L.layout_symbol["icon-text-fit-padding"]),"icon-image":new ye(L.layout_symbol["icon-image"]),"icon-rotate":new ye(L.layout_symbol["icon-rotate"]),"icon-padding":new be(L.layout_symbol["icon-padding"]),"icon-keep-upright":new be(L.layout_symbol["icon-keep-upright"]),"icon-offset":new ye(L.layout_symbol["icon-offset"]),"icon-anchor":new ye(L.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new be(L.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new be(L.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new be(L.layout_symbol["text-rotation-alignment"]),"text-field":new ye(L.layout_symbol["text-field"]),"text-font":new ye(L.layout_symbol["text-font"]),"text-size":new ye(L.layout_symbol["text-size"]),"text-max-width":new ye(L.layout_symbol["text-max-width"]),"text-line-height":new be(L.layout_symbol["text-line-height"]),"text-letter-spacing":new ye(L.layout_symbol["text-letter-spacing"]),"text-justify":new ye(L.layout_symbol["text-justify"]),"text-radial-offset":new ye(L.layout_symbol["text-radial-offset"]),"text-variable-anchor":new be(L.layout_symbol["text-variable-anchor"]),"text-anchor":new ye(L.layout_symbol["text-anchor"]),"text-max-angle":new be(L.layout_symbol["text-max-angle"]),"text-writing-mode":new be(L.layout_symbol["text-writing-mode"]),"text-rotate":new ye(L.layout_symbol["text-rotate"]),"text-padding":new be(L.layout_symbol["text-padding"]),"text-keep-upright":new be(L.layout_symbol["text-keep-upright"]),"text-transform":new ye(L.layout_symbol["text-transform"]),"text-offset":new ye(L.layout_symbol["text-offset"]),"text-allow-overlap":new be(L.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new be(L.layout_symbol["text-ignore-placement"]),"text-optional":new be(L.layout_symbol["text-optional"])}),ac={paint:new Xn({"icon-opacity":new ye(L.paint_symbol["icon-opacity"]),"icon-color":new ye(L.paint_symbol["icon-color"]),"icon-halo-color":new ye(L.paint_symbol["icon-halo-color"]),"icon-halo-width":new ye(L.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ye(L.paint_symbol["icon-halo-blur"]),"icon-translate":new be(L.paint_symbol["icon-translate"]),"icon-translate-anchor":new be(L.paint_symbol["icon-translate-anchor"]),"text-opacity":new ye(L.paint_symbol["text-opacity"]),"text-color":new ye(L.paint_symbol["text-color"],{runtimeType:Yt,getOverride:function(t){return t.textColor},hasOverride:function(t){return!!t.textColor}}),"text-halo-color":new ye(L.paint_symbol["text-halo-color"]),"text-halo-width":new ye(L.paint_symbol["text-halo-width"]),"text-halo-blur":new ye(L.paint_symbol["text-halo-blur"]),"text-translate":new be(L.paint_symbol["text-translate"]),"text-translate-anchor":new be(L.paint_symbol["text-translate-anchor"])}),layout:uf},lu=function(t){this.type=t.property.overrides?t.property.overrides.runtimeType:Wt,this.defaultValue=t};lu.prototype.evaluate=function(t){if(t.formattedSection){var e=this.defaultValue.property.overrides;if(e&&e.hasOverride(t.formattedSection))return e.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default},lu.prototype.eachChild=function(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)},lu.prototype.outputDefined=function(){return!1},lu.prototype.serialize=function(){return null},Qt("FormatSectionOverride",lu,{omit:["defaultValue"]});var lf=function(t){function e(r){t.call(this,r,ac)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.recalculate=function(r,a){if(t.prototype.recalculate.call(this,r,a),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var u=this.layout.get("text-writing-mode");if(u){for(var c=[],f=0,y=u;f<y.length;f+=1){var x=y[f];c.indexOf(x)<0&&c.push(x)}this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},e.prototype.getValueAndResolveTokens=function(r,a,u,c){var f=this.layout.get(r).evaluate(a,{},u,c),y=this._unevaluatedLayout._values[r];return y.isDataDriven()||ka(y.value)||!f?f:function(x,w){return w.replace(/{([^{}]+)}/g,function(I,A){return A in x?String(x[A]):""})}(a.properties,f)},e.prototype.createBucket=function(r){return new Ir(r)},e.prototype.queryRadius=function(){return 0},e.prototype.queryIntersectsFeature=function(){return!1},e.prototype._setPaintOverrides=function(){for(var r=0,a=ac.paint.overridableProperties;r<a.length;r+=1){var u=a[r];if(e.hasPaintOverride(this.layout,u)){var c,f=this.paint.get(u),y=new lu(f),x=new la(y,f.property.specification);c=f.value.kind==="constant"||f.value.kind==="source"?new Uo("source",x):new ai("composite",x,f.value.zoomStops,f.value._interpolationType),this.paint._values[u]=new ui(f.property,c,f.parameters)}}},e.prototype._handleOverridablePaintPropertyUpdate=function(r,a,u){return!(!this.layout||a.isDataDriven()||u.isDataDriven())&&e.hasPaintOverride(this.layout,r)},e.hasPaintOverride=function(r,a){var u=r.get("text-field"),c=ac.paint.properties[a],f=!1,y=function(I){for(var A=0,z=I;A<z.length;A+=1)if(c.overrides&&c.overrides.hasOverride(z[A]))return void(f=!0)};if(u.value.kind==="constant"&&u.value.value instanceof E)y(u.value.value.sections);else if(u.value.kind==="source"){var x=function(I){f||(I instanceof Gt&&V(I.value)===Fe?y(I.value.sections):I instanceof Ce?y(I.sections):I.eachChild(x))},w=u.value;w._styleExpression&&x(w._styleExpression.expression)}return f},e}(jo),cf={paint:new Xn({"background-color":new be(L.paint_background["background-color"]),"background-pattern":new li(L.paint_background["background-pattern"]),"background-opacity":new be(L.paint_background["background-opacity"])})},pf=function(t){function e(r){t.call(this,r,cf)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(jo),hf={paint:new Xn({"raster-opacity":new be(L.paint_raster["raster-opacity"]),"raster-hue-rotate":new be(L.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new be(L.paint_raster["raster-brightness-min"]),"raster-brightness-max":new be(L.paint_raster["raster-brightness-max"]),"raster-saturation":new be(L.paint_raster["raster-saturation"]),"raster-contrast":new be(L.paint_raster["raster-contrast"]),"raster-resampling":new be(L.paint_raster["raster-resampling"]),"raster-fade-duration":new be(L.paint_raster["raster-fade-duration"])})},ff=function(t){function e(r){t.call(this,r,hf)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(jo),df=function(t){function e(r){t.call(this,r,{}),this.implementation=r}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},e.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},e.prototype.recalculate=function(){},e.prototype.updateTransitions=function(){},e.prototype.hasTransition=function(){},e.prototype.serialize=function(){},e.prototype.onAdd=function(r){this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},e.prototype.onRemove=function(r){this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},e}(jo),mf={circle:Zl,heatmap:Yp,hillshade:Qp,fill:yh,"fill-extrusion":Th,line:Mh,symbol:lf,background:pf,raster:ff},up=Xt.HTMLImageElement,lp=Xt.HTMLCanvasElement,cp=Xt.HTMLVideoElement,pp=Xt.ImageData,Tl=Xt.ImageBitmap,As=function(t,e,r,a){this.context=t,this.format=r,this.texture=t.gl.createTexture(),this.update(e,a)};As.prototype.update=function(t,e,r){var a=t.width,u=t.height,c=!(this.size&&this.size[0]===a&&this.size[1]===u||r),f=this.context,y=f.gl;if(this.useMipmap=!!(e&&e.useMipmap),y.bindTexture(y.TEXTURE_2D,this.texture),f.pixelStoreUnpackFlipY.set(!1),f.pixelStoreUnpack.set(1),f.pixelStoreUnpackPremultiplyAlpha.set(this.format===y.RGBA&&(!e||e.premultiply!==!1)),c)this.size=[a,u],t instanceof up||t instanceof lp||t instanceof cp||t instanceof pp||Tl&&t instanceof Tl?y.texImage2D(y.TEXTURE_2D,0,this.format,this.format,y.UNSIGNED_BYTE,t):y.texImage2D(y.TEXTURE_2D,0,this.format,a,u,0,this.format,y.UNSIGNED_BYTE,t.data);else{var x=r||{x:0,y:0},w=x.x,I=x.y;t instanceof up||t instanceof lp||t instanceof cp||t instanceof pp||Tl&&t instanceof Tl?y.texSubImage2D(y.TEXTURE_2D,0,w,I,y.RGBA,y.UNSIGNED_BYTE,t):y.texSubImage2D(y.TEXTURE_2D,0,w,I,a,u,y.RGBA,y.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&y.generateMipmap(y.TEXTURE_2D)},As.prototype.bind=function(t,e,r){var a=this.context.gl;a.bindTexture(a.TEXTURE_2D,this.texture),r!==a.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(r=a.LINEAR),t!==this.filter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,t),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,r||t),this.filter=t),e!==this.wrap&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,e),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,e),this.wrap=e)},As.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},As.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var sc=function(t){var e=this;this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){e._triggered=!1,e._callback()})};sc.prototype.trigger=function(){var t=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){t._triggered=!1,t._callback()},0))},sc.prototype.remove=function(){delete this._channel,this._callback=function(){}};var cu=function(t,e,r){this.target=t,this.parent=e,this.mapId=r,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},Wr(["receive","process"],this),this.invoker=new sc(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=hn()?t:Xt};function hp(t,e,r){var a=2*Math.PI*6378137/256/Math.pow(2,r);return[t*a-2*Math.PI*6378137/2,e*a-2*Math.PI*6378137/2]}cu.prototype.send=function(t,e,r,a,u){var c=this;u===void 0&&(u=!1);var f=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(this.callbacks[f]=r);var y=yi(this.globalScope)?void 0:[];return this.target.postMessage({id:f,type:t,hasCallback:!!r,targetMapId:a,mustQueue:u,sourceMapId:this.mapId,data:si(e,y)},y),{cancel:function(){r&&delete c.callbacks[f],c.target.postMessage({id:f,type:"<cancel>",targetMapId:a,sourceMapId:c.mapId})}}},cu.prototype.receive=function(t){var e=t.data,r=e.id;if(r&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){delete this.tasks[r];var a=this.cancelCallbacks[r];delete this.cancelCallbacks[r],a&&a()}else hn()||e.mustQueue?(this.tasks[r]=e,this.taskQueue.push(r),this.invoker.trigger()):this.processTask(r,e)},cu.prototype.process=function(){if(this.taskQueue.length){var t=this.taskQueue.shift(),e=this.tasks[t];delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),e&&this.processTask(t,e)}},cu.prototype.processTask=function(t,e){var r=this;if(e.type==="<response>"){var a=this.callbacks[t];delete this.callbacks[t],a&&(e.error?a(zr(e.error)):a(null,zr(e.data)))}else{var u=!1,c=yi(this.globalScope)?void 0:[],f=e.hasCallback?function(I,A){u=!0,delete r.cancelCallbacks[t],r.target.postMessage({id:t,type:"<response>",sourceMapId:r.mapId,error:I?si(I):null,data:si(A,c)},c)}:function(I){u=!0},y=null,x=zr(e.data);if(this.parent[e.type])y=this.parent[e.type](e.sourceMapId,x,f);else if(this.parent.getWorkerSource){var w=e.type.split(".");y=this.parent.getWorkerSource(e.sourceMapId,w[0],x.source)[w[1]](x,f)}else f(new Error("Could not find function "+e.type));!u&&y&&y.cancel&&(this.cancelCallbacks[t]=y.cancel)}},cu.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Tn=function(t,e){t&&(e?this.setSouthWest(t).setNorthEast(e):t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))};Tn.prototype.setNorthEast=function(t){return this._ne=t instanceof Vr?new Vr(t.lng,t.lat):Vr.convert(t),this},Tn.prototype.setSouthWest=function(t){return this._sw=t instanceof Vr?new Vr(t.lng,t.lat):Vr.convert(t),this},Tn.prototype.extend=function(t){var e,r,a=this._sw,u=this._ne;if(t instanceof Vr)e=t,r=t;else{if(!(t instanceof Tn))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Tn.convert(t)):this.extend(Vr.convert(t)):this;if(r=t._ne,!(e=t._sw)||!r)return this}return a||u?(a.lng=Math.min(e.lng,a.lng),a.lat=Math.min(e.lat,a.lat),u.lng=Math.max(r.lng,u.lng),u.lat=Math.max(r.lat,u.lat)):(this._sw=new Vr(e.lng,e.lat),this._ne=new Vr(r.lng,r.lat)),this},Tn.prototype.getCenter=function(){return new Vr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Tn.prototype.getSouthWest=function(){return this._sw},Tn.prototype.getNorthEast=function(){return this._ne},Tn.prototype.getNorthWest=function(){return new Vr(this.getWest(),this.getNorth())},Tn.prototype.getSouthEast=function(){return new Vr(this.getEast(),this.getSouth())},Tn.prototype.getWest=function(){return this._sw.lng},Tn.prototype.getSouth=function(){return this._sw.lat},Tn.prototype.getEast=function(){return this._ne.lng},Tn.prototype.getNorth=function(){return this._ne.lat},Tn.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Tn.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Tn.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Tn.prototype.contains=function(t){var e=Vr.convert(t),r=e.lng,a=e.lat,u=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&u},Tn.convert=function(t){return!t||t instanceof Tn?t:new Tn(t)};var Vr=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid LngLat object: ("+t+", "+e+")");if(this.lng=+t,this.lat=+e,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};Vr.prototype.wrap=function(){return new Vr(ir(this.lng,-180,180),this.lat)},Vr.prototype.toArray=function(){return[this.lng,this.lat]},Vr.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},Vr.prototype.distanceTo=function(t){var e=Math.PI/180,r=this.lat*e,a=t.lat*e,u=Math.sin(r)*Math.sin(a)+Math.cos(r)*Math.cos(a)*Math.cos((t.lng-this.lng)*e);return 63710088e-1*Math.acos(Math.min(u,1))},Vr.prototype.toBounds=function(t){t===void 0&&(t=0);var e=360*t/40075017,r=e/Math.cos(Math.PI/180*this.lat);return new Tn(new Vr(this.lng-r,this.lat-e),new Vr(this.lng+r,this.lat+e))},Vr.convert=function(t){if(t instanceof Vr)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Vr(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Vr(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var fp=2*Math.PI*63710088e-1;function dp(t){return fp*Math.cos(t*Math.PI/180)}function mp(t){return(180+t)/360}function yp(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function gp(t,e){return t/dp(e)}function uc(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}var Ps=function(t,e,r){r===void 0&&(r=0),this.x=+t,this.y=+e,this.z=+r};Ps.fromLngLat=function(t,e){e===void 0&&(e=0);var r=Vr.convert(t);return new Ps(mp(r.lng),yp(r.lat),gp(e,r.lat))},Ps.prototype.toLngLat=function(){return new Vr(360*this.x-180,uc(this.y))},Ps.prototype.toAltitude=function(){return this.z*dp(uc(this.y))},Ps.prototype.meterInMercatorCoordinateUnits=function(){return 1/fp*(t=uc(this.y),1/Math.cos(t*Math.PI/180));var t};var ks=function(t,e,r){this.z=t,this.x=e,this.y=r,this.key=Xu(0,t,t,e,r)};ks.prototype.equals=function(t){return this.z===t.z&&this.x===t.x&&this.y===t.y},ks.prototype.url=function(t,e){var r,a,u,c,f,y=(a=this.y,u=this.z,c=hp(256*(r=this.x),256*(a=Math.pow(2,u)-a-1),u),f=hp(256*(r+1),256*(a+1),u),c[0]+","+c[1]+","+f[0]+","+f[1]),x=function(w,I,A){for(var z,O="",Z=w;Z>0;Z--)O+=(I&(z=1<<Z-1)?1:0)+(A&z?2:0);return O}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(e==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",x).replace("{bbox-epsg-3857}",y)},ks.prototype.getTilePoint=function(t){var e=Math.pow(2,this.z);return new Oe(8192*(t.x*e-this.x),8192*(t.y*e-this.y))},ks.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var vp=function(t,e){this.wrap=t,this.canonical=e,this.key=Xu(t,e.z,e.z,e.x,e.y)},In=function(t,e,r,a,u){this.overscaledZ=t,this.wrap=e,this.canonical=new ks(r,+a,+u),this.key=Xu(e,t,r,a,u)};function Xu(t,e,r,a,u){(t*=2)<0&&(t=-1*t-1);var c=1<<r;return(c*c*t+c*u+a).toString(36)+r.toString(36)+e.toString(36)}In.prototype.equals=function(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)},In.prototype.scaledTo=function(t){var e=this.canonical.z-t;return t>this.canonical.z?new In(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new In(t,this.wrap,t,this.canonical.x>>e,this.canonical.y>>e)},In.prototype.calculateScaledKey=function(t,e){var r=this.canonical.z-t;return t>this.canonical.z?Xu(this.wrap*+e,t,this.canonical.z,this.canonical.x,this.canonical.y):Xu(this.wrap*+e,t,t,this.canonical.x>>r,this.canonical.y>>r)},In.prototype.isChildOf=function(t){if(t.wrap!==this.wrap)return!1;var e=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>e&&t.canonical.y===this.canonical.y>>e},In.prototype.children=function(t){if(this.overscaledZ>=t)return[new In(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var e=this.canonical.z+1,r=2*this.canonical.x,a=2*this.canonical.y;return[new In(e,this.wrap,e,r,a),new In(e,this.wrap,e,r+1,a),new In(e,this.wrap,e,r,a+1),new In(e,this.wrap,e,r+1,a+1)]},In.prototype.isLessThan=function(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))},In.prototype.wrapped=function(){return new In(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},In.prototype.unwrapTo=function(t){return new In(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)},In.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},In.prototype.toUnwrapped=function(){return new vp(this.wrap,this.canonical)},In.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},In.prototype.getTilePoint=function(t){return this.canonical.getTilePoint(new Ps(t.x-this.wrap,t.y))},Qt("CanonicalTileID",ks),Qt("OverscaledTileID",In,{omit:["posMatrix"]});var Fa=function(t,e,r){if(this.uid=t,e.height!==e.width)throw new RangeError("DEM tiles must be square");if(r&&r!=="mapbox"&&r!=="terrarium")return wr('"'+r+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=e.height;var a=this.dim=e.height-2;this.data=new Uint32Array(e.data.buffer),this.encoding=r||"mapbox";for(var u=0;u<a;u++)this.data[this._idx(-1,u)]=this.data[this._idx(0,u)],this.data[this._idx(a,u)]=this.data[this._idx(a-1,u)],this.data[this._idx(u,-1)]=this.data[this._idx(u,0)],this.data[this._idx(u,a)]=this.data[this._idx(u,a-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(a,-1)]=this.data[this._idx(a-1,0)],this.data[this._idx(-1,a)]=this.data[this._idx(0,a-1)],this.data[this._idx(a,a)]=this.data[this._idx(a-1,a-1)]};Fa.prototype.get=function(t,e){var r=new Uint8Array(this.data.buffer),a=4*this._idx(t,e);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(r[a],r[a+1],r[a+2])},Fa.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Fa.prototype._idx=function(t,e){if(t<-1||t>=this.dim+1||e<-1||e>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(e+1)*this.stride+(t+1)},Fa.prototype._unpackMapbox=function(t,e,r){return(256*t*256+256*e+r)/10-1e4},Fa.prototype._unpackTerrarium=function(t,e,r){return 256*t+e+r/256-32768},Fa.prototype.getPixels=function(){return new Zi({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Fa.prototype.backfillBorder=function(t,e,r){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");var a=e*this.dim,u=e*this.dim+this.dim,c=r*this.dim,f=r*this.dim+this.dim;switch(e){case-1:a=u-1;break;case 1:u=a+1}switch(r){case-1:c=f-1;break;case 1:f=c+1}for(var y=-e*this.dim,x=-r*this.dim,w=c;w<f;w++)for(var I=a;I<u;I++)this.data[this._idx(I,w)]=t.data[this._idx(I+y,w+x)]},Qt("DEMData",Fa);var Il=function(t){this._stringToNumber={},this._numberToString=[];for(var e=0;e<t.length;e++){var r=t[e];this._stringToNumber[r]=e,this._numberToString[e]=r}};Il.prototype.encode=function(t){return this._stringToNumber[t]},Il.prototype.decode=function(t){return this._numberToString[t]};var Cl=function(t,e,r,a,u){this.type="Feature",this._vectorTileFeature=t,t._z=e,t._x=r,t._y=a,this.properties=t.properties,this.id=u},lc={geometry:{configurable:!0}};lc.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},lc.geometry.set=function(t){this._geometry=t},Cl.prototype.toJSON=function(){var t={geometry:this.geometry};for(var e in this)e!=="_geometry"&&e!=="_vectorTileFeature"&&(t[e]=this[e]);return t},Object.defineProperties(Cl.prototype,lc);var pu=function(){this.state={},this.stateChanges={},this.deletedStates={}};pu.prototype.updateState=function(t,e,r){var a=String(e);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][a]=this.stateChanges[t][a]||{},hr(this.stateChanges[t][a],r),this.deletedStates[t]===null)for(var u in this.deletedStates[t]={},this.state[t])u!==a&&(this.deletedStates[t][u]=null);else if(this.deletedStates[t]&&this.deletedStates[t][a]===null)for(var c in this.deletedStates[t][a]={},this.state[t][a])r[c]||(this.deletedStates[t][a][c]=null);else for(var f in r)this.deletedStates[t]&&this.deletedStates[t][a]&&this.deletedStates[t][a][f]===null&&delete this.deletedStates[t][a][f]},pu.prototype.removeFeatureState=function(t,e,r){if(this.deletedStates[t]!==null){var a=String(e);if(this.deletedStates[t]=this.deletedStates[t]||{},r&&e!==void 0)this.deletedStates[t][a]!==null&&(this.deletedStates[t][a]=this.deletedStates[t][a]||{},this.deletedStates[t][a][r]=null);else if(e!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][a])for(r in this.deletedStates[t][a]={},this.stateChanges[t][a])this.deletedStates[t][a][r]=null;else this.deletedStates[t][a]=null;else this.deletedStates[t]=null}},pu.prototype.getState=function(t,e){var r=String(e),a=hr({},(this.state[t]||{})[r],(this.stateChanges[t]||{})[r]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){var u=this.deletedStates[t][e];if(u===null)return{};for(var c in u)delete a[c]}return a},pu.prototype.initializeTileState=function(t,e){t.setFeatureState(this.state,e)},pu.prototype.coalesceChanges=function(t,e){var r={};for(var a in this.stateChanges){this.state[a]=this.state[a]||{};var u={};for(var c in this.stateChanges[a])this.state[a][c]||(this.state[a][c]={}),hr(this.state[a][c],this.stateChanges[a][c]),u[c]=this.state[a][c];r[a]=u}for(var f in this.deletedStates){this.state[f]=this.state[f]||{};var y={};if(this.deletedStates[f]===null)for(var x in this.state[f])y[x]={},this.state[f][x]={};else for(var w in this.deletedStates[f]){if(this.deletedStates[f][w]===null)this.state[f][w]={};else for(var I=0,A=Object.keys(this.deletedStates[f][w]);I<A.length;I+=1)delete this.state[f][w][A[I]];y[w]=this.state[f][w]}r[f]=r[f]||{},hr(r[f],y)}if(this.stateChanges={},this.deletedStates={},Object.keys(r).length!==0)for(var z in t)t[z].setFeatureState(r,e)};var Na=function(t,e){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new ne(8192,16,0),this.grid3D=new ne(8192,16,0),this.featureIndexArray=new P,this.promoteId=e};function _p(t,e,r,a,u){return gn(t,function(c,f){var y=e instanceof xs?e.get(f):null;return y&&y.evaluate?y.evaluate(r,a,u):y})}function xp(t){for(var e=1/0,r=1/0,a=-1/0,u=-1/0,c=0,f=t;c<f.length;c+=1){var y=f[c];e=Math.min(e,y.x),r=Math.min(r,y.y),a=Math.max(a,y.x),u=Math.max(u,y.y)}return{minX:e,minY:r,maxX:a,maxY:u}}function yf(t,e){return e-t}Na.prototype.insert=function(t,e,r,a,u,c){var f=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,a,u);for(var y=c?this.grid3D:this.grid,x=0;x<e.length;x++){for(var w=e[x],I=[1/0,1/0,-1/0,-1/0],A=0;A<w.length;A++){var z=w[A];I[0]=Math.min(I[0],z.x),I[1]=Math.min(I[1],z.y),I[2]=Math.max(I[2],z.x),I[3]=Math.max(I[3],z.y)}I[0]<8192&&I[1]<8192&&I[2]>=0&&I[3]>=0&&y.insert(f,I[0],I[1],I[2],I[3])}},Na.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new eu.VectorTile(new ml(this.rawTileData)).layers,this.sourceLayerCoder=new Il(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},Na.prototype.query=function(t,e,r,a){var u=this;this.loadVTLayers();for(var c=t.params||{},f=8192/t.tileSize/t.scale,y=Ma(c.filter),x=t.queryGeometry,w=t.queryPadding*f,I=xp(x),A=this.grid.query(I.minX-w,I.minY-w,I.maxX+w,I.maxY+w),z=xp(t.cameraQueryGeometry),O=this.grid3D.query(z.minX-w,z.minY-w,z.maxX+w,z.maxY+w,function(xt,Tt,Mt,Ut){return function(Jt,_e,ue,Ee,le){for(var Qe=0,ke=Jt;Qe<ke.length;Qe+=1){var ge=ke[Qe];if(_e<=ge.x&&ue<=ge.y&&Ee>=ge.x&&le>=ge.y)return!0}var nr=[new Oe(_e,ue),new Oe(_e,le),new Oe(Ee,le),new Oe(Ee,ue)];if(Jt.length>2){for(var Ge=0,pr=nr;Ge<pr.length;Ge+=1)if(Zo(Jt,pr[Ge]))return!0}for(var Se=0;Se<Jt.length-1;Se++)if(Ts(Jt[Se],Jt[Se+1],nr))return!0;return!1}(t.cameraQueryGeometry,xt-w,Tt-w,Mt+w,Ut+w)}),Z=0,X=O;Z<X.length;Z+=1)A.push(X[Z]);A.sort(yf);for(var rt,Y={},ct=function(xt){var Tt=A[xt];if(Tt!==rt){rt=Tt;var Mt=u.featureIndexArray.get(Tt),Ut=null;u.loadMatchingFeature(Y,Mt.bucketIndex,Mt.sourceLayerIndex,Mt.featureIndex,y,c.layers,c.availableImages,e,r,a,function(Jt,_e,ue){return Ut||(Ut=Kr(Jt)),_e.queryIntersectsFeature(x,Jt,ue,Ut,u.z,t.transform,f,t.pixelPosMatrix)})}},vt=0;vt<A.length;vt++)ct(vt);return Y},Na.prototype.loadMatchingFeature=function(t,e,r,a,u,c,f,y,x,w,I){var A=this.bucketLayerIDs[e];if(!c||function(Jt,_e){for(var ue=0;ue<Jt.length;ue++)if(_e.indexOf(Jt[ue])>=0)return!0;return!1}(c,A)){var z=this.sourceLayerCoder.decode(r),O=this.vtLayers[z].feature(a);if(u.needGeometry){var Z=sn(O,!0);if(!u.filter(new or(this.tileID.overscaledZ),Z,this.tileID.canonical))return}else if(!u.filter(new or(this.tileID.overscaledZ),O))return;for(var X=this.getId(O,z),rt=0;rt<A.length;rt++){var Y=A[rt];if(!(c&&c.indexOf(Y)<0)){var ct=y[Y];if(ct){var vt={};X!==void 0&&w&&(vt=w.getState(ct.sourceLayer||"_geojsonTileLayer",X));var xt=hr({},x[Y]);xt.paint=_p(xt.paint,ct.paint,O,vt,f),xt.layout=_p(xt.layout,ct.layout,O,vt,f);var Tt=!I||I(O,ct,vt);if(Tt){var Mt=new Cl(O,this.z,this.x,this.y,X);Mt.layer=xt;var Ut=t[Y];Ut===void 0&&(Ut=t[Y]=[]),Ut.push({featureIndex:a,feature:Mt,intersectionZ:Tt})}}}}}},Na.prototype.lookupSymbolFeatures=function(t,e,r,a,u,c,f,y){var x={};this.loadVTLayers();for(var w=Ma(u),I=0,A=t;I<A.length;I+=1)this.loadMatchingFeature(x,r,a,A[I],w,c,f,y,e);return x},Na.prototype.hasLayer=function(t){for(var e=0,r=this.bucketLayerIDs;e<r.length;e+=1)for(var a=0,u=r[e];a<u.length;a+=1)if(t===u[a])return!0;return!1},Na.prototype.getId=function(t,e){var r=t.id;return this.promoteId&&typeof(r=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[e]])=="boolean"&&(r=Number(r)),r},Qt("FeatureIndex",Na,{omit:["rawTileData","sourceLayerCoder"]});var Vn=function(t,e){this.tileID=t,this.uid=Lr(),this.uses=0,this.tileSize=e,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};Vn.prototype.registerFadeDuration=function(t){var e=t+this.timeAdded;e<vi.now()||this.fadeEndTime&&e<this.fadeEndTime||(this.fadeEndTime=e)},Vn.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},Vn.prototype.loadVectorData=function(t,e,r){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){for(var a in t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(w,I){var A={};if(!I)return A;for(var z=function(){var X=Z[O],rt=X.layerIds.map(function(vt){return I.getLayer(vt)}).filter(Boolean);if(rt.length!==0){X.layers=rt,X.stateDependentLayerIds&&(X.stateDependentLayers=X.stateDependentLayerIds.map(function(vt){return rt.filter(function(xt){return xt.id===vt})[0]}));for(var Y=0,ct=rt;Y<ct.length;Y+=1)A[ct[Y].id]=X}},O=0,Z=w;O<Z.length;O+=1)z();return A}(t.buckets,e.style),this.hasSymbolBuckets=!1,this.buckets){var u=this.buckets[a];if(u instanceof Ir){if(this.hasSymbolBuckets=!0,!r)break;u.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var c in this.buckets){var f=this.buckets[c];if(f instanceof Ir&&f.hasRTLText){this.hasRTLText=!0,Hi.isLoading()||Hi.isLoaded()||ku()!=="deferred"||Ao();break}}for(var y in this.queryPadding=0,this.buckets){var x=this.buckets[y];this.queryPadding=Math.max(this.queryPadding,e.style.getLayer(y).queryRadius(x))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new o},Vn.prototype.unloadVectorData=function(){for(var t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},Vn.prototype.getBucket=function(t){return this.buckets[t.id]},Vn.prototype.upload=function(t){for(var e in this.buckets){var r=this.buckets[e];r.uploadPending()&&r.upload(t)}var a=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new As(t,this.imageAtlas.image,a.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new As(t,this.glyphAtlasImage,a.ALPHA),this.glyphAtlasImage=null)},Vn.prototype.prepare=function(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)},Vn.prototype.queryRenderedFeatures=function(t,e,r,a,u,c,f,y,x,w){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:a,cameraQueryGeometry:u,scale:c,tileSize:this.tileSize,pixelPosMatrix:w,transform:y,params:f,queryPadding:this.queryPadding*x},t,e,r):{}},Vn.prototype.querySourceFeatures=function(t,e){var r=this.latestFeatureIndex;if(r&&r.rawTileData){var a=r.loadVTLayers(),u=e?e.sourceLayer:"",c=a._geojsonTileLayer||a[u];if(c)for(var f=Ma(e&&e.filter),y=this.tileID.canonical,x=y.z,w=y.x,I=y.y,A={z:x,x:w,y:I},z=0;z<c.length;z++){var O=c.feature(z);if(f.needGeometry){var Z=sn(O,!0);if(!f.filter(new or(this.tileID.overscaledZ),Z,this.tileID.canonical))continue}else if(!f.filter(new or(this.tileID.overscaledZ),O))continue;var X=r.getId(O,u),rt=new Cl(O,x,w,I,X);rt.tile=A,t.push(rt)}}},Vn.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},Vn.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},Vn.prototype.setExpiryData=function(t){var e=this.expirationTime;if(t.cacheControl){var r=ho(t.cacheControl);r["max-age"]&&(this.expirationTime=Date.now()+1e3*r["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){var a=Date.now(),u=!1;if(this.expirationTime>a)u=!1;else if(e)if(this.expirationTime<e)u=!0;else{var c=this.expirationTime-e;c?this.expirationTime=a+Math.max(c,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},Vn.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},Vn.prototype.setFeatureState=function(t,e){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(t).length!==0){var r=this.latestFeatureIndex.loadVTLayers();for(var a in this.buckets)if(e.style.hasLayer(a)){var u=this.buckets[a],c=u.layers[0].sourceLayer||"_geojsonTileLayer",f=r[c],y=t[c];if(f&&y&&Object.keys(y).length!==0){u.update(y,f,this.imageAtlas&&this.imageAtlas.patternPositions||{});var x=e&&e.style&&e.style.getLayer(a);x&&(this.queryPadding=Math.max(this.queryPadding,x.queryRadius(u)))}}}},Vn.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},Vn.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<vi.now()},Vn.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},Vn.prototype.setHoldDuration=function(t){this.symbolFadeHoldUntil=vi.now()+t},Vn.prototype.setDependencies=function(t,e){for(var r={},a=0,u=e;a<u.length;a+=1)r[u[a]]=!0;this.dependencies[t]=r},Vn.prototype.hasDependency=function(t,e){for(var r=0,a=t;r<a.length;r+=1){var u=this.dependencies[a[r]];if(u){for(var c=0,f=e;c<f.length;c+=1)if(u[f[c]])return!0}}return!1};var as=Xt.performance,bp=function(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},as.mark(this._marks.start)};bp.prototype.finish=function(){as.mark(this._marks.end);var t=as.getEntriesByName(this._marks.measure);return t.length===0&&(as.measure(this._marks.measure,this._marks.start,this._marks.end),t=as.getEntriesByName(this._marks.measure),as.clearMarks(this._marks.start),as.clearMarks(this._marks.end),as.clearMeasures(this._marks.measure)),t},l.Actor=cu,l.AlphaImage=Cs,l.CanonicalTileID=ks,l.CollisionBoxArray=o,l.Color=lr,l.DEMData=Fa,l.DataConstantProperty=be,l.DictionaryCoder=Il,l.EXTENT=8192,l.ErrorEvent=nt,l.EvaluationParameters=or,l.Event=G,l.Evented=$,l.FeatureIndex=Na,l.FillBucket=Qo,l.FillExtrusionBucket=ta,l.ImageAtlas=Gu,l.ImagePosition=gl,l.LineBucket=Ii,l.LngLat=Vr,l.LngLatBounds=Tn,l.MercatorCoordinate=Ps,l.ONE_EM=24,l.OverscaledTileID=In,l.Point=Oe,l.Point$1=Oe,l.Properties=Xn,l.Protobuf=ml,l.RGBAImage=Zi,l.RequestManager=mr,l.RequestPerformance=bp,l.ResourceType=Jn,l.SegmentVector=F,l.SourceFeatureState=pu,l.StructArrayLayout1ui2=Ru,l.StructArrayLayout2f1f2i16=La,l.StructArrayLayout2i4=Da,l.StructArrayLayout3ui6=pa,l.StructArrayLayout4i8=zu,l.SymbolBucket=Ir,l.Texture=As,l.Tile=Vn,l.Transitionable=Kn,l.Uniform1f=Zt,l.Uniform1i=Rt,l.Uniform2f=qt,l.Uniform3f=ce,l.Uniform4f=we,l.UniformColor=Ie,l.UniformMatrix4f=fr,l.UnwrappedTileID=vp,l.ValidationError=J,l.WritingMode=lo,l.ZoomHistory=Co,l.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t},l.addDynamicAttributes=oc,l.asyncAll=function(t,e,r){if(!t.length)return r(null,[]);var a=t.length,u=new Array(t.length),c=null;t.forEach(function(f,y){e(f,function(x,w){x&&(c=x),u[y]=w,--a==0&&r(c,u)})})},l.bezier=rr,l.bindAll=Wr,l.browser=vi,l.cacheEntryPossiblyAdded=function(t){++xe>Pn&&(t.getActor().send("enforceCacheSizeLimit",Di),xe=0)},l.clamp=ve,l.clearTileCache=function(t){var e=Xt.caches.delete("mapbox-tiles");t&&e.catch(t).then(function(){return t()})},l.clipLine=rp,l.clone=function(t){var e=new br(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},l.clone$1=ni,l.clone$2=function(t){var e=new br(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},l.collisionCircleLayout=Oh,l.config=Kt,l.create=function(){var t=new br(16);return br!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},l.create$1=function(){var t=new br(9);return br!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},l.create$2=function(){var t=new br(4);return br!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},l.createCommonjsModule=sr,l.createExpression=Ya,l.createLayout=Nn,l.createStyleLayer=function(t){return t.type==="custom"?new df(t):new mf[t.type](t)},l.cross=function(t,e,r){var a=e[0],u=e[1],c=e[2],f=r[0],y=r[1],x=r[2];return t[0]=u*x-c*y,t[1]=c*f-a*x,t[2]=a*y-u*f,t},l.deepEqual=function t(e,r){if(Array.isArray(e)){if(!Array.isArray(r)||e.length!==r.length)return!1;for(var a=0;a<e.length;a++)if(!t(e[a],r[a]))return!1;return!0}if(typeof e=="object"&&e!==null&&r!==null){if(typeof r!="object"||Object.keys(e).length!==Object.keys(r).length)return!1;for(var u in e)if(!t(e[u],r[u]))return!1;return!0}return e===r},l.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},l.dot$1=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},l.ease=Dr,l.emitValidationErrors=fe,l.endsWith=Ai,l.enforceCacheSizeLimit=function(t){wi(),Hn&&Hn.then(function(e){e.keys().then(function(r){for(var a=0;a<r.length-t;a++)e.delete(r[a])})})},l.evaluateSizeForFeature=Jc,l.evaluateSizeForZoom=Yc,l.evaluateVariableOffset=op,l.evented=Pu,l.extend=hr,l.featureFilter=Ma,l.filterObject=di,l.fromRotation=function(t,e){var r=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=r,t[2]=0,t[3]=-r,t[4]=a,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},l.getAnchorAlignment=ec,l.getAnchorJustification=ic,l.getArrayBuffer=mo,l.getImage=M,l.getJSON=function(t,e){return Yn(hr(t,{type:"json"}),e)},l.getRTLTextPluginStatus=ku,l.getReferrer=pe,l.getVideo=function(t,e){var r,a,u=Xt.document.createElement("video");u.muted=!0,u.onloadstart=function(){e(null,u)};for(var c=0;c<t.length;c++){var f=Xt.document.createElement("source");r=t[c],a=void 0,(a=Xt.document.createElement("a")).href=r,(a.protocol!==Xt.document.location.protocol||a.host!==Xt.document.location.host)&&(u.crossOrigin="Anonymous"),f.src=t[c],u.appendChild(f)}return{cancel:function(){}}},l.identity=Ji,l.invert=function(t,e){var r=e[0],a=e[1],u=e[2],c=e[3],f=e[4],y=e[5],x=e[6],w=e[7],I=e[8],A=e[9],z=e[10],O=e[11],Z=e[12],X=e[13],rt=e[14],Y=e[15],ct=r*y-a*f,vt=r*x-u*f,xt=r*w-c*f,Tt=a*x-u*y,Mt=a*w-c*y,Ut=u*w-c*x,Jt=I*X-A*Z,_e=I*rt-z*Z,ue=I*Y-O*Z,Ee=A*rt-z*X,le=A*Y-O*X,Qe=z*Y-O*rt,ke=ct*Qe-vt*le+xt*Ee+Tt*ue-Mt*_e+Ut*Jt;return ke?(t[0]=(y*Qe-x*le+w*Ee)*(ke=1/ke),t[1]=(u*le-a*Qe-c*Ee)*ke,t[2]=(X*Ut-rt*Mt+Y*Tt)*ke,t[3]=(z*Mt-A*Ut-O*Tt)*ke,t[4]=(x*ue-f*Qe-w*_e)*ke,t[5]=(r*Qe-u*ue+c*_e)*ke,t[6]=(rt*xt-Z*Ut-Y*vt)*ke,t[7]=(I*Ut-z*xt+O*vt)*ke,t[8]=(f*le-y*ue+w*Jt)*ke,t[9]=(a*ue-r*le-c*Jt)*ke,t[10]=(Z*Mt-X*xt+Y*ct)*ke,t[11]=(A*xt-I*Mt-O*ct)*ke,t[12]=(y*_e-f*Ee-x*Jt)*ke,t[13]=(r*Ee-a*_e+u*Jt)*ke,t[14]=(X*vt-Z*Tt-rt*ct)*ke,t[15]=(I*Tt-A*vt+z*ct)*ke,t):null},l.isChar=Ht,l.isMapboxURL=Ve,l.keysDifference=function(t,e){var r=[];for(var a in t)a in e||r.push(a);return r},l.makeRequest=Yn,l.mapObject=gn,l.mercatorXfromLng=mp,l.mercatorYfromLat=yp,l.mercatorZfromAltitude=gp,l.mul=ql,l.multiply=Ti,l.mvt=eu,l.nextPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},l.normalize=function(t,e){var r=e[0],a=e[1],u=e[2],c=r*r+a*a+u*u;return c>0&&(c=1/Math.sqrt(c)),t[0]=e[0]*c,t[1]=e[1]*c,t[2]=e[2]*c,t},l.number=Hr,l.offscreenCanvasSupported=ii,l.ortho=function(t,e,r,a,u,c,f){var y=1/(e-r),x=1/(a-u),w=1/(c-f);return t[0]=-2*y,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*x,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*w,t[11]=0,t[12]=(e+r)*y,t[13]=(u+a)*x,t[14]=(f+c)*w,t[15]=1,t},l.parseGlyphPBF=function(t){return new ml(t).readFields(Kh,[])},l.pbf=ml,l.performSymbolLayout=function(t,e,r,a,u,c,f){t.createArrays(),t.tilePixelRatio=8192/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;var y=t.layers[0].layout,x=t.layers[0]._unevaluatedLayout._values,w={};if(t.textSizeData.kind==="composite"){var I=t.textSizeData,A=I.maxZoom;w.compositeTextSizes=[x["text-size"].possiblyEvaluate(new or(I.minZoom),f),x["text-size"].possiblyEvaluate(new or(A),f)]}if(t.iconSizeData.kind==="composite"){var z=t.iconSizeData,O=z.maxZoom;w.compositeIconSizes=[x["icon-size"].possiblyEvaluate(new or(z.minZoom),f),x["icon-size"].possiblyEvaluate(new or(O),f)]}w.layoutTextSize=x["text-size"].possiblyEvaluate(new or(t.zoom+1),f),w.layoutIconSize=x["icon-size"].possiblyEvaluate(new or(t.zoom+1),f),w.textMaxSize=x["text-size"].possiblyEvaluate(new or(18));for(var Z=24*y.get("text-line-height"),X=y.get("text-rotation-alignment")==="map"&&y.get("symbol-placement")!=="point",rt=y.get("text-keep-upright"),Y=y.get("text-size"),ct=function(){var Tt=xt[vt],Mt=y.get("text-font").evaluate(Tt,{},f).join(","),Ut=Y.evaluate(Tt,{},f),Jt=w.layoutTextSize.evaluate(Tt,{},f),_e=w.layoutIconSize.evaluate(Tt,{},f),ue={horizontal:{},vertical:void 0},Ee=Tt.text,le=[0,0];if(Ee){var Qe=Ee.toString(),ke=24*y.get("text-letter-spacing").evaluate(Tt,{},f),ge=function(ar){for(var Pr=0,Sr=ar;Pr<Sr.length;Pr+=1)if(dr=Sr[Pr].charCodeAt(0),Ht.Arabic(dr)||Ht["Arabic Supplement"](dr)||Ht["Arabic Extended-A"](dr)||Ht["Arabic Presentation Forms-A"](dr)||Ht["Arabic Presentation Forms-B"](dr))return!1;var dr;return!0}(Qe)?ke:0,nr=y.get("text-anchor").evaluate(Tt,{},f),Ge=y.get("text-variable-anchor");if(!Ge){var pr=y.get("text-radial-offset").evaluate(Tt,{},f);le=pr?op(nr,[24*pr,nc]):y.get("text-offset").evaluate(Tt,{},f).map(function(ar){return 24*ar})}var Se=X?"center":y.get("text-justify").evaluate(Tt,{},f),gr=y.get("symbol-placement"),jr=gr==="point"?24*y.get("text-max-width").evaluate(Tt,{},f):0,tn=function(){t.allowVerticalPlacement&&Cu(Qe)&&(ue.vertical=vl(Ee,e,r,u,Mt,jr,Z,nr,"left",ge,le,lo.vertical,!0,gr,Jt,Ut))};if(!X&&Ge){for(var Xr=Se==="auto"?Ge.map(function(ar){return ic(ar)}):[Se],qr=!1,en=0;en<Xr.length;en++){var Dn=Xr[en];if(!ue.horizontal[Dn])if(qr)ue.horizontal[Dn]=ue.horizontal[0];else{var Ln=vl(Ee,e,r,u,Mt,jr,Z,"center",Dn,ge,le,lo.horizontal,!1,gr,Jt,Ut);Ln&&(ue.horizontal[Dn]=Ln,qr=Ln.positionedLines.length===1)}}tn()}else{Se==="auto"&&(Se=ic(nr));var hi=vl(Ee,e,r,u,Mt,jr,Z,nr,Se,ge,le,lo.horizontal,!1,gr,Jt,Ut);hi&&(ue.horizontal[Se]=hi),tn(),Cu(Qe)&&X&&rt&&(ue.vertical=vl(Ee,e,r,u,Mt,jr,Z,nr,Se,ge,le,lo.vertical,!1,gr,Jt,Ut))}}var jn=void 0,fi=!1;if(Tt.icon&&Tt.icon.name){var un=a[Tt.icon.name];un&&(jn=function(ar,Pr,Sr){var dr=ec(Sr),Ci=Pr[0]-ar.displaySize[0]*dr.horizontalAlign,ei=Pr[1]-ar.displaySize[1]*dr.verticalAlign;return{image:ar,top:ei,bottom:ei+ar.displaySize[1],left:Ci,right:Ci+ar.displaySize[0]}}(u[Tt.icon.name],y.get("icon-offset").evaluate(Tt,{},f),y.get("icon-anchor").evaluate(Tt,{},f)),fi=un.sdf,t.sdfIcons===void 0?t.sdfIcons=un.sdf:t.sdfIcons!==un.sdf&&wr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(un.pixelRatio!==t.pixelRatio||y.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}var qn=sp(ue.horizontal)||ue.vertical;t.iconsInText=!!qn&&qn.iconsInText,(qn||jn)&&function(ar,Pr,Sr,dr,Ci,ei,Nr,yn,ri,vr,ga){var co=ei.textMaxSize.evaluate(Pr,{});co===void 0&&(co=Nr);var va,ln=ar.layers[0].layout,_a=ln.get("icon-offset").evaluate(Pr,{},ga),Ko=sp(Sr.horizontal),hu=Nr/24,Ms=ar.tilePixelRatio*hu,fu=ar.tilePixelRatio*co/24,Ua=ar.tilePixelRatio*yn,du=ar.tilePixelRatio*ln.get("symbol-spacing"),Al=ln.get("text-padding")*ar.tilePixelRatio,mu=ln.get("icon-padding")*ar.tilePixelRatio,Wu=ln.get("text-max-angle")/180*Math.PI,Pl=ln.get("text-rotation-alignment")==="map"&&ln.get("symbol-placement")!=="point",kl=ln.get("icon-rotation-alignment")==="map"&&ln.get("symbol-placement")!=="point",Va=ln.get("symbol-placement"),Hu=du/2,yu=ln.get("icon-text-fit");dr&&yu!=="none"&&(ar.allowVerticalPlacement&&Sr.vertical&&(va=Hc(dr,Sr.vertical,yu,ln.get("icon-text-fit-padding"),_a,hu)),Ko&&(dr=Hc(dr,Ko,yu,ln.get("icon-text-fit-padding"),_a,hu)));var ss=function(gf,nl){nl.x<0||nl.x>=8192||nl.y<0||nl.y>=8192||function(cn,ea,vf,us,fc,Sp,Rl,xa,Bl,il,Fl,Nl,dc,Tp,ol,Ip,Cp,Ap,Pp,kp,po,Ul,Mp,ba,_f){var zp,Ds,bu,wu,Eu,Su=cn.addToLineVertexArray(ea,vf),Dp=0,Lp=0,Op=0,Rp=0,mc=-1,yc=-1,ja={},Bp=q(""),gc=0,vc=0;if(xa._unevaluatedLayout.getValue("text-radial-offset")===void 0?(gc=(zp=xa.layout.get("text-offset").evaluate(po,{},ba).map(function(sl){return 24*sl}))[0],vc=zp[1]):(gc=24*xa.layout.get("text-radial-offset").evaluate(po,{},ba),vc=nc),cn.allowVerticalPlacement&&us.vertical){var Fp=xa.layout.get("text-rotate").evaluate(po,{},ba)+90;wu=new El(Bl,ea,il,Fl,Nl,us.vertical,dc,Tp,ol,Fp),Rl&&(Eu=new El(Bl,ea,il,Fl,Nl,Rl,Cp,Ap,ol,Fp))}if(fc){var _c=xa.layout.get("icon-rotate").evaluate(po,{}),Np=xa.layout.get("icon-text-fit")!=="none",Up=np(fc,_c,Mp,Np),xc=Rl?np(Rl,_c,Mp,Np):void 0;bu=new El(Bl,ea,il,Fl,Nl,fc,Cp,Ap,!1,_c),Dp=4*Up.length;var Vp=cn.iconSizeData,al=null;Vp.kind==="source"?(al=[128*xa.layout.get("icon-size").evaluate(po,{})])[0]>32640&&wr(cn.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):Vp.kind==="composite"&&((al=[128*Ul.compositeIconSizes[0].evaluate(po,{},ba),128*Ul.compositeIconSizes[1].evaluate(po,{},ba)])[0]>32640||al[1]>32640)&&wr(cn.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),cn.addSymbols(cn.icon,Up,al,kp,Pp,po,!1,ea,Su.lineStartIndex,Su.lineLength,-1,ba),mc=cn.icon.placedSymbolArray.length-1,xc&&(Lp=4*xc.length,cn.addSymbols(cn.icon,xc,al,kp,Pp,po,lo.vertical,ea,Su.lineStartIndex,Su.lineLength,-1,ba),yc=cn.icon.placedSymbolArray.length-1)}for(var jp in us.horizontal){var Vl=us.horizontal[jp];if(!Ds){Bp=q(Vl.text);var xf=xa.layout.get("text-rotate").evaluate(po,{},ba);Ds=new El(Bl,ea,il,Fl,Nl,Vl,dc,Tp,ol,xf)}var qp=Vl.positionedLines.length===1;if(Op+=ap(cn,ea,Vl,Sp,xa,ol,po,Ip,Su,us.vertical?lo.horizontal:lo.horizontalOnly,qp?Object.keys(us.horizontal):[jp],ja,mc,Ul,ba),qp)break}us.vertical&&(Rp+=ap(cn,ea,us.vertical,Sp,xa,ol,po,Ip,Su,lo.vertical,["vertical"],ja,yc,Ul,ba));var bf=Ds?Ds.boxStartIndex:cn.collisionBoxArray.length,wf=Ds?Ds.boxEndIndex:cn.collisionBoxArray.length,Ef=wu?wu.boxStartIndex:cn.collisionBoxArray.length,Sf=wu?wu.boxEndIndex:cn.collisionBoxArray.length,Tf=bu?bu.boxStartIndex:cn.collisionBoxArray.length,If=bu?bu.boxEndIndex:cn.collisionBoxArray.length,Cf=Eu?Eu.boxStartIndex:cn.collisionBoxArray.length,Af=Eu?Eu.boxEndIndex:cn.collisionBoxArray.length,wa=-1,jl=function(sl,Gp){return sl&&sl.circleDiameter?Math.max(sl.circleDiameter,Gp):Gp};wa=jl(Ds,wa),wa=jl(wu,wa),wa=jl(bu,wa);var Zp=(wa=jl(Eu,wa))>-1?1:0;Zp&&(wa*=_f/24),cn.glyphOffsetArray.length>=Ir.MAX_GLYPHS&&wr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),po.sortKey!==void 0&&cn.addToSortKeyRanges(cn.symbolInstances.length,po.sortKey),cn.symbolInstances.emplaceBack(ea.x,ea.y,ja.right>=0?ja.right:-1,ja.center>=0?ja.center:-1,ja.left>=0?ja.left:-1,ja.vertical||-1,mc,yc,Bp,bf,wf,Ef,Sf,Tf,If,Cf,Af,il,Op,Rp,Dp,Lp,Zp,0,dc,gc,vc,wa)}(ar,nl,gf,Sr,dr,Ci,va,ar.layers[0],ar.collisionBoxArray,Pr.index,Pr.sourceLayerIndex,ar.index,Ms,Al,Pl,ri,Ua,mu,kl,_a,Pr,ei,vr,ga,Nr)};if(Va==="line")for(var gu=0,Ml=rp(Pr.geometry,0,0,8192,8192);gu<Ml.length;gu+=1)for(var zl=Ml[gu],Ju=0,Yu=Qh(zl,du,Wu,Sr.vertical||Ko,dr,24,fu,ar.overscaling,8192);Ju<Yu.length;Ju+=1){var Dl=Yu[Ju];Ko&&nf(ar,Ko.text,Hu,Dl)||ss(zl,Dl)}else if(Va==="line-center")for(var $u=0,Qu=Pr.geometry;$u<Qu.length;$u+=1){var tl=Qu[$u];if(tl.length>1){var Ll=$h(tl,Wu,Sr.vertical||Ko,dr,24,fu);Ll&&ss(tl,Ll)}}else if(Pr.type==="Polygon")for(var vu=0,Ol=Jl(Pr.geometry,0);vu<Ol.length;vu+=1){var _u=Ol[vu],el=ef(_u,16);ss(_u[0],new ou(el.x,el.y,0))}else if(Pr.type==="LineString")for(var zs=0,rl=Pr.geometry;zs<rl.length;zs+=1){var xu=rl[zs];ss(xu,new ou(xu[0].x,xu[0].y,0))}else if(Pr.type==="Point")for(var cc=0,wp=Pr.geometry;cc<wp.length;cc+=1)for(var pc=0,Ep=wp[cc];pc<Ep.length;pc+=1){var hc=Ep[pc];ss([hc],new ou(hc.x,hc.y,0))}}(t,Tt,ue,jn,a,w,Jt,_e,le,fi,f)},vt=0,xt=t.features;vt<xt.length;vt+=1)ct();c&&t.generateCollisionDebugBuffers()},l.perspective=function(t,e,r,a,u){var c,f=1/Math.tan(e/2);return t[0]=f/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=f,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,u!=null&&u!==1/0?(t[10]=(u+a)*(c=1/(a-u)),t[14]=2*u*a*c):(t[10]=-1,t[14]=-2*a),t},l.pick=function(t,e){for(var r={},a=0;a<e.length;a++){var u=e[a];u in t&&(r[u]=t[u])}return r},l.plugin=Hi,l.polygonIntersectsPolygon=da,l.postMapLoadEvent=zi,l.postTurnstileEvent=fo,l.potpack=Gc,l.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],l.register=Qt,l.registerForPluginStateChange=function(t){return t({pluginStatus:Vi,pluginURL:Jo}),Pu.on("pluginStateChange",t),t},l.renderColorRamp=Ic,l.rotate=function(t,e,r){var a=e[0],u=e[1],c=e[2],f=e[3],y=Math.sin(r),x=Math.cos(r);return t[0]=a*x+c*y,t[1]=u*x+f*y,t[2]=a*-y+c*x,t[3]=u*-y+f*x,t},l.rotateX=function(t,e,r){var a=Math.sin(r),u=Math.cos(r),c=e[4],f=e[5],y=e[6],x=e[7],w=e[8],I=e[9],A=e[10],z=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=c*u+w*a,t[5]=f*u+I*a,t[6]=y*u+A*a,t[7]=x*u+z*a,t[8]=w*u-c*a,t[9]=I*u-f*a,t[10]=A*u-y*a,t[11]=z*u-x*a,t},l.rotateZ=function(t,e,r){var a=Math.sin(r),u=Math.cos(r),c=e[0],f=e[1],y=e[2],x=e[3],w=e[4],I=e[5],A=e[6],z=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=c*u+w*a,t[1]=f*u+I*a,t[2]=y*u+A*a,t[3]=x*u+z*a,t[4]=w*u-c*a,t[5]=I*u-f*a,t[6]=A*u-y*a,t[7]=z*u-x*a,t},l.scale=function(t,e,r){var a=r[0],u=r[1],c=r[2];return t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t[3]=e[3]*a,t[4]=e[4]*u,t[5]=e[5]*u,t[6]=e[6]*u,t[7]=e[7]*u,t[8]=e[8]*c,t[9]=e[9]*c,t[10]=e[10]*c,t[11]=e[11]*c,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},l.scale$1=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t},l.scale$2=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t},l.setCacheLimits=function(t,e){Di=t,Pn=e},l.setRTLTextPlugin=function(t,e,r){if(r===void 0&&(r=!1),Vi==="deferred"||Vi==="loading"||Vi==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");Jo=vi.resolveURL(t),Vi="deferred",Gs=e,_s(),r||Ao()},l.sphericalToCartesian=function(t){var e=t[0],r=t[1],a=t[2];return r+=90,r*=Math.PI/180,a*=Math.PI/180,{x:e*Math.cos(r)*Math.sin(a),y:e*Math.sin(r)*Math.sin(a),z:e*Math.cos(a)}},l.sqrLen=function(t){var e=t[0],r=t[1];return e*e+r*r},l.styleSpec=L,l.sub=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t},l.symbolSize=Yh,l.transformMat3=function(t,e,r){var a=e[0],u=e[1],c=e[2];return t[0]=a*r[0]+u*r[3]+c*r[6],t[1]=a*r[1]+u*r[4]+c*r[7],t[2]=a*r[2]+u*r[5]+c*r[8],t},l.transformMat4=Ys,l.translate=function(t,e,r){var a,u,c,f,y,x,w,I,A,z,O,Z,X=r[0],rt=r[1],Y=r[2];return e===t?(t[12]=e[0]*X+e[4]*rt+e[8]*Y+e[12],t[13]=e[1]*X+e[5]*rt+e[9]*Y+e[13],t[14]=e[2]*X+e[6]*rt+e[10]*Y+e[14],t[15]=e[3]*X+e[7]*rt+e[11]*Y+e[15]):(u=e[1],c=e[2],f=e[3],y=e[4],x=e[5],w=e[6],I=e[7],A=e[8],z=e[9],O=e[10],Z=e[11],t[0]=a=e[0],t[1]=u,t[2]=c,t[3]=f,t[4]=y,t[5]=x,t[6]=w,t[7]=I,t[8]=A,t[9]=z,t[10]=O,t[11]=Z,t[12]=a*X+y*rt+A*Y+e[12],t[13]=u*X+x*rt+z*Y+e[13],t[14]=c*X+w*rt+O*Y+e[14],t[15]=f*X+I*rt+Z*Y+e[15]),t},l.triggerPluginCompletionEvent=ul,l.uniqueId=Lr,l.validateCustomStyleLayer=function(t){var e=[],r=t.id;return r===void 0&&e.push({message:"layers."+r+': missing required property "id"'}),t.render===void 0&&e.push({message:"layers."+r+': missing required method "render"'}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&e.push({message:"layers."+r+': property "renderingMode" must be either "2d" or "3d"'}),e},l.validateLight=he,l.validateStyle=$t,l.values=function(t){var e=[];for(var r in t)e.push(t[r]);return e},l.vectorTile=eu,l.version="1.13.3",l.warnOnce=wr,l.webpSupported=vn,l.window=Xt,l.wrap=ir}),pn(["./shared"],function(l){function sr(C){var M=typeof C;if(M==="number"||M==="boolean"||M==="string"||C==null)return JSON.stringify(C);if(Array.isArray(C)){for(var D="[",U=0,G=C;U<G.length;U+=1)D+=sr(G[U])+",";return D+"]"}for(var nt=Object.keys(C).sort(),$="{",L=0;L<nt.length;L++)$+=JSON.stringify(nt[L])+":"+sr(C[nt[L]])+",";return $+"}"}function Ot(C){for(var M="",D=0,U=l.refProperties;D<U.length;D+=1)M+="/"+sr(C[U[D]]);return M}var Br=function(C){this.keyCache={},C&&this.replace(C)};Br.prototype.replace=function(C){this._layerConfigs={},this._layers={},this.update(C,[])},Br.prototype.update=function(C,M){for(var D=this,U=0,G=C;U<G.length;U+=1){var nt=G[U];this._layerConfigs[nt.id]=nt;var $=this._layers[nt.id]=l.createStyleLayer(nt);$._featureFilter=l.featureFilter($.filter),this.keyCache[nt.id]&&delete this.keyCache[nt.id]}for(var L=0,J=M;L<J.length;L+=1){var st=J[L];delete this.keyCache[st],delete this._layerConfigs[st],delete this._layers[st]}this.familiesBySource={};for(var zt=0,Bt=function(jt,Yt){for(var Re={},te=0;te<jt.length;te++){var Ye=Yt&&Yt[jt[te].id]||Ot(jt[te]);Yt&&(Yt[jt[te].id]=Ye);var Fe=Re[Ye];Fe||(Fe=Re[Ye]=[]),Fe.push(jt[te])}var Ne=[];for(var He in Re)Ne.push(Re[He]);return Ne}(l.values(this._layerConfigs),this.keyCache);zt<Bt.length;zt+=1){var Et=Bt[zt].map(function(jt){return D._layers[jt.id]}),kt=Et[0];if(kt.visibility!=="none"){var oe=kt.source||"",Wt=this.familiesBySource[oe];Wt||(Wt=this.familiesBySource[oe]={});var St=kt.sourceLayer||"_geojsonTileLayer",ie=Wt[St];ie||(ie=Wt[St]=[]),ie.push(Et)}}};var Oe=function(C){var M={},D=[];for(var U in C){var G=C[U],nt=M[U]={};for(var $ in G){var L=G[+$];if(L&&L.bitmap.width!==0&&L.bitmap.height!==0){var J={x:0,y:0,w:L.bitmap.width+2,h:L.bitmap.height+2};D.push(J),nt[$]={rect:J,metrics:L.metrics}}}}var st=l.potpack(D),zt=new l.AlphaImage({width:st.w||1,height:st.h||1});for(var Bt in C){var Et=C[Bt];for(var kt in Et){var oe=Et[+kt];if(oe&&oe.bitmap.width!==0&&oe.bitmap.height!==0){var Wt=M[Bt][kt].rect;l.AlphaImage.copy(oe.bitmap,zt,{x:0,y:0},{x:Wt.x+1,y:Wt.y+1},oe.bitmap)}}}this.image=zt,this.positions=M};l.register("GlyphAtlas",Oe);var Ur=function(C){this.tileID=new l.OverscaledTileID(C.tileID.overscaledZ,C.tileID.wrap,C.tileID.canonical.z,C.tileID.canonical.x,C.tileID.canonical.y),this.uid=C.uid,this.zoom=C.zoom,this.pixelRatio=C.pixelRatio,this.tileSize=C.tileSize,this.source=C.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=C.showCollisionBoxes,this.collectResourceTiming=!!C.collectResourceTiming,this.returnDependencies=!!C.returnDependencies,this.promoteId=C.promoteId};function Xt(C,M,D){for(var U=new l.EvaluationParameters(M),G=0,nt=C;G<nt.length;G+=1)nt[G].recalculate(U,D)}function On(C,M){var D=l.getArrayBuffer(C.request,function(U,G,nt,$){U?M(U):G&&M(null,{vectorTile:new l.vectorTile.VectorTile(new l.pbf(G)),rawData:G,cacheControl:nt,expires:$})});return function(){D.cancel(),M()}}Ur.prototype.parse=function(C,M,D,U,G){var nt=this;this.status="parsing",this.data=C,this.collisionBoxArray=new l.CollisionBoxArray;var $=new l.DictionaryCoder(Object.keys(C.layers).sort()),L=new l.FeatureIndex(this.tileID,this.promoteId);L.bucketLayerIDs=[];var J,st,zt,Bt,Et={},kt={featureIndex:L,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:D},oe=M.familiesBySource[this.source];for(var Wt in oe){var St=C.layers[Wt];if(St){St.version===1&&l.warnOnce('Vector tile source "'+this.source+'" layer "'+Wt+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var ie=$.encode(Wt),jt=[],Yt=0;Yt<St.length;Yt++){var Re=St.feature(Yt),te=L.getId(Re,Wt);jt.push({feature:Re,id:te,index:Yt,sourceLayerIndex:ie})}for(var Ye=0,Fe=oe[Wt];Ye<Fe.length;Ye+=1){var Ne=Fe[Ye],He=Ne[0];He.minzoom&&this.zoom<Math.floor(He.minzoom)||He.maxzoom&&this.zoom>=He.maxzoom||He.visibility!=="none"&&(Xt(Ne,this.zoom,D),(Et[He.id]=He.createBucket({index:L.bucketLayerIDs.length,layers:Ne,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ie,sourceID:this.source})).populate(jt,kt,this.tileID.canonical),L.bucketLayerIDs.push(Ne.map(function(yr){return yr.id})))}}}var er=l.mapObject(kt.glyphDependencies,function(yr){return Object.keys(yr).map(Number)});Object.keys(er).length?U.send("getGlyphs",{uid:this.uid,stacks:er},function(yr,Ze){J||(J=yr,st=Ze,kr.call(nt))}):st={};var Zr=Object.keys(kt.iconDependencies);Zr.length?U.send("getImages",{icons:Zr,source:this.source,tileID:this.tileID,type:"icons"},function(yr,Ze){J||(J=yr,zt=Ze,kr.call(nt))}):zt={};var ur=Object.keys(kt.patternDependencies);function kr(){if(J)return G(J);if(st&&zt&&Bt){var yr=new Oe(st),Ze=new l.ImageAtlas(zt,Bt);for(var lr in Et){var Gr=Et[lr];Gr instanceof l.SymbolBucket?(Xt(Gr.layers,this.zoom,D),l.performSymbolLayout(Gr,st,yr.positions,zt,Ze.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):Gr.hasPattern&&(Gr instanceof l.LineBucket||Gr instanceof l.FillBucket||Gr instanceof l.FillExtrusionBucket)&&(Xt(Gr.layers,this.zoom,D),Gr.addFeatures(kt,this.tileID.canonical,Ze.patternPositions))}this.status="done",G(null,{buckets:l.values(Et).filter(function(v){return!v.isEmpty()}),featureIndex:L,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:yr.image,imageAtlas:Ze,glyphMap:this.returnDependencies?st:null,iconMap:this.returnDependencies?zt:null,glyphPositions:this.returnDependencies?yr.positions:null})}}ur.length?U.send("getImages",{icons:ur,source:this.source,tileID:this.tileID,type:"patterns"},function(yr,Ze){J||(J=yr,Bt=Ze,kr.call(nt))}):Bt={},kr.call(this)};var rr=function(C,M,D,U){this.actor=C,this.layerIndex=M,this.availableImages=D,this.loadVectorData=U||On,this.loading={},this.loaded={}};rr.prototype.loadTile=function(C,M){var D=this,U=C.uid;this.loading||(this.loading={});var G=!!(C&&C.request&&C.request.collectResourceTiming)&&new l.RequestPerformance(C.request),nt=this.loading[U]=new Ur(C);nt.abort=this.loadVectorData(C,function($,L){if(delete D.loading[U],$||!L)return nt.status="done",D.loaded[U]=nt,M($);var J=L.rawData,st={};L.expires&&(st.expires=L.expires),L.cacheControl&&(st.cacheControl=L.cacheControl);var zt={};if(G){var Bt=G.finish();Bt&&(zt.resourceTiming=JSON.parse(JSON.stringify(Bt)))}nt.vectorTile=L.vectorTile,nt.parse(L.vectorTile,D.layerIndex,D.availableImages,D.actor,function(Et,kt){if(Et||!kt)return M(Et);M(null,l.extend({rawTileData:J.slice(0)},kt,st,zt))}),D.loaded=D.loaded||{},D.loaded[U]=nt})},rr.prototype.reloadTile=function(C,M){var D=this,U=this.loaded,G=C.uid,nt=this;if(U&&U[G]){var $=U[G];$.showCollisionBoxes=C.showCollisionBoxes;var L=function(J,st){var zt=$.reloadCallback;zt&&(delete $.reloadCallback,$.parse($.vectorTile,nt.layerIndex,D.availableImages,nt.actor,zt)),M(J,st)};$.status==="parsing"?$.reloadCallback=L:$.status==="done"&&($.vectorTile?$.parse($.vectorTile,this.layerIndex,this.availableImages,this.actor,L):L())}},rr.prototype.abortTile=function(C,M){var D=this.loading,U=C.uid;D&&D[U]&&D[U].abort&&(D[U].abort(),delete D[U]),M()},rr.prototype.removeTile=function(C,M){var D=this.loaded,U=C.uid;D&&D[U]&&delete D[U],M()};var Dr=l.window.ImageBitmap,ve=function(){this.loaded={}};function ir(C,M){if(C.length!==0){hr(C[0],M);for(var D=1;D<C.length;D++)hr(C[D],!M)}}function hr(C,M){for(var D=0,U=0,G=0,nt=C.length,$=nt-1;G<nt;$=G++){var L=(C[G][0]-C[$][0])*(C[$][1]+C[G][1]),J=D+L;U+=Math.abs(D)>=Math.abs(L)?D-J+L:L-J+D,D=J}D+U>=0!=!!M&&C.reverse()}ve.prototype.loadTile=function(C,M){var D=C.uid,U=C.encoding,G=C.rawImageData,nt=Dr&&G instanceof Dr?this.getImageData(G):G,$=new l.DEMData(D,nt,U);this.loaded=this.loaded||{},this.loaded[D]=$,M(null,$)},ve.prototype.getImageData=function(C){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(C.width,C.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=C.width,this.offscreenCanvas.height=C.height,this.offscreenCanvasContext.drawImage(C,0,0,C.width,C.height);var M=this.offscreenCanvasContext.getImageData(-1,-1,C.width+2,C.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new l.RGBAImage({width:M.width,height:M.height},M.data)},ve.prototype.removeTile=function(C){var M=this.loaded,D=C.uid;M&&M[D]&&delete M[D]};var Gi=l.vectorTile.VectorTileFeature.prototype.toGeoJSON,Lr=function(C){this._feature=C,this.extent=l.EXTENT,this.type=C.type,this.properties=C.tags,"id"in C&&!isNaN(C.id)&&(this.id=parseInt(C.id,10))};Lr.prototype.loadGeometry=function(){if(this._feature.type===1){for(var C=[],M=0,D=this._feature.geometry;M<D.length;M+=1){var U=D[M];C.push([new l.Point$1(U[0],U[1])])}return C}for(var G=[],nt=0,$=this._feature.geometry;nt<$.length;nt+=1){for(var L=[],J=0,st=$[nt];J<st.length;J+=1){var zt=st[J];L.push(new l.Point$1(zt[0],zt[1]))}G.push(L)}return G},Lr.prototype.toGeoJSON=function(C,M,D){return Gi.call(this,C,M,D)};var Cr=function(C){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=l.EXTENT,this.length=C.length,this._features=C};Cr.prototype.feature=function(C){return new Lr(this._features[C])};var Rn=l.vectorTile.VectorTileFeature,Wr=Ai;function Ai(C,M){this.options=M||{},this.features=C,this.length=C.length}function gn(C,M){this.id=typeof C.id=="number"?C.id:void 0,this.type=C.type,this.rawGeometry=C.type===1?[C.geometry]:C.geometry,this.properties=C.tags,this.extent=M||4096}Ai.prototype.feature=function(C){return new gn(this.features[C],this.options.extent)},gn.prototype.loadGeometry=function(){var C=this.rawGeometry;this.geometry=[];for(var M=0;M<C.length;M++){for(var D=C[M],U=[],G=0;G<D.length;G++)U.push(new l.Point$1(D[G][0],D[G][1]));this.geometry.push(U)}return this.geometry},gn.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var C=this.geometry,M=1/0,D=-1/0,U=1/0,G=-1/0,nt=0;nt<C.length;nt++)for(var $=C[nt],L=0;L<$.length;L++){var J=$[L];M=Math.min(M,J.x),D=Math.max(D,J.x),U=Math.min(U,J.y),G=Math.max(G,J.y)}return[M,U,D,G]},gn.prototype.toGeoJSON=Rn.prototype.toGeoJSON;var di=mi,ni=Wr;function mi(C){var M=new l.pbf;return function(D,U){for(var G in D.layers)U.writeMessage(3,wr,D.layers[G])}(C,M),M.finish()}function wr(C,M){var D;M.writeVarintField(15,C.version||1),M.writeStringField(1,C.name||""),M.writeVarintField(5,C.extent||4096);var U={keys:[],values:[],keycache:{},valuecache:{}};for(D=0;D<C.length;D++)U.feature=C.feature(D),M.writeMessage(2,Or,U);var G=U.keys;for(D=0;D<G.length;D++)M.writeStringField(3,G[D]);var nt=U.values;for(D=0;D<nt.length;D++)M.writeMessage(4,yi,nt[D])}function Or(C,M){var D=C.feature;D.id!==void 0&&M.writeVarintField(1,D.id),M.writeMessage(2,Lo,C),M.writeVarintField(3,D.type),M.writeMessage(4,Bn,D)}function Lo(C,M){var D=C.feature,U=C.keys,G=C.values,nt=C.keycache,$=C.valuecache;for(var L in D.properties){var J=nt[L];J===void 0&&(U.push(L),nt[L]=J=U.length-1),M.writeVarint(J);var st=D.properties[L],zt=typeof st;zt!=="string"&&zt!=="boolean"&&zt!=="number"&&(st=JSON.stringify(st));var Bt=zt+":"+st,Et=$[Bt];Et===void 0&&(G.push(st),$[Bt]=Et=G.length-1),M.writeVarint(Et)}}function hn(C,M){return(M<<3)+(7&C)}function ho(C){return C<<1^C>>31}function Bn(C,M){for(var D=C.loadGeometry(),U=C.type,G=0,nt=0,$=D.length,L=0;L<$;L++){var J=D[L],st=1;U===1&&(st=J.length),M.writeVarint(hn(1,st));for(var zt=U===3?J.length-1:J.length,Bt=0;Bt<zt;Bt++){Bt===1&&U!==1&&M.writeVarint(hn(2,zt-1));var Et=J[Bt].x-G,kt=J[Bt].y-nt;M.writeVarint(ho(Et)),M.writeVarint(ho(kt)),G+=Et,nt+=kt}U===3&&M.writeVarint(hn(7,1))}}function yi(C,M){var D=typeof C;D==="string"?M.writeStringField(1,C):D==="boolean"?M.writeBooleanField(7,C):D==="number"&&(C%1!=0?M.writeDoubleField(3,C):C<0?M.writeSVarintField(6,C):M.writeVarintField(5,C))}function Cn(C,M,D,U){Wn(C,D,U),Wn(M,2*D,2*U),Wn(M,2*D+1,2*U+1)}function Wn(C,M,D){var U=C[M];C[M]=C[D],C[D]=U}function Pi(C,M,D,U){var G=C-D,nt=M-U;return G*G+nt*nt}di.fromVectorTileJs=mi,di.fromGeojsonVt=function(C,M){M=M||{};var D={};for(var U in C)D[U]=new Wr(C[U].features,M),D[U].name=U,D[U].version=M.version,D[U].extent=M.extent;return mi({layers:D})},di.GeoJSONWrapper=ni;var Zn=function(C){return C[0]},$i=function(C){return C[1]},gi=function(C,M,D,U,G){M===void 0&&(M=Zn),D===void 0&&(D=$i),U===void 0&&(U=64),G===void 0&&(G=Float64Array),this.nodeSize=U,this.points=C;for(var nt=C.length<65536?Uint16Array:Uint32Array,$=this.ids=new nt(C.length),L=this.coords=new G(2*C.length),J=0;J<C.length;J++)$[J]=J,L[2*J]=M(C[J]),L[2*J+1]=D(C[J]);(function st(zt,Bt,Et,kt,oe,Wt){if(!(oe-kt<=Et)){var St=kt+oe>>1;(function ie(jt,Yt,Re,te,Ye,Fe){for(;Ye>te;){if(Ye-te>600){var Ne=Ye-te+1,He=Re-te+1,er=Math.log(Ne),Zr=.5*Math.exp(2*er/3),ur=.5*Math.sqrt(er*Zr*(Ne-Zr)/Ne)*(He-Ne/2<0?-1:1);ie(jt,Yt,Re,Math.max(te,Math.floor(Re-He*Zr/Ne+ur)),Math.min(Ye,Math.floor(Re+(Ne-He)*Zr/Ne+ur)),Fe)}var kr=Yt[2*Re+Fe],yr=te,Ze=Ye;for(Cn(jt,Yt,te,Re),Yt[2*Ye+Fe]>kr&&Cn(jt,Yt,te,Ye);yr<Ze;){for(Cn(jt,Yt,yr,Ze),yr++,Ze--;Yt[2*yr+Fe]<kr;)yr++;for(;Yt[2*Ze+Fe]>kr;)Ze--}Yt[2*te+Fe]===kr?Cn(jt,Yt,te,Ze):Cn(jt,Yt,++Ze,Ye),Ze<=Re&&(te=Ze+1),Re<=Ze&&(Ye=Ze-1)}})(zt,Bt,St,kt,oe,Wt%2),st(zt,Bt,Et,kt,St-1,Wt+1),st(zt,Bt,Et,St+1,oe,Wt+1)}})($,L,U,0,$.length-1,0)};gi.prototype.range=function(C,M,D,U){return function(G,nt,$,L,J,st,zt){for(var Bt,Et,kt=[0,G.length-1,0],oe=[];kt.length;){var Wt=kt.pop(),St=kt.pop(),ie=kt.pop();if(St-ie<=zt)for(var jt=ie;jt<=St;jt++)Et=nt[2*jt+1],(Bt=nt[2*jt])>=$&&Bt<=J&&Et>=L&&Et<=st&&oe.push(G[jt]);else{var Yt=Math.floor((ie+St)/2);Et=nt[2*Yt+1],(Bt=nt[2*Yt])>=$&&Bt<=J&&Et>=L&&Et<=st&&oe.push(G[Yt]);var Re=(Wt+1)%2;(Wt===0?$<=Bt:L<=Et)&&(kt.push(ie),kt.push(Yt-1),kt.push(Re)),(Wt===0?J>=Bt:st>=Et)&&(kt.push(Yt+1),kt.push(St),kt.push(Re))}}return oe}(this.ids,this.coords,C,M,D,U,this.nodeSize)},gi.prototype.within=function(C,M,D){return function(U,G,nt,$,L,J){for(var st=[0,U.length-1,0],zt=[],Bt=L*L;st.length;){var Et=st.pop(),kt=st.pop(),oe=st.pop();if(kt-oe<=J)for(var Wt=oe;Wt<=kt;Wt++)Pi(G[2*Wt],G[2*Wt+1],nt,$)<=Bt&&zt.push(U[Wt]);else{var St=Math.floor((oe+kt)/2),ie=G[2*St],jt=G[2*St+1];Pi(ie,jt,nt,$)<=Bt&&zt.push(U[St]);var Yt=(Et+1)%2;(Et===0?nt-L<=ie:$-L<=jt)&&(st.push(oe),st.push(St-1),st.push(Yt)),(Et===0?nt+L>=ie:$+L>=jt)&&(st.push(St+1),st.push(kt),st.push(Yt))}}return zt}(this.ids,this.coords,C,M,D,this.nodeSize)};var ki={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(C){return C}},fn=function(C){this.options=_i(Object.create(ki),C),this.trees=new Array(this.options.maxZoom+1)};function vi(C,M,D,U,G){return{x:C,y:M,zoom:1/0,id:D,parentId:-1,numPoints:U,properties:G}}function Kt(C,M){var D=C.geometry.coordinates,U=D[1];return{x:qe(D[0]),y:We(U),zoom:1/0,index:M,parentId:-1}}function vn(C){return{type:"Feature",id:C.id,properties:_n(C),geometry:{type:"Point",coordinates:[(U=C.x,360*(U-.5)),(M=C.y,D=(180-360*M)*Math.PI/180,360*Math.atan(Math.exp(D))/Math.PI-90)]}};var M,D,U}function _n(C){var M=C.numPoints,D=M>=1e4?Math.round(M/1e3)+"k":M>=1e3?Math.round(M/100)/10+"k":M;return _i(_i({},C.properties),{cluster:!0,cluster_id:C.id,point_count:M,point_count_abbreviated:D})}function qe(C){return C/360+.5}function We(C){var M=Math.sin(C*Math.PI/180),D=.5-.25*Math.log((1+M)/(1-M))/Math.PI;return D<0?0:D>1?1:D}function _i(C,M){for(var D in M)C[D]=M[D];return C}function mr(C){return C.x}function Ve(C){return C.y}function ra(C,M,D,U,G,nt){var $=G-D,L=nt-U;if($!==0||L!==0){var J=((C-D)*$+(M-U)*L)/($*$+L*L);J>1?(D=G,U=nt):J>0&&(D+=$*J,U+=L*J)}return($=C-D)*$+(L=M-U)*L}function xi(C,M,D,U){var G={id:C===void 0?null:C,type:M,geometry:D,tags:U,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(nt){var $=nt.geometry,L=nt.type;if(L==="Point"||L==="MultiPoint"||L==="LineString")Xo(nt,$);else if(L==="Polygon"||L==="MultiLineString")for(var J=0;J<$.length;J++)Xo(nt,$[J]);else if(L==="MultiPolygon")for(J=0;J<$.length;J++)for(var st=0;st<$[J].length;st++)Xo(nt,$[J][st])}(G),G}function Xo(C,M){for(var D=0;D<M.length;D+=3)C.minX=Math.min(C.minX,M[D]),C.minY=Math.min(C.minY,M[D+1]),C.maxX=Math.max(C.maxX,M[D]),C.maxY=Math.max(C.maxY,M[D+1])}function dn(C,M,D,U){if(M.geometry){var G=M.geometry.coordinates,nt=M.geometry.type,$=Math.pow(D.tolerance/((1<<D.maxZoom)*D.extent),2),L=[],J=M.id;if(D.promoteId?J=M.properties[D.promoteId]:D.generateId&&(J=U||0),nt==="Point")An(G,L);else if(nt==="MultiPoint")for(var st=0;st<G.length;st++)An(G[st],L);else if(nt==="LineString")_r(G,L,$,!1);else if(nt==="MultiLineString"){if(D.lineMetrics){for(st=0;st<G.length;st++)_r(G[st],L=[],$,!1),C.push(xi(J,"LineString",L,M.properties));return}xn(G,L,$,!1)}else if(nt==="Polygon")xn(G,L,$,!0);else{if(nt!=="MultiPolygon"){if(nt==="GeometryCollection"){for(st=0;st<M.geometry.geometries.length;st++)dn(C,{id:J,geometry:M.geometry.geometries[st],properties:M.properties},D,U);return}throw new Error("Input data is not a valid GeoJSON object.")}for(st=0;st<G.length;st++){var zt=[];xn(G[st],zt,$,!0),L.push(zt)}}C.push(xi(J,nt,L,M.properties))}}function An(C,M){M.push(Hn(C[0])),M.push(bi(C[1])),M.push(0)}function _r(C,M,D,U){for(var G,nt,$=0,L=0;L<C.length;L++){var J=Hn(C[L][0]),st=bi(C[L][1]);M.push(J),M.push(st),M.push(0),L>0&&($+=U?(G*st-J*nt)/2:Math.sqrt(Math.pow(J-G,2)+Math.pow(st-nt,2))),G=J,nt=st}var zt=M.length-3;M[2]=1,function Bt(Et,kt,oe,Wt){for(var St,ie=Wt,jt=oe-kt>>1,Yt=oe-kt,Re=Et[kt],te=Et[kt+1],Ye=Et[oe],Fe=Et[oe+1],Ne=kt+3;Ne<oe;Ne+=3){var He=ra(Et[Ne],Et[Ne+1],Re,te,Ye,Fe);if(He>ie)St=Ne,ie=He;else if(He===ie){var er=Math.abs(Ne-jt);er<Yt&&(St=Ne,Yt=er)}}ie>Wt&&(St-kt>3&&Bt(Et,kt,St,Wt),Et[St+2]=ie,oe-St>3&&Bt(Et,St,oe,Wt))}(M,0,zt,D),M[zt+2]=1,M.size=Math.abs($),M.start=0,M.end=M.size}function xn(C,M,D,U){for(var G=0;G<C.length;G++){var nt=[];_r(C[G],nt,D,U),M.push(nt)}}function Hn(C){return C/360+.5}function bi(C){var M=Math.sin(C*Math.PI/180),D=.5-.25*Math.log((1+M)/(1-M))/Math.PI;return D<0?0:D>1?1:D}function rn(C,M,D,U,G,nt,$,L){if(U/=M,nt>=(D/=M)&&$<U)return C;if($<D||nt>=U)return null;for(var J=[],st=0;st<C.length;st++){var zt=C[st],Bt=zt.geometry,Et=zt.type,kt=G===0?zt.minX:zt.minY,oe=G===0?zt.maxX:zt.maxY;if(kt>=D&&oe<U)J.push(zt);else if(!(oe<D||kt>=U)){var Wt=[];if(Et==="Point"||Et==="MultiPoint")Gn(Bt,Wt,D,U,G);else if(Et==="LineString")fo(Bt,Wt,D,U,G,!1,L.lineMetrics);else if(Et==="MultiLineString")zi(Bt,Wt,D,U,G,!1);else if(Et==="Polygon")zi(Bt,Wt,D,U,G,!0);else if(Et==="MultiPolygon")for(var St=0;St<Bt.length;St++){var ie=[];zi(Bt[St],ie,D,U,G,!0),ie.length&&Wt.push(ie)}if(Wt.length){if(L.lineMetrics&&Et==="LineString"){for(St=0;St<Wt.length;St++)J.push(xi(zt.id,Et,Wt[St],zt.tags));continue}Et!=="LineString"&&Et!=="MultiLineString"||(Wt.length===1?(Et="LineString",Wt=Wt[0]):Et="MultiLineString"),Et!=="Point"&&Et!=="MultiPoint"||(Et=Wt.length===3?"Point":"MultiPoint"),J.push(xi(zt.id,Et,Wt,zt.tags))}}}return J.length?J:null}function Gn(C,M,D,U,G){for(var nt=0;nt<C.length;nt+=3){var $=C[nt+G];$>=D&&$<=U&&(M.push(C[nt]),M.push(C[nt+1]),M.push(C[nt+2]))}}function fo(C,M,D,U,G,nt,$){for(var L,J,st=Mi(C),zt=G===0?Pn:wi,Bt=C.start,Et=0;Et<C.length-3;Et+=3){var kt=C[Et],oe=C[Et+1],Wt=C[Et+2],St=C[Et+3],ie=C[Et+4],jt=G===0?kt:oe,Yt=G===0?St:ie,Re=!1;$&&(L=Math.sqrt(Math.pow(kt-St,2)+Math.pow(oe-ie,2))),jt<D?Yt>D&&(J=zt(st,kt,oe,St,ie,D),$&&(st.start=Bt+L*J)):jt>U?Yt<U&&(J=zt(st,kt,oe,St,ie,U),$&&(st.start=Bt+L*J)):Di(st,kt,oe,Wt),Yt<D&&jt>=D&&(J=zt(st,kt,oe,St,ie,D),Re=!0),Yt>U&&jt<=U&&(J=zt(st,kt,oe,St,ie,U),Re=!0),!nt&&Re&&($&&(st.end=Bt+L*J),M.push(st),st=Mi(C)),$&&(Bt+=L)}var te=C.length-3;kt=C[te],oe=C[te+1],Wt=C[te+2],(jt=G===0?kt:oe)>=D&&jt<=U&&Di(st,kt,oe,Wt),te=st.length-3,nt&&te>=3&&(st[te]!==st[0]||st[te+1]!==st[1])&&Di(st,st[0],st[1],st[2]),st.length&&M.push(st)}function Mi(C){var M=[];return M.size=C.size,M.start=C.start,M.end=C.end,M}function zi(C,M,D,U,G,nt){for(var $=0;$<C.length;$++)fo(C[$],M,D,U,G,nt,!1)}function Di(C,M,D,U){C.push(M),C.push(D),C.push(U)}function Pn(C,M,D,U,G,nt){var $=(nt-M)/(U-M);return C.push(nt),C.push(D+(G-D)*$),C.push(1),$}function wi(C,M,D,U,G,nt){var $=(nt-D)/(G-D);return C.push(M+(U-M)*$),C.push(nt),C.push(1),$}function Li(C,M){for(var D=[],U=0;U<C.length;U++){var G,nt=C[U],$=nt.type;if($==="Point"||$==="MultiPoint"||$==="LineString")G=kn(nt.geometry,M);else if($==="MultiLineString"||$==="Polygon"){G=[];for(var L=0;L<nt.geometry.length;L++)G.push(kn(nt.geometry[L],M))}else if($==="MultiPolygon")for(G=[],L=0;L<nt.geometry.length;L++){for(var J=[],st=0;st<nt.geometry[L].length;st++)J.push(kn(nt.geometry[L][st],M));G.push(J)}D.push(xi(nt.id,$,G,nt.tags))}return D}function kn(C,M){var D=[];D.size=C.size,C.start!==void 0&&(D.start=C.start,D.end=C.end);for(var U=0;U<C.length;U+=3)D.push(C[U]+M,C[U+1],C[U+2]);return D}function xe(C,M){if(C.transformed)return C;var D,U,G,nt=1<<C.z,$=C.x,L=C.y;for(D=0;D<C.features.length;D++){var J=C.features[D],st=J.geometry,zt=J.type;if(J.geometry=[],zt===1)for(U=0;U<st.length;U+=2)J.geometry.push(ii(st[U],st[U+1],M,nt,$,L));else for(U=0;U<st.length;U++){var Bt=[];for(G=0;G<st[U].length;G+=2)Bt.push(ii(st[U][G],st[U][G+1],M,nt,$,L));J.geometry.push(Bt)}}return C.transformed=!0,C}function ii(C,M,D,U,G,nt){return[Math.round(D*(C*U-G)),Math.round(D*(M*U-nt))]}function Jn(C,M,D,U,G){for(var nt=M===G.maxZoom?0:G.tolerance/((1<<M)*G.extent),$={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:D,y:U,z:M,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},L=0;L<C.length;L++){$.numFeatures++,Oi($,C[L],nt,G);var J=C[L].minX,st=C[L].minY,zt=C[L].maxX,Bt=C[L].maxY;J<$.minX&&($.minX=J),st<$.minY&&($.minY=st),zt>$.maxX&&($.maxX=zt),Bt>$.maxY&&($.maxY=Bt)}return $}function Oi(C,M,D,U){var G=M.geometry,nt=M.type,$=[];if(nt==="Point"||nt==="MultiPoint")for(var L=0;L<G.length;L+=3)$.push(G[L]),$.push(G[L+1]),C.numPoints++,C.numSimplified++;else if(nt==="LineString")pe($,G,C,D,!1,!1);else if(nt==="MultiLineString"||nt==="Polygon")for(L=0;L<G.length;L++)pe($,G[L],C,D,nt==="Polygon",L===0);else if(nt==="MultiPolygon")for(var J=0;J<G.length;J++){var st=G[J];for(L=0;L<st.length;L++)pe($,st[L],C,D,!0,L===0)}if($.length){var zt=M.tags||null;if(nt==="LineString"&&U.lineMetrics){for(var Bt in zt={},M.tags)zt[Bt]=M.tags[Bt];zt.mapbox_clip_start=G.start/G.size,zt.mapbox_clip_end=G.end/G.size}var Et={geometry:$,type:nt==="Polygon"||nt==="MultiPolygon"?3:nt==="LineString"||nt==="MultiLineString"?2:1,tags:zt};M.id!==null&&(Et.id=M.id),C.features.push(Et)}}function pe(C,M,D,U,G,nt){var $=U*U;if(U>0&&M.size<(G?$:U))D.numPoints+=M.length/3;else{for(var L=[],J=0;J<M.length;J+=3)(U===0||M[J+2]>$)&&(D.numSimplified++,L.push(M[J]),L.push(M[J+1])),D.numPoints++;G&&function(st,zt){for(var Bt=0,Et=0,kt=st.length,oe=kt-2;Et<kt;oe=Et,Et+=2)Bt+=(st[Et]-st[oe])*(st[Et+1]+st[oe+1]);if(Bt>0===zt)for(Et=0,kt=st.length;Et<kt/2;Et+=2){var Wt=st[Et],St=st[Et+1];st[Et]=st[kt-2-Et],st[Et+1]=st[kt-1-Et],st[kt-2-Et]=Wt,st[kt-1-Et]=St}}(L,nt),C.push(L)}}function mn(C,M){var D=(M=this.options=function(G,nt){for(var $ in nt)G[$]=nt[$];return G}(Object.create(this.options),M)).debug;if(D&&console.time("preprocess data"),M.maxZoom<0||M.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(M.promoteId&&M.generateId)throw new Error("promoteId and generateId cannot be used together.");var U=function(G,nt){var $=[];if(G.type==="FeatureCollection")for(var L=0;L<G.features.length;L++)dn($,G.features[L],nt,L);else dn($,G.type==="Feature"?G:{geometry:G},nt);return $}(C,M);this.tiles={},this.tileCoords=[],D&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",M.indexMaxZoom,M.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(U=function(G,nt){var $=nt.buffer/nt.extent,L=G,J=rn(G,1,-1-$,$,0,-1,2,nt),st=rn(G,1,1-$,2+$,0,-1,2,nt);return(J||st)&&(L=rn(G,1,-$,1+$,0,-1,2,nt)||[],J&&(L=Li(J,1).concat(L)),st&&(L=L.concat(Li(st,-1)))),L}(U,M)).length&&this.splitTile(U,0,0,0),D&&(U.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function oi(C,M,D){return 32*((1<<C)*D+M)+C}function Yn(C,M){var D=C.tileID.canonical;if(!this._geoJSONIndex)return M(null,null);var U=this._geoJSONIndex.getTile(D.z,D.x,D.y);if(!U)return M(null,null);var G=new Cr(U.features),nt=di(G);nt.byteOffset===0&&nt.byteLength===nt.buffer.byteLength||(nt=new Uint8Array(nt)),M(null,{vectorTile:G,rawData:nt.buffer})}fn.prototype.load=function(C){var M=this.options,D=M.log,U=M.minZoom,G=M.maxZoom,nt=M.nodeSize;D&&console.time("total time");var $="prepare "+C.length+" points";D&&console.time($),this.points=C;for(var L=[],J=0;J<C.length;J++)C[J].geometry&&L.push(Kt(C[J],J));this.trees[G+1]=new gi(L,mr,Ve,nt,Float32Array),D&&console.timeEnd($);for(var st=G;st>=U;st--){var zt=+Date.now();L=this._cluster(L,st),this.trees[st]=new gi(L,mr,Ve,nt,Float32Array),D&&console.log("z%d: %d clusters in %dms",st,L.length,+Date.now()-zt)}return D&&console.timeEnd("total time"),this},fn.prototype.getClusters=function(C,M){var D=((C[0]+180)%360+360)%360-180,U=Math.max(-90,Math.min(90,C[1])),G=C[2]===180?180:((C[2]+180)%360+360)%360-180,nt=Math.max(-90,Math.min(90,C[3]));if(C[2]-C[0]>=360)D=-180,G=180;else if(D>G){var $=this.getClusters([D,U,180,nt],M),L=this.getClusters([-180,U,G,nt],M);return $.concat(L)}for(var J=this.trees[this._limitZoom(M)],st=[],zt=0,Bt=J.range(qe(D),We(nt),qe(G),We(U));zt<Bt.length;zt+=1){var Et=J.points[Bt[zt]];st.push(Et.numPoints?vn(Et):this.points[Et.index])}return st},fn.prototype.getChildren=function(C){var M=this._getOriginId(C),D=this._getOriginZoom(C),U="No cluster with the specified id.",G=this.trees[D];if(!G)throw new Error(U);var nt=G.points[M];if(!nt)throw new Error(U);for(var $=this.options.radius/(this.options.extent*Math.pow(2,D-1)),L=[],J=0,st=G.within(nt.x,nt.y,$);J<st.length;J+=1){var zt=G.points[st[J]];zt.parentId===C&&L.push(zt.numPoints?vn(zt):this.points[zt.index])}if(L.length===0)throw new Error(U);return L},fn.prototype.getLeaves=function(C,M,D){var U=[];return this._appendLeaves(U,C,M=M||10,D=D||0,0),U},fn.prototype.getTile=function(C,M,D){var U=this.trees[this._limitZoom(C)],G=Math.pow(2,C),nt=this.options,$=nt.radius/nt.extent,L=(D-$)/G,J=(D+1+$)/G,st={features:[]};return this._addTileFeatures(U.range((M-$)/G,L,(M+1+$)/G,J),U.points,M,D,G,st),M===0&&this._addTileFeatures(U.range(1-$/G,L,1,J),U.points,G,D,G,st),M===G-1&&this._addTileFeatures(U.range(0,L,$/G,J),U.points,-1,D,G,st),st.features.length?st:null},fn.prototype.getClusterExpansionZoom=function(C){for(var M=this._getOriginZoom(C)-1;M<=this.options.maxZoom;){var D=this.getChildren(C);if(M++,D.length!==1)break;C=D[0].properties.cluster_id}return M},fn.prototype._appendLeaves=function(C,M,D,U,G){for(var nt=0,$=this.getChildren(M);nt<$.length;nt+=1){var L=$[nt],J=L.properties;if(J&&J.cluster?G+J.point_count<=U?G+=J.point_count:G=this._appendLeaves(C,J.cluster_id,D,U,G):G<U?G++:C.push(L),C.length===D)break}return G},fn.prototype._addTileFeatures=function(C,M,D,U,G,nt){for(var $=0,L=C;$<L.length;$+=1){var J=M[L[$]],st=J.numPoints,zt={type:1,geometry:[[Math.round(this.options.extent*(J.x*G-D)),Math.round(this.options.extent*(J.y*G-U))]],tags:st?_n(J):this.points[J.index].properties},Bt=void 0;st?Bt=J.id:this.options.generateId?Bt=J.index:this.points[J.index].id&&(Bt=this.points[J.index].id),Bt!==void 0&&(zt.id=Bt),nt.features.push(zt)}},fn.prototype._limitZoom=function(C){return Math.max(this.options.minZoom,Math.min(+C,this.options.maxZoom+1))},fn.prototype._cluster=function(C,M){for(var D=[],U=this.options,G=U.reduce,nt=U.minPoints,$=U.radius/(U.extent*Math.pow(2,M)),L=0;L<C.length;L++){var J=C[L];if(!(J.zoom<=M)){J.zoom=M;for(var st=this.trees[M+1],zt=st.within(J.x,J.y,$),Bt=J.numPoints||1,Et=Bt,kt=0,oe=zt;kt<oe.length;kt+=1){var Wt=st.points[oe[kt]];Wt.zoom>M&&(Et+=Wt.numPoints||1)}if(Et>=nt){for(var St=J.x*Bt,ie=J.y*Bt,jt=G&&Bt>1?this._map(J,!0):null,Yt=(L<<5)+(M+1)+this.points.length,Re=0,te=zt;Re<te.length;Re+=1){var Ye=st.points[te[Re]];if(!(Ye.zoom<=M)){Ye.zoom=M;var Fe=Ye.numPoints||1;St+=Ye.x*Fe,ie+=Ye.y*Fe,Ye.parentId=Yt,G&&(jt||(jt=this._map(J,!0)),G(jt,this._map(Ye)))}}J.parentId=Yt,D.push(vi(St/Et,ie/Et,Yt,Et,jt))}else if(D.push(J),Et>1)for(var Ne=0,He=zt;Ne<He.length;Ne+=1){var er=st.points[He[Ne]];er.zoom<=M||(er.zoom=M,D.push(er))}}}return D},fn.prototype._getOriginId=function(C){return C-this.points.length>>5},fn.prototype._getOriginZoom=function(C){return(C-this.points.length)%32},fn.prototype._map=function(C,M){if(C.numPoints)return M?_i({},C.properties):C.properties;var D=this.points[C.index].properties,U=this.options.map(D);return M&&U===D?_i({},U):U},mn.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},mn.prototype.splitTile=function(C,M,D,U,G,nt,$){for(var L=[C,M,D,U],J=this.options,st=J.debug;L.length;){U=L.pop(),D=L.pop(),M=L.pop(),C=L.pop();var zt=1<<M,Bt=oi(M,D,U),Et=this.tiles[Bt];if(!Et&&(st>1&&console.time("creation"),Et=this.tiles[Bt]=Jn(C,M,D,U,J),this.tileCoords.push({z:M,x:D,y:U}),st)){st>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",M,D,U,Et.numFeatures,Et.numPoints,Et.numSimplified),console.timeEnd("creation"));var kt="z"+M;this.stats[kt]=(this.stats[kt]||0)+1,this.total++}if(Et.source=C,G){if(M===J.maxZoom||M===G)continue;var oe=1<<G-M;if(D!==Math.floor(nt/oe)||U!==Math.floor($/oe))continue}else if(M===J.indexMaxZoom||Et.numPoints<=J.indexMaxPoints)continue;if(Et.source=null,C.length!==0){st>1&&console.time("clipping");var Wt,St,ie,jt,Yt,Re,te=.5*J.buffer/J.extent,Ye=.5-te,Fe=.5+te,Ne=1+te;Wt=St=ie=jt=null,Yt=rn(C,zt,D-te,D+Fe,0,Et.minX,Et.maxX,J),Re=rn(C,zt,D+Ye,D+Ne,0,Et.minX,Et.maxX,J),C=null,Yt&&(Wt=rn(Yt,zt,U-te,U+Fe,1,Et.minY,Et.maxY,J),St=rn(Yt,zt,U+Ye,U+Ne,1,Et.minY,Et.maxY,J),Yt=null),Re&&(ie=rn(Re,zt,U-te,U+Fe,1,Et.minY,Et.maxY,J),jt=rn(Re,zt,U+Ye,U+Ne,1,Et.minY,Et.maxY,J),Re=null),st>1&&console.timeEnd("clipping"),L.push(Wt||[],M+1,2*D,2*U),L.push(St||[],M+1,2*D,2*U+1),L.push(ie||[],M+1,2*D+1,2*U),L.push(jt||[],M+1,2*D+1,2*U+1)}}},mn.prototype.getTile=function(C,M,D){var U=this.options,G=U.extent,nt=U.debug;if(C<0||C>24)return null;var $=1<<C,L=oi(C,M=(M%$+$)%$,D);if(this.tiles[L])return xe(this.tiles[L],G);nt>1&&console.log("drilling down to z%d-%d-%d",C,M,D);for(var J,st=C,zt=M,Bt=D;!J&&st>0;)st--,zt=Math.floor(zt/2),Bt=Math.floor(Bt/2),J=this.tiles[oi(st,zt,Bt)];return J&&J.source?(nt>1&&console.log("found parent tile z%d-%d-%d",st,zt,Bt),nt>1&&console.time("drilling down"),this.splitTile(J.source,st,zt,Bt,C,M,D),nt>1&&console.timeEnd("drilling down"),this.tiles[L]?xe(this.tiles[L],G):null):null};var mo=function(C){function M(D,U,G,nt){C.call(this,D,U,G,Yn),nt&&(this.loadGeoJSON=nt)}return C&&(M.__proto__=C),(M.prototype=Object.create(C&&C.prototype)).constructor=M,M.prototype.loadData=function(D,U){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=U,this._pendingLoadDataParams=D,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},M.prototype._loadData=function(){var D=this;if(this._pendingCallback&&this._pendingLoadDataParams){var U=this._pendingCallback,G=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var nt=!!(G&&G.request&&G.request.collectResourceTiming)&&new l.RequestPerformance(G.request);this.loadGeoJSON(G,function($,L){if($||!L)return U($);if(typeof L!="object")return U(new Error("Input data given to '"+G.source+"' is not a valid GeoJSON object."));(function Et(kt,oe){var Wt,St=kt&&kt.type;if(St==="FeatureCollection")for(Wt=0;Wt<kt.features.length;Wt++)Et(kt.features[Wt],oe);else if(St==="GeometryCollection")for(Wt=0;Wt<kt.geometries.length;Wt++)Et(kt.geometries[Wt],oe);else if(St==="Feature")Et(kt.geometry,oe);else if(St==="Polygon")ir(kt.coordinates,oe);else if(St==="MultiPolygon")for(Wt=0;Wt<kt.coordinates.length;Wt++)ir(kt.coordinates[Wt],oe);return kt})(L,!0);try{if(G.filter){var J=l.createExpression(G.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(J.result==="error")throw new Error(J.value.map(function(Et){return Et.key+": "+Et.message}).join(", "));var st=L.features.filter(function(Et){return J.value.evaluate({zoom:0},Et)});L={type:"FeatureCollection",features:st}}D._geoJSONIndex=G.cluster?new fn(function(Et){var kt=Et.superclusterOptions,oe=Et.clusterProperties;if(!oe||!kt)return kt;for(var Wt={},St={},ie={accumulated:null,zoom:0},jt={properties:null},Yt=Object.keys(oe),Re=0,te=Yt;Re<te.length;Re+=1){var Ye=te[Re],Fe=oe[Ye],Ne=Fe[0],He=l.createExpression(Fe[1]),er=l.createExpression(typeof Ne=="string"?[Ne,["accumulated"],["get",Ye]]:Ne);Wt[Ye]=He.value,St[Ye]=er.value}return kt.map=function(Zr){jt.properties=Zr;for(var ur={},kr=0,yr=Yt;kr<yr.length;kr+=1){var Ze=yr[kr];ur[Ze]=Wt[Ze].evaluate(ie,jt)}return ur},kt.reduce=function(Zr,ur){jt.properties=ur;for(var kr=0,yr=Yt;kr<yr.length;kr+=1){var Ze=yr[kr];ie.accumulated=Zr[Ze],Zr[Ze]=St[Ze].evaluate(ie,jt)}},kt}(G)).load(L.features):function(Et,kt){return new mn(Et,kt)}(L,G.geojsonVtOptions)}catch(Et){return U(Et)}D.loaded={};var zt={};if(nt){var Bt=nt.finish();Bt&&(zt.resourceTiming={},zt.resourceTiming[G.source]=JSON.parse(JSON.stringify(Bt)))}U(null,zt)})}},M.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},M.prototype.reloadTile=function(D,U){var G=this.loaded;return G&&G[D.uid]?C.prototype.reloadTile.call(this,D,U):this.loadTile(D,U)},M.prototype.loadGeoJSON=function(D,U){if(D.request)l.getJSON(D.request,U);else{if(typeof D.data!="string")return U(new Error("Input data given to '"+D.source+"' is not a valid GeoJSON object."));try{return U(null,JSON.parse(D.data))}catch{return U(new Error("Input data given to '"+D.source+"' is not a valid GeoJSON object."))}}},M.prototype.removeSource=function(D,U){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),U()},M.prototype.getClusterExpansionZoom=function(D,U){try{U(null,this._geoJSONIndex.getClusterExpansionZoom(D.clusterId))}catch(G){U(G)}},M.prototype.getClusterChildren=function(D,U){try{U(null,this._geoJSONIndex.getChildren(D.clusterId))}catch(G){U(G)}},M.prototype.getClusterLeaves=function(D,U){try{U(null,this._geoJSONIndex.getLeaves(D.clusterId,D.limit,D.offset))}catch(G){U(G)}},M}(rr),Tr=function(C){var M=this;this.self=C,this.actor=new l.Actor(C,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:rr,geojson:mo},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(D,U){if(M.workerSourceTypes[D])throw new Error('Worker source with name "'+D+'" already registered.');M.workerSourceTypes[D]=U},this.self.registerRTLTextPlugin=function(D){if(l.plugin.isParsed())throw new Error("RTL text plugin already registered.");l.plugin.applyArabicShaping=D.applyArabicShaping,l.plugin.processBidirectionalText=D.processBidirectionalText,l.plugin.processStyledBidirectionalText=D.processStyledBidirectionalText}};return Tr.prototype.setReferrer=function(C,M){this.referrer=M},Tr.prototype.setImages=function(C,M,D){for(var U in this.availableImages[C]=M,this.workerSources[C]){var G=this.workerSources[C][U];for(var nt in G)G[nt].availableImages=M}D()},Tr.prototype.setLayers=function(C,M,D){this.getLayerIndex(C).replace(M),D()},Tr.prototype.updateLayers=function(C,M,D){this.getLayerIndex(C).update(M.layers,M.removedIds),D()},Tr.prototype.loadTile=function(C,M,D){this.getWorkerSource(C,M.type,M.source).loadTile(M,D)},Tr.prototype.loadDEMTile=function(C,M,D){this.getDEMWorkerSource(C,M.source).loadTile(M,D)},Tr.prototype.reloadTile=function(C,M,D){this.getWorkerSource(C,M.type,M.source).reloadTile(M,D)},Tr.prototype.abortTile=function(C,M,D){this.getWorkerSource(C,M.type,M.source).abortTile(M,D)},Tr.prototype.removeTile=function(C,M,D){this.getWorkerSource(C,M.type,M.source).removeTile(M,D)},Tr.prototype.removeDEMTile=function(C,M){this.getDEMWorkerSource(C,M.source).removeTile(M)},Tr.prototype.removeSource=function(C,M,D){if(this.workerSources[C]&&this.workerSources[C][M.type]&&this.workerSources[C][M.type][M.source]){var U=this.workerSources[C][M.type][M.source];delete this.workerSources[C][M.type][M.source],U.removeSource!==void 0?U.removeSource(M,D):D()}},Tr.prototype.loadWorkerSource=function(C,M,D){try{this.self.importScripts(M.url),D()}catch(U){D(U.toString())}},Tr.prototype.syncRTLPluginState=function(C,M,D){try{l.plugin.setState(M);var U=l.plugin.getPluginURL();if(l.plugin.isLoaded()&&!l.plugin.isParsed()&&U!=null){this.self.importScripts(U);var G=l.plugin.isParsed();D(G?void 0:new Error("RTL Text Plugin failed to import scripts from "+U),G)}}catch(nt){D(nt.toString())}},Tr.prototype.getAvailableImages=function(C){var M=this.availableImages[C];return M||(M=[]),M},Tr.prototype.getLayerIndex=function(C){var M=this.layerIndexes[C];return M||(M=this.layerIndexes[C]=new Br),M},Tr.prototype.getWorkerSource=function(C,M,D){var U=this;return this.workerSources[C]||(this.workerSources[C]={}),this.workerSources[C][M]||(this.workerSources[C][M]={}),this.workerSources[C][M][D]||(this.workerSources[C][M][D]=new this.workerSourceTypes[M]({send:function(G,nt,$){U.actor.send(G,nt,$,C)}},this.getLayerIndex(C),this.getAvailableImages(C))),this.workerSources[C][M][D]},Tr.prototype.getDEMWorkerSource=function(C,M){return this.demWorkerSources[C]||(this.demWorkerSources[C]={}),this.demWorkerSources[C][M]||(this.demWorkerSources[C][M]=new ve),this.demWorkerSources[C][M]},Tr.prototype.enforceCacheSizeLimit=function(C,M){l.enforceCacheSizeLimit(M)},typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Tr(self)),Tr}),pn(["./shared"],function(l){var sr=l.createCommonjsModule(function(n){function o(p){return!i(p)}function i(p){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var m,_,S=new Blob([""],{type:"text/javascript"}),P=URL.createObjectURL(S);try{_=new Worker(P),m=!0}catch{m=!1}return _&&_.terminate(),URL.revokeObjectURL(P),m}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var m=document.createElement("canvas");m.width=m.height=1;var _=m.getContext("2d");if(!_)return!1;var S=_.getImageData(0,0,1,1);return S&&S.width===m.width}()?(s[d=p&&p.failIfMajorPerformanceCaveat]===void 0&&(s[d]=function(m){var _=function(P){var B=document.createElement("canvas"),F=Object.create(o.webGLContextAttributes);return F.failIfMajorPerformanceCaveat=P,B.probablySupportsContext?B.probablySupportsContext("webgl",F)||B.probablySupportsContext("experimental-webgl",F):B.supportsContext?B.supportsContext("webgl",F)||B.supportsContext("experimental-webgl",F):B.getContext("webgl",F)||B.getContext("experimental-webgl",F)}(m);if(!_)return!1;var S=_.createShader(_.VERTEX_SHADER);return!(!S||_.isContextLost())&&(_.shaderSource(S,"void main() {}"),_.compileShader(S),_.getShaderParameter(S,_.COMPILE_STATUS)===!0)}(d)),s[d]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var d}n.exports?n.exports=o:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=o,window.mapboxgl.notSupportedReason=i);var s={};o.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),Ot={create:function(n,o,i){var s=l.window.document.createElement(n);return o!==void 0&&(s.className=o),i&&i.appendChild(s),s},createNS:function(n,o){return l.window.document.createElementNS(n,o)}},Br=l.window.document&&l.window.document.documentElement.style;function Oe(n){if(!Br)return n[0];for(var o=0;o<n.length;o++)if(n[o]in Br)return n[o];return n[0]}var Ur,Xt=Oe(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);Ot.disableDrag=function(){Br&&Xt&&(Ur=Br[Xt],Br[Xt]="none")},Ot.enableDrag=function(){Br&&Xt&&(Br[Xt]=Ur)};var On=Oe(["transform","WebkitTransform"]);Ot.setTransform=function(n,o){n.style[On]=o};var rr=!1;try{var Dr=Object.defineProperty({},"passive",{get:function(){rr=!0}});l.window.addEventListener("test",Dr,Dr),l.window.removeEventListener("test",Dr,Dr)}catch{rr=!1}Ot.addEventListener=function(n,o,i,s){s===void 0&&(s={}),n.addEventListener(o,i,"passive"in s&&rr?s:s.capture)},Ot.removeEventListener=function(n,o,i,s){s===void 0&&(s={}),n.removeEventListener(o,i,"passive"in s&&rr?s:s.capture)};var ve=function(n){n.preventDefault(),n.stopPropagation(),l.window.removeEventListener("click",ve,!0)};function ir(n){var o=n.userImage;return!!(o&&o.render&&o.render())&&(n.data.replace(new Uint8Array(o.data.buffer)),!0)}Ot.suppressClick=function(){l.window.addEventListener("click",ve,!0),l.window.setTimeout(function(){l.window.removeEventListener("click",ve,!0)},0)},Ot.mousePos=function(n,o){var i=n.getBoundingClientRect();return new l.Point(o.clientX-i.left-n.clientLeft,o.clientY-i.top-n.clientTop)},Ot.touchPos=function(n,o){for(var i=n.getBoundingClientRect(),s=[],p=0;p<o.length;p++)s.push(new l.Point(o[p].clientX-i.left-n.clientLeft,o[p].clientY-i.top-n.clientTop));return s},Ot.mouseButton=function(n){return l.window.InstallTrigger!==void 0&&n.button===2&&n.ctrlKey&&l.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:n.button},Ot.remove=function(n){n.parentNode&&n.parentNode.removeChild(n)};var hr=function(n){function o(){n.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.RGBAImage({width:1,height:1}),this.dirty=!0}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.isLoaded=function(){return this.loaded},o.prototype.setLoaded=function(i){if(this.loaded!==i&&(this.loaded=i,i)){for(var s=0,p=this.requestors;s<p.length;s+=1){var d=p[s];this._notify(d.ids,d.callback)}this.requestors=[]}},o.prototype.getImage=function(i){return this.images[i]},o.prototype.addImage=function(i,s){this._validate(i,s)&&(this.images[i]=s)},o.prototype._validate=function(i,s){var p=!0;return this._validateStretch(s.stretchX,s.data&&s.data.width)||(this.fire(new l.ErrorEvent(new Error('Image "'+i+'" has invalid "stretchX" value'))),p=!1),this._validateStretch(s.stretchY,s.data&&s.data.height)||(this.fire(new l.ErrorEvent(new Error('Image "'+i+'" has invalid "stretchY" value'))),p=!1),this._validateContent(s.content,s)||(this.fire(new l.ErrorEvent(new Error('Image "'+i+'" has invalid "content" value'))),p=!1),p},o.prototype._validateStretch=function(i,s){if(!i)return!0;for(var p=0,d=0,m=i;d<m.length;d+=1){var _=m[d];if(_[0]<p||_[1]<_[0]||s<_[1])return!1;p=_[1]}return!0},o.prototype._validateContent=function(i,s){return!(i&&(i.length!==4||i[0]<0||s.data.width<i[0]||i[1]<0||s.data.height<i[1]||i[2]<0||s.data.width<i[2]||i[3]<0||s.data.height<i[3]||i[2]<i[0]||i[3]<i[1]))},o.prototype.updateImage=function(i,s){s.version=this.images[i].version+1,this.images[i]=s,this.updatedImages[i]=!0},o.prototype.removeImage=function(i){var s=this.images[i];delete this.images[i],delete this.patterns[i],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()},o.prototype.listImages=function(){return Object.keys(this.images)},o.prototype.getImages=function(i,s){var p=!0;if(!this.isLoaded())for(var d=0,m=i;d<m.length;d+=1)this.images[m[d]]||(p=!1);this.isLoaded()||p?this._notify(i,s):this.requestors.push({ids:i,callback:s})},o.prototype._notify=function(i,s){for(var p={},d=0,m=i;d<m.length;d+=1){var _=m[d];this.images[_]||this.fire(new l.Event("styleimagemissing",{id:_}));var S=this.images[_];S?p[_]={data:S.data.clone(),pixelRatio:S.pixelRatio,sdf:S.sdf,version:S.version,stretchX:S.stretchX,stretchY:S.stretchY,content:S.content,hasRenderCallback:!!(S.userImage&&S.userImage.render)}:l.warnOnce('Image "'+_+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}s(null,p)},o.prototype.getPixelSize=function(){var i=this.atlasImage;return{width:i.width,height:i.height}},o.prototype.getPattern=function(i){var s=this.patterns[i],p=this.getImage(i);if(!p)return null;if(s&&s.position.version===p.version)return s.position;if(s)s.position.version=p.version;else{var d={w:p.data.width+2,h:p.data.height+2,x:0,y:0},m=new l.ImagePosition(d,p);this.patterns[i]={bin:d,position:m}}return this._updatePatternAtlas(),this.patterns[i].position},o.prototype.bind=function(i){var s=i.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new l.Texture(i,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)},o.prototype._updatePatternAtlas=function(){var i=[];for(var s in this.patterns)i.push(this.patterns[s].bin);var p=l.potpack(i),d=p.w,m=p.h,_=this.atlasImage;for(var S in _.resize({width:d||1,height:m||1}),this.patterns){var P=this.patterns[S].bin,B=P.x+1,F=P.y+1,N=this.images[S].data,H=N.width,W=N.height;l.RGBAImage.copy(N,_,{x:0,y:0},{x:B,y:F},{width:H,height:W}),l.RGBAImage.copy(N,_,{x:0,y:W-1},{x:B,y:F-1},{width:H,height:1}),l.RGBAImage.copy(N,_,{x:0,y:0},{x:B,y:F+W},{width:H,height:1}),l.RGBAImage.copy(N,_,{x:H-1,y:0},{x:B-1,y:F},{width:1,height:W}),l.RGBAImage.copy(N,_,{x:0,y:0},{x:B+H,y:F},{width:1,height:W})}this.dirty=!0},o.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},o.prototype.dispatchRenderCallbacks=function(i){for(var s=0,p=i;s<p.length;s+=1){var d=p[s];if(!this.callbackDispatchedThisFrame[d]){this.callbackDispatchedThisFrame[d]=!0;var m=this.images[d];ir(m)&&this.updateImage(d,m)}}},o}(l.Evented),Gi=Rn,Lr=Rn,Cr=1e20;function Rn(n,o,i,s,p,d){this.fontSize=n||24,this.buffer=o===void 0?3:o,this.cutoff=s||.25,this.fontFamily=p||"sans-serif",this.fontWeight=d||"normal",this.radius=i||8;var m=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=m,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(m*m),this.gridInner=new Float64Array(m*m),this.f=new Float64Array(m),this.d=new Float64Array(m),this.z=new Float64Array(m+1),this.v=new Int16Array(m),this.middle=Math.round(m/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Wr(n,o,i,s,p,d,m){for(var _=0;_<o;_++){for(var S=0;S<i;S++)s[S]=n[S*o+_];for(Ai(s,p,d,m,i),S=0;S<i;S++)n[S*o+_]=p[S]}for(S=0;S<i;S++){for(_=0;_<o;_++)s[_]=n[S*o+_];for(Ai(s,p,d,m,o),_=0;_<o;_++)n[S*o+_]=Math.sqrt(p[_])}}function Ai(n,o,i,s,p){i[0]=0,s[0]=-Cr,s[1]=+Cr;for(var d=1,m=0;d<p;d++){for(var _=(n[d]+d*d-(n[i[m]]+i[m]*i[m]))/(2*d-2*i[m]);_<=s[m];)m--,_=(n[d]+d*d-(n[i[m]]+i[m]*i[m]))/(2*d-2*i[m]);i[++m]=d,s[m]=_,s[m+1]=+Cr}for(d=0,m=0;d<p;d++){for(;s[m+1]<d;)m++;o[d]=(d-i[m])*(d-i[m])+n[i[m]]}}Rn.prototype.draw=function(n){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(n,this.buffer,this.middle);for(var o=this.ctx.getImageData(0,0,this.size,this.size),i=new Uint8ClampedArray(this.size*this.size),s=0;s<this.size*this.size;s++){var p=o.data[4*s+3]/255;this.gridOuter[s]=p===1?0:p===0?Cr:Math.pow(Math.max(0,.5-p),2),this.gridInner[s]=p===1?Cr:p===0?0:Math.pow(Math.max(0,p-.5),2)}for(Wr(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),Wr(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),s=0;s<this.size*this.size;s++)i[s]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[s]-this.gridInner[s])/this.radius+this.cutoff))));return i},Gi.default=Lr;var gn=function(n,o){this.requestManager=n,this.localIdeographFontFamily=o,this.entries={}};gn.prototype.setURL=function(n){this.url=n},gn.prototype.getGlyphs=function(n,o){var i=this,s=[];for(var p in n)for(var d=0,m=n[p];d<m.length;d+=1)s.push({stack:p,id:m[d]});l.asyncAll(s,function(_,S){var P=_.stack,B=_.id,F=i.entries[P];F||(F=i.entries[P]={glyphs:{},requests:{},ranges:{}});var N=F.glyphs[B];if(N===void 0){if(N=i._tinySDF(F,P,B))return F.glyphs[B]=N,void S(null,{stack:P,id:B,glyph:N});var H=Math.floor(B/256);if(256*H>65535)S(new Error("glyphs > 65535 not supported"));else if(F.ranges[H])S(null,{stack:P,id:B,glyph:N});else{var W=F.requests[H];W||(W=F.requests[H]=[],gn.loadGlyphRange(P,H,i.url,i.requestManager,function(tt,q){if(q){for(var Q in q)i._doesCharSupportLocalGlyph(+Q)||(F.glyphs[+Q]=q[+Q]);F.ranges[H]=!0}for(var at=0,mt=W;at<mt.length;at+=1)(0,mt[at])(tt,q);delete F.requests[H]})),W.push(function(tt,q){tt?S(tt):q&&S(null,{stack:P,id:B,glyph:q[B]||null})})}}else S(null,{stack:P,id:B,glyph:N})},function(_,S){if(_)o(_);else if(S){for(var P={},B=0,F=S;B<F.length;B+=1){var N=F[B],H=N.stack,W=N.id,tt=N.glyph;(P[H]||(P[H]={}))[W]=tt&&{id:tt.id,bitmap:tt.bitmap.clone(),metrics:tt.metrics}}o(null,P)}})},gn.prototype._doesCharSupportLocalGlyph=function(n){return!!this.localIdeographFontFamily&&(l.isChar["CJK Unified Ideographs"](n)||l.isChar["Hangul Syllables"](n)||l.isChar.Hiragana(n)||l.isChar.Katakana(n))},gn.prototype._tinySDF=function(n,o,i){var s=this.localIdeographFontFamily;if(s&&this._doesCharSupportLocalGlyph(i)){var p=n.tinySDF;if(!p){var d="400";/bold/i.test(o)?d="900":/medium/i.test(o)?d="500":/light/i.test(o)&&(d="200"),p=n.tinySDF=new gn.TinySDF(24,3,8,.25,s,d)}return{id:i,bitmap:new l.AlphaImage({width:30,height:30},p.draw(String.fromCharCode(i))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},gn.loadGlyphRange=function(n,o,i,s,p){var d=256*o,m=d+255,_=s.transformRequest(s.normalizeGlyphsURL(i).replace("{fontstack}",n).replace("{range}",d+"-"+m),l.ResourceType.Glyphs);l.getArrayBuffer(_,function(S,P){if(S)p(S);else if(P){for(var B={},F=0,N=l.parseGlyphPBF(P);F<N.length;F+=1){var H=N[F];B[H.id]=H}p(null,B)}})},gn.TinySDF=Gi;var di=function(){this.specification=l.styleSpec.light.position};di.prototype.possiblyEvaluate=function(n,o){return l.sphericalToCartesian(n.expression.evaluate(o))},di.prototype.interpolate=function(n,o,i){return{x:l.number(n.x,o.x,i),y:l.number(n.y,o.y,i),z:l.number(n.z,o.z,i)}};var ni=new l.Properties({anchor:new l.DataConstantProperty(l.styleSpec.light.anchor),position:new di,color:new l.DataConstantProperty(l.styleSpec.light.color),intensity:new l.DataConstantProperty(l.styleSpec.light.intensity)}),mi=function(n){function o(i){n.call(this),this._transitionable=new l.Transitionable(ni),this.setLight(i),this._transitioning=this._transitionable.untransitioned()}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getLight=function(){return this._transitionable.serialize()},o.prototype.setLight=function(i,s){if(s===void 0&&(s={}),!this._validate(l.validateLight,i,s))for(var p in i){var d=i[p];l.endsWith(p,"-transition")?this._transitionable.setTransition(p.slice(0,-11),d):this._transitionable.setValue(p,d)}},o.prototype.updateTransitions=function(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)},o.prototype.hasTransition=function(){return this._transitioning.hasTransition()},o.prototype.recalculate=function(i){this.properties=this._transitioning.possiblyEvaluate(i)},o.prototype._validate=function(i,s,p){return(!p||p.validate!==!1)&&l.emitValidationErrors(this,i.call(l.validateStyle,l.extend({value:s,style:{glyphs:!0,sprite:!0},styleSpec:l.styleSpec})))},o}(l.Evented),wr=function(n,o){this.width=n,this.height=o,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};wr.prototype.getDash=function(n,o){var i=n.join(",")+String(o);return this.dashEntry[i]||(this.dashEntry[i]=this.addDash(n,o)),this.dashEntry[i]},wr.prototype.getDashRanges=function(n,o,i){var s=[],p=n.length%2==1?-n[n.length-1]*i:0,d=n[0]*i,m=!0;s.push({left:p,right:d,isDash:m,zeroLength:n[0]===0});for(var _=n[0],S=1;S<n.length;S++){var P=n[S];s.push({left:p=_*i,right:d=(_+=P)*i,isDash:m=!m,zeroLength:P===0})}return s},wr.prototype.addRoundDash=function(n,o,i){for(var s=o/2,p=-i;p<=i;p++)for(var d=this.width*(this.nextRow+i+p),m=0,_=n[m],S=0;S<this.width;S++){S/_.right>1&&(_=n[++m]);var P=Math.abs(S-_.left),B=Math.abs(S-_.right),F=Math.min(P,B),N=void 0,H=p/i*(s+1);if(_.isDash){var W=s-Math.abs(H);N=Math.sqrt(F*F+W*W)}else N=s-Math.sqrt(F*F+H*H);this.data[d+S]=Math.max(0,Math.min(255,N+128))}},wr.prototype.addRegularDash=function(n){for(var o=n.length-1;o>=0;--o){var i=n[o],s=n[o+1];i.zeroLength?n.splice(o,1):s&&s.isDash===i.isDash&&(s.left=i.left,n.splice(o,1))}var p=n[0],d=n[n.length-1];p.isDash===d.isDash&&(p.left=d.left-this.width,d.right=p.right+this.width);for(var m=this.width*this.nextRow,_=0,S=n[_],P=0;P<this.width;P++){P/S.right>1&&(S=n[++_]);var B=Math.abs(P-S.left),F=Math.abs(P-S.right),N=Math.min(B,F);this.data[m+P]=Math.max(0,Math.min(255,(S.isDash?N:-N)+128))}},wr.prototype.addDash=function(n,o){var i=o?7:0,s=2*i+1;if(this.nextRow+s>this.height)return l.warnOnce("LineAtlas out of space"),null;for(var p=0,d=0;d<n.length;d++)p+=n[d];if(p!==0){var m=this.width/p,_=this.getDashRanges(n,this.width,m);o?this.addRoundDash(_,m,i):this.addRegularDash(_)}var S={y:(this.nextRow+i+.5)/this.height,height:2*i/this.height,width:p};return this.nextRow+=s,this.dirty=!0,S},wr.prototype.bind=function(n){var o=n.gl;this.texture?(o.bindTexture(o.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,o.texSubImage2D(o.TEXTURE_2D,0,0,0,this.width,this.height,o.ALPHA,o.UNSIGNED_BYTE,this.data))):(this.texture=o.createTexture(),o.bindTexture(o.TEXTURE_2D,this.texture),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texImage2D(o.TEXTURE_2D,0,o.ALPHA,this.width,this.height,0,o.ALPHA,o.UNSIGNED_BYTE,this.data))};var Or=function n(o,i){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=l.uniqueId();for(var s=this.workerPool.acquire(this.id),p=0;p<s.length;p++){var d=new n.Actor(s[p],i,this.id);d.name="Worker "+p,this.actors.push(d)}};function Lo(n,o,i){var s=function(p,d){if(p)return i(p);if(d){var m=l.pick(l.extend(d,n),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);d.vector_layers&&(m.vectorLayers=d.vector_layers,m.vectorLayerIds=m.vectorLayers.map(function(_){return _.id})),m.tiles=o.canonicalizeTileset(m,n.url),i(null,m)}};return n.url?l.getJSON(o.transformRequest(o.normalizeSourceURL(n.url),l.ResourceType.Source),s):l.browser.frame(function(){return s(null,n)})}Or.prototype.broadcast=function(n,o,i){l.asyncAll(this.actors,function(s,p){s.send(n,o,p)},i=i||function(){})},Or.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Or.prototype.remove=function(){this.actors.forEach(function(n){n.remove()}),this.actors=[],this.workerPool.release(this.id)},Or.Actor=l.Actor;var hn=function(n,o,i){this.bounds=l.LngLatBounds.convert(this.validateBounds(n)),this.minzoom=o||0,this.maxzoom=i||24};hn.prototype.validateBounds=function(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]},hn.prototype.contains=function(n){var o=Math.pow(2,n.z),i=Math.floor(l.mercatorXfromLng(this.bounds.getWest())*o),s=Math.floor(l.mercatorYfromLat(this.bounds.getNorth())*o),p=Math.ceil(l.mercatorXfromLng(this.bounds.getEast())*o),d=Math.ceil(l.mercatorYfromLat(this.bounds.getSouth())*o);return n.x>=i&&n.x<p&&n.y>=s&&n.y<d};var ho=function(n){function o(i,s,p,d){if(n.call(this),this.id=i,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.extend(this,l.pick(s,["url","scheme","tileSize","promoteId"])),this._options=l.extend({type:"vector"},s),this._collectResourceTiming=s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(d)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.load=function(){var i=this;this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Lo(this._options,this.map._requestManager,function(s,p){i._tileJSONRequest=null,i._loaded=!0,s?i.fire(new l.ErrorEvent(s)):p&&(l.extend(i,p),p.bounds&&(i.tileBounds=new hn(p.bounds,i.minzoom,i.maxzoom)),l.postTurnstileEvent(p.tiles,i.map._requestManager._customAccessToken),l.postMapLoadEvent(p.tiles,i.map._getMapId(),i.map._requestManager._skuToken,i.map._requestManager._customAccessToken),i.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),i.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})))})},o.prototype.loaded=function(){return this._loaded},o.prototype.hasTile=function(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)},o.prototype.onAdd=function(i){this.map=i,this.load()},o.prototype.setSourceProperty=function(i){this._tileJSONRequest&&this._tileJSONRequest.cancel(),i(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},o.prototype.setTiles=function(i){var s=this;return this.setSourceProperty(function(){s._options.tiles=i}),this},o.prototype.setUrl=function(i){var s=this;return this.setSourceProperty(function(){s.url=i,s._options.url=i}),this},o.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},o.prototype.serialize=function(){return l.extend({},this._options)},o.prototype.loadTile=function(i,s){var p=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme)),d={request:this.map._requestManager.transformRequest(p,l.ResourceType.Tile),uid:i.uid,tileID:i.tileID,zoom:i.tileID.overscaledZ,tileSize:this.tileSize*i.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:l.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function m(_,S){return delete i.request,i.aborted?s(null):_&&_.status!==404?s(_):(S&&S.resourceTiming&&(i.resourceTiming=S.resourceTiming),this.map._refreshExpiredTiles&&S&&i.setExpiryData(S),i.loadVectorData(S,this.map.painter),l.cacheEntryPossiblyAdded(this.dispatcher),s(null),void(i.reloadCallback&&(this.loadTile(i,i.reloadCallback),i.reloadCallback=null)))}d.request.collectResourceTiming=this._collectResourceTiming,i.actor&&i.state!=="expired"?i.state==="loading"?i.reloadCallback=s:i.request=i.actor.send("reloadTile",d,m.bind(this)):(i.actor=this.dispatcher.getActor(),i.request=i.actor.send("loadTile",d,m.bind(this)))},o.prototype.abortTile=function(i){i.request&&(i.request.cancel(),delete i.request),i.actor&&i.actor.send("abortTile",{uid:i.uid,type:this.type,source:this.id},void 0)},o.prototype.unloadTile=function(i){i.unloadVectorData(),i.actor&&i.actor.send("removeTile",{uid:i.uid,type:this.type,source:this.id},void 0)},o.prototype.hasTransition=function(){return!1},o}(l.Evented),Bn=function(n){function o(i,s,p,d){n.call(this),this.id=i,this.dispatcher=p,this.setEventedParent(d),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.extend({type:"raster"},s),l.extend(this,l.pick(s,["url","scheme","tileSize"]))}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.load=function(){var i=this;this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Lo(this._options,this.map._requestManager,function(s,p){i._tileJSONRequest=null,i._loaded=!0,s?i.fire(new l.ErrorEvent(s)):p&&(l.extend(i,p),p.bounds&&(i.tileBounds=new hn(p.bounds,i.minzoom,i.maxzoom)),l.postTurnstileEvent(p.tiles),l.postMapLoadEvent(p.tiles,i.map._getMapId(),i.map._requestManager._skuToken),i.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),i.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})))})},o.prototype.loaded=function(){return this._loaded},o.prototype.onAdd=function(i){this.map=i,this.load()},o.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},o.prototype.serialize=function(){return l.extend({},this._options)},o.prototype.hasTile=function(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)},o.prototype.loadTile=function(i,s){var p=this,d=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);i.request=l.getImage(this.map._requestManager.transformRequest(d,l.ResourceType.Tile),function(m,_){if(delete i.request,i.aborted)i.state="unloaded",s(null);else if(m)i.state="errored",s(m);else if(_){p.map._refreshExpiredTiles&&i.setExpiryData(_),delete _.cacheControl,delete _.expires;var S=p.map.painter.context,P=S.gl;i.texture=p.map.painter.getTileTexture(_.width),i.texture?i.texture.update(_,{useMipmap:!0}):(i.texture=new l.Texture(S,_,P.RGBA,{useMipmap:!0}),i.texture.bind(P.LINEAR,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST),S.extTextureFilterAnisotropic&&P.texParameterf(P.TEXTURE_2D,S.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,S.extTextureFilterAnisotropicMax)),i.state="loaded",l.cacheEntryPossiblyAdded(p.dispatcher),s(null)}})},o.prototype.abortTile=function(i,s){i.request&&(i.request.cancel(),delete i.request),s()},o.prototype.unloadTile=function(i,s){i.texture&&this.map.painter.saveTileTexture(i.texture),s()},o.prototype.hasTransition=function(){return!1},o}(l.Evented),yi=function(n){function o(i,s,p,d){n.call(this,i,s,p,d),this.type="raster-dem",this.maxzoom=22,this._options=l.extend({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox"}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},o.prototype.loadTile=function(i,s){var p=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function d(m,_){m&&(i.state="errored",s(m)),_&&(i.dem=_,i.needsHillshadePrepare=!0,i.state="loaded",s(null))}i.request=l.getImage(this.map._requestManager.transformRequest(p,l.ResourceType.Tile),(function(m,_){if(delete i.request,i.aborted)i.state="unloaded",s(null);else if(m)i.state="errored",s(m);else if(_){this.map._refreshExpiredTiles&&i.setExpiryData(_),delete _.cacheControl,delete _.expires;var S=l.window.ImageBitmap&&_ instanceof l.window.ImageBitmap&&l.offscreenCanvasSupported()?_:l.browser.getImageData(_,1),P={uid:i.uid,coord:i.tileID,source:this.id,rawImageData:S,encoding:this.encoding};i.actor&&i.state!=="expired"||(i.actor=this.dispatcher.getActor(),i.actor.send("loadDEMTile",P,d.bind(this)))}}).bind(this)),i.neighboringTiles=this._getNeighboringTiles(i.tileID)},o.prototype._getNeighboringTiles=function(i){var s=i.canonical,p=Math.pow(2,s.z),d=(s.x-1+p)%p,m=s.x===0?i.wrap-1:i.wrap,_=(s.x+1+p)%p,S=s.x+1===p?i.wrap+1:i.wrap,P={};return P[new l.OverscaledTileID(i.overscaledZ,m,s.z,d,s.y).key]={backfilled:!1},P[new l.OverscaledTileID(i.overscaledZ,S,s.z,_,s.y).key]={backfilled:!1},s.y>0&&(P[new l.OverscaledTileID(i.overscaledZ,m,s.z,d,s.y-1).key]={backfilled:!1},P[new l.OverscaledTileID(i.overscaledZ,i.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},P[new l.OverscaledTileID(i.overscaledZ,S,s.z,_,s.y-1).key]={backfilled:!1}),s.y+1<p&&(P[new l.OverscaledTileID(i.overscaledZ,m,s.z,d,s.y+1).key]={backfilled:!1},P[new l.OverscaledTileID(i.overscaledZ,i.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},P[new l.OverscaledTileID(i.overscaledZ,S,s.z,_,s.y+1).key]={backfilled:!1}),P},o.prototype.unloadTile=function(i){i.demTexture&&this.map.painter.saveTileTexture(i.demTexture),i.fbo&&(i.fbo.destroy(),delete i.fbo),i.dem&&delete i.dem,delete i.neighboringTiles,i.state="unloaded",i.actor&&i.actor.send("removeDEMTile",{uid:i.uid,source:this.id})},o}(Bn),Cn=function(n){function o(i,s,p,d){n.call(this),this.id=i,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=p.getActor(),this.setEventedParent(d),this._data=s.data,this._options=l.extend({},s),this._collectResourceTiming=s.collectResourceTiming,this._resourceTiming=[],s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;var m=l.EXTENT/this.tileSize;this.workerOptions=l.extend({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(s.buffer!==void 0?s.buffer:128)*m,tolerance:(s.tolerance!==void 0?s.tolerance:.375)*m,extent:l.EXTENT,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?Math.min(s.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:l.EXTENT,radius:(s.clusterRadius||50)*m,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.load=function(){var i=this;this.fire(new l.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(s){if(s)i.fire(new l.ErrorEvent(s));else{var p={dataType:"source",sourceDataType:"metadata"};i._collectResourceTiming&&i._resourceTiming&&i._resourceTiming.length>0&&(p.resourceTiming=i._resourceTiming,i._resourceTiming=[]),i.fire(new l.Event("data",p))}})},o.prototype.onAdd=function(i){this.map=i,this.load()},o.prototype.setData=function(i){var s=this;return this._data=i,this.fire(new l.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(p){if(p)s.fire(new l.ErrorEvent(p));else{var d={dataType:"source",sourceDataType:"content"};s._collectResourceTiming&&s._resourceTiming&&s._resourceTiming.length>0&&(d.resourceTiming=s._resourceTiming,s._resourceTiming=[]),s.fire(new l.Event("data",d))}}),this},o.prototype.getClusterExpansionZoom=function(i,s){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:i,source:this.id},s),this},o.prototype.getClusterChildren=function(i,s){return this.actor.send("geojson.getClusterChildren",{clusterId:i,source:this.id},s),this},o.prototype.getClusterLeaves=function(i,s,p,d){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:i,limit:s,offset:p},d),this},o.prototype._updateWorkerData=function(i){var s=this;this._loaded=!1;var p=l.extend({},this.workerOptions),d=this._data;typeof d=="string"?(p.request=this.map._requestManager.transformRequest(l.browser.resolveURL(d),l.ResourceType.Source),p.request.collectResourceTiming=this._collectResourceTiming):p.data=JSON.stringify(d),this.actor.send(this.type+".loadData",p,function(m,_){s._removed||_&&_.abandoned||(s._loaded=!0,_&&_.resourceTiming&&_.resourceTiming[s.id]&&(s._resourceTiming=_.resourceTiming[s.id].slice(0)),s.actor.send(s.type+".coalesce",{source:p.source},null),i(m))})},o.prototype.loaded=function(){return this._loaded},o.prototype.loadTile=function(i,s){var p=this,d=i.actor?"reloadTile":"loadTile";i.actor=this.actor,i.request=this.actor.send(d,{type:this.type,uid:i.uid,tileID:i.tileID,zoom:i.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:l.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(m,_){return delete i.request,i.unloadVectorData(),i.aborted?s(null):m?s(m):(i.loadVectorData(_,p.map.painter,d==="reloadTile"),s(null))})},o.prototype.abortTile=function(i){i.request&&(i.request.cancel(),delete i.request),i.aborted=!0},o.prototype.unloadTile=function(i){i.unloadVectorData(),this.actor.send("removeTile",{uid:i.uid,type:this.type,source:this.id})},o.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},o.prototype.serialize=function(){return l.extend({},this._options,{type:this.type,data:this._data})},o.prototype.hasTransition=function(){return!1},o}(l.Evented),Wn=l.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),Pi=function(n){function o(i,s,p,d){n.call(this),this.id=i,this.dispatcher=p,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(d),this.options=s}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.load=function(i,s){var p=this;this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this.url=this.options.url,l.getImage(this.map._requestManager.transformRequest(this.url,l.ResourceType.Image),function(d,m){p._loaded=!0,d?p.fire(new l.ErrorEvent(d)):m&&(p.image=m,i&&(p.coordinates=i),s&&s(),p._finishLoading())})},o.prototype.loaded=function(){return this._loaded},o.prototype.updateImage=function(i){var s=this;return this.image&&i.url?(this.options.url=i.url,this.load(i.coordinates,function(){s.texture=null}),this):this},o.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})))},o.prototype.onAdd=function(i){this.map=i,this.load()},o.prototype.setCoordinates=function(i){var s=this;this.coordinates=i;var p=i.map(l.MercatorCoordinate.fromLngLat);this.tileID=function(m){for(var _=1/0,S=1/0,P=-1/0,B=-1/0,F=0,N=m;F<N.length;F+=1){var H=N[F];_=Math.min(_,H.x),S=Math.min(S,H.y),P=Math.max(P,H.x),B=Math.max(B,H.y)}var W=Math.max(P-_,B-S),tt=Math.max(0,Math.floor(-Math.log(W)/Math.LN2)),q=Math.pow(2,tt);return new l.CanonicalTileID(tt,Math.floor((_+P)/2*q),Math.floor((S+B)/2*q))}(p),this.minzoom=this.maxzoom=this.tileID.z;var d=p.map(function(m){return s.tileID.getTilePoint(m)._round()});return this._boundsArray=new l.StructArrayLayout4i8,this._boundsArray.emplaceBack(d[0].x,d[0].y,0,0),this._boundsArray.emplaceBack(d[1].x,d[1].y,l.EXTENT,0),this._boundsArray.emplaceBack(d[3].x,d[3].y,0,l.EXTENT),this._boundsArray.emplaceBack(d[2].x,d[2].y,l.EXTENT,l.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})),this},o.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var i=this.map.painter.context,s=i.gl;for(var p in this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,Wn.members)),this.boundsSegments||(this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new l.Texture(i,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE)),this.tiles){var d=this.tiles[p];d.state!=="loaded"&&(d.state="loaded",d.texture=this.texture)}}},o.prototype.loadTile=function(i,s){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={},s(null)):(i.state="errored",s(null))},o.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},o.prototype.hasTransition=function(){return!1},o}(l.Evented),Zn=function(n){function o(i,s,p,d){n.call(this,i,s,p,d),this.roundZoom=!0,this.type="video",this.options=s}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.load=function(){var i=this;this._loaded=!1;var s=this.options;this.urls=[];for(var p=0,d=s.urls;p<d.length;p+=1)this.urls.push(this.map._requestManager.transformRequest(d[p],l.ResourceType.Source).url);l.getVideo(this.urls,function(m,_){i._loaded=!0,m?i.fire(new l.ErrorEvent(m)):_&&(i.video=_,i.video.loop=!0,i.video.setAttribute("playsinline",""),i.video.addEventListener("playing",function(){i.map.triggerRepaint()}),i.map&&i.video.play(),i._finishLoading())})},o.prototype.pause=function(){this.video&&this.video.pause()},o.prototype.play=function(){this.video&&this.video.play()},o.prototype.seek=function(i){if(this.video){var s=this.video.seekable;i<s.start(0)||i>s.end(0)?this.fire(new l.ErrorEvent(new l.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+s.start(0)+" and "+s.end(0)+"-second mark."))):this.video.currentTime=i}},o.prototype.getVideo=function(){return this.video},o.prototype.onAdd=function(i){this.map||(this.map=i,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},o.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var i=this.map.painter.context,s=i.gl;for(var p in this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,Wn.members)),this.boundsSegments||(this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new l.Texture(i,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE)),this.tiles){var d=this.tiles[p];d.state!=="loaded"&&(d.state="loaded",d.texture=this.texture)}}},o.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},o.prototype.hasTransition=function(){return this.video&&!this.video.paused},o}(Pi),$i=function(n){function o(i,s,p,d){n.call(this,i,s,p,d),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some(function(m){return!Array.isArray(m)||m.length!==2||m.some(function(_){return typeof _!="number"})})||this.fire(new l.ErrorEvent(new l.ValidationError("sources."+i,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.ErrorEvent(new l.ValidationError("sources."+i,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new l.ErrorEvent(new l.ValidationError("sources."+i,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof l.window.HTMLCanvasElement||this.fire(new l.ErrorEvent(new l.ValidationError("sources."+i,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.ErrorEvent(new l.ValidationError("sources."+i,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof l.window.HTMLCanvasElement?this.options.canvas:l.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},o.prototype.getCanvas=function(){return this.canvas},o.prototype.onAdd=function(i){this.map=i,this.load(),this.canvas&&this.animate&&this.play()},o.prototype.onRemove=function(){this.pause()},o.prototype.prepare=function(){var i=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,i=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,i=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var s=this.map.painter.context,p=s.gl;for(var d in this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,Wn.members)),this.boundsSegments||(this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(i||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new l.Texture(s,this.canvas,p.RGBA,{premultiply:!0}),this.tiles){var m=this.tiles[d];m.state!=="loaded"&&(m.state="loaded",m.texture=this.texture)}}},o.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},o.prototype.hasTransition=function(){return this._playing},o.prototype._hasInvalidDimensions=function(){for(var i=0,s=[this.canvas.width,this.canvas.height];i<s.length;i+=1){var p=s[i];if(isNaN(p)||p<=0)return!0}return!1},o}(Pi),gi={vector:ho,raster:Bn,"raster-dem":yi,geojson:Cn,video:Zn,image:Pi,canvas:$i};function ki(n,o){var i=l.identity([]);return l.translate(i,i,[1,1,0]),l.scale(i,i,[.5*n.width,.5*n.height,1]),l.multiply(i,i,n.calculatePosMatrix(o.toUnwrapped()))}function fn(n,o,i,s,p,d){var m=function(tt,q,Q){if(tt)for(var at=0,mt=tt;at<mt.length;at+=1){var Ct=q[mt[at]];if(Ct&&Ct.source===Q&&Ct.type==="fill-extrusion")return!0}else for(var wt in q){var At=q[wt];if(At.source===Q&&At.type==="fill-extrusion")return!0}return!1}(p&&p.layers,o,n.id),_=d.maxPitchScaleFactor(),S=n.tilesIn(s,_,m);S.sort(vi);for(var P=[],B=0,F=S;B<F.length;B+=1){var N=F[B];P.push({wrappedTileID:N.tileID.wrapped().key,queryResults:N.tile.queryRenderedFeatures(o,i,n._state,N.queryGeometry,N.cameraQueryGeometry,N.scale,p,d,_,ki(n.transform,N.tileID))})}var H=function(tt){for(var q={},Q={},at=0,mt=tt;at<mt.length;at+=1){var Ct=mt[at],wt=Ct.queryResults,At=Ct.wrappedTileID,Rt=Q[At]=Q[At]||{};for(var Zt in wt)for(var qt=wt[Zt],ce=Rt[Zt]=Rt[Zt]||{},we=q[Zt]=q[Zt]||[],Ie=0,Te=qt;Ie<Te.length;Ie+=1){var fr=Te[Ie];ce[fr.featureIndex]||(ce[fr.featureIndex]=!0,we.push(fr))}}return q}(P);for(var W in H)H[W].forEach(function(tt){var q=tt.feature,Q=n.getFeatureState(q.layer["source-layer"],q.id);q.source=q.layer.source,q.layer["source-layer"]&&(q.sourceLayer=q.layer["source-layer"]),q.state=Q});return H}function vi(n,o){var i=n.tileID,s=o.tileID;return i.overscaledZ-s.overscaledZ||i.canonical.y-s.canonical.y||i.wrap-s.wrap||i.canonical.x-s.canonical.x}var Kt=function(n,o){this.max=n,this.onRemove=o,this.reset()};Kt.prototype.reset=function(){for(var n in this.data)for(var o=0,i=this.data[n];o<i.length;o+=1){var s=i[o];s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value)}return this.data={},this.order=[],this},Kt.prototype.add=function(n,o,i){var s=this,p=n.wrapped().key;this.data[p]===void 0&&(this.data[p]=[]);var d={value:o,timeout:void 0};if(i!==void 0&&(d.timeout=setTimeout(function(){s.remove(n,d)},i)),this.data[p].push(d),this.order.push(p),this.order.length>this.max){var m=this._getAndRemoveByKey(this.order[0]);m&&this.onRemove(m)}return this},Kt.prototype.has=function(n){return n.wrapped().key in this.data},Kt.prototype.getAndRemove=function(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null},Kt.prototype._getAndRemoveByKey=function(n){var o=this.data[n].shift();return o.timeout&&clearTimeout(o.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),o.value},Kt.prototype.getByKey=function(n){var o=this.data[n];return o?o[0].value:null},Kt.prototype.get=function(n){return this.has(n)?this.data[n.wrapped().key][0].value:null},Kt.prototype.remove=function(n,o){if(!this.has(n))return this;var i=n.wrapped().key,s=o===void 0?0:this.data[i].indexOf(o),p=this.data[i][s];return this.data[i].splice(s,1),p.timeout&&clearTimeout(p.timeout),this.data[i].length===0&&delete this.data[i],this.onRemove(p.value),this.order.splice(this.order.indexOf(i),1),this},Kt.prototype.setMaxSize=function(n){for(this.max=n;this.order.length>this.max;){var o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this},Kt.prototype.filter=function(n){var o=[];for(var i in this.data)for(var s=0,p=this.data[i];s<p.length;s+=1){var d=p[s];n(d.value)||o.push(d)}for(var m=0,_=o;m<_.length;m+=1){var S=_[m];this.remove(S.value.tileID,S)}};var vn=function(n,o,i){this.context=n;var s=n.gl;this.buffer=s.createBuffer(),this.dynamicDraw=!!i,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),s.bufferData(s.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?s.DYNAMIC_DRAW:s.STATIC_DRAW),this.dynamicDraw||delete o.arrayBuffer};vn.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},vn.prototype.updateData=function(n){var o=this.context.gl;this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)},vn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var _n={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},qe=function(n,o,i,s){this.length=o.length,this.attributes=i,this.itemSize=o.bytesPerElement,this.dynamicDraw=s,this.context=n;var p=n.gl;this.buffer=p.createBuffer(),n.bindVertexBuffer.set(this.buffer),p.bufferData(p.ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete o.arrayBuffer};qe.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},qe.prototype.updateData=function(n){var o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,n.arrayBuffer)},qe.prototype.enableAttributes=function(n,o){for(var i=0;i<this.attributes.length;i++){var s=o.attributes[this.attributes[i].name];s!==void 0&&n.enableVertexAttribArray(s)}},qe.prototype.setVertexAttribPointers=function(n,o,i){for(var s=0;s<this.attributes.length;s++){var p=this.attributes[s],d=o.attributes[p.name];d!==void 0&&n.vertexAttribPointer(d,p.components,n[_n[p.type]],!1,this.itemSize,p.offset+this.itemSize*(i||0))}},qe.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var We=function(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};We.prototype.get=function(){return this.current},We.prototype.set=function(n){},We.prototype.getDefault=function(){return this.default},We.prototype.setDefault=function(){this.set(this.default)};var _i=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){return l.Color.transparent},o.prototype.set=function(i){var s=this.current;(i.r!==s.r||i.g!==s.g||i.b!==s.b||i.a!==s.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)},o}(We),mr=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){return 1},o.prototype.set=function(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)},o}(We),Ve=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){return 0},o.prototype.set=function(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)},o}(We),ra=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){return[!0,!0,!0,!0]},o.prototype.set=function(i){var s=this.current;(i[0]!==s[0]||i[1]!==s[1]||i[2]!==s[2]||i[3]!==s[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)},o}(We),xi=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){return!0},o.prototype.set=function(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)},o}(We),Xo=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){return 255},o.prototype.set=function(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)},o}(We),dn=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},o.prototype.set=function(i){var s=this.current;(i.func!==s.func||i.ref!==s.ref||i.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)},o}(We),An=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){var i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]},o.prototype.set=function(i){var s=this.current;(i[0]!==s[0]||i[1]!==s[1]||i[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)},o}(We),_r=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){return!1},o.prototype.set=function(i){if(i!==this.current||this.dirty){var s=this.gl;i?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=i,this.dirty=!1}},o}(We),xn=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){return[0,1]},o.prototype.set=function(i){var s=this.current;(i[0]!==s[0]||i[1]!==s[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)},o}(We),Hn=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){return!1},o.prototype.set=function(i){if(i!==this.current||this.dirty){var s=this.gl;i?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=i,this.dirty=!1}},o}(We),bi=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){return this.gl.LESS},o.prototype.set=function(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)},o}(We),rn=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){return!1},o.prototype.set=function(i){if(i!==this.current||this.dirty){var s=this.gl;i?s.enable(s.BLEND):s.disable(s.BLEND),this.current=i,this.dirty=!1}},o}(We),Gn=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){var i=this.gl;return[i.ONE,i.ZERO]},o.prototype.set=function(i){var s=this.current;(i[0]!==s[0]||i[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(i[0],i[1]),this.current=i,this.dirty=!1)},o}(We),fo=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){return l.Color.transparent},o.prototype.set=function(i){var s=this.current;(i.r!==s.r||i.g!==s.g||i.b!==s.b||i.a!==s.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)},o}(We),Mi=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){return this.gl.FUNC_ADD},o.prototype.set=function(i){(i!==this.current||this.dirty)&&(this.gl.blendEquation(i),this.current=i,this.dirty=!1)},o}(We),zi=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){return!1},o.prototype.set=function(i){if(i!==this.current||this.dirty){var s=this.gl;i?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=i,this.dirty=!1}},o}(We),Di=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){return this.gl.BACK},o.prototype.set=function(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)},o}(We),Pn=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){return this.gl.CCW},o.prototype.set=function(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)},o}(We),wi=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){return null},o.prototype.set=function(i){(i!==this.current||this.dirty)&&(this.gl.useProgram(i),this.current=i,this.dirty=!1)},o}(We),Li=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){return this.gl.TEXTURE0},o.prototype.set=function(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)},o}(We),kn=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){var i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]},o.prototype.set=function(i){var s=this.current;(i[0]!==s[0]||i[1]!==s[1]||i[2]!==s[2]||i[3]!==s[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)},o}(We),xe=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){return null},o.prototype.set=function(i){if(i!==this.current||this.dirty){var s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,i),this.current=i,this.dirty=!1}},o}(We),ii=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){return null},o.prototype.set=function(i){if(i!==this.current||this.dirty){var s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,i),this.current=i,this.dirty=!1}},o}(We),Jn=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){return null},o.prototype.set=function(i){if(i!==this.current||this.dirty){var s=this.gl;s.bindTexture(s.TEXTURE_2D,i),this.current=i,this.dirty=!1}},o}(We),Oi=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){return null},o.prototype.set=function(i){if(i!==this.current||this.dirty){var s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}},o}(We),pe=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){return null},o.prototype.set=function(i){var s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1},o}(We),mn=function(n){function o(i){n.call(this,i),this.vao=i.extVertexArrayObject}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){return null},o.prototype.set=function(i){this.vao&&(i!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(i),this.current=i,this.dirty=!1)},o}(We),oi=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){return 4},o.prototype.set=function(i){if(i!==this.current||this.dirty){var s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}},o}(We),Yn=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){return!1},o.prototype.set=function(i){if(i!==this.current||this.dirty){var s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}},o}(We),mo=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){return!1},o.prototype.set=function(i){if(i!==this.current||this.dirty){var s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}},o}(We),Tr=function(n){function o(i,s){n.call(this,i),this.context=i,this.parent=s}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getDefault=function(){return null},o}(We),C=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.setDirty=function(){this.dirty=!0},o.prototype.set=function(i){if(i!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}},o}(Tr),M=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.set=function(i){if(i!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,i),this.current=i,this.dirty=!1}},o}(Tr),D=function(n,o,i,s){this.context=n,this.width=o,this.height=i;var p=this.framebuffer=n.gl.createFramebuffer();this.colorAttachment=new C(n,p),s&&(this.depthAttachment=new M(n,p))};D.prototype.destroy=function(){var n=this.context.gl,o=this.colorAttachment.get();if(o&&n.deleteTexture(o),this.depthAttachment){var i=this.depthAttachment.get();i&&n.deleteRenderbuffer(i)}n.deleteFramebuffer(this.framebuffer)};var U=function(n,o,i){this.func=n,this.mask=o,this.range=i};U.ReadOnly=!1,U.ReadWrite=!0,U.disabled=new U(519,U.ReadOnly,[0,1]);var G=function(n,o,i,s,p,d){this.test=n,this.ref=o,this.mask=i,this.fail=s,this.depthFail=p,this.pass=d};G.disabled=new G({func:519,mask:0},0,0,7680,7680,7680);var nt=function(n,o,i){this.blendFunction=n,this.blendColor=o,this.mask=i};nt.disabled=new nt(nt.Replace=[1,0],l.Color.transparent,[!1,!1,!1,!1]),nt.unblended=new nt(nt.Replace,l.Color.transparent,[!0,!0,!0,!0]),nt.alphaBlended=new nt([1,771],l.Color.transparent,[!0,!0,!0,!0]);var $=function(n,o,i){this.enable=n,this.mode=o,this.frontFace=i};$.disabled=new $(!1,1029,2305),$.backCCW=new $(!0,1029,2305);var L=function(n){this.gl=n,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new _i(this),this.clearDepth=new mr(this),this.clearStencil=new Ve(this),this.colorMask=new ra(this),this.depthMask=new xi(this),this.stencilMask=new Xo(this),this.stencilFunc=new dn(this),this.stencilOp=new An(this),this.stencilTest=new _r(this),this.depthRange=new xn(this),this.depthTest=new Hn(this),this.depthFunc=new bi(this),this.blend=new rn(this),this.blendFunc=new Gn(this),this.blendColor=new fo(this),this.blendEquation=new Mi(this),this.cullFace=new zi(this),this.cullFaceSide=new Di(this),this.frontFace=new Pn(this),this.program=new wi(this),this.activeTexture=new Li(this),this.viewport=new kn(this),this.bindFramebuffer=new xe(this),this.bindRenderbuffer=new ii(this),this.bindTexture=new Jn(this),this.bindVertexBuffer=new Oi(this),this.bindElementBuffer=new pe(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new mn(this),this.pixelStoreUnpack=new oi(this),this.pixelStoreUnpackPremultiplyAlpha=new Yn(this),this.pixelStoreUnpackFlipY=new mo(this),this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=n.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(n.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE)};L.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},L.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},L.prototype.createIndexBuffer=function(n,o){return new vn(this,n,o)},L.prototype.createVertexBuffer=function(n,o,i){return new qe(this,n,o,i)},L.prototype.createRenderbuffer=function(n,o,i){var s=this.gl,p=s.createRenderbuffer();return this.bindRenderbuffer.set(p),s.renderbufferStorage(s.RENDERBUFFER,n,o,i),this.bindRenderbuffer.set(null),p},L.prototype.createFramebuffer=function(n,o,i){return new D(this,n,o,i)},L.prototype.clear=function(n){var o=n.color,i=n.depth,s=this.gl,p=0;o&&(p|=s.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set([!0,!0,!0,!0])),i!==void 0&&(p|=s.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(i),this.depthMask.set(!0)),s.clear(p)},L.prototype.setCullFace=function(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))},L.prototype.setDepthMode=function(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)},L.prototype.setStencilMode=function(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)},L.prototype.setColorMode=function(n){l.deepEqual(n.blendFunction,nt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor)),this.colorMask.set(n.mask)},L.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var J=function(n){function o(i,s,p){var d=this;n.call(this),this.id=i,this.dispatcher=p,this.on("data",function(m){m.dataType==="source"&&m.sourceDataType==="metadata"&&(d._sourceLoaded=!0),d._sourceLoaded&&!d._paused&&m.dataType==="source"&&m.sourceDataType==="content"&&(d.reload(),d.transform&&d.update(d.transform))}),this.on("error",function(){d._sourceErrored=!0}),this._source=function(m,_,S,P){var B=new gi[_.type](m,_,S,P);if(B.id!==m)throw new Error("Expected Source id to be "+m+" instead of "+B.id);return l.bindAll(["load","abort","unload","serialize","prepare"],B),B}(i,s,p,this),this._tiles={},this._cache=new Kt(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new l.SourceFeatureState}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.onAdd=function(i){this.map=i,this._maxTileCacheSize=i?i._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(i)},o.prototype.onRemove=function(i){this._source&&this._source.onRemove&&this._source.onRemove(i)},o.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var i in this._tiles){var s=this._tiles[i];if(s.state!=="loaded"&&s.state!=="errored")return!1}return!0},o.prototype.getSource=function(){return this._source},o.prototype.pause=function(){this._paused=!0},o.prototype.resume=function(){if(this._paused){var i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform)}},o.prototype._loadTile=function(i,s){return this._source.loadTile(i,s)},o.prototype._unloadTile=function(i){if(this._source.unloadTile)return this._source.unloadTile(i,function(){})},o.prototype._abortTile=function(i){if(this._source.abortTile)return this._source.abortTile(i,function(){})},o.prototype.serialize=function(){return this._source.serialize()},o.prototype.prepare=function(i){for(var s in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var p=this._tiles[s];p.upload(i),p.prepare(this.map.style.imageManager)}},o.prototype.getIds=function(){return l.values(this._tiles).map(function(i){return i.tileID}).sort(st).map(function(i){return i.key})},o.prototype.getRenderableIds=function(i){var s=this,p=[];for(var d in this._tiles)this._isIdRenderable(d,i)&&p.push(this._tiles[d]);return i?p.sort(function(m,_){var S=m.tileID,P=_.tileID,B=new l.Point(S.canonical.x,S.canonical.y)._rotate(s.transform.angle),F=new l.Point(P.canonical.x,P.canonical.y)._rotate(s.transform.angle);return S.overscaledZ-P.overscaledZ||F.y-B.y||F.x-B.x}).map(function(m){return m.tileID.key}):p.map(function(m){return m.tileID}).sort(st).map(function(m){return m.key})},o.prototype.hasRenderableParent=function(i){var s=this.findLoadedParent(i,0);return!!s&&this._isIdRenderable(s.tileID.key)},o.prototype._isIdRenderable=function(i,s){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(s||!this._tiles[i].holdingForFade())},o.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var i in this._cache.reset(),this._tiles)this._tiles[i].state!=="errored"&&this._reloadTile(i,"reloading")},o.prototype._reloadTile=function(i,s){var p=this._tiles[i];p&&(p.state!=="loading"&&(p.state=s),this._loadTile(p,this._tileLoaded.bind(this,p,i,s)))},o.prototype._tileLoaded=function(i,s,p,d){if(d)return i.state="errored",void(d.status!==404?this._source.fire(new l.ErrorEvent(d,{tile:i})):this.update(this.transform));i.timeAdded=l.browser.now(),p==="expired"&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(s,i),this.getSource().type==="raster-dem"&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),this._source.fire(new l.Event("data",{dataType:"source",tile:i,coord:i.tileID}))},o.prototype._backfillDEM=function(i){for(var s=this.getRenderableIds(),p=0;p<s.length;p++){var d=s[p];if(i.neighboringTiles&&i.neighboringTiles[d]){var m=this.getTileByID(d);_(i,m),_(m,i)}}function _(S,P){S.needsHillshadePrepare=!0;var B=P.tileID.canonical.x-S.tileID.canonical.x,F=P.tileID.canonical.y-S.tileID.canonical.y,N=Math.pow(2,S.tileID.canonical.z),H=P.tileID.key;B===0&&F===0||Math.abs(F)>1||(Math.abs(B)>1&&(Math.abs(B+N)===1?B+=N:Math.abs(B-N)===1&&(B-=N)),P.dem&&S.dem&&(S.dem.backfillBorder(P.dem,B,F),S.neighboringTiles&&S.neighboringTiles[H]&&(S.neighboringTiles[H].backfilled=!0)))}},o.prototype.getTile=function(i){return this.getTileByID(i.key)},o.prototype.getTileByID=function(i){return this._tiles[i]},o.prototype._retainLoadedChildren=function(i,s,p,d){for(var m in this._tiles){var _=this._tiles[m];if(!(d[m]||!_.hasData()||_.tileID.overscaledZ<=s||_.tileID.overscaledZ>p)){for(var S=_.tileID;_&&_.tileID.overscaledZ>s+1;){var P=_.tileID.scaledTo(_.tileID.overscaledZ-1);(_=this._tiles[P.key])&&_.hasData()&&(S=P)}for(var B=S;B.overscaledZ>s;)if(i[(B=B.scaledTo(B.overscaledZ-1)).key]){d[S.key]=S;break}}}},o.prototype.findLoadedParent=function(i,s){if(i.key in this._loadedParentTiles){var p=this._loadedParentTiles[i.key];return p&&p.tileID.overscaledZ>=s?p:null}for(var d=i.overscaledZ-1;d>=s;d--){var m=i.scaledTo(d),_=this._getLoadedTile(m);if(_)return _}},o.prototype._getLoadedTile=function(i){var s=this._tiles[i.key];return s&&s.hasData()?s:this._cache.getByKey(i.wrapped().key)},o.prototype.updateCacheSize=function(i){var s=Math.ceil(i.width/this._source.tileSize)+1,p=Math.ceil(i.height/this._source.tileSize)+1,d=Math.floor(s*p*5),m=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,d):d;this._cache.setMaxSize(m)},o.prototype.handleWrapJump=function(i){var s=Math.round((i-(this._prevLng===void 0?i:this._prevLng))/360);if(this._prevLng=i,s){var p={};for(var d in this._tiles){var m=this._tiles[d];m.tileID=m.tileID.unwrapTo(m.tileID.wrap+s),p[m.tileID.key]=m}for(var _ in this._tiles=p,this._timers)clearTimeout(this._timers[_]),delete this._timers[_];for(var S in this._tiles)this._setTileReloadTimer(S,this._tiles[S])}},o.prototype.update=function(i){var s=this;if(this.transform=i,this._sourceLoaded&&!this._paused){var p;this.updateCacheSize(i),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?p=i.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(Rt){return new l.OverscaledTileID(Rt.canonical.z,Rt.wrap,Rt.canonical.z,Rt.canonical.x,Rt.canonical.y)}):(p=i.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(p=p.filter(function(Rt){return s._source.hasTile(Rt)}))):p=[];var d=i.coveringZoomLevel(this._source),m=Math.max(d-o.maxOverzooming,this._source.minzoom),_=Math.max(d+o.maxUnderzooming,this._source.minzoom),S=this._updateRetainedTiles(p,d);if(zt(this._source.type)){for(var P={},B={},F=0,N=Object.keys(S);F<N.length;F+=1){var H=N[F],W=S[H],tt=this._tiles[H];if(tt&&!(tt.fadeEndTime&&tt.fadeEndTime<=l.browser.now())){var q=this.findLoadedParent(W,m);q&&(this._addTile(q.tileID),P[q.tileID.key]=q.tileID),B[H]=W}}for(var Q in this._retainLoadedChildren(B,d,_,S),P)S[Q]||(this._coveredTiles[Q]=!0,S[Q]=P[Q])}for(var at in S)this._tiles[at].clearFadeHold();for(var mt=0,Ct=l.keysDifference(this._tiles,S);mt<Ct.length;mt+=1){var wt=Ct[mt],At=this._tiles[wt];At.hasSymbolBuckets&&!At.holdingForFade()?At.setHoldDuration(this.map._fadeDuration):At.hasSymbolBuckets&&!At.symbolFadeFinished()||this._removeTile(wt)}this._updateLoadedParentTileCache()}},o.prototype.releaseSymbolFadeTiles=function(){for(var i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(i)},o.prototype._updateRetainedTiles=function(i,s){for(var p={},d={},m=Math.max(s-o.maxOverzooming,this._source.minzoom),_=Math.max(s+o.maxUnderzooming,this._source.minzoom),S={},P=0,B=i;P<B.length;P+=1){var F=B[P],N=this._addTile(F);p[F.key]=F,N.hasData()||s<this._source.maxzoom&&(S[F.key]=F)}this._retainLoadedChildren(S,s,_,p);for(var H=0,W=i;H<W.length;H+=1){var tt=W[H],q=this._tiles[tt.key];if(!q.hasData()){if(s+1>this._source.maxzoom){var Q=tt.children(this._source.maxzoom)[0],at=this.getTile(Q);if(at&&at.hasData()){p[Q.key]=Q;continue}}else{var mt=tt.children(this._source.maxzoom);if(p[mt[0].key]&&p[mt[1].key]&&p[mt[2].key]&&p[mt[3].key])continue}for(var Ct=q.wasRequested(),wt=tt.overscaledZ-1;wt>=m;--wt){var At=tt.scaledTo(wt);if(d[At.key]||(d[At.key]=!0,!(q=this.getTile(At))&&Ct&&(q=this._addTile(At)),q&&(p[At.key]=At,Ct=q.wasRequested(),q.hasData())))break}}}return p},o.prototype._updateLoadedParentTileCache=function(){for(var i in this._loadedParentTiles={},this._tiles){for(var s=[],p=void 0,d=this._tiles[i].tileID;d.overscaledZ>0;){if(d.key in this._loadedParentTiles){p=this._loadedParentTiles[d.key];break}s.push(d.key);var m=d.scaledTo(d.overscaledZ-1);if(p=this._getLoadedTile(m))break;d=m}for(var _=0,S=s;_<S.length;_+=1)this._loadedParentTiles[S[_]]=p}},o.prototype._addTile=function(i){var s=this._tiles[i.key];if(s)return s;(s=this._cache.getAndRemove(i))&&(this._setTileReloadTimer(i.key,s),s.tileID=i,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,s)));var p=!!s;return p||(s=new l.Tile(i,this._source.tileSize*i.overscaleFactor()),this._loadTile(s,this._tileLoaded.bind(this,s,i.key,s.state))),s?(s.uses++,this._tiles[i.key]=s,p||this._source.fire(new l.Event("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s):null},o.prototype._setTileReloadTimer=function(i,s){var p=this;i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);var d=s.getExpiryTimeout();d&&(this._timers[i]=setTimeout(function(){p._reloadTile(i,"expired"),delete p._timers[i]},d))},o.prototype._removeTile=function(i){var s=this._tiles[i];s&&(s.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),s.uses>0||(s.hasData()&&s.state!=="reloading"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))},o.prototype.clearTiles=function(){for(var i in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(i);this._cache.reset()},o.prototype.tilesIn=function(i,s,p){var d=this,m=[],_=this.transform;if(!_)return m;for(var S=p?_.getCameraQueryGeometry(i):i,P=i.map(function(wt){return _.pointCoordinate(wt)}),B=S.map(function(wt){return _.pointCoordinate(wt)}),F=this.getIds(),N=1/0,H=1/0,W=-1/0,tt=-1/0,q=0,Q=B;q<Q.length;q+=1){var at=Q[q];N=Math.min(N,at.x),H=Math.min(H,at.y),W=Math.max(W,at.x),tt=Math.max(tt,at.y)}for(var mt=function(wt){var At=d._tiles[F[wt]];if(!At.holdingForFade()){var Rt=At.tileID,Zt=Math.pow(2,_.zoom-At.tileID.overscaledZ),qt=s*At.queryPadding*l.EXTENT/At.tileSize/Zt,ce=[Rt.getTilePoint(new l.MercatorCoordinate(N,H)),Rt.getTilePoint(new l.MercatorCoordinate(W,tt))];if(ce[0].x-qt<l.EXTENT&&ce[0].y-qt<l.EXTENT&&ce[1].x+qt>=0&&ce[1].y+qt>=0){var we=P.map(function(Te){return Rt.getTilePoint(Te)}),Ie=B.map(function(Te){return Rt.getTilePoint(Te)});m.push({tile:At,tileID:Rt,queryGeometry:we,cameraQueryGeometry:Ie,scale:Zt})}}},Ct=0;Ct<F.length;Ct++)mt(Ct);return m},o.prototype.getVisibleCoordinates=function(i){for(var s=this,p=this.getRenderableIds(i).map(function(S){return s._tiles[S].tileID}),d=0,m=p;d<m.length;d+=1){var _=m[d];_.posMatrix=this.transform.calculatePosMatrix(_.toUnwrapped())}return p},o.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(zt(this._source.type))for(var i in this._tiles){var s=this._tiles[i];if(s.fadeEndTime!==void 0&&s.fadeEndTime>=l.browser.now())return!0}return!1},o.prototype.setFeatureState=function(i,s,p){this._state.updateState(i=i||"_geojsonTileLayer",s,p)},o.prototype.removeFeatureState=function(i,s,p){this._state.removeFeatureState(i=i||"_geojsonTileLayer",s,p)},o.prototype.getFeatureState=function(i,s){return this._state.getState(i=i||"_geojsonTileLayer",s)},o.prototype.setDependencies=function(i,s,p){var d=this._tiles[i];d&&d.setDependencies(s,p)},o.prototype.reloadTilesForDependencies=function(i,s){for(var p in this._tiles)this._tiles[p].hasDependency(i,s)&&this._reloadTile(p,"reloading");this._cache.filter(function(d){return!d.hasDependency(i,s)})},o}(l.Evented);function st(n,o){var i=Math.abs(2*n.wrap)-+(n.wrap<0),s=Math.abs(2*o.wrap)-+(o.wrap<0);return n.overscaledZ-o.overscaledZ||s-i||o.canonical.y-n.canonical.y||o.canonical.x-n.canonical.x}function zt(n){return n==="raster"||n==="image"||n==="video"}function Bt(){return new l.window.Worker(Js.workerUrl)}J.maxOverzooming=10,J.maxUnderzooming=3;var Et="mapboxgl_preloaded_worker_pool",kt=function(){this.active={}};kt.prototype.acquire=function(n){if(!this.workers)for(this.workers=[];this.workers.length<kt.workerCount;)this.workers.push(new Bt);return this.active[n]=!0,this.workers.slice()},kt.prototype.release=function(n){delete this.active[n],this.numActive()===0&&(this.workers.forEach(function(o){o.terminate()}),this.workers=null)},kt.prototype.isPreloaded=function(){return!!this.active[Et]},kt.prototype.numActive=function(){return Object.keys(this.active).length};var oe,Wt=Math.floor(l.browser.hardwareConcurrency/2);function St(){return oe||(oe=new kt),oe}function ie(n,o){var i={};for(var s in n)s!=="ref"&&(i[s]=n[s]);return l.refProperties.forEach(function(p){p in o&&(i[p]=o[p])}),i}function jt(n){n=n.slice();for(var o=Object.create(null),i=0;i<n.length;i++)o[n[i].id]=n[i];for(var s=0;s<n.length;s++)"ref"in n[s]&&(n[s]=ie(n[s],o[n[s].ref]));return n}kt.workerCount=Math.max(Math.min(Wt,6),1);var Yt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Re(n,o,i){i.push({command:Yt.addSource,args:[n,o[n]]})}function te(n,o,i){o.push({command:Yt.removeSource,args:[n]}),i[n]=!0}function Ye(n,o,i,s){te(n,i,s),Re(n,o,i)}function Fe(n,o,i){var s;for(s in n[i])if(n[i].hasOwnProperty(s)&&s!=="data"&&!l.deepEqual(n[i][s],o[i][s]))return!1;for(s in o[i])if(o[i].hasOwnProperty(s)&&s!=="data"&&!l.deepEqual(n[i][s],o[i][s]))return!1;return!0}function Ne(n,o,i,s,p,d){var m;for(m in o=o||{},n=n||{})n.hasOwnProperty(m)&&(l.deepEqual(n[m],o[m])||i.push({command:d,args:[s,m,o[m],p]}));for(m in o)o.hasOwnProperty(m)&&!n.hasOwnProperty(m)&&(l.deepEqual(n[m],o[m])||i.push({command:d,args:[s,m,o[m],p]}))}function He(n){return n.id}function er(n,o){return n[o.id]=o,n}var Zr=function(n,o){this.reset(n,o)};Zr.prototype.reset=function(n,o){this.points=n||[],this._distances=[0];for(var i=1;i<this.points.length;i++)this._distances[i]=this._distances[i-1]+this.points[i].dist(this.points[i-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,.5*this.length),this.paddedLength=this.length-2*this.padding},Zr.prototype.lerp=function(n){if(this.points.length===1)return this.points[0];n=l.clamp(n,0,1);for(var o=1,i=this._distances[o],s=n*this.paddedLength+this.padding;i<s&&o<this._distances.length;)i=this._distances[++o];var p=o-1,d=this._distances[p],m=i-d,_=m>0?(s-d)/m:0;return this.points[p].mult(1-_).add(this.points[o].mult(_))};var ur=function(n,o,i){var s=this.boxCells=[],p=this.circleCells=[];this.xCellCount=Math.ceil(n/i),this.yCellCount=Math.ceil(o/i);for(var d=0;d<this.xCellCount*this.yCellCount;d++)s.push([]),p.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=o,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/o,this.boxUid=0,this.circleUid=0};function kr(n,o,i,s,p){var d=l.create();return o?(l.scale(d,d,[1/p,1/p,1]),i||l.rotateZ(d,d,s.angle)):l.multiply(d,s.labelPlaneMatrix,n),d}function yr(n,o,i,s,p){if(o){var d=l.clone(n);return l.scale(d,d,[p,p,1]),i||l.rotateZ(d,d,-s.angle),d}return s.glCoordMatrix}function Ze(n,o){var i=[n.x,n.y,0,1];Vt(i,i,o);var s=i[3];return{point:new l.Point(i[0]/s,i[1]/s),signedDistanceFromCamera:s}}function lr(n,o){return .5+n/o*.5}function Gr(n,o){var i=n[0]/n[3],s=n[1]/n[3];return i>=-o[0]&&i<=o[0]&&s>=-o[1]&&s<=o[1]}function v(n,o,i,s,p,d,m,_){var S=s?n.textSizeData:n.iconSizeData,P=l.evaluateSizeForZoom(S,i.transform.zoom),B=[256/i.width*2+1,256/i.height*2+1],F=s?n.text.dynamicLayoutVertexArray:n.icon.dynamicLayoutVertexArray;F.clear();for(var N=n.lineVertexArray,H=s?n.text.placedSymbolArray:n.icon.placedSymbolArray,W=i.transform.width/i.transform.height,tt=!1,q=0;q<H.length;q++){var Q=H.get(q);if(Q.hidden||Q.writingMode===l.WritingMode.vertical&&!tt)Gt(Q.numGlyphs,F);else{tt=!1;var at=[Q.anchorX,Q.anchorY,0,1];if(l.transformMat4(at,at,o),Gr(at,B)){var mt=lr(i.transform.cameraToCenterDistance,at[3]),Ct=l.evaluateSizeForFeature(S,P,Q),wt=m?Ct/mt:Ct*mt,At=new l.Point(Q.anchorX,Q.anchorY),Rt=Ze(At,p).point,Zt={},qt=bt(Q,wt,!1,_,o,p,d,n.glyphOffsetArray,N,F,Rt,At,Zt,W);tt=qt.useVertical,(qt.notEnoughRoom||tt||qt.needsFlipping&&bt(Q,wt,!0,_,o,p,d,n.glyphOffsetArray,N,F,Rt,At,Zt,W).notEnoughRoom)&&Gt(Q.numGlyphs,F)}else Gt(Q.numGlyphs,F)}}s?n.text.dynamicLayoutVertexBuffer.updateData(F):n.icon.dynamicLayoutVertexBuffer.updateData(F)}function E(n,o,i,s,p,d,m,_,S,P,B){var F=_.glyphStartIndex+_.numGlyphs,N=_.lineStartIndex,H=_.lineStartIndex+_.lineLength,W=o.getoffsetX(_.glyphStartIndex),tt=o.getoffsetX(F-1),q=V(n*W,i,s,p,d,m,_.segment,N,H,S,P,B);if(!q)return null;var Q=V(n*tt,i,s,p,d,m,_.segment,N,H,S,P,B);return Q?{first:q,last:Q}:null}function j(n,o,i,s){return n===l.WritingMode.horizontal&&Math.abs(i.y-o.y)>Math.abs(i.x-o.x)*s?{useVertical:!0}:(n===l.WritingMode.vertical?o.y<i.y:o.x>i.x)?{needsFlipping:!0}:null}function bt(n,o,i,s,p,d,m,_,S,P,B,F,N,H){var W,tt=o/24,q=n.lineOffsetX*tt,Q=n.lineOffsetY*tt;if(n.numGlyphs>1){var at=n.glyphStartIndex+n.numGlyphs,mt=n.lineStartIndex,Ct=n.lineStartIndex+n.lineLength,wt=E(tt,_,q,Q,i,B,F,n,S,d,N);if(!wt)return{notEnoughRoom:!0};var At=Ze(wt.first.point,m).point,Rt=Ze(wt.last.point,m).point;if(s&&!i){var Zt=j(n.writingMode,At,Rt,H);if(Zt)return Zt}W=[wt.first];for(var qt=n.glyphStartIndex+1;qt<at-1;qt++)W.push(V(tt*_.getoffsetX(qt),q,Q,i,B,F,n.segment,mt,Ct,S,d,N));W.push(wt.last)}else{if(s&&!i){var ce=Ze(F,p).point,we=n.lineStartIndex+n.segment+1,Ie=new l.Point(S.getx(we),S.gety(we)),Te=Ze(Ie,p),fr=Te.signedDistanceFromCamera>0?Te.point:ut(F,Ie,ce,1,p),de=j(n.writingMode,ce,fr,H);if(de)return de}var Ue=V(tt*_.getoffsetX(n.glyphStartIndex),q,Q,i,B,F,n.segment,n.lineStartIndex,n.lineStartIndex+n.lineLength,S,d,N);if(!Ue)return{notEnoughRoom:!0};W=[Ue]}for(var Je=0,Be=W;Je<Be.length;Je+=1){var Le=Be[Je];l.addDynamicAttributes(P,Le.point,Le.angle)}return{}}function ut(n,o,i,s,p){var d=Ze(n.add(n.sub(o)._unit()),p).point,m=i.sub(d);return i.add(m._mult(s/m.mag()))}function V(n,o,i,s,p,d,m,_,S,P,B,F){var N=s?n-o:n+o,H=N>0?1:-1,W=0;s&&(H*=-1,W=Math.PI),H<0&&(W+=Math.PI);for(var tt=H>0?_+m:_+m+1,q=p,Q=p,at=0,mt=0,Ct=Math.abs(N),wt=[];at+mt<=Ct;){if((tt+=H)<_||tt>=S)return null;if(Q=q,wt.push(q),(q=F[tt])===void 0){var At=new l.Point(P.getx(tt),P.gety(tt)),Rt=Ze(At,B);if(Rt.signedDistanceFromCamera>0)q=F[tt]=Rt.point;else{var Zt=tt-H;q=ut(at===0?d:new l.Point(P.getx(Zt),P.gety(Zt)),At,Q,Ct-at+1,B)}}at+=mt,mt=Q.dist(q)}var qt=(Ct-at)/mt,ce=q.sub(Q),we=ce.mult(qt)._add(Q);we._add(ce._unit()._perp()._mult(i*H));var Ie=W+Math.atan2(q.y-Q.y,q.x-Q.x);return wt.push(we),{point:we,angle:Ie,path:wt}}ur.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},ur.prototype.insert=function(n,o,i,s,p){this._forEachCell(o,i,s,p,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(o),this.bboxes.push(i),this.bboxes.push(s),this.bboxes.push(p)},ur.prototype.insertCircle=function(n,o,i,s){this._forEachCell(o-s,i-s,o+s,i+s,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(o),this.circles.push(i),this.circles.push(s)},ur.prototype._insertBoxCell=function(n,o,i,s,p,d){this.boxCells[p].push(d)},ur.prototype._insertCircleCell=function(n,o,i,s,p,d){this.circleCells[p].push(d)},ur.prototype._query=function(n,o,i,s,p,d){if(i<0||n>this.width||s<0||o>this.height)return!p&&[];var m=[];if(n<=0&&o<=0&&this.width<=i&&this.height<=s){if(p)return!0;for(var _=0;_<this.boxKeys.length;_++)m.push({key:this.boxKeys[_],x1:this.bboxes[4*_],y1:this.bboxes[4*_+1],x2:this.bboxes[4*_+2],y2:this.bboxes[4*_+3]});for(var S=0;S<this.circleKeys.length;S++){var P=this.circles[3*S],B=this.circles[3*S+1],F=this.circles[3*S+2];m.push({key:this.circleKeys[S],x1:P-F,y1:B-F,x2:P+F,y2:B+F})}return d?m.filter(d):m}return this._forEachCell(n,o,i,s,this._queryCell,m,{hitTest:p,seenUids:{box:{},circle:{}}},d),p?m.length>0:m},ur.prototype._queryCircle=function(n,o,i,s,p){var d=n-i,m=n+i,_=o-i,S=o+i;if(m<0||d>this.width||S<0||_>this.height)return!s&&[];var P=[];return this._forEachCell(d,_,m,S,this._queryCellCircle,P,{hitTest:s,circle:{x:n,y:o,radius:i},seenUids:{box:{},circle:{}}},p),s?P.length>0:P},ur.prototype.query=function(n,o,i,s,p){return this._query(n,o,i,s,!1,p)},ur.prototype.hitTest=function(n,o,i,s,p){return this._query(n,o,i,s,!0,p)},ur.prototype.hitTestCircle=function(n,o,i,s){return this._queryCircle(n,o,i,!0,s)},ur.prototype._queryCell=function(n,o,i,s,p,d,m,_){var S=m.seenUids,P=this.boxCells[p];if(P!==null)for(var B=this.bboxes,F=0,N=P;F<N.length;F+=1){var H=N[F];if(!S.box[H]){S.box[H]=!0;var W=4*H;if(n<=B[W+2]&&o<=B[W+3]&&i>=B[W+0]&&s>=B[W+1]&&(!_||_(this.boxKeys[H]))){if(m.hitTest)return d.push(!0),!0;d.push({key:this.boxKeys[H],x1:B[W],y1:B[W+1],x2:B[W+2],y2:B[W+3]})}}}var tt=this.circleCells[p];if(tt!==null)for(var q=this.circles,Q=0,at=tt;Q<at.length;Q+=1){var mt=at[Q];if(!S.circle[mt]){S.circle[mt]=!0;var Ct=3*mt;if(this._circleAndRectCollide(q[Ct],q[Ct+1],q[Ct+2],n,o,i,s)&&(!_||_(this.circleKeys[mt]))){if(m.hitTest)return d.push(!0),!0;var wt=q[Ct],At=q[Ct+1],Rt=q[Ct+2];d.push({key:this.circleKeys[mt],x1:wt-Rt,y1:At-Rt,x2:wt+Rt,y2:At+Rt})}}}},ur.prototype._queryCellCircle=function(n,o,i,s,p,d,m,_){var S=m.circle,P=m.seenUids,B=this.boxCells[p];if(B!==null)for(var F=this.bboxes,N=0,H=B;N<H.length;N+=1){var W=H[N];if(!P.box[W]){P.box[W]=!0;var tt=4*W;if(this._circleAndRectCollide(S.x,S.y,S.radius,F[tt+0],F[tt+1],F[tt+2],F[tt+3])&&(!_||_(this.boxKeys[W])))return d.push(!0),!0}}var q=this.circleCells[p];if(q!==null)for(var Q=this.circles,at=0,mt=q;at<mt.length;at+=1){var Ct=mt[at];if(!P.circle[Ct]){P.circle[Ct]=!0;var wt=3*Ct;if(this._circlesCollide(Q[wt],Q[wt+1],Q[wt+2],S.x,S.y,S.radius)&&(!_||_(this.circleKeys[Ct])))return d.push(!0),!0}}},ur.prototype._forEachCell=function(n,o,i,s,p,d,m,_){for(var S=this._convertToXCellCoord(n),P=this._convertToYCellCoord(o),B=this._convertToXCellCoord(i),F=this._convertToYCellCoord(s),N=S;N<=B;N++)for(var H=P;H<=F;H++)if(p.call(this,n,o,i,s,this.xCellCount*H+N,d,m,_))return},ur.prototype._convertToXCellCoord=function(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))},ur.prototype._convertToYCellCoord=function(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))},ur.prototype._circlesCollide=function(n,o,i,s,p,d){var m=s-n,_=p-o,S=i+d;return S*S>m*m+_*_},ur.prototype._circleAndRectCollide=function(n,o,i,s,p,d,m){var _=(d-s)/2,S=Math.abs(n-(s+_));if(S>_+i)return!1;var P=(m-p)/2,B=Math.abs(o-(p+P));if(B>P+i)return!1;if(S<=_||B<=P)return!0;var F=S-_,N=B-P;return F*F+N*N<=i*i};var Nt=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Gt(n,o){for(var i=0;i<n;i++){var s=o.length;o.resize(s+4),o.float32.set(Nt,3*s)}}function Vt(n,o,i){var s=o[0],p=o[1];return n[0]=i[0]*s+i[4]*p+i[12],n[1]=i[1]*s+i[5]*p+i[13],n[3]=i[3]*s+i[7]*p+i[15],n}var Lt=function(n,o,i){o===void 0&&(o=new ur(n.width+200,n.height+200,25)),i===void 0&&(i=new ur(n.width+200,n.height+200,25)),this.transform=n,this.grid=o,this.ignoredGrid=i,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+100,this.screenBottomBoundary=n.height+100,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200};function se(n,o,i){return o*(l.EXTENT/(n.tileSize*Math.pow(2,i-n.tileID.overscaledZ)))}Lt.prototype.placeCollisionBox=function(n,o,i,s,p){var d=this.projectAndGetPerspectiveRatio(s,n.anchorPointX,n.anchorPointY),m=i*d.perspectiveRatio,_=n.x1*m+d.point.x,S=n.y1*m+d.point.y,P=n.x2*m+d.point.x,B=n.y2*m+d.point.y;return!this.isInsideGrid(_,S,P,B)||!o&&this.grid.hitTest(_,S,P,B,p)?{box:[],offscreen:!1}:{box:[_,S,P,B],offscreen:this.isOffscreen(_,S,P,B)}},Lt.prototype.placeCollisionCircles=function(n,o,i,s,p,d,m,_,S,P,B,F,N){var H=[],W=new l.Point(o.anchorX,o.anchorY),tt=Ze(W,d),q=lr(this.transform.cameraToCenterDistance,tt.signedDistanceFromCamera),Q=(P?p/q:p*q)/l.ONE_EM,at=Ze(W,m).point,mt=E(Q,s,o.lineOffsetX*Q,o.lineOffsetY*Q,!1,at,W,o,i,m,{}),Ct=!1,wt=!1,At=!0;if(mt){for(var Rt=.5*F*q+N,Zt=new l.Point(-100,-100),qt=new l.Point(this.screenRightBoundary,this.screenBottomBoundary),ce=new Zr,we=mt.first,Ie=mt.last,Te=[],fr=we.path.length-1;fr>=1;fr--)Te.push(we.path[fr]);for(var de=1;de<Ie.path.length;de++)Te.push(Ie.path[de]);var Ue=2.5*Rt;if(_){var Je=Te.map(function(uo){return Ze(uo,_)});Te=Je.some(function(uo){return uo.signedDistanceFromCamera<=0})?[]:Je.map(function(uo){return uo.point})}var Be=[];if(Te.length>0){for(var Le=Te[0].clone(),Xe=Te[0].clone(),Me=1;Me<Te.length;Me++)Le.x=Math.min(Le.x,Te[Me].x),Le.y=Math.min(Le.y,Te[Me].y),Xe.x=Math.max(Xe.x,Te[Me].x),Xe.y=Math.max(Xe.y,Te[Me].y);Be=Le.x>=Zt.x&&Xe.x<=qt.x&&Le.y>=Zt.y&&Xe.y<=qt.y?[Te]:Xe.x<Zt.x||Le.x>qt.x||Xe.y<Zt.y||Le.y>qt.y?[]:l.clipLine([Te],Zt.x,Zt.y,qt.x,qt.y)}for(var Pe=0,Mn=Be;Pe<Mn.length;Pe+=1){var Qr;ce.reset(Mn[Pe],.25*Rt),Qr=ce.length<=.5*Rt?1:Math.ceil(ce.paddedLength/Ue)+1;for(var ti=0;ti<Qr;ti++){var Un=ti/Math.max(Qr-1,1),Kr=ce.lerp(Un),sn=Kr.x+100,qi=Kr.y+100;H.push(sn,qi,Rt,0);var ci=sn-Rt,da=qi-Rt,Si=sn+Rt,Mo=qi+Rt;if(At=At&&this.isOffscreen(ci,da,Si,Mo),wt=wt||this.isInsideGrid(ci,da,Si,Mo),!n&&this.grid.hitTestCircle(sn,qi,Rt,B)&&(Ct=!0,!S))return{circles:[],offscreen:!1,collisionDetected:Ct}}}}return{circles:!S&&Ct||!wt?[]:H,offscreen:At,collisionDetected:Ct}},Lt.prototype.queryRenderedSymbols=function(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var o=[],i=1/0,s=1/0,p=-1/0,d=-1/0,m=0,_=n;m<_.length;m+=1){var S=_[m],P=new l.Point(S.x+100,S.y+100);i=Math.min(i,P.x),s=Math.min(s,P.y),p=Math.max(p,P.x),d=Math.max(d,P.y),o.push(P)}for(var B={},F={},N=0,H=this.grid.query(i,s,p,d).concat(this.ignoredGrid.query(i,s,p,d));N<H.length;N+=1){var W=H[N],tt=W.key;if(B[tt.bucketInstanceId]===void 0&&(B[tt.bucketInstanceId]={}),!B[tt.bucketInstanceId][tt.featureIndex]){var q=[new l.Point(W.x1,W.y1),new l.Point(W.x2,W.y1),new l.Point(W.x2,W.y2),new l.Point(W.x1,W.y2)];l.polygonIntersectsPolygon(o,q)&&(B[tt.bucketInstanceId][tt.featureIndex]=!0,F[tt.bucketInstanceId]===void 0&&(F[tt.bucketInstanceId]=[]),F[tt.bucketInstanceId].push(tt.featureIndex))}}return F},Lt.prototype.insertCollisionBox=function(n,o,i,s,p){(o?this.ignoredGrid:this.grid).insert({bucketInstanceId:i,featureIndex:s,collisionGroupID:p},n[0],n[1],n[2],n[3])},Lt.prototype.insertCollisionCircles=function(n,o,i,s,p){for(var d=o?this.ignoredGrid:this.grid,m={bucketInstanceId:i,featureIndex:s,collisionGroupID:p},_=0;_<n.length;_+=4)d.insertCircle(m,n[_],n[_+1],n[_+2])},Lt.prototype.projectAndGetPerspectiveRatio=function(n,o,i){var s=[o,i,0,1];return Vt(s,s,n),{point:new l.Point((s[0]/s[3]+1)/2*this.transform.width+100,(-s[1]/s[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/s[3]*.5}},Lt.prototype.isOffscreen=function(n,o,i,s){return i<100||n>=this.screenRightBoundary||s<100||o>this.screenBottomBoundary},Lt.prototype.isInsideGrid=function(n,o,i,s){return i>=0&&n<this.gridRightBoundary&&s>=0&&o<this.gridBottomBoundary},Lt.prototype.getViewportMatrix=function(){var n=l.identity([]);return l.translate(n,n,[-100,-100,0]),n};var Ce=function(n,o,i,s){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?o:-o))):s&&i?1:0,this.placed=i};Ce.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var tr=function(n,o,i,s,p){this.text=new Ce(n?n.text:null,o,i,p),this.icon=new Ce(n?n.icon:null,o,s,p)};tr.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var bn=function(n,o,i){this.text=n,this.icon=o,this.skipFade=i},Mr=function(){this.invProjMatrix=l.create(),this.viewportMatrix=l.create(),this.circles=[]},Ft=function(n,o,i,s,p){this.bucketInstanceId=n,this.featureIndex=o,this.sourceLayerIndex=i,this.bucketIndex=s,this.tileID=p},me=function(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}};function Ke(n,o,i,s,p){var d=l.getAnchorAlignment(n),m=-(d.horizontalAlign-.5)*o,_=-(d.verticalAlign-.5)*i,S=l.evaluateVariableOffset(n,s);return new l.Point(m+S[0]*p,_+S[1]*p)}function ze(n,o,i,s,p,d){var m=n.x1,_=n.x2,S=n.y1,P=n.y2,B=n.anchorPointX,F=n.anchorPointY,N=new l.Point(o,i);return s&&N._rotate(p?d:-d),{x1:m+N.x,y1:S+N.y,x2:_+N.x,y2:P+N.y,anchorPointX:B,anchorPointY:F}}me.prototype.get=function(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){var o=++this.maxGroupID;this.collisionGroups[n]={ID:o,predicate:function(i){return i.collisionGroupID===o}}}return this.collisionGroups[n]};var Fr=function(n,o,i,s){this.transform=n.clone(),this.collisionIndex=new Lt(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=o,this.retainedQueryData={},this.collisionGroups=new me(i),this.collisionCircleArrays={},this.prevPlacement=s,s&&(s.prevPlacement=void 0),this.placedOrientations={}};function Ri(n,o,i,s,p){n.emplaceBack(o?1:0,i?1:0,s||0,p||0),n.emplaceBack(o?1:0,i?1:0,s||0,p||0),n.emplaceBack(o?1:0,i?1:0,s||0,p||0),n.emplaceBack(o?1:0,i?1:0,s||0,p||0)}Fr.prototype.getBucketParts=function(n,o,i,s){var p=i.getBucket(o),d=i.latestFeatureIndex;if(p&&d&&o.id===p.layerIds[0]){var m=i.collisionBoxArray,_=p.layers[0].layout,S=Math.pow(2,this.transform.zoom-i.tileID.overscaledZ),P=i.tileSize/l.EXTENT,B=this.transform.calculatePosMatrix(i.tileID.toUnwrapped()),F=_.get("text-pitch-alignment")==="map",N=_.get("text-rotation-alignment")==="map",H=se(i,1,this.transform.zoom),W=kr(B,F,N,this.transform,H),tt=null;if(F){var q=yr(B,F,N,this.transform,H);tt=l.multiply([],this.transform.labelPlaneMatrix,q)}this.retainedQueryData[p.bucketInstanceId]=new Ft(p.bucketInstanceId,d,p.sourceLayerIndex,p.index,i.tileID);var Q={bucket:p,layout:_,posMatrix:B,textLabelPlaneMatrix:W,labelToScreenMatrix:tt,scale:S,textPixelRatio:P,holdingForFade:i.holdingForFade(),collisionBoxArray:m,partiallyEvaluatedTextSize:l.evaluateSizeForZoom(p.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(p.sourceID)};if(s)for(var at=0,mt=p.sortKeyRanges;at<mt.length;at+=1){var Ct=mt[at];n.push({sortKey:Ct.sortKey,symbolInstanceStart:Ct.symbolInstanceStart,symbolInstanceEnd:Ct.symbolInstanceEnd,parameters:Q})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:p.symbolInstances.length,parameters:Q})}},Fr.prototype.attemptAnchorPlacement=function(n,o,i,s,p,d,m,_,S,P,B,F,N,H,W){var tt,q=[F.textOffset0,F.textOffset1],Q=Ke(n,i,s,q,p),at=this.collisionIndex.placeCollisionBox(ze(o,Q.x,Q.y,d,m,this.transform.angle),B,_,S,P.predicate);if(!W||this.collisionIndex.placeCollisionBox(ze(W,Q.x,Q.y,d,m,this.transform.angle),B,_,S,P.predicate).box.length!==0)return at.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[F.crossTileID]&&this.prevPlacement.placements[F.crossTileID]&&this.prevPlacement.placements[F.crossTileID].text&&(tt=this.prevPlacement.variableOffsets[F.crossTileID].anchor),this.variableOffsets[F.crossTileID]={textOffset:q,width:i,height:s,anchor:n,textBoxScale:p,prevAnchor:tt},this.markUsedJustification(N,n,F,H),N.allowVerticalPlacement&&(this.markUsedOrientation(N,H,F),this.placedOrientations[F.crossTileID]=H),{shift:Q,placedGlyphBoxes:at}):void 0},Fr.prototype.placeLayerBucketPart=function(n,o,i){var s=this,p=n.parameters,d=p.bucket,m=p.layout,_=p.posMatrix,S=p.textLabelPlaneMatrix,P=p.labelToScreenMatrix,B=p.textPixelRatio,F=p.holdingForFade,N=p.collisionBoxArray,H=p.partiallyEvaluatedTextSize,W=p.collisionGroup,tt=m.get("text-optional"),q=m.get("icon-optional"),Q=m.get("text-allow-overlap"),at=m.get("icon-allow-overlap"),mt=m.get("text-rotation-alignment")==="map",Ct=m.get("text-pitch-alignment")==="map",wt=m.get("icon-text-fit")!=="none",At=m.get("symbol-z-order")==="viewport-y",Rt=Q&&(at||!d.hasIconData()||q),Zt=at&&(Q||!d.hasTextData()||tt);!d.collisionArrays&&N&&d.deserializeCollisionBoxes(N);var qt=function(de,Ue){if(!o[de.crossTileID])if(F)s.placements[de.crossTileID]=new bn(!1,!1,!1);else{var Je,Be=!1,Le=!1,Xe=!0,Me=null,Pe={box:null,offscreen:null},Mn={box:null,offscreen:null},Qr=null,ti=null,Un=0,Kr=0,sn=0;Ue.textFeatureIndex?Un=Ue.textFeatureIndex:de.useRuntimeCollisionCircles&&(Un=de.featureIndex),Ue.verticalTextFeatureIndex&&(Kr=Ue.verticalTextFeatureIndex);var qi=Ue.textBox;if(qi){var ci=function(br){var Ji=l.WritingMode.horizontal;if(d.allowVerticalPlacement&&!br&&s.prevPlacement){var Ti=s.prevPlacement.placedOrientations[de.crossTileID];Ti&&(s.placedOrientations[de.crossTileID]=Ti,s.markUsedOrientation(d,Ji=Ti,de))}return Ji},da=function(br,Ji){if(d.allowVerticalPlacement&&de.numVerticalGlyphVertices>0&&Ue.verticalTextBox)for(var Ti=0,Ra=d.writingModes;Ti<Ra.length&&(Ra[Ti]===l.WritingMode.vertical?(Pe=Ji(),Mn=Pe):Pe=br(),!(Pe&&Pe.box&&Pe.box.length));Ti+=1);else Pe=br()};if(m.get("text-variable-anchor")){var Si=m.get("text-variable-anchor");if(s.prevPlacement&&s.prevPlacement.variableOffsets[de.crossTileID]){var Mo=s.prevPlacement.variableOffsets[de.crossTileID];Si.indexOf(Mo.anchor)>0&&(Si=Si.filter(function(br){return br!==Mo.anchor})).unshift(Mo.anchor)}var uo=function(br,Ji,Ti){for(var Ra=br.x2-br.x1,ql=br.y2-br.y1,Ys=de.textBoxScale,Zl=wt&&!at?Ji:null,Is={box:[],offscreen:!1},cl=Q?2*Si.length:Si.length,is=0;is<cl;++is){var $s=s.attemptAnchorPlacement(Si[is%Si.length],br,Ra,ql,Ys,mt,Ct,B,_,W,is>=Si.length,de,d,Ti,Zl);if($s&&(Is=$s.placedGlyphBoxes)&&Is.box&&Is.box.length){Be=!0,Me=$s.shift;break}}return Is};da(function(){return uo(qi,Ue.iconBox,l.WritingMode.horizontal)},function(){var br=Ue.verticalTextBox;return d.allowVerticalPlacement&&!(Pe&&Pe.box&&Pe.box.length)&&de.numVerticalGlyphVertices>0&&br?uo(br,Ue.verticalIconBox,l.WritingMode.vertical):{box:null,offscreen:null}}),Pe&&(Be=Pe.box,Xe=Pe.offscreen);var Es=ci(Pe&&Pe.box);if(!Be&&s.prevPlacement){var rs=s.prevPlacement.variableOffsets[de.crossTileID];rs&&(s.variableOffsets[de.crossTileID]=rs,s.markUsedJustification(d,rs.anchor,de,Es))}}else{var ma=function(br,Ji){var Ti=s.collisionIndex.placeCollisionBox(br,Q,B,_,W.predicate);return Ti&&Ti.box&&Ti.box.length&&(s.markUsedOrientation(d,Ji,de),s.placedOrientations[de.crossTileID]=Ji),Ti};da(function(){return ma(qi,l.WritingMode.horizontal)},function(){var br=Ue.verticalTextBox;return d.allowVerticalPlacement&&de.numVerticalGlyphVertices>0&&br?ma(br,l.WritingMode.vertical):{box:null,offscreen:null}}),ci(Pe&&Pe.box&&Pe.box.length)}}if(Be=(Je=Pe)&&Je.box&&Je.box.length>0,Xe=Je&&Je.offscreen,de.useRuntimeCollisionCircles){var ns=d.text.placedSymbolArray.get(de.centerJustifiedTextSymbolIndex),Ss=l.evaluateSizeForFeature(d.textSizeData,H,ns),Zo=m.get("text-padding");Qr=s.collisionIndex.placeCollisionCircles(Q,ns,d.lineVertexArray,d.glyphOffsetArray,Ss,_,S,P,i,Ct,W.predicate,de.collisionCircleDiameter,Zo),Be=Q||Qr.circles.length>0&&!Qr.collisionDetected,Xe=Xe&&Qr.offscreen}if(Ue.iconFeatureIndex&&(sn=Ue.iconFeatureIndex),Ue.iconBox){var Ts=function(br){var Ji=wt&&Me?ze(br,Me.x,Me.y,mt,Ct,s.transform.angle):br;return s.collisionIndex.placeCollisionBox(Ji,at,B,_,W.predicate)};Le=Mn&&Mn.box&&Mn.box.length&&Ue.verticalIconBox?(ti=Ts(Ue.verticalIconBox)).box.length>0:(ti=Ts(Ue.iconBox)).box.length>0,Xe=Xe&&ti.offscreen}var Go=tt||de.numHorizontalGlyphVertices===0&&de.numVerticalGlyphVertices===0,zn=q||de.numIconVertices===0;if(Go||zn?zn?Go||(Le=Le&&Be):Be=Le&&Be:Le=Be=Le&&Be,Be&&Je&&Je.box&&s.collisionIndex.insertCollisionBox(Je.box,m.get("text-ignore-placement"),d.bucketInstanceId,Mn&&Mn.box&&Kr?Kr:Un,W.ID),Le&&ti&&s.collisionIndex.insertCollisionBox(ti.box,m.get("icon-ignore-placement"),d.bucketInstanceId,sn,W.ID),Qr&&(Be&&s.collisionIndex.insertCollisionCircles(Qr.circles,m.get("text-ignore-placement"),d.bucketInstanceId,Un,W.ID),i)){var $o=d.bucketInstanceId,ya=s.collisionCircleArrays[$o];ya===void 0&&(ya=s.collisionCircleArrays[$o]=new Mr);for(var Oa=0;Oa<Qr.circles.length;Oa+=4)ya.circles.push(Qr.circles[Oa+0]),ya.circles.push(Qr.circles[Oa+1]),ya.circles.push(Qr.circles[Oa+2]),ya.circles.push(Qr.collisionDetected?1:0)}s.placements[de.crossTileID]=new bn(Be||Rt,Le||Zt,Xe||d.justReloaded),o[de.crossTileID]=!0}};if(At)for(var ce=d.getSortedSymbolIndexes(this.transform.angle),we=ce.length-1;we>=0;--we){var Ie=ce[we];qt(d.symbolInstances.get(Ie),d.collisionArrays[Ie])}else for(var Te=n.symbolInstanceStart;Te<n.symbolInstanceEnd;Te++)qt(d.symbolInstances.get(Te),d.collisionArrays[Te]);if(i&&d.bucketInstanceId in this.collisionCircleArrays){var fr=this.collisionCircleArrays[d.bucketInstanceId];l.invert(fr.invProjMatrix,_),fr.viewportMatrix=this.collisionIndex.getViewportMatrix()}d.justReloaded=!1},Fr.prototype.markUsedJustification=function(n,o,i,s){var p;p=s===l.WritingMode.vertical?i.verticalPlacedTextSymbolIndex:{left:i.leftJustifiedTextSymbolIndex,center:i.centerJustifiedTextSymbolIndex,right:i.rightJustifiedTextSymbolIndex}[l.getAnchorJustification(o)];for(var d=0,m=[i.leftJustifiedTextSymbolIndex,i.centerJustifiedTextSymbolIndex,i.rightJustifiedTextSymbolIndex,i.verticalPlacedTextSymbolIndex];d<m.length;d+=1){var _=m[d];_>=0&&(n.text.placedSymbolArray.get(_).crossTileID=p>=0&&_!==p?0:i.crossTileID)}},Fr.prototype.markUsedOrientation=function(n,o,i){for(var s=o===l.WritingMode.horizontal||o===l.WritingMode.horizontalOnly?o:0,p=o===l.WritingMode.vertical?o:0,d=0,m=[i.leftJustifiedTextSymbolIndex,i.centerJustifiedTextSymbolIndex,i.rightJustifiedTextSymbolIndex];d<m.length;d+=1)n.text.placedSymbolArray.get(m[d]).placedOrientation=s;i.verticalPlacedTextSymbolIndex&&(n.text.placedSymbolArray.get(i.verticalPlacedTextSymbolIndex).placedOrientation=p)},Fr.prototype.commit=function(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;var o=this.prevPlacement,i=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;var s=o?o.symbolFadeChange(n):1,p=o?o.opacities:{},d=o?o.variableOffsets:{},m=o?o.placedOrientations:{};for(var _ in this.placements){var S=this.placements[_],P=p[_];P?(this.opacities[_]=new tr(P,s,S.text,S.icon),i=i||S.text!==P.text.placed||S.icon!==P.icon.placed):(this.opacities[_]=new tr(null,s,S.text,S.icon,S.skipFade),i=i||S.text||S.icon)}for(var B in p){var F=p[B];if(!this.opacities[B]){var N=new tr(F,s,!1,!1);N.isHidden()||(this.opacities[B]=N,i=i||F.text.placed||F.icon.placed)}}for(var H in d)this.variableOffsets[H]||!this.opacities[H]||this.opacities[H].isHidden()||(this.variableOffsets[H]=d[H]);for(var W in m)this.placedOrientations[W]||!this.opacities[W]||this.opacities[W].isHidden()||(this.placedOrientations[W]=m[W]);i?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:n)},Fr.prototype.updateLayerOpacities=function(n,o){for(var i={},s=0,p=o;s<p.length;s+=1){var d=p[s],m=d.getBucket(n);m&&d.latestFeatureIndex&&n.id===m.layerIds[0]&&this.updateBucketOpacities(m,i,d.collisionBoxArray)}},Fr.prototype.updateBucketOpacities=function(n,o,i){var s=this;n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();var p=n.layers[0].layout,d=new tr(null,0,!1,!1,!0),m=p.get("text-allow-overlap"),_=p.get("icon-allow-overlap"),S=p.get("text-variable-anchor"),P=p.get("text-rotation-alignment")==="map",B=p.get("text-pitch-alignment")==="map",F=p.get("icon-text-fit")!=="none",N=new tr(null,0,m&&(_||!n.hasIconData()||p.get("icon-optional")),_&&(m||!n.hasTextData()||p.get("text-optional")),!0);!n.collisionArrays&&i&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(i);for(var H=function(Q,at,mt){for(var Ct=0;Ct<at/4;Ct++)Q.opacityVertexArray.emplaceBack(mt)},W=function(Q){var at=n.symbolInstances.get(Q),mt=at.numHorizontalGlyphVertices,Ct=at.numVerticalGlyphVertices,wt=at.crossTileID,At=s.opacities[wt];o[wt]?At=d:At||(s.opacities[wt]=At=N),o[wt]=!0;var Rt=at.numIconVertices>0,Zt=s.placedOrientations[at.crossTileID],qt=Zt===l.WritingMode.vertical,ce=Zt===l.WritingMode.horizontal||Zt===l.WritingMode.horizontalOnly;if(mt>0||Ct>0){var we=wn(At.text);H(n.text,mt,qt?$n:we),H(n.text,Ct,ce?$n:we);var Ie=At.text.isHidden();[at.rightJustifiedTextSymbolIndex,at.centerJustifiedTextSymbolIndex,at.leftJustifiedTextSymbolIndex].forEach(function(Pe){Pe>=0&&(n.text.placedSymbolArray.get(Pe).hidden=Ie||qt?1:0)}),at.verticalPlacedTextSymbolIndex>=0&&(n.text.placedSymbolArray.get(at.verticalPlacedTextSymbolIndex).hidden=Ie||ce?1:0);var Te=s.variableOffsets[at.crossTileID];Te&&s.markUsedJustification(n,Te.anchor,at,Zt);var fr=s.placedOrientations[at.crossTileID];fr&&(s.markUsedJustification(n,"left",at,fr),s.markUsedOrientation(n,fr,at))}if(Rt){var de=wn(At.icon),Ue=!(F&&at.verticalPlacedIconSymbolIndex&&qt);at.placedIconSymbolIndex>=0&&(H(n.icon,at.numIconVertices,Ue?de:$n),n.icon.placedSymbolArray.get(at.placedIconSymbolIndex).hidden=At.icon.isHidden()),at.verticalPlacedIconSymbolIndex>=0&&(H(n.icon,at.numVerticalIconVertices,Ue?$n:de),n.icon.placedSymbolArray.get(at.verticalPlacedIconSymbolIndex).hidden=At.icon.isHidden())}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){var Je=n.collisionArrays[Q];if(Je){var Be=new l.Point(0,0);if(Je.textBox||Je.verticalTextBox){var Le=!0;if(S){var Xe=s.variableOffsets[wt];Xe?(Be=Ke(Xe.anchor,Xe.width,Xe.height,Xe.textOffset,Xe.textBoxScale),P&&Be._rotate(B?s.transform.angle:-s.transform.angle)):Le=!1}Je.textBox&&Ri(n.textCollisionBox.collisionVertexArray,At.text.placed,!Le||qt,Be.x,Be.y),Je.verticalTextBox&&Ri(n.textCollisionBox.collisionVertexArray,At.text.placed,!Le||ce,Be.x,Be.y)}var Me=!!(!ce&&Je.verticalIconBox);Je.iconBox&&Ri(n.iconCollisionBox.collisionVertexArray,At.icon.placed,Me,F?Be.x:0,F?Be.y:0),Je.verticalIconBox&&Ri(n.iconCollisionBox.collisionVertexArray,At.icon.placed,!Me,F?Be.x:0,F?Be.y:0)}}},tt=0;tt<n.symbolInstances.length;tt++)W(tt);if(n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){var q=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=q.invProjMatrix,n.placementViewportMatrix=q.viewportMatrix,n.collisionCircleArray=q.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}},Fr.prototype.symbolFadeChange=function(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},Fr.prototype.zoomAdjustment=function(n){return Math.max(0,(this.transform.zoom-n)/1.5)},Fr.prototype.hasTransitions=function(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration},Fr.prototype.stillRecent=function(n,o){var i=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*i>n},Fr.prototype.setStale=function(){this.stale=!0};var qa=Math.pow(2,25),nn=Math.pow(2,24),Oo=Math.pow(2,17),Za=Math.pow(2,16),yo=Math.pow(2,9),Ls=Math.pow(2,8),ls=Math.pow(2,1);function wn(n){if(n.opacity===0&&!n.placed)return 0;if(n.opacity===1&&n.placed)return 4294967295;var o=n.placed?1:0,i=Math.floor(127*n.opacity);return i*qa+o*nn+i*Oo+o*Za+i*yo+o*Ls+i*ls+o}var $n=0,Wo=function(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&n.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};Wo.prototype.continuePlacement=function(n,o,i,s,p){for(var d=this._bucketParts;this._currentTileIndex<n.length;)if(o.getBucketParts(d,s,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,p())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,d.sort(function(m,_){return m.sortKey-_.sortKey}));this._currentPartIndex<d.length;)if(o.placeLayerBucketPart(d[this._currentPartIndex],this._seenCrossTileIDs,i),this._currentPartIndex++,p())return!0;return!1};var go=function(n,o,i,s,p,d,m){this.placement=new Fr(n,p,d,m),this._currentPlacementIndex=o.length-1,this._forceFullPlacement=i,this._showCollisionBoxes=s,this._done=!1};go.prototype.isDone=function(){return this._done},go.prototype.continuePlacement=function(n,o,i){for(var s=this,p=l.browser.now(),d=function(){var S=l.browser.now()-p;return!s._forceFullPlacement&&S>2};this._currentPlacementIndex>=0;){var m=o[n[this._currentPlacementIndex]],_=this.placement.collisionIndex.transform.zoom;if(m.type==="symbol"&&(!m.minzoom||m.minzoom<=_)&&(!m.maxzoom||m.maxzoom>_)){if(this._inProgressLayer||(this._inProgressLayer=new Wo(m)),this._inProgressLayer.continuePlacement(i[m.source],this.placement,this._showCollisionBoxes,m,d))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},go.prototype.commit=function(n){return this.placement.commit(n),this.placement};var Ga=512/l.EXTENT/2,Ki=function(n,o,i){this.tileID=n,this.indexedSymbolInstances={},this.bucketInstanceId=i;for(var s=0;s<o.length;s++){var p=o.get(s),d=p.key;this.indexedSymbolInstances[d]||(this.indexedSymbolInstances[d]=[]),this.indexedSymbolInstances[d].push({crossTileID:p.crossTileID,coord:this.getScaledCoordinates(p,n)})}};Ki.prototype.getScaledCoordinates=function(n,o){var i=Ga/Math.pow(2,o.canonical.z-this.tileID.canonical.z);return{x:Math.floor((o.canonical.x*l.EXTENT+n.anchorX)*i),y:Math.floor((o.canonical.y*l.EXTENT+n.anchorY)*i)}},Ki.prototype.findMatches=function(n,o,i){for(var s=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z),p=0;p<n.length;p++){var d=n.get(p);if(!d.crossTileID){var m=this.indexedSymbolInstances[d.key];if(m)for(var _=this.getScaledCoordinates(d,o),S=0,P=m;S<P.length;S+=1){var B=P[S];if(Math.abs(B.coord.x-_.x)<=s&&Math.abs(B.coord.y-_.y)<=s&&!i[B.crossTileID]){i[B.crossTileID]=!0,d.crossTileID=B.crossTileID;break}}}}};var Bi=function(){this.maxCrossTileID=0};Bi.prototype.generate=function(){return++this.maxCrossTileID};var Fn=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};Fn.prototype.handleWrapJump=function(n){var o=Math.round((n-this.lng)/360);if(o!==0)for(var i in this.indexes){var s=this.indexes[i],p={};for(var d in s){var m=s[d];m.tileID=m.tileID.unwrapTo(m.tileID.wrap+o),p[m.tileID.key]=m}this.indexes[i]=p}this.lng=n},Fn.prototype.addBucket=function(n,o,i){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(var s=0;s<o.symbolInstances.length;s++)o.symbolInstances.get(s).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]={});var p=this.usedCrossTileIDs[n.overscaledZ];for(var d in this.indexes){var m=this.indexes[d];if(Number(d)>n.overscaledZ)for(var _ in m){var S=m[_];S.tileID.isChildOf(n)&&S.findMatches(o.symbolInstances,n,p)}else{var P=m[n.scaledTo(Number(d)).key];P&&P.findMatches(o.symbolInstances,n,p)}}for(var B=0;B<o.symbolInstances.length;B++){var F=o.symbolInstances.get(B);F.crossTileID||(F.crossTileID=i.generate(),p[F.crossTileID]=!0)}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new Ki(n,o.symbolInstances,o.bucketInstanceId),!0},Fn.prototype.removeBucketCrossTileIDs=function(n,o){for(var i in o.indexedSymbolInstances)for(var s=0,p=o.indexedSymbolInstances[i];s<p.length;s+=1)delete this.usedCrossTileIDs[n][p[s].crossTileID]},Fn.prototype.removeStaleBuckets=function(n){var o=!1;for(var i in this.indexes){var s=this.indexes[i];for(var p in s)n[s[p].bucketInstanceId]||(this.removeBucketCrossTileIDs(i,s[p]),delete s[p],o=!0)}return o};var Qi=function(){this.layerIndexes={},this.crossTileIDs=new Bi,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};Qi.prototype.addLayer=function(n,o,i){var s=this.layerIndexes[n.id];s===void 0&&(s=this.layerIndexes[n.id]=new Fn);var p=!1,d={};s.handleWrapJump(i);for(var m=0,_=o;m<_.length;m+=1){var S=_[m],P=S.getBucket(n);P&&n.id===P.layerIds[0]&&(P.bucketInstanceId||(P.bucketInstanceId=++this.maxBucketInstanceId),s.addBucket(S.tileID,P,this.crossTileIDs)&&(p=!0),d[P.bucketInstanceId]=!0)}return s.removeStaleBuckets(d)&&(p=!0),p},Qi.prototype.pruneUnusedLayers=function(n){var o={};for(var i in n.forEach(function(s){o[s]=!0}),this.layerIndexes)o[i]||delete this.layerIndexes[i]};var Ro=function(n,o){return l.emitValidationErrors(n,o&&o.filter(function(i){return i.identifier!=="source.canvas"}))},to=l.pick(Yt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Fi=l.pick(Yt,["setCenter","setZoom","setBearing","setPitch"]),na=function(){var n={},o=l.styleSpec.$version;for(var i in l.styleSpec.$root){var s,p=l.styleSpec.$root[i];p.required&&(s=i==="version"?o:p.type==="array"?[]:{})!=null&&(n[i]=s)}return n}(),Qn=function(n){function o(i,s){var p=this;s===void 0&&(s={}),n.call(this),this.map=i,this.dispatcher=new Or(St(),this),this.imageManager=new hr,this.imageManager.setEventedParent(this),this.glyphManager=new gn(i._requestManager,s.localIdeographFontFamily),this.lineAtlas=new wr(256,512),this.crossTileSymbolIndex=new Qi,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new l.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",l.getReferrer());var d=this;this._rtlTextPluginCallback=o.registerForPluginStateChange(function(m){d.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:m.pluginStatus,pluginURL:m.pluginURL},function(_,S){if(l.triggerPluginCompletionEvent(_),S&&S.every(function(B){return B}))for(var P in d.sourceCaches)d.sourceCaches[P].reload()})}),this.on("data",function(m){if(m.dataType==="source"&&m.sourceDataType==="metadata"){var _=p.sourceCaches[m.sourceId];if(_){var S=_.getSource();if(S&&S.vectorLayerIds)for(var P in p._layers){var B=p._layers[P];B.source===S.id&&p._validateLayer(B)}}}})}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.loadURL=function(i,s){var p=this;s===void 0&&(s={}),this.fire(new l.Event("dataloading",{dataType:"style"}));var d=typeof s.validate=="boolean"?s.validate:!l.isMapboxURL(i);i=this.map._requestManager.normalizeStyleURL(i,s.accessToken);var m=this.map._requestManager.transformRequest(i,l.ResourceType.Style);this._request=l.getJSON(m,function(_,S){p._request=null,_?p.fire(new l.ErrorEvent(_)):S&&p._load(S,d)})},o.prototype.loadJSON=function(i,s){var p=this;s===void 0&&(s={}),this.fire(new l.Event("dataloading",{dataType:"style"})),this._request=l.browser.frame(function(){p._request=null,p._load(i,s.validate!==!1)})},o.prototype.loadEmpty=function(){this.fire(new l.Event("dataloading",{dataType:"style"})),this._load(na,!1)},o.prototype._load=function(i,s){if(!s||!Ro(this,l.validateStyle(i))){for(var p in this._loaded=!0,this.stylesheet=i,i.sources)this.addSource(p,i.sources[p],{validate:!1});i.sprite?this._loadSprite(i.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(i.glyphs);var d=jt(this.stylesheet.layers);this._order=d.map(function(P){return P.id}),this._layers={},this._serializedLayers={};for(var m=0,_=d;m<_.length;m+=1){var S=_[m];(S=l.createStyleLayer(S)).setEventedParent(this,{layer:{id:S.id}}),this._layers[S.id]=S,this._serializedLayers[S.id]=S.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new mi(this.stylesheet.light),this.fire(new l.Event("data",{dataType:"style"})),this.fire(new l.Event("style.load"))}},o.prototype._loadSprite=function(i){var s=this;this._spriteRequest=function(p,d,m){var _,S,P,B=l.browser.devicePixelRatio>1?"@2x":"",F=l.getJSON(d.transformRequest(d.normalizeSpriteURL(p,B,".json"),l.ResourceType.SpriteJSON),function(W,tt){F=null,P||(P=W,_=tt,H())}),N=l.getImage(d.transformRequest(d.normalizeSpriteURL(p,B,".png"),l.ResourceType.SpriteImage),function(W,tt){N=null,P||(P=W,S=tt,H())});function H(){if(P)m(P);else if(_&&S){var W=l.browser.getImageData(S),tt={};for(var q in _){var Q=_[q],at=Q.width,mt=Q.height,Ct=Q.x,wt=Q.y,At=Q.sdf,Rt=Q.pixelRatio,Zt=Q.stretchX,qt=Q.stretchY,ce=Q.content,we=new l.RGBAImage({width:at,height:mt});l.RGBAImage.copy(W,we,{x:Ct,y:wt},{x:0,y:0},{width:at,height:mt}),tt[q]={data:we,pixelRatio:Rt,sdf:At,stretchX:Zt,stretchY:qt,content:ce}}m(null,tt)}}return{cancel:function(){F&&(F.cancel(),F=null),N&&(N.cancel(),N=null)}}}(i,this.map._requestManager,function(p,d){if(s._spriteRequest=null,p)s.fire(new l.ErrorEvent(p));else if(d)for(var m in d)s.imageManager.addImage(m,d[m]);s.imageManager.setLoaded(!0),s._availableImages=s.imageManager.listImages(),s.dispatcher.broadcast("setImages",s._availableImages),s.fire(new l.Event("data",{dataType:"style"}))})},o.prototype._validateLayer=function(i){var s=this.sourceCaches[i.source];if(s){var p=i.sourceLayer;if(p){var d=s.getSource();(d.type==="geojson"||d.vectorLayerIds&&d.vectorLayerIds.indexOf(p)===-1)&&this.fire(new l.ErrorEvent(new Error('Source layer "'+p+'" does not exist on source "'+d.id+'" as specified by style layer "'+i.id+'"')))}}},o.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var i in this.sourceCaches)if(!this.sourceCaches[i].loaded())return!1;return!!this.imageManager.isLoaded()},o.prototype._serializeLayers=function(i){for(var s=[],p=0,d=i;p<d.length;p+=1){var m=this._layers[d[p]];m.type!=="custom"&&s.push(m.serialize())}return s},o.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var i in this.sourceCaches)if(this.sourceCaches[i].hasTransition())return!0;for(var s in this._layers)if(this._layers[s].hasTransition())return!0;return!1},o.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},o.prototype.update=function(i){if(this._loaded){var s=this._changed;if(this._changed){var p=Object.keys(this._updatedLayers),d=Object.keys(this._removedLayers);for(var m in(p.length||d.length)&&this._updateWorkerLayers(p,d),this._updatedSources){var _=this._updatedSources[m];_==="reload"?this._reloadSource(m):_==="clear"&&this._clearSource(m)}for(var S in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[S].updateTransitions(i);this.light.updateTransitions(i),this._resetUpdates()}var P={};for(var B in this.sourceCaches){var F=this.sourceCaches[B];P[B]=F.used,F.used=!1}for(var N=0,H=this._order;N<H.length;N+=1){var W=this._layers[H[N]];W.recalculate(i,this._availableImages),!W.isHidden(i.zoom)&&W.source&&(this.sourceCaches[W.source].used=!0)}for(var tt in P){var q=this.sourceCaches[tt];P[tt]!==q.used&&q.fire(new l.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:tt}))}this.light.recalculate(i),this.z=i.zoom,s&&this.fire(new l.Event("data",{dataType:"style"}))}},o.prototype._updateTilesForChangedImages=function(){var i=Object.keys(this._changedImages);if(i.length){for(var s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],i);this._changedImages={}}},o.prototype._updateWorkerLayers=function(i,s){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(i),removedIds:s})},o.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},o.prototype.setState=function(i){var s=this;if(this._checkLoaded(),Ro(this,l.validateStyle(i)))return!1;(i=l.clone$1(i)).layers=jt(i.layers);var p=function(m,_){if(!m)return[{command:Yt.setStyle,args:[_]}];var S=[];try{if(!l.deepEqual(m.version,_.version))return[{command:Yt.setStyle,args:[_]}];l.deepEqual(m.center,_.center)||S.push({command:Yt.setCenter,args:[_.center]}),l.deepEqual(m.zoom,_.zoom)||S.push({command:Yt.setZoom,args:[_.zoom]}),l.deepEqual(m.bearing,_.bearing)||S.push({command:Yt.setBearing,args:[_.bearing]}),l.deepEqual(m.pitch,_.pitch)||S.push({command:Yt.setPitch,args:[_.pitch]}),l.deepEqual(m.sprite,_.sprite)||S.push({command:Yt.setSprite,args:[_.sprite]}),l.deepEqual(m.glyphs,_.glyphs)||S.push({command:Yt.setGlyphs,args:[_.glyphs]}),l.deepEqual(m.transition,_.transition)||S.push({command:Yt.setTransition,args:[_.transition]}),l.deepEqual(m.light,_.light)||S.push({command:Yt.setLight,args:[_.light]});var P={},B=[];(function(N,H,W,tt){var q;for(q in H=H||{},N=N||{})N.hasOwnProperty(q)&&(H.hasOwnProperty(q)||te(q,W,tt));for(q in H)H.hasOwnProperty(q)&&(N.hasOwnProperty(q)?l.deepEqual(N[q],H[q])||(N[q].type==="geojson"&&H[q].type==="geojson"&&Fe(N,H,q)?W.push({command:Yt.setGeoJSONSourceData,args:[q,H[q].data]}):Ye(q,H,W,tt)):Re(q,H,W))})(m.sources,_.sources,B,P);var F=[];m.layers&&m.layers.forEach(function(N){P[N.source]?S.push({command:Yt.removeLayer,args:[N.id]}):F.push(N)}),S=S.concat(B),function(N,H,W){H=H||[];var tt,q,Q,at,mt,Ct,wt,At=(N=N||[]).map(He),Rt=H.map(He),Zt=N.reduce(er,{}),qt=H.reduce(er,{}),ce=At.slice(),we=Object.create(null);for(tt=0,q=0;tt<At.length;tt++)qt.hasOwnProperty(Q=At[tt])?q++:(W.push({command:Yt.removeLayer,args:[Q]}),ce.splice(ce.indexOf(Q,q),1));for(tt=0,q=0;tt<Rt.length;tt++)ce[ce.length-1-tt]!==(Q=Rt[Rt.length-1-tt])&&(Zt.hasOwnProperty(Q)?(W.push({command:Yt.removeLayer,args:[Q]}),ce.splice(ce.lastIndexOf(Q,ce.length-q),1)):q++,W.push({command:Yt.addLayer,args:[qt[Q],Ct=ce[ce.length-tt]]}),ce.splice(ce.length-tt,0,Q),we[Q]=!0);for(tt=0;tt<Rt.length;tt++)if(at=Zt[Q=Rt[tt]],mt=qt[Q],!we[Q]&&!l.deepEqual(at,mt))if(l.deepEqual(at.source,mt.source)&&l.deepEqual(at["source-layer"],mt["source-layer"])&&l.deepEqual(at.type,mt.type)){for(wt in Ne(at.layout,mt.layout,W,Q,null,Yt.setLayoutProperty),Ne(at.paint,mt.paint,W,Q,null,Yt.setPaintProperty),l.deepEqual(at.filter,mt.filter)||W.push({command:Yt.setFilter,args:[Q,mt.filter]}),l.deepEqual(at.minzoom,mt.minzoom)&&l.deepEqual(at.maxzoom,mt.maxzoom)||W.push({command:Yt.setLayerZoomRange,args:[Q,mt.minzoom,mt.maxzoom]}),at)at.hasOwnProperty(wt)&&wt!=="layout"&&wt!=="paint"&&wt!=="filter"&&wt!=="metadata"&&wt!=="minzoom"&&wt!=="maxzoom"&&(wt.indexOf("paint.")===0?Ne(at[wt],mt[wt],W,Q,wt.slice(6),Yt.setPaintProperty):l.deepEqual(at[wt],mt[wt])||W.push({command:Yt.setLayerProperty,args:[Q,wt,mt[wt]]}));for(wt in mt)mt.hasOwnProperty(wt)&&!at.hasOwnProperty(wt)&&wt!=="layout"&&wt!=="paint"&&wt!=="filter"&&wt!=="metadata"&&wt!=="minzoom"&&wt!=="maxzoom"&&(wt.indexOf("paint.")===0?Ne(at[wt],mt[wt],W,Q,wt.slice(6),Yt.setPaintProperty):l.deepEqual(at[wt],mt[wt])||W.push({command:Yt.setLayerProperty,args:[Q,wt,mt[wt]]}))}else W.push({command:Yt.removeLayer,args:[Q]}),Ct=ce[ce.lastIndexOf(Q)+1],W.push({command:Yt.addLayer,args:[mt,Ct]})}(F,_.layers,S)}catch(N){console.warn("Unable to compute style diff:",N),S=[{command:Yt.setStyle,args:[_]}]}return S}(this.serialize(),i).filter(function(m){return!(m.command in Fi)});if(p.length===0)return!1;var d=p.filter(function(m){return!(m.command in to)});if(d.length>0)throw new Error("Unimplemented: "+d.map(function(m){return m.command}).join(", ")+".");return p.forEach(function(m){m.command!=="setTransition"&&s[m.command].apply(s,m.args)}),this.stylesheet=i,!0},o.prototype.addImage=function(i,s){if(this.getImage(i))return this.fire(new l.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(i,s),this._afterImageUpdated(i)},o.prototype.updateImage=function(i,s){this.imageManager.updateImage(i,s)},o.prototype.getImage=function(i){return this.imageManager.getImage(i)},o.prototype.removeImage=function(i){if(!this.getImage(i))return this.fire(new l.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(i),this._afterImageUpdated(i)},o.prototype._afterImageUpdated=function(i){this._availableImages=this.imageManager.listImages(),this._changedImages[i]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.Event("data",{dataType:"style"}))},o.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},o.prototype.addSource=function(i,s,p){var d=this;if(p===void 0&&(p={}),this._checkLoaded(),this.sourceCaches[i]!==void 0)throw new Error("There is already a source with this ID");if(!s.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(s).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(l.validateStyle.source,"sources."+i,s,null,p))){this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);var m=this.sourceCaches[i]=new J(i,s,this.dispatcher);m.style=this,m.setEventedParent(this,function(){return{isSourceLoaded:d.loaded(),source:m.serialize(),sourceId:i}}),m.onAdd(this.map),this._changed=!0}},o.prototype.removeSource=function(i){if(this._checkLoaded(),this.sourceCaches[i]===void 0)throw new Error("There is no source with this ID");for(var s in this._layers)if(this._layers[s].source===i)return this.fire(new l.ErrorEvent(new Error('Source "'+i+'" cannot be removed while layer "'+s+'" is using it.')));var p=this.sourceCaches[i];delete this.sourceCaches[i],delete this._updatedSources[i],p.fire(new l.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:i})),p.setEventedParent(null),p.clearTiles(),p.onRemove&&p.onRemove(this.map),this._changed=!0},o.prototype.setGeoJSONSourceData=function(i,s){this._checkLoaded(),this.sourceCaches[i].getSource().setData(s),this._changed=!0},o.prototype.getSource=function(i){return this.sourceCaches[i]&&this.sourceCaches[i].getSource()},o.prototype.addLayer=function(i,s,p){p===void 0&&(p={}),this._checkLoaded();var d=i.id;if(this.getLayer(d))this.fire(new l.ErrorEvent(new Error('Layer with id "'+d+'" already exists on this map')));else{var m;if(i.type==="custom"){if(Ro(this,l.validateCustomStyleLayer(i)))return;m=l.createStyleLayer(i)}else{if(typeof i.source=="object"&&(this.addSource(d,i.source),i=l.clone$1(i),i=l.extend(i,{source:d})),this._validate(l.validateStyle.layer,"layers."+d,i,{arrayIndex:-1},p))return;m=l.createStyleLayer(i),this._validateLayer(m),m.setEventedParent(this,{layer:{id:d}}),this._serializedLayers[m.id]=m.serialize()}var _=s?this._order.indexOf(s):this._order.length;if(s&&_===-1)this.fire(new l.ErrorEvent(new Error('Layer with id "'+s+'" does not exist on this map.')));else{if(this._order.splice(_,0,d),this._layerOrderChanged=!0,this._layers[d]=m,this._removedLayers[d]&&m.source&&m.type!=="custom"){var S=this._removedLayers[d];delete this._removedLayers[d],S.type!==m.type?this._updatedSources[m.source]="clear":(this._updatedSources[m.source]="reload",this.sourceCaches[m.source].pause())}this._updateLayer(m),m.onAdd&&m.onAdd(this.map)}}},o.prototype.moveLayer=function(i,s){if(this._checkLoaded(),this._changed=!0,this._layers[i]){if(i!==s){var p=this._order.indexOf(i);this._order.splice(p,1);var d=s?this._order.indexOf(s):this._order.length;s&&d===-1?this.fire(new l.ErrorEvent(new Error('Layer with id "'+s+'" does not exist on this map.'))):(this._order.splice(d,0,i),this._layerOrderChanged=!0)}}else this.fire(new l.ErrorEvent(new Error("The layer '"+i+"' does not exist in the map's style and cannot be moved.")))},o.prototype.removeLayer=function(i){this._checkLoaded();var s=this._layers[i];if(s){s.setEventedParent(null);var p=this._order.indexOf(i);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[i]=s,delete this._layers[i],delete this._serializedLayers[i],delete this._updatedLayers[i],delete this._updatedPaintProps[i],s.onRemove&&s.onRemove(this.map)}else this.fire(new l.ErrorEvent(new Error("The layer '"+i+"' does not exist in the map's style and cannot be removed.")))},o.prototype.getLayer=function(i){return this._layers[i]},o.prototype.hasLayer=function(i){return i in this._layers},o.prototype.setLayerZoomRange=function(i,s,p){this._checkLoaded();var d=this.getLayer(i);d?d.minzoom===s&&d.maxzoom===p||(s!=null&&(d.minzoom=s),p!=null&&(d.maxzoom=p),this._updateLayer(d)):this.fire(new l.ErrorEvent(new Error("The layer '"+i+"' does not exist in the map's style and cannot have zoom extent.")))},o.prototype.setFilter=function(i,s,p){p===void 0&&(p={}),this._checkLoaded();var d=this.getLayer(i);if(d){if(!l.deepEqual(d.filter,s))return s==null?(d.filter=void 0,void this._updateLayer(d)):void(this._validate(l.validateStyle.filter,"layers."+d.id+".filter",s,null,p)||(d.filter=l.clone$1(s),this._updateLayer(d)))}else this.fire(new l.ErrorEvent(new Error("The layer '"+i+"' does not exist in the map's style and cannot be filtered.")))},o.prototype.getFilter=function(i){return l.clone$1(this.getLayer(i).filter)},o.prototype.setLayoutProperty=function(i,s,p,d){d===void 0&&(d={}),this._checkLoaded();var m=this.getLayer(i);m?l.deepEqual(m.getLayoutProperty(s),p)||(m.setLayoutProperty(s,p,d),this._updateLayer(m)):this.fire(new l.ErrorEvent(new Error("The layer '"+i+"' does not exist in the map's style and cannot be styled.")))},o.prototype.getLayoutProperty=function(i,s){var p=this.getLayer(i);if(p)return p.getLayoutProperty(s);this.fire(new l.ErrorEvent(new Error("The layer '"+i+"' does not exist in the map's style.")))},o.prototype.setPaintProperty=function(i,s,p,d){d===void 0&&(d={}),this._checkLoaded();var m=this.getLayer(i);m?l.deepEqual(m.getPaintProperty(s),p)||(m.setPaintProperty(s,p,d)&&this._updateLayer(m),this._changed=!0,this._updatedPaintProps[i]=!0):this.fire(new l.ErrorEvent(new Error("The layer '"+i+"' does not exist in the map's style and cannot be styled.")))},o.prototype.getPaintProperty=function(i,s){return this.getLayer(i).getPaintProperty(s)},o.prototype.setFeatureState=function(i,s){this._checkLoaded();var p=i.source,d=i.sourceLayer,m=this.sourceCaches[p];if(m!==void 0){var _=m.getSource().type;_==="geojson"&&d?this.fire(new l.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):_!=="vector"||d?(i.id===void 0&&this.fire(new l.ErrorEvent(new Error("The feature id parameter must be provided."))),m.setFeatureState(d,i.id,s)):this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new l.ErrorEvent(new Error("The source '"+p+"' does not exist in the map's style.")))},o.prototype.removeFeatureState=function(i,s){this._checkLoaded();var p=i.source,d=this.sourceCaches[p];if(d!==void 0){var m=d.getSource().type,_=m==="vector"?i.sourceLayer:void 0;m!=="vector"||_?s&&typeof i.id!="string"&&typeof i.id!="number"?this.fire(new l.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):d.removeFeatureState(_,i.id,s):this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new l.ErrorEvent(new Error("The source '"+p+"' does not exist in the map's style.")))},o.prototype.getFeatureState=function(i){this._checkLoaded();var s=i.source,p=i.sourceLayer,d=this.sourceCaches[s];if(d!==void 0){if(d.getSource().type!=="vector"||p)return i.id===void 0&&this.fire(new l.ErrorEvent(new Error("The feature id parameter must be provided."))),d.getFeatureState(p,i.id);this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new l.ErrorEvent(new Error("The source '"+s+"' does not exist in the map's style.")))},o.prototype.getTransition=function(){return l.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},o.prototype.serialize=function(){return l.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:l.mapObject(this.sourceCaches,function(i){return i.serialize()}),layers:this._serializeLayers(this._order)},function(i){return i!==void 0})},o.prototype._updateLayer=function(i){this._updatedLayers[i.id]=!0,i.source&&!this._updatedSources[i.source]&&this.sourceCaches[i.source].getSource().type!=="raster"&&(this._updatedSources[i.source]="reload",this.sourceCaches[i.source].pause()),this._changed=!0},o.prototype._flattenAndSortRenderedFeatures=function(i){for(var s=this,p=function(Zt){return s._layers[Zt].type==="fill-extrusion"},d={},m=[],_=this._order.length-1;_>=0;_--){var S=this._order[_];if(p(S)){d[S]=_;for(var P=0,B=i;P<B.length;P+=1){var F=B[P][S];if(F)for(var N=0,H=F;N<H.length;N+=1)m.push(H[N])}}}m.sort(function(Zt,qt){return qt.intersectionZ-Zt.intersectionZ});for(var W=[],tt=this._order.length-1;tt>=0;tt--){var q=this._order[tt];if(p(q))for(var Q=m.length-1;Q>=0;Q--){var at=m[Q].feature;if(d[at.layer.id]<tt)break;W.push(at),m.pop()}else for(var mt=0,Ct=i;mt<Ct.length;mt+=1){var wt=Ct[mt][q];if(wt)for(var At=0,Rt=wt;At<Rt.length;At+=1)W.push(Rt[At].feature)}}return W},o.prototype.queryRenderedFeatures=function(i,s,p){s&&s.filter&&this._validate(l.validateStyle.filter,"queryRenderedFeatures.filter",s.filter,null,s);var d={};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new l.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var m=0,_=s.layers;m<_.length;m+=1){var S=_[m],P=this._layers[S];if(!P)return this.fire(new l.ErrorEvent(new Error("The layer '"+S+"' does not exist in the map's style and cannot be queried for features."))),[];d[P.source]=!0}}var B=[];for(var F in s.availableImages=this._availableImages,this.sourceCaches)s.layers&&!d[F]||B.push(fn(this.sourceCaches[F],this._layers,this._serializedLayers,i,s,p));return this.placement&&B.push(function(N,H,W,tt,q,Q,at){for(var mt={},Ct=Q.queryRenderedSymbols(tt),wt=[],At=0,Rt=Object.keys(Ct).map(Number);At<Rt.length;At+=1)wt.push(at[Rt[At]]);wt.sort(vi);for(var Zt=function(){var Te=ce[qt],fr=Te.featureIndex.lookupSymbolFeatures(Ct[Te.bucketInstanceId],H,Te.bucketIndex,Te.sourceLayerIndex,q.filter,q.layers,q.availableImages,N);for(var de in fr){var Ue=mt[de]=mt[de]||[],Je=fr[de];Je.sort(function(Xe,Me){var Pe=Te.featureSortOrder;if(Pe){var Mn=Pe.indexOf(Xe.featureIndex);return Pe.indexOf(Me.featureIndex)-Mn}return Me.featureIndex-Xe.featureIndex});for(var Be=0,Le=Je;Be<Le.length;Be+=1)Ue.push(Le[Be])}},qt=0,ce=wt;qt<ce.length;qt+=1)Zt();var we=function(Te){mt[Te].forEach(function(fr){var de=fr.feature,Ue=W[N[Te].source].getFeatureState(de.layer["source-layer"],de.id);de.source=de.layer.source,de.layer["source-layer"]&&(de.sourceLayer=de.layer["source-layer"]),de.state=Ue})};for(var Ie in mt)we(Ie);return mt}(this._layers,this._serializedLayers,this.sourceCaches,i,s,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(B)},o.prototype.querySourceFeatures=function(i,s){s&&s.filter&&this._validate(l.validateStyle.filter,"querySourceFeatures.filter",s.filter,null,s);var p=this.sourceCaches[i];return p?function(d,m){for(var _=d.getRenderableIds().map(function(H){return d.getTileByID(H)}),S=[],P={},B=0;B<_.length;B++){var F=_[B],N=F.tileID.canonical.key;P[N]||(P[N]=!0,F.querySourceFeatures(S,m))}return S}(p,s):[]},o.prototype.addSourceType=function(i,s,p){return o.getSourceType(i)?p(new Error('A source type called "'+i+'" already exists.')):(o.setSourceType(i,s),s.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:i,url:s.workerSourceURL},p):p(null,null))},o.prototype.getLight=function(){return this.light.getLight()},o.prototype.setLight=function(i,s){s===void 0&&(s={}),this._checkLoaded();var p=this.light.getLight(),d=!1;for(var m in i)if(!l.deepEqual(i[m],p[m])){d=!0;break}if(d){var _={now:l.browser.now(),transition:l.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(i,s),this.light.updateTransitions(_)}},o.prototype._validate=function(i,s,p,d,m){return m===void 0&&(m={}),(!m||m.validate!==!1)&&Ro(this,i.call(l.validateStyle,l.extend({key:s,style:this.serialize(),value:p,styleSpec:l.styleSpec},d)))},o.prototype._remove=function(){for(var i in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),l.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[i].setEventedParent(null);for(var s in this.sourceCaches)this.sourceCaches[s].clearTiles(),this.sourceCaches[s].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},o.prototype._clearSource=function(i){this.sourceCaches[i].clearTiles()},o.prototype._reloadSource=function(i){this.sourceCaches[i].resume(),this.sourceCaches[i].reload()},o.prototype._updateSources=function(i){for(var s in this.sourceCaches)this.sourceCaches[s].update(i)},o.prototype._generateCollisionBoxes=function(){for(var i in this.sourceCaches)this._reloadSource(i)},o.prototype._updatePlacement=function(i,s,p,d,m){m===void 0&&(m=!1);for(var _=!1,S=!1,P={},B=0,F=this._order;B<F.length;B+=1){var N=this._layers[F[B]];if(N.type==="symbol"){if(!P[N.source]){var H=this.sourceCaches[N.source];P[N.source]=H.getRenderableIds(!0).map(function(at){return H.getTileByID(at)}).sort(function(at,mt){return mt.tileID.overscaledZ-at.tileID.overscaledZ||(at.tileID.isLessThan(mt.tileID)?-1:1)})}var W=this.crossTileSymbolIndex.addLayer(N,P[N.source],i.center.lng);_=_||W}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((m=m||this._layerOrderChanged||p===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(l.browser.now(),i.zoom))&&(this.pauseablePlacement=new go(i,this._order,m,s,p,d,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,P),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(l.browser.now()),S=!0),_&&this.pauseablePlacement.placement.setStale()),S||_)for(var tt=0,q=this._order;tt<q.length;tt+=1){var Q=this._layers[q[tt]];Q.type==="symbol"&&this.placement.updateLayerOpacities(Q,P[Q.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(l.browser.now())},o.prototype._releaseSymbolFadeTiles=function(){for(var i in this.sourceCaches)this.sourceCaches[i].releaseSymbolFadeTiles()},o.prototype.getImages=function(i,s,p){this.imageManager.getImages(s.icons,p),this._updateTilesForChangedImages();var d=this.sourceCaches[s.source];d&&d.setDependencies(s.tileID.key,s.type,s.icons)},o.prototype.getGlyphs=function(i,s,p){this.glyphManager.getGlyphs(s.stacks,p)},o.prototype.getResource=function(i,s,p){return l.makeRequest(s,p)},o}(l.Evented);Qn.getSourceType=function(n){return gi[n]},Qn.setSourceType=function(n,o){gi[n]=o},Qn.registerForPluginStateChange=l.registerForPluginStateChange;var Hr=l.createLayout([{name:"a_pos",type:"Int16",components:2}]),eo=xr(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),Os=xr(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Iu=xr(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Ka=xr(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),ia=xr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Ea=xr(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),cs=xr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),ps=xr("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),Rs=xr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),Xa=xr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),hs=xr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),oa=xr(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),Bo=xr(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),Sa=xr(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),on=xr(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),Wa=xr(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),Fo=xr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),Xi=xr(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),vo=xr(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),_o=xr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),ro=xr(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),xo=xr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),Jr=xr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),Ni=xr(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),aa=xr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),fs=xr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function xr(n,o){var i=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,s=o.match(/attribute ([\w]+) ([\w]+)/g),p=n.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),d=o.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),m=d?d.concat(p):p,_={};return{fragmentSource:n=n.replace(i,function(S,P,B,F,N){return _[N]=!0,P==="define"?`
#ifndef HAS_UNIFORM_u_`+N+`
varying `+B+" "+F+" "+N+`;
#else
uniform `+B+" "+F+" u_"+N+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+N+`
    `+B+" "+F+" "+N+" = u_"+N+`;
#endif
`}),vertexSource:o=o.replace(i,function(S,P,B,F,N){var H=F==="float"?"vec2":"vec4",W=N.match(/color/)?"color":H;return _[N]?P==="define"?`
#ifndef HAS_UNIFORM_u_`+N+`
uniform lowp float u_`+N+`_t;
attribute `+B+" "+H+" a_"+N+`;
varying `+B+" "+F+" "+N+`;
#else
uniform `+B+" "+F+" u_"+N+`;
#endif
`:W==="vec4"?`
#ifndef HAS_UNIFORM_u_`+N+`
    `+N+" = a_"+N+`;
#else
    `+B+" "+F+" "+N+" = u_"+N+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+N+`
    `+N+" = unpack_mix_"+W+"(a_"+N+", u_"+N+`_t);
#else
    `+B+" "+F+" "+N+" = u_"+N+`;
#endif
`:P==="define"?`
#ifndef HAS_UNIFORM_u_`+N+`
uniform lowp float u_`+N+`_t;
attribute `+B+" "+H+" a_"+N+`;
#else
uniform `+B+" "+F+" u_"+N+`;
#endif
`:W==="vec4"?`
#ifndef HAS_UNIFORM_u_`+N+`
    `+B+" "+F+" "+N+" = a_"+N+`;
#else
    `+B+" "+F+" "+N+" = u_"+N+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+N+`
    `+B+" "+F+" "+N+" = unpack_mix_"+W+"(a_"+N+", u_"+N+`_t);
#else
    `+B+" "+F+" "+N+" = u_"+N+`;
#endif
`}),staticAttributes:s,staticUniforms:m}}var Bs=Object.freeze({__proto__:null,prelude:eo,background:Os,backgroundPattern:Iu,circle:Ka,clippingMask:ia,heatmap:Ea,heatmapTexture:cs,collisionBox:ps,collisionCircle:Rs,debug:Xa,fill:hs,fillOutline:oa,fillOutlinePattern:Bo,fillPattern:Sa,fillExtrusion:on,fillExtrusionPattern:Wa,hillshadePrepare:Fo,hillshade:Xi,line:vo,lineGradient:_o,linePattern:ro,lineSDF:xo,raster:Jr,symbolIcon:Ni,symbolSDF:aa,symbolTextAndIcon:fs}),Ta=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function Ia(n){for(var o=[],i=0;i<n.length;i++)if(n[i]!==null){var s=n[i].split(" ");o.push(s.pop())}return o}Ta.prototype.bind=function(n,o,i,s,p,d,m,_){this.context=n;for(var S=this.boundPaintVertexBuffers.length!==s.length,P=0;!S&&P<s.length;P++)this.boundPaintVertexBuffers[P]!==s[P]&&(S=!0);n.extVertexArrayObject&&this.vao&&this.boundProgram===o&&this.boundLayoutVertexBuffer===i&&!S&&this.boundIndexBuffer===p&&this.boundVertexOffset===d&&this.boundDynamicVertexBuffer===m&&this.boundDynamicVertexBuffer2===_?(n.bindVertexArrayOES.set(this.vao),m&&m.bind(),p&&p.dynamicDraw&&p.bind(),_&&_.bind()):this.freshBind(o,i,s,p,d,m,_)},Ta.prototype.freshBind=function(n,o,i,s,p,d,m){var _,S=n.numAttributes,P=this.context,B=P.gl;if(P.extVertexArrayObject)this.vao&&this.destroy(),this.vao=P.extVertexArrayObject.createVertexArrayOES(),P.bindVertexArrayOES.set(this.vao),_=0,this.boundProgram=n,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=i,this.boundIndexBuffer=s,this.boundVertexOffset=p,this.boundDynamicVertexBuffer=d,this.boundDynamicVertexBuffer2=m;else{_=P.currentNumAttributes||0;for(var F=S;F<_;F++)B.disableVertexAttribArray(F)}o.enableAttributes(B,n);for(var N=0,H=i;N<H.length;N+=1)H[N].enableAttributes(B,n);d&&d.enableAttributes(B,n),m&&m.enableAttributes(B,n),o.bind(),o.setVertexAttribPointers(B,n,p);for(var W=0,tt=i;W<tt.length;W+=1){var q=tt[W];q.bind(),q.setVertexAttribPointers(B,n,p)}d&&(d.bind(),d.setVertexAttribPointers(B,n,p)),s&&s.bind(),m&&(m.bind(),m.setVertexAttribPointers(B,n,p)),P.currentNumAttributes=S},Ta.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var Ha=function(n,o,i,s,p,d){var m=n.gl;this.program=m.createProgram();for(var _=Ia(i.staticAttributes),S=s?s.getBinderAttributes():[],P=_.concat(S),B=i.staticUniforms?Ia(i.staticUniforms):[],F=s?s.getBinderUniforms():[],N=[],H=0,W=B.concat(F);H<W.length;H+=1){var tt=W[H];N.indexOf(tt)<0&&N.push(tt)}var q=s?s.defines():[];d&&q.push("#define OVERDRAW_INSPECTOR;");var Q=q.concat(eo.fragmentSource,i.fragmentSource).join(`
`),at=q.concat(eo.vertexSource,i.vertexSource).join(`
`),mt=m.createShader(m.FRAGMENT_SHADER);if(m.isContextLost())this.failedToCreate=!0;else{m.shaderSource(mt,Q),m.compileShader(mt),m.attachShader(this.program,mt);var Ct=m.createShader(m.VERTEX_SHADER);if(m.isContextLost())this.failedToCreate=!0;else{m.shaderSource(Ct,at),m.compileShader(Ct),m.attachShader(this.program,Ct),this.attributes={};var wt={};this.numAttributes=P.length;for(var At=0;At<this.numAttributes;At++)P[At]&&(m.bindAttribLocation(this.program,At,P[At]),this.attributes[P[At]]=At);m.linkProgram(this.program),m.deleteShader(Ct),m.deleteShader(mt);for(var Rt=0;Rt<N.length;Rt++){var Zt=N[Rt];if(Zt&&!wt[Zt]){var qt=m.getUniformLocation(this.program,Zt);qt&&(wt[Zt]=qt)}}this.fixedUniforms=p(n,wt),this.binderUniforms=s?s.getUniforms(n,wt):[]}}};function No(n,o,i){var s=1/se(i,1,o.transform.tileZoom),p=Math.pow(2,i.tileID.overscaledZ),d=i.tileSize*Math.pow(2,o.transform.tileZoom)/p,m=d*(i.tileID.canonical.x+i.tileID.wrap*p),_=d*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture.size,u_scale:[s,n.fromScale,n.toScale],u_fade:n.t,u_pixel_coord_upper:[m>>16,_>>16],u_pixel_coord_lower:[65535&m,65535&_]}}Ha.prototype.draw=function(n,o,i,s,p,d,m,_,S,P,B,F,N,H,W,tt){var q,Q=n.gl;if(!this.failedToCreate){for(var at in n.program.set(this.program),n.setDepthMode(i),n.setStencilMode(s),n.setColorMode(p),n.setCullFace(d),this.fixedUniforms)this.fixedUniforms[at].set(m[at]);H&&H.setUniforms(n,this.binderUniforms,F,{zoom:N});for(var mt=(q={},q[Q.LINES]=2,q[Q.TRIANGLES]=3,q[Q.LINE_STRIP]=1,q)[o],Ct=0,wt=B.get();Ct<wt.length;Ct+=1){var At=wt[Ct],Rt=At.vaos||(At.vaos={});(Rt[_]||(Rt[_]=new Ta)).bind(n,this,S,H?H.getPaintVertexBuffers():[],P,At.vertexOffset,W,tt),Q.drawElements(o,At.primitiveLength*mt,Q.UNSIGNED_SHORT,At.primitiveOffset*mt*2)}}};var Ja=function(n,o,i,s){var p=o.style.light,d=p.properties.get("position"),m=[d.x,d.y,d.z],_=l.create$1();p.properties.get("anchor")==="viewport"&&l.fromRotation(_,-o.transform.angle),l.transformMat3(m,m,_);var S=p.properties.get("color");return{u_matrix:n,u_lightpos:m,u_lightintensity:p.properties.get("intensity"),u_lightcolor:[S.r,S.g,S.b],u_vertical_gradient:+i,u_opacity:s}},bo=function(n,o,i,s,p,d,m){return l.extend(Ja(n,o,i,s),No(d,o,m),{u_height_factor:-Math.pow(2,p.overscaledZ)/m.tileSize/8})},Wi=function(n){return{u_matrix:n}},wo=function(n,o,i,s){return l.extend(Wi(n),No(i,o,s))},ds=function(n,o){return{u_matrix:n,u_world:o}},Fs=function(n,o,i,s,p){return l.extend(wo(n,o,i,s),{u_world:p})},Ca=function(n,o,i,s){var p,d,m=n.transform;if(s.paint.get("circle-pitch-alignment")==="map"){var _=se(i,1,m.zoom);p=!0,d=[_,_]}else p=!1,d=m.pixelsToGLUnits;return{u_camera_to_center_distance:m.cameraToCenterDistance,u_scale_with_map:+(s.paint.get("circle-pitch-scale")==="map"),u_matrix:n.translatePosMatrix(o.posMatrix,i,s.paint.get("circle-translate"),s.paint.get("circle-translate-anchor")),u_pitch_with_map:+p,u_device_pixel_ratio:l.browser.devicePixelRatio,u_extrude_scale:d}},no=function(n,o,i){var s=se(i,1,o.zoom),p=Math.pow(2,o.zoom-i.tileID.overscaledZ),d=i.tileID.overscaleFactor();return{u_matrix:n,u_camera_to_center_distance:o.cameraToCenterDistance,u_pixels_to_tile_units:s,u_extrude_scale:[o.pixelsToGLUnits[0]/(s*p),o.pixelsToGLUnits[1]/(s*p)],u_overscale_factor:d}},Ns=function(n,o,i){return{u_matrix:n,u_inv_matrix:o,u_camera_to_center_distance:i.cameraToCenterDistance,u_viewport_size:[i.width,i.height]}},Eo=function(n,o,i){return i===void 0&&(i=1),{u_matrix:n,u_color:o,u_overlay:0,u_overlay_scale:i}},So=function(n){return{u_matrix:n}},Us=function(n,o,i,s){return{u_matrix:n,u_extrude_scale:se(o,1,i),u_intensity:s}},sa=function(n,o,i){var s=n.transform;return{u_matrix:ms(n,o,i),u_ratio:1/se(o,1,s.zoom),u_device_pixel_ratio:l.browser.devicePixelRatio,u_units_to_pixels:[1/s.pixelsToGLUnits[0],1/s.pixelsToGLUnits[1]]}},Ar=function(n,o,i,s){return l.extend(sa(n,o,i),{u_image:0,u_image_height:s})},Aa=function(n,o,i,s){var p=n.transform,d=ua(o,p);return{u_matrix:ms(n,o,i),u_texsize:o.imageAtlasTexture.size,u_ratio:1/se(o,1,p.zoom),u_device_pixel_ratio:l.browser.devicePixelRatio,u_image:0,u_scale:[d,s.fromScale,s.toScale],u_fade:s.t,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},Vs=function(n,o,i,s,p){var d=n.lineAtlas,m=ua(o,n.transform),_=i.layout.get("line-cap")==="round",S=d.getDash(s.from,_),P=d.getDash(s.to,_),B=S.width*p.fromScale,F=P.width*p.toScale;return l.extend(sa(n,o,i),{u_patternscale_a:[m/B,-S.height/2],u_patternscale_b:[m/F,-P.height/2],u_sdfgamma:d.width/(256*Math.min(B,F)*l.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:S.y,u_tex_y_b:P.y,u_mix:p.t})};function ua(n,o){return 1/se(n,1,o.tileZoom)}function ms(n,o,i){return n.translatePosMatrix(o.tileID.posMatrix,o,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}var ys=function(n,o,i,s,p){return{u_matrix:n,u_tl_parent:o,u_scale_parent:i,u_buffer_scale:1,u_fade_t:s.mix,u_opacity:s.opacity*p.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:p.paint.get("raster-brightness-min"),u_brightness_high:p.paint.get("raster-brightness-max"),u_saturation_factor:(m=p.paint.get("raster-saturation"),m>0?1-1/(1.001-m):-m),u_contrast_factor:(d=p.paint.get("raster-contrast"),d>0?1/(1-d):1+d),u_spin_weights:gs(p.paint.get("raster-hue-rotate"))};var d,m};function gs(n){n*=Math.PI/180;var o=Math.sin(n),i=Math.cos(n);return[(2*i+1)/3,(-Math.sqrt(3)*o-i+1)/3,(Math.sqrt(3)*o-i+1)/3]}var Pa,la=function(n,o,i,s,p,d,m,_,S,P){var B=p.transform;return{u_is_size_zoom_constant:+(n==="constant"||n==="source"),u_is_size_feature_constant:+(n==="constant"||n==="camera"),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:B.cameraToCenterDistance,u_pitch:B.pitch/360*2*Math.PI,u_rotate_symbol:+i,u_aspect_ratio:B.width/B.height,u_fade_change:p.options.fadeDuration?p.symbolFadeChange:1,u_matrix:d,u_label_plane_matrix:m,u_coord_matrix:_,u_is_text:+S,u_pitch_with_map:+s,u_texsize:P,u_texture:0}},ka=function(n,o,i,s,p,d,m,_,S,P,B){var F=p.transform;return l.extend(la(n,o,i,s,p,d,m,_,S,P),{u_gamma_scale:s?Math.cos(F._pitch)*F.cameraToCenterDistance:1,u_device_pixel_ratio:l.browser.devicePixelRatio,u_is_halo:+B})},Ya=function(n,o,i,s,p,d,m,_,S,P){return l.extend(ka(n,o,i,s,p,d,m,_,!0,S,!0),{u_texsize_icon:P,u_texture_icon:1})},Uo=function(n,o,i){return{u_matrix:n,u_opacity:o,u_color:i}},ai=function(n,o,i,s,p,d){return l.extend(function(m,_,S,P){var B=S.imageManager.getPattern(m.from.toString()),F=S.imageManager.getPattern(m.to.toString()),N=S.imageManager.getPixelSize(),H=N.width,W=N.height,tt=Math.pow(2,P.tileID.overscaledZ),q=P.tileSize*Math.pow(2,S.transform.tileZoom)/tt,Q=q*(P.tileID.canonical.x+P.tileID.wrap*tt),at=q*P.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:B.tl,u_pattern_br_a:B.br,u_pattern_tl_b:F.tl,u_pattern_br_b:F.br,u_texsize:[H,W],u_mix:_.t,u_pattern_size_a:B.displaySize,u_pattern_size_b:F.displaySize,u_scale_a:_.fromScale,u_scale_b:_.toScale,u_tile_units_to_pixels:1/se(P,1,S.transform.tileZoom),u_pixel_coord_upper:[Q>>16,at>>16],u_pixel_coord_lower:[65535&Q,65535&at]}}(s,d,i,p),{u_matrix:n,u_opacity:o})},Yr={fillExtrusion:function(n,o){return{u_matrix:new l.UniformMatrix4f(n,o.u_matrix),u_lightpos:new l.Uniform3f(n,o.u_lightpos),u_lightintensity:new l.Uniform1f(n,o.u_lightintensity),u_lightcolor:new l.Uniform3f(n,o.u_lightcolor),u_vertical_gradient:new l.Uniform1f(n,o.u_vertical_gradient),u_opacity:new l.Uniform1f(n,o.u_opacity)}},fillExtrusionPattern:function(n,o){return{u_matrix:new l.UniformMatrix4f(n,o.u_matrix),u_lightpos:new l.Uniform3f(n,o.u_lightpos),u_lightintensity:new l.Uniform1f(n,o.u_lightintensity),u_lightcolor:new l.Uniform3f(n,o.u_lightcolor),u_vertical_gradient:new l.Uniform1f(n,o.u_vertical_gradient),u_height_factor:new l.Uniform1f(n,o.u_height_factor),u_image:new l.Uniform1i(n,o.u_image),u_texsize:new l.Uniform2f(n,o.u_texsize),u_pixel_coord_upper:new l.Uniform2f(n,o.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(n,o.u_pixel_coord_lower),u_scale:new l.Uniform3f(n,o.u_scale),u_fade:new l.Uniform1f(n,o.u_fade),u_opacity:new l.Uniform1f(n,o.u_opacity)}},fill:function(n,o){return{u_matrix:new l.UniformMatrix4f(n,o.u_matrix)}},fillPattern:function(n,o){return{u_matrix:new l.UniformMatrix4f(n,o.u_matrix),u_image:new l.Uniform1i(n,o.u_image),u_texsize:new l.Uniform2f(n,o.u_texsize),u_pixel_coord_upper:new l.Uniform2f(n,o.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(n,o.u_pixel_coord_lower),u_scale:new l.Uniform3f(n,o.u_scale),u_fade:new l.Uniform1f(n,o.u_fade)}},fillOutline:function(n,o){return{u_matrix:new l.UniformMatrix4f(n,o.u_matrix),u_world:new l.Uniform2f(n,o.u_world)}},fillOutlinePattern:function(n,o){return{u_matrix:new l.UniformMatrix4f(n,o.u_matrix),u_world:new l.Uniform2f(n,o.u_world),u_image:new l.Uniform1i(n,o.u_image),u_texsize:new l.Uniform2f(n,o.u_texsize),u_pixel_coord_upper:new l.Uniform2f(n,o.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(n,o.u_pixel_coord_lower),u_scale:new l.Uniform3f(n,o.u_scale),u_fade:new l.Uniform1f(n,o.u_fade)}},circle:function(n,o){return{u_camera_to_center_distance:new l.Uniform1f(n,o.u_camera_to_center_distance),u_scale_with_map:new l.Uniform1i(n,o.u_scale_with_map),u_pitch_with_map:new l.Uniform1i(n,o.u_pitch_with_map),u_extrude_scale:new l.Uniform2f(n,o.u_extrude_scale),u_device_pixel_ratio:new l.Uniform1f(n,o.u_device_pixel_ratio),u_matrix:new l.UniformMatrix4f(n,o.u_matrix)}},collisionBox:function(n,o){return{u_matrix:new l.UniformMatrix4f(n,o.u_matrix),u_camera_to_center_distance:new l.Uniform1f(n,o.u_camera_to_center_distance),u_pixels_to_tile_units:new l.Uniform1f(n,o.u_pixels_to_tile_units),u_extrude_scale:new l.Uniform2f(n,o.u_extrude_scale),u_overscale_factor:new l.Uniform1f(n,o.u_overscale_factor)}},collisionCircle:function(n,o){return{u_matrix:new l.UniformMatrix4f(n,o.u_matrix),u_inv_matrix:new l.UniformMatrix4f(n,o.u_inv_matrix),u_camera_to_center_distance:new l.Uniform1f(n,o.u_camera_to_center_distance),u_viewport_size:new l.Uniform2f(n,o.u_viewport_size)}},debug:function(n,o){return{u_color:new l.UniformColor(n,o.u_color),u_matrix:new l.UniformMatrix4f(n,o.u_matrix),u_overlay:new l.Uniform1i(n,o.u_overlay),u_overlay_scale:new l.Uniform1f(n,o.u_overlay_scale)}},clippingMask:function(n,o){return{u_matrix:new l.UniformMatrix4f(n,o.u_matrix)}},heatmap:function(n,o){return{u_extrude_scale:new l.Uniform1f(n,o.u_extrude_scale),u_intensity:new l.Uniform1f(n,o.u_intensity),u_matrix:new l.UniformMatrix4f(n,o.u_matrix)}},heatmapTexture:function(n,o){return{u_matrix:new l.UniformMatrix4f(n,o.u_matrix),u_world:new l.Uniform2f(n,o.u_world),u_image:new l.Uniform1i(n,o.u_image),u_color_ramp:new l.Uniform1i(n,o.u_color_ramp),u_opacity:new l.Uniform1f(n,o.u_opacity)}},hillshade:function(n,o){return{u_matrix:new l.UniformMatrix4f(n,o.u_matrix),u_image:new l.Uniform1i(n,o.u_image),u_latrange:new l.Uniform2f(n,o.u_latrange),u_light:new l.Uniform2f(n,o.u_light),u_shadow:new l.UniformColor(n,o.u_shadow),u_highlight:new l.UniformColor(n,o.u_highlight),u_accent:new l.UniformColor(n,o.u_accent)}},hillshadePrepare:function(n,o){return{u_matrix:new l.UniformMatrix4f(n,o.u_matrix),u_image:new l.Uniform1i(n,o.u_image),u_dimension:new l.Uniform2f(n,o.u_dimension),u_zoom:new l.Uniform1f(n,o.u_zoom),u_unpack:new l.Uniform4f(n,o.u_unpack)}},line:function(n,o){return{u_matrix:new l.UniformMatrix4f(n,o.u_matrix),u_ratio:new l.Uniform1f(n,o.u_ratio),u_device_pixel_ratio:new l.Uniform1f(n,o.u_device_pixel_ratio),u_units_to_pixels:new l.Uniform2f(n,o.u_units_to_pixels)}},lineGradient:function(n,o){return{u_matrix:new l.UniformMatrix4f(n,o.u_matrix),u_ratio:new l.Uniform1f(n,o.u_ratio),u_device_pixel_ratio:new l.Uniform1f(n,o.u_device_pixel_ratio),u_units_to_pixels:new l.Uniform2f(n,o.u_units_to_pixels),u_image:new l.Uniform1i(n,o.u_image),u_image_height:new l.Uniform1f(n,o.u_image_height)}},linePattern:function(n,o){return{u_matrix:new l.UniformMatrix4f(n,o.u_matrix),u_texsize:new l.Uniform2f(n,o.u_texsize),u_ratio:new l.Uniform1f(n,o.u_ratio),u_device_pixel_ratio:new l.Uniform1f(n,o.u_device_pixel_ratio),u_image:new l.Uniform1i(n,o.u_image),u_units_to_pixels:new l.Uniform2f(n,o.u_units_to_pixels),u_scale:new l.Uniform3f(n,o.u_scale),u_fade:new l.Uniform1f(n,o.u_fade)}},lineSDF:function(n,o){return{u_matrix:new l.UniformMatrix4f(n,o.u_matrix),u_ratio:new l.Uniform1f(n,o.u_ratio),u_device_pixel_ratio:new l.Uniform1f(n,o.u_device_pixel_ratio),u_units_to_pixels:new l.Uniform2f(n,o.u_units_to_pixels),u_patternscale_a:new l.Uniform2f(n,o.u_patternscale_a),u_patternscale_b:new l.Uniform2f(n,o.u_patternscale_b),u_sdfgamma:new l.Uniform1f(n,o.u_sdfgamma),u_image:new l.Uniform1i(n,o.u_image),u_tex_y_a:new l.Uniform1f(n,o.u_tex_y_a),u_tex_y_b:new l.Uniform1f(n,o.u_tex_y_b),u_mix:new l.Uniform1f(n,o.u_mix)}},raster:function(n,o){return{u_matrix:new l.UniformMatrix4f(n,o.u_matrix),u_tl_parent:new l.Uniform2f(n,o.u_tl_parent),u_scale_parent:new l.Uniform1f(n,o.u_scale_parent),u_buffer_scale:new l.Uniform1f(n,o.u_buffer_scale),u_fade_t:new l.Uniform1f(n,o.u_fade_t),u_opacity:new l.Uniform1f(n,o.u_opacity),u_image0:new l.Uniform1i(n,o.u_image0),u_image1:new l.Uniform1i(n,o.u_image1),u_brightness_low:new l.Uniform1f(n,o.u_brightness_low),u_brightness_high:new l.Uniform1f(n,o.u_brightness_high),u_saturation_factor:new l.Uniform1f(n,o.u_saturation_factor),u_contrast_factor:new l.Uniform1f(n,o.u_contrast_factor),u_spin_weights:new l.Uniform3f(n,o.u_spin_weights)}},symbolIcon:function(n,o){return{u_is_size_zoom_constant:new l.Uniform1i(n,o.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(n,o.u_is_size_feature_constant),u_size_t:new l.Uniform1f(n,o.u_size_t),u_size:new l.Uniform1f(n,o.u_size),u_camera_to_center_distance:new l.Uniform1f(n,o.u_camera_to_center_distance),u_pitch:new l.Uniform1f(n,o.u_pitch),u_rotate_symbol:new l.Uniform1i(n,o.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(n,o.u_aspect_ratio),u_fade_change:new l.Uniform1f(n,o.u_fade_change),u_matrix:new l.UniformMatrix4f(n,o.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(n,o.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(n,o.u_coord_matrix),u_is_text:new l.Uniform1i(n,o.u_is_text),u_pitch_with_map:new l.Uniform1i(n,o.u_pitch_with_map),u_texsize:new l.Uniform2f(n,o.u_texsize),u_texture:new l.Uniform1i(n,o.u_texture)}},symbolSDF:function(n,o){return{u_is_size_zoom_constant:new l.Uniform1i(n,o.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(n,o.u_is_size_feature_constant),u_size_t:new l.Uniform1f(n,o.u_size_t),u_size:new l.Uniform1f(n,o.u_size),u_camera_to_center_distance:new l.Uniform1f(n,o.u_camera_to_center_distance),u_pitch:new l.Uniform1f(n,o.u_pitch),u_rotate_symbol:new l.Uniform1i(n,o.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(n,o.u_aspect_ratio),u_fade_change:new l.Uniform1f(n,o.u_fade_change),u_matrix:new l.UniformMatrix4f(n,o.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(n,o.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(n,o.u_coord_matrix),u_is_text:new l.Uniform1i(n,o.u_is_text),u_pitch_with_map:new l.Uniform1i(n,o.u_pitch_with_map),u_texsize:new l.Uniform2f(n,o.u_texsize),u_texture:new l.Uniform1i(n,o.u_texture),u_gamma_scale:new l.Uniform1f(n,o.u_gamma_scale),u_device_pixel_ratio:new l.Uniform1f(n,o.u_device_pixel_ratio),u_is_halo:new l.Uniform1i(n,o.u_is_halo)}},symbolTextAndIcon:function(n,o){return{u_is_size_zoom_constant:new l.Uniform1i(n,o.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(n,o.u_is_size_feature_constant),u_size_t:new l.Uniform1f(n,o.u_size_t),u_size:new l.Uniform1f(n,o.u_size),u_camera_to_center_distance:new l.Uniform1f(n,o.u_camera_to_center_distance),u_pitch:new l.Uniform1f(n,o.u_pitch),u_rotate_symbol:new l.Uniform1i(n,o.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(n,o.u_aspect_ratio),u_fade_change:new l.Uniform1f(n,o.u_fade_change),u_matrix:new l.UniformMatrix4f(n,o.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(n,o.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(n,o.u_coord_matrix),u_is_text:new l.Uniform1i(n,o.u_is_text),u_pitch_with_map:new l.Uniform1i(n,o.u_pitch_with_map),u_texsize:new l.Uniform2f(n,o.u_texsize),u_texsize_icon:new l.Uniform2f(n,o.u_texsize_icon),u_texture:new l.Uniform1i(n,o.u_texture),u_texture_icon:new l.Uniform1i(n,o.u_texture_icon),u_gamma_scale:new l.Uniform1f(n,o.u_gamma_scale),u_device_pixel_ratio:new l.Uniform1f(n,o.u_device_pixel_ratio),u_is_halo:new l.Uniform1i(n,o.u_is_halo)}},background:function(n,o){return{u_matrix:new l.UniformMatrix4f(n,o.u_matrix),u_opacity:new l.Uniform1f(n,o.u_opacity),u_color:new l.UniformColor(n,o.u_color)}},backgroundPattern:function(n,o){return{u_matrix:new l.UniformMatrix4f(n,o.u_matrix),u_opacity:new l.Uniform1f(n,o.u_opacity),u_image:new l.Uniform1i(n,o.u_image),u_pattern_tl_a:new l.Uniform2f(n,o.u_pattern_tl_a),u_pattern_br_a:new l.Uniform2f(n,o.u_pattern_br_a),u_pattern_tl_b:new l.Uniform2f(n,o.u_pattern_tl_b),u_pattern_br_b:new l.Uniform2f(n,o.u_pattern_br_b),u_texsize:new l.Uniform2f(n,o.u_texsize),u_mix:new l.Uniform1f(n,o.u_mix),u_pattern_size_a:new l.Uniform2f(n,o.u_pattern_size_a),u_pattern_size_b:new l.Uniform2f(n,o.u_pattern_size_b),u_scale_a:new l.Uniform1f(n,o.u_scale_a),u_scale_b:new l.Uniform1f(n,o.u_scale_b),u_pixel_coord_upper:new l.Uniform2f(n,o.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(n,o.u_pixel_coord_lower),u_tile_units_to_pixels:new l.Uniform1f(n,o.u_tile_units_to_pixels)}}};function To(n,o,i,s,p,d,m){for(var _=n.context,S=_.gl,P=n.useProgram("collisionBox"),B=[],F=0,N=0,H=0;H<s.length;H++){var W=s[H],tt=o.getTile(W),q=tt.getBucket(i);if(q){var Q=W.posMatrix;p[0]===0&&p[1]===0||(Q=n.translatePosMatrix(W.posMatrix,tt,p,d));var at=m?q.textCollisionBox:q.iconCollisionBox,mt=q.collisionCircleArray;if(mt.length>0){var Ct=l.create(),wt=Q;l.mul(Ct,q.placementInvProjMatrix,n.transform.glCoordMatrix),l.mul(Ct,Ct,q.placementViewportMatrix),B.push({circleArray:mt,circleOffset:N,transform:wt,invTransform:Ct}),N=F+=mt.length/4}at&&P.draw(_,S.LINES,U.disabled,G.disabled,n.colorModeForRenderPass(),$.disabled,no(Q,n.transform,tt),i.id,at.layoutVertexBuffer,at.indexBuffer,at.segments,null,n.transform.zoom,null,null,at.collisionVertexBuffer)}}if(m&&B.length){var At=n.useProgram("collisionCircle"),Rt=new l.StructArrayLayout2f1f2i16;Rt.resize(4*F),Rt._trim();for(var Zt=0,qt=0,ce=B;qt<ce.length;qt+=1)for(var we=ce[qt],Ie=0;Ie<we.circleArray.length/4;Ie++){var Te=4*Ie,fr=we.circleArray[Te+0],de=we.circleArray[Te+1],Ue=we.circleArray[Te+2],Je=we.circleArray[Te+3];Rt.emplace(Zt++,fr,de,Ue,Je,0),Rt.emplace(Zt++,fr,de,Ue,Je,1),Rt.emplace(Zt++,fr,de,Ue,Je,2),Rt.emplace(Zt++,fr,de,Ue,Je,3)}(!Pa||Pa.length<2*F)&&(Pa=function(Qr){var ti=2*Qr,Un=new l.StructArrayLayout3ui6;Un.resize(ti),Un._trim();for(var Kr=0;Kr<ti;Kr++){var sn=6*Kr;Un.uint16[sn+0]=4*Kr+0,Un.uint16[sn+1]=4*Kr+1,Un.uint16[sn+2]=4*Kr+2,Un.uint16[sn+3]=4*Kr+2,Un.uint16[sn+4]=4*Kr+3,Un.uint16[sn+5]=4*Kr+0}return Un}(F));for(var Be=_.createIndexBuffer(Pa,!0),Le=_.createVertexBuffer(Rt,l.collisionCircleLayout.members,!0),Xe=0,Me=B;Xe<Me.length;Xe+=1){var Pe=Me[Xe],Mn=Ns(Pe.transform,Pe.invTransform,n.transform);At.draw(_,S.TRIANGLES,U.disabled,G.disabled,n.colorModeForRenderPass(),$.disabled,Mn,i.id,Le,Be,l.SegmentVector.simpleSegment(0,2*Pe.circleOffset,Pe.circleArray.length,Pe.circleArray.length/2),null,n.transform.zoom,null,null,null)}Le.destroy(),Be.destroy()}}var $r=l.identity(new Float32Array(16));function js(n,o,i,s,p,d){var m=l.getAnchorAlignment(n),_=-(m.horizontalAlign-.5)*o,S=-(m.verticalAlign-.5)*i,P=l.evaluateVariableOffset(n,s);return new l.Point((_/p+P[0])*d,(S/p+P[1])*d)}function $a(n,o,i,s,p,d,m,_,S,P,B){var F=n.text.placedSymbolArray,N=n.text.dynamicLayoutVertexArray,H=n.icon.dynamicLayoutVertexArray,W={};N.clear();for(var tt=0;tt<F.length;tt++){var q=F.get(tt),Q=q.hidden||!q.crossTileID||n.allowVerticalPlacement&&!q.placedOrientation?null:s[q.crossTileID];if(Q){var at=new l.Point(q.anchorX,q.anchorY),mt=Ze(at,i?_:m),Ct=lr(d.cameraToCenterDistance,mt.signedDistanceFromCamera),wt=p.evaluateSizeForFeature(n.textSizeData,P,q)*Ct/l.ONE_EM;i&&(wt*=n.tilePixelRatio/S);for(var At=js(Q.anchor,Q.width,Q.height,Q.textOffset,Q.textBoxScale,wt),Rt=i?Ze(at.add(At),m).point:mt.point.add(o?At.rotate(-d.angle):At),Zt=n.allowVerticalPlacement&&q.placedOrientation===l.WritingMode.vertical?Math.PI/2:0,qt=0;qt<q.numGlyphs;qt++)l.addDynamicAttributes(N,Rt,Zt);B&&q.associatedIconIndex>=0&&(W[q.associatedIconIndex]={shiftedAnchor:Rt,angle:Zt})}else Gt(q.numGlyphs,N)}if(B){H.clear();for(var ce=n.icon.placedSymbolArray,we=0;we<ce.length;we++){var Ie=ce.get(we);if(Ie.hidden)Gt(Ie.numGlyphs,H);else{var Te=W[we];if(Te)for(var fr=0;fr<Ie.numGlyphs;fr++)l.addDynamicAttributes(H,Te.shiftedAnchor,Te.angle);else Gt(Ie.numGlyphs,H)}}n.icon.dynamicLayoutVertexBuffer.updateData(H)}n.text.dynamicLayoutVertexBuffer.updateData(N)}function vs(n,o,i){return i.iconsInText&&o?"symbolTextAndIcon":n?"symbolSDF":"symbolIcon"}function Ei(n,o,i,s,p,d,m,_,S,P,B,F){for(var N=n.context,H=N.gl,W=n.transform,tt=_==="map",q=S==="map",Q=tt&&i.layout.get("symbol-placement")!=="point",at=tt&&!q&&!Q,mt=i.layout.get("symbol-sort-key").constantOr(1)!==void 0,Ct=!1,wt=n.depthModeForSublayer(0,U.ReadOnly),At=i.layout.get("text-variable-anchor"),Rt=[],Zt=0,qt=s;Zt<qt.length;Zt+=1){var ce=qt[Zt],we=o.getTile(ce),Ie=we.getBucket(i);if(Ie){var Te=p?Ie.text:Ie.icon;if(Te&&Te.segments.get().length){var fr=Te.programConfigurations.get(i.id),de=p||Ie.sdfIcons,Ue=p?Ie.textSizeData:Ie.iconSizeData,Je=q||W.pitch!==0,Be=n.useProgram(vs(de,p,Ie),fr),Le=l.evaluateSizeForZoom(Ue,W.zoom),Xe=void 0,Me=[0,0],Pe=void 0,Mn=void 0,Qr=null,ti=void 0;if(p)Pe=we.glyphAtlasTexture,Mn=H.LINEAR,Xe=we.glyphAtlasTexture.size,Ie.iconsInText&&(Me=we.imageAtlasTexture.size,Qr=we.imageAtlasTexture,ti=Je||n.options.rotating||n.options.zooming||Ue.kind==="composite"||Ue.kind==="camera"?H.LINEAR:H.NEAREST);else{var Un=i.layout.get("icon-size").constantOr(0)!==1||Ie.iconsNeedLinear;Pe=we.imageAtlasTexture,Mn=de||n.options.rotating||n.options.zooming||Un||Je?H.LINEAR:H.NEAREST,Xe=we.imageAtlasTexture.size}var Kr=se(we,1,n.transform.zoom),sn=kr(ce.posMatrix,q,tt,n.transform,Kr),qi=yr(ce.posMatrix,q,tt,n.transform,Kr),ci=At&&Ie.hasTextData(),da=i.layout.get("icon-text-fit")!=="none"&&ci&&Ie.hasIconData();Q&&v(Ie,ce.posMatrix,n,p,sn,qi,q,P);var Si=n.translatePosMatrix(ce.posMatrix,we,d,m),Mo=Q||p&&At||da?$r:sn,uo=n.translatePosMatrix(qi,we,d,m,!0),Es=de&&i.paint.get(p?"text-halo-width":"icon-halo-width").constantOr(1)!==0,rs={program:Be,buffers:Te,uniformValues:de?Ie.iconsInText?Ya(Ue.kind,Le,at,q,n,Si,Mo,uo,Xe,Me):ka(Ue.kind,Le,at,q,n,Si,Mo,uo,p,Xe,!0):la(Ue.kind,Le,at,q,n,Si,Mo,uo,p,Xe),atlasTexture:Pe,atlasTextureIcon:Qr,atlasInterpolation:Mn,atlasInterpolationIcon:ti,isSDF:de,hasHalo:Es};if(mt&&Ie.canOverlap){Ct=!0;for(var ma=0,ns=Te.segments.get();ma<ns.length;ma+=1){var Ss=ns[ma];Rt.push({segments:new l.SegmentVector([Ss]),sortKey:Ss.sortKey,state:rs})}}else Rt.push({segments:Te.segments,sortKey:0,state:rs})}}}Ct&&Rt.sort(function(ya,Oa){return ya.sortKey-Oa.sortKey});for(var Zo=0,Ts=Rt;Zo<Ts.length;Zo+=1){var Go=Ts[Zo],zn=Go.state;if(N.activeTexture.set(H.TEXTURE0),zn.atlasTexture.bind(zn.atlasInterpolation,H.CLAMP_TO_EDGE),zn.atlasTextureIcon&&(N.activeTexture.set(H.TEXTURE1),zn.atlasTextureIcon&&zn.atlasTextureIcon.bind(zn.atlasInterpolationIcon,H.CLAMP_TO_EDGE)),zn.isSDF){var $o=zn.uniformValues;zn.hasHalo&&($o.u_is_halo=1,Ho(zn.buffers,Go.segments,i,n,zn.program,wt,B,F,$o)),$o.u_is_halo=0}Ho(zn.buffers,Go.segments,i,n,zn.program,wt,B,F,zn.uniformValues)}}function Ho(n,o,i,s,p,d,m,_,S){var P=s.context;p.draw(P,P.gl.TRIANGLES,d,m,_,$.disabled,S,i.id,n.layoutVertexBuffer,n.indexBuffer,o,i.paint,s.transform.zoom,n.programConfigurations.get(i.id),n.dynamicLayoutVertexBuffer,n.opacityVertexBuffer)}function Io(n,o,i,s,p,d,m){var _,S,P,B,F,N=n.context.gl,H=i.paint.get("fill-pattern"),W=H&&H.constantOr(1),tt=i.getCrossfadeParameters();m?(S=W&&!i.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",_=N.LINES):(S=W?"fillPattern":"fill",_=N.TRIANGLES);for(var q=0,Q=s;q<Q.length;q+=1){var at=Q[q],mt=o.getTile(at);if(!W||mt.patternsLoaded()){var Ct=mt.getBucket(i);if(Ct){var wt=Ct.programConfigurations.get(i.id),At=n.useProgram(S,wt);W&&(n.context.activeTexture.set(N.TEXTURE0),mt.imageAtlasTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),wt.updatePaintBuffers(tt));var Rt=H.constantOr(null);if(Rt&&mt.imageAtlas){var Zt=mt.imageAtlas,qt=Zt.patternPositions[Rt.to.toString()],ce=Zt.patternPositions[Rt.from.toString()];qt&&ce&&wt.setConstantPatternPositions(qt,ce)}var we=n.translatePosMatrix(at.posMatrix,mt,i.paint.get("fill-translate"),i.paint.get("fill-translate-anchor"));if(m){B=Ct.indexBuffer2,F=Ct.segments2;var Ie=[N.drawingBufferWidth,N.drawingBufferHeight];P=S==="fillOutlinePattern"&&W?Fs(we,n,tt,mt,Ie):ds(we,Ie)}else B=Ct.indexBuffer,F=Ct.segments,P=W?wo(we,n,tt,mt):Wi(we);At.draw(n.context,_,p,n.stencilModeForClipping(at),d,$.disabled,P,i.id,Ct.layoutVertexBuffer,B,F,i.paint,n.transform.zoom,wt)}}}}function io(n,o,i,s,p,d,m){for(var _=n.context,S=_.gl,P=i.paint.get("fill-extrusion-pattern"),B=P.constantOr(1),F=i.getCrossfadeParameters(),N=i.paint.get("fill-extrusion-opacity"),H=0,W=s;H<W.length;H+=1){var tt=W[H],q=o.getTile(tt),Q=q.getBucket(i);if(Q){var at=Q.programConfigurations.get(i.id),mt=n.useProgram(B?"fillExtrusionPattern":"fillExtrusion",at);B&&(n.context.activeTexture.set(S.TEXTURE0),q.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),at.updatePaintBuffers(F));var Ct=P.constantOr(null);if(Ct&&q.imageAtlas){var wt=q.imageAtlas,At=wt.patternPositions[Ct.to.toString()],Rt=wt.patternPositions[Ct.from.toString()];At&&Rt&&at.setConstantPatternPositions(At,Rt)}var Zt=n.translatePosMatrix(tt.posMatrix,q,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),qt=i.paint.get("fill-extrusion-vertical-gradient"),ce=B?bo(Zt,n,qt,N,tt,F,q):Ja(Zt,n,qt,N);mt.draw(_,_.gl.TRIANGLES,p,d,m,$.backCCW,ce,i.id,Q.layoutVertexBuffer,Q.indexBuffer,Q.segments,i.paint,n.transform.zoom,at)}}}function Ma(n,o,i,s,p,d){var m=n.context,_=m.gl,S=o.fbo;if(S){var P=n.useProgram("hillshade");m.activeTexture.set(_.TEXTURE0),_.bindTexture(_.TEXTURE_2D,S.colorAttachment.get());var B=function(F,N,H){var W=H.paint.get("hillshade-shadow-color"),tt=H.paint.get("hillshade-highlight-color"),q=H.paint.get("hillshade-accent-color"),Q=H.paint.get("hillshade-illumination-direction")*(Math.PI/180);H.paint.get("hillshade-illumination-anchor")==="viewport"&&(Q-=F.transform.angle);var at,mt,Ct,wt=!F.options.moving;return{u_matrix:F.transform.calculatePosMatrix(N.tileID.toUnwrapped(),wt),u_image:0,u_latrange:(at=N.tileID,mt=Math.pow(2,at.canonical.z),Ct=at.canonical.y,[new l.MercatorCoordinate(0,Ct/mt).toLngLat().lat,new l.MercatorCoordinate(0,(Ct+1)/mt).toLngLat().lat]),u_light:[H.paint.get("hillshade-exaggeration"),Q],u_shadow:W,u_highlight:tt,u_accent:q}}(n,o,i);P.draw(m,_.TRIANGLES,s,p,d,$.disabled,B,i.id,n.rasterBoundsBuffer,n.quadTriangleIndexBuffer,n.rasterBoundsSegments)}}function h(n,o,i,s,p,d){var m=n.context,_=m.gl,S=o.dem;if(S&&S.data){var P=S.dim,B=S.stride,F=S.getPixels();if(m.activeTexture.set(_.TEXTURE1),m.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||n.getTileTexture(B),o.demTexture){var N=o.demTexture;N.update(F,{premultiply:!1}),N.bind(_.NEAREST,_.CLAMP_TO_EDGE)}else o.demTexture=new l.Texture(m,F,_.RGBA,{premultiply:!1}),o.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE);m.activeTexture.set(_.TEXTURE0);var H=o.fbo;if(!H){var W=new l.Texture(m,{width:P,height:P,data:null},_.RGBA);W.bind(_.LINEAR,_.CLAMP_TO_EDGE),(H=o.fbo=m.createFramebuffer(P,P,!0)).colorAttachment.set(W.texture)}m.bindFramebuffer.set(H.framebuffer),m.viewport.set([0,0,P,P]),n.useProgram("hillshadePrepare").draw(m,_.TRIANGLES,s,p,d,$.disabled,function(tt,q){var Q=q.stride,at=l.create();return l.ortho(at,0,l.EXTENT,-l.EXTENT,0,0,1),l.translate(at,at,[0,-l.EXTENT,0]),{u_matrix:at,u_image:1,u_dimension:[Q,Q],u_zoom:tt.overscaledZ,u_unpack:q.getUnpackVector()}}(o.tileID,S),i.id,n.rasterBoundsBuffer,n.quadTriangleIndexBuffer,n.rasterBoundsSegments),o.needsHillshadePrepare=!1}}function g(n,o,i,s,p){var d=s.paint.get("raster-fade-duration");if(d>0){var m=l.browser.now(),_=(m-n.timeAdded)/d,S=o?(m-o.timeAdded)/d:-1,P=i.getSource(),B=p.coveringZoomLevel({tileSize:P.tileSize,roundZoom:P.roundZoom}),F=!o||Math.abs(o.tileID.overscaledZ-B)>Math.abs(n.tileID.overscaledZ-B),N=F&&n.refreshedUponExpiration?1:l.clamp(F?_:1-S,0,1);return n.refreshedUponExpiration&&_>=1&&(n.refreshedUponExpiration=!1),o?{opacity:1,mix:1-N}:{opacity:N,mix:0}}return{opacity:1,mix:0}}var b=new l.Color(1,0,0,1),T=new l.Color(0,1,0,1),k=new l.Color(0,0,1,1),R=new l.Color(1,0,1,1),K=new l.Color(0,1,1,1);function et(n,o,i,s){ht(n,0,o+i/2,n.transform.width,i,s)}function lt(n,o,i,s){ht(n,o-i/2,0,i,n.transform.height,s)}function ht(n,o,i,s,p,d){var m=n.context,_=m.gl;_.enable(_.SCISSOR_TEST),_.scissor(o*l.browser.devicePixelRatio,i*l.browser.devicePixelRatio,s*l.browser.devicePixelRatio,p*l.browser.devicePixelRatio),m.clear({color:d}),_.disable(_.SCISSOR_TEST)}function gt(n,o,i){var s=n.context,p=s.gl,d=i.posMatrix,m=n.useProgram("debug"),_=U.disabled,S=G.disabled,P=n.colorModeForRenderPass();s.activeTexture.set(p.TEXTURE0),n.emptyTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE),m.draw(s,p.LINE_STRIP,_,S,P,$.disabled,Eo(d,l.Color.red),"$debug",n.debugBuffer,n.tileBorderIndexBuffer,n.debugSegments);var B=o.getTileByID(i.key).latestRawTileData,F=Math.floor((B&&B.byteLength||0)/1024),N=o.getTile(i).tileSize,H=512/Math.min(N,512)*(i.overscaledZ/n.transform.zoom)*.5,W=i.canonical.toString();i.overscaledZ!==i.canonical.z&&(W+=" => "+i.overscaledZ),function(tt,q){tt.initDebugOverlayCanvas();var Q=tt.debugOverlayCanvas,at=tt.context.gl,mt=tt.debugOverlayCanvas.getContext("2d");mt.clearRect(0,0,Q.width,Q.height),mt.shadowColor="white",mt.shadowBlur=2,mt.lineWidth=1.5,mt.strokeStyle="white",mt.textBaseline="top",mt.font="bold 36px Open Sans, sans-serif",mt.fillText(q,5,5),mt.strokeText(q,5,5),tt.debugOverlayTexture.update(Q),tt.debugOverlayTexture.bind(at.LINEAR,at.CLAMP_TO_EDGE)}(n,W+" "+F+"kb"),m.draw(s,p.TRIANGLES,_,S,nt.alphaBlended,$.disabled,Eo(d,l.Color.transparent,H),"$debug",n.debugBuffer,n.quadTriangleIndexBuffer,n.debugSegments)}var it={symbol:function(n,o,i,s,p){if(n.renderPass==="translucent"){var d=G.disabled,m=n.colorModeForRenderPass();i.layout.get("text-variable-anchor")&&function(_,S,P,B,F,N,H){for(var W=S.transform,tt=F==="map",q=N==="map",Q=0,at=_;Q<at.length;Q+=1){var mt=at[Q],Ct=B.getTile(mt),wt=Ct.getBucket(P);if(wt&&wt.text&&wt.text.segments.get().length){var At=l.evaluateSizeForZoom(wt.textSizeData,W.zoom),Rt=se(Ct,1,S.transform.zoom),Zt=kr(mt.posMatrix,q,tt,S.transform,Rt),qt=P.layout.get("icon-text-fit")!=="none"&&wt.hasIconData();if(At){var ce=Math.pow(2,W.zoom-Ct.tileID.overscaledZ);$a(wt,tt,q,H,l.symbolSize,W,Zt,mt.posMatrix,ce,At,qt)}}}}(s,n,i,o,i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),p),i.paint.get("icon-opacity").constantOr(1)!==0&&Ei(n,o,i,s,!1,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),i.layout.get("icon-rotation-alignment"),i.layout.get("icon-pitch-alignment"),i.layout.get("icon-keep-upright"),d,m),i.paint.get("text-opacity").constantOr(1)!==0&&Ei(n,o,i,s,!0,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),i.layout.get("text-keep-upright"),d,m),o.map.showCollisionBoxes&&(To(n,o,i,s,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),!0),To(n,o,i,s,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),!1))}},circle:function(n,o,i,s){if(n.renderPass==="translucent"){var p=i.paint.get("circle-opacity"),d=i.paint.get("circle-stroke-width"),m=i.paint.get("circle-stroke-opacity"),_=i.layout.get("circle-sort-key").constantOr(1)!==void 0;if(p.constantOr(1)!==0||d.constantOr(1)!==0&&m.constantOr(1)!==0){for(var S=n.context,P=S.gl,B=n.depthModeForSublayer(0,U.ReadOnly),F=G.disabled,N=n.colorModeForRenderPass(),H=[],W=0;W<s.length;W++){var tt=s[W],q=o.getTile(tt),Q=q.getBucket(i);if(Q){var at=Q.programConfigurations.get(i.id),mt={programConfiguration:at,program:n.useProgram("circle",at),layoutVertexBuffer:Q.layoutVertexBuffer,indexBuffer:Q.indexBuffer,uniformValues:Ca(n,tt,q,i)};if(_)for(var Ct=0,wt=Q.segments.get();Ct<wt.length;Ct+=1){var At=wt[Ct];H.push({segments:new l.SegmentVector([At]),sortKey:At.sortKey,state:mt})}else H.push({segments:Q.segments,sortKey:0,state:mt})}}_&&H.sort(function(we,Ie){return we.sortKey-Ie.sortKey});for(var Rt=0,Zt=H;Rt<Zt.length;Rt+=1){var qt=Zt[Rt],ce=qt.state;ce.program.draw(S,P.TRIANGLES,B,F,N,$.disabled,ce.uniformValues,i.id,ce.layoutVertexBuffer,ce.indexBuffer,qt.segments,i.paint,n.transform.zoom,ce.programConfiguration)}}}},heatmap:function(n,o,i,s){if(i.paint.get("heatmap-opacity")!==0)if(n.renderPass==="offscreen"){var p=n.context,d=p.gl,m=G.disabled,_=new nt([d.ONE,d.ONE],l.Color.transparent,[!0,!0,!0,!0]);(function(H,W,tt){var q=H.gl;H.activeTexture.set(q.TEXTURE1),H.viewport.set([0,0,W.width/4,W.height/4]);var Q=tt.heatmapFbo;if(Q)q.bindTexture(q.TEXTURE_2D,Q.colorAttachment.get()),H.bindFramebuffer.set(Q.framebuffer);else{var at=q.createTexture();q.bindTexture(q.TEXTURE_2D,at),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MIN_FILTER,q.LINEAR),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MAG_FILTER,q.LINEAR),Q=tt.heatmapFbo=H.createFramebuffer(W.width/4,W.height/4,!1),function(mt,Ct,wt,At){var Rt=mt.gl;Rt.texImage2D(Rt.TEXTURE_2D,0,Rt.RGBA,Ct.width/4,Ct.height/4,0,Rt.RGBA,mt.extRenderToTextureHalfFloat?mt.extTextureHalfFloat.HALF_FLOAT_OES:Rt.UNSIGNED_BYTE,null),At.colorAttachment.set(wt)}(H,W,at,Q)}})(p,n,i),p.clear({color:l.Color.transparent});for(var S=0;S<s.length;S++){var P=s[S];if(!o.hasRenderableParent(P)){var B=o.getTile(P),F=B.getBucket(i);if(F){var N=F.programConfigurations.get(i.id);n.useProgram("heatmap",N).draw(p,d.TRIANGLES,U.disabled,m,_,$.disabled,Us(P.posMatrix,B,n.transform.zoom,i.paint.get("heatmap-intensity")),i.id,F.layoutVertexBuffer,F.indexBuffer,F.segments,i.paint,n.transform.zoom,N)}}}p.viewport.set([0,0,n.width,n.height])}else n.renderPass==="translucent"&&(n.context.setColorMode(n.colorModeForRenderPass()),function(H,W){var tt=H.context,q=tt.gl,Q=W.heatmapFbo;if(Q){tt.activeTexture.set(q.TEXTURE0),q.bindTexture(q.TEXTURE_2D,Q.colorAttachment.get()),tt.activeTexture.set(q.TEXTURE1);var at=W.colorRampTexture;at||(at=W.colorRampTexture=new l.Texture(tt,W.colorRamp,q.RGBA)),at.bind(q.LINEAR,q.CLAMP_TO_EDGE),H.useProgram("heatmapTexture").draw(tt,q.TRIANGLES,U.disabled,G.disabled,H.colorModeForRenderPass(),$.disabled,function(mt,Ct,wt,At){var Rt=l.create();l.ortho(Rt,0,mt.width,mt.height,0,0,1);var Zt=mt.context.gl;return{u_matrix:Rt,u_world:[Zt.drawingBufferWidth,Zt.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:Ct.paint.get("heatmap-opacity")}}(H,W),W.id,H.viewportBuffer,H.quadTriangleIndexBuffer,H.viewportSegments,W.paint,H.transform.zoom)}}(n,i))},line:function(n,o,i,s){if(n.renderPass==="translucent"){var p=i.paint.get("line-opacity"),d=i.paint.get("line-width");if(p.constantOr(1)!==0&&d.constantOr(1)!==0)for(var m=n.depthModeForSublayer(0,U.ReadOnly),_=n.colorModeForRenderPass(),S=i.paint.get("line-dasharray"),P=i.paint.get("line-pattern"),B=P.constantOr(1),F=i.paint.get("line-gradient"),N=i.getCrossfadeParameters(),H=B?"linePattern":S?"lineSDF":F?"lineGradient":"line",W=n.context,tt=W.gl,q=!0,Q=0,at=s;Q<at.length;Q+=1){var mt=at[Q],Ct=o.getTile(mt);if(!B||Ct.patternsLoaded()){var wt=Ct.getBucket(i);if(wt){var At=wt.programConfigurations.get(i.id),Rt=n.context.program.get(),Zt=n.useProgram(H,At),qt=q||Zt.program!==Rt,ce=P.constantOr(null);if(ce&&Ct.imageAtlas){var we=Ct.imageAtlas,Ie=we.patternPositions[ce.to.toString()],Te=we.patternPositions[ce.from.toString()];Ie&&Te&&At.setConstantPatternPositions(Ie,Te)}var fr=B?Aa(n,Ct,i,N):S?Vs(n,Ct,i,S,N):F?Ar(n,Ct,i,wt.lineClipsArray.length):sa(n,Ct,i);if(B)W.activeTexture.set(tt.TEXTURE0),Ct.imageAtlasTexture.bind(tt.LINEAR,tt.CLAMP_TO_EDGE),At.updatePaintBuffers(N);else if(S&&(qt||n.lineAtlas.dirty))W.activeTexture.set(tt.TEXTURE0),n.lineAtlas.bind(W);else if(F){var de=wt.gradients[i.id],Ue=de.texture;if(i.gradientVersion!==de.version){var Je=256;if(i.stepInterpolant){var Be=o.getSource().maxzoom,Le=mt.canonical.z===Be?Math.ceil(1<<n.transform.maxZoom-mt.canonical.z):1;Je=l.clamp(l.nextPowerOfTwo(wt.maxLineLength/l.EXTENT*1024*Le),256,W.maxTextureSize)}de.gradient=l.renderColorRamp({expression:i.gradientExpression(),evaluationKey:"lineProgress",resolution:Je,image:de.gradient||void 0,clips:wt.lineClipsArray}),de.texture?de.texture.update(de.gradient):de.texture=new l.Texture(W,de.gradient,tt.RGBA),de.version=i.gradientVersion,Ue=de.texture}W.activeTexture.set(tt.TEXTURE0),Ue.bind(i.stepInterpolant?tt.NEAREST:tt.LINEAR,tt.CLAMP_TO_EDGE)}Zt.draw(W,tt.TRIANGLES,m,n.stencilModeForClipping(mt),_,$.disabled,fr,i.id,wt.layoutVertexBuffer,wt.indexBuffer,wt.segments,i.paint,n.transform.zoom,At,wt.layoutVertexBuffer2),q=!1}}}}},fill:function(n,o,i,s){var p=i.paint.get("fill-color"),d=i.paint.get("fill-opacity");if(d.constantOr(1)!==0){var m=n.colorModeForRenderPass(),_=i.paint.get("fill-pattern"),S=n.opaquePassEnabledForLayer()&&!_.constantOr(1)&&p.constantOr(l.Color.transparent).a===1&&d.constantOr(0)===1?"opaque":"translucent";if(n.renderPass===S){var P=n.depthModeForSublayer(1,n.renderPass==="opaque"?U.ReadWrite:U.ReadOnly);Io(n,o,i,s,P,m,!1)}if(n.renderPass==="translucent"&&i.paint.get("fill-antialias")){var B=n.depthModeForSublayer(i.getPaintProperty("fill-outline-color")?2:0,U.ReadOnly);Io(n,o,i,s,B,m,!0)}}},"fill-extrusion":function(n,o,i,s){var p=i.paint.get("fill-extrusion-opacity");if(p!==0&&n.renderPass==="translucent"){var d=new U(n.context.gl.LEQUAL,U.ReadWrite,n.depthRangeFor3D);if(p!==1||i.paint.get("fill-extrusion-pattern").constantOr(1))io(n,o,i,s,d,G.disabled,nt.disabled),io(n,o,i,s,d,n.stencilModeFor3D(),n.colorModeForRenderPass());else{var m=n.colorModeForRenderPass();io(n,o,i,s,d,G.disabled,m)}}},hillshade:function(n,o,i,s){if(n.renderPass==="offscreen"||n.renderPass==="translucent"){for(var p=n.context,d=n.depthModeForSublayer(0,U.ReadOnly),m=n.colorModeForRenderPass(),_=n.renderPass==="translucent"?n.stencilConfigForOverlap(s):[{},s],S=_[0],P=0,B=_[1];P<B.length;P+=1){var F=B[P],N=o.getTile(F);N.needsHillshadePrepare&&n.renderPass==="offscreen"?h(n,N,i,d,G.disabled,m):n.renderPass==="translucent"&&Ma(n,N,i,d,S[F.overscaledZ],m)}p.viewport.set([0,0,n.width,n.height])}},raster:function(n,o,i,s){if(n.renderPass==="translucent"&&i.paint.get("raster-opacity")!==0&&s.length)for(var p=n.context,d=p.gl,m=o.getSource(),_=n.useProgram("raster"),S=n.colorModeForRenderPass(),P=m instanceof Pi?[{},s]:n.stencilConfigForOverlap(s),B=P[0],F=P[1],N=F[F.length-1].overscaledZ,H=!n.options.moving,W=0,tt=F;W<tt.length;W+=1){var q=tt[W],Q=n.depthModeForSublayer(q.overscaledZ-N,i.paint.get("raster-opacity")===1?U.ReadWrite:U.ReadOnly,d.LESS),at=o.getTile(q),mt=n.transform.calculatePosMatrix(q.toUnwrapped(),H);at.registerFadeDuration(i.paint.get("raster-fade-duration"));var Ct=o.findLoadedParent(q,0),wt=g(at,Ct,o,i,n.transform),At=void 0,Rt=void 0,Zt=i.paint.get("raster-resampling")==="nearest"?d.NEAREST:d.LINEAR;p.activeTexture.set(d.TEXTURE0),at.texture.bind(Zt,d.CLAMP_TO_EDGE,d.LINEAR_MIPMAP_NEAREST),p.activeTexture.set(d.TEXTURE1),Ct?(Ct.texture.bind(Zt,d.CLAMP_TO_EDGE,d.LINEAR_MIPMAP_NEAREST),At=Math.pow(2,Ct.tileID.overscaledZ-at.tileID.overscaledZ),Rt=[at.tileID.canonical.x*At%1,at.tileID.canonical.y*At%1]):at.texture.bind(Zt,d.CLAMP_TO_EDGE,d.LINEAR_MIPMAP_NEAREST);var qt=ys(mt,Rt||[0,0],At||1,wt,i);m instanceof Pi?_.draw(p,d.TRIANGLES,Q,G.disabled,S,$.disabled,qt,i.id,m.boundsBuffer,n.quadTriangleIndexBuffer,m.boundsSegments):_.draw(p,d.TRIANGLES,Q,B[q.overscaledZ],S,$.disabled,qt,i.id,n.rasterBoundsBuffer,n.quadTriangleIndexBuffer,n.rasterBoundsSegments)}},background:function(n,o,i){var s=i.paint.get("background-color"),p=i.paint.get("background-opacity");if(p!==0){var d=n.context,m=d.gl,_=n.transform,S=_.tileSize,P=i.paint.get("background-pattern");if(!n.isPatternMissing(P)){var B=!P&&s.a===1&&p===1&&n.opaquePassEnabledForLayer()?"opaque":"translucent";if(n.renderPass===B){var F=G.disabled,N=n.depthModeForSublayer(0,B==="opaque"?U.ReadWrite:U.ReadOnly),H=n.colorModeForRenderPass(),W=n.useProgram(P?"backgroundPattern":"background"),tt=_.coveringTiles({tileSize:S});P&&(d.activeTexture.set(m.TEXTURE0),n.imageManager.bind(n.context));for(var q=i.getCrossfadeParameters(),Q=0,at=tt;Q<at.length;Q+=1){var mt=at[Q],Ct=n.transform.calculatePosMatrix(mt.toUnwrapped()),wt=P?ai(Ct,p,n,P,{tileID:mt,tileSize:S},q):Uo(Ct,p,s);W.draw(d,m.TRIANGLES,N,F,H,$.disabled,wt,i.id,n.tileExtentBuffer,n.quadTriangleIndexBuffer,n.tileExtentSegments)}}}}},debug:function(n,o,i){for(var s=0;s<i.length;s++)gt(n,o,i[s])},custom:function(n,o,i){var s=n.context,p=i.implementation;if(n.renderPass==="offscreen"){var d=p.prerender;d&&(n.setCustomLayerDefaults(),s.setColorMode(n.colorModeForRenderPass()),d.call(p,s.gl,n.transform.customLayerMatrix()),s.setDirty(),n.setBaseState())}else if(n.renderPass==="translucent"){n.setCustomLayerDefaults(),s.setColorMode(n.colorModeForRenderPass()),s.setStencilMode(G.disabled);var m=p.renderingMode==="3d"?new U(n.context.gl.LEQUAL,U.ReadWrite,n.depthRangeFor3D):n.depthModeForSublayer(0,U.ReadOnly);s.setDepthMode(m),p.render(s.gl,n.transform.customLayerMatrix()),s.setDirty(),n.setBaseState(),s.bindFramebuffer.set(null)}}},ft=function(n,o){this.context=new L(n),this.transform=o,this._tileTextures={},this.setup(),this.numSublayers=J.maxUnderzooming+J.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Qi,this.gpuTimers={}};ft.prototype.resize=function(n,o){if(this.width=n*l.browser.devicePixelRatio,this.height=o*l.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var i=0,s=this.style._order;i<s.length;i+=1)this.style._layers[s[i]].resize()},ft.prototype.setup=function(){var n=this.context,o=new l.StructArrayLayout2i4;o.emplaceBack(0,0),o.emplaceBack(l.EXTENT,0),o.emplaceBack(0,l.EXTENT),o.emplaceBack(l.EXTENT,l.EXTENT),this.tileExtentBuffer=n.createVertexBuffer(o,Hr.members),this.tileExtentSegments=l.SegmentVector.simpleSegment(0,0,4,2);var i=new l.StructArrayLayout2i4;i.emplaceBack(0,0),i.emplaceBack(l.EXTENT,0),i.emplaceBack(0,l.EXTENT),i.emplaceBack(l.EXTENT,l.EXTENT),this.debugBuffer=n.createVertexBuffer(i,Hr.members),this.debugSegments=l.SegmentVector.simpleSegment(0,0,4,5);var s=new l.StructArrayLayout4i8;s.emplaceBack(0,0,0,0),s.emplaceBack(l.EXTENT,0,l.EXTENT,0),s.emplaceBack(0,l.EXTENT,0,l.EXTENT),s.emplaceBack(l.EXTENT,l.EXTENT,l.EXTENT,l.EXTENT),this.rasterBoundsBuffer=n.createVertexBuffer(s,Wn.members),this.rasterBoundsSegments=l.SegmentVector.simpleSegment(0,0,4,2);var p=new l.StructArrayLayout2i4;p.emplaceBack(0,0),p.emplaceBack(1,0),p.emplaceBack(0,1),p.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(p,Hr.members),this.viewportSegments=l.SegmentVector.simpleSegment(0,0,4,2);var d=new l.StructArrayLayout1ui2;d.emplaceBack(0),d.emplaceBack(1),d.emplaceBack(3),d.emplaceBack(2),d.emplaceBack(0),this.tileBorderIndexBuffer=n.createIndexBuffer(d);var m=new l.StructArrayLayout3ui6;m.emplaceBack(0,1,2),m.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(m),this.emptyTexture=new l.Texture(n,{width:1,height:1,data:new Uint8Array([0,0,0,0])},n.gl.RGBA);var _=this.context.gl;this.stencilClearMode=new G({func:_.ALWAYS,mask:0},0,255,_.ZERO,_.ZERO,_.ZERO)},ft.prototype.clearStencil=function(){var n=this.context,o=n.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var i=l.create();l.ortho(i,0,this.width,this.height,0,0,1),l.scale(i,i,[o.drawingBufferWidth,o.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(n,o.TRIANGLES,U.disabled,this.stencilClearMode,nt.disabled,$.disabled,So(i),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},ft.prototype._renderTileClippingMasks=function(n,o){if(this.currentStencilSource!==n.source&&n.isTileClipped()&&o&&o.length){this.currentStencilSource=n.source;var i=this.context,s=i.gl;this.nextStencilID+o.length>256&&this.clearStencil(),i.setColorMode(nt.disabled),i.setDepthMode(U.disabled);var p=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var d=0,m=o;d<m.length;d+=1){var _=m[d],S=this._tileClippingMaskIDs[_.key]=this.nextStencilID++;p.draw(i,s.TRIANGLES,U.disabled,new G({func:s.ALWAYS,mask:0},S,255,s.KEEP,s.KEEP,s.REPLACE),nt.disabled,$.disabled,So(_.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},ft.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var n=this.nextStencilID++,o=this.context.gl;return new G({func:o.NOTEQUAL,mask:255},n,255,o.KEEP,o.KEEP,o.REPLACE)},ft.prototype.stencilModeForClipping=function(n){var o=this.context.gl;return new G({func:o.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,o.KEEP,o.KEEP,o.REPLACE)},ft.prototype.stencilConfigForOverlap=function(n){var o,i=this.context.gl,s=n.sort(function(S,P){return P.overscaledZ-S.overscaledZ}),p=s[s.length-1].overscaledZ,d=s[0].overscaledZ-p+1;if(d>1){this.currentStencilSource=void 0,this.nextStencilID+d>256&&this.clearStencil();for(var m={},_=0;_<d;_++)m[_+p]=new G({func:i.GEQUAL,mask:255},_+this.nextStencilID,255,i.KEEP,i.KEEP,i.REPLACE);return this.nextStencilID+=d,[m,s]}return[(o={},o[p]=G.disabled,o),s]},ft.prototype.colorModeForRenderPass=function(){var n=this.context.gl;return this._showOverdrawInspector?new nt([n.CONSTANT_COLOR,n.ONE],new l.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?nt.unblended:nt.alphaBlended},ft.prototype.depthModeForSublayer=function(n,o,i){if(!this.opaquePassEnabledForLayer())return U.disabled;var s=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new U(i||this.context.gl.LEQUAL,o,[s,s])},ft.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},ft.prototype.render=function(n,o){var i=this;this.style=n,this.options=o,this.lineAtlas=n.lineAtlas,this.imageManager=n.imageManager,this.glyphManager=n.glyphManager,this.symbolFadeChange=n.placement.symbolFadeChange(l.browser.now()),this.imageManager.beginFrame();var s=this.style._order,p=this.style.sourceCaches;for(var d in p){var m=p[d];m.used&&m.prepare(this.context)}var _,S,P={},B={},F={};for(var N in p){var H=p[N];P[N]=H.getVisibleCoordinates(),B[N]=P[N].slice().reverse(),F[N]=H.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var W=0;W<s.length;W++)if(this.style._layers[s[W]].is3D()){this.opaquePassCutoff=W;break}this.renderPass="offscreen";for(var tt=0,q=s;tt<q.length;tt+=1){var Q=this.style._layers[q[tt]];if(Q.hasOffscreenPass()&&!Q.isHidden(this.transform.zoom)){var at=B[Q.source];(Q.type==="custom"||at.length)&&this.renderLayer(this,p[Q.source],Q,at)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:o.showOverdrawInspector?l.Color.black:l.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=o.showOverdrawInspector,this.depthRangeFor3D=[0,1-(n._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=s.length-1;this.currentLayer>=0;this.currentLayer--){var mt=this.style._layers[s[this.currentLayer]],Ct=p[mt.source],wt=P[mt.source];this._renderTileClippingMasks(mt,wt),this.renderLayer(this,Ct,mt,wt)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<s.length;this.currentLayer++){var At=this.style._layers[s[this.currentLayer]],Rt=p[At.source],Zt=(At.type==="symbol"?F:B)[At.source];this._renderTileClippingMasks(At,P[At.source]),this.renderLayer(this,Rt,At,Zt)}this.options.showTileBoundaries&&(l.values(this.style._layers).forEach(function(qt){qt.source&&!qt.isHidden(i.transform.zoom)&&(qt.source!==(S&&S.id)&&(S=i.style.sourceCaches[qt.source]),(!_||_.getSource().maxzoom<S.getSource().maxzoom)&&(_=S))}),_&&it.debug(this,_,_.getVisibleCoordinates())),this.options.showPadding&&function(qt){var ce=qt.transform.padding;et(qt,qt.transform.height-(ce.top||0),3,b),et(qt,ce.bottom||0,3,T),lt(qt,ce.left||0,3,k),lt(qt,qt.transform.width-(ce.right||0),3,R);var we=qt.transform.centerPoint;(function(Ie,Te,fr,de){ht(Ie,Te-1,fr-10,2,20,de),ht(Ie,Te-10,fr-1,20,2,de)})(qt,we.x,qt.transform.height-we.y,K)}(this),this.context.setDefault()},ft.prototype.renderLayer=function(n,o,i,s){i.isHidden(this.transform.zoom)||(i.type==="background"||i.type==="custom"||s.length)&&(this.id=i.id,this.gpuTimingStart(i),it[i.type](n,o,i,s,this.style.placement.variableOffsets),this.gpuTimingEnd())},ft.prototype.gpuTimingStart=function(n){if(this.options.gpuTiming){var o=this.context.extTimerQuery,i=this.gpuTimers[n.id];i||(i=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:o.createQueryEXT()}),i.calls++,o.beginQueryEXT(o.TIME_ELAPSED_EXT,i.query)}},ft.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}},ft.prototype.collectGpuTimers=function(){var n=this.gpuTimers;return this.gpuTimers={},n},ft.prototype.queryGpuTimers=function(n){var o={};for(var i in n){var s=n[i],p=this.context.extTimerQuery,d=p.getQueryObjectEXT(s.query,p.QUERY_RESULT_EXT)/1e6;p.deleteQueryEXT(s.query),o[i]=d}return o},ft.prototype.translatePosMatrix=function(n,o,i,s,p){if(!i[0]&&!i[1])return n;var d=p?s==="map"?this.transform.angle:0:s==="viewport"?-this.transform.angle:0;if(d){var m=Math.sin(d),_=Math.cos(d);i=[i[0]*_-i[1]*m,i[0]*m+i[1]*_]}var S=[p?i[0]:se(o,i[0],this.transform.zoom),p?i[1]:se(o,i[1],this.transform.zoom),0],P=new Float32Array(16);return l.translate(P,n,S),P},ft.prototype.saveTileTexture=function(n){var o=this._tileTextures[n.size[0]];o?o.push(n):this._tileTextures[n.size[0]]=[n]},ft.prototype.getTileTexture=function(n){var o=this._tileTextures[n];return o&&o.length>0?o.pop():null},ft.prototype.isPatternMissing=function(n){if(!n)return!1;if(!n.from||!n.to)return!0;var o=this.imageManager.getPattern(n.from.toString()),i=this.imageManager.getPattern(n.to.toString());return!o||!i},ft.prototype.useProgram=function(n,o){this.cache=this.cache||{};var i=""+n+(o?o.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[i]||(this.cache[i]=new Ha(this.context,n,Bs[n],o,Yr[n],this._showOverdrawInspector)),this.cache[i]},ft.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},ft.prototype.setBaseState=function(){var n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)},ft.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=l.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new l.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},ft.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var pt=function(n,o){this.points=n,this.planes=o};pt.fromInvProjectionMatrix=function(n,o,i){var s=Math.pow(2,i),p=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(m){return l.transformMat4([],m,n)}).map(function(m){return l.scale$1([],m,1/m[3]/o*s)}),d=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(m){var _=l.sub([],p[m[0]],p[m[1]]),S=l.sub([],p[m[2]],p[m[1]]),P=l.normalize([],l.cross([],_,S)),B=-l.dot(P,p[m[1]]);return P.concat(B)});return new pt(p,d)};var dt=function(n,o){this.min=n,this.max=o,this.center=l.scale$2([],l.add([],this.min,this.max),.5)};dt.prototype.quadrant=function(n){for(var o=[n%2==0,n<2],i=l.clone$2(this.min),s=l.clone$2(this.max),p=0;p<o.length;p++)i[p]=o[p]?this.min[p]:this.center[p],s[p]=o[p]?this.center[p]:this.max[p];return s[2]=this.max[2],new dt(i,s)},dt.prototype.distanceX=function(n){return Math.max(Math.min(this.max[0],n[0]),this.min[0])-n[0]},dt.prototype.distanceY=function(n){return Math.max(Math.min(this.max[1],n[1]),this.min[1])-n[1]},dt.prototype.intersects=function(n){for(var o=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],i=!0,s=0;s<n.planes.length;s++){for(var p=n.planes[s],d=0,m=0;m<o.length;m++)d+=l.dot$1(p,o[m])>=0;if(d===0)return 0;d!==o.length&&(i=!1)}if(i)return 2;for(var _=0;_<3;_++){for(var S=Number.MAX_VALUE,P=-Number.MAX_VALUE,B=0;B<n.points.length;B++){var F=n.points[B][_]-this.min[_];S=Math.min(S,F),P=Math.max(P,F)}if(P<0||S>this.max[_]-this.min[_])return 0}return 1};var _t=function(n,o,i,s){if(n===void 0&&(n=0),o===void 0&&(o=0),i===void 0&&(i=0),s===void 0&&(s=0),isNaN(n)||n<0||isNaN(o)||o<0||isNaN(i)||i<0||isNaN(s)||s<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=o,this.left=i,this.right=s};_t.prototype.interpolate=function(n,o,i){return o.top!=null&&n.top!=null&&(this.top=l.number(n.top,o.top,i)),o.bottom!=null&&n.bottom!=null&&(this.bottom=l.number(n.bottom,o.bottom,i)),o.left!=null&&n.left!=null&&(this.left=l.number(n.left,o.left,i)),o.right!=null&&n.right!=null&&(this.right=l.number(n.right,o.right,i)),this},_t.prototype.getCenter=function(n,o){var i=l.clamp((this.left+n-this.right)/2,0,n),s=l.clamp((this.top+o-this.bottom)/2,0,o);return new l.Point(i,s)},_t.prototype.equals=function(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right},_t.prototype.clone=function(){return new _t(this.top,this.bottom,this.left,this.right)},_t.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var ot=function(n,o,i,s,p){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=p===void 0||p,this._minZoom=n||0,this._maxZoom=o||22,this._minPitch=i??0,this._maxPitch=s??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new l.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new _t,this._posMatrixCache={},this._alignedPosMatrixCache={}},yt={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};ot.prototype.clone=function(){var n=new ot(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return n.tileSize=this.tileSize,n.latRange=this.latRange,n.width=this.width,n.height=this.height,n._center=this._center,n.zoom=this.zoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._calcMatrices(),n},yt.minZoom.get=function(){return this._minZoom},yt.minZoom.set=function(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))},yt.maxZoom.get=function(){return this._maxZoom},yt.maxZoom.set=function(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))},yt.minPitch.get=function(){return this._minPitch},yt.minPitch.set=function(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))},yt.maxPitch.get=function(){return this._maxPitch},yt.maxPitch.set=function(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))},yt.renderWorldCopies.get=function(){return this._renderWorldCopies},yt.renderWorldCopies.set=function(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n},yt.worldSize.get=function(){return this.tileSize*this.scale},yt.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},yt.size.get=function(){return new l.Point(this.width,this.height)},yt.bearing.get=function(){return-this.angle/Math.PI*180},yt.bearing.set=function(n){var o=-l.wrap(n,-180,180)*Math.PI/180;this.angle!==o&&(this._unmodified=!1,this.angle=o,this._calcMatrices(),this.rotationMatrix=l.create$2(),l.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},yt.pitch.get=function(){return this._pitch/Math.PI*180},yt.pitch.set=function(n){var o=l.clamp(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==o&&(this._unmodified=!1,this._pitch=o,this._calcMatrices())},yt.fov.get=function(){return this._fov/Math.PI*180},yt.fov.set=function(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=n/180*Math.PI,this._calcMatrices())},yt.zoom.get=function(){return this._zoom},yt.zoom.set=function(n){var o=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==o&&(this._unmodified=!1,this._zoom=o,this.scale=this.zoomScale(o),this.tileZoom=Math.floor(o),this.zoomFraction=o-this.tileZoom,this._constrain(),this._calcMatrices())},yt.center.get=function(){return this._center},yt.center.set=function(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._constrain(),this._calcMatrices())},yt.padding.get=function(){return this._edgeInsets.toJSON()},yt.padding.set=function(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())},yt.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},ot.prototype.isPaddingEqual=function(n){return this._edgeInsets.equals(n)},ot.prototype.interpolatePadding=function(n,o,i){this._unmodified=!1,this._edgeInsets.interpolate(n,o,i),this._constrain(),this._calcMatrices()},ot.prototype.coveringZoomLevel=function(n){var o=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,o)},ot.prototype.getVisibleUnwrappedCoordinates=function(n){var o=[new l.UnwrappedTileID(0,n)];if(this._renderWorldCopies)for(var i=this.pointCoordinate(new l.Point(0,0)),s=this.pointCoordinate(new l.Point(this.width,0)),p=this.pointCoordinate(new l.Point(this.width,this.height)),d=this.pointCoordinate(new l.Point(0,this.height)),m=Math.floor(Math.min(i.x,s.x,p.x,d.x)),_=Math.floor(Math.max(i.x,s.x,p.x,d.x)),S=m-1;S<=_+1;S++)S!==0&&o.push(new l.UnwrappedTileID(S,n));return o},ot.prototype.coveringTiles=function(n){var o=this.coveringZoomLevel(n),i=o;if(n.minzoom!==void 0&&o<n.minzoom)return[];n.maxzoom!==void 0&&o>n.maxzoom&&(o=n.maxzoom);var s=l.MercatorCoordinate.fromLngLat(this.center),p=Math.pow(2,o),d=[p*s.x,p*s.y,0],m=pt.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,o),_=n.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(_=o);var S=function(qt){return{aabb:new dt([qt*p,0,0],[(qt+1)*p,p,0]),zoom:0,x:0,y:0,wrap:qt,fullyVisible:!1}},P=[],B=[],F=o,N=n.reparseOverscaled?i:o;if(this._renderWorldCopies)for(var H=1;H<=3;H++)P.push(S(-H)),P.push(S(H));for(P.push(S(0));P.length>0;){var W=P.pop(),tt=W.x,q=W.y,Q=W.fullyVisible;if(!Q){var at=W.aabb.intersects(m);if(at===0)continue;Q=at===2}var mt=W.aabb.distanceX(d),Ct=W.aabb.distanceY(d),wt=Math.max(Math.abs(mt),Math.abs(Ct));if(W.zoom===F||wt>3+(1<<F-W.zoom)-2&&W.zoom>=_)B.push({tileID:new l.OverscaledTileID(W.zoom===F?N:W.zoom,W.wrap,W.zoom,tt,q),distanceSq:l.sqrLen([d[0]-.5-tt,d[1]-.5-q])});else for(var At=0;At<4;At++){var Rt=(tt<<1)+At%2,Zt=(q<<1)+(At>>1);P.push({aabb:W.aabb.quadrant(At),zoom:W.zoom+1,x:Rt,y:Zt,wrap:W.wrap,fullyVisible:Q})}}return B.sort(function(qt,ce){return qt.distanceSq-ce.distanceSq}).map(function(qt){return qt.tileID})},ot.prototype.resize=function(n,o){this.width=n,this.height=o,this.pixelsToGLUnits=[2/n,-2/o],this._constrain(),this._calcMatrices()},yt.unmodified.get=function(){return this._unmodified},ot.prototype.zoomScale=function(n){return Math.pow(2,n)},ot.prototype.scaleZoom=function(n){return Math.log(n)/Math.LN2},ot.prototype.project=function(n){var o=l.clamp(n.lat,-this.maxValidLatitude,this.maxValidLatitude);return new l.Point(l.mercatorXfromLng(n.lng)*this.worldSize,l.mercatorYfromLat(o)*this.worldSize)},ot.prototype.unproject=function(n){return new l.MercatorCoordinate(n.x/this.worldSize,n.y/this.worldSize).toLngLat()},yt.point.get=function(){return this.project(this.center)},ot.prototype.setLocationAtPoint=function(n,o){var i=this.pointCoordinate(o),s=this.pointCoordinate(this.centerPoint),p=this.locationCoordinate(n),d=new l.MercatorCoordinate(p.x-(i.x-s.x),p.y-(i.y-s.y));this.center=this.coordinateLocation(d),this._renderWorldCopies&&(this.center=this.center.wrap())},ot.prototype.locationPoint=function(n){return this.coordinatePoint(this.locationCoordinate(n))},ot.prototype.pointLocation=function(n){return this.coordinateLocation(this.pointCoordinate(n))},ot.prototype.locationCoordinate=function(n){return l.MercatorCoordinate.fromLngLat(n)},ot.prototype.coordinateLocation=function(n){return n.toLngLat()},ot.prototype.pointCoordinate=function(n){var o=[n.x,n.y,0,1],i=[n.x,n.y,1,1];l.transformMat4(o,o,this.pixelMatrixInverse),l.transformMat4(i,i,this.pixelMatrixInverse);var s=o[3],p=i[3],d=o[1]/s,m=i[1]/p,_=o[2]/s,S=i[2]/p,P=_===S?0:(0-_)/(S-_);return new l.MercatorCoordinate(l.number(o[0]/s,i[0]/p,P)/this.worldSize,l.number(d,m,P)/this.worldSize)},ot.prototype.coordinatePoint=function(n){var o=[n.x*this.worldSize,n.y*this.worldSize,0,1];return l.transformMat4(o,o,this.pixelMatrix),new l.Point(o[0]/o[3],o[1]/o[3])},ot.prototype.getBounds=function(){return new l.LngLatBounds().extend(this.pointLocation(new l.Point(0,0))).extend(this.pointLocation(new l.Point(this.width,0))).extend(this.pointLocation(new l.Point(this.width,this.height))).extend(this.pointLocation(new l.Point(0,this.height)))},ot.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new l.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},ot.prototype.setMaxBounds=function(n){n?(this.lngRange=[n.getWest(),n.getEast()],this.latRange=[n.getSouth(),n.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},ot.prototype.calculatePosMatrix=function(n,o){o===void 0&&(o=!1);var i=n.key,s=o?this._alignedPosMatrixCache:this._posMatrixCache;if(s[i])return s[i];var p=n.canonical,d=this.worldSize/this.zoomScale(p.z),m=p.x+Math.pow(2,p.z)*n.wrap,_=l.identity(new Float64Array(16));return l.translate(_,_,[m*d,p.y*d,0]),l.scale(_,_,[d/l.EXTENT,d/l.EXTENT,1]),l.multiply(_,o?this.alignedProjMatrix:this.projMatrix,_),s[i]=new Float32Array(_),s[i]},ot.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},ot.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var n,o,i,s,p=-90,d=90,m=-180,_=180,S=this.size,P=this._unmodified;if(this.latRange){var B=this.latRange;p=l.mercatorYfromLat(B[1])*this.worldSize,n=(d=l.mercatorYfromLat(B[0])*this.worldSize)-p<S.y?S.y/(d-p):0}if(this.lngRange){var F=this.lngRange;m=l.mercatorXfromLng(F[0])*this.worldSize,o=(_=l.mercatorXfromLng(F[1])*this.worldSize)-m<S.x?S.x/(_-m):0}var N=this.point,H=Math.max(o||0,n||0);if(H)return this.center=this.unproject(new l.Point(o?(_+m)/2:N.x,n?(d+p)/2:N.y)),this.zoom+=this.scaleZoom(H),this._unmodified=P,void(this._constraining=!1);if(this.latRange){var W=N.y,tt=S.y/2;W-tt<p&&(s=p+tt),W+tt>d&&(s=d-tt)}if(this.lngRange){var q=N.x,Q=S.x/2;q-Q<m&&(i=m+Q),q+Q>_&&(i=_-Q)}i===void 0&&s===void 0||(this.center=this.unproject(new l.Point(i!==void 0?i:N.x,s!==void 0?s:N.y))),this._unmodified=P,this._constraining=!1}},ot.prototype._calcMatrices=function(){if(this.height){var n=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var o=Math.PI/2+this._pitch,i=this._fov*(.5+n.y/this.height),s=Math.sin(i)*this.cameraToCenterDistance/Math.sin(l.clamp(Math.PI-o-i,.01,Math.PI-.01)),p=this.point,d=p.x,m=p.y,_=1.01*(Math.cos(Math.PI/2-this._pitch)*s+this.cameraToCenterDistance),S=this.height/50,P=new Float64Array(16);l.perspective(P,this._fov,this.width/this.height,S,_),P[8]=2*-n.x/this.width,P[9]=2*n.y/this.height,l.scale(P,P,[1,-1,1]),l.translate(P,P,[0,0,-this.cameraToCenterDistance]),l.rotateX(P,P,this._pitch),l.rotateZ(P,P,this.angle),l.translate(P,P,[-d,-m,0]),this.mercatorMatrix=l.scale([],P,[this.worldSize,this.worldSize,this.worldSize]),l.scale(P,P,[1,1,l.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=P,this.invProjMatrix=l.invert([],this.projMatrix);var B=this.width%2/2,F=this.height%2/2,N=Math.cos(this.angle),H=Math.sin(this.angle),W=d-Math.round(d)+N*B+H*F,tt=m-Math.round(m)+N*F+H*B,q=new Float64Array(P);if(l.translate(q,q,[W>.5?W-1:W,tt>.5?tt-1:tt,0]),this.alignedProjMatrix=q,P=l.create(),l.scale(P,P,[this.width/2,-this.height/2,1]),l.translate(P,P,[1,-1,0]),this.labelPlaneMatrix=P,P=l.create(),l.scale(P,P,[1,-1,1]),l.translate(P,P,[-1,-1,0]),l.scale(P,P,[2/this.width,2/this.height,1]),this.glCoordMatrix=P,this.pixelMatrix=l.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(P=l.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=P,this._posMatrixCache={},this._alignedPosMatrixCache={}}},ot.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var n=this.pointCoordinate(new l.Point(0,0)),o=[n.x*this.worldSize,n.y*this.worldSize,0,1];return l.transformMat4(o,o,this.pixelMatrix)[3]/this.cameraToCenterDistance},ot.prototype.getCameraPoint=function(){var n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.Point(0,n))},ot.prototype.getCameraQueryGeometry=function(n){var o=this.getCameraPoint();if(n.length===1)return[n[0],o];for(var i=o.x,s=o.y,p=o.x,d=o.y,m=0,_=n;m<_.length;m+=1){var S=_[m];i=Math.min(i,S.x),s=Math.min(s,S.y),p=Math.max(p,S.x),d=Math.max(d,S.y)}return[new l.Point(i,s),new l.Point(p,s),new l.Point(p,d),new l.Point(i,d),new l.Point(i,s)]},Object.defineProperties(ot.prototype,yt);var It=function(n){var o,i,s,p;this._hashName=n&&encodeURIComponent(n),l.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(o=this._updateHashUnthrottled.bind(this),i=!1,s=null,p=function(){s=null,i&&(o(),s=setTimeout(p,300),i=!1)},function(){return i=!0,s||p(),s})};It.prototype.addTo=function(n){return this._map=n,l.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},It.prototype.remove=function(){return l.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},It.prototype.getHashString=function(n){var o=this._map.getCenter(),i=Math.round(100*this._map.getZoom())/100,s=Math.ceil((i*Math.LN2+Math.log(512/360/.5))/Math.LN10),p=Math.pow(10,s),d=Math.round(o.lng*p)/p,m=Math.round(o.lat*p)/p,_=this._map.getBearing(),S=this._map.getPitch(),P="";if(P+=n?"/"+d+"/"+m+"/"+i:i+"/"+m+"/"+d,(_||S)&&(P+="/"+Math.round(10*_)/10),S&&(P+="/"+Math.round(S)),this._hashName){var B=this._hashName,F=!1,N=l.window.location.hash.slice(1).split("&").map(function(H){var W=H.split("=")[0];return W===B?(F=!0,W+"="+P):H}).filter(function(H){return H});return F||N.push(B+"="+P),"#"+N.join("&")}return"#"+P},It.prototype._getCurrentHash=function(){var n,o=this,i=l.window.location.hash.replace("#","");return this._hashName?(i.split("&").map(function(s){return s.split("=")}).forEach(function(s){s[0]===o._hashName&&(n=s)}),(n&&n[1]||"").split("/")):i.split("/")},It.prototype._onHashChange=function(){var n=this._getCurrentHash();if(n.length>=3&&!n.some(function(i){return isNaN(i)})){var o=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(n[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:o,pitch:+(n[4]||0)}),!0}return!1},It.prototype._updateHashUnthrottled=function(){var n=l.window.location.href.replace(/(#.+)?$/,this.getHashString());try{l.window.history.replaceState(l.window.history.state,null,n)}catch{}};var Pt={linearity:.3,easing:l.bezier(0,0,.3,1)},Dt=l.extend({deceleration:2500,maxSpeed:1400},Pt),$t=l.extend({deceleration:20,maxSpeed:1400},Pt),he=l.extend({deceleration:1e3,maxSpeed:360},Pt),ee=l.extend({deceleration:1e3,maxSpeed:90},Pt),re=function(n){this._map=n,this.clear()};function fe(n,o){(!n.duration||n.duration<o.duration)&&(n.duration=o.duration,n.easing=o.easing)}function ne(n,o,i){var s=i.maxSpeed,p=i.linearity,d=i.deceleration,m=l.clamp(n*p/(o/1e3),-s,s),_=Math.abs(m)/(d*p);return{easing:i.easing,duration:1e3*_,amount:m*(_/2)}}re.prototype.clear=function(){this._inertiaBuffer=[]},re.prototype.record=function(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:l.browser.now(),settings:n})},re.prototype._drainInertiaBuffer=function(){for(var n=this._inertiaBuffer,o=l.browser.now();n.length>0&&o-n[0].time>160;)n.shift()},re.prototype._onMoveEnd=function(n){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var o={zoom:0,bearing:0,pitch:0,pan:new l.Point(0,0),pinchAround:void 0,around:void 0},i=0,s=this._inertiaBuffer;i<s.length;i+=1){var p=s[i].settings;o.zoom+=p.zoomDelta||0,o.bearing+=p.bearingDelta||0,o.pitch+=p.pitchDelta||0,p.panDelta&&o.pan._add(p.panDelta),p.around&&(o.around=p.around),p.pinchAround&&(o.pinchAround=p.pinchAround)}var d=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(o.pan.mag()){var _=ne(o.pan.mag(),d,l.extend({},Dt,n||{}));m.offset=o.pan.mult(_.amount/o.pan.mag()),m.center=this._map.transform.center,fe(m,_)}if(o.zoom){var S=ne(o.zoom,d,$t);m.zoom=this._map.transform.zoom+S.amount,fe(m,S)}if(o.bearing){var P=ne(o.bearing,d,he);m.bearing=this._map.transform.bearing+l.clamp(P.amount,-179,179),fe(m,P)}if(o.pitch){var B=ne(o.pitch,d,ee);m.pitch=this._map.transform.pitch+B.amount,fe(m,B)}if(m.zoom||m.bearing){var F=o.pinchAround===void 0?o.around:o.pinchAround;m.around=F?this._map.unproject(F):this._map.getCenter()}return this.clear(),l.extend(m,{noMoveStart:!0})}};var ae=function(n){function o(s,p,d,m){m===void 0&&(m={});var _=Ot.mousePos(p.getCanvasContainer(),d),S=p.unproject(_);n.call(this,s,l.extend({point:_,lngLat:S,originalEvent:d},m)),this._defaultPrevented=!1,this.target=p}n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o;var i={defaultPrevented:{configurable:!0}};return o.prototype.preventDefault=function(){this._defaultPrevented=!0},i.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(o.prototype,i),o}(l.Event),$e=function(n){function o(s,p,d){var m=s==="touchend"?d.changedTouches:d.touches,_=Ot.touchPos(p.getCanvasContainer(),m),S=_.map(function(F){return p.unproject(F)}),P=_.reduce(function(F,N,H,W){return F.add(N.div(W.length))},new l.Point(0,0)),B=p.unproject(P);n.call(this,s,{points:_,point:P,lngLats:S,lngLat:B,originalEvent:d}),this._defaultPrevented=!1}n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o;var i={defaultPrevented:{configurable:!0}};return o.prototype.preventDefault=function(){this._defaultPrevented=!0},i.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(o.prototype,i),o}(l.Event),cr=function(n){function o(s,p,d){n.call(this,s,{originalEvent:d}),this._defaultPrevented=!1}n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o;var i={defaultPrevented:{configurable:!0}};return o.prototype.preventDefault=function(){this._defaultPrevented=!0},i.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(o.prototype,i),o}(l.Event),Ae=function(n,o){this._map=n,this._clickTolerance=o.clickTolerance};Ae.prototype.reset=function(){delete this._mousedownPos},Ae.prototype.wheel=function(n){return this._firePreventable(new cr(n.type,this._map,n))},Ae.prototype.mousedown=function(n,o){return this._mousedownPos=o,this._firePreventable(new ae(n.type,this._map,n))},Ae.prototype.mouseup=function(n){this._map.fire(new ae(n.type,this._map,n))},Ae.prototype.click=function(n,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||this._map.fire(new ae(n.type,this._map,n))},Ae.prototype.dblclick=function(n){return this._firePreventable(new ae(n.type,this._map,n))},Ae.prototype.mouseover=function(n){this._map.fire(new ae(n.type,this._map,n))},Ae.prototype.mouseout=function(n){this._map.fire(new ae(n.type,this._map,n))},Ae.prototype.touchstart=function(n){return this._firePreventable(new $e(n.type,this._map,n))},Ae.prototype.touchmove=function(n){this._map.fire(new $e(n.type,this._map,n))},Ae.prototype.touchend=function(n){this._map.fire(new $e(n.type,this._map,n))},Ae.prototype.touchcancel=function(n){this._map.fire(new $e(n.type,this._map,n))},Ae.prototype._firePreventable=function(n){if(this._map.fire(n),n.defaultPrevented)return{}},Ae.prototype.isEnabled=function(){return!0},Ae.prototype.isActive=function(){return!1},Ae.prototype.enable=function(){},Ae.prototype.disable=function(){};var Qt=function(n){this._map=n};Qt.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},Qt.prototype.mousemove=function(n){this._map.fire(new ae(n.type,this._map,n))},Qt.prototype.mousedown=function(){this._delayContextMenu=!0},Qt.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ae("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},Qt.prototype.contextmenu=function(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new ae(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()},Qt.prototype.isEnabled=function(){return!0},Qt.prototype.isActive=function(){return!1},Qt.prototype.enable=function(){},Qt.prototype.disable=function(){};var De=function(n,o){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=o.clickTolerance||1};function En(n,o){for(var i={},s=0;s<n.length;s++)i[n[s].identifier]=o[s];return i}De.prototype.isEnabled=function(){return!!this._enabled},De.prototype.isActive=function(){return!!this._active},De.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},De.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},De.prototype.mousedown=function(n,o){this.isEnabled()&&n.shiftKey&&n.button===0&&(Ot.disableDrag(),this._startPos=this._lastPos=o,this._active=!0)},De.prototype.mousemoveWindow=function(n,o){if(this._active){var i=o;if(!(this._lastPos.equals(i)||!this._box&&i.dist(this._startPos)<this._clickTolerance)){var s=this._startPos;this._lastPos=i,this._box||(this._box=Ot.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));var p=Math.min(s.x,i.x),d=Math.max(s.x,i.x),m=Math.min(s.y,i.y),_=Math.max(s.y,i.y);Ot.setTransform(this._box,"translate("+p+"px,"+m+"px)"),this._box.style.width=d-p+"px",this._box.style.height=_-m+"px"}}},De.prototype.mouseupWindow=function(n,o){var i=this;if(this._active&&n.button===0){var s=this._startPos,p=o;if(this.reset(),Ot.suppressClick(),s.x!==p.x||s.y!==p.y)return this._map.fire(new l.Event("boxzoomend",{originalEvent:n})),{cameraAnimation:function(d){return d.fitScreenCoordinates(s,p,i._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",n)}},De.prototype.keydown=function(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))},De.prototype.blur=function(){this.reset()},De.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(Ot.remove(this._box),this._box=null),Ot.enableDrag(),delete this._startPos,delete this._lastPos},De.prototype._fireEvent=function(n,o){return this._map.fire(new l.Event(n,{originalEvent:o}))};var an=function(n){this.reset(),this.numTouches=n.numTouches};an.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},an.prototype.touchstart=function(n,o,i){(this.centroid||i.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=n.timeStamp),i.length===this.numTouches&&(this.centroid=function(s){for(var p=new l.Point(0,0),d=0,m=s;d<m.length;d+=1)p._add(m[d]);return p.div(s.length)}(o),this.touches=En(i,o)))},an.prototype.touchmove=function(n,o,i){if(!this.aborted&&this.centroid){var s=En(i,o);for(var p in this.touches){var d=s[p];(!d||d.dist(this.touches[p])>30)&&(this.aborted=!0)}}},an.prototype.touchend=function(n,o,i){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),i.length===0){var s=!this.aborted&&this.centroid;if(this.reset(),s)return s}};var si=function(n){this.singleTap=new an(n),this.numTaps=n.numTaps,this.reset()};si.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},si.prototype.touchstart=function(n,o,i){this.singleTap.touchstart(n,o,i)},si.prototype.touchmove=function(n,o,i){this.singleTap.touchmove(n,o,i)},si.prototype.touchend=function(n,o,i){var s=this.singleTap.touchend(n,o,i);if(s){var p=n.timeStamp-this.lastTime<500,d=!this.lastTap||this.lastTap.dist(s)<30;if(p&&d||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=s,this.count===this.numTaps)return this.reset(),s}};var zr=function(){this._zoomIn=new si({numTouches:1,numTaps:2}),this._zoomOut=new si({numTouches:2,numTaps:1}),this.reset()};zr.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},zr.prototype.touchstart=function(n,o,i){this._zoomIn.touchstart(n,o,i),this._zoomOut.touchstart(n,o,i)},zr.prototype.touchmove=function(n,o,i){this._zoomIn.touchmove(n,o,i),this._zoomOut.touchmove(n,o,i)},zr.prototype.touchend=function(n,o,i){var s=this,p=this._zoomIn.touchend(n,o,i),d=this._zoomOut.touchend(n,o,i);return p?(this._active=!0,n.preventDefault(),setTimeout(function(){return s.reset()},0),{cameraAnimation:function(m){return m.easeTo({duration:300,zoom:m.getZoom()+1,around:m.unproject(p)},{originalEvent:n})}}):d?(this._active=!0,n.preventDefault(),setTimeout(function(){return s.reset()},0),{cameraAnimation:function(m){return m.easeTo({duration:300,zoom:m.getZoom()-1,around:m.unproject(d)},{originalEvent:n})}}):void 0},zr.prototype.touchcancel=function(){this.reset()},zr.prototype.enable=function(){this._enabled=!0},zr.prototype.disable=function(){this._enabled=!1,this.reset()},zr.prototype.isEnabled=function(){return this._enabled},zr.prototype.isActive=function(){return this._active};var Co={0:1,2:2},Ht=function(n){this.reset(),this._clickTolerance=n.clickTolerance||1};Ht.prototype.blur=function(){this.reset()},Ht.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},Ht.prototype._correctButton=function(n,o){return!1},Ht.prototype._move=function(n,o){return{}},Ht.prototype.mousedown=function(n,o){if(!this._lastPoint){var i=Ot.mouseButton(n);this._correctButton(n,i)&&(this._lastPoint=o,this._eventButton=i)}},Ht.prototype.mousemoveWindow=function(n,o){var i=this._lastPoint;if(i){if(n.preventDefault(),function(s,p){var d=Co[p];return s.buttons===void 0||(s.buttons&d)!==d}(n,this._eventButton))this.reset();else if(this._moved||!(o.dist(i)<this._clickTolerance))return this._moved=!0,this._lastPoint=o,this._move(i,o)}},Ht.prototype.mouseupWindow=function(n){this._lastPoint&&Ot.mouseButton(n)===this._eventButton&&(this._moved&&Ot.suppressClick(),this.reset())},Ht.prototype.enable=function(){this._enabled=!0},Ht.prototype.disable=function(){this._enabled=!1,this.reset()},Ht.prototype.isEnabled=function(){return this._enabled},Ht.prototype.isActive=function(){return this._active};var Cu=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.mousedown=function(i,s){n.prototype.mousedown.call(this,i,s),this._lastPoint&&(this._active=!0)},o.prototype._correctButton=function(i,s){return s===0&&!i.ctrlKey},o.prototype._move=function(i,s){return{around:s,panDelta:s.sub(i)}},o}(Ht),qs=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._correctButton=function(i,s){return s===0&&i.ctrlKey||s===2},o.prototype._move=function(i,s){var p=.8*(s.x-i.x);if(p)return this._active=!0,{bearingDelta:p}},o.prototype.contextmenu=function(i){i.preventDefault()},o}(Ht),Au=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._correctButton=function(i,s){return s===0&&i.ctrlKey||s===2},o.prototype._move=function(i,s){var p=-.5*(s.y-i.y);if(p)return this._active=!0,{pitchDelta:p}},o.prototype.contextmenu=function(i){i.preventDefault()},o}(Ht),oo=function(n){this._minTouches=1,this._clickTolerance=n.clickTolerance||1,this.reset()};oo.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new l.Point(0,0)},oo.prototype.touchstart=function(n,o,i){return this._calculateTransform(n,o,i)},oo.prototype.touchmove=function(n,o,i){if(this._active&&!(i.length<this._minTouches))return n.preventDefault(),this._calculateTransform(n,o,i)},oo.prototype.touchend=function(n,o,i){this._calculateTransform(n,o,i),this._active&&i.length<this._minTouches&&this.reset()},oo.prototype.touchcancel=function(){this.reset()},oo.prototype._calculateTransform=function(n,o,i){i.length>0&&(this._active=!0);var s=En(i,o),p=new l.Point(0,0),d=new l.Point(0,0),m=0;for(var _ in s){var S=s[_],P=this._touches[_];P&&(p._add(S),d._add(S.sub(P)),m++,s[_]=S)}if(this._touches=s,!(m<this._minTouches)&&d.mag()){var B=d.div(m);if(this._sum._add(B),!(this._sum.mag()<this._clickTolerance))return{around:p.div(m),panDelta:B}}},oo.prototype.enable=function(){this._enabled=!0},oo.prototype.disable=function(){this._enabled=!1,this.reset()},oo.prototype.isEnabled=function(){return this._enabled},oo.prototype.isActive=function(){return this._active};var Ui=function(){this.reset()};function Zs(n,o,i){for(var s=0;s<n.length;s++)if(n[s].identifier===i)return o[s]}function Gs(n,o){return Math.log(n/o)/Math.LN2}Ui.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Ui.prototype._start=function(n){},Ui.prototype._move=function(n,o,i){return{}},Ui.prototype.touchstart=function(n,o,i){this._firstTwoTouches||i.length<2||(this._firstTwoTouches=[i[0].identifier,i[1].identifier],this._start([o[0],o[1]]))},Ui.prototype.touchmove=function(n,o,i){if(this._firstTwoTouches){n.preventDefault();var s=this._firstTwoTouches,p=s[1],d=Zs(i,o,s[0]),m=Zs(i,o,p);if(d&&m){var _=this._aroundCenter?null:d.add(m).div(2);return this._move([d,m],_,n)}}},Ui.prototype.touchend=function(n,o,i){if(this._firstTwoTouches){var s=this._firstTwoTouches,p=s[1],d=Zs(i,o,s[0]),m=Zs(i,o,p);d&&m||(this._active&&Ot.suppressClick(),this.reset())}},Ui.prototype.touchcancel=function(){this.reset()},Ui.prototype.enable=function(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"},Ui.prototype.disable=function(){this._enabled=!1,this.reset()},Ui.prototype.isEnabled=function(){return this._enabled},Ui.prototype.isActive=function(){return this._active};var Vi=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.reset=function(){n.prototype.reset.call(this),delete this._distance,delete this._startDistance},o.prototype._start=function(i){this._startDistance=this._distance=i[0].dist(i[1])},o.prototype._move=function(i,s){var p=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(Gs(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Gs(this._distance,p),pinchAround:s}},o}(Ui);function Jo(n,o){return 180*n.angleWith(o)/Math.PI}var ul=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.reset=function(){n.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},o.prototype._start=function(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])},o.prototype._move=function(i,s){var p=this._vector;if(this._vector=i[0].sub(i[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Jo(this._vector,p),pinchAround:s}},o.prototype._isBelowThreshold=function(i){this._minDiameter=Math.min(this._minDiameter,i.mag());var s=25/(Math.PI*this._minDiameter)*360,p=Jo(i,this._startVector);return Math.abs(p)<s},o}(Ui);function _s(n){return Math.abs(n.y)>Math.abs(n.x)}var Pu=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.reset=function(){n.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},o.prototype._start=function(i){this._lastPoints=i,_s(i[0].sub(i[1]))&&(this._valid=!1)},o.prototype._move=function(i,s,p){var d=i[0].sub(this._lastPoints[0]),m=i[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(d,m,p.timeStamp),this._valid)return this._lastPoints=i,this._active=!0,{pitchDelta:(d.y+m.y)/2*-.5}},o.prototype.gestureBeginsVertically=function(i,s,p){if(this._valid!==void 0)return this._valid;var d=i.mag()>=2,m=s.mag()>=2;if(d||m){if(!d||!m)return this._firstMove===void 0&&(this._firstMove=p),p-this._firstMove<100&&void 0;var _=i.y>0==s.y>0;return _s(i)&&_s(s)&&_}},o}(Ui),ku={panStep:100,bearingStep:15,pitchStep:10},Ao=function(){var n=ku;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1};function Hi(n){return n*(2-n)}Ao.prototype.blur=function(){this.reset()},Ao.prototype.reset=function(){this._active=!1},Ao.prototype.keydown=function(n){var o=this;if(!(n.altKey||n.ctrlKey||n.metaKey)){var i=0,s=0,p=0,d=0,m=0;switch(n.keyCode){case 61:case 107:case 171:case 187:i=1;break;case 189:case 109:case 173:i=-1;break;case 37:n.shiftKey?s=-1:(n.preventDefault(),d=-1);break;case 39:n.shiftKey?s=1:(n.preventDefault(),d=1);break;case 38:n.shiftKey?p=1:(n.preventDefault(),m=-1);break;case 40:n.shiftKey?p=-1:(n.preventDefault(),m=1);break;default:return}return this._rotationDisabled&&(s=0,p=0),{cameraAnimation:function(_){var S=_.getZoom();_.easeTo({duration:300,easeId:"keyboardHandler",easing:Hi,zoom:i?Math.round(S)+i*(n.shiftKey?2:1):S,bearing:_.getBearing()+s*o._bearingStep,pitch:_.getPitch()+p*o._pitchStep,offset:[-d*o._panStep,-m*o._panStep],center:_.getCenter()},{originalEvent:n})}}}},Ao.prototype.enable=function(){this._enabled=!0},Ao.prototype.disable=function(){this._enabled=!1,this.reset()},Ao.prototype.isEnabled=function(){return this._enabled},Ao.prototype.isActive=function(){return this._active},Ao.prototype.disableRotation=function(){this._rotationDisabled=!0},Ao.prototype.enableRotation=function(){this._rotationDisabled=!1};var or=function(n,o){this._map=n,this._el=n.getCanvasContainer(),this._handler=o,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,l.bindAll(["_onTimeout"],this)};or.prototype.setZoomRate=function(n){this._defaultZoomRate=n},or.prototype.setWheelZoomRate=function(n){this._wheelZoomRate=n},or.prototype.isEnabled=function(){return!!this._enabled},or.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},or.prototype.isZooming=function(){return!!this._zooming},or.prototype.enable=function(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=n&&n.around==="center")},or.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},or.prototype.wheel=function(n){if(this.isEnabled()){var o=n.deltaMode===l.window.WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY,i=l.browser.now(),s=i-(this._lastWheelEventTime||0);this._lastWheelEventTime=i,o!==0&&o%4.000244140625==0?this._type="wheel":o!==0&&Math.abs(o)<4?this._type="trackpad":s>400?(this._type=null,this._lastValue=o,this._timeout=setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(s*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),n.shiftKey&&o&&(o/=4),this._type&&(this._lastWheelEvent=n,this._delta-=o,this._active||this._start(n)),n.preventDefault()}},or.prototype._onTimeout=function(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)},or.prototype._start=function(n){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var o=Ot.mousePos(this._el,n);this._around=l.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(o)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},or.prototype.renderFrame=function(){var n=this;if(this._frameId&&(this._frameId=null,this.isActive())){var o=this._map.transform;if(this._delta!==0){var i=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,s=2/(1+Math.exp(-Math.abs(this._delta*i)));this._delta<0&&s!==0&&(s=1/s);var p=typeof this._targetZoom=="number"?o.zoomScale(this._targetZoom):o.scale;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(p*s))),this._type==="wheel"&&(this._startZoom=o.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var d,m=typeof this._targetZoom=="number"?this._targetZoom:o.zoom,_=this._startZoom,S=this._easing,P=!1;if(this._type==="wheel"&&_&&S){var B=Math.min((l.browser.now()-this._lastWheelEventTime)/200,1),F=S(B);d=l.number(_,m,F),B<1?this._frameId||(this._frameId=!0):P=!0}else d=m,P=!0;return this._active=!0,P&&(this._active=!1,this._finishTimeout=setTimeout(function(){n._zooming=!1,n._handler._triggerRenderFrame(),delete n._targetZoom,delete n._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!P,zoomDelta:d-o.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},or.prototype._smoothOutEasing=function(n){var o=l.ease;if(this._prevEase){var i=this._prevEase,s=(l.browser.now()-i.start)/i.duration,p=i.easing(s+.01)-i.easing(s),d=.27/Math.sqrt(p*p+1e-4)*.01,m=Math.sqrt(.0729-d*d);o=l.bezier(d,m,.25,1)}return this._prevEase={start:l.browser.now(),duration:n,easing:o},o},or.prototype.blur=function(){this.reset()},or.prototype.reset=function(){this._active=!1};var Vo=function(n,o){this._clickZoom=n,this._tapZoom=o};Vo.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},Vo.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},Vo.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},Vo.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var ao=function(){this.reset()};ao.prototype.reset=function(){this._active=!1},ao.prototype.blur=function(){this.reset()},ao.prototype.dblclick=function(n,o){return n.preventDefault(),{cameraAnimation:function(i){i.easeTo({duration:300,zoom:i.getZoom()+(n.shiftKey?-1:1),around:i.unproject(o)},{originalEvent:n})}}},ao.prototype.enable=function(){this._enabled=!0},ao.prototype.disable=function(){this._enabled=!1,this.reset()},ao.prototype.isEnabled=function(){return this._enabled},ao.prototype.isActive=function(){return this._active};var Kn=function(){this._tap=new si({numTouches:1,numTaps:1}),this.reset()};Kn.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},Kn.prototype.touchstart=function(n,o,i){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?i.length>0&&(this._swipePoint=o[0],this._swipeTouch=i[0].identifier):this._tap.touchstart(n,o,i))},Kn.prototype.touchmove=function(n,o,i){if(this._tapTime){if(this._swipePoint){if(i[0].identifier!==this._swipeTouch)return;var s=o[0],p=s.y-this._swipePoint.y;return this._swipePoint=s,n.preventDefault(),this._active=!0,{zoomDelta:p/128}}}else this._tap.touchmove(n,o,i)},Kn.prototype.touchend=function(n,o,i){this._tapTime?this._swipePoint&&i.length===0&&this.reset():this._tap.touchend(n,o,i)&&(this._tapTime=n.timeStamp)},Kn.prototype.touchcancel=function(){this.reset()},Kn.prototype.enable=function(){this._enabled=!0},Kn.prototype.disable=function(){this._enabled=!1,this.reset()},Kn.prototype.isEnabled=function(){return this._enabled},Kn.prototype.isActive=function(){return this._active};var za=function(n,o,i){this._el=n,this._mousePan=o,this._touchPan=i};za.prototype.enable=function(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},za.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},za.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},za.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var ca=function(n,o,i){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=o,this._mousePitch=i};ca.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},ca.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},ca.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},ca.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var Po=function(n,o,i,s){this._el=n,this._touchZoom=o,this._touchRotate=i,this._tapDragZoom=s,this._rotationDisabled=!1,this._enabled=!0};Po.prototype.enable=function(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},Po.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},Po.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},Po.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},Po.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},Po.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var ui=function(n){return n.zoom||n.drag||n.pitch||n.rotate},xs=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o}(l.Event);function be(n){return n.panDelta&&n.panDelta.mag()||n.zoomDelta||n.bearingDelta||n.pitchDelta}var ye=function(n,o){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new re(n),this._bearingSnap=o.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(o),l.bindAll(["handleEvent","handleWindowEvent"],this);var i=this._el;this._listeners=[[i,"touchstart",{passive:!0}],[i,"touchmove",{passive:!1}],[i,"touchend",void 0],[i,"touchcancel",void 0],[i,"mousedown",void 0],[i,"mousemove",void 0],[i,"mouseup",void 0],[l.window.document,"mousemove",{capture:!0}],[l.window.document,"mouseup",void 0],[i,"mouseover",void 0],[i,"mouseout",void 0],[i,"dblclick",void 0],[i,"click",void 0],[i,"keydown",{capture:!1}],[i,"keyup",void 0],[i,"wheel",{passive:!1}],[i,"contextmenu",void 0],[l.window,"blur",void 0]];for(var s=0,p=this._listeners;s<p.length;s+=1){var d=p[s],m=d[0];Ot.addEventListener(m,d[1],m===l.window.document?this.handleWindowEvent:this.handleEvent,d[2])}};ye.prototype.destroy=function(){for(var n=0,o=this._listeners;n<o.length;n+=1){var i=o[n],s=i[0];Ot.removeEventListener(s,i[1],s===l.window.document?this.handleWindowEvent:this.handleEvent,i[2])}},ye.prototype._addDefaultHandlers=function(n){var o=this._map,i=o.getCanvasContainer();this._add("mapEvent",new Ae(o,n));var s=o.boxZoom=new De(o,n);this._add("boxZoom",s);var p=new zr,d=new ao;o.doubleClickZoom=new Vo(d,p),this._add("tapZoom",p),this._add("clickZoom",d);var m=new Kn;this._add("tapDragZoom",m);var _=o.touchPitch=new Pu;this._add("touchPitch",_);var S=new qs(n),P=new Au(n);o.dragRotate=new ca(n,S,P),this._add("mouseRotate",S,["mousePitch"]),this._add("mousePitch",P,["mouseRotate"]);var B=new Cu(n),F=new oo(n);o.dragPan=new za(i,B,F),this._add("mousePan",B),this._add("touchPan",F,["touchZoom","touchRotate"]);var N=new ul,H=new Vi;o.touchZoomRotate=new Po(i,H,N,m),this._add("touchRotate",N,["touchPan","touchZoom"]),this._add("touchZoom",H,["touchPan","touchRotate"]);var W=o.scrollZoom=new or(o,this);this._add("scrollZoom",W,["mousePan"]);var tt=o.keyboard=new Ao;this._add("keyboard",tt),this._add("blockableMapEvent",new Qt(o));for(var q=0,Q=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];q<Q.length;q+=1){var at=Q[q];n.interactive&&n[at]&&o[at].enable(n[at])}},ye.prototype._add=function(n,o,i){this._handlers.push({handlerName:n,handler:o,allowed:i}),this._handlersById[n]=o},ye.prototype.stop=function(n){if(!this._updatingCamera){for(var o=0,i=this._handlers;o<i.length;o+=1)i[o].handler.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[]}},ye.prototype.isActive=function(){for(var n=0,o=this._handlers;n<o.length;n+=1)if(o[n].handler.isActive())return!0;return!1},ye.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},ye.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},ye.prototype.isMoving=function(){return!!ui(this._eventsInProgress)||this.isZooming()},ye.prototype._blockedByActive=function(n,o,i){for(var s in n)if(s!==i&&(!o||o.indexOf(s)<0))return!0;return!1},ye.prototype.handleWindowEvent=function(n){this.handleEvent(n,n.type+"Window")},ye.prototype._getMapTouches=function(n){for(var o=[],i=0,s=n;i<s.length;i+=1){var p=s[i];this._el.contains(p.target)&&o.push(p)}return o},ye.prototype.handleEvent=function(n,o){this._updatingCamera=!0;for(var i=n.type==="renderFrame"?void 0:n,s={needsRenderFrame:!1},p={},d={},m=n.touches?this._getMapTouches(n.touches):void 0,_=m?Ot.touchPos(this._el,m):Ot.mousePos(this._el,n),S=0,P=this._handlers;S<P.length;S+=1){var B=P[S],F=B.handlerName,N=B.handler,H=B.allowed;if(N.isEnabled()){var W=void 0;this._blockedByActive(d,H,F)?N.reset():N[o||n.type]&&(W=N[o||n.type](n,_,m),this.mergeHandlerResult(s,p,W,F,i),W&&W.needsRenderFrame&&this._triggerRenderFrame()),(W||N.isActive())&&(d[F]=N)}}var tt={};for(var q in this._previousActiveHandlers)d[q]||(tt[q]=i);this._previousActiveHandlers=d,(Object.keys(tt).length||be(s))&&(this._changes.push([s,p,tt]),this._triggerRenderFrame()),(Object.keys(d).length||be(s))&&this._map._stop(!0),this._updatingCamera=!1;var Q=s.cameraAnimation;Q&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Q(this._map))},ye.prototype.mergeHandlerResult=function(n,o,i,s,p){if(i){l.extend(n,i);var d={handlerName:s,originalEvent:i.originalEvent||p};i.zoomDelta!==void 0&&(o.zoom=d),i.panDelta!==void 0&&(o.drag=d),i.pitchDelta!==void 0&&(o.pitch=d),i.bearingDelta!==void 0&&(o.rotate=d)}},ye.prototype._applyChanges=function(){for(var n={},o={},i={},s=0,p=this._changes;s<p.length;s+=1){var d=p[s],m=d[0],_=d[1],S=d[2];m.panDelta&&(n.panDelta=(n.panDelta||new l.Point(0,0))._add(m.panDelta)),m.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+m.pitchDelta),m.around!==void 0&&(n.around=m.around),m.pinchAround!==void 0&&(n.pinchAround=m.pinchAround),m.noInertia&&(n.noInertia=m.noInertia),l.extend(o,_),l.extend(i,S)}this._updateMapTransform(n,o,i),this._changes=[]},ye.prototype._updateMapTransform=function(n,o,i){var s=this._map,p=s.transform;if(!be(n))return this._fireEvents(o,i,!0);var d=n.panDelta,m=n.zoomDelta,_=n.bearingDelta,S=n.pitchDelta,P=n.around,B=n.pinchAround;B!==void 0&&(P=B),s._stop(!0),P=P||s.transform.centerPoint;var F=p.pointLocation(d?P.sub(d):P);_&&(p.bearing+=_),S&&(p.pitch+=S),m&&(p.zoom+=m),p.setLocationAtPoint(F,P),this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(o,i,!0)},ye.prototype._fireEvents=function(n,o,i){var s=this,p=ui(this._eventsInProgress),d=ui(n),m={};for(var _ in n)this._eventsInProgress[_]||(m[_+"start"]=n[_].originalEvent),this._eventsInProgress[_]=n[_];for(var S in!p&&d&&this._fireEvent("movestart",d.originalEvent),m)this._fireEvent(S,m[S]);for(var P in d&&this._fireEvent("move",d.originalEvent),n)this._fireEvent(P,n[P].originalEvent);var B,F={};for(var N in this._eventsInProgress){var H=this._eventsInProgress[N],W=H.handlerName,tt=H.originalEvent;this._handlersById[W].isActive()||(delete this._eventsInProgress[N],F[N+"end"]=B=o[W]||tt)}for(var q in F)this._fireEvent(q,F[q]);var Q=ui(this._eventsInProgress);if(i&&(p||d)&&!Q){this._updatingCamera=!0;var at=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),mt=function(Ct){return Ct!==0&&-s._bearingSnap<Ct&&Ct<s._bearingSnap};at?(mt(at.bearing||this._map.getBearing())&&(at.bearing=0),this._map.easeTo(at,{originalEvent:B})):(this._map.fire(new l.Event("moveend",{originalEvent:B})),mt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},ye.prototype._fireEvent=function(n,o){this._map.fire(new l.Event(n,o?{originalEvent:o}:{}))},ye.prototype._requestFrame=function(){var n=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(o){delete n._frameId,n.handleEvent(new xs("renderFrame",{timeStamp:o})),n._applyChanges()})},ye.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var Ks=function(n){function o(i,s){n.call(this),this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=s.bearingSnap,l.bindAll(["_renderFrameCallback"],this)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getCenter=function(){return new l.LngLat(this.transform.center.lng,this.transform.center.lat)},o.prototype.setCenter=function(i,s){return this.jumpTo({center:i},s)},o.prototype.panBy=function(i,s,p){return i=l.Point.convert(i).mult(-1),this.panTo(this.transform.center,l.extend({offset:i},s),p)},o.prototype.panTo=function(i,s,p){return this.easeTo(l.extend({center:i},s),p)},o.prototype.getZoom=function(){return this.transform.zoom},o.prototype.setZoom=function(i,s){return this.jumpTo({zoom:i},s),this},o.prototype.zoomTo=function(i,s,p){return this.easeTo(l.extend({zoom:i},s),p)},o.prototype.zoomIn=function(i,s){return this.zoomTo(this.getZoom()+1,i,s),this},o.prototype.zoomOut=function(i,s){return this.zoomTo(this.getZoom()-1,i,s),this},o.prototype.getBearing=function(){return this.transform.bearing},o.prototype.setBearing=function(i,s){return this.jumpTo({bearing:i},s),this},o.prototype.getPadding=function(){return this.transform.padding},o.prototype.setPadding=function(i,s){return this.jumpTo({padding:i},s),this},o.prototype.rotateTo=function(i,s,p){return this.easeTo(l.extend({bearing:i},s),p)},o.prototype.resetNorth=function(i,s){return this.rotateTo(0,l.extend({duration:1e3},i),s),this},o.prototype.resetNorthPitch=function(i,s){return this.easeTo(l.extend({bearing:0,pitch:0,duration:1e3},i),s),this},o.prototype.snapToNorth=function(i,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,s):this},o.prototype.getPitch=function(){return this.transform.pitch},o.prototype.setPitch=function(i,s){return this.jumpTo({pitch:i},s),this},o.prototype.cameraForBounds=function(i,s){i=l.LngLatBounds.convert(i);var p=s&&s.bearing||0;return this._cameraForBoxAndBearing(i.getNorthWest(),i.getSouthEast(),p,s)},o.prototype._cameraForBoxAndBearing=function(i,s,p,d){var m={top:0,bottom:0,right:0,left:0};if(typeof(d=l.extend({padding:m,offset:[0,0],maxZoom:this.transform.maxZoom},d)).padding=="number"){var _=d.padding;d.padding={top:_,bottom:_,right:_,left:_}}d.padding=l.extend(m,d.padding);var S=this.transform,P=S.padding,B=S.project(l.LngLat.convert(i)),F=S.project(l.LngLat.convert(s)),N=B.rotate(-p*Math.PI/180),H=F.rotate(-p*Math.PI/180),W=new l.Point(Math.max(N.x,H.x),Math.max(N.y,H.y)),tt=new l.Point(Math.min(N.x,H.x),Math.min(N.y,H.y)),q=W.sub(tt),Q=(S.width-(P.left+P.right+d.padding.left+d.padding.right))/q.x,at=(S.height-(P.top+P.bottom+d.padding.top+d.padding.bottom))/q.y;if(!(at<0||Q<0)){var mt=Math.min(S.scaleZoom(S.scale*Math.min(Q,at)),d.maxZoom),Ct=typeof d.offset.x=="number"?new l.Point(d.offset.x,d.offset.y):l.Point.convert(d.offset),wt=new l.Point((d.padding.left-d.padding.right)/2,(d.padding.top-d.padding.bottom)/2).rotate(p*Math.PI/180),At=Ct.add(wt).mult(S.scale/S.zoomScale(mt));return{center:S.unproject(B.add(F).div(2).sub(At)),zoom:mt,bearing:p}}l.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},o.prototype.fitBounds=function(i,s,p){return this._fitInternal(this.cameraForBounds(i,s),s,p)},o.prototype.fitScreenCoordinates=function(i,s,p,d,m){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(l.Point.convert(i)),this.transform.pointLocation(l.Point.convert(s)),p,d),d,m)},o.prototype._fitInternal=function(i,s,p){return i?(delete(s=l.extend(i,s)).padding,s.linear?this.easeTo(s,p):this.flyTo(s,p)):this},o.prototype.jumpTo=function(i,s){this.stop();var p=this.transform,d=!1,m=!1,_=!1;return"zoom"in i&&p.zoom!==+i.zoom&&(d=!0,p.zoom=+i.zoom),i.center!==void 0&&(p.center=l.LngLat.convert(i.center)),"bearing"in i&&p.bearing!==+i.bearing&&(m=!0,p.bearing=+i.bearing),"pitch"in i&&p.pitch!==+i.pitch&&(_=!0,p.pitch=+i.pitch),i.padding==null||p.isPaddingEqual(i.padding)||(p.padding=i.padding),this.fire(new l.Event("movestart",s)).fire(new l.Event("move",s)),d&&this.fire(new l.Event("zoomstart",s)).fire(new l.Event("zoom",s)).fire(new l.Event("zoomend",s)),m&&this.fire(new l.Event("rotatestart",s)).fire(new l.Event("rotate",s)).fire(new l.Event("rotateend",s)),_&&this.fire(new l.Event("pitchstart",s)).fire(new l.Event("pitch",s)).fire(new l.Event("pitchend",s)),this.fire(new l.Event("moveend",s))},o.prototype.easeTo=function(i,s){var p=this;this._stop(!1,i.easeId),((i=l.extend({offset:[0,0],duration:500,easing:l.ease},i)).animate===!1||!i.essential&&l.browser.prefersReducedMotion)&&(i.duration=0);var d=this.transform,m=this.getZoom(),_=this.getBearing(),S=this.getPitch(),P=this.getPadding(),B="zoom"in i?+i.zoom:m,F="bearing"in i?this._normalizeBearing(i.bearing,_):_,N="pitch"in i?+i.pitch:S,H="padding"in i?i.padding:d.padding,W=l.Point.convert(i.offset),tt=d.centerPoint.add(W),q=d.pointLocation(tt),Q=l.LngLat.convert(i.center||q);this._normalizeCenter(Q);var at,mt,Ct=d.project(q),wt=d.project(Q).sub(Ct),At=d.zoomScale(B-m);i.around&&(at=l.LngLat.convert(i.around),mt=d.locationPoint(at));var Rt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||B!==m,this._rotating=this._rotating||_!==F,this._pitching=this._pitching||N!==S,this._padding=!d.isPaddingEqual(H),this._easeId=i.easeId,this._prepareEase(s,i.noMoveStart,Rt),this._ease(function(Zt){if(p._zooming&&(d.zoom=l.number(m,B,Zt)),p._rotating&&(d.bearing=l.number(_,F,Zt)),p._pitching&&(d.pitch=l.number(S,N,Zt)),p._padding&&(d.interpolatePadding(P,H,Zt),tt=d.centerPoint.add(W)),at)d.setLocationAtPoint(at,mt);else{var qt=d.zoomScale(d.zoom-m),ce=B>m?Math.min(2,At):Math.max(.5,At),we=Math.pow(ce,1-Zt),Ie=d.unproject(Ct.add(wt.mult(Zt*we)).mult(qt));d.setLocationAtPoint(d.renderWorldCopies?Ie.wrap():Ie,tt)}p._fireMoveEvents(s)},function(Zt){p._afterEase(s,Zt)},i),this},o.prototype._prepareEase=function(i,s,p){p===void 0&&(p={}),this._moving=!0,s||p.moving||this.fire(new l.Event("movestart",i)),this._zooming&&!p.zooming&&this.fire(new l.Event("zoomstart",i)),this._rotating&&!p.rotating&&this.fire(new l.Event("rotatestart",i)),this._pitching&&!p.pitching&&this.fire(new l.Event("pitchstart",i))},o.prototype._fireMoveEvents=function(i){this.fire(new l.Event("move",i)),this._zooming&&this.fire(new l.Event("zoom",i)),this._rotating&&this.fire(new l.Event("rotate",i)),this._pitching&&this.fire(new l.Event("pitch",i))},o.prototype._afterEase=function(i,s){if(!this._easeId||!s||this._easeId!==s){delete this._easeId;var p=this._zooming,d=this._rotating,m=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new l.Event("zoomend",i)),d&&this.fire(new l.Event("rotateend",i)),m&&this.fire(new l.Event("pitchend",i)),this.fire(new l.Event("moveend",i))}},o.prototype.flyTo=function(i,s){var p=this;if(!i.essential&&l.browser.prefersReducedMotion){var d=l.pick(i,["center","zoom","bearing","pitch","around"]);return this.jumpTo(d,s)}this.stop(),i=l.extend({offset:[0,0],speed:1.2,curve:1.42,easing:l.ease},i);var m=this.transform,_=this.getZoom(),S=this.getBearing(),P=this.getPitch(),B=this.getPadding(),F="zoom"in i?l.clamp(+i.zoom,m.minZoom,m.maxZoom):_,N="bearing"in i?this._normalizeBearing(i.bearing,S):S,H="pitch"in i?+i.pitch:P,W="padding"in i?i.padding:m.padding,tt=m.zoomScale(F-_),q=l.Point.convert(i.offset),Q=m.centerPoint.add(q),at=m.pointLocation(Q),mt=l.LngLat.convert(i.center||at);this._normalizeCenter(mt);var Ct=m.project(at),wt=m.project(mt).sub(Ct),At=i.curve,Rt=Math.max(m.width,m.height),Zt=Rt/tt,qt=wt.mag();if("minZoom"in i){var ce=l.clamp(Math.min(i.minZoom,_,F),m.minZoom,m.maxZoom),we=Rt/m.zoomScale(ce-_);At=Math.sqrt(we/qt*2)}var Ie=At*At;function Te(Me){var Pe=(Zt*Zt-Rt*Rt+(Me?-1:1)*Ie*Ie*qt*qt)/(2*(Me?Zt:Rt)*Ie*qt);return Math.log(Math.sqrt(Pe*Pe+1)-Pe)}function fr(Me){return(Math.exp(Me)-Math.exp(-Me))/2}function de(Me){return(Math.exp(Me)+Math.exp(-Me))/2}var Ue=Te(0),Je=function(Me){return de(Ue)/de(Ue+At*Me)},Be=function(Me){return Rt*((de(Ue)*(fr(Pe=Ue+At*Me)/de(Pe))-fr(Ue))/Ie)/qt;var Pe},Le=(Te(1)-Ue)/At;if(Math.abs(qt)<1e-6||!isFinite(Le)){if(Math.abs(Rt-Zt)<1e-6)return this.easeTo(i,s);var Xe=Zt<Rt?-1:1;Le=Math.abs(Math.log(Zt/Rt))/At,Be=function(){return 0},Je=function(Me){return Math.exp(Xe*At*Me)}}return i.duration="duration"in i?+i.duration:1e3*Le/("screenSpeed"in i?+i.screenSpeed/At:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0),this._zooming=!0,this._rotating=S!==N,this._pitching=H!==P,this._padding=!m.isPaddingEqual(W),this._prepareEase(s,!1),this._ease(function(Me){var Pe=Me*Le,Mn=1/Je(Pe);m.zoom=Me===1?F:_+m.scaleZoom(Mn),p._rotating&&(m.bearing=l.number(S,N,Me)),p._pitching&&(m.pitch=l.number(P,H,Me)),p._padding&&(m.interpolatePadding(B,W,Me),Q=m.centerPoint.add(q));var Qr=Me===1?mt:m.unproject(Ct.add(wt.mult(Be(Pe))).mult(Mn));m.setLocationAtPoint(m.renderWorldCopies?Qr.wrap():Qr,Q),p._fireMoveEvents(s)},function(){return p._afterEase(s)},i),this},o.prototype.isEasing=function(){return!!this._easeFrameId},o.prototype.stop=function(){return this._stop()},o.prototype._stop=function(i,s){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var p=this._onEaseEnd;delete this._onEaseEnd,p.call(this,s)}if(!i){var d=this.handlers;d&&d.stop(!1)}return this},o.prototype._ease=function(i,s,p){p.animate===!1||p.duration===0?(i(1),s()):(this._easeStart=l.browser.now(),this._easeOptions=p,this._onEaseFrame=i,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},o.prototype._renderFrameCallback=function(){var i=Math.min((l.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(i)),i<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},o.prototype._normalizeBearing=function(i,s){i=l.wrap(i,-180,180);var p=Math.abs(i-s);return Math.abs(i-360-s)<p&&(i-=360),Math.abs(i+360-s)<p&&(i+=360),i},o.prototype._normalizeCenter=function(i){var s=this.transform;if(s.renderWorldCopies&&!s.lngRange){var p=i.lng-s.center.lng;i.lng+=p>180?-360:p<-180?360:0}},o}(l.Evented),li=function(n){n===void 0&&(n={}),this.options=n,l.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};li.prototype.getDefaultPosition=function(){return"bottom-right"},li.prototype.onAdd=function(n){var o=this.options&&this.options.compact;return this._map=n,this._container=Ot.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Ot.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Ot.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),o&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),o===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},li.prototype.onRemove=function(){Ot.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},li.prototype._setElementTitle=function(n,o){var i=this._map._getUIString("AttributionControl."+o);n.title=i,n.setAttribute("aria-label",i)},li.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},li.prototype._updateEditLink=function(){var n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));var o=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||l.config.ACCESS_TOKEN}];if(n){var i=o.reduce(function(s,p,d){return p.value&&(s+=p.key+"="+p.value+(d<o.length-1?"&":"")),s},"?");n.href=l.config.FEEDBACK_URL+"/"+i+(this._map._hash?this._map._hash.getHashString(!0):""),n.rel="noopener nofollow",this._setElementTitle(n,"MapFeedback")}},li.prototype._updateData=function(n){!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},li.prototype._updateAttributions=function(){if(this._map.style){var n=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=n.concat(this.options.customAttribution.map(function(_){return typeof _!="string"?"":_})):typeof this.options.customAttribution=="string"&&n.push(this.options.customAttribution)),this._map.style.stylesheet){var o=this._map.style.stylesheet;this.styleOwner=o.owner,this.styleId=o.id}var i=this._map.style.sourceCaches;for(var s in i){var p=i[s];if(p.used){var d=p.getSource();d.attribution&&n.indexOf(d.attribution)<0&&n.push(d.attribution)}}n.sort(function(_,S){return _.length-S.length});var m=(n=n.filter(function(_,S){for(var P=S+1;P<n.length;P++)if(n[P].indexOf(_)>=0)return!1;return!0})).join(" | ");m!==this._attribHTML&&(this._attribHTML=m,n.length?(this._innerContainer.innerHTML=m,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},li.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var ko=function(){l.bindAll(["_updateLogo"],this),l.bindAll(["_updateCompact"],this)};ko.prototype.onAdd=function(n){this._map=n,this._container=Ot.create("div","mapboxgl-ctrl");var o=Ot.create("a","mapboxgl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://www.mapbox.com/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},ko.prototype.onRemove=function(){Ot.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},ko.prototype.getDefaultPosition=function(){return"bottom-left"},ko.prototype._updateLogo=function(n){n&&n.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},ko.prototype._logoRequired=function(){if(this._map.style){var n=this._map.style.sourceCaches;for(var o in n)if(n[o].getSource().mapbox_logo)return!0;return!1}},ko.prototype._updateCompact=function(){var n=this._container.children;if(n.length){var o=n[0];this._map.getCanvasContainer().offsetWidth<250?o.classList.add("mapboxgl-compact"):o.classList.remove("mapboxgl-compact")}};var Xn=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Xn.prototype.add=function(n){var o=++this._id;return this._queue.push({callback:n,id:o,cancelled:!1}),o},Xn.prototype.remove=function(n){for(var o=this._currentlyRunning,i=0,s=o?this._queue.concat(o):this._queue;i<s.length;i+=1){var p=s[i];if(p.id===n)return void(p.cancelled=!0)}},Xn.prototype.run=function(n){n===void 0&&(n=0);var o=this._currentlyRunning=this._queue;this._queue=[];for(var i=0,s=o;i<s.length;i+=1){var p=s[i];if(!p.cancelled&&(p.callback(n),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Xn.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var jo={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Mu=l.window.HTMLImageElement,Xs=l.window.HTMLElement,Er=l.window.ImageBitmap,Nn={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},ll=function(n){function o(s){var p=this;if((s=l.extend({},Nn,s)).minZoom!=null&&s.maxZoom!=null&&s.minZoom>s.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(s.minPitch!=null&&s.maxPitch!=null&&s.minPitch>s.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(s.minPitch!=null&&s.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(s.maxPitch!=null&&s.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var d=new ot(s.minZoom,s.maxZoom,s.minPitch,s.maxPitch,s.renderWorldCopies);if(n.call(this,d,s),this._interactive=s.interactive,this._maxTileCacheSize=s.maxTileCacheSize,this._failIfMajorPerformanceCaveat=s.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=s.preserveDrawingBuffer,this._antialias=s.antialias,this._trackResize=s.trackResize,this._bearingSnap=s.bearingSnap,this._refreshExpiredTiles=s.refreshExpiredTiles,this._fadeDuration=s.fadeDuration,this._crossSourceCollisions=s.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=s.collectResourceTiming,this._renderTaskQueue=new Xn,this._controls=[],this._mapId=l.uniqueId(),this._locale=l.extend({},jo,s.locale),this._clickTolerance=s.clickTolerance,this._requestManager=new l.RequestManager(s.transformRequest,s.accessToken),typeof s.container=="string"){if(this._container=l.window.document.getElementById(s.container),!this._container)throw new Error("Container '"+s.container+"' not found.")}else{if(!(s.container instanceof Xs))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=s.container}if(s.maxBounds&&this.setMaxBounds(s.maxBounds),l.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return p._update(!1)}),this.on("moveend",function(){return p._update(!1)}),this.on("zoom",function(){return p._update(!0)}),l.window!==void 0&&(l.window.addEventListener("online",this._onWindowOnline,!1),l.window.addEventListener("resize",this._onWindowResize,!1),l.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new ye(this,s),this._hash=s.hash&&new It(typeof s.hash=="string"&&s.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:s.center,zoom:s.zoom,bearing:s.bearing,pitch:s.pitch}),s.bounds&&(this.resize(),this.fitBounds(s.bounds,l.extend({},s.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=s.localIdeographFontFamily,s.style&&this.setStyle(s.style,{localIdeographFontFamily:s.localIdeographFontFamily}),s.attributionControl&&this.addControl(new li({customAttribution:s.customAttribution})),this.addControl(new ko,s.logoPosition),this.on("style.load",function(){p.transform.unmodified&&p.jumpTo(p.style.stylesheet)}),this.on("data",function(m){p._update(m.dataType==="style"),p.fire(new l.Event(m.dataType+"data",m))}),this.on("dataloading",function(m){p.fire(new l.Event(m.dataType+"dataloading",m))})}n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o;var i={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return o.prototype._getMapId=function(){return this._mapId},o.prototype.addControl=function(s,p){if(p===void 0&&(p=s.getDefaultPosition?s.getDefaultPosition():"top-right"),!s||!s.onAdd)return this.fire(new l.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var d=s.onAdd(this);this._controls.push(s);var m=this._controlPositions[p];return p.indexOf("bottom")!==-1?m.insertBefore(d,m.firstChild):m.appendChild(d),this},o.prototype.removeControl=function(s){if(!s||!s.onRemove)return this.fire(new l.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var p=this._controls.indexOf(s);return p>-1&&this._controls.splice(p,1),s.onRemove(this),this},o.prototype.hasControl=function(s){return this._controls.indexOf(s)>-1},o.prototype.resize=function(s){var p=this._containerDimensions(),d=p[0],m=p[1];if(d===this.transform.width&&m===this.transform.height)return this;this._resizeCanvas(d,m),this.transform.resize(d,m),this.painter.resize(d,m);var _=!this._moving;return _&&this.fire(new l.Event("movestart",s)).fire(new l.Event("move",s)),this.fire(new l.Event("resize",s)),_&&this.fire(new l.Event("moveend",s)),this},o.prototype.getBounds=function(){return this.transform.getBounds()},o.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},o.prototype.setMaxBounds=function(s){return this.transform.setMaxBounds(l.LngLatBounds.convert(s)),this._update()},o.prototype.setMinZoom=function(s){if((s=s??-2)>=-2&&s<=this.transform.maxZoom)return this.transform.minZoom=s,this._update(),this.getZoom()<s&&this.setZoom(s),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},o.prototype.getMinZoom=function(){return this.transform.minZoom},o.prototype.setMaxZoom=function(s){if((s=s??22)>=this.transform.minZoom)return this.transform.maxZoom=s,this._update(),this.getZoom()>s&&this.setZoom(s),this;throw new Error("maxZoom must be greater than the current minZoom")},o.prototype.getMaxZoom=function(){return this.transform.maxZoom},o.prototype.setMinPitch=function(s){if((s=s??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(s>=0&&s<=this.transform.maxPitch)return this.transform.minPitch=s,this._update(),this.getPitch()<s&&this.setPitch(s),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},o.prototype.getMinPitch=function(){return this.transform.minPitch},o.prototype.setMaxPitch=function(s){if((s=s??60)>60)throw new Error("maxPitch must be less than or equal to 60");if(s>=this.transform.minPitch)return this.transform.maxPitch=s,this._update(),this.getPitch()>s&&this.setPitch(s),this;throw new Error("maxPitch must be greater than the current minPitch")},o.prototype.getMaxPitch=function(){return this.transform.maxPitch},o.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},o.prototype.setRenderWorldCopies=function(s){return this.transform.renderWorldCopies=s,this._update()},o.prototype.project=function(s){return this.transform.locationPoint(l.LngLat.convert(s))},o.prototype.unproject=function(s){return this.transform.pointLocation(l.Point.convert(s))},o.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},o.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},o.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},o.prototype._createDelegatedListener=function(s,p,d){var m,_=this;if(s==="mouseenter"||s==="mouseover"){var S=!1;return{layer:p,listener:d,delegates:{mousemove:function(B){var F=_.getLayer(p)?_.queryRenderedFeatures(B.point,{layers:[p]}):[];F.length?S||(S=!0,d.call(_,new ae(s,_,B.originalEvent,{features:F}))):S=!1},mouseout:function(){S=!1}}}}if(s==="mouseleave"||s==="mouseout"){var P=!1;return{layer:p,listener:d,delegates:{mousemove:function(B){(_.getLayer(p)?_.queryRenderedFeatures(B.point,{layers:[p]}):[]).length?P=!0:P&&(P=!1,d.call(_,new ae(s,_,B.originalEvent)))},mouseout:function(B){P&&(P=!1,d.call(_,new ae(s,_,B.originalEvent)))}}}}return{layer:p,listener:d,delegates:(m={},m[s]=function(B){var F=_.getLayer(p)?_.queryRenderedFeatures(B.point,{layers:[p]}):[];F.length&&(B.features=F,d.call(_,B),delete B.features)},m)}},o.prototype.on=function(s,p,d){if(d===void 0)return n.prototype.on.call(this,s,p);var m=this._createDelegatedListener(s,p,d);for(var _ in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[s]=this._delegatedListeners[s]||[],this._delegatedListeners[s].push(m),m.delegates)this.on(_,m.delegates[_]);return this},o.prototype.once=function(s,p,d){if(d===void 0)return n.prototype.once.call(this,s,p);var m=this._createDelegatedListener(s,p,d);for(var _ in m.delegates)this.once(_,m.delegates[_]);return this},o.prototype.off=function(s,p,d){var m=this;return d===void 0?n.prototype.off.call(this,s,p):(this._delegatedListeners&&this._delegatedListeners[s]&&function(_){for(var S=_[s],P=0;P<S.length;P++){var B=S[P];if(B.layer===p&&B.listener===d){for(var F in B.delegates)m.off(F,B.delegates[F]);return S.splice(P,1),m}}}(this._delegatedListeners),this)},o.prototype.queryRenderedFeatures=function(s,p){if(!this.style)return[];var d;if(p!==void 0||s===void 0||s instanceof l.Point||Array.isArray(s)||(p=s,s=void 0),p=p||{},(s=s||[[0,0],[this.transform.width,this.transform.height]])instanceof l.Point||typeof s[0]=="number")d=[l.Point.convert(s)];else{var m=l.Point.convert(s[0]),_=l.Point.convert(s[1]);d=[m,new l.Point(_.x,m.y),_,new l.Point(m.x,_.y),m]}return this.style.queryRenderedFeatures(d,p,this.transform)},o.prototype.querySourceFeatures=function(s,p){return this.style.querySourceFeatures(s,p)},o.prototype.setStyle=function(s,p){return(p=l.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},p)).diff!==!1&&p.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&s?(this._diffStyle(s,p),this):(this._localIdeographFontFamily=p.localIdeographFontFamily,this._updateStyle(s,p))},o.prototype._getUIString=function(s){var p=this._locale[s];if(p==null)throw new Error("Missing UI string '"+s+"'");return p},o.prototype._updateStyle=function(s,p){return this.style&&(this.style.setEventedParent(null),this.style._remove()),s?(this.style=new Qn(this,p||{}),this.style.setEventedParent(this,{style:this.style}),typeof s=="string"?this.style.loadURL(s):this.style.loadJSON(s),this):(delete this.style,this)},o.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new Qn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},o.prototype._diffStyle=function(s,p){var d=this;if(typeof s=="string"){var m=this._requestManager.normalizeStyleURL(s),_=this._requestManager.transformRequest(m,l.ResourceType.Style);l.getJSON(_,function(S,P){S?d.fire(new l.ErrorEvent(S)):P&&d._updateDiff(P,p)})}else typeof s=="object"&&this._updateDiff(s,p)},o.prototype._updateDiff=function(s,p){try{this.style.setState(s)&&this._update(!0)}catch(d){l.warnOnce("Unable to perform style diff: "+(d.message||d.error||d)+".  Rebuilding the style from scratch."),this._updateStyle(s,p)}},o.prototype.getStyle=function(){if(this.style)return this.style.serialize()},o.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():l.warnOnce("There is no style added to the map.")},o.prototype.addSource=function(s,p){return this._lazyInitEmptyStyle(),this.style.addSource(s,p),this._update(!0)},o.prototype.isSourceLoaded=function(s){var p=this.style&&this.style.sourceCaches[s];if(p!==void 0)return p.loaded();this.fire(new l.ErrorEvent(new Error("There is no source with ID '"+s+"'")))},o.prototype.areTilesLoaded=function(){var s=this.style&&this.style.sourceCaches;for(var p in s){var d=s[p]._tiles;for(var m in d){var _=d[m];if(_.state!=="loaded"&&_.state!=="errored")return!1}}return!0},o.prototype.addSourceType=function(s,p,d){return this._lazyInitEmptyStyle(),this.style.addSourceType(s,p,d)},o.prototype.removeSource=function(s){return this.style.removeSource(s),this._update(!0)},o.prototype.getSource=function(s){return this.style.getSource(s)},o.prototype.addImage=function(s,p,d){d===void 0&&(d={});var m=d.pixelRatio;m===void 0&&(m=1);var _=d.sdf;_===void 0&&(_=!1);var S=d.stretchX,P=d.stretchY,B=d.content;if(this._lazyInitEmptyStyle(),p instanceof Mu||Er&&p instanceof Er){var F=l.browser.getImageData(p);this.style.addImage(s,{data:new l.RGBAImage({width:F.width,height:F.height},F.data),pixelRatio:m,stretchX:S,stretchY:P,content:B,sdf:_,version:0})}else{if(p.width===void 0||p.height===void 0)return this.fire(new l.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var N=p;this.style.addImage(s,{data:new l.RGBAImage({width:p.width,height:p.height},new Uint8Array(p.data)),pixelRatio:m,stretchX:S,stretchY:P,content:B,sdf:_,version:0,userImage:N}),N.onAdd&&N.onAdd(this,s)}},o.prototype.updateImage=function(s,p){var d=this.style.getImage(s);if(!d)return this.fire(new l.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var m=p instanceof Mu||Er&&p instanceof Er?l.browser.getImageData(p):p,_=m.width,S=m.height,P=m.data;return _===void 0||S===void 0?this.fire(new l.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):_!==d.data.width||S!==d.data.height?this.fire(new l.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(d.data.replace(P,!(p instanceof Mu||Er&&p instanceof Er)),void this.style.updateImage(s,d))},o.prototype.hasImage=function(s){return s?!!this.style.getImage(s):(this.fire(new l.ErrorEvent(new Error("Missing required image id"))),!1)},o.prototype.removeImage=function(s){this.style.removeImage(s)},o.prototype.loadImage=function(s,p){l.getImage(this._requestManager.transformRequest(s,l.ResourceType.Image),p)},o.prototype.listImages=function(){return this.style.listImages()},o.prototype.addLayer=function(s,p){return this._lazyInitEmptyStyle(),this.style.addLayer(s,p),this._update(!0)},o.prototype.moveLayer=function(s,p){return this.style.moveLayer(s,p),this._update(!0)},o.prototype.removeLayer=function(s){return this.style.removeLayer(s),this._update(!0)},o.prototype.getLayer=function(s){return this.style.getLayer(s)},o.prototype.setLayerZoomRange=function(s,p,d){return this.style.setLayerZoomRange(s,p,d),this._update(!0)},o.prototype.setFilter=function(s,p,d){return d===void 0&&(d={}),this.style.setFilter(s,p,d),this._update(!0)},o.prototype.getFilter=function(s){return this.style.getFilter(s)},o.prototype.setPaintProperty=function(s,p,d,m){return m===void 0&&(m={}),this.style.setPaintProperty(s,p,d,m),this._update(!0)},o.prototype.getPaintProperty=function(s,p){return this.style.getPaintProperty(s,p)},o.prototype.setLayoutProperty=function(s,p,d,m){return m===void 0&&(m={}),this.style.setLayoutProperty(s,p,d,m),this._update(!0)},o.prototype.getLayoutProperty=function(s,p){return this.style.getLayoutProperty(s,p)},o.prototype.setLight=function(s,p){return p===void 0&&(p={}),this._lazyInitEmptyStyle(),this.style.setLight(s,p),this._update(!0)},o.prototype.getLight=function(){return this.style.getLight()},o.prototype.setFeatureState=function(s,p){return this.style.setFeatureState(s,p),this._update()},o.prototype.removeFeatureState=function(s,p){return this.style.removeFeatureState(s,p),this._update()},o.prototype.getFeatureState=function(s){return this.style.getFeatureState(s)},o.prototype.getContainer=function(){return this._container},o.prototype.getCanvasContainer=function(){return this._canvasContainer},o.prototype.getCanvas=function(){return this._canvas},o.prototype._containerDimensions=function(){var s=0,p=0;return this._container&&(s=this._container.clientWidth||400,p=this._container.clientHeight||300),[s,p]},o.prototype._detectMissingCSS=function(){l.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&l.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},o.prototype._setupContainer=function(){var s=this._container;s.classList.add("mapboxgl-map"),(this._missingCSSCanary=Ot.create("div","mapboxgl-canary",s)).style.visibility="hidden",this._detectMissingCSS();var p=this._canvasContainer=Ot.create("div","mapboxgl-canvas-container",s);this._interactive&&p.classList.add("mapboxgl-interactive"),this._canvas=Ot.create("canvas","mapboxgl-canvas",p),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var d=this._containerDimensions();this._resizeCanvas(d[0],d[1]);var m=this._controlContainer=Ot.create("div","mapboxgl-control-container",s),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(S){_[S]=Ot.create("div","mapboxgl-ctrl-"+S,m)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},o.prototype._resizeCanvas=function(s,p){var d=l.browser.devicePixelRatio||1;this._canvas.width=d*s,this._canvas.height=d*p,this._canvas.style.width=s+"px",this._canvas.style.height=p+"px"},o.prototype._setupPainter=function(){var s=l.extend({},sr.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),p=this._canvas.getContext("webgl",s)||this._canvas.getContext("experimental-webgl",s);p?(this.painter=new ft(p,this.transform),l.webpSupported.testSupport(p)):this.fire(new l.ErrorEvent(new Error("Failed to initialize WebGL")))},o.prototype._contextLost=function(s){s.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new l.Event("webglcontextlost",{originalEvent:s}))},o.prototype._contextRestored=function(s){this._setupPainter(),this.resize(),this._update(),this.fire(new l.Event("webglcontextrestored",{originalEvent:s}))},o.prototype._onMapScroll=function(s){if(s.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},o.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},o.prototype._update=function(s){return this.style?(this._styleDirty=this._styleDirty||s,this._sourcesDirty=!0,this.triggerRepaint(),this):this},o.prototype._requestRenderFrame=function(s){return this._update(),this._renderTaskQueue.add(s)},o.prototype._cancelRenderFrame=function(s){this._renderTaskQueue.remove(s)},o.prototype._render=function(s){var p,d=this,m=0,_=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(p=_.createQueryEXT(),_.beginQueryEXT(_.TIME_ELAPSED_EXT,p),m=l.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(s),!this._removed){var S=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var P=this.transform.zoom,B=l.browser.now();this.style.zoomHistory.update(P,B);var F=new l.EvaluationParameters(P,{now:B,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),N=F.crossFadingFactor();N===1&&N===this._crossFadingFactor||(S=!0,this._crossFadingFactor=N),this.style.update(F)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new l.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new l.Event("load"))),this.style&&(this.style.hasTransitions()||S)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var H=l.browser.now()-m;_.endQueryEXT(_.TIME_ELAPSED_EXT,p),setTimeout(function(){var q=_.getQueryObjectEXT(p,_.QUERY_RESULT_EXT)/1e6;_.deleteQueryEXT(p),d.fire(new l.Event("gpu-timing-frame",{cpuTime:H,gpuTime:q}))},50)}if(this.listens("gpu-timing-layer")){var W=this.painter.collectGpuTimers();setTimeout(function(){var q=d.painter.queryGpuTimers(W);d.fire(new l.Event("gpu-timing-layer",{layerTimes:q}))},50)}var tt=this._sourcesDirty||this._styleDirty||this._placementDirty;return tt||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.Event("idle")),!this._loaded||this._fullyLoaded||tt||(this._fullyLoaded=!0),this}},o.prototype.remove=function(){this._hash&&this._hash.remove();for(var s=0,p=this._controls;s<p.length;s+=1)p[s].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),l.window!==void 0&&(l.window.removeEventListener("resize",this._onWindowResize,!1),l.window.removeEventListener("orientationchange",this._onWindowResize,!1),l.window.removeEventListener("online",this._onWindowOnline,!1));var d=this.painter.context.gl.getExtension("WEBGL_lose_context");d&&d.loseContext(),Da(this._canvasContainer),Da(this._controlContainer),Da(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new l.Event("remove"))},o.prototype.triggerRepaint=function(){var s=this;this.style&&!this._frame&&(this._frame=l.browser.frame(function(p){s._frame=null,s._render(p)}))},o.prototype._onWindowOnline=function(){this._update()},o.prototype._onWindowResize=function(s){this._trackResize&&this.resize({originalEvent:s})._update()},i.showTileBoundaries.get=function(){return!!this._showTileBoundaries},i.showTileBoundaries.set=function(s){this._showTileBoundaries!==s&&(this._showTileBoundaries=s,this._update())},i.showPadding.get=function(){return!!this._showPadding},i.showPadding.set=function(s){this._showPadding!==s&&(this._showPadding=s,this._update())},i.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},i.showCollisionBoxes.set=function(s){this._showCollisionBoxes!==s&&(this._showCollisionBoxes=s,s?this.style._generateCollisionBoxes():this._update())},i.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},i.showOverdrawInspector.set=function(s){this._showOverdrawInspector!==s&&(this._showOverdrawInspector=s,this._update())},i.repaint.get=function(){return!!this._repaint},i.repaint.set=function(s){this._repaint!==s&&(this._repaint=s,this.triggerRepaint())},i.vertices.get=function(){return!!this._vertices},i.vertices.set=function(s){this._vertices=s,this._update()},o.prototype._setCacheLimits=function(s,p){l.setCacheLimits(s,p)},i.version.get=function(){return l.version},Object.defineProperties(o.prototype,i),o}(Ks);function Da(n){n.parentNode&&n.parentNode.removeChild(n)}var zu={showCompass:!0,showZoom:!0,visualizePitch:!1},Yo=function(n){var o=this;this.options=l.extend({},zu,n),this._container=Ot.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(i){return i.preventDefault()}),this.options.showZoom&&(l.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(i){return o._map.zoomIn({},{originalEvent:i})}),Ot.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(i){return o._map.zoomOut({},{originalEvent:i})}),Ot.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(l.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(i){o.options.visualizePitch?o._map.resetNorthPitch({},{originalEvent:i}):o._map.resetNorth({},{originalEvent:i})}),this._compassIcon=Ot.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};Yo.prototype._updateZoomButtons=function(){var n=this._map.getZoom(),o=n===this._map.getMaxZoom(),i=n===this._map.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=i,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",i.toString())},Yo.prototype._rotateCompassArrow=function(){var n=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=n},Yo.prototype.onAdd=function(n){return this._map=n,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ji(this._map,this._compass,this.options.visualizePitch)),this._container},Yo.prototype.onRemove=function(){Ot.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},Yo.prototype._createButton=function(n,o){var i=Ot.create("button",n,this._container);return i.type="button",i.addEventListener("click",o),i},Yo.prototype._setButtonTitle=function(n,o){var i=this._map._getUIString("NavigationControl."+o);n.title=i,n.setAttribute("aria-label",i)};var ji=function(n,o,i){i===void 0&&(i=!1),this._clickTolerance=10,this.element=o,this.mouseRotate=new qs({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,i&&(this.mousePitch=new Au({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),l.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),Ot.addEventListener(o,"mousedown",this.mousedown),Ot.addEventListener(o,"touchstart",this.touchstart,{passive:!1}),Ot.addEventListener(o,"touchmove",this.touchmove),Ot.addEventListener(o,"touchend",this.touchend),Ot.addEventListener(o,"touchcancel",this.reset)};function Qa(n,o,i){if(n=new l.LngLat(n.lng,n.lat),o){var s=new l.LngLat(n.lng-360,n.lat),p=new l.LngLat(n.lng+360,n.lat),d=i.locationPoint(n).distSqr(o);i.locationPoint(s).distSqr(o)<d?n=s:i.locationPoint(p).distSqr(o)<d&&(n=p)}for(;Math.abs(n.lng-i.center.lng)>180;){var m=i.locationPoint(n);if(m.x>=0&&m.y>=0&&m.x<=i.width&&m.y<=i.height)break;n.lng>i.center.lng?n.lng-=360:n.lng+=360}return n}ji.prototype.down=function(n,o){this.mouseRotate.mousedown(n,o),this.mousePitch&&this.mousePitch.mousedown(n,o),Ot.disableDrag()},ji.prototype.move=function(n,o){var i=this.map,s=this.mouseRotate.mousemoveWindow(n,o);if(s&&s.bearingDelta&&i.setBearing(i.getBearing()+s.bearingDelta),this.mousePitch){var p=this.mousePitch.mousemoveWindow(n,o);p&&p.pitchDelta&&i.setPitch(i.getPitch()+p.pitchDelta)}},ji.prototype.off=function(){var n=this.element;Ot.removeEventListener(n,"mousedown",this.mousedown),Ot.removeEventListener(n,"touchstart",this.touchstart,{passive:!1}),Ot.removeEventListener(n,"touchmove",this.touchmove),Ot.removeEventListener(n,"touchend",this.touchend),Ot.removeEventListener(n,"touchcancel",this.reset),this.offTemp()},ji.prototype.offTemp=function(){Ot.enableDrag(),Ot.removeEventListener(l.window,"mousemove",this.mousemove),Ot.removeEventListener(l.window,"mouseup",this.mouseup)},ji.prototype.mousedown=function(n){this.down(l.extend({},n,{ctrlKey:!0,preventDefault:function(){return n.preventDefault()}}),Ot.mousePos(this.element,n)),Ot.addEventListener(l.window,"mousemove",this.mousemove),Ot.addEventListener(l.window,"mouseup",this.mouseup)},ji.prototype.mousemove=function(n){this.move(n,Ot.mousePos(this.element,n))},ji.prototype.mouseup=function(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()},ji.prototype.touchstart=function(n){n.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Ot.touchPos(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return n.preventDefault()}},this._startPos))},ji.prototype.touchmove=function(n){n.targetTouches.length!==1?this.reset():(this._lastPos=Ot.touchPos(this.element,n.targetTouches)[0],this.move({preventDefault:function(){return n.preventDefault()}},this._lastPos))},ji.prototype.touchend=function(n){n.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},ji.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var qo={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ws(n,o,i){var s=n.classList;for(var p in qo)s.remove("mapboxgl-"+i+"-anchor-"+p);s.add("mapboxgl-"+i+"-anchor-"+o)}var ts,bs=function(n){function o(i,s){if(n.call(this),(i instanceof l.window.HTMLElement||s)&&(i=l.extend({element:i},s)),l.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&i.pitchAlignment!=="auto"?i.pitchAlignment:this._rotationAlignment,i&&i.element)this._element=i.element,this._offset=l.Point.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=Ot.create("div"),this._element.setAttribute("aria-label","Map marker");var p=Ot.createNS("http://www.w3.org/2000/svg","svg");p.setAttributeNS(null,"display","block"),p.setAttributeNS(null,"height","41px"),p.setAttributeNS(null,"width","27px"),p.setAttributeNS(null,"viewBox","0 0 27 41");var d=Ot.createNS("http://www.w3.org/2000/svg","g");d.setAttributeNS(null,"stroke","none"),d.setAttributeNS(null,"stroke-width","1"),d.setAttributeNS(null,"fill","none"),d.setAttributeNS(null,"fill-rule","evenodd");var m=Ot.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"fill-rule","nonzero");var _=Ot.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"transform","translate(3.0, 29.0)"),_.setAttributeNS(null,"fill","#000000");for(var S=0,P=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];S<P.length;S+=1){var B=P[S],F=Ot.createNS("http://www.w3.org/2000/svg","ellipse");F.setAttributeNS(null,"opacity","0.04"),F.setAttributeNS(null,"cx","10.5"),F.setAttributeNS(null,"cy","5.80029008"),F.setAttributeNS(null,"rx",B.rx),F.setAttributeNS(null,"ry",B.ry),_.appendChild(F)}var N=Ot.createNS("http://www.w3.org/2000/svg","g");N.setAttributeNS(null,"fill",this._color);var H=Ot.createNS("http://www.w3.org/2000/svg","path");H.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),N.appendChild(H);var W=Ot.createNS("http://www.w3.org/2000/svg","g");W.setAttributeNS(null,"opacity","0.25"),W.setAttributeNS(null,"fill","#000000");var tt=Ot.createNS("http://www.w3.org/2000/svg","path");tt.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),W.appendChild(tt);var q=Ot.createNS("http://www.w3.org/2000/svg","g");q.setAttributeNS(null,"transform","translate(6.0, 7.0)"),q.setAttributeNS(null,"fill","#FFFFFF");var Q=Ot.createNS("http://www.w3.org/2000/svg","g");Q.setAttributeNS(null,"transform","translate(8.0, 8.0)");var at=Ot.createNS("http://www.w3.org/2000/svg","circle");at.setAttributeNS(null,"fill","#000000"),at.setAttributeNS(null,"opacity","0.25"),at.setAttributeNS(null,"cx","5.5"),at.setAttributeNS(null,"cy","5.5"),at.setAttributeNS(null,"r","5.4999962");var mt=Ot.createNS("http://www.w3.org/2000/svg","circle");mt.setAttributeNS(null,"fill","#FFFFFF"),mt.setAttributeNS(null,"cx","5.5"),mt.setAttributeNS(null,"cy","5.5"),mt.setAttributeNS(null,"r","5.4999962"),Q.appendChild(at),Q.appendChild(mt),m.appendChild(_),m.appendChild(N),m.appendChild(W),m.appendChild(q),m.appendChild(Q),p.appendChild(m),p.setAttributeNS(null,"height",41*this._scale+"px"),p.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(p),this._offset=l.Point.convert(i&&i.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(Ct){Ct.preventDefault()}),this._element.addEventListener("mousedown",function(Ct){Ct.preventDefault()}),Ws(this._element,this._anchor,"marker"),this._popup=null}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.addTo=function(i){return this.remove(),this._map=i,i.getCanvasContainer().appendChild(this._element),i.on("move",this._update),i.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},o.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),Ot.remove(this._element),this._popup&&this._popup.remove(),this},o.prototype.getLngLat=function(){return this._lngLat},o.prototype.setLngLat=function(i){return this._lngLat=l.LngLat.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},o.prototype.getElement=function(){return this._element},o.prototype.setPopup=function(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){var s=Math.sqrt(Math.pow(13.5,2)/2);i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[s,-1*(24.6+s)],"bottom-right":[-s,-1*(24.6+s)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=i,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},o.prototype._onKeyPress=function(i){var s=i.code,p=i.charCode||i.keyCode;s!=="Space"&&s!=="Enter"&&p!==32&&p!==13||this.togglePopup()},o.prototype._onMapClick=function(i){var s=i.originalEvent.target,p=this._element;this._popup&&(s===p||p.contains(s))&&this.togglePopup()},o.prototype.getPopup=function(){return this._popup},o.prototype.togglePopup=function(){var i=this._popup;return i?(i.isOpen()?i.remove():i.addTo(this._map),this):this},o.prototype._update=function(i){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=Qa(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var s="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?s="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(s="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var p="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?p="rotateX(0deg)":this._pitchAlignment==="map"&&(p="rotateX("+this._map.getPitch()+"deg)"),i&&i.type!=="moveend"||(this._pos=this._pos.round()),Ot.setTransform(this._element,qo[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+p+" "+s)}},o.prototype.getOffset=function(){return this._offset},o.prototype.setOffset=function(i){return this._offset=l.Point.convert(i),this._update(),this},o.prototype._onMove=function(i){if(!this._isDragging){var s=this._clickTolerance||this._map._clickTolerance;this._isDragging=i.point.dist(this._pointerdownPos)>=s}this._isDragging&&(this._pos=i.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.Event("dragstart"))),this.fire(new l.Event("drag")))},o.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.Event("dragend")),this._state="inactive"},o.prototype._addDragHandler=function(i){this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(this._pos).add(this._offset),this._pointerdownPos=i.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},o.prototype.setDraggable=function(i){return this._draggable=!!i,this._map&&(i?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},o.prototype.isDraggable=function(){return this._draggable},o.prototype.setRotation=function(i){return this._rotation=i||0,this._update(),this},o.prototype.getRotation=function(){return this._rotation},o.prototype.setRotationAlignment=function(i){return this._rotationAlignment=i||"auto",this._update(),this},o.prototype.getRotationAlignment=function(){return this._rotationAlignment},o.prototype.setPitchAlignment=function(i){return this._pitchAlignment=i&&i!=="auto"?i:this._rotationAlignment,this._update(),this},o.prototype.getPitchAlignment=function(){return this._pitchAlignment},o}(l.Evented),Du={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},es=0,La=!1,Lu=function(n){function o(i){n.call(this),this.options=l.extend({},Du,i),l.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.onAdd=function(i){var s;return this._map=i,this._container=Ot.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),s=this._setupUI,ts!==void 0?s(ts):l.window.navigator.permissions!==void 0?l.window.navigator.permissions.query({name:"geolocation"}).then(function(p){s(ts=p.state!=="denied")}):s(ts=!!l.window.navigator.geolocation),this._container},o.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(l.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),Ot.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,es=0,La=!1},o.prototype._isOutOfMapMaxBounds=function(i){var s=this._map.getMaxBounds(),p=i.coords;return s&&(p.longitude<s.getWest()||p.longitude>s.getEast()||p.latitude<s.getSouth()||p.latitude>s.getNorth())},o.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},o.prototype._onSuccess=function(i){if(this._map){if(this._isOutOfMapMaxBounds(i))return this._setErrorState(),this.fire(new l.Event("outofmaxbounds",i)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=i,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(i),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(i),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new l.Event("geolocate",i)),this._finish()}},o.prototype._updateCamera=function(i){var s=new l.LngLat(i.coords.longitude,i.coords.latitude),p=i.coords.accuracy,d=this._map.getBearing(),m=l.extend({bearing:d},this.options.fitBoundsOptions);this._map.fitBounds(s.toBounds(p),m,{geolocateSource:!0})},o.prototype._updateMarker=function(i){if(i){var s=new l.LngLat(i.coords.longitude,i.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=i.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},o.prototype._updateCircleRadius=function(){var i=this._map._container.clientHeight/2,s=this._map.unproject([0,i]),p=this._map.unproject([1,i]),d=s.distanceTo(p),m=Math.ceil(2*this._accuracy/d);this._circleElement.style.width=m+"px",this._circleElement.style.height=m+"px"},o.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},o.prototype._onError=function(i){if(this._map){if(this.options.trackUserLocation)if(i.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(i.code===3&&La)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new l.Event("error",i)),this._finish()}},o.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},o.prototype._setupUI=function(i){var s=this;if(this._container.addEventListener("contextmenu",function(m){return m.preventDefault()}),this._geolocateButton=Ot.create("button","mapboxgl-ctrl-geolocate",this._container),Ot.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",i===!1){l.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var p=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=p,this._geolocateButton.setAttribute("aria-label",p)}else{var d=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Ot.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new bs(this._dotElement),this._circleElement=Ot.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new bs({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(m){m.geolocateSource||s._watchState!=="ACTIVE_LOCK"||m.originalEvent&&m.originalEvent.type==="resize"||(s._watchState="BACKGROUND",s._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),s._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),s.fire(new l.Event("trackuserlocationend")))})},o.prototype.trigger=function(){if(!this._setup)return l.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":es--,La=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new l.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var i;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++es>1?(i={maximumAge:6e5,timeout:0},La=!0):(i=this.options.positionOptions,La=!1),this._geolocationWatchID=l.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,i)}}else l.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},o.prototype._clearWatch=function(){l.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},o}(l.Evented),pa={maxWidth:100,unit:"metric"},ha=function(n){this.options=l.extend({},pa,n),l.bindAll(["_onMove","setUnit"],this)};function Hs(n,o,i){var s=i&&i.maxWidth||100,p=n._container.clientHeight/2,d=n.unproject([0,p]),m=n.unproject([s,p]),_=d.distanceTo(m);if(i&&i.unit==="imperial"){var S=3.2808*_;S>5280?fa(o,s,S/5280,n._getUIString("ScaleControl.Miles")):fa(o,s,S,n._getUIString("ScaleControl.Feet"))}else i&&i.unit==="nautical"?fa(o,s,_/1852,n._getUIString("ScaleControl.NauticalMiles")):_>=1e3?fa(o,s,_/1e3,n._getUIString("ScaleControl.Kilometers")):fa(o,s,_,n._getUIString("ScaleControl.Meters"))}function fa(n,o,i,s){var p,d,m,_=(p=i,(d=Math.pow(10,(""+Math.floor(p)).length-1))*(m=(m=p/d)>=10?10:m>=5?5:m>=3?3:m>=2?2:m>=1?1:function(S){var P=Math.pow(10,Math.ceil(-Math.log(S)/Math.LN10));return Math.round(S*P)/P}(m)));n.style.width=o*(_/i)+"px",n.innerHTML=_+"&nbsp;"+s}ha.prototype.getDefaultPosition=function(){return"bottom-left"},ha.prototype._onMove=function(){Hs(this._map,this._container,this.options)},ha.prototype.onAdd=function(n){return this._map=n,this._container=Ot.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",n.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},ha.prototype.onRemove=function(){Ot.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},ha.prototype.setUnit=function(n){this.options.unit=n,Hs(this._map,this._container,this.options)};var so=function(n){this._fullscreen=!1,n&&n.container&&(n.container instanceof l.window.HTMLElement?this._container=n.container:l.warnOnce("Full screen control 'container' must be a DOM element.")),l.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in l.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in l.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in l.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in l.window.document&&(this._fullscreenchange="MSFullscreenChange")};so.prototype.onAdd=function(n){return this._map=n,this._container||(this._container=this._map.getContainer()),this._controlContainer=Ot.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",l.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},so.prototype.onRemove=function(){Ot.remove(this._controlContainer),this._map=null,l.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},so.prototype._checkFullscreenSupport=function(){return!!(l.window.document.fullscreenEnabled||l.window.document.mozFullScreenEnabled||l.window.document.msFullscreenEnabled||l.window.document.webkitFullscreenEnabled)},so.prototype._setupUI=function(){var n=this._fullscreenButton=Ot.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Ot.create("span","mapboxgl-ctrl-icon",n).setAttribute("aria-hidden",!0),n.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),l.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},so.prototype._updateTitle=function(){var n=this._getTitle();this._fullscreenButton.setAttribute("aria-label",n),this._fullscreenButton.title=n},so.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},so.prototype._isFullscreen=function(){return this._fullscreen},so.prototype._changeIcon=function(){(l.window.document.fullscreenElement||l.window.document.mozFullScreenElement||l.window.document.webkitFullscreenElement||l.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},so.prototype._onClickFullscreen=function(){this._isFullscreen()?l.window.document.exitFullscreen?l.window.document.exitFullscreen():l.window.document.mozCancelFullScreen?l.window.document.mozCancelFullScreen():l.window.document.msExitFullscreen?l.window.document.msExitFullscreen():l.window.document.webkitCancelFullScreen&&l.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var Ou={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},ws=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Ru=function(n){function o(i){n.call(this),this.options=l.extend(Object.create(Ou),i),l.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.addTo=function(i){return this._map&&this.remove(),this._map=i,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new l.Event("open")),this},o.prototype.isOpen=function(){return!!this._map},o.prototype.remove=function(){return this._content&&Ot.remove(this._content),this._container&&(Ot.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new l.Event("close")),this},o.prototype.getLngLat=function(){return this._lngLat},o.prototype.setLngLat=function(i){return this._lngLat=l.LngLat.convert(i),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},o.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},o.prototype.getElement=function(){return this._container},o.prototype.setText=function(i){return this.setDOMContent(l.window.document.createTextNode(i))},o.prototype.setHTML=function(i){var s,p=l.window.document.createDocumentFragment(),d=l.window.document.createElement("body");for(d.innerHTML=i;s=d.firstChild;)p.appendChild(s);return this.setDOMContent(p)},o.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},o.prototype.setMaxWidth=function(i){return this.options.maxWidth=i,this._update(),this},o.prototype.setDOMContent=function(i){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Ot.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(i),this._createCloseButton(),this._update(),this._focusFirstElement(),this},o.prototype.addClassName=function(i){this._container&&this._container.classList.add(i)},o.prototype.removeClassName=function(i){this._container&&this._container.classList.remove(i)},o.prototype.setOffset=function(i){return this.options.offset=i,this._update(),this},o.prototype.toggleClassName=function(i){if(this._container)return this._container.classList.toggle(i)},o.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=Ot.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},o.prototype._onMouseUp=function(i){this._update(i.point)},o.prototype._onMouseMove=function(i){this._update(i.point)},o.prototype._onDrag=function(i){this._update(i.point)},o.prototype._update=function(i){var s=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=Ot.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=Ot.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(F){return s._container.classList.add(F)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Qa(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||i)){var p=this._pos=this._trackPointer&&i?i:this._map.project(this._lngLat),d=this.options.anchor,m=function F(N){if(N){if(typeof N=="number"){var H=Math.round(Math.sqrt(.5*Math.pow(N,2)));return{center:new l.Point(0,0),top:new l.Point(0,N),"top-left":new l.Point(H,H),"top-right":new l.Point(-H,H),bottom:new l.Point(0,-N),"bottom-left":new l.Point(H,-H),"bottom-right":new l.Point(-H,-H),left:new l.Point(N,0),right:new l.Point(-N,0)}}if(N instanceof l.Point||Array.isArray(N)){var W=l.Point.convert(N);return{center:W,top:W,"top-left":W,"top-right":W,bottom:W,"bottom-left":W,"bottom-right":W,left:W,right:W}}return{center:l.Point.convert(N.center||[0,0]),top:l.Point.convert(N.top||[0,0]),"top-left":l.Point.convert(N["top-left"]||[0,0]),"top-right":l.Point.convert(N["top-right"]||[0,0]),bottom:l.Point.convert(N.bottom||[0,0]),"bottom-left":l.Point.convert(N["bottom-left"]||[0,0]),"bottom-right":l.Point.convert(N["bottom-right"]||[0,0]),left:l.Point.convert(N.left||[0,0]),right:l.Point.convert(N.right||[0,0])}}return F(new l.Point(0,0))}(this.options.offset);if(!d){var _,S=this._container.offsetWidth,P=this._container.offsetHeight;_=p.y+m.bottom.y<P?["top"]:p.y>this._map.transform.height-P?["bottom"]:[],p.x<S/2?_.push("left"):p.x>this._map.transform.width-S/2&&_.push("right"),d=_.length===0?"bottom":_.join("-")}var B=p.add(m[d]).round();Ot.setTransform(this._container,qo[d]+" translate("+B.x+"px,"+B.y+"px)"),Ws(this._container,d,"popup")}},o.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var i=this._container.querySelector(ws);i&&i.focus()}},o.prototype._onClose=function(){this.remove()},o}(l.Evented),Js={version:l.version,supported:sr,setRTLTextPlugin:l.setRTLTextPlugin,getRTLTextPluginStatus:l.getRTLTextPluginStatus,Map:ll,NavigationControl:Yo,GeolocateControl:Lu,AttributionControl:li,ScaleControl:ha,FullscreenControl:so,Popup:Ru,Marker:bs,Style:Qn,LngLat:l.LngLat,LngLatBounds:l.LngLatBounds,Point:l.Point,MercatorCoordinate:l.MercatorCoordinate,Evented:l.Evented,config:l.config,prewarm:function(){St().acquire(Et)},clearPrewarmedResources:function(){var n=oe;n&&(n.isPreloaded()&&n.numActive()===1?(n.release(Et),oe=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return l.config.ACCESS_TOKEN},set accessToken(n){l.config.ACCESS_TOKEN=n},get baseApiUrl(){return l.config.API_URL},set baseApiUrl(n){l.config.API_URL=n},get workerCount(){return kt.workerCount},set workerCount(n){kt.workerCount=n},get maxParallelImageRequests(){return l.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(n){l.config.MAX_PARALLEL_IMAGE_REQUESTS=n},clearStorage:function(n){l.clearTileCache(n)},workerUrl:""};return Js}),Do})})(Xp);var Pf=Xp.exports;const Lf=Sc(Pf);var Wp={exports:{}};(function(Tu,Tc){var zo;zo=function(){const je=function(v,E){const j={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},bt={on(V,Nt,Gt){if(j[V]===void 0)throw new Error(`Invalid event type: ${V}`);j[V].push({selector:Nt,fn:Gt})},render(V){E.store.featureChanged(V)}},ut=function(V,Nt){const Gt=j[V];let Vt=Gt.length;for(;Vt--;){const Lt=Gt[Vt];if(Lt.selector(Nt)){Lt.fn.call(bt,Nt)||E.store.render(),E.ui.updateMapClasses();break}}};return v.start.call(bt),{render:v.render,stop(){v.stop&&v.stop()},trash(){v.trash&&(v.trash(),E.store.render())},combineFeatures(){v.combineFeatures&&v.combineFeatures()},uncombineFeatures(){v.uncombineFeatures&&v.uncombineFeatures()},drag(V){ut("drag",V)},click(V){ut("click",V)},mousemove(V){ut("mousemove",V)},mousedown(V){ut("mousedown",V)},mouseup(V){ut("mouseup",V)},mouseout(V){ut("mouseout",V)},keydown(V){ut("keydown",V)},keyup(V){ut("keyup",V)},touchstart(V){ut("touchstart",V)},touchmove(V){ut("touchmove",V)},touchend(V){ut("touchend",V)},tap(V){ut("tap",V)}}};function Do(v){return v&&v.__esModule&&Object.prototype.hasOwnProperty.call(v,"default")?v.default:v}var pn,l,sr={},Ot={};function Br(){return pn||(pn=1,Ot.RADIUS=6378137,Ot.FLATTENING=1/298.257223563,Ot.POLAR_RADIUS=63567523142e-4),Ot}var Oe=function(){if(l)return sr;l=1;var v=Br();function E(ut){var V=0;if(ut&&ut.length>0){V+=Math.abs(j(ut[0]));for(var Nt=1;Nt<ut.length;Nt++)V-=Math.abs(j(ut[Nt]))}return V}function j(ut){var V,Nt,Gt,Vt,Lt,se,Ce=0,tr=ut.length;if(tr>2){for(se=0;se<tr;se++)se===tr-2?(Gt=tr-2,Vt=tr-1,Lt=0):se===tr-1?(Gt=tr-1,Vt=0,Lt=1):(Gt=se,Vt=se+1,Lt=se+2),V=ut[Gt],Nt=ut[Vt],Ce+=(bt(ut[Lt][0])-bt(V[0]))*Math.sin(bt(Nt[1]));Ce=Ce*v.RADIUS*v.RADIUS/2}return Ce}function bt(ut){return ut*Math.PI/180}return sr.geometry=function ut(V){var Nt,Gt=0;switch(V.type){case"Polygon":return E(V.coordinates);case"MultiPolygon":for(Nt=0;Nt<V.coordinates.length;Nt++)Gt+=E(V.coordinates[Nt]);return Gt;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(Nt=0;Nt<V.geometries.length;Nt++)Gt+=ut(V.geometries[Nt]);return Gt}},sr.ring=j,sr}(),Ur=Do(Oe);const Xt={CANVAS:"mapboxgl-canvas",CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},On={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},rr={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},Dr={POLYGON:"polygon",LINE:"line_string",POINT:"point"},ve={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},ir={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select"},hr={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},Gi={MOVE:"move",CHANGE_PROPERTIES:"change_properties",CHANGE_COORDINATES:"change_coordinates"},Lr={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},Cr={ACTIVE:"true",INACTIVE:"false"},Rn=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],Wr=-85,Ai=85;var gn=Object.freeze({__proto__:null,LAT_MAX:90,LAT_MIN:-90,LAT_RENDERED_MAX:Ai,LAT_RENDERED_MIN:Wr,LNG_MAX:270,LNG_MIN:-270,activeStates:Cr,classes:Xt,cursors:rr,events:hr,geojsonTypes:ve,interactions:Rn,meta:Lr,modes:ir,sources:On,types:Dr,updateActions:Gi});const di={Point:0,LineString:1,MultiLineString:1,Polygon:2};function ni(v,E){const j=di[v.geometry.type]-di[E.geometry.type];return j===0&&v.geometry.type===ve.POLYGON?v.area-E.area:j}function mi(v){return v.map(E=>(E.geometry.type===ve.POLYGON&&(E.area=Ur.geometry({type:ve.FEATURE,property:{},geometry:E.geometry})),E)).sort(ni).map(E=>(delete E.area,E))}function wr(v,E=0){return[[v.point.x-E,v.point.y-E],[v.point.x+E,v.point.y+E]]}function Or(v){if(this._items={},this._nums={},this._length=v?v.length:0,v)for(let E=0,j=v.length;E<j;E++)this.add(v[E]),v[E]!==void 0&&(typeof v[E]=="string"?this._items[v[E]]=E:this._nums[v[E]]=E)}Or.prototype.add=function(v){return this.has(v)||(this._length++,typeof v=="string"?this._items[v]=this._length:this._nums[v]=this._length),this},Or.prototype.delete=function(v){return this.has(v)===!1||(this._length--,delete this._items[v],delete this._nums[v]),this},Or.prototype.has=function(v){return!(typeof v!="string"&&typeof v!="number"||this._items[v]===void 0&&this._nums[v]===void 0)},Or.prototype.values=function(){const v=[];return Object.keys(this._items).forEach(E=>{v.push({k:E,v:this._items[E]})}),Object.keys(this._nums).forEach(E=>{v.push({k:JSON.parse(E),v:this._nums[E]})}),v.sort((E,j)=>E.v-j.v).map(E=>E.k)},Or.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};const Lo=[Lr.FEATURE,Lr.MIDPOINT,Lr.VERTEX];var hn={click:function(v,E,j){return ho(v,E,j,j.options.clickBuffer)},touch:function(v,E,j){return ho(v,E,j,j.options.touchBuffer)}};function ho(v,E,j,bt){if(j.map===null)return[];const ut=v?wr(v,bt):E,V={};j.options.styles&&(V.layers=j.options.styles.map(Lt=>Lt.id).filter(Lt=>j.map.getLayer(Lt)!=null));const Nt=j.map.queryRenderedFeatures(ut,V).filter(Lt=>Lo.indexOf(Lt.properties.meta)!==-1),Gt=new Or,Vt=[];return Nt.forEach(Lt=>{const se=Lt.properties.id;Gt.has(se)||(Gt.add(se),Vt.push(Lt))}),mi(Vt)}function Bn(v,E){const j=hn.click(v,null,E),bt={mouse:rr.NONE};return j[0]&&(bt.mouse=j[0].properties.active===Cr.ACTIVE?rr.MOVE:rr.POINTER,bt.feature=j[0].properties.meta),E.events.currentModeName().indexOf("draw")!==-1&&(bt.mouse=rr.ADD),E.ui.queueMapClasses(bt),E.ui.updateMapClasses(),j[0]}function yi(v,E){const j=v.x-E.x,bt=v.y-E.y;return Math.sqrt(j*j+bt*bt)}const Cn=4,Wn=12,Pi=500;function Zn(v,E,j={}){const bt=j.fineTolerance!=null?j.fineTolerance:Cn,ut=j.grossTolerance!=null?j.grossTolerance:Wn,V=j.interval!=null?j.interval:Pi;v.point=v.point||E.point,v.time=v.time||E.time;const Nt=yi(v.point,E.point);return Nt<bt||Nt<ut&&E.time-v.time<V}const $i=25,gi=250;function ki(v,E,j={}){const bt=j.tolerance!=null?j.tolerance:$i,ut=j.interval!=null?j.interval:gi;return v.point=v.point||E.point,v.time=v.time||E.time,yi(v.point,E.point)<bt&&E.time-v.time<ut}const fn=((v,E=21)=>(j=E)=>{let bt="",ut=0|j;for(;ut--;)bt+=v[Math.random()*v.length|0];return bt})("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",32);function vi(){return fn()}const Kt=function(v,E){this.ctx=v,this.properties=E.properties||{},this.coordinates=E.geometry.coordinates,this.id=E.id||vi(),this.type=E.geometry.type};Kt.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},Kt.prototype.incomingCoords=function(v){this.setCoordinates(v)},Kt.prototype.setCoordinates=function(v){this.coordinates=v,this.changed()},Kt.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},Kt.prototype.setProperty=function(v,E){this.properties[v]=E},Kt.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:ve.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},Kt.prototype.internal=function(v){const E={id:this.id,meta:Lr.FEATURE,"meta:type":this.type,active:Cr.INACTIVE,mode:v};if(this.ctx.options.userProperties)for(const j in this.properties)E[`user_${j}`]=this.properties[j];return{type:ve.FEATURE,properties:E,geometry:{coordinates:this.getCoordinates(),type:this.type}}};const vn=function(v,E){Kt.call(this,v,E)};(vn.prototype=Object.create(Kt.prototype)).isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"},vn.prototype.updateCoordinate=function(v,E,j){this.coordinates=arguments.length===3?[E,j]:[v,E],this.changed()},vn.prototype.getCoordinate=function(){return this.getCoordinates()};const _n=function(v,E){Kt.call(this,v,E)};(_n.prototype=Object.create(Kt.prototype)).isValid=function(){return this.coordinates.length>1},_n.prototype.addCoordinate=function(v,E,j){this.changed();const bt=parseInt(v,10);this.coordinates.splice(bt,0,[E,j])},_n.prototype.getCoordinate=function(v){const E=parseInt(v,10);return JSON.parse(JSON.stringify(this.coordinates[E]))},_n.prototype.removeCoordinate=function(v){this.changed(),this.coordinates.splice(parseInt(v,10),1)},_n.prototype.updateCoordinate=function(v,E,j){const bt=parseInt(v,10);this.coordinates[bt]=[E,j],this.changed()};const qe=function(v,E){Kt.call(this,v,E),this.coordinates=this.coordinates.map(j=>j.slice(0,-1))};(qe.prototype=Object.create(Kt.prototype)).isValid=function(){return this.coordinates.length!==0&&this.coordinates.every(v=>v.length>2)},qe.prototype.incomingCoords=function(v){this.coordinates=v.map(E=>E.slice(0,-1)),this.changed()},qe.prototype.setCoordinates=function(v){this.coordinates=v,this.changed()},qe.prototype.addCoordinate=function(v,E,j){this.changed();const bt=v.split(".").map(ut=>parseInt(ut,10));this.coordinates[bt[0]].splice(bt[1],0,[E,j])},qe.prototype.removeCoordinate=function(v){this.changed();const E=v.split(".").map(bt=>parseInt(bt,10)),j=this.coordinates[E[0]];j&&(j.splice(E[1],1),j.length<3&&this.coordinates.splice(E[0],1))},qe.prototype.getCoordinate=function(v){const E=v.split(".").map(bt=>parseInt(bt,10)),j=this.coordinates[E[0]];return JSON.parse(JSON.stringify(j[E[1]]))},qe.prototype.getCoordinates=function(){return this.coordinates.map(v=>v.concat([v[0]]))},qe.prototype.updateCoordinate=function(v,E,j){this.changed();const bt=v.split("."),ut=parseInt(bt[0],10),V=parseInt(bt[1],10);this.coordinates[ut]===void 0&&(this.coordinates[ut]=[]),this.coordinates[ut][V]=[E,j]};const We={MultiPoint:vn,MultiLineString:_n,MultiPolygon:qe},_i=(v,E,j,bt,ut)=>{const V=j.split("."),Nt=parseInt(V[0],10),Gt=V[1]?V.slice(1).join("."):null;return v[Nt][E](Gt,bt,ut)},mr=function(v,E){if(Kt.call(this,v,E),delete this.coordinates,this.model=We[E.geometry.type],this.model===void 0)throw new TypeError(`${E.geometry.type} is not a valid type`);this.features=this._coordinatesToFeatures(E.geometry.coordinates)};function Ve(v){this.map=v.map,this.drawConfig=JSON.parse(JSON.stringify(v.options||{})),this._ctx=v}(mr.prototype=Object.create(Kt.prototype))._coordinatesToFeatures=function(v){const E=this.model.bind(this);return v.map(j=>new E(this.ctx,{id:vi(),type:ve.FEATURE,properties:{},geometry:{coordinates:j,type:this.type.replace("Multi","")}}))},mr.prototype.isValid=function(){return this.features.every(v=>v.isValid())},mr.prototype.setCoordinates=function(v){this.features=this._coordinatesToFeatures(v),this.changed()},mr.prototype.getCoordinate=function(v){return _i(this.features,"getCoordinate",v)},mr.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(v=>v.type===ve.POLYGON?v.getCoordinates():v.coordinates)))},mr.prototype.updateCoordinate=function(v,E,j){_i(this.features,"updateCoordinate",v,E,j),this.changed()},mr.prototype.addCoordinate=function(v,E,j){_i(this.features,"addCoordinate",v,E,j),this.changed()},mr.prototype.removeCoordinate=function(v){_i(this.features,"removeCoordinate",v),this.changed()},mr.prototype.getFeatures=function(){return this.features},Ve.prototype.setSelected=function(v){return this._ctx.store.setSelected(v)},Ve.prototype.setSelectedCoordinates=function(v){this._ctx.store.setSelectedCoordinates(v),v.reduce((E,j)=>(E[j.feature_id]===void 0&&(E[j.feature_id]=!0,this._ctx.store.get(j.feature_id).changed()),E),{})},Ve.prototype.getSelected=function(){return this._ctx.store.getSelected()},Ve.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},Ve.prototype.isSelected=function(v){return this._ctx.store.isSelected(v)},Ve.prototype.getFeature=function(v){return this._ctx.store.get(v)},Ve.prototype.select=function(v){return this._ctx.store.select(v)},Ve.prototype.deselect=function(v){return this._ctx.store.deselect(v)},Ve.prototype.deleteFeature=function(v,E={}){return this._ctx.store.delete(v,E)},Ve.prototype.addFeature=function(v,E={}){return this._ctx.store.add(v,E)},Ve.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},Ve.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},Ve.prototype.setActionableState=function(v={}){const E={trash:v.trash||!1,combineFeatures:v.combineFeatures||!1,uncombineFeatures:v.uncombineFeatures||!1};return this._ctx.events.actionable(E)},Ve.prototype.changeMode=function(v,E={},j={}){return this._ctx.events.changeMode(v,E,j)},Ve.prototype.fire=function(v,E){return this._ctx.events.fire(v,E)},Ve.prototype.updateUIClasses=function(v){return this._ctx.ui.queueMapClasses(v)},Ve.prototype.activateUIButton=function(v){return this._ctx.ui.setActiveButton(v)},Ve.prototype.featuresAt=function(v,E,j="click"){if(j!=="click"&&j!=="touch")throw new Error("invalid buffer type");return hn[j](v,E,this._ctx)},Ve.prototype.newFeature=function(v){const E=v.geometry.type;return E===ve.POINT?new vn(this._ctx,v):E===ve.LINE_STRING?new _n(this._ctx,v):E===ve.POLYGON?new qe(this._ctx,v):new mr(this._ctx,v)},Ve.prototype.isInstanceOf=function(v,E){if(v===ve.POINT)return E instanceof vn;if(v===ve.LINE_STRING)return E instanceof _n;if(v===ve.POLYGON)return E instanceof qe;if(v==="MultiFeature")return E instanceof mr;throw new Error(`Unknown feature class: ${v}`)},Ve.prototype.doRender=function(v){return this._ctx.store.featureChanged(v)},Ve.prototype.onSetup=function(){},Ve.prototype.onDrag=function(){},Ve.prototype.onClick=function(){},Ve.prototype.onMouseMove=function(){},Ve.prototype.onMouseDown=function(){},Ve.prototype.onMouseUp=function(){},Ve.prototype.onMouseOut=function(){},Ve.prototype.onKeyUp=function(){},Ve.prototype.onKeyDown=function(){},Ve.prototype.onTouchStart=function(){},Ve.prototype.onTouchMove=function(){},Ve.prototype.onTouchEnd=function(){},Ve.prototype.onTap=function(){},Ve.prototype.onStop=function(){},Ve.prototype.onTrash=function(){},Ve.prototype.onCombineFeature=function(){},Ve.prototype.onUncombineFeature=function(){},Ve.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};const ra={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},xi=Object.keys(ra);function Xo(v){const E=Object.keys(v);return function(j,bt={}){let ut={};const V=E.reduce((Nt,Gt)=>(Nt[Gt]=v[Gt],Nt),new Ve(j));return{start(){ut=V.onSetup(bt),xi.forEach(Nt=>{const Gt=ra[Nt];let Vt=()=>!1;var Lt;v[Gt]&&(Vt=()=>!0),this.on(Nt,Vt,(Lt=Gt,se=>V[Lt](ut,se)))})},stop(){V.onStop(ut)},trash(){V.onTrash(ut)},combineFeatures(){V.onCombineFeatures(ut)},uncombineFeatures(){V.onUncombineFeatures(ut)},render(Nt,Gt){V.toDisplayFeatures(ut,Nt,Gt)}}}}function dn(v){return[].concat(v).filter(E=>E!==void 0)}function An(){const v=this;if(!v.ctx.map||v.ctx.map.getSource(On.HOT)===void 0)return Gt();const E=v.ctx.events.currentModeName();v.ctx.ui.queueMapClasses({mode:E});let j=[],bt=[];v.isDirty?bt=v.getAllIds():(j=v.getChangedIds().filter(Vt=>v.get(Vt)!==void 0),bt=v.sources.hot.filter(Vt=>Vt.properties.id&&j.indexOf(Vt.properties.id)===-1&&v.get(Vt.properties.id)!==void 0).map(Vt=>Vt.properties.id)),v.sources.hot=[];const ut=v.sources.cold.length;v.sources.cold=v.isDirty?[]:v.sources.cold.filter(Vt=>{const Lt=Vt.properties.id||Vt.properties.parent;return j.indexOf(Lt)===-1});const V=ut!==v.sources.cold.length||bt.length>0;function Nt(Vt,Lt){const se=v.get(Vt).internal(E);v.ctx.events.currentModeRender(se,Ce=>{Ce.properties.mode=E,v.sources[Lt].push(Ce)})}function Gt(){v.isDirty=!1,v.clearChangedIds()}j.forEach(Vt=>Nt(Vt,"hot")),bt.forEach(Vt=>Nt(Vt,"cold")),V&&v.ctx.map.getSource(On.COLD).setData({type:ve.FEATURE_COLLECTION,features:v.sources.cold}),v.ctx.map.getSource(On.HOT).setData({type:ve.FEATURE_COLLECTION,features:v.sources.hot}),Gt()}function _r(v){let E;this._features={},this._featureIds=new Or,this._selectedFeatureIds=new Or,this._selectedCoordinates=[],this._changedFeatureIds=new Or,this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=v,this.sources={hot:[],cold:[]},this.render=()=>{E||(E=requestAnimationFrame(()=>{E=null,An.call(this),this._emitSelectionChange&&(this.ctx.events.fire(hr.SELECTION_CHANGE,{features:this.getSelected().map(j=>j.toGeoJSON()),points:this.getSelectedCoordinates().map(j=>({type:ve.FEATURE,properties:{},geometry:{type:ve.POINT,coordinates:j.coordinates}}))}),this._emitSelectionChange=!1),this.ctx.events.fire(hr.RENDER,{})}))},this.isDirty=!1}function xn(v,E={}){const j=v._selectedCoordinates.filter(bt=>v._selectedFeatureIds.has(bt.feature_id));v._selectedCoordinates.length===j.length||E.silent||(v._emitSelectionChange=!0),v._selectedCoordinates=j}_r.prototype.createRenderBatch=function(){const v=this.render;let E=0;return this.render=function(){E++},()=>{this.render=v,E>0&&this.render()}},_r.prototype.setDirty=function(){return this.isDirty=!0,this},_r.prototype.featureCreated=function(v,E={}){if(this._changedFeatureIds.add(v),(E.silent!=null?E.silent:this.ctx.options.suppressAPIEvents)!==!0){const j=this.get(v);this.ctx.events.fire(hr.CREATE,{features:[j.toGeoJSON()]})}return this},_r.prototype.featureChanged=function(v,E={}){return this._changedFeatureIds.add(v),(E.silent!=null?E.silent:this.ctx.options.suppressAPIEvents)!==!0&&this.ctx.events.fire(hr.UPDATE,{action:E.action?E.action:Gi.CHANGE_COORDINATES,features:[this.get(v).toGeoJSON()]}),this},_r.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},_r.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},_r.prototype.getAllIds=function(){return this._featureIds.values()},_r.prototype.add=function(v,E={}){return this._features[v.id]=v,this._featureIds.add(v.id),this.featureCreated(v.id,{silent:E.silent}),this},_r.prototype.delete=function(v,E={}){const j=[];return dn(v).forEach(bt=>{this._featureIds.has(bt)&&(this._featureIds.delete(bt),this._selectedFeatureIds.delete(bt),E.silent||j.indexOf(this._features[bt])===-1&&j.push(this._features[bt].toGeoJSON()),delete this._features[bt],this.isDirty=!0)}),j.length&&this.ctx.events.fire(hr.DELETE,{features:j}),xn(this,E),this},_r.prototype.get=function(v){return this._features[v]},_r.prototype.getAll=function(){return Object.keys(this._features).map(v=>this._features[v])},_r.prototype.select=function(v,E={}){return dn(v).forEach(j=>{this._selectedFeatureIds.has(j)||(this._selectedFeatureIds.add(j),this._changedFeatureIds.add(j),E.silent||(this._emitSelectionChange=!0))}),this},_r.prototype.deselect=function(v,E={}){return dn(v).forEach(j=>{this._selectedFeatureIds.has(j)&&(this._selectedFeatureIds.delete(j),this._changedFeatureIds.add(j),E.silent||(this._emitSelectionChange=!0))}),xn(this,E),this},_r.prototype.clearSelected=function(v={}){return this.deselect(this._selectedFeatureIds.values(),{silent:v.silent}),this},_r.prototype.setSelected=function(v,E={}){return v=dn(v),this.deselect(this._selectedFeatureIds.values().filter(j=>v.indexOf(j)===-1),{silent:E.silent}),this.select(v.filter(j=>!this._selectedFeatureIds.has(j)),{silent:E.silent}),this},_r.prototype.setSelectedCoordinates=function(v){return this._selectedCoordinates=v,this._emitSelectionChange=!0,this},_r.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},_r.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},_r.prototype.getSelected=function(){return this.getSelectedIds().map(v=>this.get(v))},_r.prototype.getSelectedCoordinates=function(){return this._selectedCoordinates.map(v=>({coordinates:this.get(v.feature_id).getCoordinate(v.coord_path)}))},_r.prototype.isSelected=function(v){return this._selectedFeatureIds.has(v)},_r.prototype.setFeatureProperty=function(v,E,j,bt={}){this.get(v).setProperty(E,j),this.featureChanged(v,{silent:bt.silent,action:Gi.CHANGE_PROPERTIES})},_r.prototype.storeMapConfig=function(){Rn.forEach(v=>{this.ctx.map[v]&&(this._mapInitialConfig[v]=this.ctx.map[v].isEnabled())})},_r.prototype.restoreMapConfig=function(){Object.keys(this._mapInitialConfig).forEach(v=>{this._mapInitialConfig[v]?this.ctx.map[v].enable():this.ctx.map[v].disable()})},_r.prototype.getInitialConfigValue=function(v){return this._mapInitialConfig[v]===void 0||this._mapInitialConfig[v]};const Hn=["mode","feature","mouse"];function bi(v){let E=null,j=null;const bt={onRemove(){return v.map.off("load",bt.connect),clearInterval(j),bt.removeLayers(),v.store.restoreMapConfig(),v.ui.removeButtons(),v.events.removeEventListeners(),v.ui.clearMapClasses(),v.boxZoomInitial&&v.map.boxZoom.enable(),v.map=null,v.container=null,v.store=null,E&&E.parentNode&&E.parentNode.removeChild(E),E=null,this},connect(){v.map.off("load",bt.connect),clearInterval(j),bt.addLayers(),v.store.storeMapConfig(),v.events.addEventListeners()},onAdd(ut){if(v.map=ut,v.events=function(V){const Nt=Object.keys(V.options.modes).reduce((Ft,me)=>(Ft[me]=Xo(V.options.modes[me]),Ft),{});let Gt={},Vt={};const Lt={};let se=null,Ce=null;Lt.drag=function(Ft,me){me({point:Ft.point,time:new Date().getTime()})?(V.ui.queueMapClasses({mouse:rr.DRAG}),Ce.drag(Ft)):Ft.originalEvent.stopPropagation()},Lt.mousedrag=function(Ft){Lt.drag(Ft,me=>!Zn(Gt,me))},Lt.touchdrag=function(Ft){Lt.drag(Ft,me=>!ki(Vt,me))},Lt.mousemove=function(Ft){if((Ft.originalEvent.buttons!==void 0?Ft.originalEvent.buttons:Ft.originalEvent.which)===1)return Lt.mousedrag(Ft);const me=Bn(Ft,V);Ft.featureTarget=me,Ce.mousemove(Ft)},Lt.mousedown=function(Ft){Gt={time:new Date().getTime(),point:Ft.point};const me=Bn(Ft,V);Ft.featureTarget=me,Ce.mousedown(Ft)},Lt.mouseup=function(Ft){const me=Bn(Ft,V);Ft.featureTarget=me,Zn(Gt,{point:Ft.point,time:new Date().getTime()})?Ce.click(Ft):Ce.mouseup(Ft)},Lt.mouseout=function(Ft){Ce.mouseout(Ft)},Lt.touchstart=function(Ft){if(!V.options.touchEnabled)return;Vt={time:new Date().getTime(),point:Ft.point};const me=hn.touch(Ft,null,V)[0];Ft.featureTarget=me,Ce.touchstart(Ft)},Lt.touchmove=function(Ft){if(V.options.touchEnabled)return Ce.touchmove(Ft),Lt.touchdrag(Ft)},Lt.touchend=function(Ft){if(Ft.originalEvent.preventDefault(),!V.options.touchEnabled)return;const me=hn.touch(Ft,null,V)[0];Ft.featureTarget=me,ki(Vt,{time:new Date().getTime(),point:Ft.point})?Ce.tap(Ft):Ce.touchend(Ft)};const tr=Ft=>!(Ft===8||Ft===46||Ft>=48&&Ft<=57);function bn(Ft,me,Ke={}){Ce.stop();const ze=Nt[Ft];if(ze===void 0)throw new Error(`${Ft} is not valid`);se=Ft;const Fr=ze(V,me);Ce=je(Fr,V),Ke.silent||V.map.fire(hr.MODE_CHANGE,{mode:Ft}),V.store.setDirty(),V.store.render()}Lt.keydown=function(Ft){(Ft.srcElement||Ft.target).classList.contains(Xt.CANVAS)&&(Ft.keyCode!==8&&Ft.keyCode!==46||!V.options.controls.trash?tr(Ft.keyCode)?Ce.keydown(Ft):Ft.keyCode===49&&V.options.controls.point?bn(ir.DRAW_POINT):Ft.keyCode===50&&V.options.controls.line_string?bn(ir.DRAW_LINE_STRING):Ft.keyCode===51&&V.options.controls.polygon&&bn(ir.DRAW_POLYGON):(Ft.preventDefault(),Ce.trash()))},Lt.keyup=function(Ft){tr(Ft.keyCode)&&Ce.keyup(Ft)},Lt.zoomend=function(){V.store.changeZoom()},Lt.data=function(Ft){if(Ft.dataType==="style"){const{setup:me,map:Ke,options:ze,store:Fr}=V;ze.styles.some(Ri=>Ke.getLayer(Ri.id))||(me.addLayers(),Fr.setDirty(),Fr.render())}};const Mr={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start(){se=V.options.defaultMode,Ce=je(Nt[se](V),V)},changeMode:bn,actionable:function(Ft){let me=!1;Object.keys(Ft).forEach(Ke=>{if(Mr[Ke]===void 0)throw new Error("Invalid action type");Mr[Ke]!==Ft[Ke]&&(me=!0),Mr[Ke]=Ft[Ke]}),me&&V.map.fire(hr.ACTIONABLE,{actions:Mr})},currentModeName:()=>se,currentModeRender:(Ft,me)=>Ce.render(Ft,me),fire(Ft,me){V.map&&V.map.fire(Ft,me)},addEventListeners(){V.map.on("mousemove",Lt.mousemove),V.map.on("mousedown",Lt.mousedown),V.map.on("mouseup",Lt.mouseup),V.map.on("data",Lt.data),V.map.on("touchmove",Lt.touchmove),V.map.on("touchstart",Lt.touchstart),V.map.on("touchend",Lt.touchend),V.container.addEventListener("mouseout",Lt.mouseout),V.options.keybindings&&(V.container.addEventListener("keydown",Lt.keydown),V.container.addEventListener("keyup",Lt.keyup))},removeEventListeners(){V.map.off("mousemove",Lt.mousemove),V.map.off("mousedown",Lt.mousedown),V.map.off("mouseup",Lt.mouseup),V.map.off("data",Lt.data),V.map.off("touchmove",Lt.touchmove),V.map.off("touchstart",Lt.touchstart),V.map.off("touchend",Lt.touchend),V.container.removeEventListener("mouseout",Lt.mouseout),V.options.keybindings&&(V.container.removeEventListener("keydown",Lt.keydown),V.container.removeEventListener("keyup",Lt.keyup))},trash(Ft){Ce.trash(Ft)},combineFeatures(){Ce.combineFeatures()},uncombineFeatures(){Ce.uncombineFeatures()},getMode:()=>se}}(v),v.ui=function(V){const Nt={};let Gt=null,Vt={mode:null,feature:null,mouse:null},Lt={mode:null,feature:null,mouse:null};function se(Ft){Lt=Object.assign(Lt,Ft)}function Ce(){if(!V.container)return;const Ft=[],me=[];Hn.forEach(Ke=>{Lt[Ke]!==Vt[Ke]&&(Ft.push(`${Ke}-${Vt[Ke]}`),Lt[Ke]!==null&&me.push(`${Ke}-${Lt[Ke]}`))}),Ft.length>0&&V.container.classList.remove(...Ft),me.length>0&&V.container.classList.add(...me),Vt=Object.assign(Vt,Lt)}function tr(Ft,me={}){const Ke=document.createElement("button");return Ke.className=`${Xt.CONTROL_BUTTON} ${me.className}`,Ke.setAttribute("title",me.title),me.container.appendChild(Ke),Ke.addEventListener("click",ze=>{if(ze.preventDefault(),ze.stopPropagation(),ze.target===Gt)return bn(),void me.onDeactivate();Mr(Ft),me.onActivate()},!0),Ke}function bn(){Gt&&(Gt.classList.remove(Xt.ACTIVE_BUTTON),Gt=null)}function Mr(Ft){bn();const me=Nt[Ft];me&&me&&Ft!=="trash"&&(me.classList.add(Xt.ACTIVE_BUTTON),Gt=me)}return{setActiveButton:Mr,queueMapClasses:se,updateMapClasses:Ce,clearMapClasses:function(){se({mode:null,feature:null,mouse:null}),Ce()},addButtons:function(){const Ft=V.options.controls,me=document.createElement("div");return me.className=`${Xt.CONTROL_GROUP} ${Xt.CONTROL_BASE}`,Ft&&(Ft[Dr.LINE]&&(Nt[Dr.LINE]=tr(Dr.LINE,{container:me,className:Xt.CONTROL_BUTTON_LINE,title:"LineString tool "+(V.options.keybindings?"(l)":""),onActivate:()=>V.events.changeMode(ir.DRAW_LINE_STRING),onDeactivate:()=>V.events.trash()})),Ft[Dr.POLYGON]&&(Nt[Dr.POLYGON]=tr(Dr.POLYGON,{container:me,className:Xt.CONTROL_BUTTON_POLYGON,title:"Polygon tool "+(V.options.keybindings?"(p)":""),onActivate:()=>V.events.changeMode(ir.DRAW_POLYGON),onDeactivate:()=>V.events.trash()})),Ft[Dr.POINT]&&(Nt[Dr.POINT]=tr(Dr.POINT,{container:me,className:Xt.CONTROL_BUTTON_POINT,title:"Marker tool "+(V.options.keybindings?"(m)":""),onActivate:()=>V.events.changeMode(ir.DRAW_POINT),onDeactivate:()=>V.events.trash()})),Ft.trash&&(Nt.trash=tr("trash",{container:me,className:Xt.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:()=>{V.events.trash()}})),Ft.combine_features&&(Nt.combine_features=tr("combineFeatures",{container:me,className:Xt.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:()=>{V.events.combineFeatures()}})),Ft.uncombine_features&&(Nt.uncombine_features=tr("uncombineFeatures",{container:me,className:Xt.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:()=>{V.events.uncombineFeatures()}}))),me},removeButtons:function(){Object.keys(Nt).forEach(Ft=>{const me=Nt[Ft];me.parentNode&&me.parentNode.removeChild(me),delete Nt[Ft]})}}}(v),v.container=ut.getContainer(),v.store=new _r(v),E=v.ui.addButtons(),v.options.boxSelect){v.boxZoomInitial=ut.boxZoom.isEnabled(),ut.boxZoom.disable();const V=ut.dragPan.isEnabled();ut.dragPan.disable(),ut.dragPan.enable(),V||ut.dragPan.disable()}return ut.loaded()?bt.connect():(ut.on("load",bt.connect),j=setInterval(()=>{ut.loaded()&&bt.connect()},16)),v.events.start(),E},addLayers(){v.map.addSource(On.COLD,{data:{type:ve.FEATURE_COLLECTION,features:[]},type:"geojson"}),v.map.addSource(On.HOT,{data:{type:ve.FEATURE_COLLECTION,features:[]},type:"geojson"}),v.options.styles.forEach(ut=>{v.map.addLayer(ut)}),v.store.setDirty(!0),v.store.render()},removeLayers(){v.options.styles.forEach(ut=>{v.map.getLayer(ut.id)&&v.map.removeLayer(ut.id)}),v.map.getSource(On.COLD)&&v.map.removeSource(On.COLD),v.map.getSource(On.HOT)&&v.map.removeSource(On.HOT)}};return v.setup=bt,bt}const rn="#3bb2d0",Gn="#fbb03b",fo="#fff";var Mi=[{id:"gl-draw-polygon-fill",type:"fill",filter:["all",["==","$type","Polygon"]],paint:{"fill-color":["case",["==",["get","active"],"true"],Gn,rn],"fill-opacity":.1}},{id:"gl-draw-lines",type:"line",filter:["any",["==","$type","LineString"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["case",["==",["get","active"],"true"],Gn,rn],"line-dasharray":["case",["==",["get","active"],"true"],[.2,2],[2,0]],"line-width":2}},{id:"gl-draw-point-outer",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],7,5],"circle-color":fo}},{id:"gl-draw-point-inner",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],5,3],"circle-color":["case",["==",["get","active"],"true"],Gn,rn]}},{id:"gl-draw-vertex-outer",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"],["!=","mode","simple_select"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],7,5],"circle-color":fo}},{id:"gl-draw-vertex-inner",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"],["!=","mode","simple_select"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],5,3],"circle-color":Gn}},{id:"gl-draw-midpoint",type:"circle",filter:["all",["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":Gn}}];function zi(v){return function(E){const j=E.featureTarget;return!!j&&!!j.properties&&j.properties.meta===v}}function Di(v){return!!v.originalEvent&&!!v.originalEvent.shiftKey&&v.originalEvent.button===0}function Pn(v){return!!v.featureTarget&&!!v.featureTarget.properties&&v.featureTarget.properties.active===Cr.ACTIVE&&v.featureTarget.properties.meta===Lr.FEATURE}function wi(v){return!!v.featureTarget&&!!v.featureTarget.properties&&v.featureTarget.properties.active===Cr.INACTIVE&&v.featureTarget.properties.meta===Lr.FEATURE}function Li(v){return v.featureTarget===void 0}function kn(v){return!!v.featureTarget&&!!v.featureTarget.properties&&v.featureTarget.properties.meta===Lr.FEATURE}function xe(v){const E=v.featureTarget;return!!E&&!!E.properties&&E.properties.meta===Lr.VERTEX}function ii(v){return!!v.originalEvent&&v.originalEvent.shiftKey===!0}function Jn(v){return v.keyCode===27}function Oi(v){return v.keyCode===13}var pe=Object.freeze({__proto__:null,isActiveFeature:Pn,isEnterKey:Oi,isEscapeKey:Jn,isFeature:kn,isInactiveFeature:wi,isOfMetaType:zi,isShiftDown:ii,isShiftMousedown:Di,isTrue:function(){return!0},isVertex:xe,noTarget:Li});function mn(v,E){this.x=v,this.y=E}function oi(v,E){const j=E.getBoundingClientRect();return new mn(v.clientX-j.left-(E.clientLeft||0),v.clientY-j.top-(E.clientTop||0))}function Yn(v,E,j,bt){return{type:ve.FEATURE,properties:{meta:Lr.VERTEX,parent:v,coord_path:j,active:bt?Cr.ACTIVE:Cr.INACTIVE},geometry:{type:ve.POINT,coordinates:E}}}function mo(v,E,j){const bt=E.geometry.coordinates,ut=j.geometry.coordinates;if(bt[1]>Ai||bt[1]<Wr||ut[1]>Ai||ut[1]<Wr)return null;const V={lng:(bt[0]+ut[0])/2,lat:(bt[1]+ut[1])/2};return{type:ve.FEATURE,properties:{meta:Lr.MIDPOINT,parent:v,lng:V.lng,lat:V.lat,coord_path:j.properties.coord_path},geometry:{type:ve.POINT,coordinates:[V.lng,V.lat]}}}function Tr(v,E={},j=null){const{type:bt,coordinates:ut}=v.geometry,V=v.properties&&v.properties.id;let Nt=[];function Gt(Lt,se){let Ce="",tr=null;Lt.forEach((bn,Mr)=>{const Ft=se!=null?`${se}.${Mr}`:String(Mr),me=Yn(V,bn,Ft,Vt(Ft));if(E.midpoints&&tr){const ze=mo(V,tr,me);ze&&Nt.push(ze)}tr=me;const Ke=JSON.stringify(bn);Ce!==Ke&&Nt.push(me),Mr===0&&(Ce=Ke)})}function Vt(Lt){return!!E.selectedPaths&&E.selectedPaths.indexOf(Lt)!==-1}return bt===ve.POINT?Nt.push(Yn(V,ut,j,Vt(j))):bt===ve.POLYGON?ut.forEach((Lt,se)=>{Gt(Lt,j!==null?`${j}.${se}`:String(se))}):bt===ve.LINE_STRING?Gt(ut,j):bt.indexOf(ve.MULTI_PREFIX)===0&&function(){const Lt=bt.replace(ve.MULTI_PREFIX,"");ut.forEach((se,Ce)=>{const tr={type:ve.FEATURE,properties:v.properties,geometry:{type:Lt,coordinates:se}};Nt=Nt.concat(Tr(tr,E,Ce))})}(),Nt}mn.prototype={clone(){return new mn(this.x,this.y)},add(v){return this.clone()._add(v)},sub(v){return this.clone()._sub(v)},multByPoint(v){return this.clone()._multByPoint(v)},divByPoint(v){return this.clone()._divByPoint(v)},mult(v){return this.clone()._mult(v)},div(v){return this.clone()._div(v)},rotate(v){return this.clone()._rotate(v)},rotateAround(v,E){return this.clone()._rotateAround(v,E)},matMult(v){return this.clone()._matMult(v)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(v){return this.x===v.x&&this.y===v.y},dist(v){return Math.sqrt(this.distSqr(v))},distSqr(v){const E=v.x-this.x,j=v.y-this.y;return E*E+j*j},angle(){return Math.atan2(this.y,this.x)},angleTo(v){return Math.atan2(this.y-v.y,this.x-v.x)},angleWith(v){return this.angleWithSep(v.x,v.y)},angleWithSep(v,E){return Math.atan2(this.x*E-this.y*v,this.x*v+this.y*E)},_matMult(v){const E=v[0]*this.x+v[1]*this.y,j=v[2]*this.x+v[3]*this.y;return this.x=E,this.y=j,this},_add(v){return this.x+=v.x,this.y+=v.y,this},_sub(v){return this.x-=v.x,this.y-=v.y,this},_mult(v){return this.x*=v,this.y*=v,this},_div(v){return this.x/=v,this.y/=v,this},_multByPoint(v){return this.x*=v.x,this.y*=v.y,this},_divByPoint(v){return this.x/=v.x,this.y/=v.y,this},_unit(){return this._div(this.mag()),this},_perp(){const v=this.y;return this.y=this.x,this.x=-v,this},_rotate(v){const E=Math.cos(v),j=Math.sin(v),bt=E*this.x-j*this.y,ut=j*this.x+E*this.y;return this.x=bt,this.y=ut,this},_rotateAround(v,E){const j=Math.cos(v),bt=Math.sin(v),ut=E.x+j*(this.x-E.x)-bt*(this.y-E.y),V=E.y+bt*(this.x-E.x)+j*(this.y-E.y);return this.x=ut,this.y=V,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:mn},mn.convert=function(v){if(v instanceof mn)return v;if(Array.isArray(v))return new mn(+v[0],+v[1]);if(v.x!==void 0&&v.y!==void 0)return new mn(+v.x,+v.y);throw new Error("Expected [x, y] or {x, y} point format")};var C={enable(v){setTimeout(()=>{v.map&&v.map.doubleClickZoom&&v._ctx&&v._ctx.store&&v._ctx.store.getInitialConfigValue&&v._ctx.store.getInitialConfigValue("doubleClickZoom")&&v.map.doubleClickZoom.enable()},0)},disable(v){setTimeout(()=>{v.map&&v.map.doubleClickZoom&&v.map.doubleClickZoom.disable()},0)}};const{LAT_MIN:M,LAT_MAX:D,LAT_RENDERED_MIN:U,LAT_RENDERED_MAX:G,LNG_MIN:nt,LNG_MAX:$}=gn;function L(v,E){let j=M,bt=D,ut=M,V=D,Nt=$,Gt=nt;v.forEach(Lt=>{const se=function(Ft){const me={Point:0,LineString:1,Polygon:2,MultiPoint:1,MultiLineString:2,MultiPolygon:3}[Ft.geometry.type],Ke=[Ft.geometry.coordinates].flat(me),ze=Ke.map(nn=>nn[0]),Fr=Ke.map(nn=>nn[1]),Ri=nn=>Math.min.apply(null,nn),qa=nn=>Math.max.apply(null,nn);return[Ri(ze),Ri(Fr),qa(ze),qa(Fr)]}(Lt),Ce=se[1],tr=se[3],bn=se[0],Mr=se[2];Ce>j&&(j=Ce),tr<bt&&(bt=tr),tr>ut&&(ut=tr),Ce<V&&(V=Ce),bn<Nt&&(Nt=bn),Mr>Gt&&(Gt=Mr)});const Vt=E;return j+Vt.lat>G&&(Vt.lat=G-j),ut+Vt.lat>D&&(Vt.lat=D-ut),bt+Vt.lat<U&&(Vt.lat=U-bt),V+Vt.lat<M&&(Vt.lat=M-V),Nt+Vt.lng<=nt&&(Vt.lng+=360*Math.ceil(Math.abs(Vt.lng)/360)),Gt+Vt.lng>=$&&(Vt.lng-=360*Math.ceil(Math.abs(Vt.lng)/360)),Vt}function J(v,E){const j=L(v.map(bt=>bt.toGeoJSON()),E);v.forEach(bt=>{const ut=bt.getCoordinates(),V=Lt=>{const se={lng:Lt[0]+j.lng,lat:Lt[1]+j.lat};return[se.lng,se.lat]},Nt=Lt=>Lt.map(se=>V(se)),Gt=Lt=>Lt.map(se=>Nt(se));let Vt;bt.type===ve.POINT?Vt=V(ut):bt.type===ve.LINE_STRING||bt.type===ve.MULTI_POINT?Vt=ut.map(V):bt.type===ve.POLYGON||bt.type===ve.MULTI_LINE_STRING?Vt=ut.map(Nt):bt.type===ve.MULTI_POLYGON&&(Vt=ut.map(Gt)),bt.incomingCoords(Vt)})}const st={onSetup:function(v){const E={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initialDragPanState:this.map.dragPan.isEnabled(),initiallySelectedFeatureIds:v.featureIds||[]};return this.setSelected(E.initiallySelectedFeatureIds.filter(j=>this.getFeature(j)!==void 0)),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),E},fireUpdate:function(){this.fire(hr.UPDATE,{action:Gi.MOVE,features:this.getSelected().map(v=>v.toGeoJSON())})},fireActionable:function(){const v=this.getSelected(),E=v.filter(V=>this.isInstanceOf("MultiFeature",V));let j=!1;if(v.length>1){j=!0;const V=v[0].type.replace("Multi","");v.forEach(Nt=>{Nt.type.replace("Multi","")!==V&&(j=!1)})}const bt=E.length>0,ut=v.length>0;this.setActionableState({combineFeatures:j,uncombineFeatures:bt,trash:ut})},getUniqueIds:function(v){return v.length?v.map(E=>E.properties.id).filter(E=>E!==void 0).reduce((E,j)=>(E.add(j),E),new Or).values():[]},stopExtendedInteractions:function(v){v.boxSelectElement&&(v.boxSelectElement.parentNode&&v.boxSelectElement.parentNode.removeChild(v.boxSelectElement),v.boxSelectElement=null),(v.canDragMove||v.canBoxSelect)&&v.initialDragPanState===!0&&this.map.dragPan.enable(),v.boxSelecting=!1,v.canBoxSelect=!1,v.dragMoving=!1,v.canDragMove=!1},onStop:function(){C.enable(this)},onMouseMove:function(v,E){return kn(E)&&v.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(v),!0},onMouseOut:function(v){return!v.dragMoving||this.fireUpdate()}};st.onTap=st.onClick=function(v,E){return Li(E)?this.clickAnywhere(v,E):zi(Lr.VERTEX)(E)?this.clickOnVertex(v,E):kn(E)?this.clickOnFeature(v,E):void 0},st.clickAnywhere=function(v){const E=this.getSelectedIds();E.length&&(this.clearSelectedFeatures(),E.forEach(j=>this.doRender(j))),C.enable(this),this.stopExtendedInteractions(v)},st.clickOnVertex=function(v,E){this.changeMode(ir.DIRECT_SELECT,{featureId:E.featureTarget.properties.parent,coordPath:E.featureTarget.properties.coord_path,startPos:E.lngLat}),this.updateUIClasses({mouse:rr.MOVE})},st.startOnActiveFeature=function(v,E){this.stopExtendedInteractions(v),this.map.dragPan.disable(),this.doRender(E.featureTarget.properties.id),v.canDragMove=!0,v.dragMoveLocation=E.lngLat},st.clickOnFeature=function(v,E){C.disable(this),this.stopExtendedInteractions(v);const j=ii(E),bt=this.getSelectedIds(),ut=E.featureTarget.properties.id,V=this.isSelected(ut);if(!j&&V&&this.getFeature(ut).type!==ve.POINT)return this.changeMode(ir.DIRECT_SELECT,{featureId:ut});V&&j?(this.deselect(ut),this.updateUIClasses({mouse:rr.POINTER}),bt.length===1&&C.enable(this)):!V&&j?(this.select(ut),this.updateUIClasses({mouse:rr.MOVE})):V||j||(bt.forEach(Nt=>this.doRender(Nt)),this.setSelected(ut),this.updateUIClasses({mouse:rr.MOVE})),this.doRender(ut)},st.onMouseDown=function(v,E){return v.initialDragPanState=this.map.dragPan.isEnabled(),Pn(E)?this.startOnActiveFeature(v,E):this.drawConfig.boxSelect&&Di(E)?this.startBoxSelect(v,E):void 0},st.startBoxSelect=function(v,E){this.stopExtendedInteractions(v),this.map.dragPan.disable(),v.boxSelectStartLocation=oi(E.originalEvent,this.map.getContainer()),v.canBoxSelect=!0},st.onTouchStart=function(v,E){if(Pn(E))return this.startOnActiveFeature(v,E)},st.onDrag=function(v,E){return v.canDragMove?this.dragMove(v,E):this.drawConfig.boxSelect&&v.canBoxSelect?this.whileBoxSelect(v,E):void 0},st.whileBoxSelect=function(v,E){v.boxSelecting=!0,this.updateUIClasses({mouse:rr.ADD}),v.boxSelectElement||(v.boxSelectElement=document.createElement("div"),v.boxSelectElement.classList.add(Xt.BOX_SELECT),this.map.getContainer().appendChild(v.boxSelectElement));const j=oi(E.originalEvent,this.map.getContainer()),bt=Math.min(v.boxSelectStartLocation.x,j.x),ut=Math.max(v.boxSelectStartLocation.x,j.x),V=Math.min(v.boxSelectStartLocation.y,j.y),Nt=Math.max(v.boxSelectStartLocation.y,j.y),Gt=`translate(${bt}px, ${V}px)`;v.boxSelectElement.style.transform=Gt,v.boxSelectElement.style.WebkitTransform=Gt,v.boxSelectElement.style.width=ut-bt+"px",v.boxSelectElement.style.height=Nt-V+"px"},st.dragMove=function(v,E){v.dragMoving=!0,E.originalEvent.stopPropagation();const j={lng:E.lngLat.lng-v.dragMoveLocation.lng,lat:E.lngLat.lat-v.dragMoveLocation.lat};J(this.getSelected(),j),v.dragMoveLocation=E.lngLat},st.onTouchEnd=st.onMouseUp=function(v,E){if(v.dragMoving)this.fireUpdate();else if(v.boxSelecting){const j=[v.boxSelectStartLocation,oi(E.originalEvent,this.map.getContainer())],bt=this.featuresAt(null,j,"click"),ut=this.getUniqueIds(bt).filter(V=>!this.isSelected(V));ut.length&&(this.select(ut),ut.forEach(V=>this.doRender(V)),this.updateUIClasses({mouse:rr.MOVE}))}this.stopExtendedInteractions(v)},st.toDisplayFeatures=function(v,E,j){E.properties.active=this.isSelected(E.properties.id)?Cr.ACTIVE:Cr.INACTIVE,j(E),this.fireActionable(),E.properties.active===Cr.ACTIVE&&E.geometry.type!==ve.POINT&&Tr(E).forEach(j)},st.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},st.onCombineFeatures=function(){const v=this.getSelected();if(v.length===0||v.length<2)return;const E=[],j=[],bt=v[0].type.replace("Multi","");for(let ut=0;ut<v.length;ut++){const V=v[ut];if(V.type.replace("Multi","")!==bt)return;V.type.includes("Multi")?V.getCoordinates().forEach(Nt=>{E.push(Nt)}):E.push(V.getCoordinates()),j.push(V.toGeoJSON())}if(j.length>1){const ut=this.newFeature({type:ve.FEATURE,properties:j[0].properties,geometry:{type:`Multi${bt}`,coordinates:E}});this.addFeature(ut),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([ut.id]),this.fire(hr.COMBINE_FEATURES,{createdFeatures:[ut.toGeoJSON()],deletedFeatures:j})}this.fireActionable()},st.onUncombineFeatures=function(){const v=this.getSelected();if(v.length===0)return;const E=[],j=[];for(let bt=0;bt<v.length;bt++){const ut=v[bt];this.isInstanceOf("MultiFeature",ut)&&(ut.getFeatures().forEach(V=>{this.addFeature(V),V.properties=ut.properties,E.push(V.toGeoJSON()),this.select([V.id])}),this.deleteFeature(ut.id,{silent:!0}),j.push(ut.toGeoJSON()))}E.length>1&&this.fire(hr.UNCOMBINE_FEATURES,{createdFeatures:E,deletedFeatures:j}),this.fireActionable()};const zt=zi(Lr.VERTEX),Bt=zi(Lr.MIDPOINT),Et={fireUpdate:function(){this.fire(hr.UPDATE,{action:Gi.CHANGE_COORDINATES,features:this.getSelected().map(v=>v.toGeoJSON())})},fireActionable:function(v){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:v.selectedCoordPaths.length>0})},startDragging:function(v,E){v.initialDragPanState=this.map.dragPan.isEnabled(),this.map.dragPan.disable(),v.canDragMove=!0,v.dragMoveLocation=E.lngLat},stopDragging:function(v){v.canDragMove&&v.initialDragPanState===!0&&this.map.dragPan.enable(),v.dragMoving=!1,v.canDragMove=!1,v.dragMoveLocation=null},onVertex:function(v,E){this.startDragging(v,E);const j=E.featureTarget.properties,bt=v.selectedCoordPaths.indexOf(j.coord_path);ii(E)||bt!==-1?ii(E)&&bt===-1&&v.selectedCoordPaths.push(j.coord_path):v.selectedCoordPaths=[j.coord_path];const ut=this.pathsToCoordinates(v.featureId,v.selectedCoordPaths);this.setSelectedCoordinates(ut)},onMidpoint:function(v,E){this.startDragging(v,E);const j=E.featureTarget.properties;v.feature.addCoordinate(j.coord_path,j.lng,j.lat),this.fireUpdate(),v.selectedCoordPaths=[j.coord_path]},pathsToCoordinates:function(v,E){return E.map(j=>({feature_id:v,coord_path:j}))},onFeature:function(v,E){v.selectedCoordPaths.length===0?this.startDragging(v,E):this.stopDragging(v)},dragFeature:function(v,E,j){J(this.getSelected(),j),v.dragMoveLocation=E.lngLat},dragVertex:function(v,E,j){const bt=v.selectedCoordPaths.map(V=>v.feature.getCoordinate(V)),ut=L(bt.map(V=>({type:ve.FEATURE,properties:{},geometry:{type:ve.POINT,coordinates:V}})),j);for(let V=0;V<bt.length;V++){const Nt=bt[V];v.feature.updateCoordinate(v.selectedCoordPaths[V],Nt[0]+ut.lng,Nt[1]+ut.lat)}},clickNoTarget:function(){this.changeMode(ir.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(ir.SIMPLE_SELECT)},clickActiveFeature:function(v){v.selectedCoordPaths=[],this.clearSelectedCoordinates(),v.feature.changed()},onSetup:function(v){const E=v.featureId,j=this.getFeature(E);if(!j)throw new Error("You must provide a featureId to enter direct_select mode");if(j.type===ve.POINT)throw new TypeError("direct_select mode doesn't handle point features");const bt={featureId:E,feature:j,dragMoveLocation:v.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:v.coordPath?[v.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(E,bt.selectedCoordPaths)),this.setSelected(E),C.disable(this),this.setActionableState({trash:!0}),bt},onStop:function(){C.enable(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(v,E,j){v.featureId===E.properties.id?(E.properties.active=Cr.ACTIVE,j(E),Tr(E,{map:this.map,midpoints:!0,selectedPaths:v.selectedCoordPaths}).forEach(j)):(E.properties.active=Cr.INACTIVE,j(E)),this.fireActionable(v)},onTrash:function(v){v.selectedCoordPaths.sort((E,j)=>j.localeCompare(E,"en",{numeric:!0})).forEach(E=>v.feature.removeCoordinate(E)),this.fireUpdate(),v.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(v),v.feature.isValid()===!1&&(this.deleteFeature([v.featureId]),this.changeMode(ir.SIMPLE_SELECT,{}))},onMouseMove:function(v,E){const j=Pn(E),bt=zt(E),ut=Bt(E),V=v.selectedCoordPaths.length===0;return j&&V||bt&&!V?this.updateUIClasses({mouse:rr.MOVE}):this.updateUIClasses({mouse:rr.NONE}),(bt||j||ut)&&v.dragMoving&&this.fireUpdate(),this.stopDragging(v),!0},onMouseOut:function(v){return v.dragMoving&&this.fireUpdate(),!0}};Et.onTouchStart=Et.onMouseDown=function(v,E){return zt(E)?this.onVertex(v,E):Pn(E)?this.onFeature(v,E):Bt(E)?this.onMidpoint(v,E):void 0},Et.onDrag=function(v,E){if(v.canDragMove!==!0)return;v.dragMoving=!0,E.originalEvent.stopPropagation();const j={lng:E.lngLat.lng-v.dragMoveLocation.lng,lat:E.lngLat.lat-v.dragMoveLocation.lat};v.selectedCoordPaths.length>0?this.dragVertex(v,E,j):this.dragFeature(v,E,j),v.dragMoveLocation=E.lngLat},Et.onClick=function(v,E){return Li(E)?this.clickNoTarget(v,E):Pn(E)?this.clickActiveFeature(v,E):wi(E)?this.clickInactive(v,E):void this.stopDragging(v)},Et.onTap=function(v,E){return Li(E)?this.clickNoTarget(v,E):Pn(E)?this.clickActiveFeature(v,E):wi(E)?this.clickInactive(v,E):void 0},Et.onTouchEnd=Et.onMouseUp=function(v){v.dragMoving&&this.fireUpdate(),this.stopDragging(v)};const kt={};function oe(v,E){return!!v.lngLat&&v.lngLat.lng===E[0]&&v.lngLat.lat===E[1]}kt.onSetup=function(){const v=this.newFeature({type:ve.FEATURE,properties:{},geometry:{type:ve.POINT,coordinates:[]}});return this.addFeature(v),this.clearSelectedFeatures(),this.updateUIClasses({mouse:rr.ADD}),this.activateUIButton(Dr.POINT),this.setActionableState({trash:!0}),{point:v}},kt.stopDrawingAndRemove=function(v){this.deleteFeature([v.point.id],{silent:!0}),this.changeMode(ir.SIMPLE_SELECT)},kt.onTap=kt.onClick=function(v,E){this.updateUIClasses({mouse:rr.MOVE}),v.point.updateCoordinate("",E.lngLat.lng,E.lngLat.lat),this.fire(hr.CREATE,{features:[v.point.toGeoJSON()]}),this.changeMode(ir.SIMPLE_SELECT,{featureIds:[v.point.id]})},kt.onStop=function(v){this.activateUIButton(),v.point.getCoordinate().length||this.deleteFeature([v.point.id],{silent:!0})},kt.toDisplayFeatures=function(v,E,j){const bt=E.properties.id===v.point.id;if(E.properties.active=bt?Cr.ACTIVE:Cr.INACTIVE,!bt)return j(E)},kt.onTrash=kt.stopDrawingAndRemove,kt.onKeyUp=function(v,E){if(Jn(E)||Oi(E))return this.stopDrawingAndRemove(v,E)};const Wt={onSetup:function(){const v=this.newFeature({type:ve.FEATURE,properties:{},geometry:{type:ve.POLYGON,coordinates:[[]]}});return this.addFeature(v),this.clearSelectedFeatures(),C.disable(this),this.updateUIClasses({mouse:rr.ADD}),this.activateUIButton(Dr.POLYGON),this.setActionableState({trash:!0}),{polygon:v,currentVertexPosition:0}},clickAnywhere:function(v,E){if(v.currentVertexPosition>0&&oe(E,v.polygon.coordinates[0][v.currentVertexPosition-1]))return this.changeMode(ir.SIMPLE_SELECT,{featureIds:[v.polygon.id]});this.updateUIClasses({mouse:rr.ADD}),v.polygon.updateCoordinate(`0.${v.currentVertexPosition}`,E.lngLat.lng,E.lngLat.lat),v.currentVertexPosition++,v.polygon.updateCoordinate(`0.${v.currentVertexPosition}`,E.lngLat.lng,E.lngLat.lat)},clickOnVertex:function(v){return this.changeMode(ir.SIMPLE_SELECT,{featureIds:[v.polygon.id]})},onMouseMove:function(v,E){v.polygon.updateCoordinate(`0.${v.currentVertexPosition}`,E.lngLat.lng,E.lngLat.lat),xe(E)&&this.updateUIClasses({mouse:rr.POINTER})}};Wt.onTap=Wt.onClick=function(v,E){return xe(E)?this.clickOnVertex(v,E):this.clickAnywhere(v,E)},Wt.onKeyUp=function(v,E){Jn(E)?(this.deleteFeature([v.polygon.id],{silent:!0}),this.changeMode(ir.SIMPLE_SELECT)):Oi(E)&&this.changeMode(ir.SIMPLE_SELECT,{featureIds:[v.polygon.id]})},Wt.onStop=function(v){this.updateUIClasses({mouse:rr.NONE}),C.enable(this),this.activateUIButton(),this.getFeature(v.polygon.id)!==void 0&&(v.polygon.removeCoordinate(`0.${v.currentVertexPosition}`),v.polygon.isValid()?this.fire(hr.CREATE,{features:[v.polygon.toGeoJSON()]}):(this.deleteFeature([v.polygon.id],{silent:!0}),this.changeMode(ir.SIMPLE_SELECT,{},{silent:!0})))},Wt.toDisplayFeatures=function(v,E,j){const bt=E.properties.id===v.polygon.id;if(E.properties.active=bt?Cr.ACTIVE:Cr.INACTIVE,!bt)return j(E);if(E.geometry.coordinates.length===0)return;const ut=E.geometry.coordinates[0].length;if(!(ut<3)){if(E.properties.meta=Lr.FEATURE,j(Yn(v.polygon.id,E.geometry.coordinates[0][0],"0.0",!1)),ut>3){const V=E.geometry.coordinates[0].length-3;j(Yn(v.polygon.id,E.geometry.coordinates[0][V],`0.${V}`,!1))}if(ut<=4){const V=[[E.geometry.coordinates[0][0][0],E.geometry.coordinates[0][0][1]],[E.geometry.coordinates[0][1][0],E.geometry.coordinates[0][1][1]]];if(j({type:ve.FEATURE,properties:E.properties,geometry:{coordinates:V,type:ve.LINE_STRING}}),ut===3)return}return j(E)}},Wt.onTrash=function(v){this.deleteFeature([v.polygon.id],{silent:!0}),this.changeMode(ir.SIMPLE_SELECT)};const St={onSetup:function(v){const E=(v=v||{}).featureId;let j,bt,ut="forward";if(E){if(j=this.getFeature(E),!j)throw new Error("Could not find a feature with the provided featureId");let V=v.from;if(V&&V.type==="Feature"&&V.geometry&&V.geometry.type==="Point"&&(V=V.geometry),V&&V.type==="Point"&&V.coordinates&&V.coordinates.length===2&&(V=V.coordinates),!V||!Array.isArray(V))throw new Error("Please use the `from` property to indicate which point to continue the line from");const Nt=j.coordinates.length-1;if(j.coordinates[Nt][0]===V[0]&&j.coordinates[Nt][1]===V[1])bt=Nt+1,j.addCoordinate(bt,...j.coordinates[Nt]);else{if(j.coordinates[0][0]!==V[0]||j.coordinates[0][1]!==V[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");ut="backwards",bt=0,j.addCoordinate(bt,...j.coordinates[0])}}else j=this.newFeature({type:ve.FEATURE,properties:{},geometry:{type:ve.LINE_STRING,coordinates:[]}}),bt=0,this.addFeature(j);return this.clearSelectedFeatures(),C.disable(this),this.updateUIClasses({mouse:rr.ADD}),this.activateUIButton(Dr.LINE),this.setActionableState({trash:!0}),{line:j,currentVertexPosition:bt,direction:ut}},clickAnywhere:function(v,E){if(v.currentVertexPosition>0&&oe(E,v.line.coordinates[v.currentVertexPosition-1])||v.direction==="backwards"&&oe(E,v.line.coordinates[v.currentVertexPosition+1]))return this.changeMode(ir.SIMPLE_SELECT,{featureIds:[v.line.id]});this.updateUIClasses({mouse:rr.ADD}),v.line.updateCoordinate(v.currentVertexPosition,E.lngLat.lng,E.lngLat.lat),v.direction==="forward"?(v.currentVertexPosition++,v.line.updateCoordinate(v.currentVertexPosition,E.lngLat.lng,E.lngLat.lat)):v.line.addCoordinate(0,E.lngLat.lng,E.lngLat.lat)},clickOnVertex:function(v){return this.changeMode(ir.SIMPLE_SELECT,{featureIds:[v.line.id]})},onMouseMove:function(v,E){v.line.updateCoordinate(v.currentVertexPosition,E.lngLat.lng,E.lngLat.lat),xe(E)&&this.updateUIClasses({mouse:rr.POINTER})}};St.onTap=St.onClick=function(v,E){if(xe(E))return this.clickOnVertex(v,E);this.clickAnywhere(v,E)},St.onKeyUp=function(v,E){Oi(E)?this.changeMode(ir.SIMPLE_SELECT,{featureIds:[v.line.id]}):Jn(E)&&(this.deleteFeature([v.line.id],{silent:!0}),this.changeMode(ir.SIMPLE_SELECT))},St.onStop=function(v){C.enable(this),this.activateUIButton(),this.getFeature(v.line.id)!==void 0&&(v.line.removeCoordinate(`${v.currentVertexPosition}`),v.line.isValid()?this.fire(hr.CREATE,{features:[v.line.toGeoJSON()]}):(this.deleteFeature([v.line.id],{silent:!0}),this.changeMode(ir.SIMPLE_SELECT,{},{silent:!0})))},St.onTrash=function(v){this.deleteFeature([v.line.id],{silent:!0}),this.changeMode(ir.SIMPLE_SELECT)},St.toDisplayFeatures=function(v,E,j){const bt=E.properties.id===v.line.id;if(E.properties.active=bt?Cr.ACTIVE:Cr.INACTIVE,!bt)return j(E);E.geometry.coordinates.length<2||(E.properties.meta=Lr.FEATURE,j(Yn(v.line.id,E.geometry.coordinates[v.direction==="forward"?E.geometry.coordinates.length-2:1],""+(v.direction==="forward"?E.geometry.coordinates.length-2:1),!1)),j(E))};var ie={simple_select:st,direct_select:Et,draw_point:kt,draw_polygon:Wt,draw_line_string:St};const jt={defaultMode:ir.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:Mi,modes:ie,controls:{},userProperties:!1,suppressAPIEvents:!0},Yt={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},Re={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function te(v,E){return v.map(j=>j.source?j:Object.assign({},j,{id:`${j.id}.${E}`,source:E==="hot"?On.HOT:On.COLD}))}var Ye,Fe,Ne,He,er=Do(Fe?Ye:(Fe=1,Ye=function v(E,j){if(E===j)return!0;if(E&&j&&typeof E=="object"&&typeof j=="object"){if(E.constructor!==j.constructor)return!1;var bt,ut,V;if(Array.isArray(E)){if((bt=E.length)!=j.length)return!1;for(ut=bt;ut--!=0;)if(!v(E[ut],j[ut]))return!1;return!0}if(E.constructor===RegExp)return E.source===j.source&&E.flags===j.flags;if(E.valueOf!==Object.prototype.valueOf)return E.valueOf()===j.valueOf();if(E.toString!==Object.prototype.toString)return E.toString()===j.toString();if((bt=(V=Object.keys(E)).length)!==Object.keys(j).length)return!1;for(ut=bt;ut--!=0;)if(!Object.prototype.hasOwnProperty.call(j,V[ut]))return!1;for(ut=bt;ut--!=0;){var Nt=V[ut];if(!v(E[Nt],j[Nt]))return!1}return!0}return E!=E&&j!=j})),Zr=function(){if(He)return Ne;He=1,Ne=function(E){if(!E||!E.type)return null;var j=v[E.type];return j?j==="geometry"?{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:E}]}:j==="feature"?{type:"FeatureCollection",features:[E]}:j==="featurecollection"?E:void 0:null};var v={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"};return Ne}(),ur=Do(Zr);function kr(v,E){return v.length===E.length&&JSON.stringify(v.map(j=>j).sort())===JSON.stringify(E.map(j=>j).sort())}const yr={Polygon:qe,LineString:_n,Point:vn,MultiPolygon:mr,MultiLineString:mr,MultiPoint:mr};var Ze=Object.freeze({__proto__:null,CommonSelectors:pe,ModeHandler:je,StringSet:Or,constrainFeatureMovement:L,createMidPoint:mo,createSupplementaryPoints:Tr,createVertex:Yn,doubleClickZoom:C,euclideanDistance:yi,featuresAt:hn,getFeatureAtAndSetCursors:Bn,isClick:Zn,isEventAtCoordinates:oe,isTap:ki,mapEventToBoundingBox:wr,moveFeatures:J,sortFeatures:mi,stringSetsAreEqual:kr,theme:Mi,toDenseArray:dn});const lr=function(v,E){const j={options:v=function(ut={}){let V=Object.assign({},ut);return ut.controls||(V.controls={}),ut.displayControlsDefault===!1?V.controls=Object.assign({},Re,ut.controls):V.controls=Object.assign({},Yt,ut.controls),V=Object.assign({},jt,V),V.styles=te(V.styles,"cold").concat(te(V.styles,"hot")),V}(v)};E=function(ut,V){V.modes=ir;const Nt=ut.options.suppressAPIEvents===void 0||!!ut.options.suppressAPIEvents;return V.getFeatureIdsAt=function(Gt){return hn.click({point:Gt},null,ut).map(Vt=>Vt.properties.id)},V.getSelectedIds=function(){return ut.store.getSelectedIds()},V.getSelected=function(){return{type:ve.FEATURE_COLLECTION,features:ut.store.getSelectedIds().map(Gt=>ut.store.get(Gt)).map(Gt=>Gt.toGeoJSON())}},V.getSelectedPoints=function(){return{type:ve.FEATURE_COLLECTION,features:ut.store.getSelectedCoordinates().map(Gt=>({type:ve.FEATURE,properties:{},geometry:{type:ve.POINT,coordinates:Gt.coordinates}}))}},V.set=function(Gt){if(Gt.type===void 0||Gt.type!==ve.FEATURE_COLLECTION||!Array.isArray(Gt.features))throw new Error("Invalid FeatureCollection");const Vt=ut.store.createRenderBatch();let Lt=ut.store.getAllIds().slice();const se=V.add(Gt),Ce=new Or(se);return Lt=Lt.filter(tr=>!Ce.has(tr)),Lt.length&&V.delete(Lt),Vt(),se},V.add=function(Gt){const Vt=JSON.parse(JSON.stringify(ur(Gt))).features.map(Lt=>{if(Lt.id=Lt.id||vi(),Lt.geometry===null)throw new Error("Invalid geometry: null");if(ut.store.get(Lt.id)===void 0||ut.store.get(Lt.id).type!==Lt.geometry.type){const se=yr[Lt.geometry.type];if(se===void 0)throw new Error(`Invalid geometry type: ${Lt.geometry.type}.`);const Ce=new se(ut,Lt);ut.store.add(Ce,{silent:Nt})}else{const se=ut.store.get(Lt.id),Ce=se.properties;se.properties=Lt.properties,er(Ce,Lt.properties)||ut.store.featureChanged(se.id,{silent:Nt}),er(se.getCoordinates(),Lt.geometry.coordinates)||se.incomingCoords(Lt.geometry.coordinates)}return Lt.id});return ut.store.render(),Vt},V.get=function(Gt){const Vt=ut.store.get(Gt);if(Vt)return Vt.toGeoJSON()},V.getAll=function(){return{type:ve.FEATURE_COLLECTION,features:ut.store.getAll().map(Gt=>Gt.toGeoJSON())}},V.delete=function(Gt){return ut.store.delete(Gt,{silent:Nt}),V.getMode()!==ir.DIRECT_SELECT||ut.store.getSelectedIds().length?ut.store.render():ut.events.changeMode(ir.SIMPLE_SELECT,void 0,{silent:Nt}),V},V.deleteAll=function(){return ut.store.delete(ut.store.getAllIds(),{silent:Nt}),V.getMode()===ir.DIRECT_SELECT?ut.events.changeMode(ir.SIMPLE_SELECT,void 0,{silent:Nt}):ut.store.render(),V},V.changeMode=function(Gt,Vt={}){return Gt===ir.SIMPLE_SELECT&&V.getMode()===ir.SIMPLE_SELECT?(kr(Vt.featureIds||[],ut.store.getSelectedIds())||(ut.store.setSelected(Vt.featureIds,{silent:Nt}),ut.store.render()),V):(Gt===ir.DIRECT_SELECT&&V.getMode()===ir.DIRECT_SELECT&&Vt.featureId===ut.store.getSelectedIds()[0]||ut.events.changeMode(Gt,Vt,{silent:Nt}),V)},V.getMode=function(){return ut.events.getMode()},V.trash=function(){return ut.events.trash({silent:Nt}),V},V.combineFeatures=function(){return ut.events.combineFeatures({silent:Nt}),V},V.uncombineFeatures=function(){return ut.events.uncombineFeatures({silent:Nt}),V},V.setFeatureProperty=function(Gt,Vt,Lt){return ut.store.setFeatureProperty(Gt,Vt,Lt,{silent:Nt}),V},V}(j,E),j.api=E;const bt=bi(j);return E.onAdd=bt.onAdd,E.onRemove=bt.onRemove,E.types=Dr,E.options=v,E};function Gr(v){lr(v,this)}return Gr.modes=ie,Gr.constants=gn,Gr.lib=Ze,Gr},Tu.exports=zo()})(Wp);var kf=Wp.exports;const Of=Sc(kf);var Hp={exports:{}};(function(Tu,Tc){(function(zo,je){Tu.exports=je()})(bc,function(){var zo=function(h,g){return(zo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(b,T){b.__proto__=T}||function(b,T){for(var k in T)Object.prototype.hasOwnProperty.call(T,k)&&(b[k]=T[k])})(h,g)},je=function(){return(je=Object.assign||function(h){for(var g,b=1,T=arguments.length;b<T;b++)for(var k in g=arguments[b])Object.prototype.hasOwnProperty.call(g,k)&&(h[k]=g[k]);return h}).apply(this,arguments)};function Do(h,g,b){if(b||arguments.length===2)for(var T,k=0,R=g.length;k<R;k++)!T&&k in g||((T=T||Array.prototype.slice.call(g,0,k))[k]=g[k]);return h.concat(T||Array.prototype.slice.call(g))}var pn=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:bc,l=Object.keys,sr=Array.isArray;function Ot(h,g){return typeof g!="object"||l(g).forEach(function(b){h[b]=g[b]}),h}typeof Promise>"u"||pn.Promise||(pn.Promise=Promise);var Br=Object.getPrototypeOf,Oe={}.hasOwnProperty;function Ur(h,g){return Oe.call(h,g)}function Xt(h,g){typeof g=="function"&&(g=g(Br(h))),(typeof Reflect>"u"?l:Reflect.ownKeys)(g).forEach(function(b){rr(h,b,g[b])})}var On=Object.defineProperty;function rr(h,g,b,T){On(h,g,Ot(b&&Ur(b,"get")&&typeof b.get=="function"?{get:b.get,set:b.set,configurable:!0}:{value:b,configurable:!0,writable:!0},T))}function Dr(h){return{from:function(g){return h.prototype=Object.create(g.prototype),rr(h.prototype,"constructor",h),{extend:Xt.bind(null,h.prototype)}}}}var ve=Object.getOwnPropertyDescriptor,ir=[].slice;function hr(h,g,b){return ir.call(h,g,b)}function Gi(h,g){return g(h)}function Lr(h){if(!h)throw new Error("Assertion Failed")}function Cr(h){pn.setImmediate?setImmediate(h):setTimeout(h,0)}function Rn(h,g){if(typeof g=="string"&&Ur(h,g))return h[g];if(!g)return h;if(typeof g!="string"){for(var b=[],T=0,k=g.length;T<k;++T){var R=Rn(h,g[T]);b.push(R)}return b}var K=g.indexOf(".");if(K!==-1){var et=h[g.substr(0,K)];return et==null?void 0:Rn(et,g.substr(K+1))}}function Wr(h,g,b){if(h&&g!==void 0&&!("isFrozen"in Object&&Object.isFrozen(h)))if(typeof g!="string"&&"length"in g){Lr(typeof b!="string"&&"length"in b);for(var T=0,k=g.length;T<k;++T)Wr(h,g[T],b[T])}else{var R,K,et=g.indexOf(".");et!==-1?(R=g.substr(0,et),(K=g.substr(et+1))===""?b===void 0?sr(h)&&!isNaN(parseInt(R))?h.splice(R,1):delete h[R]:h[R]=b:Wr(et=!(et=h[R])||!Ur(h,R)?h[R]={}:et,K,b)):b===void 0?sr(h)&&!isNaN(parseInt(g))?h.splice(g,1):delete h[g]:h[g]=b}}function Ai(h){var g,b={};for(g in h)Ur(h,g)&&(b[g]=h[g]);return b}var gn=[].concat;function di(h){return gn.apply([],h)}var rn="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(di([8,16,32,64].map(function(h){return["Int","Uint","Float"].map(function(g){return g+h+"Array"})}))).filter(function(h){return pn[h]}),ni=new Set(rn.map(function(h){return pn[h]})),mi=null;function wr(h){return mi=new WeakMap,h=function g(b){if(!b||typeof b!="object")return b;var T=mi.get(b);if(T)return T;if(sr(b)){T=[],mi.set(b,T);for(var k=0,R=b.length;k<R;++k)T.push(g(b[k]))}else if(ni.has(b.constructor))T=b;else{var K,et=Br(b);for(K in T=et===Object.prototype?{}:Object.create(et),mi.set(b,T),b)Ur(b,K)&&(T[K]=g(b[K]))}return T}(h),mi=null,h}var Or={}.toString;function Lo(h){return Or.call(h).slice(8,-1)}var hn=typeof Symbol<"u"?Symbol.iterator:"@@iterator",ho=typeof hn=="symbol"?function(h){var g;return h!=null&&(g=h[hn])&&g.apply(h)}:function(){return null};function Bn(h,g){return g=h.indexOf(g),0<=g&&h.splice(g,1),0<=g}var yi={};function Cn(h){var g,b,T,k;if(arguments.length===1){if(sr(h))return h.slice();if(this===yi&&typeof h=="string")return[h];if(k=ho(h)){for(b=[];!(T=k.next()).done;)b.push(T.value);return b}if(h==null)return[h];if(typeof(g=h.length)!="number")return[h];for(b=new Array(g);g--;)b[g]=h[g];return b}for(g=arguments.length,b=new Array(g);g--;)b[g]=arguments[g];return b}var Wn=typeof Symbol<"u"?function(h){return h[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},bi=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],$r=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(bi),Pi={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Zn(h,g){this.name=h,this.message=g}function $i(h,g){return h+". Errors: "+Object.keys(g).map(function(b){return g[b].toString()}).filter(function(b,T,k){return k.indexOf(b)===T}).join(`
`)}function gi(h,g,b,T){this.failures=g,this.failedKeys=T,this.successCount=b,this.message=$i(h,g)}function ki(h,g){this.name="BulkError",this.failures=Object.keys(g).map(function(b){return g[b]}),this.failuresByPos=g,this.message=$i(h,this.failures)}Dr(Zn).from(Error).extend({toString:function(){return this.name+": "+this.message}}),Dr(gi).from(Zn),Dr(ki).from(Zn);var fn=$r.reduce(function(h,g){return h[g]=g+"Error",h},{}),vi=Zn,Kt=$r.reduce(function(h,g){var b=g+"Error";function T(k,R){this.name=b,k?typeof k=="string"?(this.message="".concat(k).concat(R?`
 `+R:""),this.inner=R||null):typeof k=="object"&&(this.message="".concat(k.name," ").concat(k.message),this.inner=k):(this.message=Pi[g]||b,this.inner=null)}return Dr(T).from(vi),h[g]=T,h},{});Kt.Syntax=SyntaxError,Kt.Type=TypeError,Kt.Range=RangeError;var vn=bi.reduce(function(h,g){return h[g+"Error"]=Kt[g],h},{}),_n=$r.reduce(function(h,g){return["Syntax","Type","Range"].indexOf(g)===-1&&(h[g+"Error"]=Kt[g]),h},{});function qe(){}function We(h){return h}function _i(h,g){return h==null||h===We?g:function(b){return g(h(b))}}function mr(h,g){return function(){h.apply(this,arguments),g.apply(this,arguments)}}function Ve(h,g){return h===qe?g:function(){var b=h.apply(this,arguments);b!==void 0&&(arguments[0]=b);var T=this.onsuccess,k=this.onerror;this.onsuccess=null,this.onerror=null;var R=g.apply(this,arguments);return T&&(this.onsuccess=this.onsuccess?mr(T,this.onsuccess):T),k&&(this.onerror=this.onerror?mr(k,this.onerror):k),R!==void 0?R:b}}function ra(h,g){return h===qe?g:function(){h.apply(this,arguments);var b=this.onsuccess,T=this.onerror;this.onsuccess=this.onerror=null,g.apply(this,arguments),b&&(this.onsuccess=this.onsuccess?mr(b,this.onsuccess):b),T&&(this.onerror=this.onerror?mr(T,this.onerror):T)}}function xi(h,g){return h===qe?g:function(b){var T=h.apply(this,arguments);Ot(b,T);var k=this.onsuccess,R=this.onerror;return this.onsuccess=null,this.onerror=null,b=g.apply(this,arguments),k&&(this.onsuccess=this.onsuccess?mr(k,this.onsuccess):k),R&&(this.onerror=this.onerror?mr(R,this.onerror):R),T===void 0?b===void 0?void 0:b:Ot(T,b)}}function Xo(h,g){return h===qe?g:function(){return g.apply(this,arguments)!==!1&&h.apply(this,arguments)}}function dn(h,g){return h===qe?g:function(){var b=h.apply(this,arguments);if(b&&typeof b.then=="function"){for(var T=this,k=arguments.length,R=new Array(k);k--;)R[k]=arguments[k];return b.then(function(){return g.apply(T,R)})}return g.apply(this,arguments)}}_n.ModifyError=gi,_n.DexieError=Zn,_n.BulkError=ki;var An=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function _r(h){An=h}var xn={},Hn=100,rn=typeof Promise>"u"?[]:function(){var h=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[h,Br(h),h];var g=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[g,Br(g),h]}(),bi=rn[0],$r=rn[1],rn=rn[2],$r=$r&&$r.then,Gn=bi&&bi.constructor,fo=!!rn,Mi=function(h,g){ii.push([h,g]),Di&&(queueMicrotask(M),Di=!1)},zi=!0,Di=!0,Pn=[],wi=[],Li=We,kn={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:qe,pgp:!1,env:{},finalize:qe},xe=kn,ii=[],Jn=0,Oi=[];function pe(h){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var g=this._PSD=xe;if(typeof h!="function"){if(h!==xn)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&Yn(this,this._value))}this._state=null,this._value=null,++g.ref,function b(T,k){try{k(function(R){if(T._state===null){if(R===T)throw new TypeError("A promise cannot be resolved with itself.");var K=T._lib&&D();R&&typeof R.then=="function"?b(T,function(et,lt){R instanceof pe?R._then(et,lt):R.then(et,lt)}):(T._state=!0,T._value=R,mo(T)),K&&U()}},Yn.bind(null,T))}catch(R){Yn(T,R)}}(this,h)}var mn={get:function(){var h=xe,g=Bt;function b(T,k){var R=this,K=!h.global&&(h!==xe||g!==Bt),et=K&&!Wt(),lt=new pe(function(ht,gt){Tr(R,new oi(te(T,h,K,et),te(k,h,K,et),ht,gt,h))});return this._consoleTask&&(lt._consoleTask=this._consoleTask),lt}return b.prototype=xn,b},set:function(h){rr(this,"then",h&&h.prototype===xn?mn:{get:function(){return h},set:mn.set})}};function oi(h,g,b,T,k){this.onFulfilled=typeof h=="function"?h:null,this.onRejected=typeof g=="function"?g:null,this.resolve=b,this.reject=T,this.psd=k}function Yn(h,g){var b,T;wi.push(g),h._state===null&&(b=h._lib&&D(),g=Li(g),h._state=!1,h._value=g,T=h,Pn.some(function(k){return k._value===T._value})||Pn.push(T),mo(h),b&&U())}function mo(h){var g=h._listeners;h._listeners=[];for(var b=0,T=g.length;b<T;++b)Tr(h,g[b]);var k=h._PSD;--k.ref||k.finalize(),Jn===0&&(++Jn,Mi(function(){--Jn==0&&G()},[]))}function Tr(h,g){if(h._state!==null){var b=h._state?g.onFulfilled:g.onRejected;if(b===null)return(h._state?g.resolve:g.reject)(h._value);++g.psd.ref,++Jn,Mi(C,[b,h,g])}else h._listeners.push(g)}function C(h,g,b){try{var T,k=g._value;!g._state&&wi.length&&(wi=[]),T=An&&g._consoleTask?g._consoleTask.run(function(){return h(k)}):h(k),g._state||wi.indexOf(k)!==-1||function(R){for(var K=Pn.length;K;)if(Pn[--K]._value===R._value)return Pn.splice(K,1)}(g),b.resolve(T)}catch(R){b.reject(R)}finally{--Jn==0&&G(),--b.psd.ref||b.psd.finalize()}}function M(){Re(kn,function(){D()&&U()})}function D(){var h=zi;return Di=zi=!1,h}function U(){var h,g,b;do for(;0<ii.length;)for(h=ii,ii=[],b=h.length,g=0;g<b;++g){var T=h[g];T[0].apply(null,T[1])}while(0<ii.length);Di=zi=!0}function G(){var h=Pn;Pn=[],h.forEach(function(T){T._PSD.onunhandled.call(null,T._value,T)});for(var g=Oi.slice(0),b=g.length;b;)g[--b]()}function nt(h){return new pe(xn,!1,h)}function $(h,g){var b=xe;return function(){var T=D(),k=xe;try{return jt(b,!0),h.apply(this,arguments)}catch(R){g&&g(R)}finally{jt(k,!1),T&&U()}}}Xt(pe.prototype,{then:mn,_then:function(h,g){Tr(this,new oi(null,null,h,g,xe))},catch:function(h){if(arguments.length===1)return this.then(null,h);var g=h,b=arguments[1];return typeof g=="function"?this.then(null,function(T){return(T instanceof g?b:nt)(T)}):this.then(null,function(T){return(T&&T.name===g?b:nt)(T)})},finally:function(h){return this.then(function(g){return pe.resolve(h()).then(function(){return g})},function(g){return pe.resolve(h()).then(function(){return nt(g)})})},timeout:function(h,g){var b=this;return h<1/0?new pe(function(T,k){var R=setTimeout(function(){return k(new Kt.Timeout(g))},h);b.then(T,k).finally(clearTimeout.bind(null,R))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&rr(pe.prototype,Symbol.toStringTag,"Dexie.Promise"),kn.env=Yt(),Xt(pe,{all:function(){var h=Cn.apply(null,arguments).map(St);return new pe(function(g,b){h.length===0&&g([]);var T=h.length;h.forEach(function(k,R){return pe.resolve(k).then(function(K){h[R]=K,--T||g(h)},b)})})},resolve:function(h){return h instanceof pe?h:h&&typeof h.then=="function"?new pe(function(g,b){h.then(g,b)}):new pe(xn,!0,h)},reject:nt,race:function(){var h=Cn.apply(null,arguments).map(St);return new pe(function(g,b){h.map(function(T){return pe.resolve(T).then(g,b)})})},PSD:{get:function(){return xe},set:function(h){return xe=h}},totalEchoes:{get:function(){return Bt}},newPSD:kt,usePSD:Re,scheduler:{get:function(){return Mi},set:function(h){Mi=h}},rejectionMapper:{get:function(){return Li},set:function(h){Li=h}},follow:function(h,g){return new pe(function(b,T){return kt(function(k,R){var K=xe;K.unhandleds=[],K.onunhandled=R,K.finalize=mr(function(){var et,lt=this;et=function(){lt.unhandleds.length===0?k():R(lt.unhandleds[0])},Oi.push(function ht(){et(),Oi.splice(Oi.indexOf(ht),1)}),++Jn,Mi(function(){--Jn==0&&G()},[])},K.finalize),h()},g,b,T)})}}),Gn&&(Gn.allSettled&&rr(pe,"allSettled",function(){var h=Cn.apply(null,arguments).map(St);return new pe(function(g){h.length===0&&g([]);var b=h.length,T=new Array(b);h.forEach(function(k,R){return pe.resolve(k).then(function(K){return T[R]={status:"fulfilled",value:K}},function(K){return T[R]={status:"rejected",reason:K}}).then(function(){return--b||g(T)})})})}),Gn.any&&typeof AggregateError<"u"&&rr(pe,"any",function(){var h=Cn.apply(null,arguments).map(St);return new pe(function(g,b){h.length===0&&b(new AggregateError([]));var T=h.length,k=new Array(T);h.forEach(function(R,K){return pe.resolve(R).then(function(et){return g(et)},function(et){k[K]=et,--T||b(new AggregateError(k))})})})}),Gn.withResolvers&&(pe.withResolvers=Gn.withResolvers));var L={awaits:0,echoes:0,id:0},J=0,st=[],zt=0,Bt=0,Et=0;function kt(h,g,b,T){var k=xe,R=Object.create(k);return R.parent=k,R.ref=0,R.global=!1,R.id=++Et,kn.env,R.env=fo?{Promise:pe,PromiseProp:{value:pe,configurable:!0,writable:!0},all:pe.all,race:pe.race,allSettled:pe.allSettled,any:pe.any,resolve:pe.resolve,reject:pe.reject}:{},g&&Ot(R,g),++k.ref,R.finalize=function(){--this.parent.ref||this.parent.finalize()},T=Re(R,h,b,T),R.ref===0&&R.finalize(),T}function oe(){return L.id||(L.id=++J),++L.awaits,L.echoes+=Hn,L.id}function Wt(){return!!L.awaits&&(--L.awaits==0&&(L.id=0),L.echoes=L.awaits*Hn,!0)}function St(h){return L.echoes&&h&&h.constructor===Gn?(oe(),h.then(function(g){return Wt(),g},function(g){return Wt(),Fe(g)})):h}function ie(){var h=st[st.length-1];st.pop(),jt(h,!1)}function jt(h,g){var b,T=xe;(g?!L.echoes||zt++&&h===xe:!zt||--zt&&h===xe)||queueMicrotask(g?(function(k){++Bt,L.echoes&&--L.echoes!=0||(L.echoes=L.awaits=L.id=0),st.push(xe),jt(k,!0)}).bind(null,h):ie),h!==xe&&(xe=h,T===kn&&(kn.env=Yt()),fo&&(b=kn.env.Promise,g=h.env,(T.global||h.global)&&(Object.defineProperty(pn,"Promise",g.PromiseProp),b.all=g.all,b.race=g.race,b.resolve=g.resolve,b.reject=g.reject,g.allSettled&&(b.allSettled=g.allSettled),g.any&&(b.any=g.any))))}function Yt(){var h=pn.Promise;return fo?{Promise:h,PromiseProp:Object.getOwnPropertyDescriptor(pn,"Promise"),all:h.all,race:h.race,allSettled:h.allSettled,any:h.any,resolve:h.resolve,reject:h.reject}:{}}function Re(h,g,b,T,k){var R=xe;try{return jt(h,!0),g(b,T,k)}finally{jt(R,!1)}}function te(h,g,b,T){return typeof h!="function"?h:function(){var k=xe;b&&oe(),jt(g,!0);try{return h.apply(this,arguments)}finally{jt(k,!1),T&&queueMicrotask(Wt)}}}function Ye(h){Promise===Gn&&L.echoes===0?zt===0?h():enqueueNativeMicroTask(h):setTimeout(h,0)}(""+$r).indexOf("[native code]")===-1&&(oe=Wt=qe);var Fe=pe.reject,Ne=String.fromCharCode(65535),He="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",er="String expected.",Zr=[],ur="__dbnames",kr="readonly",yr="readwrite";function Ze(h,g){return h?g?function(){return h.apply(this,arguments)&&g.apply(this,arguments)}:h:g}var lr={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Gr(h){return typeof h!="string"||/\./.test(h)?function(g){return g}:function(g){return g[h]===void 0&&h in g&&delete(g=wr(g))[h],g}}function v(){throw Kt.Type()}function E(h,g){try{var b=j(h),T=j(g);if(b!==T)return b==="Array"?1:T==="Array"?-1:b==="binary"?1:T==="binary"?-1:b==="string"?1:T==="string"?-1:b==="Date"?1:T!=="Date"?NaN:-1;switch(b){case"number":case"Date":case"string":return g<h?1:h<g?-1:0;case"binary":return function(k,R){for(var K=k.length,et=R.length,lt=K<et?K:et,ht=0;ht<lt;++ht)if(k[ht]!==R[ht])return k[ht]<R[ht]?-1:1;return K===et?0:K<et?-1:1}(bt(h),bt(g));case"Array":return function(k,R){for(var K=k.length,et=R.length,lt=K<et?K:et,ht=0;ht<lt;++ht){var gt=E(k[ht],R[ht]);if(gt!==0)return gt}return K===et?0:K<et?-1:1}(h,g)}}catch{}return NaN}function j(h){var g=typeof h;return g!="object"?g:ArrayBuffer.isView(h)?"binary":(h=Lo(h),h==="ArrayBuffer"?"binary":h)}function bt(h){return h instanceof Uint8Array?h:ArrayBuffer.isView(h)?new Uint8Array(h.buffer,h.byteOffset,h.byteLength):new Uint8Array(h)}var ut=(V.prototype._trans=function(h,g,b){var T=this._tx||xe.trans,k=this.name,R=An&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(h==="readonly"?"read":"write"," ").concat(this.name));function K(ht,gt,it){if(!it.schema[k])throw new Kt.NotFound("Table "+k+" not part of transaction");return g(it.idbtrans,it)}var et=D();try{var lt=T&&T.db._novip===this.db._novip?T===xe.trans?T._promise(h,K,b):kt(function(){return T._promise(h,K,b)},{trans:T,transless:xe.transless||xe}):function ht(gt,it,ft,pt){if(gt.idbdb&&(gt._state.openComplete||xe.letThrough||gt._vip)){var dt=gt._createTransaction(it,ft,gt._dbSchema);try{dt.create(),gt._state.PR1398_maxLoop=3}catch(_t){return _t.name===fn.InvalidState&&gt.isOpen()&&0<--gt._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),gt.close({disableAutoOpen:!1}),gt.open().then(function(){return ht(gt,it,ft,pt)})):Fe(_t)}return dt._promise(it,function(_t,ot){return kt(function(){return xe.trans=dt,pt(_t,ot,dt)})}).then(function(_t){if(it==="readwrite")try{dt.idbtrans.commit()}catch{}return it==="readonly"?_t:dt._completion.then(function(){return _t})})}if(gt._state.openComplete)return Fe(new Kt.DatabaseClosed(gt._state.dbOpenError));if(!gt._state.isBeingOpened){if(!gt._state.autoOpen)return Fe(new Kt.DatabaseClosed);gt.open().catch(qe)}return gt._state.dbReadyPromise.then(function(){return ht(gt,it,ft,pt)})}(this.db,h,[this.name],K);return R&&(lt._consoleTask=R,lt=lt.catch(function(ht){return console.trace(ht),Fe(ht)})),lt}finally{et&&U()}},V.prototype.get=function(h,g){var b=this;return h&&h.constructor===Object?this.where(h).first(g):h==null?Fe(new Kt.Type("Invalid argument to Table.get()")):this._trans("readonly",function(T){return b.core.get({trans:T,key:h}).then(function(k){return b.hook.reading.fire(k)})}).then(g)},V.prototype.where=function(h){if(typeof h=="string")return new this.db.WhereClause(this,h);if(sr(h))return new this.db.WhereClause(this,"[".concat(h.join("+"),"]"));var g=l(h);if(g.length===1)return this.where(g[0]).equals(h[g[0]]);var b=this.schema.indexes.concat(this.schema.primKey).filter(function(et){if(et.compound&&g.every(function(ht){return 0<=et.keyPath.indexOf(ht)})){for(var lt=0;lt<g.length;++lt)if(g.indexOf(et.keyPath[lt])===-1)return!1;return!0}return!1}).sort(function(et,lt){return et.keyPath.length-lt.keyPath.length})[0];if(b&&this.db._maxKey!==Ne){var R=b.keyPath.slice(0,g.length);return this.where(R).equals(R.map(function(lt){return h[lt]}))}!b&&An&&console.warn("The query ".concat(JSON.stringify(h)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(g.join("+"),"]"));var T=this.schema.idxByName;function k(et,lt){return E(et,lt)===0}var K=g.reduce(function(it,lt){var ht=it[0],gt=it[1],it=T[lt],ft=h[lt];return[ht||it,ht||!it?Ze(gt,it&&it.multi?function(pt){return pt=Rn(pt,lt),sr(pt)&&pt.some(function(dt){return k(ft,dt)})}:function(pt){return k(ft,Rn(pt,lt))}):gt]},[null,null]),R=K[0],K=K[1];return R?this.where(R.name).equals(h[R.keyPath]).filter(K):b?this.filter(K):this.where(g).equals("")},V.prototype.filter=function(h){return this.toCollection().and(h)},V.prototype.count=function(h){return this.toCollection().count(h)},V.prototype.offset=function(h){return this.toCollection().offset(h)},V.prototype.limit=function(h){return this.toCollection().limit(h)},V.prototype.each=function(h){return this.toCollection().each(h)},V.prototype.toArray=function(h){return this.toCollection().toArray(h)},V.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},V.prototype.orderBy=function(h){return new this.db.Collection(new this.db.WhereClause(this,sr(h)?"[".concat(h.join("+"),"]"):h))},V.prototype.reverse=function(){return this.toCollection().reverse()},V.prototype.mapToClass=function(h){var g,b=this.db,T=this.name;function k(){return g!==null&&g.apply(this,arguments)||this}(this.schema.mappedClass=h).prototype instanceof v&&(function(lt,ht){if(typeof ht!="function"&&ht!==null)throw new TypeError("Class extends value "+String(ht)+" is not a constructor or null");function gt(){this.constructor=lt}zo(lt,ht),lt.prototype=ht===null?Object.create(ht):(gt.prototype=ht.prototype,new gt)}(k,g=h),Object.defineProperty(k.prototype,"db",{get:function(){return b},enumerable:!1,configurable:!0}),k.prototype.table=function(){return T},h=k);for(var R=new Set,K=h.prototype;K;K=Br(K))Object.getOwnPropertyNames(K).forEach(function(lt){return R.add(lt)});function et(lt){if(!lt)return lt;var ht,gt=Object.create(h.prototype);for(ht in lt)if(!R.has(ht))try{gt[ht]=lt[ht]}catch{}return gt}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=et,this.hook("reading",et),h},V.prototype.defineClass=function(){return this.mapToClass(function(h){Ot(this,h)})},V.prototype.add=function(h,g){var b=this,T=this.schema.primKey,k=T.auto,R=T.keyPath,K=h;return R&&k&&(K=Gr(R)(h)),this._trans("readwrite",function(et){return b.core.mutate({trans:et,type:"add",keys:g!=null?[g]:null,values:[K]})}).then(function(et){return et.numFailures?pe.reject(et.failures[0]):et.lastResult}).then(function(et){if(R)try{Wr(h,R,et)}catch{}return et})},V.prototype.update=function(h,g){return typeof h!="object"||sr(h)?this.where(":id").equals(h).modify(g):(h=Rn(h,this.schema.primKey.keyPath),h===void 0?Fe(new Kt.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(h).modify(g))},V.prototype.put=function(h,g){var b=this,T=this.schema.primKey,k=T.auto,R=T.keyPath,K=h;return R&&k&&(K=Gr(R)(h)),this._trans("readwrite",function(et){return b.core.mutate({trans:et,type:"put",values:[K],keys:g!=null?[g]:null})}).then(function(et){return et.numFailures?pe.reject(et.failures[0]):et.lastResult}).then(function(et){if(R)try{Wr(h,R,et)}catch{}return et})},V.prototype.delete=function(h){var g=this;return this._trans("readwrite",function(b){return g.core.mutate({trans:b,type:"delete",keys:[h]})}).then(function(b){return b.numFailures?pe.reject(b.failures[0]):void 0})},V.prototype.clear=function(){var h=this;return this._trans("readwrite",function(g){return h.core.mutate({trans:g,type:"deleteRange",range:lr})}).then(function(g){return g.numFailures?pe.reject(g.failures[0]):void 0})},V.prototype.bulkGet=function(h){var g=this;return this._trans("readonly",function(b){return g.core.getMany({keys:h,trans:b}).then(function(T){return T.map(function(k){return g.hook.reading.fire(k)})})})},V.prototype.bulkAdd=function(h,g,b){var T=this,k=Array.isArray(g)?g:void 0,R=(b=b||(k?void 0:g))?b.allKeys:void 0;return this._trans("readwrite",function(K){var ht=T.schema.primKey,et=ht.auto,ht=ht.keyPath;if(ht&&k)throw new Kt.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(k&&k.length!==h.length)throw new Kt.InvalidArgument("Arguments objects and keys must have the same length");var lt=h.length,ht=ht&&et?h.map(Gr(ht)):h;return T.core.mutate({trans:K,type:"add",keys:k,values:ht,wantResults:R}).then(function(dt){var it=dt.numFailures,ft=dt.results,pt=dt.lastResult,dt=dt.failures;if(it===0)return R?ft:pt;throw new ki("".concat(T.name,".bulkAdd(): ").concat(it," of ").concat(lt," operations failed"),dt)})})},V.prototype.bulkPut=function(h,g,b){var T=this,k=Array.isArray(g)?g:void 0,R=(b=b||(k?void 0:g))?b.allKeys:void 0;return this._trans("readwrite",function(K){var ht=T.schema.primKey,et=ht.auto,ht=ht.keyPath;if(ht&&k)throw new Kt.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(k&&k.length!==h.length)throw new Kt.InvalidArgument("Arguments objects and keys must have the same length");var lt=h.length,ht=ht&&et?h.map(Gr(ht)):h;return T.core.mutate({trans:K,type:"put",keys:k,values:ht,wantResults:R}).then(function(dt){var it=dt.numFailures,ft=dt.results,pt=dt.lastResult,dt=dt.failures;if(it===0)return R?ft:pt;throw new ki("".concat(T.name,".bulkPut(): ").concat(it," of ").concat(lt," operations failed"),dt)})})},V.prototype.bulkUpdate=function(h){var g=this,b=this.core,T=h.map(function(K){return K.key}),k=h.map(function(K){return K.changes}),R=[];return this._trans("readwrite",function(K){return b.getMany({trans:K,keys:T,cache:"clone"}).then(function(et){var lt=[],ht=[];h.forEach(function(it,ft){var pt=it.key,dt=it.changes,_t=et[ft];if(_t){for(var ot=0,yt=Object.keys(dt);ot<yt.length;ot++){var It=yt[ot],Pt=dt[It];if(It===g.schema.primKey.keyPath){if(E(Pt,pt)!==0)throw new Kt.Constraint("Cannot update primary key in bulkUpdate()")}else Wr(_t,It,Pt)}R.push(ft),lt.push(pt),ht.push(_t)}});var gt=lt.length;return b.mutate({trans:K,type:"put",keys:lt,values:ht,updates:{keys:T,changeSpecs:k}}).then(function(it){var ft=it.numFailures,pt=it.failures;if(ft===0)return gt;for(var dt=0,_t=Object.keys(pt);dt<_t.length;dt++){var ot,yt=_t[dt],It=R[Number(yt)];It!=null&&(ot=pt[yt],delete pt[yt],pt[It]=ot)}throw new ki("".concat(g.name,".bulkUpdate(): ").concat(ft," of ").concat(gt," operations failed"),pt)})})})},V.prototype.bulkDelete=function(h){var g=this,b=h.length;return this._trans("readwrite",function(T){return g.core.mutate({trans:T,type:"delete",keys:h})}).then(function(K){var k=K.numFailures,R=K.lastResult,K=K.failures;if(k===0)return R;throw new ki("".concat(g.name,".bulkDelete(): ").concat(k," of ").concat(b," operations failed"),K)})},V);function V(){}function Nt(h){function g(K,et){if(et){for(var lt=arguments.length,ht=new Array(lt-1);--lt;)ht[lt-1]=arguments[lt];return b[K].subscribe.apply(null,ht),h}if(typeof K=="string")return b[K]}var b={};g.addEventType=R;for(var T=1,k=arguments.length;T<k;++T)R(arguments[T]);return g;function R(K,et,lt){if(typeof K!="object"){var ht;et=et||Xo;var gt={subscribers:[],fire:lt=lt||qe,subscribe:function(it){gt.subscribers.indexOf(it)===-1&&(gt.subscribers.push(it),gt.fire=et(gt.fire,it))},unsubscribe:function(it){gt.subscribers=gt.subscribers.filter(function(ft){return ft!==it}),gt.fire=gt.subscribers.reduce(et,lt)}};return b[K]=g[K]=gt}l(ht=K).forEach(function(it){var ft=ht[it];if(sr(ft))R(it,ht[it][0],ht[it][1]);else{if(ft!=="asap")throw new Kt.InvalidArgument("Invalid event config");var pt=R(it,We,function(){for(var dt=arguments.length,_t=new Array(dt);dt--;)_t[dt]=arguments[dt];pt.subscribers.forEach(function(ot){Cr(function(){ot.apply(null,_t)})})})}})}}function Gt(h,g){return Dr(g).from({prototype:h}),g}function Vt(h,g){return!(h.filter||h.algorithm||h.or)&&(g?h.justLimit:!h.replayFilter)}function Lt(h,g){h.filter=Ze(h.filter,g)}function se(h,g,b){var T=h.replayFilter;h.replayFilter=T?function(){return Ze(T(),g())}:g,h.justLimit=b&&!T}function Ce(h,g){if(h.isPrimKey)return g.primaryKey;var b=g.getIndexByKeyPath(h.index);if(!b)throw new Kt.Schema("KeyPath "+h.index+" on object store "+g.name+" is not indexed");return b}function tr(h,g,b){var T=Ce(h,g.schema);return g.openCursor({trans:b,values:!h.keysOnly,reverse:h.dir==="prev",unique:!!h.unique,query:{index:T,range:h.range}})}function bn(h,g,b,T){var k=h.replayFilter?Ze(h.filter,h.replayFilter()):h.filter;if(h.or){var R={},K=function(et,lt,ht){var gt,it;k&&!k(lt,ht,function(ft){return lt.stop(ft)},function(ft){return lt.fail(ft)})||((it=""+(gt=lt.primaryKey))=="[object ArrayBuffer]"&&(it=""+new Uint8Array(gt)),Ur(R,it)||(R[it]=!0,g(et,lt,ht)))};return Promise.all([h.or._iterate(K,b),Mr(tr(h,T,b),h.algorithm,K,!h.keysOnly&&h.valueMapper)])}return Mr(tr(h,T,b),Ze(h.algorithm,k),g,!h.keysOnly&&h.valueMapper)}function Mr(h,g,b,T){var k=$(T?function(R,K,et){return b(T(R),K,et)}:b);return h.then(function(R){if(R)return R.start(function(){var K=function(){return R.continue()};g&&!g(R,function(et){return K=et},function(et){R.stop(et),K=qe},function(et){R.fail(et),K=qe})||k(R.value,R,function(et){return K=et}),K()})})}var Ft=(me.prototype.execute=function(h){var g=this["@@propmod"];if(g.add!==void 0){var b=g.add;if(sr(b))return Do(Do([],sr(h)?h:[],!0),b,!0).sort();if(typeof b=="number")return(Number(h)||0)+b;if(typeof b=="bigint")try{return BigInt(h)+b}catch{return BigInt(0)+b}throw new TypeError("Invalid term ".concat(b))}if(g.remove!==void 0){var T=g.remove;if(sr(T))return sr(h)?h.filter(function(k){return!T.includes(k)}).sort():[];if(typeof T=="number")return Number(h)-T;if(typeof T=="bigint")try{return BigInt(h)-T}catch{return BigInt(0)-T}throw new TypeError("Invalid subtrahend ".concat(T))}return b=(b=g.replacePrefix)===null||b===void 0?void 0:b[0],b&&typeof h=="string"&&h.startsWith(b)?g.replacePrefix[1]+h.substring(b.length):h},me);function me(h){this["@@propmod"]=h}var Ke=(ze.prototype._read=function(h,g){var b=this._ctx;return b.error?b.table._trans(null,Fe.bind(null,b.error)):b.table._trans("readonly",h).then(g)},ze.prototype._write=function(h){var g=this._ctx;return g.error?g.table._trans(null,Fe.bind(null,g.error)):g.table._trans("readwrite",h,"locked")},ze.prototype._addAlgorithm=function(h){var g=this._ctx;g.algorithm=Ze(g.algorithm,h)},ze.prototype._iterate=function(h,g){return bn(this._ctx,h,g,this._ctx.table.core)},ze.prototype.clone=function(h){var g=Object.create(this.constructor.prototype),b=Object.create(this._ctx);return h&&Ot(b,h),g._ctx=b,g},ze.prototype.raw=function(){return this._ctx.valueMapper=null,this},ze.prototype.each=function(h){var g=this._ctx;return this._read(function(b){return bn(g,h,b,g.table.core)})},ze.prototype.count=function(h){var g=this;return this._read(function(b){var T=g._ctx,k=T.table.core;if(Vt(T,!0))return k.count({trans:b,query:{index:Ce(T,k.schema),range:T.range}}).then(function(K){return Math.min(K,T.limit)});var R=0;return bn(T,function(){return++R,!1},b,k).then(function(){return R})}).then(h)},ze.prototype.sortBy=function(h,g){var b=h.split(".").reverse(),T=b[0],k=b.length-1;function R(lt,ht){return ht?R(lt[b[ht]],ht-1):lt[T]}var K=this._ctx.dir==="next"?1:-1;function et(lt,ht){return E(R(lt,k),R(ht,k))*K}return this.toArray(function(lt){return lt.sort(et)}).then(g)},ze.prototype.toArray=function(h){var g=this;return this._read(function(b){var T=g._ctx;if(T.dir==="next"&&Vt(T,!0)&&0<T.limit){var k=T.valueMapper,R=Ce(T,T.table.core.schema);return T.table.core.query({trans:b,limit:T.limit,values:!0,query:{index:R,range:T.range}}).then(function(et){return et=et.result,k?et.map(k):et})}var K=[];return bn(T,function(et){return K.push(et)},b,T.table.core).then(function(){return K})},h)},ze.prototype.offset=function(h){var g=this._ctx;return h<=0||(g.offset+=h,Vt(g)?se(g,function(){var b=h;return function(T,k){return b===0||(b===1?--b:k(function(){T.advance(b),b=0}),!1)}}):se(g,function(){var b=h;return function(){return--b<0}})),this},ze.prototype.limit=function(h){return this._ctx.limit=Math.min(this._ctx.limit,h),se(this._ctx,function(){var g=h;return function(b,T,k){return--g<=0&&T(k),0<=g}},!0),this},ze.prototype.until=function(h,g){return Lt(this._ctx,function(b,T,k){return!h(b.value)||(T(k),g)}),this},ze.prototype.first=function(h){return this.limit(1).toArray(function(g){return g[0]}).then(h)},ze.prototype.last=function(h){return this.reverse().first(h)},ze.prototype.filter=function(h){var g;return Lt(this._ctx,function(b){return h(b.value)}),(g=this._ctx).isMatch=Ze(g.isMatch,h),this},ze.prototype.and=function(h){return this.filter(h)},ze.prototype.or=function(h){return new this.db.WhereClause(this._ctx.table,h,this)},ze.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},ze.prototype.desc=function(){return this.reverse()},ze.prototype.eachKey=function(h){var g=this._ctx;return g.keysOnly=!g.isMatch,this.each(function(b,T){h(T.key,T)})},ze.prototype.eachUniqueKey=function(h){return this._ctx.unique="unique",this.eachKey(h)},ze.prototype.eachPrimaryKey=function(h){var g=this._ctx;return g.keysOnly=!g.isMatch,this.each(function(b,T){h(T.primaryKey,T)})},ze.prototype.keys=function(h){var g=this._ctx;g.keysOnly=!g.isMatch;var b=[];return this.each(function(T,k){b.push(k.key)}).then(function(){return b}).then(h)},ze.prototype.primaryKeys=function(h){var g=this._ctx;if(g.dir==="next"&&Vt(g,!0)&&0<g.limit)return this._read(function(T){var k=Ce(g,g.table.core.schema);return g.table.core.query({trans:T,values:!1,limit:g.limit,query:{index:k,range:g.range}})}).then(function(T){return T.result}).then(h);g.keysOnly=!g.isMatch;var b=[];return this.each(function(T,k){b.push(k.primaryKey)}).then(function(){return b}).then(h)},ze.prototype.uniqueKeys=function(h){return this._ctx.unique="unique",this.keys(h)},ze.prototype.firstKey=function(h){return this.limit(1).keys(function(g){return g[0]}).then(h)},ze.prototype.lastKey=function(h){return this.reverse().firstKey(h)},ze.prototype.distinct=function(){var h=this._ctx,h=h.index&&h.table.schema.idxByName[h.index];if(!h||!h.multi)return this;var g={};return Lt(this._ctx,function(k){var T=k.primaryKey.toString(),k=Ur(g,T);return g[T]=!0,!k}),this},ze.prototype.modify=function(h){var g=this,b=this._ctx;return this._write(function(T){var k,R,K;K=typeof h=="function"?h:(k=l(h),R=k.length,function(ot){for(var yt=!1,It=0;It<R;++It){var Pt=k[It],Dt=h[Pt],$t=Rn(ot,Pt);Dt instanceof Ft?(Wr(ot,Pt,Dt.execute($t)),yt=!0):$t!==Dt&&(Wr(ot,Pt,Dt),yt=!0)}return yt});var et=b.table.core,it=et.schema.primaryKey,lt=it.outbound,ht=it.extractKey,gt=200,it=g.db._options.modifyChunkSize;it&&(gt=typeof it=="object"?it[et.name]||it["*"]||200:it);function ft(ot,Pt){var It=Pt.failures,Pt=Pt.numFailures;dt+=ot-Pt;for(var Dt=0,$t=l(It);Dt<$t.length;Dt++){var he=$t[Dt];pt.push(It[he])}}var pt=[],dt=0,_t=[];return g.clone().primaryKeys().then(function(ot){function yt(Pt){var Dt=Math.min(gt,ot.length-Pt);return et.getMany({trans:T,keys:ot.slice(Pt,Pt+Dt),cache:"immutable"}).then(function($t){for(var he=[],ee=[],re=lt?[]:null,fe=[],ne=0;ne<Dt;++ne){var ae=$t[ne],$e={value:wr(ae),primKey:ot[Pt+ne]};K.call($e,$e.value,$e)!==!1&&($e.value==null?fe.push(ot[Pt+ne]):lt||E(ht(ae),ht($e.value))===0?(ee.push($e.value),lt&&re.push(ot[Pt+ne])):(fe.push(ot[Pt+ne]),he.push($e.value)))}return Promise.resolve(0<he.length&&et.mutate({trans:T,type:"add",values:he}).then(function(cr){for(var Ae in cr.failures)fe.splice(parseInt(Ae),1);ft(he.length,cr)})).then(function(){return(0<ee.length||It&&typeof h=="object")&&et.mutate({trans:T,type:"put",keys:re,values:ee,criteria:It,changeSpec:typeof h!="function"&&h,isAdditionalChunk:0<Pt}).then(function(cr){return ft(ee.length,cr)})}).then(function(){return(0<fe.length||It&&h===Fr)&&et.mutate({trans:T,type:"delete",keys:fe,criteria:It,isAdditionalChunk:0<Pt}).then(function(cr){return ft(fe.length,cr)})}).then(function(){return ot.length>Pt+Dt&&yt(Pt+gt)})})}var It=Vt(b)&&b.limit===1/0&&(typeof h!="function"||h===Fr)&&{index:b.index,range:b.range};return yt(0).then(function(){if(0<pt.length)throw new gi("Error modifying one or more objects",pt,dt,_t);return ot.length})})})},ze.prototype.delete=function(){var h=this._ctx,g=h.range;return Vt(h)&&(h.isPrimKey||g.type===3)?this._write(function(b){var T=h.table.core.schema.primaryKey,k=g;return h.table.core.count({trans:b,query:{index:T,range:k}}).then(function(R){return h.table.core.mutate({trans:b,type:"deleteRange",range:k}).then(function(K){var et=K.failures;if(K.lastResult,K.results,K=K.numFailures,K)throw new gi("Could not delete some values",Object.keys(et).map(function(lt){return et[lt]}),R-K);return R-K})})}):this.modify(Fr)},ze);function ze(){}var Fr=function(h,g){return g.value=null};function Ri(h,g){return h<g?-1:h===g?0:1}function qa(h,g){return g<h?-1:h===g?0:1}function nn(h,g,b){return h=h instanceof ls?new h.Collection(h):h,h._ctx.error=new(b||TypeError)(g),h}function Oo(h){return new h.Collection(h,function(){return Ls("")}).limit(0)}function Za(h,g,b,T){var k,R,K,et,lt,ht,gt,it=b.length;if(!b.every(function(dt){return typeof dt=="string"}))return nn(h,er);function ft(dt){k=dt==="next"?function(ot){return ot.toUpperCase()}:function(ot){return ot.toLowerCase()},R=dt==="next"?function(ot){return ot.toLowerCase()}:function(ot){return ot.toUpperCase()},K=dt==="next"?Ri:qa;var _t=b.map(function(ot){return{lower:R(ot),upper:k(ot)}}).sort(function(ot,yt){return K(ot.lower,yt.lower)});et=_t.map(function(ot){return ot.upper}),lt=_t.map(function(ot){return ot.lower}),gt=(ht=dt)==="next"?"":T}ft("next"),h=new h.Collection(h,function(){return yo(et[0],lt[it-1]+T)}),h._ondirectionchange=function(dt){ft(dt)};var pt=0;return h._addAlgorithm(function(dt,_t,ot){var yt=dt.key;if(typeof yt!="string")return!1;var It=R(yt);if(g(It,lt,pt))return!0;for(var Pt=null,Dt=pt;Dt<it;++Dt){var $t=function(he,ee,re,fe,ne,ae){for(var $e=Math.min(he.length,fe.length),cr=-1,Ae=0;Ae<$e;++Ae){var Qt=ee[Ae];if(Qt!==fe[Ae])return ne(he[Ae],re[Ae])<0?he.substr(0,Ae)+re[Ae]+re.substr(Ae+1):ne(he[Ae],fe[Ae])<0?he.substr(0,Ae)+fe[Ae]+re.substr(Ae+1):0<=cr?he.substr(0,cr)+ee[cr]+re.substr(cr+1):null;ne(he[Ae],Qt)<0&&(cr=Ae)}return $e<fe.length&&ae==="next"?he+re.substr(he.length):$e<he.length&&ae==="prev"?he.substr(0,re.length):cr<0?null:he.substr(0,cr)+fe[cr]+re.substr(cr+1)}(yt,It,et[Dt],lt[Dt],K,ht);$t===null&&Pt===null?pt=Dt+1:(Pt===null||0<K(Pt,$t))&&(Pt=$t)}return _t(Pt!==null?function(){dt.continue(Pt+gt)}:ot),!1}),h}function yo(h,g,b,T){return{type:2,lower:h,upper:g,lowerOpen:b,upperOpen:T}}function Ls(h){return{type:1,lower:h,upper:h}}var ls=(Object.defineProperty(wn.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),wn.prototype.between=function(h,g,b,T){b=b!==!1,T=T===!0;try{return 0<this._cmp(h,g)||this._cmp(h,g)===0&&(b||T)&&(!b||!T)?Oo(this):new this.Collection(this,function(){return yo(h,g,!b,!T)})}catch{return nn(this,He)}},wn.prototype.equals=function(h){return h==null?nn(this,He):new this.Collection(this,function(){return Ls(h)})},wn.prototype.above=function(h){return h==null?nn(this,He):new this.Collection(this,function(){return yo(h,void 0,!0)})},wn.prototype.aboveOrEqual=function(h){return h==null?nn(this,He):new this.Collection(this,function(){return yo(h,void 0,!1)})},wn.prototype.below=function(h){return h==null?nn(this,He):new this.Collection(this,function(){return yo(void 0,h,!1,!0)})},wn.prototype.belowOrEqual=function(h){return h==null?nn(this,He):new this.Collection(this,function(){return yo(void 0,h)})},wn.prototype.startsWith=function(h){return typeof h!="string"?nn(this,er):this.between(h,h+Ne,!0,!0)},wn.prototype.startsWithIgnoreCase=function(h){return h===""?this.startsWith(h):Za(this,function(g,b){return g.indexOf(b[0])===0},[h],Ne)},wn.prototype.equalsIgnoreCase=function(h){return Za(this,function(g,b){return g===b[0]},[h],"")},wn.prototype.anyOfIgnoreCase=function(){var h=Cn.apply(yi,arguments);return h.length===0?Oo(this):Za(this,function(g,b){return b.indexOf(g)!==-1},h,"")},wn.prototype.startsWithAnyOfIgnoreCase=function(){var h=Cn.apply(yi,arguments);return h.length===0?Oo(this):Za(this,function(g,b){return b.some(function(T){return g.indexOf(T)===0})},h,Ne)},wn.prototype.anyOf=function(){var h=this,g=Cn.apply(yi,arguments),b=this._cmp;try{g.sort(b)}catch{return nn(this,He)}if(g.length===0)return Oo(this);var T=new this.Collection(this,function(){return yo(g[0],g[g.length-1])});T._ondirectionchange=function(R){b=R==="next"?h._ascending:h._descending,g.sort(b)};var k=0;return T._addAlgorithm(function(R,K,et){for(var lt=R.key;0<b(lt,g[k]);)if(++k===g.length)return K(et),!1;return b(lt,g[k])===0||(K(function(){R.continue(g[k])}),!1)}),T},wn.prototype.notEqual=function(h){return this.inAnyRange([[-1/0,h],[h,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},wn.prototype.noneOf=function(){var h=Cn.apply(yi,arguments);if(h.length===0)return new this.Collection(this);try{h.sort(this._ascending)}catch{return nn(this,He)}var g=h.reduce(function(b,T){return b?b.concat([[b[b.length-1][1],T]]):[[-1/0,T]]},null);return g.push([h[h.length-1],this.db._maxKey]),this.inAnyRange(g,{includeLowers:!1,includeUppers:!1})},wn.prototype.inAnyRange=function(yt,g){var b=this,T=this._cmp,k=this._ascending,R=this._descending,K=this._min,et=this._max;if(yt.length===0)return Oo(this);if(!yt.every(function(It){return It[0]!==void 0&&It[1]!==void 0&&k(It[0],It[1])<=0}))return nn(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",Kt.InvalidArgument);var lt=!g||g.includeLowers!==!1,ht=g&&g.includeUppers===!0,gt,it=k;function ft(It,Pt){return it(It[0],Pt[0])}try{(gt=yt.reduce(function(It,Pt){for(var Dt=0,$t=It.length;Dt<$t;++Dt){var he=It[Dt];if(T(Pt[0],he[1])<0&&0<T(Pt[1],he[0])){he[0]=K(he[0],Pt[0]),he[1]=et(he[1],Pt[1]);break}}return Dt===$t&&It.push(Pt),It},[])).sort(ft)}catch{return nn(this,He)}var pt=0,dt=ht?function(It){return 0<k(It,gt[pt][1])}:function(It){return 0<=k(It,gt[pt][1])},_t=lt?function(It){return 0<R(It,gt[pt][0])}:function(It){return 0<=R(It,gt[pt][0])},ot=dt,yt=new this.Collection(this,function(){return yo(gt[0][0],gt[gt.length-1][1],!lt,!ht)});return yt._ondirectionchange=function(It){it=It==="next"?(ot=dt,k):(ot=_t,R),gt.sort(ft)},yt._addAlgorithm(function(It,Pt,Dt){for(var $t,he=It.key;ot(he);)if(++pt===gt.length)return Pt(Dt),!1;return!dt($t=he)&&!_t($t)||(b._cmp(he,gt[pt][1])===0||b._cmp(he,gt[pt][0])===0||Pt(function(){it===k?It.continue(gt[pt][0]):It.continue(gt[pt][1])}),!1)}),yt},wn.prototype.startsWithAnyOf=function(){var h=Cn.apply(yi,arguments);return h.every(function(g){return typeof g=="string"})?h.length===0?Oo(this):this.inAnyRange(h.map(function(g){return[g,g+Ne]})):nn(this,"startsWithAnyOf() only works with strings")},wn);function wn(){}function $n(h){return $(function(g){return Wo(g),h(g.target.error),!1})}function Wo(h){h.stopPropagation&&h.stopPropagation(),h.preventDefault&&h.preventDefault()}var go="storagemutated",Ga="x-storagemutated-1",Ki=Nt(null,go),Bi=(Fn.prototype._lock=function(){return Lr(!xe.global),++this._reculock,this._reculock!==1||xe.global||(xe.lockOwnerFor=this),this},Fn.prototype._unlock=function(){if(Lr(!xe.global),--this._reculock==0)for(xe.global||(xe.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var h=this._blockedFuncs.shift();try{Re(h[1],h[0])}catch{}}return this},Fn.prototype._locked=function(){return this._reculock&&xe.lockOwnerFor!==this},Fn.prototype.create=function(h){var g=this;if(!this.mode)return this;var b=this.db.idbdb,T=this.db._state.dbOpenError;if(Lr(!this.idbtrans),!h&&!b)switch(T&&T.name){case"DatabaseClosedError":throw new Kt.DatabaseClosed(T);case"MissingAPIError":throw new Kt.MissingAPI(T.message,T);default:throw new Kt.OpenFailed(T)}if(!this.active)throw new Kt.TransactionInactive;return Lr(this._completion._state===null),(h=this.idbtrans=h||(this.db.core||b).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=$(function(k){Wo(k),g._reject(h.error)}),h.onabort=$(function(k){Wo(k),g.active&&g._reject(new Kt.Abort(h.error)),g.active=!1,g.on("abort").fire(k)}),h.oncomplete=$(function(){g.active=!1,g._resolve(),"mutatedParts"in h&&Ki.storagemutated.fire(h.mutatedParts)}),this},Fn.prototype._promise=function(h,g,b){var T=this;if(h==="readwrite"&&this.mode!=="readwrite")return Fe(new Kt.ReadOnly("Transaction is readonly"));if(!this.active)return Fe(new Kt.TransactionInactive);if(this._locked())return new pe(function(R,K){T._blockedFuncs.push([function(){T._promise(h,g,b).then(R,K)},xe])});if(b)return kt(function(){var R=new pe(function(K,et){T._lock();var lt=g(K,et,T);lt&&lt.then&&lt.then(K,et)});return R.finally(function(){return T._unlock()}),R._lib=!0,R});var k=new pe(function(R,K){var et=g(R,K,T);et&&et.then&&et.then(R,K)});return k._lib=!0,k},Fn.prototype._root=function(){return this.parent?this.parent._root():this},Fn.prototype.waitFor=function(h){var g,b=this._root(),T=pe.resolve(h);b._waitingFor?b._waitingFor=b._waitingFor.then(function(){return T}):(b._waitingFor=T,b._waitingQueue=[],g=b.idbtrans.objectStore(b.storeNames[0]),function R(){for(++b._spinCount;b._waitingQueue.length;)b._waitingQueue.shift()();b._waitingFor&&(g.get(-1/0).onsuccess=R)}());var k=b._waitingFor;return new pe(function(R,K){T.then(function(et){return b._waitingQueue.push($(R.bind(null,et)))},function(et){return b._waitingQueue.push($(K.bind(null,et)))}).finally(function(){b._waitingFor===k&&(b._waitingFor=null)})})},Fn.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new Kt.Abort))},Fn.prototype.table=function(h){var g=this._memoizedTables||(this._memoizedTables={});if(Ur(g,h))return g[h];var b=this.schema[h];if(!b)throw new Kt.NotFound("Table "+h+" not part of transaction");return b=new this.db.Table(h,b,this),b.core=this.db.core.table(h),g[h]=b},Fn);function Fn(){}function Qi(h,g,b,T,k,R,K){return{name:h,keyPath:g,unique:b,multi:T,auto:k,compound:R,src:(b&&!K?"&":"")+(T?"*":"")+(k?"++":"")+Ro(g)}}function Ro(h){return typeof h=="string"?h:h?"["+[].join.call(h,"+")+"]":""}function to(h,g,b){return{name:h,primKey:g,indexes:b,mappedClass:null,idxByName:(T=function(k){return[k.name,k]},b.reduce(function(k,R,K){return K=T(R,K),K&&(k[K[0]]=K[1]),k},{}))};var T}var Fi=function(h){try{return h.only([[]]),Fi=function(){return[[]]},[[]]}catch{return Fi=function(){return Ne},Ne}};function na(h){return h==null?function(){}:typeof h=="string"?(g=h).split(".").length===1?function(b){return b[g]}:function(b){return Rn(b,g)}:function(b){return Rn(b,h)};var g}function Qn(h){return[].slice.call(h)}var Hr=0;function eo(h){return h==null?":id":typeof h=="string"?h:"[".concat(h.join("+"),"]")}function Os(h,g,lt){function T(ot){if(ot.type===3)return null;if(ot.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var pt=ot.lower,dt=ot.upper,_t=ot.lowerOpen,ot=ot.upperOpen;return pt===void 0?dt===void 0?null:g.upperBound(dt,!!ot):dt===void 0?g.lowerBound(pt,!!_t):g.bound(pt,dt,!!_t,!!ot)}function k(ft){var pt,dt=ft.name;return{name:dt,schema:ft,mutate:function(_t){var ot=_t.trans,yt=_t.type,It=_t.keys,Pt=_t.values,Dt=_t.range;return new Promise(function($t,he){$t=$($t);var ee=ot.objectStore(dt),re=ee.keyPath==null,fe=yt==="put"||yt==="add";if(!fe&&yt!=="delete"&&yt!=="deleteRange")throw new Error("Invalid operation type: "+yt);var ne,ae=(It||Pt||{length:1}).length;if(It&&Pt&&It.length!==Pt.length)throw new Error("Given keys array must have same length as given values array.");if(ae===0)return $t({numFailures:0,failures:{},results:[],lastResult:void 0});function $e(zr){++Qt,Wo(zr)}var cr=[],Ae=[],Qt=0;if(yt==="deleteRange"){if(Dt.type===4)return $t({numFailures:Qt,failures:Ae,results:[],lastResult:void 0});Dt.type===3?cr.push(ne=ee.clear()):cr.push(ne=ee.delete(T(Dt)))}else{var re=fe?re?[Pt,It]:[Pt,null]:[It,null],De=re[0],En=re[1];if(fe)for(var an=0;an<ae;++an)cr.push(ne=En&&En[an]!==void 0?ee[yt](De[an],En[an]):ee[yt](De[an])),ne.onerror=$e;else for(an=0;an<ae;++an)cr.push(ne=ee[yt](De[an])),ne.onerror=$e}function si(zr){zr=zr.target.result,cr.forEach(function(Co,Ht){return Co.error!=null&&(Ae[Ht]=Co.error)}),$t({numFailures:Qt,failures:Ae,results:yt==="delete"?It:cr.map(function(Co){return Co.result}),lastResult:zr})}ne.onerror=function(zr){$e(zr),si(zr)},ne.onsuccess=si})},getMany:function(_t){var ot=_t.trans,yt=_t.keys;return new Promise(function(It,Pt){It=$(It);for(var Dt,$t=ot.objectStore(dt),he=yt.length,ee=new Array(he),re=0,fe=0,ne=function(cr){cr=cr.target,ee[cr._pos]=cr.result,++fe===re&&It(ee)},ae=$n(Pt),$e=0;$e<he;++$e)yt[$e]!=null&&((Dt=$t.get(yt[$e]))._pos=$e,Dt.onsuccess=ne,Dt.onerror=ae,++re);re===0&&It(ee)})},get:function(_t){var ot=_t.trans,yt=_t.key;return new Promise(function(It,Pt){It=$(It);var Dt=ot.objectStore(dt).get(yt);Dt.onsuccess=function($t){return It($t.target.result)},Dt.onerror=$n(Pt)})},query:(pt=ht,function(_t){return new Promise(function(ot,yt){ot=$(ot);var It,Pt,Dt,re=_t.trans,$t=_t.values,he=_t.limit,ne=_t.query,ee=he===1/0?void 0:he,fe=ne.index,ne=ne.range,re=re.objectStore(dt),fe=fe.isPrimaryKey?re:re.index(fe.name),ne=T(ne);if(he===0)return ot({result:[]});pt?((ee=$t?fe.getAll(ne,ee):fe.getAllKeys(ne,ee)).onsuccess=function(ae){return ot({result:ae.target.result})},ee.onerror=$n(yt)):(It=0,Pt=!$t&&"openKeyCursor"in fe?fe.openKeyCursor(ne):fe.openCursor(ne),Dt=[],Pt.onsuccess=function(ae){var $e=Pt.result;return $e?(Dt.push($t?$e.value:$e.primaryKey),++It===he?ot({result:Dt}):void $e.continue()):ot({result:Dt})},Pt.onerror=$n(yt))})}),openCursor:function(_t){var ot=_t.trans,yt=_t.values,It=_t.query,Pt=_t.reverse,Dt=_t.unique;return new Promise(function($t,he){$t=$($t);var fe=It.index,ee=It.range,re=ot.objectStore(dt),re=fe.isPrimaryKey?re:re.index(fe.name),fe=Pt?Dt?"prevunique":"prev":Dt?"nextunique":"next",ne=!yt&&"openKeyCursor"in re?re.openKeyCursor(T(ee),fe):re.openCursor(T(ee),fe);ne.onerror=$n(he),ne.onsuccess=$(function(ae){var $e,cr,Ae,Qt,De=ne.result;De?(De.___id=++Hr,De.done=!1,$e=De.continue.bind(De),cr=(cr=De.continuePrimaryKey)&&cr.bind(De),Ae=De.advance.bind(De),Qt=function(){throw new Error("Cursor not stopped")},De.trans=ot,De.stop=De.continue=De.continuePrimaryKey=De.advance=function(){throw new Error("Cursor not started")},De.fail=$(he),De.next=function(){var En=this,an=1;return this.start(function(){return an--?En.continue():En.stop()}).then(function(){return En})},De.start=function(En){function an(){if(ne.result)try{En()}catch(zr){De.fail(zr)}else De.done=!0,De.start=function(){throw new Error("Cursor behind last entry")},De.stop()}var si=new Promise(function(zr,Co){zr=$(zr),ne.onerror=$n(Co),De.fail=Co,De.stop=function(Ht){De.stop=De.continue=De.continuePrimaryKey=De.advance=Qt,zr(Ht)}});return ne.onsuccess=$(function(zr){ne.onsuccess=an,an()}),De.continue=$e,De.continuePrimaryKey=cr,De.advance=Ae,an(),si},$t(De)):$t(null)},he)})},count:function(_t){var ot=_t.query,yt=_t.trans,It=ot.index,Pt=ot.range;return new Promise(function(Dt,$t){var he=yt.objectStore(dt),ee=It.isPrimaryKey?he:he.index(It.name),he=T(Pt),ee=he?ee.count(he):ee.count();ee.onsuccess=$(function(re){return Dt(re.target.result)}),ee.onerror=$n($t)})}}}var R,K,et,gt=(K=lt,et=Qn((R=h).objectStoreNames),{schema:{name:R.name,tables:et.map(function(ft){return K.objectStore(ft)}).map(function(ft){var pt=ft.keyPath,ot=ft.autoIncrement,dt=sr(pt),_t={},ot={name:ft.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:pt==null,compound:dt,keyPath:pt,autoIncrement:ot,unique:!0,extractKey:na(pt)},indexes:Qn(ft.indexNames).map(function(yt){return ft.index(yt)}).map(function(Dt){var It=Dt.name,Pt=Dt.unique,$t=Dt.multiEntry,Dt=Dt.keyPath,$t={name:It,compound:sr(Dt),keyPath:Dt,unique:Pt,multiEntry:$t,extractKey:na(Dt)};return _t[eo(Dt)]=$t}),getIndexByKeyPath:function(yt){return _t[eo(yt)]}};return _t[":id"]=ot.primaryKey,pt!=null&&(_t[eo(pt)]=ot.primaryKey),ot})},hasGetAll:0<et.length&&"getAll"in K.objectStore(et[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),lt=gt.schema,ht=gt.hasGetAll,gt=lt.tables.map(k),it={};return gt.forEach(function(ft){return it[ft.name]=ft}),{stack:"dbcore",transaction:h.transaction.bind(h),table:function(ft){if(!it[ft])throw new Error("Table '".concat(ft,"' not found"));return it[ft]},MIN_KEY:-1/0,MAX_KEY:Fi(g),schema:lt}}function Iu(h,g,b,T){var k=b.IDBKeyRange;return b.indexedDB,{dbcore:(T=Os(g,k,T),h.dbcore.reduce(function(R,K){return K=K.create,je(je({},R),K(R))},T))}}function Ka(h,T){var b=T.db,T=Iu(h._middlewares,b,h._deps,T);h.core=T.dbcore,h.tables.forEach(function(k){var R=k.name;h.core.schema.tables.some(function(K){return K.name===R})&&(k.core=h.core.table(R),h[R]instanceof h.Table&&(h[R].core=k.core))})}function ia(h,g,b,T){b.forEach(function(k){var R=T[k];g.forEach(function(K){var et=function lt(ht,gt){return ve(ht,gt)||(ht=Br(ht))&&lt(ht,gt)}(K,k);(!et||"value"in et&&et.value===void 0)&&(K===h.Transaction.prototype||K instanceof h.Transaction?rr(K,k,{get:function(){return this.table(k)},set:function(lt){On(this,k,{value:lt,writable:!0,configurable:!0,enumerable:!0})}}):K[k]=new h.Table(k,R))})})}function Ea(h,g){g.forEach(function(b){for(var T in b)b[T]instanceof h.Table&&delete b[T]})}function cs(h,g){return h._cfg.version-g._cfg.version}function ps(h,g,b,T){var k=h._dbSchema;b.objectStoreNames.contains("$meta")&&!k.$meta&&(k.$meta=to("$meta",Wa("")[0],[]),h._storeNames.push("$meta"));var R=h._createTransaction("readwrite",h._storeNames,k);R.create(b),R._completion.catch(T);var K=R._reject.bind(R),et=xe.transless||xe;kt(function(){return xe.trans=R,xe.transless=et,g!==0?(Ka(h,b),ht=g,((lt=R).storeNames.includes("$meta")?lt.table("$meta").get("version").then(function(gt){return gt??ht}):pe.resolve(ht)).then(function(gt){return ft=gt,pt=R,dt=b,_t=[],gt=(it=h)._versions,ot=it._dbSchema=Sa(0,it.idbdb,dt),(gt=gt.filter(function(yt){return yt._cfg.version>=ft})).length!==0?(gt.forEach(function(yt){_t.push(function(){var It=ot,Pt=yt._cfg.dbschema;on(it,It,dt),on(it,Pt,dt),ot=it._dbSchema=Pt;var Dt=Xa(It,Pt);Dt.add.forEach(function(fe){hs(dt,fe[0],fe[1].primKey,fe[1].indexes)}),Dt.change.forEach(function(fe){if(fe.recreate)throw new Kt.Upgrade("Not yet support for changing primary key");var ne=dt.objectStore(fe.name);fe.add.forEach(function(ae){return Bo(ne,ae)}),fe.change.forEach(function(ae){ne.deleteIndex(ae.name),Bo(ne,ae)}),fe.del.forEach(function(ae){return ne.deleteIndex(ae)})});var $t=yt._cfg.contentUpgrade;if($t&&yt._cfg.version>ft){Ka(it,dt),pt._memoizedTables={};var he=Ai(Pt);Dt.del.forEach(function(fe){he[fe]=It[fe]}),Ea(it,[it.Transaction.prototype]),ia(it,[it.Transaction.prototype],l(he),he),pt.schema=he;var ee,re=Wn($t);return re&&oe(),Dt=pe.follow(function(){var fe;(ee=$t(pt))&&re&&(fe=Wt.bind(null,null),ee.then(fe,fe))}),ee&&typeof ee.then=="function"?pe.resolve(ee):Dt.then(function(){return ee})}}),_t.push(function(It){var Pt,Dt,$t=yt._cfg.dbschema;Pt=$t,Dt=It,[].slice.call(Dt.db.objectStoreNames).forEach(function(he){return Pt[he]==null&&Dt.db.deleteObjectStore(he)}),Ea(it,[it.Transaction.prototype]),ia(it,[it.Transaction.prototype],it._storeNames,it._dbSchema),pt.schema=it._dbSchema}),_t.push(function(It){it.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(it.idbdb.version/10)===yt._cfg.version?(it.idbdb.deleteObjectStore("$meta"),delete it._dbSchema.$meta,it._storeNames=it._storeNames.filter(function(Pt){return Pt!=="$meta"})):It.objectStore("$meta").put(yt._cfg.version,"version"))})}),function yt(){return _t.length?pe.resolve(_t.shift()(pt.idbtrans)).then(yt):pe.resolve()}().then(function(){oa(ot,dt)})):pe.resolve();var it,ft,pt,dt,_t,ot}).catch(K)):(l(k).forEach(function(gt){hs(b,gt,k[gt].primKey,k[gt].indexes)}),Ka(h,b),void pe.follow(function(){return h.on.populate.fire(R)}).catch(K));var lt,ht})}function Rs(h,g){oa(h._dbSchema,g),g.db.version%10!=0||g.objectStoreNames.contains("$meta")||g.db.createObjectStore("$meta").add(Math.ceil(g.db.version/10-1),"version");var b=Sa(0,h.idbdb,g);on(h,h._dbSchema,g);for(var T=0,k=Xa(b,h._dbSchema).change;T<k.length;T++){var R=function(K){if(K.change.length||K.recreate)return console.warn("Unable to patch indexes of table ".concat(K.name," because it has changes on the type of index or primary key.")),{value:void 0};var et=g.objectStore(K.name);K.add.forEach(function(lt){An&&console.debug("Dexie upgrade patch: Creating missing index ".concat(K.name,".").concat(lt.src)),Bo(et,lt)})}(k[T]);if(typeof R=="object")return R.value}}function Xa(h,g){var b,T={del:[],add:[],change:[]};for(b in h)g[b]||T.del.push(b);for(b in g){var k=h[b],R=g[b];if(k){var K={name:b,def:R,recreate:!1,del:[],add:[],change:[]};if(""+(k.primKey.keyPath||"")!=""+(R.primKey.keyPath||"")||k.primKey.auto!==R.primKey.auto)K.recreate=!0,T.change.push(K);else{var et=k.idxByName,lt=R.idxByName,ht=void 0;for(ht in et)lt[ht]||K.del.push(ht);for(ht in lt){var gt=et[ht],it=lt[ht];gt?gt.src!==it.src&&K.change.push(it):K.add.push(it)}(0<K.del.length||0<K.add.length||0<K.change.length)&&T.change.push(K)}}else T.add.push([b,R])}return T}function hs(h,g,b,T){var k=h.db.createObjectStore(g,b.keyPath?{keyPath:b.keyPath,autoIncrement:b.auto}:{autoIncrement:b.auto});return T.forEach(function(R){return Bo(k,R)}),k}function oa(h,g){l(h).forEach(function(b){g.db.objectStoreNames.contains(b)||(An&&console.debug("Dexie: Creating missing table",b),hs(g,b,h[b].primKey,h[b].indexes))})}function Bo(h,g){h.createIndex(g.name,g.keyPath,{unique:g.unique,multiEntry:g.multi})}function Sa(h,g,b){var T={};return hr(g.objectStoreNames,0).forEach(function(k){for(var R=b.objectStore(k),K=Qi(Ro(ht=R.keyPath),ht||"",!0,!1,!!R.autoIncrement,ht&&typeof ht!="string",!0),et=[],lt=0;lt<R.indexNames.length;++lt){var gt=R.index(R.indexNames[lt]),ht=gt.keyPath,gt=Qi(gt.name,ht,!!gt.unique,!!gt.multiEntry,!1,ht&&typeof ht!="string",!1);et.push(gt)}T[k]=to(k,K,et)}),T}function on(h,g,b){for(var T=b.db.objectStoreNames,k=0;k<T.length;++k){var R=T[k],K=b.objectStore(R);h._hasGetAll="getAll"in K;for(var et=0;et<K.indexNames.length;++et){var lt=K.indexNames[et],ht=K.index(lt).keyPath,gt=typeof ht=="string"?ht:"["+hr(ht).join("+")+"]";!g[R]||(ht=g[R].idxByName[gt])&&(ht.name=lt,delete g[R].idxByName[gt],g[R].idxByName[lt]=ht)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&pn.WorkerGlobalScope&&pn instanceof pn.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(h._hasGetAll=!1)}function Wa(h){return h.split(",").map(function(g,b){var T=(g=g.trim()).replace(/([&*]|\+\+)/g,""),k=/^\[/.test(T)?T.match(/^\[(.*)\]$/)[1].split("+"):T;return Qi(T,k||null,/\&/.test(g),/\*/.test(g),/\+\+/.test(g),sr(k),b===0)})}var Fo=(Xi.prototype._parseStoresSpec=function(h,g){l(h).forEach(function(b){if(h[b]!==null){var T=Wa(h[b]),k=T.shift();if(k.unique=!0,k.multi)throw new Kt.Schema("Primary key cannot be multi-valued");T.forEach(function(R){if(R.auto)throw new Kt.Schema("Only primary key can be marked as autoIncrement (++)");if(!R.keyPath)throw new Kt.Schema("Index must have a name and cannot be an empty string")}),g[b]=to(b,k,T)}})},Xi.prototype.stores=function(b){var g=this.db;this._cfg.storesSource=this._cfg.storesSource?Ot(this._cfg.storesSource,b):b;var b=g._versions,T={},k={};return b.forEach(function(R){Ot(T,R._cfg.storesSource),k=R._cfg.dbschema={},R._parseStoresSpec(T,k)}),g._dbSchema=k,Ea(g,[g._allTables,g,g.Transaction.prototype]),ia(g,[g._allTables,g,g.Transaction.prototype,this._cfg.tables],l(k),k),g._storeNames=l(k),this},Xi.prototype.upgrade=function(h){return this._cfg.contentUpgrade=dn(this._cfg.contentUpgrade||qe,h),this},Xi);function Xi(){}function vo(h,g){var b=h._dbNamesDB;return b||(b=h._dbNamesDB=new ai(ur,{addons:[],indexedDB:h,IDBKeyRange:g})).version(1).stores({dbnames:"name"}),b.table("dbnames")}function _o(h){return h&&typeof h.databases=="function"}function ro(h){return kt(function(){return xe.letThrough=!0,h()})}function xo(h){return!("from"in h)}var Jr=function(h,g){if(!this){var b=new Jr;return h&&"d"in h&&Ot(b,h),b}Ot(this,arguments.length?{d:1,from:h,to:1<arguments.length?g:h}:{d:0})};function Ni(h,g,b){var T=E(g,b);if(!isNaN(T)){if(0<T)throw RangeError();if(xo(h))return Ot(h,{from:g,to:b,d:1});var k=h.l,T=h.r;if(E(b,h.from)<0)return k?Ni(k,g,b):h.l={from:g,to:b,d:1,l:null,r:null},Bs(h);if(0<E(g,h.to))return T?Ni(T,g,b):h.r={from:g,to:b,d:1,l:null,r:null},Bs(h);E(g,h.from)<0&&(h.from=g,h.l=null,h.d=T?T.d+1:1),0<E(b,h.to)&&(h.to=b,h.r=null,h.d=h.l?h.l.d+1:1),b=!h.r,k&&!h.l&&aa(h,k),T&&b&&aa(h,T)}}function aa(h,g){xo(g)||function b(T,lt){var R=lt.from,K=lt.to,et=lt.l,lt=lt.r;Ni(T,R,K),et&&b(T,et),lt&&b(T,lt)}(h,g)}function fs(h,g){var b=xr(g),T=b.next();if(T.done)return!1;for(var k=T.value,R=xr(h),K=R.next(k.from),et=K.value;!T.done&&!K.done;){if(E(et.from,k.to)<=0&&0<=E(et.to,k.from))return!0;E(k.from,et.from)<0?k=(T=b.next(et.from)).value:et=(K=R.next(k.from)).value}return!1}function xr(h){var g=xo(h)?null:{s:0,n:h};return{next:function(b){for(var T=0<arguments.length;g;)switch(g.s){case 0:if(g.s=1,T)for(;g.n.l&&E(b,g.n.from)<0;)g={up:g,n:g.n.l,s:1};else for(;g.n.l;)g={up:g,n:g.n.l,s:1};case 1:if(g.s=2,!T||E(b,g.n.to)<=0)return{value:g.n,done:!1};case 2:if(g.n.r){g.s=3,g={up:g,n:g.n.r,s:0};continue}case 3:g=g.up}return{done:!0}}}}function Bs(h){var g,b,T=(((g=h.r)===null||g===void 0?void 0:g.d)||0)-(((b=h.l)===null||b===void 0?void 0:b.d)||0),k=1<T?"r":T<-1?"l":"";k&&(g=k=="r"?"l":"r",b=je({},h),T=h[k],h.from=T.from,h.to=T.to,h[k]=T[k],b[k]=T[g],(h[g]=b).d=Ta(b)),h.d=Ta(h)}function Ta(b){var g=b.r,b=b.l;return(g?b?Math.max(g.d,b.d):g.d:b?b.d:0)+1}function Ia(h,g){return l(g).forEach(function(b){h[b]?aa(h[b],g[b]):h[b]=function T(k){var R,K,et={};for(R in k)Ur(k,R)&&(K=k[R],et[R]=!K||typeof K!="object"||ni.has(K.constructor)?K:T(K));return et}(g[b])}),h}function Ha(h,g){return h.all||g.all||Object.keys(h).some(function(b){return g[b]&&fs(g[b],h[b])})}Xt(Jr.prototype,(($r={add:function(h){return aa(this,h),this},addKey:function(h){return Ni(this,h,h),this},addKeys:function(h){var g=this;return h.forEach(function(b){return Ni(g,b,b)}),this},hasKey:function(h){var g=xr(this).next(h).value;return g&&E(g.from,h)<=0&&0<=E(g.to,h)}})[hn]=function(){return xr(this)},$r));var No={},Ja={},bo=!1;function Wi(h){Ia(Ja,h),bo||(bo=!0,setTimeout(function(){bo=!1,wo(Ja,!(Ja={}))},0))}function wo(h,g){g===void 0&&(g=!1);var b=new Set;if(h.all)for(var T=0,k=Object.values(No);T<k.length;T++)ds(K=k[T],h,b,g);else for(var R in h){var K,et=/^idb\:\/\/(.*)\/(.*)\//.exec(R);et&&(R=et[1],et=et[2],(K=No["idb://".concat(R,"/").concat(et)])&&ds(K,h,b,g))}b.forEach(function(lt){return lt()})}function ds(h,g,b,T){for(var k=[],R=0,K=Object.entries(h.queries.query);R<K.length;R++){for(var et=K[R],lt=et[0],ht=[],gt=0,it=et[1];gt<it.length;gt++){var ft=it[gt];Ha(g,ft.obsSet)?ft.subscribers.forEach(function(ot){return b.add(ot)}):T&&ht.push(ft)}T&&k.push([lt,ht])}if(T)for(var pt=0,dt=k;pt<dt.length;pt++){var _t=dt[pt],lt=_t[0],ht=_t[1];h.queries.query[lt]=ht}}function Fs(h){var g=h._state,b=h._deps.indexedDB;if(g.isBeingOpened||h.idbdb)return g.dbReadyPromise.then(function(){return g.dbOpenError?Fe(g.dbOpenError):h});g.isBeingOpened=!0,g.dbOpenError=null,g.openComplete=!1;var T=g.openCanceller,k=Math.round(10*h.verno),R=!1;function K(){if(g.openCanceller!==T)throw new Kt.DatabaseClosed("db.open() was cancelled")}function et(){return new pe(function(ft,pt){if(K(),!b)throw new Kt.MissingAPI;var dt=h.name,_t=g.autoSchema||!k?b.open(dt):b.open(dt,k);if(!_t)throw new Kt.MissingAPI;_t.onerror=$n(pt),_t.onblocked=$(h._fireOnBlocked),_t.onupgradeneeded=$(function(ot){var yt;gt=_t.transaction,g.autoSchema&&!h._options.allowEmptyDB?(_t.onerror=Wo,gt.abort(),_t.result.close(),(yt=b.deleteDatabase(dt)).onsuccess=yt.onerror=$(function(){pt(new Kt.NoSuchDatabase("Database ".concat(dt," doesnt exist")))})):(gt.onerror=$n(pt),ot=ot.oldVersion>Math.pow(2,62)?0:ot.oldVersion,it=ot<1,h.idbdb=_t.result,R&&Rs(h,gt),ps(h,ot/10,gt,pt))},pt),_t.onsuccess=$(function(){gt=null;var ot,yt,It,Pt,Dt,$t=h.idbdb=_t.result,he=hr($t.objectStoreNames);if(0<he.length)try{var ee=$t.transaction((Pt=he).length===1?Pt[0]:Pt,"readonly");if(g.autoSchema)yt=$t,It=ee,(ot=h).verno=yt.version/10,It=ot._dbSchema=Sa(0,yt,It),ot._storeNames=hr(yt.objectStoreNames,0),ia(ot,[ot._allTables],l(It),It);else if(on(h,h._dbSchema,ee),((Dt=Xa(Sa(0,(Dt=h).idbdb,ee),Dt._dbSchema)).add.length||Dt.change.some(function(re){return re.add.length||re.change.length}))&&!R)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),$t.close(),k=$t.version+1,R=!0,ft(et());Ka(h,ee)}catch{}Zr.push(h),$t.onversionchange=$(function(re){g.vcFired=!0,h.on("versionchange").fire(re)}),$t.onclose=$(function(re){h.on("close").fire(re)}),it&&(Dt=h._deps,ee=dt,$t=Dt.indexedDB,Dt=Dt.IDBKeyRange,_o($t)||ee===ur||vo($t,Dt).put({name:ee}).catch(qe)),ft()},pt)}).catch(function(ft){switch(ft==null?void 0:ft.name){case"UnknownError":if(0<g.PR1398_maxLoop)return g.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),et();break;case"VersionError":if(0<k)return k=0,et()}return pe.reject(ft)})}var lt,ht=g.dbReadyResolve,gt=null,it=!1;return pe.race([T,(typeof navigator>"u"?pe.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(ft){function pt(){return indexedDB.databases().finally(ft)}lt=setInterval(pt,100),pt()}).finally(function(){return clearInterval(lt)}):Promise.resolve()).then(et)]).then(function(){return K(),g.onReadyBeingFired=[],pe.resolve(ro(function(){return h.on.ready.fire(h.vip)})).then(function ft(){if(0<g.onReadyBeingFired.length){var pt=g.onReadyBeingFired.reduce(dn,qe);return g.onReadyBeingFired=[],pe.resolve(ro(function(){return pt(h.vip)})).then(ft)}})}).finally(function(){g.openCanceller===T&&(g.onReadyBeingFired=null,g.isBeingOpened=!1)}).catch(function(ft){g.dbOpenError=ft;try{gt&&gt.abort()}catch{}return T===g.openCanceller&&h._close(),Fe(ft)}).finally(function(){g.openComplete=!0,ht()}).then(function(){var ft;return it&&(ft={},h.tables.forEach(function(pt){pt.schema.indexes.forEach(function(dt){dt.name&&(ft["idb://".concat(h.name,"/").concat(pt.name,"/").concat(dt.name)]=new Jr(-1/0,[[[]]]))}),ft["idb://".concat(h.name,"/").concat(pt.name,"/")]=ft["idb://".concat(h.name,"/").concat(pt.name,"/:dels")]=new Jr(-1/0,[[[]]])}),Ki(go).fire(ft),wo(ft,!0)),h})}function Ca(h){function g(R){return h.next(R)}var b=k(g),T=k(function(R){return h.throw(R)});function k(R){return function(lt){var et=R(lt),lt=et.value;return et.done?lt:lt&&typeof lt.then=="function"?lt.then(b,T):sr(lt)?Promise.all(lt).then(b,T):b(lt)}}return k(g)()}function no(h,g,b){for(var T=sr(h)?h.slice():[h],k=0;k<b;++k)T.push(g);return T}var Ns={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(h){return je(je({},h),{table:function(g){var b=h.table(g),T=b.schema,k={},R=[];function K(it,ft,pt){var dt=eo(it),_t=k[dt]=k[dt]||[],ot=it==null?0:typeof it=="string"?1:it.length,yt=0<ft,yt=je(je({},pt),{name:yt?"".concat(dt,"(virtual-from:").concat(pt.name,")"):pt.name,lowLevelIndex:pt,isVirtual:yt,keyTail:ft,keyLength:ot,extractKey:na(it),unique:!yt&&pt.unique});return _t.push(yt),yt.isPrimaryKey||R.push(yt),1<ot&&K(ot===2?it[0]:it.slice(0,ot-1),ft+1,pt),_t.sort(function(It,Pt){return It.keyTail-Pt.keyTail}),yt}g=K(T.primaryKey.keyPath,0,T.primaryKey),k[":id"]=[g];for(var et=0,lt=T.indexes;et<lt.length;et++){var ht=lt[et];K(ht.keyPath,0,ht)}function gt(it){var ft,pt=it.query.index;return pt.isVirtual?je(je({},it),{query:{index:pt.lowLevelIndex,range:(ft=it.query.range,pt=pt.keyTail,{type:ft.type===1?2:ft.type,lower:no(ft.lower,ft.lowerOpen?h.MAX_KEY:h.MIN_KEY,pt),lowerOpen:!0,upper:no(ft.upper,ft.upperOpen?h.MIN_KEY:h.MAX_KEY,pt),upperOpen:!0})}}):it}return je(je({},b),{schema:je(je({},T),{primaryKey:g,indexes:R,getIndexByKeyPath:function(it){return(it=k[eo(it)])&&it[0]}}),count:function(it){return b.count(gt(it))},query:function(it){return b.query(gt(it))},openCursor:function(it){var ft=it.query.index,pt=ft.keyTail,dt=ft.isVirtual,_t=ft.keyLength;return dt?b.openCursor(gt(it)).then(function(yt){return yt&&ot(yt)}):b.openCursor(it);function ot(yt){return Object.create(yt,{continue:{value:function(It){It!=null?yt.continue(no(It,it.reverse?h.MAX_KEY:h.MIN_KEY,pt)):it.unique?yt.continue(yt.key.slice(0,_t).concat(it.reverse?h.MIN_KEY:h.MAX_KEY,pt)):yt.continue()}},continuePrimaryKey:{value:function(It,Pt){yt.continuePrimaryKey(no(It,h.MAX_KEY,pt),Pt)}},primaryKey:{get:function(){return yt.primaryKey}},key:{get:function(){var It=yt.key;return _t===1?It[0]:It.slice(0,_t)}},value:{get:function(){return yt.value}}})}}})}})}};function Eo(h,g,b,T){return b=b||{},T=T||"",l(h).forEach(function(k){var R,K,et;Ur(g,k)?(R=h[k],K=g[k],typeof R=="object"&&typeof K=="object"&&R&&K?(et=Lo(R))!==Lo(K)?b[T+k]=g[k]:et==="Object"?Eo(R,K,b,T+k+"."):R!==K&&(b[T+k]=g[k]):R!==K&&(b[T+k]=g[k])):b[T+k]=void 0}),l(g).forEach(function(k){Ur(h,k)||(b[T+k]=g[k])}),b}function So(h,g){return g.type==="delete"?g.keys:g.keys||g.values.map(h.extractKey)}var Us={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(h){return je(je({},h),{table:function(g){var b=h.table(g),T=b.schema.primaryKey;return je(je({},b),{mutate:function(k){var R=xe.trans,K=R.table(g).hook,et=K.deleting,lt=K.creating,ht=K.updating;switch(k.type){case"add":if(lt.fire===qe)break;return R._promise("readwrite",function(){return gt(k)},!0);case"put":if(lt.fire===qe&&ht.fire===qe)break;return R._promise("readwrite",function(){return gt(k)},!0);case"delete":if(et.fire===qe)break;return R._promise("readwrite",function(){return gt(k)},!0);case"deleteRange":if(et.fire===qe)break;return R._promise("readwrite",function(){return function it(ft,pt,dt){return b.query({trans:ft,values:!1,query:{index:T,range:pt},limit:dt}).then(function(_t){var ot=_t.result;return gt({type:"delete",keys:ot,trans:ft}).then(function(yt){return 0<yt.numFailures?Promise.reject(yt.failures[0]):ot.length<dt?{failures:[],numFailures:0,lastResult:void 0}:it(ft,je(je({},pt),{lower:ot[ot.length-1],lowerOpen:!0}),dt)})})}(k.trans,k.range,1e4)},!0)}return b.mutate(k);function gt(it){var ft,pt,dt,_t=xe.trans,ot=it.keys||So(T,it);if(!ot)throw new Error("Keys missing");return(it=it.type==="add"||it.type==="put"?je(je({},it),{keys:ot}):je({},it)).type!=="delete"&&(it.values=Do([],it.values,!0)),it.keys&&(it.keys=Do([],it.keys,!0)),ft=b,dt=ot,((pt=it).type==="add"?Promise.resolve([]):ft.getMany({trans:pt.trans,keys:dt,cache:"immutable"})).then(function(yt){var It=ot.map(function(Pt,Dt){var $t,he,ee,re=yt[Dt],fe={onerror:null,onsuccess:null};return it.type==="delete"?et.fire.call(fe,Pt,re,_t):it.type==="add"||re===void 0?($t=lt.fire.call(fe,Pt,it.values[Dt],_t),Pt==null&&$t!=null&&(it.keys[Dt]=Pt=$t,T.outbound||Wr(it.values[Dt],T.keyPath,Pt))):($t=Eo(re,it.values[Dt]),(he=ht.fire.call(fe,$t,Pt,re,_t))&&(ee=it.values[Dt],Object.keys(he).forEach(function(ne){Ur(ee,ne)?ee[ne]=he[ne]:Wr(ee,ne,he[ne])}))),fe});return b.mutate(it).then(function(Pt){for(var Dt=Pt.failures,$t=Pt.results,he=Pt.numFailures,Pt=Pt.lastResult,ee=0;ee<ot.length;++ee){var re=($t||ot)[ee],fe=It[ee];re==null?fe.onerror&&fe.onerror(Dt[ee]):fe.onsuccess&&fe.onsuccess(it.type==="put"&&yt[ee]?it.values[ee]:re)}return{failures:Dt,results:$t,numFailures:he,lastResult:Pt}}).catch(function(Pt){return It.forEach(function(Dt){return Dt.onerror&&Dt.onerror(Pt)}),Promise.reject(Pt)})})}}})}})}};function sa(h,g,b){try{if(!g||g.keys.length<h.length)return null;for(var T=[],k=0,R=0;k<g.keys.length&&R<h.length;++k)E(g.keys[k],h[R])===0&&(T.push(b?wr(g.values[k]):g.values[k]),++R);return T.length===h.length?T:null}catch{return null}}var Ar={stack:"dbcore",level:-1,create:function(h){return{table:function(g){var b=h.table(g);return je(je({},b),{getMany:function(T){if(!T.cache)return b.getMany(T);var k=sa(T.keys,T.trans._cache,T.cache==="clone");return k?pe.resolve(k):b.getMany(T).then(function(R){return T.trans._cache={keys:T.keys,values:T.cache==="clone"?wr(R):R},R})},mutate:function(T){return T.type!=="add"&&(T.trans._cache=null),b.mutate(T)}})}}}};function Aa(h,g){return h.trans.mode==="readonly"&&!!h.subscr&&!h.trans.explicit&&h.trans.db._options.cache!=="disabled"&&!g.schema.primaryKey.outbound}function Vs(h,g){switch(h){case"query":return g.values&&!g.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var ua={stack:"dbcore",level:0,name:"Observability",create:function(h){var g=h.schema.name,b=new Jr(h.MIN_KEY,h.MAX_KEY);return je(je({},h),{transaction:function(T,k,R){if(xe.subscr&&k!=="readonly")throw new Kt.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(xe.querier));return h.transaction(T,k,R)},table:function(T){var k=h.table(T),R=k.schema,K=R.primaryKey,it=R.indexes,et=K.extractKey,lt=K.outbound,ht=K.autoIncrement&&it.filter(function(pt){return pt.compound&&pt.keyPath.includes(K.keyPath)}),gt=je(je({},k),{mutate:function(pt){function dt(ne){return ne="idb://".concat(g,"/").concat(T,"/").concat(ne),Pt[ne]||(Pt[ne]=new Jr)}var _t,ot,yt,It=pt.trans,Pt=pt.mutatedParts||(pt.mutatedParts={}),Dt=dt(""),$t=dt(":dels"),he=pt.type,fe=pt.type==="deleteRange"?[pt.range]:pt.type==="delete"?[pt.keys]:pt.values.length<50?[So(K,pt).filter(function(ne){return ne}),pt.values]:[],ee=fe[0],re=fe[1],fe=pt.trans._cache;return sr(ee)?(Dt.addKeys(ee),(fe=he==="delete"||ee.length===re.length?sa(ee,fe):null)||$t.addKeys(ee),(fe||re)&&(_t=dt,ot=fe,yt=re,R.indexes.forEach(function(ne){var ae=_t(ne.name||"");function $e(Ae){return Ae!=null?ne.extractKey(Ae):null}function cr(Ae){return ne.multiEntry&&sr(Ae)?Ae.forEach(function(Qt){return ae.addKey(Qt)}):ae.addKey(Ae)}(ot||yt).forEach(function(Ae,En){var De=ot&&$e(ot[En]),En=yt&&$e(yt[En]);E(De,En)!==0&&(De!=null&&cr(De),En!=null&&cr(En))})}))):ee?(re={from:(re=ee.lower)!==null&&re!==void 0?re:h.MIN_KEY,to:(re=ee.upper)!==null&&re!==void 0?re:h.MAX_KEY},$t.add(re),Dt.add(re)):(Dt.add(b),$t.add(b),R.indexes.forEach(function(ne){return dt(ne.name).add(b)})),k.mutate(pt).then(function(ne){return!ee||pt.type!=="add"&&pt.type!=="put"||(Dt.addKeys(ne.results),ht&&ht.forEach(function(ae){for(var $e=pt.values.map(function(De){return ae.extractKey(De)}),cr=ae.keyPath.findIndex(function(De){return De===K.keyPath}),Ae=0,Qt=ne.results.length;Ae<Qt;++Ae)$e[Ae][cr]=ne.results[Ae];dt(ae.name).addKeys($e)})),It.mutatedParts=Ia(It.mutatedParts||{},Pt),ne})}}),it=function(dt){var _t=dt.query,dt=_t.index,_t=_t.range;return[dt,new Jr((dt=_t.lower)!==null&&dt!==void 0?dt:h.MIN_KEY,(_t=_t.upper)!==null&&_t!==void 0?_t:h.MAX_KEY)]},ft={get:function(pt){return[K,new Jr(pt.key)]},getMany:function(pt){return[K,new Jr().addKeys(pt.keys)]},count:it,query:it,openCursor:it};return l(ft).forEach(function(pt){gt[pt]=function(dt){var _t=xe.subscr,ot=!!_t,yt=Aa(xe,k)&&Vs(pt,dt)?dt.obsSet={}:_t;if(ot){var It=function(re){return re="idb://".concat(g,"/").concat(T,"/").concat(re),yt[re]||(yt[re]=new Jr)},Pt=It(""),Dt=It(":dels"),_t=ft[pt](dt),ot=_t[0],_t=_t[1];if((pt==="query"&&ot.isPrimaryKey&&!dt.values?Dt:It(ot.name||"")).add(_t),!ot.isPrimaryKey){if(pt!=="count"){var $t=pt==="query"&&lt&&dt.values&&k.query(je(je({},dt),{values:!1}));return k[pt].apply(this,arguments).then(function(re){if(pt==="query"){if(lt&&dt.values)return $t.then(function($e){return $e=$e.result,Pt.addKeys($e),re});var fe=dt.values?re.result.map(et):re.result;(dt.values?Pt:Dt).addKeys(fe)}else if(pt==="openCursor"){var ne=re,ae=dt.values;return ne&&Object.create(ne,{key:{get:function(){return Dt.addKey(ne.primaryKey),ne.key}},primaryKey:{get:function(){var $e=ne.primaryKey;return Dt.addKey($e),$e}},value:{get:function(){return ae&&Pt.addKey(ne.primaryKey),ne.value}}})}return re})}Dt.add(b)}}return k[pt].apply(this,arguments)}}),gt}})}};function ms(h,g,b){if(b.numFailures===0)return g;if(g.type==="deleteRange")return null;var T=g.keys?g.keys.length:"values"in g&&g.values?g.values.length:1;return b.numFailures===T?null:(g=je({},g),sr(g.keys)&&(g.keys=g.keys.filter(function(k,R){return!(R in b.failures)})),"values"in g&&sr(g.values)&&(g.values=g.values.filter(function(k,R){return!(R in b.failures)})),g)}function ys(h,g){return b=h,((T=g).lower===void 0||(T.lowerOpen?0<E(b,T.lower):0<=E(b,T.lower)))&&(h=h,(g=g).upper===void 0||(g.upperOpen?E(h,g.upper)<0:E(h,g.upper)<=0));var b,T}function gs(h,g,ft,T,k,R){if(!ft||ft.length===0)return h;var K=g.query.index,et=K.multiEntry,lt=g.query.range,ht=T.schema.primaryKey.extractKey,gt=K.extractKey,it=(K.lowLevelIndex||K).extractKey,ft=ft.reduce(function(pt,dt){var _t=pt,ot=[];if(dt.type==="add"||dt.type==="put")for(var yt=new Jr,It=dt.values.length-1;0<=It;--It){var Pt,Dt=dt.values[It],$t=ht(Dt);yt.hasKey($t)||(Pt=gt(Dt),(et&&sr(Pt)?Pt.some(function(ne){return ys(ne,lt)}):ys(Pt,lt))&&(yt.addKey($t),ot.push(Dt)))}switch(dt.type){case"add":var he=new Jr().addKeys(g.values?pt.map(function(ae){return ht(ae)}):pt),_t=pt.concat(g.values?ot.filter(function(ae){return ae=ht(ae),!he.hasKey(ae)&&(he.addKey(ae),!0)}):ot.map(function(ae){return ht(ae)}).filter(function(ae){return!he.hasKey(ae)&&(he.addKey(ae),!0)}));break;case"put":var ee=new Jr().addKeys(dt.values.map(function(ae){return ht(ae)}));_t=pt.filter(function(ae){return!ee.hasKey(g.values?ht(ae):ae)}).concat(g.values?ot:ot.map(function(ae){return ht(ae)}));break;case"delete":var re=new Jr().addKeys(dt.keys);_t=pt.filter(function(ae){return!re.hasKey(g.values?ht(ae):ae)});break;case"deleteRange":var fe=dt.range;_t=pt.filter(function(ae){return!ys(ht(ae),fe)})}return _t},h);return ft===h?h:(ft.sort(function(pt,dt){return E(it(pt),it(dt))||E(ht(pt),ht(dt))}),g.limit&&g.limit<1/0&&(ft.length>g.limit?ft.length=g.limit:h.length===g.limit&&ft.length<g.limit&&(k.dirty=!0)),R?Object.freeze(ft):ft)}function Pa(h,g){return E(h.lower,g.lower)===0&&E(h.upper,g.upper)===0&&!!h.lowerOpen==!!g.lowerOpen&&!!h.upperOpen==!!g.upperOpen}function la(h,g){return function(b,T,k,R){if(b===void 0)return T!==void 0?-1:0;if(T===void 0)return 1;if((T=E(b,T))===0){if(k&&R)return 0;if(k)return 1;if(R)return-1}return T}(h.lower,g.lower,h.lowerOpen,g.lowerOpen)<=0&&0<=function(b,T,k,R){if(b===void 0)return T!==void 0?1:0;if(T===void 0)return-1;if((T=E(b,T))===0){if(k&&R)return 0;if(k)return-1;if(R)return 1}return T}(h.upper,g.upper,h.upperOpen,g.upperOpen)}function ka(h,g,b,T){h.subscribers.add(b),T.addEventListener("abort",function(){var k,R;h.subscribers.delete(b),h.subscribers.size===0&&(k=h,R=g,setTimeout(function(){k.subscribers.size===0&&Bn(R,k)},3e3))})}var Ya={stack:"dbcore",level:0,name:"Cache",create:function(h){var g=h.schema.name;return je(je({},h),{transaction:function(b,T,k){var R,K,et=h.transaction(b,T,k);return T==="readwrite"&&(K=(R=new AbortController).signal,k=function(lt){return function(){if(R.abort(),T==="readwrite"){for(var ht=new Set,gt=0,it=b;gt<it.length;gt++){var ft=it[gt],pt=No["idb://".concat(g,"/").concat(ft)];if(pt){var dt=h.table(ft),_t=pt.optimisticOps.filter(function(ae){return ae.trans===et});if(et._explicit&&lt&&et.mutatedParts)for(var ot=0,yt=Object.values(pt.queries.query);ot<yt.length;ot++)for(var It=0,Pt=(he=yt[ot]).slice();It<Pt.length;It++)Ha((ee=Pt[It]).obsSet,et.mutatedParts)&&(Bn(he,ee),ee.subscribers.forEach(function(ae){return ht.add(ae)}));else if(0<_t.length){pt.optimisticOps=pt.optimisticOps.filter(function(ae){return ae.trans!==et});for(var Dt=0,$t=Object.values(pt.queries.query);Dt<$t.length;Dt++)for(var he,ee,re,fe=0,ne=(he=$t[Dt]).slice();fe<ne.length;fe++)(ee=ne[fe]).res!=null&&et.mutatedParts&&(lt&&!ee.dirty?(re=Object.isFrozen(ee.res),re=gs(ee.res,ee.req,_t,dt,ee,re),ee.dirty?(Bn(he,ee),ee.subscribers.forEach(function(ae){return ht.add(ae)})):re!==ee.res&&(ee.res=re,ee.promise=pe.resolve({result:re}))):(ee.dirty&&Bn(he,ee),ee.subscribers.forEach(function(ae){return ht.add(ae)})))}}}ht.forEach(function(ae){return ae()})}}},et.addEventListener("abort",k(!1),{signal:K}),et.addEventListener("error",k(!1),{signal:K}),et.addEventListener("complete",k(!0),{signal:K})),et},table:function(b){var T=h.table(b),k=T.schema.primaryKey;return je(je({},T),{mutate:function(R){var K=xe.trans;if(k.outbound||K.db._options.cache==="disabled"||K.explicit||K.idbtrans.mode!=="readwrite")return T.mutate(R);var et=No["idb://".concat(g,"/").concat(b)];return et?(K=T.mutate(R),R.type!=="add"&&R.type!=="put"||!(50<=R.values.length||So(k,R).some(function(lt){return lt==null}))?(et.optimisticOps.push(R),R.mutatedParts&&Wi(R.mutatedParts),K.then(function(lt){0<lt.numFailures&&(Bn(et.optimisticOps,R),(lt=ms(0,R,lt))&&et.optimisticOps.push(lt),R.mutatedParts&&Wi(R.mutatedParts))}),K.catch(function(){Bn(et.optimisticOps,R),R.mutatedParts&&Wi(R.mutatedParts)})):K.then(function(lt){var ht=ms(0,je(je({},R),{values:R.values.map(function(gt,it){var ft;return lt.failures[it]?gt:(gt=(ft=k.keyPath)!==null&&ft!==void 0&&ft.includes(".")?wr(gt):je({},gt),Wr(gt,k.keyPath,lt.results[it]),gt)})}),lt);et.optimisticOps.push(ht),queueMicrotask(function(){return R.mutatedParts&&Wi(R.mutatedParts)})}),K):T.mutate(R)},query:function(R){if(!Aa(xe,T)||!Vs("query",R))return T.query(R);var K=((ht=xe.trans)===null||ht===void 0?void 0:ht.db._options.cache)==="immutable",it=xe,et=it.requery,lt=it.signal,ht=function(dt,_t,ot,yt){var It=No["idb://".concat(dt,"/").concat(_t)];if(!It)return[];if(!(_t=It.queries[ot]))return[null,!1,It,null];var Pt=_t[(yt.query?yt.query.index.name:null)||""];if(!Pt)return[null,!1,It,null];switch(ot){case"query":var Dt=Pt.find(function($t){return $t.req.limit===yt.limit&&$t.req.values===yt.values&&Pa($t.req.query.range,yt.query.range)});return Dt?[Dt,!0,It,Pt]:[Pt.find(function($t){return("limit"in $t.req?$t.req.limit:1/0)>=yt.limit&&(!yt.values||$t.req.values)&&la($t.req.query.range,yt.query.range)}),!1,It,Pt];case"count":return Dt=Pt.find(function($t){return Pa($t.req.query.range,yt.query.range)}),[Dt,!!Dt,It,Pt]}}(g,b,"query",R),gt=ht[0],it=ht[1],ft=ht[2],pt=ht[3];return gt&&it?gt.obsSet=R.obsSet:(it=T.query(R).then(function(dt){var _t=dt.result;if(gt&&(gt.res=_t),K){for(var ot=0,yt=_t.length;ot<yt;++ot)Object.freeze(_t[ot]);Object.freeze(_t)}else dt.result=wr(_t);return dt}).catch(function(dt){return pt&&gt&&Bn(pt,gt),Promise.reject(dt)}),gt={obsSet:R.obsSet,promise:it,subscribers:new Set,type:"query",req:R,dirty:!1},pt?pt.push(gt):(pt=[gt],(ft=ft||(No["idb://".concat(g,"/").concat(b)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[R.query.index.name||""]=pt)),ka(gt,pt,et,lt),gt.promise.then(function(dt){return{result:gs(dt.result,R,ft==null?void 0:ft.optimisticOps,T,gt,K)}})}})}})}};function Uo(h,g){return new Proxy(h,{get:function(b,T,k){return T==="db"?g:Reflect.get(b,T,k)}})}var ai=(Yr.prototype.version=function(h){if(isNaN(h)||h<.1)throw new Kt.Type("Given version is not a positive number");if(h=Math.round(10*h)/10,this.idbdb||this._state.isBeingOpened)throw new Kt.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,h);var g=this._versions,b=g.filter(function(T){return T._cfg.version===h})[0];return b||(b=new this.Version(h),g.push(b),g.sort(cs),b.stores({}),this._state.autoSchema=!1,b)},Yr.prototype._whenReady=function(h){var g=this;return this.idbdb&&(this._state.openComplete||xe.letThrough||this._vip)?h():new pe(function(b,T){if(g._state.openComplete)return T(new Kt.DatabaseClosed(g._state.dbOpenError));if(!g._state.isBeingOpened){if(!g._state.autoOpen)return void T(new Kt.DatabaseClosed);g.open().catch(qe)}g._state.dbReadyPromise.then(b,T)}).then(h)},Yr.prototype.use=function(h){var g=h.stack,b=h.create,T=h.level,k=h.name;return k&&this.unuse({stack:g,name:k}),h=this._middlewares[g]||(this._middlewares[g]=[]),h.push({stack:g,create:b,level:T??10,name:k}),h.sort(function(R,K){return R.level-K.level}),this},Yr.prototype.unuse=function(h){var g=h.stack,b=h.name,T=h.create;return g&&this._middlewares[g]&&(this._middlewares[g]=this._middlewares[g].filter(function(k){return T?k.create!==T:!!b&&k.name!==b})),this},Yr.prototype.open=function(){var h=this;return Re(kn,function(){return Fs(h)})},Yr.prototype._close=function(){var h=this._state,g=Zr.indexOf(this);if(0<=g&&Zr.splice(g,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}h.isBeingOpened||(h.dbReadyPromise=new pe(function(b){h.dbReadyResolve=b}),h.openCanceller=new pe(function(b,T){h.cancelOpen=T}))},Yr.prototype.close=function(b){var g=(b===void 0?{disableAutoOpen:!0}:b).disableAutoOpen,b=this._state;g?(b.isBeingOpened&&b.cancelOpen(new Kt.DatabaseClosed),this._close(),b.autoOpen=!1,b.dbOpenError=new Kt.DatabaseClosed):(this._close(),b.autoOpen=this._options.autoOpen||b.isBeingOpened,b.openComplete=!1,b.dbOpenError=null)},Yr.prototype.delete=function(h){var g=this;h===void 0&&(h={disableAutoOpen:!0});var b=0<arguments.length&&typeof arguments[0]!="object",T=this._state;return new pe(function(k,R){function K(){g.close(h);var et=g._deps.indexedDB.deleteDatabase(g.name);et.onsuccess=$(function(){var lt,ht,gt;lt=g._deps,ht=g.name,gt=lt.indexedDB,lt=lt.IDBKeyRange,_o(gt)||ht===ur||vo(gt,lt).delete(ht).catch(qe),k()}),et.onerror=$n(R),et.onblocked=g._fireOnBlocked}if(b)throw new Kt.InvalidArgument("Invalid closeOptions argument to db.delete()");T.isBeingOpened?T.dbReadyPromise.then(K):K()})},Yr.prototype.backendDB=function(){return this.idbdb},Yr.prototype.isOpen=function(){return this.idbdb!==null},Yr.prototype.hasBeenClosed=function(){var h=this._state.dbOpenError;return h&&h.name==="DatabaseClosed"},Yr.prototype.hasFailed=function(){return this._state.dbOpenError!==null},Yr.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(Yr.prototype,"tables",{get:function(){var h=this;return l(this._allTables).map(function(g){return h._allTables[g]})},enumerable:!1,configurable:!0}),Yr.prototype.transaction=function(){var h=(function(g,b,T){var k=arguments.length;if(k<2)throw new Kt.InvalidArgument("Too few arguments");for(var R=new Array(k-1);--k;)R[k-1]=arguments[k];return T=R.pop(),[g,di(R),T]}).apply(this,arguments);return this._transaction.apply(this,h)},Yr.prototype._transaction=function(h,g,b){var T=this,k=xe.trans;k&&k.db===this&&h.indexOf("!")===-1||(k=null);var R,K,et=h.indexOf("?")!==-1;h=h.replace("!","").replace("?","");try{if(K=g.map(function(ht){if(ht=ht instanceof T.Table?ht.name:ht,typeof ht!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return ht}),h=="r"||h===kr)R=kr;else{if(h!="rw"&&h!=yr)throw new Kt.InvalidArgument("Invalid transaction mode: "+h);R=yr}if(k){if(k.mode===kr&&R===yr){if(!et)throw new Kt.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");k=null}k&&K.forEach(function(ht){if(k&&k.storeNames.indexOf(ht)===-1){if(!et)throw new Kt.SubTransaction("Table "+ht+" not included in parent transaction.");k=null}}),et&&k&&!k.active&&(k=null)}}catch(ht){return k?k._promise(null,function(gt,it){it(ht)}):Fe(ht)}var lt=(function ht(gt,it,ft,pt,dt){return pe.resolve().then(function(){var _t=xe.transless||xe,ot=gt._createTransaction(it,ft,gt._dbSchema,pt);if(ot.explicit=!0,_t={trans:ot,transless:_t},pt)ot.idbtrans=pt.idbtrans;else try{ot.create(),ot.idbtrans._explicit=!0,gt._state.PR1398_maxLoop=3}catch(Pt){return Pt.name===fn.InvalidState&&gt.isOpen()&&0<--gt._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),gt.close({disableAutoOpen:!1}),gt.open().then(function(){return ht(gt,it,ft,null,dt)})):Fe(Pt)}var yt,It=Wn(dt);return It&&oe(),_t=pe.follow(function(){var Pt;(yt=dt.call(ot,ot))&&(It?(Pt=Wt.bind(null,null),yt.then(Pt,Pt)):typeof yt.next=="function"&&typeof yt.throw=="function"&&(yt=Ca(yt)))},_t),(yt&&typeof yt.then=="function"?pe.resolve(yt).then(function(Pt){return ot.active?Pt:Fe(new Kt.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):_t.then(function(){return yt})).then(function(Pt){return pt&&ot._resolve(),ot._completion.then(function(){return Pt})}).catch(function(Pt){return ot._reject(Pt),Fe(Pt)})})}).bind(null,this,R,K,k,b);return k?k._promise(R,lt,"lock"):xe.trans?Re(xe.transless,function(){return T._whenReady(lt)}):this._whenReady(lt)},Yr.prototype.table=function(h){if(!Ur(this._allTables,h))throw new Kt.InvalidTable("Table ".concat(h," does not exist"));return this._allTables[h]},Yr);function Yr(h,g){var b=this;this._middlewares={},this.verno=0;var T=Yr.dependencies;this._options=g=je({addons:Yr.addons,autoOpen:!0,indexedDB:T.indexedDB,IDBKeyRange:T.IDBKeyRange,cache:"cloned"},g),this._deps={indexedDB:g.indexedDB,IDBKeyRange:g.IDBKeyRange},T=g.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var k,R,K,et,lt,ht={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:qe,dbReadyPromise:null,cancelOpen:qe,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:g.autoOpen};ht.dbReadyPromise=new pe(function(it){ht.dbReadyResolve=it}),ht.openCanceller=new pe(function(it,ft){ht.cancelOpen=ft}),this._state=ht,this.name=h,this.on=Nt(this,"populate","blocked","versionchange","close",{ready:[dn,qe]}),this.on.ready.subscribe=Gi(this.on.ready.subscribe,function(it){return function(ft,pt){Yr.vip(function(){var dt,_t=b._state;_t.openComplete?(_t.dbOpenError||pe.resolve().then(ft),pt&&it(ft)):_t.onReadyBeingFired?(_t.onReadyBeingFired.push(ft),pt&&it(ft)):(it(ft),dt=b,pt||it(function ot(){dt.on.ready.unsubscribe(ft),dt.on.ready.unsubscribe(ot)}))})}}),this.Collection=(k=this,Gt(Ke.prototype,function(yt,ot){this.db=k;var pt=lr,dt=null;if(ot)try{pt=ot()}catch(It){dt=It}var _t=yt._ctx,ot=_t.table,yt=ot.hook.reading.fire;this._ctx={table:ot,index:_t.index,isPrimKey:!_t.index||ot.schema.primKey.keyPath&&_t.index===ot.schema.primKey.name,range:pt,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:dt,or:_t.or,valueMapper:yt!==We?yt:null}})),this.Table=(R=this,Gt(ut.prototype,function(it,ft,pt){this.db=R,this._tx=pt,this.name=it,this.schema=ft,this.hook=R._allTables[it]?R._allTables[it].hook:Nt(null,{creating:[Ve,qe],reading:[_i,We],updating:[xi,qe],deleting:[ra,qe]})})),this.Transaction=(K=this,Gt(Bi.prototype,function(it,ft,pt,dt,_t){var ot=this;this.db=K,this.mode=it,this.storeNames=ft,this.schema=pt,this.chromeTransactionDurability=dt,this.idbtrans=null,this.on=Nt(this,"complete","error","abort"),this.parent=_t||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new pe(function(yt,It){ot._resolve=yt,ot._reject=It}),this._completion.then(function(){ot.active=!1,ot.on.complete.fire()},function(yt){var It=ot.active;return ot.active=!1,ot.on.error.fire(yt),ot.parent?ot.parent._reject(yt):It&&ot.idbtrans&&ot.idbtrans.abort(),Fe(yt)})})),this.Version=(et=this,Gt(Fo.prototype,function(it){this.db=et,this._cfg={version:it,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(lt=this,Gt(ls.prototype,function(it,ft,pt){if(this.db=lt,this._ctx={table:it,index:ft===":id"?null:ft,or:pt},this._cmp=this._ascending=E,this._descending=function(dt,_t){return E(_t,dt)},this._max=function(dt,_t){return 0<E(dt,_t)?dt:_t},this._min=function(dt,_t){return E(dt,_t)<0?dt:_t},this._IDBKeyRange=lt._deps.IDBKeyRange,!this._IDBKeyRange)throw new Kt.MissingAPI})),this.on("versionchange",function(it){0<it.newVersion?console.warn("Another connection wants to upgrade database '".concat(b.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(b.name,"'. Closing db now to resume the delete request.")),b.close({disableAutoOpen:!1})}),this.on("blocked",function(it){!it.newVersion||it.newVersion<it.oldVersion?console.warn("Dexie.delete('".concat(b.name,"') was blocked")):console.warn("Upgrade '".concat(b.name,"' blocked by other connection holding version ").concat(it.oldVersion/10))}),this._maxKey=Fi(g.IDBKeyRange),this._createTransaction=function(it,ft,pt,dt){return new b.Transaction(it,ft,pt,b._options.chromeTransactionDurability,dt)},this._fireOnBlocked=function(it){b.on("blocked").fire(it),Zr.filter(function(ft){return ft.name===b.name&&ft!==b&&!ft._state.vcFired}).map(function(ft){return ft.on("versionchange").fire(it)})},this.use(Ar),this.use(Ya),this.use(ua),this.use(Ns),this.use(Us);var gt=new Proxy(this,{get:function(it,ft,pt){if(ft==="_vip")return!0;if(ft==="table")return function(_t){return Uo(b.table(_t),gt)};var dt=Reflect.get(it,ft,pt);return dt instanceof ut?Uo(dt,gt):ft==="tables"?dt.map(function(_t){return Uo(_t,gt)}):ft==="_createTransaction"?function(){return Uo(dt.apply(this,arguments),gt)}:dt}});this.vip=gt,T.forEach(function(it){return it(b)})}var To,$r=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",js=($a.prototype.subscribe=function(h,g,b){return this._subscribe(h&&typeof h!="function"?h:{next:h,error:g,complete:b})},$a.prototype[$r]=function(){return this},$a);function $a(h){this._subscribe=h}try{To={indexedDB:pn.indexedDB||pn.mozIndexedDB||pn.webkitIndexedDB||pn.msIndexedDB,IDBKeyRange:pn.IDBKeyRange||pn.webkitIDBKeyRange}}catch{To={indexedDB:null,IDBKeyRange:null}}function vs(h){var g,b=!1,T=new js(function(k){var R=Wn(h),K,et=!1,lt={},ht={},gt={get closed(){return et},unsubscribe:function(){et||(et=!0,K&&K.abort(),it&&Ki.storagemutated.unsubscribe(pt))}};k.start&&k.start(gt);var it=!1,ft=function(){return Ye(dt)},pt=function(_t){Ia(lt,_t),Ha(ht,lt)&&ft()},dt=function(){var _t,ot,yt;!et&&To.indexedDB&&(lt={},_t={},K&&K.abort(),K=new AbortController,yt=function(It){var Pt=D();try{R&&oe();var Dt=kt(h,It);return Dt=R?Dt.finally(Wt):Dt}finally{Pt&&U()}}(ot={subscr:_t,signal:K.signal,requery:ft,querier:h,trans:null}),Promise.resolve(yt).then(function(It){b=!0,g=It,et||ot.signal.aborted||(lt={},function(Pt){for(var Dt in Pt)if(Ur(Pt,Dt))return;return 1}(ht=_t)||it||(Ki(go,pt),it=!0),Ye(function(){return!et&&k.next&&k.next(It)}))},function(It){b=!1,["DatabaseClosedError","AbortError"].includes(It==null?void 0:It.name)||et||Ye(function(){et||k.error&&k.error(It)})}))};return setTimeout(ft,0),gt});return T.hasValue=function(){return b},T.getValue=function(){return g},T}var Ei=ai;function Ho(h){var g=io;try{io=!0,Ki.storagemutated.fire(h),wo(h,!0)}finally{io=g}}Xt(Ei,je(je({},_n),{delete:function(h){return new Ei(h,{addons:[]}).delete()},exists:function(h){return new Ei(h,{addons:[]}).open().then(function(g){return g.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(h){try{return g=Ei.dependencies,b=g.indexedDB,g=g.IDBKeyRange,(_o(b)?Promise.resolve(b.databases()).then(function(T){return T.map(function(k){return k.name}).filter(function(k){return k!==ur})}):vo(b,g).toCollection().primaryKeys()).then(h)}catch{return Fe(new Kt.MissingAPI)}var g,b},defineClass:function(){return function(h){Ot(this,h)}},ignoreTransaction:function(h){return xe.trans?Re(xe.transless,h):h()},vip:ro,async:function(h){return function(){try{var g=Ca(h.apply(this,arguments));return g&&typeof g.then=="function"?g:pe.resolve(g)}catch(b){return Fe(b)}}},spawn:function(h,g,b){try{var T=Ca(h.apply(b,g||[]));return T&&typeof T.then=="function"?T:pe.resolve(T)}catch(k){return Fe(k)}},currentTransaction:{get:function(){return xe.trans||null}},waitFor:function(h,g){return g=pe.resolve(typeof h=="function"?Ei.ignoreTransaction(h):h).timeout(g||6e4),xe.trans?xe.trans.waitFor(g):g},Promise:pe,debug:{get:function(){return An},set:function(h){_r(h)}},derive:Dr,extend:Ot,props:Xt,override:Gi,Events:Nt,on:Ki,liveQuery:vs,extendObservabilitySet:Ia,getByKeyPath:Rn,setByKeyPath:Wr,delByKeyPath:function(h,g){typeof g=="string"?Wr(h,g,void 0):"length"in g&&[].map.call(g,function(b){Wr(h,b,void 0)})},shallowClone:Ai,deepClone:wr,getObjectDiff:Eo,cmp:E,asap:Cr,minKey:-1/0,addons:[],connections:Zr,errnames:fn,dependencies:To,cache:No,semVer:"4.0.11",version:"4.0.11".split(".").map(function(h){return parseInt(h)}).reduce(function(h,g,b){return h+g/Math.pow(10,2*b)})})),Ei.maxKey=Fi(Ei.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Ki(go,function(h){io||(h=new CustomEvent(Ga,{detail:h}),io=!0,dispatchEvent(h),io=!1)}),addEventListener(Ga,function(h){h=h.detail,io||Ho(h)}));var Io,io=!1,Ma=function(){};return typeof BroadcastChannel<"u"&&((Ma=function(){(Io=new BroadcastChannel(Ga)).onmessage=function(h){return h.data&&Ho(h.data)}})(),typeof Io.unref=="function"&&Io.unref(),Ki(go,function(h){io||Io.postMessage(h)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(h){if(!ai.disableBfCache&&h.persisted){An&&console.debug("Dexie: handling persisted pagehide"),Io!=null&&Io.close();for(var g=0,b=Zr;g<b.length;g++)b[g].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(h){!ai.disableBfCache&&h.persisted&&(An&&console.debug("Dexie: handling persisted pageshow"),Ma(),Ho({all:new Jr(-1/0,[[]])}))})),pe.rejectionMapper=function(h,g){return!h||h instanceof Zn||h instanceof TypeError||h instanceof SyntaxError||!h.name||!vn[h.name]?h:(g=new vn[h.name](g||h.message,h),"stack"in h&&rr(g,"stack",{get:function(){return this.inner.stack}}),g)},_r(An),je(ai,Object.freeze({__proto__:null,Dexie:ai,liveQuery:vs,Entity:v,cmp:E,PropModification:Ft,replacePrefix:function(h,g){return new Ft({replacePrefix:[h,g]})},add:function(h){return new Ft({add:h})},remove:function(h){return new Ft({remove:h})},default:ai,RangeSet:Jr,mergeRanges:aa,rangesOverlap:fs}),{default:ai}),ai})})(Hp);var Mf=Hp.exports;const wc=Sc(Mf),Kp=Symbol.for("Dexie"),Ec=globalThis[Kp]||(globalThis[Kp]=wc);if(wc.semVer!==Ec.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${wc.semVer} and ${Ec.semVer}`);const zf=new Ec("VehicleTrackerDB");zf.version(1).stores({TrailData:"++id, vehicleId, timestamp, coordinates, synced"});export{Of as M,Pf as a,zf as d,Lf as m};
