import{s as T,e as v,c as _,b as y,d as l,i as h,j as k,k as f,n as C,l as z,D as M,z as A,a as D,t as N,x as W,f as j,g as R,h as G,B as J,q as K}from"../chunks/scheduler.78aa6f0d.js";import{S as B,i as H,c as Q,a as X,m as Y,t as Z,b as ee,d as te}from"../chunks/index.9a12d9f3.js";import{p as re}from"../chunks/stores.0d5f4774.js";import{s as se}from"../chunks/supabaseClient.f7f11bf4.js";import{g as L}from"../chunks/navigation.dd464073.js";import{a as ae}from"../chunks/sessionStore.4d48270f.js";import{p as U}from"../chunks/profileStore.16c3ff97.js";function oe(d){let r,t;return{c(){r=v("div"),t=v("div"),this.h()},l(e){r=_(e,"DIV",{class:!0});var s=y(r);t=_(s,"DIV",{id:!0,class:!0}),y(t).forEach(l),s.forEach(l),this.h()},h(){h(t,"id","container_"+$),h(t,"class","min-h-[90vh] overflow-auto"),h(r,"class","mx-auto max-w-2xl overflow-auto rounded-lg bg-green-200 p-4 shadow-md")},m(e,s){k(e,r,s),f(r,t)},p:C,i:C,o:C,d(e){e&&l(r)}}}const $="7d624884-1198-4af8-b49d-4b8b5efcb85c",q="AgSkan SurveyReal";function ne(d,r,t){let e;z(d,re,a=>t(2,e=a));const s=M();let o;return A(async()=>{const a=e.data.session;a&&(o=a.user.id);const p=document.createElement("script");return p.src="https://cdn.jsdelivr.net/npm/@feathery/react@latest/umd/index.js",p.async=!0,p.onload=()=>{Feathery.init($),o&&Feathery.updateUserId(o),Feathery.renderAt(`container_${$}`,{formName:q,initialLoader:{show:!0,loader:`
                  <div class="flex flex-col items-center space-y-4">
                    <div class="border-t-4 border-primary animate-spin rounded-full w-12 h-12 mb-4"></div>
                    <p class="text-lg text-primary-content">Loading form...</p>
                  </div>
                `,initialContainerHeight:"600px",initialContainerWidth:"100%"},onFormComplete:async u=>{const m={};for(const[c,i]of Object.entries(u.fields))c.startsWith("feathery.")||(m[c]=i.value||null);try{const{error:c}=await se.from("user_survey").upsert({user_id:o,response:{answers:m,form_id:$,form_name:q,submitted_at:new Date().toISOString()}},{onConflict:"user_id"});c?console.error("Error storing survey response:",c):(console.log("Survey response stored successfully"),s("complete"),L("/account/payment_plans"))}catch(c){console.error("Error storing survey response:",c)}}})},document.head.appendChild(p),()=>{document.head.removeChild(p)}}),[]}class ie extends B{constructor(r){super(),H(this,r,ne,oe,T,{})}}const ce=()=>({}),ye=Object.freeze(Object.defineProperty({__proto__:null,load:ce},Symbol.toStringTag,{value:"Module"}));function le(d){let r,t,e,s,o,a="User Survey",p,u,m,c,i,x=d[0]?"Processing...":"Skip Survey",S,b,I,F;return m=new ie({}),{c(){r=D(),t=v("div"),e=v("div"),s=v("div"),o=v("h1"),o.textContent=a,p=D(),u=v("div"),Q(m.$$.fragment),c=D(),i=v("button"),S=N(x),this.h()},l(n){W("svelte-1tnm1ny",document.head).forEach(l),r=j(n),t=_(n,"DIV",{class:!0});var O=y(t);e=_(O,"DIV",{class:!0});var V=y(e);s=_(V,"DIV",{});var w=y(s);o=_(w,"H1",{class:!0,"data-svelte-h":!0}),R(o)!=="svelte-jwlscb"&&(o.textContent=a),p=j(w),u=_(w,"DIV",{class:!0});var E=y(u);X(m.$$.fragment,E),c=j(E),i=_(E,"BUTTON",{type:!0,class:!0});var P=y(i);S=G(P,x),P.forEach(l),E.forEach(l),w.forEach(l),V.forEach(l),O.forEach(l),this.h()},h(){document.title="User Survey",h(o,"class","mb-6 text-2xl font-bold"),h(i,"type","button"),h(i,"class","btn btn-secondary mt-4"),i.disabled=d[0],h(u,"class","form-container"),h(e,"class","flex w-full flex-col px-6"),h(t,"class","mb-12 mt-4 flex min-h-[100vh] place-content-center content-center items-center text-center")},m(n,g){k(n,r,g),k(n,t,g),f(t,e),f(e,s),f(s,o),f(s,p),f(s,u),Y(m,u,null),f(u,c),f(u,i),f(i,S),b=!0,I||(F=J(i,"click",d[1]),I=!0)},p(n,[g]){(!b||g&1)&&x!==(x=n[0]?"Processing...":"Skip Survey")&&K(S,x),(!b||g&1)&&(i.disabled=n[0])},i(n){b||(Z(m.$$.fragment,n),b=!0)},o(n){ee(m.$$.fragment,n),b=!1},d(n){n&&(l(r),l(t)),te(m),I=!1,F()}}}function de(d,r,t){let e;z(d,U,a=>t(2,e=a));let s=!1;A(async()=>{try{e!=null&&e.id&&(await ae.from("profiles").update({onboarded:!0,updated_at:new Date().toISOString()}).eq("id",e.id),U.update(a=>({...a,onboarded:!0})))}catch(a){console.error("Error updating onboarded status:",a)}});async function o(){t(0,s=!0);try{await L("/account/payment_plans")}catch(a){console.error("Error navigating:",a)}finally{t(0,s=!1)}}return[s,o]}class be extends B{constructor(r){super(),H(this,r,de,le,T,{})}}export{be as component,ye as universal};
