import{s as Ae,e as f,a as j,c as p,b as C,g as ee,f as q,d,i as r,j as Q,k as a,l as _e,t as Y,h as Z,U as le,B as W,q as ie,K as ce,E as he,F as be}from"../chunks/scheduler.0ff5556b.js";import{S as Te,i as Le,b as $,e as Ne,t as R,g as Pe,c as de,a as fe,m as pe,d as me}from"../chunks/index.e3d1f712.js";import{g as je}from"../chunks/navigation.2ad273ee.js";import{a as ne}from"../chunks/sessionStore.a0feee67.js";import{p as ve}from"../chunks/profileStore.99d1945a.js";import{c as ge}from"../chunks/connectedMapStore.d86a965d.js";import{m as ke}from"../chunks/mapActivityStore.e6a2ac64.js";import{o as Ee,s as ye}from"../chunks/operationStore.2d5735a4.js";import{t as oe}from"../chunks/Toaster.svelte_svelte_type_style_lang.7b1bf8eb.js";import{m as qe}from"../chunks/mapApi.0dbad589.js";import{U as Ve}from"../chunks/user.c21dec4a.js";import{M as Be}from"../chunks/map.a871bcf8.js";const Oe=()=>({}),tt=Object.freeze(Object.defineProperty({__proto__:null,load:Oe},Symbol.toStringTag,{value:"Module"}));function Ue(s){let t,e,l,g,v,u,o,i,h="Full Name",w,m,c,I,b,B,S,O,T,N="I'll add my map ID later",y,_,n,M=s[0]?"Continue Setup":"Complete Setup",A,D,U,J,G,L=s[6]&&we(s);u=new Ve({props:{size:18,class:"text-base-content/70"}});let V=!s[0]&&Ie(s),k=s[8]&&Me();return{c(){L&&L.c(),t=j(),e=f("div"),l=f("div"),g=f("div"),v=f("label"),de(u.$$.fragment),o=j(),i=f("span"),i.textContent=h,w=j(),m=f("input"),c=j(),V&&V.c(),I=j(),b=f("div"),B=f("label"),S=f("input"),O=j(),T=f("span"),T.textContent=N,y=j(),_=f("button"),k&&k.c(),n=j(),A=Y(M),this.h()},l(E){L&&L.l(E),t=q(E),e=p(E,"DIV",{class:!0});var F=C(e);l=p(F,"DIV",{class:!0});var K=C(l);g=p(K,"DIV",{class:!0});var X=C(g);v=p(X,"LABEL",{class:!0});var P=C(v);fe(u.$$.fragment,P),o=q(P),i=p(P,"SPAN",{class:!0,"data-svelte-h":!0}),ee(i)!=="svelte-8nvrpr"&&(i.textContent=h),P.forEach(d),w=q(X),m=p(X,"INPUT",{type:!0,placeholder:!0,class:!0}),X.forEach(d),c=q(K),V&&V.l(K),I=q(K),b=p(K,"DIV",{class:!0});var x=C(b);B=p(x,"LABEL",{class:!0});var z=C(B);S=p(z,"INPUT",{type:!0,class:!0}),O=q(z),T=p(z,"SPAN",{class:!0,"data-svelte-h":!0}),ee(T)!=="svelte-1f0ujgz"&&(T.textContent=N),z.forEach(d),x.forEach(d),y=q(K),_=p(K,"BUTTON",{class:!0});var H=C(_);k&&k.l(H),n=q(H),A=Z(H,M),H.forEach(d),K.forEach(d),F.forEach(d),this.h()},h(){r(i,"class","label-text"),r(v,"class","label items-center gap-2"),r(m,"type","text"),r(m,"placeholder","Enter your full name"),r(m,"class","input input-bordered w-full"),m.required=!0,r(g,"class","form-control mb-6"),r(S,"type","checkbox"),r(S,"class","checkbox checkbox-sm"),r(T,"class","label-text"),r(B,"class","label cursor-pointer justify-start gap-2"),r(b,"class","form-control mb-6"),r(_,"class","btn btn-primary w-full"),_.disabled=D=!s[10]||s[8],r(l,"class","card-body"),r(e,"class","card bg-base-100 shadow-xl")},m(E,F){L&&L.m(E,F),Q(E,t,F),Q(E,e,F),a(e,l),a(l,g),a(g,v),pe(u,v,null),a(v,o),a(v,i),a(g,w),a(g,m),le(m,s[3]),a(l,c),V&&V.m(l,null),a(l,I),a(l,b),a(b,B),a(B,S),S.checked=s[0],a(B,O),a(B,T),a(l,y),a(l,_),k&&k.m(_,null),a(_,n),a(_,A),U=!0,J||(G=[W(m,"input",s[15]),W(S,"change",s[17]),W(_,"click",s[13])],J=!0)},p(E,F){E[6]?L?L.p(E,F):(L=we(E),L.c(),L.m(t.parentNode,t)):L&&(L.d(1),L=null),F&8&&m.value!==E[3]&&le(m,E[3]),E[0]?V&&(Pe(),$(V,1,1,()=>{V=null}),Ne()):V?(V.p(E,F),F&1&&R(V,1)):(V=Ie(E),V.c(),R(V,1),V.m(l,I)),F&1&&(S.checked=E[0]),E[8]?k||(k=Me(),k.c(),k.m(_,n)):k&&(k.d(1),k=null),(!U||F&1)&&M!==(M=E[0]?"Continue Setup":"Complete Setup")&&ie(A,M),(!U||F&1280&&D!==(D=!E[10]||E[8]))&&(_.disabled=D)},i(E){U||(R(u.$$.fragment,E),R(V),U=!0)},o(E){$(u.$$.fragment,E),$(V),U=!1},d(E){E&&(d(t),d(e)),L&&L.d(E),me(u),V&&V.d(),k&&k.d(),J=!1,ce(G)}}}function Fe(s){var E,F,K,X;let t,e,l,g,v="Connected Map",u,o,i=(((E=s[5])==null?void 0:E.map_name)||((F=s[2])==null?void 0:F.map_name))+"",h,w,m,c,I=(((K=s[5])==null?void 0:K.owner)||((X=s[2])==null?void 0:X.owner))+"",b,B,S,O,T,N,y,_="Full Name",n,M,A,D,U,J,G,L,V;T=new Ve({props:{size:18,class:"text-base-content/70"}});let k=s[8]&&De();return{c(){t=f("div"),e=f("div"),l=f("div"),g=f("h2"),g.textContent=v,u=j(),o=f("p"),h=Y(i),w=j(),m=f("p"),c=Y("Owned by "),b=Y(I),B=j(),S=f("div"),O=f("label"),de(T.$$.fragment),N=j(),y=f("span"),y.textContent=_,n=j(),M=f("input"),A=j(),D=f("button"),k&&k.c(),U=Y(`\r
            Continue`),this.h()},l(P){t=p(P,"DIV",{class:!0});var x=C(t);e=p(x,"DIV",{class:!0});var z=C(e);l=p(z,"DIV",{class:!0});var H=C(l);g=p(H,"H2",{class:!0,"data-svelte-h":!0}),ee(g)!=="svelte-3m5xzy"&&(g.textContent=v),u=q(H),o=p(H,"P",{class:!0});var ae=C(o);h=Z(ae,i),ae.forEach(d),w=q(H),m=p(H,"P",{class:!0});var te=C(m);c=Z(te,"Owned by "),b=Z(te,I),te.forEach(d),H.forEach(d),B=q(z),S=p(z,"DIV",{class:!0});var se=C(S);O=p(se,"LABEL",{class:!0});var re=C(O);fe(T.$$.fragment,re),N=q(re),y=p(re,"SPAN",{class:!0,"data-svelte-h":!0}),ee(y)!=="svelte-8nvrpr"&&(y.textContent=_),re.forEach(d),n=q(se),M=p(se,"INPUT",{type:!0,placeholder:!0,class:!0}),se.forEach(d),A=q(z),D=p(z,"BUTTON",{class:!0});var ue=C(D);k&&k.l(ue),U=Z(ue,`\r
            Continue`),ue.forEach(d),z.forEach(d),x.forEach(d),this.h()},h(){r(g,"class","mb-2 text-lg font-semibold"),r(o,"class","text-base-content"),r(m,"class","text-sm opacity-70"),r(l,"class","mb-6 rounded-lg bg-base-200 p-4"),r(y,"class","label-text"),r(O,"class","label items-center gap-2"),r(M,"type","text"),r(M,"placeholder","Enter your full name"),r(M,"class","input input-bordered w-full"),M.required=!0,r(S,"class","form-control mb-6"),r(D,"class","btn btn-primary w-full"),D.disabled=J=!s[3].trim()||s[8],r(e,"class","card-body"),r(t,"class","card bg-base-100 shadow-xl")},m(P,x){Q(P,t,x),a(t,e),a(e,l),a(l,g),a(l,u),a(l,o),a(o,h),a(l,w),a(l,m),a(m,c),a(m,b),a(e,B),a(e,S),a(S,O),pe(T,O,null),a(O,N),a(O,y),a(S,n),a(S,M),le(M,s[3]),a(e,A),a(e,D),k&&k.m(D,null),a(D,U),G=!0,L||(V=[W(M,"input",s[14]),W(D,"click",s[13])],L=!0)},p(P,x){var z,H,ae,te;(!G||x&36)&&i!==(i=(((z=P[5])==null?void 0:z.map_name)||((H=P[2])==null?void 0:H.map_name))+"")&&ie(h,i),(!G||x&36)&&I!==(I=(((ae=P[5])==null?void 0:ae.owner)||((te=P[2])==null?void 0:te.owner))+"")&&ie(b,I),x&8&&M.value!==P[3]&&le(M,P[3]),P[8]?k||(k=De(),k.c(),k.m(D,U)):k&&(k.d(1),k=null),(!G||x&264&&J!==(J=!P[3].trim()||P[8]))&&(D.disabled=J)},i(P){G||(R(T.$$.fragment,P),G=!0)},o(P){$(T.$$.fragment,P),G=!1},d(P){P&&d(t),me(T),k&&k.d(),L=!1,ce(V)}}}function we(s){let t,e,l,g,v,u;return{c(){t=f("div"),e=he("svg"),l=he("path"),g=j(),v=f("span"),u=Y(s[6]),this.h()},l(o){t=p(o,"DIV",{class:!0});var i=C(t);e=be(i,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0});var h=C(e);l=be(h,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),C(l).forEach(d),h.forEach(d),g=q(i),v=p(i,"SPAN",{});var w=C(v);u=Z(w,s[6]),w.forEach(d),i.forEach(d),this.h()},h(){r(l,"stroke-linecap","round"),r(l,"stroke-linejoin","round"),r(l,"stroke-width","2"),r(l,"d","M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"),r(e,"xmlns","http://www.w3.org/2000/svg"),r(e,"class","h-6 w-6 shrink-0 stroke-current"),r(e,"fill","none"),r(e,"viewBox","0 0 24 24"),r(t,"class","alert alert-error mb-6")},m(o,i){Q(o,t,i),a(t,e),a(e,l),a(t,g),a(t,v),a(v,u)},p(o,i){i&64&&ie(u,o[6])},d(o){o&&d(t)}}}function Ie(s){let t,e,l,g,v,u="Map ID",o,i,h,w,m,c,I,b,B,S,O,T;l=new Be({props:{size:18,class:"text-base-content/70"}});let N=s[9]&&Ce(),y=s[1]&&!s[7]&&Se();return{c(){t=f("div"),e=f("label"),de(l.$$.fragment),g=j(),v=f("span"),v.textContent=u,o=j(),i=f("div"),h=f("input"),m=j(),c=f("button"),N&&N.c(),I=Y(`\r
                  Join`),B=j(),y&&y.c(),this.h()},l(_){t=p(_,"DIV",{class:!0});var n=C(t);e=p(n,"LABEL",{class:!0});var M=C(e);fe(l.$$.fragment,M),g=q(M),v=p(M,"SPAN",{class:!0,"data-svelte-h":!0}),ee(v)!=="svelte-fs4ily"&&(v.textContent=u),M.forEach(d),o=q(n),i=p(n,"DIV",{class:!0});var A=C(i);h=p(A,"INPUT",{type:!0,placeholder:!0,class:!0}),m=q(A),c=p(A,"BUTTON",{type:!0,class:!0});var D=C(c);N&&N.l(D),I=Z(D,`\r
                  Join`),D.forEach(d),A.forEach(d),B=q(n),y&&y.l(n),n.forEach(d),this.h()},h(){r(v,"class","label-text"),r(e,"class","label items-center gap-2"),r(h,"type","text"),r(h,"placeholder","Enter map ID"),r(h,"class","input input-bordered flex-1"),h.required=w=!s[0],r(c,"type","button"),r(c,"class","btn btn-primary"),c.disabled=b=!s[7]||s[9],r(i,"class","flex gap-2"),r(t,"class","form-control mb-6")},m(_,n){Q(_,t,n),a(t,e),pe(l,e,null),a(e,g),a(e,v),a(t,o),a(t,i),a(i,h),le(h,s[1]),a(i,m),a(i,c),N&&N.m(c,null),a(c,I),a(t,B),y&&y.m(t,null),S=!0,O||(T=[W(h,"input",s[16]),W(h,"input",s[11]),W(c,"click",s[12])],O=!0)},p(_,n){(!S||n&1&&w!==(w=!_[0]))&&(h.required=w),n&2&&h.value!==_[1]&&le(h,_[1]),_[9]?N||(N=Ce(),N.c(),N.m(c,I)):N&&(N.d(1),N=null),(!S||n&640&&b!==(b=!_[7]||_[9]))&&(c.disabled=b),_[1]&&!_[7]?y||(y=Se(),y.c(),y.m(t,null)):y&&(y.d(1),y=null)},i(_){S||(R(l.$$.fragment,_),S=!0)},o(_){$(l.$$.fragment,_),S=!1},d(_){_&&d(t),me(l),N&&N.d(),y&&y.d(),O=!1,ce(T)}}}function Ce(s){let t;return{c(){t=f("span"),this.h()},l(e){t=p(e,"SPAN",{class:!0}),C(t).forEach(d),this.h()},h(){r(t,"class","loading loading-spinner")},m(e,l){Q(e,t,l)},d(e){e&&d(t)}}}function Se(s){let t,e='<span class="label-text-alt text-error">Invalid Map ID</span>';return{c(){t=f("label"),t.innerHTML=e,this.h()},l(l){t=p(l,"LABEL",{class:!0,"data-svelte-h":!0}),ee(t)!=="svelte-1mi0jd7"&&(t.innerHTML=e),this.h()},h(){r(t,"class","label")},m(l,g){Q(l,t,g)},d(l){l&&d(t)}}}function Me(s){let t;return{c(){t=f("span"),this.h()},l(e){t=p(e,"SPAN",{class:!0}),C(t).forEach(d),this.h()},h(){r(t,"class","loading loading-spinner")},m(e,l){Q(e,t,l)},d(e){e&&d(t)}}}function De(s){let t;return{c(){t=f("span"),this.h()},l(e){t=p(e,"SPAN",{class:!0}),C(t).forEach(d),this.h()},h(){r(t,"class","loading loading-spinner")},m(e,l){Q(e,t,l)},d(e){e&&d(t)}}}function ze(s){let t,e,l,g='<h1 class="mb-4 text-5xl font-bold text-base-content">Join Map</h1> <p class="text-xl text-base-content/70">Connect to your farm&#39;s map</p>',v,u,o,i;const h=[Fe,Ue],w=[];function m(c,I){return c[4]?0:1}return u=m(s),o=w[u]=h[u](s),{c(){t=f("div"),e=f("div"),l=f("div"),l.innerHTML=g,v=j(),o.c(),this.h()},l(c){t=p(c,"DIV",{class:!0});var I=C(t);e=p(I,"DIV",{class:!0});var b=C(e);l=p(b,"DIV",{class:!0,"data-svelte-h":!0}),ee(l)!=="svelte-1qkega7"&&(l.innerHTML=g),v=q(b),o.l(b),b.forEach(d),I.forEach(d),this.h()},h(){r(l,"class","mb-16 text-center"),r(e,"class","mx-auto max-w-xl"),r(t,"class","min-h-screen bg-base-200 px-4 py-12")},m(c,I){Q(c,t,I),a(t,e),a(e,l),a(e,v),w[u].m(e,null),i=!0},p(c,[I]){let b=u;u=m(c),u===b?w[u].p(c,I):(Pe(),$(w[b],1,1,()=>{w[b]=null}),Ne(),o=w[u],o?o.p(c,I):(o=w[u]=h[u](c),o.c()),R(o,1),o.m(e,null))},i(c){i||(R(o),i=!0)},o(c){$(o),i=!1},d(c){c&&d(t),w[u].d()}}}function He(s,t,e){let l,g,v,u;_e(s,ve,n=>e(18,v=n)),_e(s,ge,n=>e(5,u=n));let o=null,i=!1,h="",w=!1,m=null,c=!1,I=!1,b="";async function B(){if(!h){e(7,w=!1);return}const{data:n,error:M}=await ne.from("master_maps").select("id").eq("id",h).single();e(7,w=!M&&n!==null)}async function S(){e(9,I=!0),e(6,o=null);try{const n=await qe.connectToMap(h);if(!n.success)throw new Error(n.message||"Failed to join map");e(2,m={id:n.data.connectedMap.id,map_name:n.data.connectedMap.map_name,owner:n.data.connectedMap.owner}),ge.set(n.data.connectedMap),ke.set(n.data.mapActivity),n.data.operations&&n.data.operations.length>0&&(Ee.set(n.data.operations),n.data.operation&&ye.set(n.data.operation)),oe.success("Successfully joined map")}catch(n){e(6,o=n.message||"Failed to join map"),oe.error(o)}finally{e(9,I=!1)}}async function O(){e(8,c=!0),e(6,o=null);try{const n={full_name:b,role:"operator",onboarded:!0,updated_at:new Date().toISOString()};if(l){const A=(m==null?void 0:m.id)||u.id,{data:D,error:U}=await ne.from("operations").select("id").eq("master_map_id",A).limit(1).single();if(!U&&D){n.selected_operation_id=D.id;const{data:J}=await ne.from("operations").select("*").eq("id",D.id).single();J&&(Ee.set([J]),ye.set(J))}n.master_map_id=A}const{error:M}=await ne.from("profiles").update(n).eq("id",v.id);if(M)throw new Error("Failed to update profile");ve.update(A=>({...A,full_name:b,user_type:"operator",master_map_id:l?(m==null?void 0:m.id)||u.id:null,selected_operation_id:n.selected_operation_id||null})),l&&ke.update(A=>{const D=A.connected_profiles.map(U=>U.id===v.id?{...U,full_name:b}:U);return{...A,connected_profiles:D}}),oe.success("Setup completed successfully!"),je("/account")}catch(n){e(6,o=n.message||"Failed to complete setup"),oe.error(o)}finally{e(8,c=!1)}}function T(){b=this.value,e(3,b)}function N(){b=this.value,e(3,b)}function y(){h=this.value,e(1,h)}function _(){i=this.checked,e(0,i)}return s.$$.update=()=>{s.$$.dirty&36&&e(4,l=(u==null?void 0:u.id)||m),s.$$.dirty&25&&e(10,g=b.trim().length>0&&(i||l)),s.$$.dirty&2&&h&&B()},[i,h,m,b,l,u,o,w,c,I,g,B,S,O,T,N,y,_]}class lt extends Te{constructor(t){super(),Le(this,t,He,ze,Ae,{})}}export{lt as component,tt as universal};
