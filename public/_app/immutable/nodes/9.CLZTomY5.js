import{g as ft}from"../chunks/DmiDxDTH.js";import{s as ct}from"../chunks/veXANAtK.js";import{s as pt,d as m,i as I,r as mt,f as k,z as lt,k as E,A as ht,n as A,b as g,c as v,g as D,j as S,a as p,e as C,h as H,t as B,w as ut}from"../chunks/DjMlahvE.js";import{S as bt,i as _t,t as $,a as V,d as T,m as M,c as L,b as q,g as gt,e as vt}from"../chunks/KhAD1Hhl.js";import{S as St}from"../chunks/DL8dPXF6.js";import{P as dt}from"../chunks/BAa2k9UJ.js";import"../chunks/DSS83BMa.js";import{t as at}from"../chunks/C31GE7Pe.js";const xt=async({parent:o})=>{var e;await o();const t={loading:!0,isActiveCustomer:!1,hasEverHadSubscription:!1,currentPlanId:"free",subscriptionData:null,error:null};try{const i=await ct.getSubscriptionData();if(!i.success)throw new Error(i.message||"Failed to fetch subscription data");return{loading:!1,isActiveCustomer:i.isActiveCustomer,hasEverHadSubscription:i.hasEverHadSubscription,currentPlanId:i.currentPlanId,subscriptionData:i.subscriptionData,error:null}}catch(i){return console.error("Error loading billing data:",i),(e=i.message)!=null&&e.includes("Not authenticated")&&ft("/login"),{...t,loading:!1,error:i.message}}},yt=!1,Lt=Object.freeze(Object.defineProperty({__proto__:null,load:xt,ssr:yt},Symbol.toStringTag,{value:"Module"}));function Pt(o){var P,F,j,O,U,z,Q,Y,G,J;let t,e,i="Billing",u,s,n,r,l,a,f,h,x,b;s=new St({props:{title:"Subscription",editable:!1,fields:[{id:"planName",label:"Current Plan",initialValue:o[2]},{id:"planStatus",label:"Status",initialValue:((F=(P=o[7])==null?void 0:P.stripeSubscription)==null?void 0:F.status)??"N/A"},{id:"quantity",label:"Quantity",initialValue:((U=(O=(j=o[7])==null?void 0:j.stripeSubscription)==null?void 0:O.quantity)==null?void 0:U.toString())??"1"},...(Y=(Q=(z=o[7])==null?void 0:z.stripeSubscription)==null?void 0:Q.plan)!=null&&Y.interval?[{id:"interval",label:"Billing Interval",initialValue:o[7].stripeSubscription.plan.interval==="year"?"Annually":"Monthly"}]:[],{id:"nextBilling",label:"Next Billing Date",initialValue:(J=(G=o[7])==null?void 0:G.stripeSubscription)!=null&&J.current_period_end?new Date(o[7].stripeSubscription.current_period_end*1e3).toLocaleDateString():"N/A"}],editButtonTitle:"Manage Subscription",editLink:"/account/billing/manage"}});let d=o[0]&&rt(),c=o[1]&&st();return{c(){t=S("div"),e=S("h1"),e.textContent=i,u=E(),q(s.$$.fragment),n=E(),r=S("div"),l=S("button"),d&&d.c(),a=B(`\r
        Manage Subscription in Stripe Portal`),f=E(),c&&c.c(),this.h()},l(_){t=v(_,"DIV",{class:!0});var y=C(t);e=v(y,"H1",{class:!0,"data-svelte-h":!0}),D(e)!=="svelte-1s0bwqe"&&(e.textContent=i),u=k(y),L(s.$$.fragment,y),n=k(y),r=v(y,"DIV",{class:!0});var N=C(r);l=v(N,"BUTTON",{class:!0});var w=C(l);d&&d.l(w),a=H(w,`\r
        Manage Subscription in Stripe Portal`),w.forEach(m),N.forEach(m),f=k(y),c&&c.l(y),y.forEach(m),this.h()},h(){g(e,"class","mb-6 text-center text-2xl font-bold"),g(l,"class","btn btn-primary"),l.disabled=o[0],g(r,"class","mt-6 flex justify-center"),g(t,"class","container mx-auto px-4")},m(_,y){I(_,t,y),p(t,e),p(t,u),M(s,t,null),p(t,n),p(t,r),p(r,l),d&&d.m(l,null),p(l,a),p(t,f),c&&c.m(t,null),h=!0,x||(b=ut(l,"click",o[8]),x=!0)},p(_,y){var w,K,R,W,X,Z,tt,et,it,nt;const N={};y&4&&(N.fields=[{id:"planName",label:"Current Plan",initialValue:_[2]},{id:"planStatus",label:"Status",initialValue:((K=(w=_[7])==null?void 0:w.stripeSubscription)==null?void 0:K.status)??"N/A"},{id:"quantity",label:"Quantity",initialValue:((X=(W=(R=_[7])==null?void 0:R.stripeSubscription)==null?void 0:W.quantity)==null?void 0:X.toString())??"1"},...(et=(tt=(Z=_[7])==null?void 0:Z.stripeSubscription)==null?void 0:tt.plan)!=null&&et.interval?[{id:"interval",label:"Billing Interval",initialValue:_[7].stripeSubscription.plan.interval==="year"?"Annually":"Monthly"}]:[],{id:"nextBilling",label:"Next Billing Date",initialValue:(nt=(it=_[7])==null?void 0:it.stripeSubscription)!=null&&nt.current_period_end?new Date(_[7].stripeSubscription.current_period_end*1e3).toLocaleDateString():"N/A"}]),s.$set(N),_[0]?d||(d=rt(),d.c(),d.m(l,a)):d&&(d.d(1),d=null),(!h||y&1)&&(l.disabled=_[0]),_[1]?c?y&2&&V(c,1):(c=st(),c.c(),V(c,1),c.m(t,null)):c&&(gt(),$(c,1,1,()=>{c=null}),vt())},i(_){h||(V(s.$$.fragment,_),V(c),h=!0)},o(_){$(s.$$.fragment,_),$(c),h=!1},d(_){_&&m(t),T(s),d&&d.d(),c&&c.d(),x=!1,b()}}}function Ct(o){let t,e,i,u="Upgrade Your Account",s,n,r="Choose a paid plan to unlock additional features and capabilities",l,a,f,h;a=new dt({props:{currentPlanId:"free",useFullPrice:!0}});let x=o[6]&&It(o);return{c(){t=S("div"),e=S("div"),i=S("h1"),i.textContent=u,s=E(),n=S("p"),n.textContent=r,l=E(),q(a.$$.fragment),f=E(),x&&x.c(),this.h()},l(b){t=v(b,"DIV",{class:!0});var d=C(t);e=v(d,"DIV",{class:!0});var c=C(e);i=v(c,"H1",{class:!0,"data-svelte-h":!0}),D(i)!=="svelte-cdv42h"&&(i.textContent=u),s=k(c),n=v(c,"P",{class:!0,"data-svelte-h":!0}),D(n)!=="svelte-1814l9o"&&(n.textContent=r),l=k(c),L(a.$$.fragment,c),c.forEach(m),f=k(d),x&&x.l(d),d.forEach(m),this.h()},h(){g(i,"class","mb-4 text-center text-4xl font-bold"),g(n,"class","mb-8 text-center text-lg text-base-content/80"),g(e,"class","py-2"),g(t,"class","container mx-auto px-4")},m(b,d){I(b,t,d),p(t,e),p(e,i),p(e,s),p(e,n),p(e,l),M(a,e,null),p(t,f),x&&x.m(t,null),h=!0},p(b,d){b[6]&&x.p(b,d)},i(b){h||(V(a.$$.fragment,b),h=!0)},o(b){$(a.$$.fragment,b),h=!1},d(b){b&&m(t),T(a),x&&x.d()}}}function kt(o){let t,e,i="Error Loading Billing Information",u,s,n,r,l,a='<a href="/account/billing" class="rounded bg-primary px-4 py-2 text-white">Try Again</a>';return{c(){t=S("div"),e=S("h2"),e.textContent=i,u=E(),s=S("p"),n=B(o[4]),r=E(),l=S("div"),l.innerHTML=a,this.h()},l(f){t=v(f,"DIV",{class:!0});var h=C(t);e=v(h,"H2",{class:!0,"data-svelte-h":!0}),D(e)!=="svelte-ho2c7i"&&(e.textContent=i),u=k(h),s=v(h,"P",{class:!0});var x=C(s);n=H(x,o[4]),x.forEach(m),r=k(h),l=v(h,"DIV",{class:!0,"data-svelte-h":!0}),D(l)!=="svelte-qsfx7l"&&(l.innerHTML=a),h.forEach(m),this.h()},h(){g(e,"class","mb-4 text-xl font-bold text-red-700"),g(s,"class","text-red-600"),g(l,"class","mt-4"),g(t,"class","mx-auto my-8 max-w-xl rounded-lg bg-red-50 p-6 text-center")},m(f,h){I(f,t,h),p(t,e),p(t,u),p(t,s),p(s,n),p(t,r),p(t,l)},p:A,i:A,o:A,d(f){f&&m(t)}}}function Et(o){let t,e='<div class="skeleton h-12 w-12 rounded-full"></div>';return{c(){t=S("div"),t.innerHTML=e,this.h()},l(i){t=v(i,"DIV",{class:!0,"data-svelte-h":!0}),D(t)!=="svelte-1ab2xdg"&&(t.innerHTML=e),this.h()},h(){g(t,"class","flex h-48 items-center justify-center")},m(i,u){I(i,t,u)},p:A,i:A,o:A,d(i){i&&m(t)}}}function rt(o){let t;return{c(){t=S("span"),this.h()},l(e){t=v(e,"SPAN",{class:!0}),C(t).forEach(m),this.h()},h(){g(t,"class","loading loading-spinner loading-xs mr-2")},m(e,i){I(e,t,i)},d(e){e&&m(t)}}}function st(o){let t,e,i="Upgrade Options",u,s,n;return s=new dt({props:{currentPlanId:"free",useFullPrice:!0}}),{c(){t=S("div"),e=S("h2"),e.textContent=i,u=E(),q(s.$$.fragment),this.h()},l(r){t=v(r,"DIV",{class:!0});var l=C(t);e=v(l,"H2",{class:!0,"data-svelte-h":!0}),D(e)!=="svelte-166zgsd"&&(e.textContent=i),u=k(l),L(s.$$.fragment,l),l.forEach(m),this.h()},h(){g(e,"class","mb-6 text-center text-xl font-bold"),g(t,"class","mt-12")},m(r,l){I(r,t,l),p(t,e),p(t,u),M(s,t,null),n=!0},i(r){n||(V(s.$$.fragment,r),n=!0)},o(r){$(s.$$.fragment,r),n=!1},d(r){r&&m(t),T(s)}}}function It(o){let t,e,i,u,s,n=o[0]&&ot();return{c(){t=S("div"),e=S("button"),n&&n.c(),i=B(`\r
          View Past Invoices`),this.h()},l(r){t=v(r,"DIV",{class:!0});var l=C(t);e=v(l,"BUTTON",{class:!0});var a=C(e);n&&n.l(a),i=H(a,`\r
          View Past Invoices`),a.forEach(m),l.forEach(m),this.h()},h(){g(e,"class","btn btn-outline btn-sm"),e.disabled=o[0],g(t,"class","mt-10 text-center")},m(r,l){I(r,t,l),p(t,e),n&&n.m(e,null),p(e,i),u||(s=ut(e,"click",o[8]),u=!0)},p(r,l){r[0]?n||(n=ot(),n.c(),n.m(e,i)):n&&(n.d(1),n=null),l&1&&(e.disabled=r[0])},d(r){r&&m(t),n&&n.d(),u=!1,s()}}}function ot(o){let t;return{c(){t=S("span"),this.h()},l(e){t=v(e,"SPAN",{class:!0}),C(t).forEach(m),this.h()},h(){g(t,"class","loading loading-spinner loading-xs mr-2")},m(e,i){I(e,t,i)},d(e){e&&m(t)}}}function Vt(o){let t,e,i,u,s;const n=[Et,kt,Ct,Pt],r=[];function l(a,f){return a[3]?0:a[4]?1:a[5]?3:2}return e=l(o),i=r[e]=n[e](o),{c(){t=E(),i.c(),u=lt(),this.h()},l(a){mt("svelte-y42mya",document.head).forEach(m),t=k(a),i.l(a),u=lt(),this.h()},h(){document.title="Billing"},m(a,f){I(a,t,f),r[e].m(a,f),I(a,u,f),s=!0},p(a,[f]){i.p(a,f)},i(a){s||(V(i),s=!0)},o(a){$(i),s=!1},d(a){a&&(m(t),m(u)),r[e].d(a)}}}function Dt(o,t,e){var c;let i,u;ht("adminSection").set("billing");let{data:n}=t,r=n.loading,l=n.error,a=!1,f=n.currentPlanId||"free",h=n.isActiveCustomer||!1,x=n.hasEverHadSubscription||!1,b=n.subscriptionData;async function d(){try{e(0,a=!0);const P=await ct.createPortalSession();P.success&&P.url?window.location.href=P.url:at.error(P.message||"Failed to open billing portal")}catch(P){at.error("Error: "+(P.message||"Failed to open billing portal"))}finally{e(0,a=!1)}}return o.$$set=P=>{"data"in P&&e(9,n=P.data)},e(2,i=((c=b==null?void 0:b.appSubscription)==null?void 0:c.name)||"Free Plan"),e(1,u=f==="free"||!f||f==="none"),[a,u,i,r,l,h,x,b,d,n]}class qt extends bt{constructor(t){super(),_t(this,t,Dt,Vt,pt,{data:9})}}export{qt as component,Lt as universal};
