import{g as L}from"../chunks/entry.BMnqIGFd.js";import{s as M}from"../chunks/sessionStore.rIZpZ3yf.js";import{P as N,s as j,d as f,i as S,w as q,f as v,x as A,k as x,y as F,n as k,b as h,c as b,g as y,j as _,a as p,e as V,h as z,t as O}from"../chunks/scheduler.BVGjjnGO.js";import{S as Q,i as U,t as P,a as C,d as w,m as I,c as E,b as H,g as G,e as Y}from"../chunks/index.Vv2yv23T.js";import{S as J}from"../chunks/settings_module.Dc9kTMrV.js";import{P as T}from"../chunks/PricingSection.CZLwpf9A.js";import"../chunks/Toaster.svelte_svelte_type_style_lang.BcvbULy5.js";const K=async({parent:u})=>{await u();const t={loading:!0,isActiveCustomer:!1,hasEverHadSubscription:!1,currentPlanId:"free",subscriptionData:null,error:null};try{const e=N(M);if(!e?.access_token)return console.error("No valid session for billing page"),L("/login"),t;const n=await fetch("/api/customer/subscription",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e.access_token}`}});if(!n.ok){const r=await n.json();throw new Error(r.error||"Failed to fetch subscription data")}const l=await n.json();return{loading:!1,isActiveCustomer:!!l.primarySubscription,hasEverHadSubscription:l.hasEverHadSubscription,currentPlanId:l.primarySubscription?.appSubscription?.id||"free",subscriptionData:l.primarySubscription,error:null}}catch(e){return console.error("Error loading billing data:",e),{...t,loading:!1,error:e.message}}},R=!1,dt=Object.freeze(Object.defineProperty({__proto__:null,load:K,ssr:R},Symbol.toStringTag,{value:"Module"}));function W(u){let t,e,n="Billing",l,r,s,c;r=new J({props:{title:"Subscription",editable:!1,fields:[{id:"planName",label:"Current Plan",initialValue:u[1]},{id:"planStatus",label:"Status",initialValue:u[6]?.stripeSubscription?.status??"N/A"},{id:"quantity",label:"Quantity",initialValue:u[6]?.stripeSubscription?.quantity?.toString()??"1"},...u[6]?.stripeSubscription?.plan?.interval?[{id:"interval",label:"Billing Interval",initialValue:u[6].stripeSubscription.plan.interval==="year"?"Annually":"Monthly"}]:[],{id:"nextBilling",label:"Next Billing Date",initialValue:u[6]?.stripeSubscription?.current_period_end?new Date(u[6].stripeSubscription.current_period_end*1e3).toLocaleDateString():"N/A"}],editButtonTitle:"Manage Subscription",editLink:"/account/billing/manage"}});let a=u[0]&&B();return{c(){t=_("div"),e=_("h1"),e.textContent=n,l=x(),H(r.$$.fragment),s=x(),a&&a.c(),this.h()},l(i){t=b(i,"DIV",{class:!0});var o=V(t);e=b(o,"H1",{class:!0,"data-svelte-h":!0}),y(e)!=="svelte-1s0bwqe"&&(e.textContent=n),l=v(o),E(r.$$.fragment,o),s=v(o),a&&a.l(o),o.forEach(f),this.h()},h(){h(e,"class","mb-6 text-center text-2xl font-bold"),h(t,"class","container mx-auto px-4")},m(i,o){S(i,t,o),p(t,e),p(t,l),I(r,t,null),p(t,s),a&&a.m(t,null),c=!0},p(i,o){const d={};o&2&&(d.fields=[{id:"planName",label:"Current Plan",initialValue:i[1]},{id:"planStatus",label:"Status",initialValue:i[6]?.stripeSubscription?.status??"N/A"},{id:"quantity",label:"Quantity",initialValue:i[6]?.stripeSubscription?.quantity?.toString()??"1"},...i[6]?.stripeSubscription?.plan?.interval?[{id:"interval",label:"Billing Interval",initialValue:i[6].stripeSubscription.plan.interval==="year"?"Annually":"Monthly"}]:[],{id:"nextBilling",label:"Next Billing Date",initialValue:i[6]?.stripeSubscription?.current_period_end?new Date(i[6].stripeSubscription.current_period_end*1e3).toLocaleDateString():"N/A"}]),r.$set(d),i[0]?a?o&1&&C(a,1):(a=B(),a.c(),C(a,1),a.m(t,null)):a&&(G(),P(a,1,1,()=>{a=null}),Y())},i(i){c||(C(r.$$.fragment,i),C(a),c=!0)},o(i){P(r.$$.fragment,i),P(a),c=!1},d(i){i&&f(t),w(r),a&&a.d()}}}function X(u){let t,e,n,l="Upgrade Your Account",r,s,c="Choose a paid plan to unlock additional features and capabilities",a,i,o,d;i=new T({props:{currentPlanId:"free",useFullPrice:!0}});let m=u[5]&&et();return{c(){t=_("div"),e=_("div"),n=_("h1"),n.textContent=l,r=x(),s=_("p"),s.textContent=c,a=x(),H(i.$$.fragment),o=x(),m&&m.c(),this.h()},l(g){t=b(g,"DIV",{class:!0});var $=V(t);e=b($,"DIV",{class:!0});var D=V(e);n=b(D,"H1",{class:!0,"data-svelte-h":!0}),y(n)!=="svelte-cdv42h"&&(n.textContent=l),r=v(D),s=b(D,"P",{class:!0,"data-svelte-h":!0}),y(s)!=="svelte-1814l9o"&&(s.textContent=c),a=v(D),E(i.$$.fragment,D),D.forEach(f),o=v($),m&&m.l($),$.forEach(f),this.h()},h(){h(n,"class","mb-4 text-center text-4xl font-bold"),h(s,"class","mb-8 text-center text-lg text-base-content/80"),h(e,"class","py-2"),h(t,"class","container mx-auto px-4")},m(g,$){S(g,t,$),p(t,e),p(e,n),p(e,r),p(e,s),p(e,a),I(i,e,null),p(t,o),m&&m.m(t,null),d=!0},p:k,i(g){d||(C(i.$$.fragment,g),d=!0)},o(g){P(i.$$.fragment,g),d=!1},d(g){g&&f(t),w(i),m&&m.d()}}}function Z(u){let t,e,n="Error Loading Billing Information",l,r,s,c,a,i='<a href="/account/billing" class="rounded bg-primary px-4 py-2 text-white">Try Again</a>';return{c(){t=_("div"),e=_("h2"),e.textContent=n,l=x(),r=_("p"),s=O(u[3]),c=x(),a=_("div"),a.innerHTML=i,this.h()},l(o){t=b(o,"DIV",{class:!0});var d=V(t);e=b(d,"H2",{class:!0,"data-svelte-h":!0}),y(e)!=="svelte-ho2c7i"&&(e.textContent=n),l=v(d),r=b(d,"P",{class:!0});var m=V(r);s=z(m,u[3]),m.forEach(f),c=v(d),a=b(d,"DIV",{class:!0,"data-svelte-h":!0}),y(a)!=="svelte-qsfx7l"&&(a.innerHTML=i),d.forEach(f),this.h()},h(){h(e,"class","mb-4 text-xl font-bold text-red-700"),h(r,"class","text-red-600"),h(a,"class","mt-4"),h(t,"class","mx-auto my-8 max-w-xl rounded-lg bg-red-50 p-6 text-center")},m(o,d){S(o,t,d),p(t,e),p(t,l),p(t,r),p(r,s),p(t,c),p(t,a)},p:k,i:k,o:k,d(o){o&&f(t)}}}function tt(u){let t,e='<div class="skeleton h-12 w-12 rounded-full"></div>';return{c(){t=_("div"),t.innerHTML=e,this.h()},l(n){t=b(n,"DIV",{class:!0,"data-svelte-h":!0}),y(t)!=="svelte-1ab2xdg"&&(t.innerHTML=e),this.h()},h(){h(t,"class","flex h-48 items-center justify-center")},m(n,l){S(n,t,l)},p:k,i:k,o:k,d(n){n&&f(t)}}}function B(u){let t,e,n="Upgrade Options",l,r,s;return r=new T({props:{currentPlanId:"free",useFullPrice:!0}}),{c(){t=_("div"),e=_("h2"),e.textContent=n,l=x(),H(r.$$.fragment),this.h()},l(c){t=b(c,"DIV",{class:!0});var a=V(t);e=b(a,"H2",{class:!0,"data-svelte-h":!0}),y(e)!=="svelte-166zgsd"&&(e.textContent=n),l=v(a),E(r.$$.fragment,a),a.forEach(f),this.h()},h(){h(e,"class","mb-6 text-center text-xl font-bold"),h(t,"class","mt-12")},m(c,a){S(c,t,a),p(t,e),p(t,l),I(r,t,null),s=!0},i(c){s||(C(r.$$.fragment,c),s=!0)},o(c){P(r.$$.fragment,c),s=!1},d(c){c&&f(t),w(r)}}}function et(u){let t,e='<a href="/account/billing/manage" class="link">View past invoices</a>';return{c(){t=_("div"),t.innerHTML=e,this.h()},l(n){t=b(n,"DIV",{class:!0,"data-svelte-h":!0}),y(t)!=="svelte-1tjb8ac"&&(t.innerHTML=e),this.h()},h(){h(t,"class","mt-10 text-center")},m(n,l){S(n,t,l)},d(n){n&&f(t)}}}function it(u){let t,e,n,l,r;const s=[tt,Z,X,W],c=[];function a(i,o){return i[2]?0:i[3]?1:i[4]?3:2}return e=a(u),n=c[e]=s[e](u),{c(){t=x(),n.c(),l=A(),this.h()},l(i){q("svelte-y42mya",document.head).forEach(f),t=v(i),n.l(i),l=A(),this.h()},h(){document.title="Billing"},m(i,o){S(i,t,o),c[e].m(i,o),S(i,l,o),r=!0},p(i,[o]){n.p(i,o)},i(i){r||(C(n),r=!0)},o(i){P(n),r=!1},d(i){i&&(f(t),f(l)),c[e].d(i)}}}function nt(u,t,e){let n,l;F("adminSection").set("billing");let{data:s}=t,c=s.loading,a=s.error,i=s.currentPlanId||"free",o=s.isActiveCustomer||!1,d=s.hasEverHadSubscription||!1,m=s.subscriptionData;return u.$$set=g=>{"data"in g&&e(7,s=g.data)},e(1,n=m?.appSubscription?.name||"Free Plan"),e(0,l=i==="free"||!i||i==="none"),[l,n,c,a,o,d,m,s]}class pt extends Q{constructor(t){super(),U(this,t,nt,it,j,{data:7})}}export{pt as component,dt as universal};
