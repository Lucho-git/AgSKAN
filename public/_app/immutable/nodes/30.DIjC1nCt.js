import{s as T,n as D,d as f,i as O,a as m,b as h,c as v,e as y,j as g,l as A,D as R,v as H,q as W,w as z,r as B,f as k,g as G,h as J,k as F,t as K}from"../chunks/DjMlahvE.js";import{S as L,i as M,d as Q,t as X,a as Y,m as Z,c as ee,b as te}from"../chunks/KhAD1Hhl.js";import{p as re}from"../chunks/Dr5d5awD.js";import{s as oe}from"../chunks/BaPH9Oqq.js";import{g as P}from"../chunks/CsvQbYGG.js";import{a as se}from"../chunks/DSS83BMa.js";import{p as U}from"../chunks/C1kVPyTF.js";import{C as ne}from"../chunks/DU-NpqEO.js";function ae(d){let s,r;return{c(){s=g("div"),r=g("div"),this.h()},l(t){s=v(t,"DIV",{class:!0});var o=y(s);r=v(o,"DIV",{id:!0,class:!0}),y(r).forEach(f),o.forEach(f),this.h()},h(){h(r,"id","container_"+C),h(r,"class","min-h-[90vh] overflow-auto"),h(s,"class","mx-auto max-w-2xl overflow-auto rounded-lg bg-green-200 p-4 shadow-md")},m(t,o){O(t,s,o),m(s,r)},p:D,i:D,o:D,d(t){t&&f(s)}}}const C="7d624884-1198-4af8-b49d-4b8b5efcb85c",q="AgSkan SurveyReal";function ie(d,s,r){let t;A(d,re,p=>r(2,t=p));const o=R();let n;return H(async()=>{const p=t.data.session;p&&(n=p.user.id);const c=document.createElement("script");return c.src="https://cdn.jsdelivr.net/npm/@feathery/react@latest/umd/index.js",c.async=!0,c.onload=()=>{Feathery.init(C),n&&Feathery.updateUserId(n),Feathery.renderAt(`container_${C}`,{formName:q,initialLoader:{show:!0,loader:`
                    <div class="flex flex-col items-center space-y-4">
                            <div class="skeleton mb-4 h-12 w-12 rounded-full"></div>

                      <p class="text-lg text-primary-content">Loading form...</p>
                    </div>
                  `,initialContainerHeight:"600px",initialContainerWidth:"100%"},onFormComplete:async l=>{const e={};for(const[u,a]of Object.entries(l.fields))u.startsWith("feathery.")||(e[u]=a.value||null);try{const{error:u}=await oe.from("user_survey").upsert({user_id:n,response:{answers:e,form_id:C,form_name:q,submitted_at:new Date().toISOString()}},{onConflict:"user_id"});u?console.error("Error storing survey response:",u):(console.log("Survey response stored successfully"),o("complete"),P("/account/payment_plans").catch(a=>{console.error("Navigation error:",a)}))}catch(u){console.error("Error storing survey response:",u)}}})},document.head.appendChild(c),()=>{c.parentNode&&document.head.removeChild(c)}}),[]}class ce extends L{constructor(s){super(),M(this,s,ie,ae,T,{})}}const le=()=>({}),be=Object.freeze(Object.defineProperty({__proto__:null,load:le},Symbol.toStringTag,{value:"Module"}));function de(d){let s,r,t,o,n,p="User Survey",c,l,e,u,a,x=d[0]?"Processing...":"Skip Survey",S,_,I,j;return e=new ce({}),e.$on("complete",d[1]),{c(){s=F(),r=g("div"),t=g("div"),o=g("div"),n=g("h1"),n.textContent=p,c=F(),l=g("div"),te(e.$$.fragment),u=F(),a=g("button"),S=K(x),this.h()},l(i){B("svelte-1tnm1ny",document.head).forEach(f),s=k(i),r=v(i,"DIV",{class:!0});var $=y(r);t=v($,"DIV",{class:!0});var N=y(t);o=v(N,"DIV",{});var w=y(o);n=v(w,"H1",{class:!0,"data-svelte-h":!0}),G(n)!=="svelte-jwlscb"&&(n.textContent=p),c=k(w),l=v(w,"DIV",{class:!0});var E=y(l);ee(e.$$.fragment,E),u=k(E),a=v(E,"BUTTON",{type:!0,class:!0});var V=y(a);S=J(V,x),V.forEach(f),E.forEach(f),w.forEach(f),N.forEach(f),$.forEach(f),this.h()},h(){document.title="User Survey",h(n,"class","mb-6 text-2xl font-bold"),h(a,"type","button"),h(a,"class","btn btn-secondary mt-4"),a.disabled=d[0],h(l,"class","form-container"),h(t,"class","flex w-full flex-col px-6"),h(r,"class","mb-12 mt-4 flex min-h-[100vh] place-content-center content-center items-center text-center")},m(i,b){O(i,s,b),O(i,r,b),m(r,t),m(t,o),m(o,n),m(o,c),m(o,l),Z(e,l,null),m(l,u),m(l,a),m(a,S),_=!0,I||(j=z(a,"click",d[2]),I=!0)},p(i,[b]){(!_||b&1)&&x!==(x=i[0]?"Processing...":"Skip Survey")&&W(S,x),(!_||b&1)&&(a.disabled=i[0])},i(i){_||(Y(e.$$.fragment,i),_=!0)},o(i){X(e.$$.fragment,i),_=!1},d(i){i&&(f(s),f(r)),Q(e),I=!1,j()}}}function ue(d,s,r){let t;A(d,U,e=>r(4,t=e));let o=!1,n=!1;H(()=>{{try{n=ne.isNativePlatform(),console.log("Is running on native platform:",n)}catch(e){console.error("Error checking native platform:",e),n=!1}t!=null&&t.id&&console.log("Profile found, but letting user complete survey")}});async function p(){if(!(t!=null&&t.id)){console.error("Cannot update onboarding status: profile ID is undefined");return}try{return await se.from("profiles").update({onboarded:!0,updated_at:new Date().toISOString()}).eq("id",t.id),U.update(e=>({...e,onboarded:!0})),console.log("Onboarding status updated successfully"),!0}catch(e){return console.error("Error updating onboarded status:",e),!1}}async function c(){console.log("Survey completed!"),r(0,o=!0);try{await p();const e=n?"/account":"/account/payment_plans";console.log("Redirecting to:",e),await P(e)}catch(e){console.error("Error during post-survey redirect:",e)}finally{r(0,o=!1)}}async function l(){r(0,o=!0);try{await p();const e=n?"/account":"/account/payment_plans";console.log("Skipping survey, redirecting to:",e),await P(e)}catch(e){console.error("Error navigating:",e)}finally{r(0,o=!1)}}return[o,c,l]}class xe extends L{constructor(s){super(),M(this,s,ue,de,T,{})}}export{xe as component,be as universal};
