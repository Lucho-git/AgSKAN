import{s as w,n as i,d as g,i as b,b as y,c as _,g as v,j as k,l as S,z as j}from"../chunks/Bqk-ehBx.js";import{S as x,i as T}from"../chunks/BSIXs_Xe.js";import{g as l}from"../chunks/BvwL7t0j.js";import{s as E}from"../chunks/DsDOFx4q.js";import{t as u}from"../chunks/7sStqI9Q.js";const F=!1,C=({params:t})=>({slug:t.slug}),q=Object.freeze(Object.defineProperty({__proto__:null,load:C,prerender:F},Symbol.toStringTag,{value:"Module"})),P=async({session:t})=>{try{if(!(t!=null&&t.access_token))return{error:"No valid session"};const e=await fetch("/api/subscription/free",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t.access_token}`}});if(!e.ok){const n=await e.json();throw new Error(n.message||"Failed to create free subscription")}return{error:null}}catch(e){return console.error("Error in createFreeSubscription:",e),{error:e.message}}},z=async({session:t,priceId:e,seats:n=1,discount:o=!1,discountcode:s=null})=>{try{if(!(t!=null&&t.access_token))return{error:"No valid session",stripeUrl:null};const r=await fetch("/api/subscription/checkout",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t.access_token}`},body:JSON.stringify({priceId:e,seats:n,discount:o,discountcode:s})});if(!r.ok){const c=await r.json();throw new Error(c.message||"Failed to create checkout session")}const{stripeUrl:a}=await r.json();return{error:null,stripeUrl:a}}catch(r){return console.error("Error in createCheckoutSession:",r),{error:r.message,stripeUrl:null}}};function O(t){let e,n='<div class="flex flex-col items-center justify-center"><div class="h-16 w-16 animate-spin rounded-full border-4 border-primary border-t-transparent"></div> <p class="mt-4 text-lg">Processing payment information...</p></div>';return{c(){e=k("div"),e.innerHTML=n,this.h()},l(o){e=_(o,"DIV",{class:!0,"data-svelte-h":!0}),v(e)!=="svelte-1wd3opu"&&(e.innerHTML=n),this.h()},h(){y(e,"class","fixed inset-0 z-50 flex items-center justify-center bg-base-100 bg-opacity-50 backdrop-blur-sm")},m(o,s){b(o,e,s)},p:i,i,o:i,d(o){o&&g(e)}}}function U(t,e,n){let o;S(t,E,r=>n(1,o=r));let{data:s}=e;return j(async()=>{try{if(s.error){u.error(s.error),setTimeout(()=>l("/account/payment_plans"),2e3);return}if(!o)throw new Error("Authentication required");const r=new URLSearchParams(window.location.search),a=window.location.pathname.split("/").pop();if(a==="free_plan"){const{error:m}=await P({session:o});if(m)throw new Error(`Failed to activate free plan: ${m}`);u.success("Free plan activated!"),l("/account");return}const c=parseInt(r.get("seats")||"1"),f=r.get("discount")==="true",h=r.get("discountcode"),{error:p,stripeUrl:d}=await z({session:o,priceId:a,seats:c,discount:f,discountcode:h});if(p||!d)throw new Error(p||"Failed to create checkout session");window.location.href=d}catch(r){console.error("Error:",r),u.error(r.message||"An unexpected error occurred"),setTimeout(()=>l("/account/payment_plans"),2e3)}}),t.$$set=r=>{"data"in r&&n(0,s=r.data)},[s]}class B extends x{constructor(e){super(),T(this,e,U,O,w,{data:0})}}export{B as component,q as universal};
