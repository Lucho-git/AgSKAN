import{r as Ie}from"../chunks/index.3feb4388.js";import{s as De,a as C,e as u,t as W,x as Le,d as c,f as N,c as i,b as P,g as K,h as G,i as e,j as J,k as r,U as F,B as re,q as Me,n as Ne,K as Te}from"../chunks/scheduler.78aa6f0d.js";import{S as xe,i as Se}from"../chunks/index.9a12d9f3.js";/* empty css                    */import{g as qe}from"../chunks/navigation.dd464073.js";import{u as Ve}from"../chunks/authHelpers.e01f0d27.js";import{t as He}from"../chunks/Toaster.svelte_svelte_type_style_lang.006f4a9b.js";import{s as me}from"../chunks/supabaseClient.f7f11bf4.js";async function ke({parent:a}){throw await a(),Ie(303,"/account/user_survey")}const We=Object.freeze(Object.defineProperty({__proto__:null,load:ke},Symbol.toStringTag,{value:"Module"}));function Pe(a){var h;let m,t,f,n=(((h=a[0])==null?void 0:h.errorMessage)||a[5])+"",v;return{c(){m=u("div"),t=C(),f=u("p"),v=W(n),this.h()},l(o){m=i(o,"DIV",{class:!0}),P(m).forEach(c),t=N(o),f=i(o,"P",{class:!0});var s=P(f);v=G(s,n),s.forEach(c),this.h()},h(){e(m,"class","mt-4"),e(f,"class","mt-3 text-center text-sm font-bold text-red-700")},m(o,s){J(o,m,s),J(o,t,s),J(o,f,s),r(f,v)},p(o,s){var p;s&33&&n!==(n=(((p=o[0])==null?void 0:p.errorMessage)||o[5])+"")&&Me(v,n)},d(o){o&&(c(m),c(t),c(f))}}}function Ae(a){var ve,ge,we;let m,t,f,n,v,h="Create Profile",o,s,p,g,I='<span class="label-text">Name</span>',j,b,B,Y,D,d,L='<span class="label-text">Company Name</span>',S,w,q,se,V,H,pe='<span class="label-text">Company Website</span>',ae,E,Q,le,X,O,x,R=a[1]?"...":"Create Profile",Z,oe,M,ne,_e=((ge=(ve=a[6])==null?void 0:ve.user)==null?void 0:ge.email)+"",ue,ie,de,fe,k,he="Sign out",ce,be,_=(((we=a[0])==null?void 0:we.errorMessage)||a[5])&&Pe(a);return{c(){m=C(),t=u("div"),f=u("div"),n=u("div"),v=u("h1"),v.textContent=h,o=C(),s=u("form"),p=u("div"),g=u("label"),g.innerHTML=I,j=C(),b=u("input"),Y=C(),D=u("div"),d=u("label"),d.innerHTML=L,S=C(),w=u("input"),se=C(),V=u("div"),H=u("label"),H.innerHTML=pe,ae=C(),E=u("input"),le=C(),_&&_.c(),X=C(),O=u("div"),x=u("button"),Z=W(R),oe=C(),M=u("div"),ne=W("You are logged in as "),ue=W(_e),ie=W(`.\r
        `),de=u("br"),fe=C(),k=u("a"),k.textContent=he,this.h()},l(l){Le("svelte-uj7g5q",document.head).forEach(c),m=N(l),t=i(l,"DIV",{class:!0});var z=P(t);f=i(z,"DIV",{class:!0});var ye=P(f);n=i(ye,"DIV",{});var U=P(n);v=i(U,"H1",{class:!0,"data-svelte-h":!0}),K(v)!=="svelte-1p9sc6d"&&(v.textContent=h),o=N(U),s=i(U,"FORM",{class:!0});var T=P(s);p=i(T,"DIV",{class:!0});var $=P(p);g=i($,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),K(g)!=="svelte-g3q01w"&&(g.innerHTML=I),j=N($),b=i($,"INPUT",{id:!0,type:!0,placeholder:!0,class:!0}),$.forEach(c),Y=N(T),D=i(T,"DIV",{class:!0});var ee=P(D);d=i(ee,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),K(d)!=="svelte-16532ax"&&(d.innerHTML=L),S=N(ee),w=i(ee,"INPUT",{id:!0,type:!0,placeholder:!0,class:!0}),ee.forEach(c),se=N(T),V=i(T,"DIV",{class:!0});var te=P(V);H=i(te,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),K(H)!=="svelte-1fqkhyk"&&(H.innerHTML=pe),ae=N(te),E=i(te,"INPUT",{id:!0,type:!0,placeholder:!0,class:!0}),te.forEach(c),le=N(T),_&&_.l(T),X=N(T),O=i(T,"DIV",{class:!0});var Ee=P(O);x=i(Ee,"BUTTON",{type:!0,class:!0});var Ce=P(x);Z=G(Ce,R),Ce.forEach(c),Ee.forEach(c),T.forEach(c),oe=N(U),M=i(U,"DIV",{class:!0});var A=P(M);ne=G(A,"You are logged in as "),ue=G(A,_e),ie=G(A,`.\r
        `),de=i(A,"BR",{}),fe=N(A),k=i(A,"A",{class:!0,href:!0,"data-svelte-h":!0}),K(k)!=="svelte-bkrsgd"&&(k.textContent=he),A.forEach(c),U.forEach(c),ye.forEach(c),z.forEach(c),this.h()},h(){document.title="Create Profile",e(v,"class","mb-6 text-2xl font-bold"),e(g,"for","fullName"),e(g,"class","label"),e(b,"id","fullName"),e(b,"type","text"),e(b,"placeholder","Your full name"),e(b,"class",B=(a[7](a[0],"fullName")?"input-error":"")+" input input-bordered mt-1 w-full max-w-xs border-2 border-primary"),b.required=!0,e(p,"class","mt-4"),e(d,"for","companyName"),e(d,"class","label"),e(w,"id","companyName"),e(w,"type","text"),e(w,"placeholder","Homewood Farms"),e(w,"class",q=(a[7](a[0],"companyName")?"input-error":"")+" input input-bordered mt-1 w-full max-w-xs"),e(D,"class","mt-4"),e(H,"for","website"),e(H,"class","label"),e(E,"id","website"),e(E,"type","text"),e(E,"placeholder","Company.com"),e(E,"class",Q=(a[7](a[0],"website")?"input-error":"")+" input input-bordered mt-1 w-full max-w-xs"),e(V,"class","mt-4"),e(x,"type","submit"),e(x,"class","btn btn-primary btn-wide mt-3"),x.disabled=a[1],e(O,"class","mt-4"),e(s,"class","form-widget"),e(k,"class","underline"),e(k,"href","/features/"),e(M,"class","mt-14 text-sm text-slate-800"),e(f,"class","flex w-64 flex-col lg:w-80"),e(t,"class","mx-auto mb-12 flex min-h-[100vh] max-w-lg place-content-center content-center items-center text-center")},m(l,y){J(l,m,y),J(l,t,y),r(t,f),r(f,n),r(n,v),r(n,o),r(n,s),r(s,p),r(p,g),r(p,j),r(p,b),F(b,a[2]),r(s,Y),r(s,D),r(D,d),r(D,S),r(D,w),F(w,a[3]),r(s,se),r(s,V),r(V,H),r(V,ae),r(V,E),F(E,a[4]),r(s,le),_&&_.m(s,null),r(s,X),r(s,O),r(O,x),r(x,Z),r(n,oe),r(n,M),r(M,ne),r(M,ue),r(M,ie),r(M,de),r(M,fe),r(M,k),ce||(be=[re(b,"input",a[10]),re(w,"input",a[11]),re(E,"input",a[12]),re(s,"submit",a[8])],ce=!0)},p(l,[y]){var z;y&1&&B!==(B=(l[7](l[0],"fullName")?"input-error":"")+" input input-bordered mt-1 w-full max-w-xs border-2 border-primary")&&e(b,"class",B),y&4&&b.value!==l[2]&&F(b,l[2]),y&1&&q!==(q=(l[7](l[0],"companyName")?"input-error":"")+" input input-bordered mt-1 w-full max-w-xs")&&e(w,"class",q),y&8&&w.value!==l[3]&&F(w,l[3]),y&1&&Q!==(Q=(l[7](l[0],"website")?"input-error":"")+" input input-bordered mt-1 w-full max-w-xs")&&e(E,"class",Q),y&16&&E.value!==l[4]&&F(E,l[4]),(z=l[0])!=null&&z.errorMessage||l[5]?_?_.p(l,y):(_=Pe(l),_.c(),_.m(s,X)):_&&(_.d(1),_=null),y&2&&R!==(R=l[1]?"...":"Create Profile")&&Me(Z,R),y&2&&(x.disabled=l[1])},i:Ne,o:Ne,d(l){l&&(c(m),c(t)),_&&_.d(),ce=!1,Te(be)}}}function Be(a,m,t){let{data:f}=m,{form:n}=m,{session:v,profile:h}=f,o=!1,s=(h==null?void 0:h.full_name)??"",p=(h==null?void 0:h.company_name)??"",g=(h==null?void 0:h.website)??"",I=null;const j=(d,L)=>((d==null?void 0:d.errorFields)??[]).includes(L),b=async d=>{d.preventDefault(),t(1,o=!0);try{if(!s){t(5,I="Name is required"),t(0,n={errorMessage:"Name is required",errorFields:["fullName"]}),t(1,o=!1);return}const{error:L}=await me.auth.updateUser({data:{full_name:s}});if(L){console.error("Error updating user metadata:",L),t(5,I=L.message||"Failed to update user data"),t(1,o=!1);return}const{data:S}=await me.auth.getSession();if(!S.session){t(5,I="Session not found"),t(1,o=!1);return}if(!await Ve(S.session)){t(5,I="Failed to create profile"),t(1,o=!1);return}const{error:q}=await me.from("profiles").update({company_name:p,website:g,updated_at:new Date().toISOString()}).eq("id",S.session.user.id);if(q){console.error("Error updating additional profile fields:",q),t(5,I=q.message||"Failed to update profile details"),t(1,o=!1);return}He.success("Profile created successfully"),console.log("Profile created successfully"),qe("/account/user_survey")}catch(L){console.error("Error in profile creation:",L),t(5,I="An unexpected error occurred. Please try again."),t(0,n={errorMessage:"An unexpected error occurred. Please try again.",errorFields:[]})}finally{t(1,o=!1)}};function B(){s=this.value,t(2,s)}function Y(){p=this.value,t(3,p)}function D(){g=this.value,t(4,g)}return a.$$set=d=>{"data"in d&&t(9,f=d.data),"form"in d&&t(0,n=d.form)},a.$$.update=()=>{a.$$.dirty&1&&n&&console.log("Form result:",n)},[n,o,s,p,g,I,v,j,b,f,B,Y,D]}class Ge extends xe{constructor(m){super(),Se(this,m,Be,Ae,De,{data:9,form:0})}}export{Ge as component,We as universal};
