import{s as K,a as A,e as P,w as G,x as Q,d as m,f as I,c as k,g as M,i as y,j as C,l as R,y as W,z as X,A as Z,t as D,b as F,h as H,k as w,B as $,q as ee,n as B}from"../chunks/scheduler.0ff5556b.js";import{S as te,i as se,b as O,e as ne,t as q,g as oe,c as ae,a as le,m as re,d as ie}from"../chunks/index.e3d1f712.js";import{p as ue}from"../chunks/stores.1e905000.js";import{S as ce}from"../chunks/settings_module.a3a4224b.js";import{s as de,a as fe}from"../chunks/sessionStore.a0feee67.js";import{g as J}from"../chunks/navigation.2ad273ee.js";import{u as me}from"../chunks/userSettingsApi.8deef40c.js";function he(l){var j,L;let e,t,n,s,r,o=((L=(j=l[5])==null?void 0:j.user)==null?void 0:L.email)+"",i,b,E,u,c,a,f,h,d,_,V,v;function U(p,S){return p[1]?be:we}let N=U(l),x=N(l);return{c(){e=P("div"),t=P("div"),x.c(),n=A(),s=P("div"),r=D("The button below will send you an email at "),i=D(o),b=D(` which\r
        will allow you to set your password.`),E=A(),u=P("button"),c=D("Send Set Password Email"),f=A(),h=P("div"),d=D(`Sent email! Please check your inbox and use the link to set your\r
        password.`),this.h()},l(p){e=k(p,"DIV",{class:!0});var S=F(e);t=k(S,"DIV",{class:!0});var g=F(t);x.l(g),n=I(g),s=k(g,"DIV",{});var T=F(s);r=H(T,"The button below will send you an email at "),i=H(T,o),b=H(T,` which\r
        will allow you to set your password.`),T.forEach(m),E=I(g),u=k(g,"BUTTON",{class:!0});var Y=F(u);c=H(Y,"Send Set Password Email"),Y.forEach(m),f=I(g),h=k(g,"DIV",{class:!0});var z=F(h);d=H(z,`Sent email! Please check your inbox and use the link to set your\r
        password.`),z.forEach(m),g.forEach(m),S.forEach(m),this.h()},h(){y(u,"class",a="btn btn-outline btn-wide "+(l[4]?"hidden":"")),y(h,"class",_="success alert alert-success "+(l[4]?"":"hidden")),y(t,"class","flex flex-col gap-y-4"),y(e,"class","card mt-8 flex max-w-md max-w-xl flex-col p-6 pb-7 shadow md:flex-row")},m(p,S){C(p,e,S),w(e,t),x.m(t,null),w(t,n),w(t,s),w(s,r),w(s,i),w(s,b),w(t,E),w(t,u),w(u,c),l[9](u),w(t,f),w(t,h),w(h,d),V||(v=$(u,"click",l[8]),V=!0)},p(p,S){var g,T;N!==(N=U(p))&&(x.d(1),x=N(p),x&&(x.c(),x.m(t,n))),S&32&&o!==(o=((T=(g=p[5])==null?void 0:g.user)==null?void 0:T.email)+"")&&ee(i,o),S&16&&a!==(a="btn btn-outline btn-wide "+(p[4]?"hidden":""))&&y(u,"class",a),S&16&&_!==(_="success alert alert-success "+(p[4]?"":"hidden"))&&y(h,"class",_)},i:B,o:B,d(p){p&&m(e),x.d(),l[9](null),V=!1,v()}}}function pe(l){let e,t;return e=new ce({props:{title:"Change Password",editable:!0,saveButtonTitle:"Change Password",successTitle:"Password Changed",successBody:"On next sign in, use your new password.",apiHandler:l[6],fields:[{id:"newPassword1",label:"New Password",initialValue:"",inputType:"password"},{id:"newPassword2",label:"Confirm New Password",initialValue:"",inputType:"password"},{id:"currentPassword",label:"Current Password",initialValue:"",inputType:"password"}]}}),e.$on("success",l[7]),{c(){ae(e.$$.fragment)},l(n){le(e.$$.fragment,n)},m(n,s){re(e,n,s),t=!0},p:B,i(n){t||(q(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){ie(e,n)}}}function _e(l){let e,t='<div class="loading loading-spinner loading-lg"></div>';return{c(){e=P("div"),e.innerHTML=t,this.h()},l(n){e=k(n,"DIV",{class:!0,"data-svelte-h":!0}),M(e)!=="svelte-asr66p"&&(e.innerHTML=t),this.h()},h(){y(e,"class","flex h-64 items-center justify-center")},m(n,s){C(n,e,s)},p:B,i:B,o:B,d(n){n&&m(e)}}}function we(l){let e,t="Change Password By Email";return{c(){e=P("div"),e.textContent=t,this.h()},l(n){e=k(n,"DIV",{class:!0,"data-svelte-h":!0}),M(e)!=="svelte-wb4o62"&&(e.textContent=t),this.h()},h(){y(e,"class","font-bold")},m(n,s){C(n,e,s)},d(n){n&&m(e)}}}function be(l){let e,t="Set Password By Email",n,s,r=`You use oAuth to sign in ("Sign in with Github" or similar). You can\r
          continue to access your account using only oAuth if you like!`;return{c(){e=P("div"),e.textContent=t,n=A(),s=P("div"),s.textContent=r,this.h()},l(o){e=k(o,"DIV",{class:!0,"data-svelte-h":!0}),M(e)!=="svelte-e40ftg"&&(e.textContent=t),n=I(o),s=k(o,"DIV",{"data-svelte-h":!0}),M(s)!=="svelte-kym5a6"&&(s.textContent=r),this.h()},h(){y(e,"class","font-bold")},m(o,i){C(o,e,i),C(o,n,i),C(o,s,i)},d(o){o&&(m(e),m(n),m(s))}}}function ge(l){let e,t,n="Change Password",s,r,o,i,b;const E=[_e,pe,he],u=[];function c(a,f){return a[2]?0:a[0]?1:2}return r=c(l),o=u[r]=E[r](l),{c(){e=A(),t=P("h1"),t.textContent=n,s=A(),o.c(),i=G(),this.h()},l(a){Q("svelte-cgsnq8",document.head).forEach(m),e=I(a),t=k(a,"H1",{class:!0,"data-svelte-h":!0}),M(t)!=="svelte-1thmec9"&&(t.textContent=n),s=I(a),o.l(a),i=G(),this.h()},h(){document.title="Change Password",y(t,"class","mb-6 text-2xl font-bold")},m(a,f){C(a,e,f),C(a,t,f),C(a,s,f),u[r].m(a,f),C(a,i,f),b=!0},p(a,[f]){let h=r;r=c(a),r===h?u[r].p(a,f):(oe(),O(u[h],1,1,()=>{u[h]=null}),ne(),o=u[r],o?o.p(a,f):(o=u[r]=E[r](a),o.c()),q(o,1),o.m(i.parentNode,i))},i(a){b||(q(o),b=!0)},o(a){O(o),b=!1},d(a){a&&(m(e),m(t),m(s),m(i)),u[r].d(a)}}}function ve(l,e,t){let n,s;R(l,ue,d=>t(11,n=d)),R(l,de,d=>t(5,s=d)),W("adminSection").set("settings");let o=!1,i=!1,b=!0;X(async()=>{var d,_,V;if(!s){J("/login");return}if(console.log("Session user:",s.user),(_=(d=s.user)==null?void 0:d.app_metadata)!=null&&_.provider){const v=s.user.app_metadata.provider;console.log("Auth provider:",v),v==="email"?t(0,o=!0):v!=="email"&&t(1,i=!0)}(V=s.user)!=null&&V.amr&&(console.log("User AMR:",s.user.amr),t(0,o=!!s.user.amr.find(v=>v.method==="password")),t(1,i=!!s.user.amr.find(v=>v.method==="oauth"))),console.log("hasPassword:",o),console.log("usingOAuth:",i),t(2,b=!1)});async function E(d){return await me.updatePassword(d.newPassword1,d.newPassword2,d.currentPassword)}function u(){setTimeout(()=>{J("/account/settings")},1500)}let c,a=!1;async function f(){var d;if((d=s==null?void 0:s.user)!=null&&d.email){c&&(t(3,c.disabled=!0,c),t(3,c.textContent="Sending...",c));try{const{error:_}=await fe.auth.resetPasswordForEmail(s.user.email,{redirectTo:`${n.url.origin}/auth/callback?next=%2Faccount%2Fsettings%2Freset_password`});if(_)throw _;t(4,a=!0)}catch(_){console.error("Error sending password reset email:",_),c&&(t(3,c.disabled=!1,c),t(3,c.textContent="Send Set Password Email",c))}finally{}}}function h(d){Z[d?"unshift":"push"](()=>{c=d,t(3,c)})}return[o,i,b,c,a,s,E,u,f,h]}class Te extends te{constructor(e){super(),se(this,e,ve,ge,K,{})}}export{Te as component};
