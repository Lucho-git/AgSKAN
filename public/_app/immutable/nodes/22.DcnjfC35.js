import{s as De,d as p,i as x,a,b as r,c as f,e as C,g as $,f as j,j as m,k as q,l as de,K as ne,q as se,U as te,A as R,h as X,t as Y,E as pe,F as fe}from"../chunks/scheduler.BVGjjnGO.js";import{S as Ne,i as Ae,t as Z,a as Q,e as Ce,d as oe,m as ie,c as ue,b as ce,g as Se}from"../chunks/index.Vv2yv23T.js";import{g as Pe}from"../chunks/entry.CJi6DTPP.js";import{a as le}from"../chunks/sessionStore.rIZpZ3yf.js";import{p as me}from"../chunks/profileStore.DorDk9Q6.js";import{c as _e}from"../chunks/connectedMapStore.vcjAOVZs.js";import{m as he}from"../chunks/mapActivityStore.BMkPVnUJ.js";import{o as be,s as ve}from"../chunks/operationStore.DMok4-vU.js";import{t as ae}from"../chunks/Toaster.svelte_svelte_type_style_lang.BcvbULy5.js";import{m as Ve}from"../chunks/mapApi.9Dr9dk0j.js";import{U as Me}from"../chunks/user.BJPAgWns.js";import{M as Te}from"../chunks/map.BkoRjuUv.js";const Le=()=>({}),Ye=Object.freeze(Object.defineProperty({__proto__:null,load:Le},Symbol.toStringTag,{value:"Module"}));function je(s){let t,e,l,g,v,d,i,u,h="Full Name",w,k,c,I,b,B,S,O,T,N="I'll add my map ID later",y,_,n,M=s[0]?"Continue Setup":"Complete Setup",V,D,U,z,J,L=s[6]&&ge(s);d=new Me({props:{size:18,class:"text-base-content/70"}});let P=!s[0]&&ke(s),E=s[8]&&we();return{c(){L&&L.c(),t=q(),e=m("div"),l=m("div"),g=m("div"),v=m("label"),ce(d.$$.fragment),i=q(),u=m("span"),u.textContent=h,w=q(),k=m("input"),c=q(),P&&P.c(),I=q(),b=m("div"),B=m("label"),S=m("input"),O=q(),T=m("span"),T.textContent=N,y=q(),_=m("button"),E&&E.c(),n=q(),V=Y(M),this.h()},l(o){L&&L.l(o),t=j(o),e=f(o,"DIV",{class:!0});var A=C(e);l=f(A,"DIV",{class:!0});var F=C(l);g=f(F,"DIV",{class:!0});var H=C(g);v=f(H,"LABEL",{class:!0});var W=C(v);ue(d.$$.fragment,W),i=j(W),u=f(W,"SPAN",{class:!0,"data-svelte-h":!0}),$(u)!=="svelte-8nvrpr"&&(u.textContent=h),W.forEach(p),w=j(H),k=f(H,"INPUT",{type:!0,placeholder:!0,class:!0}),H.forEach(p),c=j(F),P&&P.l(F),I=j(F),b=f(F,"DIV",{class:!0});var ee=C(b);B=f(ee,"LABEL",{class:!0});var K=C(B);S=f(K,"INPUT",{type:!0,class:!0}),O=j(K),T=f(K,"SPAN",{class:!0,"data-svelte-h":!0}),$(T)!=="svelte-1f0ujgz"&&(T.textContent=N),K.forEach(p),ee.forEach(p),y=j(F),_=f(F,"BUTTON",{class:!0});var G=C(_);E&&E.l(G),n=j(G),V=X(G,M),G.forEach(p),F.forEach(p),A.forEach(p),this.h()},h(){r(u,"class","label-text"),r(v,"class","label items-center gap-2"),r(k,"type","text"),r(k,"placeholder","Enter your full name"),r(k,"class","input input-bordered w-full"),k.required=!0,r(g,"class","form-control mb-6"),r(S,"type","checkbox"),r(S,"class","checkbox checkbox-sm"),r(T,"class","label-text"),r(B,"class","label cursor-pointer justify-start gap-2"),r(b,"class","form-control mb-6"),r(_,"class","btn btn-primary w-full"),_.disabled=D=!s[10]||s[8],r(l,"class","card-body"),r(e,"class","card bg-base-100 shadow-xl")},m(o,A){L&&L.m(o,A),x(o,t,A),x(o,e,A),a(e,l),a(l,g),a(g,v),ie(d,v,null),a(v,i),a(v,u),a(g,w),a(g,k),te(k,s[3]),a(l,c),P&&P.m(l,null),a(l,I),a(l,b),a(b,B),a(B,S),S.checked=s[0],a(B,O),a(B,T),a(l,y),a(l,_),E&&E.m(_,null),a(_,n),a(_,V),U=!0,z||(J=[R(k,"input",s[15]),R(S,"change",s[17]),R(_,"click",s[13])],z=!0)},p(o,A){o[6]?L?L.p(o,A):(L=ge(o),L.c(),L.m(t.parentNode,t)):L&&(L.d(1),L=null),A&8&&k.value!==o[3]&&te(k,o[3]),o[0]?P&&(Se(),Z(P,1,1,()=>{P=null}),Ce()):P?(P.p(o,A),A&1&&Q(P,1)):(P=ke(o),P.c(),Q(P,1),P.m(l,I)),A&1&&(S.checked=o[0]),o[8]?E||(E=we(),E.c(),E.m(_,n)):E&&(E.d(1),E=null),(!U||A&1)&&M!==(M=o[0]?"Continue Setup":"Complete Setup")&&se(V,M),(!U||A&1280&&D!==(D=!o[10]||o[8]))&&(_.disabled=D)},i(o){U||(Q(d.$$.fragment,o),Q(P),U=!0)},o(o){Z(d.$$.fragment,o),Z(P),U=!1},d(o){o&&(p(t),p(e)),L&&L.d(o),oe(d),P&&P.d(),E&&E.d(),z=!1,ne(J)}}}function qe(s){let t,e,l,g,v="Connected Map",d,i,u=(s[5]?.map_name||s[2]?.map_name)+"",h,w,k,c,I=(s[5]?.owner||s[2]?.owner)+"",b,B,S,O,T,N,y,_="Full Name",n,M,V,D,U,z,J,L,P;T=new Me({props:{size:18,class:"text-base-content/70"}});let E=s[8]&&Ie();return{c(){t=m("div"),e=m("div"),l=m("div"),g=m("h2"),g.textContent=v,d=q(),i=m("p"),h=Y(u),w=q(),k=m("p"),c=Y("Owned by "),b=Y(I),B=q(),S=m("div"),O=m("label"),ce(T.$$.fragment),N=q(),y=m("span"),y.textContent=_,n=q(),M=m("input"),V=q(),D=m("button"),E&&E.c(),U=Y(`\r
            Continue`),this.h()},l(o){t=f(o,"DIV",{class:!0});var A=C(t);e=f(A,"DIV",{class:!0});var F=C(e);l=f(F,"DIV",{class:!0});var H=C(l);g=f(H,"H2",{class:!0,"data-svelte-h":!0}),$(g)!=="svelte-3m5xzy"&&(g.textContent=v),d=j(H),i=f(H,"P",{class:!0});var W=C(i);h=X(W,u),W.forEach(p),w=j(H),k=f(H,"P",{class:!0});var ee=C(k);c=X(ee,"Owned by "),b=X(ee,I),ee.forEach(p),H.forEach(p),B=j(F),S=f(F,"DIV",{class:!0});var K=C(S);O=f(K,"LABEL",{class:!0});var G=C(O);ue(T.$$.fragment,G),N=j(G),y=f(G,"SPAN",{class:!0,"data-svelte-h":!0}),$(y)!=="svelte-8nvrpr"&&(y.textContent=_),G.forEach(p),n=j(K),M=f(K,"INPUT",{type:!0,placeholder:!0,class:!0}),K.forEach(p),V=j(F),D=f(F,"BUTTON",{class:!0});var re=C(D);E&&E.l(re),U=X(re,`\r
            Continue`),re.forEach(p),F.forEach(p),A.forEach(p),this.h()},h(){r(g,"class","mb-2 text-lg font-semibold"),r(i,"class","text-base-content"),r(k,"class","text-sm opacity-70"),r(l,"class","mb-6 rounded-lg bg-base-200 p-4"),r(y,"class","label-text"),r(O,"class","label items-center gap-2"),r(M,"type","text"),r(M,"placeholder","Enter your full name"),r(M,"class","input input-bordered w-full"),M.required=!0,r(S,"class","form-control mb-6"),r(D,"class","btn btn-primary w-full"),D.disabled=z=!s[3].trim()||s[8],r(e,"class","card-body"),r(t,"class","card bg-base-100 shadow-xl")},m(o,A){x(o,t,A),a(t,e),a(e,l),a(l,g),a(l,d),a(l,i),a(i,h),a(l,w),a(l,k),a(k,c),a(k,b),a(e,B),a(e,S),a(S,O),ie(T,O,null),a(O,N),a(O,y),a(S,n),a(S,M),te(M,s[3]),a(e,V),a(e,D),E&&E.m(D,null),a(D,U),J=!0,L||(P=[R(M,"input",s[14]),R(D,"click",s[13])],L=!0)},p(o,A){(!J||A&36)&&u!==(u=(o[5]?.map_name||o[2]?.map_name)+"")&&se(h,u),(!J||A&36)&&I!==(I=(o[5]?.owner||o[2]?.owner)+"")&&se(b,I),A&8&&M.value!==o[3]&&te(M,o[3]),o[8]?E||(E=Ie(),E.c(),E.m(D,U)):E&&(E.d(1),E=null),(!J||A&264&&z!==(z=!o[3].trim()||o[8]))&&(D.disabled=z)},i(o){J||(Q(T.$$.fragment,o),J=!0)},o(o){Z(T.$$.fragment,o),J=!1},d(o){o&&p(t),oe(T),E&&E.d(),L=!1,ne(P)}}}function ge(s){let t,e,l,g,v,d;return{c(){t=m("div"),e=fe("svg"),l=fe("path"),g=q(),v=m("span"),d=Y(s[6]),this.h()},l(i){t=f(i,"DIV",{class:!0});var u=C(t);e=pe(u,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0});var h=C(e);l=pe(h,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),C(l).forEach(p),h.forEach(p),g=j(u),v=f(u,"SPAN",{});var w=C(v);d=X(w,s[6]),w.forEach(p),u.forEach(p),this.h()},h(){r(l,"stroke-linecap","round"),r(l,"stroke-linejoin","round"),r(l,"stroke-width","2"),r(l,"d","M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"),r(e,"xmlns","http://www.w3.org/2000/svg"),r(e,"class","h-6 w-6 shrink-0 stroke-current"),r(e,"fill","none"),r(e,"viewBox","0 0 24 24"),r(t,"class","alert alert-error mb-6")},m(i,u){x(i,t,u),a(t,e),a(e,l),a(t,g),a(t,v),a(v,d)},p(i,u){u&64&&se(d,i[6])},d(i){i&&p(t)}}}function ke(s){let t,e,l,g,v,d="Map ID",i,u,h,w,k,c,I,b,B,S,O,T;l=new Te({props:{size:18,class:"text-base-content/70"}});let N=s[9]&&Ee(),y=s[1]&&!s[7]&&ye();return{c(){t=m("div"),e=m("label"),ce(l.$$.fragment),g=q(),v=m("span"),v.textContent=d,i=q(),u=m("div"),h=m("input"),k=q(),c=m("button"),N&&N.c(),I=Y(`\r
                  Join`),B=q(),y&&y.c(),this.h()},l(_){t=f(_,"DIV",{class:!0});var n=C(t);e=f(n,"LABEL",{class:!0});var M=C(e);ue(l.$$.fragment,M),g=j(M),v=f(M,"SPAN",{class:!0,"data-svelte-h":!0}),$(v)!=="svelte-fs4ily"&&(v.textContent=d),M.forEach(p),i=j(n),u=f(n,"DIV",{class:!0});var V=C(u);h=f(V,"INPUT",{type:!0,placeholder:!0,class:!0}),k=j(V),c=f(V,"BUTTON",{type:!0,class:!0});var D=C(c);N&&N.l(D),I=X(D,`\r
                  Join`),D.forEach(p),V.forEach(p),B=j(n),y&&y.l(n),n.forEach(p),this.h()},h(){r(v,"class","label-text"),r(e,"class","label items-center gap-2"),r(h,"type","text"),r(h,"placeholder","Enter map ID"),r(h,"class","input input-bordered flex-1"),h.required=w=!s[0],r(c,"type","button"),r(c,"class","btn btn-primary"),c.disabled=b=!s[7]||s[9],r(u,"class","flex gap-2"),r(t,"class","form-control mb-6")},m(_,n){x(_,t,n),a(t,e),ie(l,e,null),a(e,g),a(e,v),a(t,i),a(t,u),a(u,h),te(h,s[1]),a(u,k),a(u,c),N&&N.m(c,null),a(c,I),a(t,B),y&&y.m(t,null),S=!0,O||(T=[R(h,"input",s[16]),R(h,"input",s[11]),R(c,"click",s[12])],O=!0)},p(_,n){(!S||n&1&&w!==(w=!_[0]))&&(h.required=w),n&2&&h.value!==_[1]&&te(h,_[1]),_[9]?N||(N=Ee(),N.c(),N.m(c,I)):N&&(N.d(1),N=null),(!S||n&640&&b!==(b=!_[7]||_[9]))&&(c.disabled=b),_[1]&&!_[7]?y||(y=ye(),y.c(),y.m(t,null)):y&&(y.d(1),y=null)},i(_){S||(Q(l.$$.fragment,_),S=!0)},o(_){Z(l.$$.fragment,_),S=!1},d(_){_&&p(t),oe(l),N&&N.d(),y&&y.d(),O=!1,ne(T)}}}function Ee(s){let t;return{c(){t=m("span"),this.h()},l(e){t=f(e,"SPAN",{class:!0}),C(t).forEach(p),this.h()},h(){r(t,"class","loading loading-spinner")},m(e,l){x(e,t,l)},d(e){e&&p(t)}}}function ye(s){let t,e='<span class="label-text-alt text-error">Invalid Map ID</span>';return{c(){t=m("label"),t.innerHTML=e,this.h()},l(l){t=f(l,"LABEL",{class:!0,"data-svelte-h":!0}),$(t)!=="svelte-1mi0jd7"&&(t.innerHTML=e),this.h()},h(){r(t,"class","label")},m(l,g){x(l,t,g)},d(l){l&&p(t)}}}function we(s){let t;return{c(){t=m("span"),this.h()},l(e){t=f(e,"SPAN",{class:!0}),C(t).forEach(p),this.h()},h(){r(t,"class","loading loading-spinner")},m(e,l){x(e,t,l)},d(e){e&&p(t)}}}function Ie(s){let t;return{c(){t=m("span"),this.h()},l(e){t=f(e,"SPAN",{class:!0}),C(t).forEach(p),this.h()},h(){r(t,"class","loading loading-spinner")},m(e,l){x(e,t,l)},d(e){e&&p(t)}}}function Be(s){let t,e,l,g='<h1 class="mb-4 text-5xl font-bold text-base-content">Join Map</h1> <p class="text-xl text-base-content/70">Connect to your farm&#39;s map</p>',v,d,i,u;const h=[qe,je],w=[];function k(c,I){return c[4]?0:1}return d=k(s),i=w[d]=h[d](s),{c(){t=m("div"),e=m("div"),l=m("div"),l.innerHTML=g,v=q(),i.c(),this.h()},l(c){t=f(c,"DIV",{class:!0});var I=C(t);e=f(I,"DIV",{class:!0});var b=C(e);l=f(b,"DIV",{class:!0,"data-svelte-h":!0}),$(l)!=="svelte-1qkega7"&&(l.innerHTML=g),v=j(b),i.l(b),b.forEach(p),I.forEach(p),this.h()},h(){r(l,"class","mb-16 text-center"),r(e,"class","mx-auto max-w-xl"),r(t,"class","min-h-screen bg-base-200 px-4 py-12")},m(c,I){x(c,t,I),a(t,e),a(e,l),a(e,v),w[d].m(e,null),u=!0},p(c,[I]){let b=d;d=k(c),d===b?w[d].p(c,I):(Se(),Z(w[b],1,1,()=>{w[b]=null}),Ce(),i=w[d],i?i.p(c,I):(i=w[d]=h[d](c),i.c()),Q(i,1),i.m(e,null))},i(c){u||(Q(i),u=!0)},o(c){Z(i),u=!1},d(c){c&&p(t),w[d].d()}}}function Oe(s,t,e){let l,g,v,d;de(s,me,n=>e(18,v=n)),de(s,_e,n=>e(5,d=n));let i=null,u=!1,h="",w=!1,k=null,c=!1,I=!1,b="";async function B(){if(!h){e(7,w=!1);return}const{data:n,error:M}=await le.from("master_maps").select("id").eq("id",h).single();e(7,w=!M&&n!==null)}async function S(){e(9,I=!0),e(6,i=null);try{const n=await Ve.connectToMap(h);if(!n.success)throw new Error(n.message||"Failed to join map");e(2,k={id:n.data.connectedMap.id,map_name:n.data.connectedMap.map_name,owner:n.data.connectedMap.owner}),_e.set(n.data.connectedMap),he.set(n.data.mapActivity),n.data.operations&&n.data.operations.length>0&&(be.set(n.data.operations),n.data.operation&&ve.set(n.data.operation)),ae.success("Successfully joined map")}catch(n){e(6,i=n.message||"Failed to join map"),ae.error(i)}finally{e(9,I=!1)}}async function O(){e(8,c=!0),e(6,i=null);try{const n={full_name:b,role:"operator",onboarded:!0,updated_at:new Date().toISOString()};if(l){const V=k?.id||d.id,{data:D,error:U}=await le.from("operations").select("id").eq("master_map_id",V).limit(1).single();if(!U&&D){n.selected_operation_id=D.id;const{data:z}=await le.from("operations").select("*").eq("id",D.id).single();z&&(be.set([z]),ve.set(z))}n.master_map_id=V}const{error:M}=await le.from("profiles").update(n).eq("id",v.id);if(M)throw new Error("Failed to update profile");me.update(V=>({...V,full_name:b,user_type:"operator",master_map_id:l?k?.id||d.id:null,selected_operation_id:n.selected_operation_id||null})),l&&he.update(V=>{const D=V.connected_profiles.map(U=>U.id===v.id?{...U,full_name:b}:U);return{...V,connected_profiles:D}}),ae.success("Setup completed successfully!"),Pe("/account")}catch(n){e(6,i=n.message||"Failed to complete setup"),ae.error(i)}finally{e(8,c=!1)}}function T(){b=this.value,e(3,b)}function N(){b=this.value,e(3,b)}function y(){h=this.value,e(1,h)}function _(){u=this.checked,e(0,u)}return s.$$.update=()=>{s.$$.dirty&36&&e(4,l=d?.id||k),s.$$.dirty&25&&e(10,g=b.trim().length>0&&(u||l)),s.$$.dirty&2&&h&&B()},[u,h,k,b,l,d,i,w,c,I,g,B,S,O,T,N,y,_]}class Ze extends Ne{constructor(t){super(),Ae(this,t,Oe,Be,De,{})}}export{Ze as component,Ye as universal};
