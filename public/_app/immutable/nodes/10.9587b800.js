import{g as He}from"../chunks/navigation.22654e78.js";import{s as gt}from"../chunks/sessionStore.b46579ea.js";import{P as Lt,s as yt,e as v,a as I,t as w,w as se,c as _,b as E,g as U,f as x,h as S,d as u,i as y,j as P,k as n,B as pe,q as L,n as X,K as jt,l as Bt,_ as ge,x as Ut,z as Ot}from"../chunks/scheduler.0ff5556b.js";import{S as Ct,i as kt,b as Je,e as Ht,t as Qe,g as Rt,c as ht,a as vt,m as _t,d as mt}from"../chunks/index.e3d1f712.js";import{t as Ae}from"../chunks/Toaster.svelte_svelte_type_style_lang.7b1bf8eb.js";import"../chunks/paths.a4831724.js";import{S as Yt}from"../chunks/settings_module.3273c5d7.js";const qt=async()=>{var r,e;try{const t=Lt(gt);if(!(t!=null&&t.access_token))return console.error("No valid session for billing management"),He("/login"),{loading:!0};console.log("Making request to /api/subscription/manage");const l=await fetch("/api/subscription/manage",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t.access_token}`}});if(console.log("Response status:",l.status),!l.ok){const a=await l.text();console.error("API error response:",a);try{const o=JSON.parse(a);throw new Error(o.error||"Failed to fetch subscription details")}catch{throw new Error(`Failed to fetch subscription details (${l.status})`)}}const s=await l.json();return console.log("Response data structure:",Object.keys(s)),console.log("Has subscriptionData:",s.subscriptionData?"Yes":"No"),console.log("Has primarySubscription:",(r=s.subscriptionData)!=null&&r.primarySubscription?"Yes":"No"),(e=s.subscriptionData)!=null&&e.primarySubscription?{loading:!1,subscriptionData:s.subscriptionData.primarySubscription,seatManagementInfo:s.seatManagementInfo,error:null}:(console.log("No primary subscription found in data"),He("/account/billing"),{loading:!0})}catch(t){return console.error("Error loading subscription management data:",t),Ae.error("Failed to load subscription details"),setTimeout(()=>He("/account/billing"),2e3),{loading:!1,error:t.message,subscriptionData:null,seatManagementInfo:null}}},Ft=!1,As=Object.freeze(Object.defineProperty({__proto__:null,load:qt,ssr:Ft},Symbol.toStringTag,{value:"Module"}));function zt(r){let e;return{c(){e=w("Modify number of seats")},l(t){e=S(t,"Modify number of seats")},m(t,l){P(t,e,l)},p:X,d(t){t&&u(e)}}}function Jt(r){let e,t,l;return{c(){e=w("Add "),t=w(r[1]),l=w(" seats")},l(s){e=S(s,"Add "),t=S(s,r[1]),l=S(s," seats")},m(s,a){P(s,e,a),P(s,t,a),P(s,l,a)},p(s,a){a&2&&L(t,s[1])},d(s){s&&(u(e),u(t),u(l))}}}function Qt(r){let e,t=Math.abs(r[1])+"",l,s;return{c(){e=w("Reduce "),l=w(t),s=w(" seats")},l(a){e=S(a,"Reduce "),l=S(a,t),s=S(a," seats")},m(a,o){P(a,e,o),P(a,l,o),P(a,s,o)},p(a,o){o&2&&t!==(t=Math.abs(a[1])+"")&&L(l,t)},d(a){a&&(u(e),u(l),u(s))}}}function Nt(r){let e,t,l,s,a,o,c=r[5]&&r[5].success?"Refresh Page":"Close",i,d,g;function f(C,h){return C[5]?Kt:Gt}let p=f(r),b=p(r),m=!r[5]&&r[4]&&Mt(r);return{c(){e=v("div"),t=v("div"),b.c(),l=I(),s=v("div"),m&&m.c(),a=I(),o=v("button"),i=w(c),this.h()},l(C){e=_(C,"DIV",{class:!0});var h=E(e);t=_(h,"DIV",{class:!0});var k=E(t);b.l(k),l=x(k),s=_(k,"DIV",{class:!0});var N=E(s);m&&m.l(N),a=x(N),o=_(N,"BUTTON",{class:!0});var D=E(o);i=S(D,c),D.forEach(u),N.forEach(u),k.forEach(u),h.forEach(u),this.h()},h(){y(o,"class","btn btn-outline"),o.disabled=r[3],y(s,"class","modal-action mt-6"),y(t,"class","modal-box max-w-2xl"),y(e,"class","modal modal-open")},m(C,h){P(C,e,h),n(e,t),b.m(t,null),n(t,l),n(t,s),m&&m.m(s,null),n(s,a),n(s,o),n(o,i),d||(g=pe(o,"click",r[14]),d=!0)},p(C,h){p===(p=f(C))&&b?b.p(C,h):(b.d(1),b=p(C),b&&(b.c(),b.m(t,l))),!C[5]&&C[4]?m?m.p(C,h):(m=Mt(C),m.c(),m.m(s,a)):m&&(m.d(1),m=null),h&32&&c!==(c=C[5]&&C[5].success?"Refresh Page":"Close")&&L(i,c),h&8&&(o.disabled=C[3])},d(C){C&&u(e),b.d(),m&&m.d(),d=!1,g()}}}function Gt(r){let e,t="Confirm Seat Update",l,s;function a(i,d){if(i[3])return Zt;if(i[4])return Xt;if(i[6])return Wt}let o=a(r),c=o&&o(r);return{c(){e=v("h3"),e.textContent=t,l=I(),c&&c.c(),s=se(),this.h()},l(i){e=_(i,"H3",{class:!0,"data-svelte-h":!0}),U(e)!=="svelte-1mspo0w"&&(e.textContent=t),l=x(i),c&&c.l(i),s=se(),this.h()},h(){y(e,"class","mb-6 text-2xl font-bold")},m(i,d){P(i,e,d),P(i,l,d),c&&c.m(i,d),P(i,s,d)},p(i,d){o===(o=a(i))&&c?c.p(i,d):(c&&c.d(1),c=o&&o(i),c&&(c.c(),c.m(s.parentNode,s)))},d(i){i&&(u(e),u(l),u(s)),c&&c.d(i)}}}function Kt(r){let e;function t(a,o){return a[5].success?ss:ts}let l=t(r),s=l(r);return{c(){s.c(),e=se()},l(a){s.l(a),e=se()},m(a,o){s.m(a,o),P(a,e,o)},p(a,o){l===(l=t(a))&&s?s.p(a,o):(s.d(1),s=l(a),s&&(s.c(),s.m(e.parentNode,e)))},d(a){a&&u(e),s.d(a)}}}function Wt(r){let e,t,l="Unable to load preview information. Please try again.",s,a,o,c;return{c(){e=v("div"),t=v("p"),t.textContent=l,s=I(),a=v("span"),o=w("Error: "),c=w(r[6]),this.h()},l(i){e=_(i,"DIV",{class:!0});var d=E(e);t=_(d,"P",{"data-svelte-h":!0}),U(t)!=="svelte-vm1z5r"&&(t.textContent=l),s=x(d),a=_(d,"SPAN",{class:!0});var g=E(a);o=S(g,"Error: "),c=S(g,r[6]),g.forEach(u),d.forEach(u),this.h()},h(){y(a,"class","mt-2 block font-medium"),y(e,"class","rounded-lg bg-error/20 p-4")},m(i,d){P(i,e,d),n(e,t),n(e,s),n(e,a),n(a,o),n(a,c)},p(i,d){d&64&&L(c,i[6])},d(i){i&&u(e)}}}function Xt(r){let e,t,l,s=r[4].isIncreasing?"Increasing":"Decreasing",a,o,c,i=r[4].currentSeats+"",d,g,f,p=r[4].newSeats+"",b,m,C=r[4].newSeats>1?"s":"",h,k,N,D,V="Immediate Changes:",M,A,j,T,H="Future Billing:",ee,F,le,K,z=r[4].anchorDate+"",q,B,O=r[4].billingCycle+"",te,be,J,re,ne=Math.ceil(r[4].futureCost)+"",ke,ae,ie=r[4].currency+"",he,we,ce,je,ve=r[4].billingCycle+"",Z,Q,G,W,$,xe="Monthly Cost Comparison",Be,oe,_e,Ne="Current monthly rate:",Le,ue,me,Se,De=r[4].oldMonthly.toFixed(2)+"",Ge,nt,Ee,Ue,wt="New monthly rate:",at,Oe,Te,ot,Re=r[4].newMonthly.toFixed(2)+"",Ke,rt,de,Ye=r[4].monthlyDifference>0?"Increase":"Savings",We,it,ye,ct,qe=Math.abs(r[4].monthlyDifference).toFixed(2)+"",Xe,ut,Fe=r[4].currency+"",Ze,dt;function St(R,Y){return R[4].isIncreasing?es:$t}let $e=St(r),fe=$e(r);return{c(){e=v("div"),t=v("p"),l=w("You are "),a=w(s),o=w(`\r
              your subscription from\r
              `),c=v("span"),d=w(i),g=w(`\r
              to\r
              `),f=v("span"),b=w(p),m=w(`\r
              seat`),h=w(C),k=I(),N=v("div"),D=v("h4"),D.textContent=V,M=I(),fe.c(),A=I(),j=v("div"),T=v("h4"),T.textContent=H,ee=I(),F=v("p"),le=w("On "),K=v("span"),q=w(z),B=w(", your new "),te=w(O),be=w(` subscription cost will be\r
                `),J=v("span"),re=w("$"),ke=w(ne),ae=I(),he=w(ie),we=I(),ce=v("p"),je=w("This will be your new "),Z=w(ve),Q=w(` rate unless further\r
                changes are made.`),G=I(),W=v("div"),$=v("p"),$.textContent=xe,Be=I(),oe=v("div"),_e=v("span"),_e.textContent=Ne,Le=I(),ue=v("span"),me=v("span"),Se=w("$"),Ge=w(De),nt=I(),Ee=v("div"),Ue=v("span"),Ue.textContent=wt,at=I(),Oe=v("span"),Te=v("span"),ot=w("$"),Ke=w(Re),rt=I(),de=v("p"),We=w(Ye),it=w(`\r
                  of\r
                  `),ye=v("span"),ct=w("$"),Xe=w(qe),ut=I(),Ze=w(Fe),dt=w(" per month"),this.h()},l(R){e=_(R,"DIV",{class:!0});var Y=E(e);t=_(Y,"P",{class:!0});var Ce=E(t);l=S(Ce,"You are "),a=S(Ce,s),o=S(Ce,`\r
              your subscription from\r
              `),c=_(Ce,"SPAN",{class:!0});var Dt=E(c);d=S(Dt,i),Dt.forEach(u),g=S(Ce,`\r
              to\r
              `),f=_(Ce,"SPAN",{class:!0});var Et=E(f);b=S(Et,p),Et.forEach(u),m=S(Ce,`\r
              seat`),h=S(Ce,C),Ce.forEach(u),k=x(Y),N=_(Y,"DIV",{class:!0});var et=E(N);D=_(et,"H4",{class:!0,"data-svelte-h":!0}),U(D)!=="svelte-yy5pt0"&&(D.textContent=V),M=x(et),fe.l(et),et.forEach(u),A=x(Y),j=_(Y,"DIV",{class:!0});var Pe=E(j);T=_(Pe,"H4",{class:!0,"data-svelte-h":!0}),U(T)!=="svelte-16lxgl8"&&(T.textContent=H),ee=x(Pe),F=_(Pe,"P",{class:!0});var Me=E(F);le=S(Me,"On "),K=_(Me,"SPAN",{class:!0});var Pt=E(K);q=S(Pt,z),Pt.forEach(u),B=S(Me,", your new "),te=S(Me,O),be=S(Me,` subscription cost will be\r
                `),J=_(Me,"SPAN",{class:!0});var ze=E(J);re=S(ze,"$"),ke=S(ze,ne),ae=x(ze),he=S(ze,ie),ze.forEach(u),Me.forEach(u),we=x(Pe),ce=_(Pe,"P",{class:!0});var tt=E(ce);je=S(tt,"This will be your new "),Z=S(tt,ve),Q=S(tt,` rate unless further\r
                changes are made.`),tt.forEach(u),G=x(Pe),W=_(Pe,"DIV",{class:!0});var Ie=E(W);$=_(Ie,"P",{class:!0,"data-svelte-h":!0}),U($)!=="svelte-u1tf3k"&&($.textContent=xe),Be=x(Ie),oe=_(Ie,"DIV",{class:!0});var st=E(oe);_e=_(st,"SPAN",{"data-svelte-h":!0}),U(_e)!=="svelte-15vwbc6"&&(_e.textContent=Ne),Le=x(st),ue=_(st,"SPAN",{class:!0});var It=E(ue);me=_(It,"SPAN",{class:!0});var ft=E(me);Se=S(ft,"$"),Ge=S(ft,De),ft.forEach(u),It.forEach(u),st.forEach(u),nt=x(Ie),Ee=_(Ie,"DIV",{class:!0});var lt=E(Ee);Ue=_(lt,"SPAN",{"data-svelte-h":!0}),U(Ue)!=="svelte-klfbl3"&&(Ue.textContent=wt),at=x(lt),Oe=_(lt,"SPAN",{class:!0});var xt=E(Oe);Te=_(xt,"SPAN",{class:!0});var pt=E(Te);ot=S(pt,"$"),Ke=S(pt,Re),pt.forEach(u),xt.forEach(u),lt.forEach(u),rt=x(Ie),de=_(Ie,"P",{class:!0});var Ve=E(de);We=S(Ve,Ye),it=S(Ve,`\r
                  of\r
                  `),ye=_(Ve,"SPAN",{class:!0});var bt=E(ye);ct=S(bt,"$"),Xe=S(bt,qe),bt.forEach(u),ut=x(Ve),Ze=S(Ve,Fe),dt=S(Ve," per month"),Ve.forEach(u),Ie.forEach(u),Pe.forEach(u),Y.forEach(u),this.h()},h(){y(c,"class","inline-block rounded bg-base-300 px-2 py-1 font-semibold"),y(f,"class","inline-block rounded bg-base-300 px-2 py-1 font-semibold"),y(t,"class","text-lg"),y(D,"class","mb-3 text-lg font-semibold"),y(N,"class","rounded-lg bg-base-200 p-6"),y(T,"class","mb-3 text-lg font-semibold"),y(K,"class","font-semibold"),y(J,"class","inline-block rounded bg-base-300 px-2 py-1 font-bold"),y(F,"class","mb-2"),y(ce,"class","mb-4 text-sm text-base-content/70"),y($,"class","mb-2 text-center font-semibold"),y(me,"class","inline-block rounded bg-base-300 px-2 py-1"),y(ue,"class","font-bold"),y(oe,"class","mb-2 flex items-center justify-between"),y(Te,"class","inline-block rounded bg-base-300 px-2 py-1"),y(Oe,"class","font-bold"),y(Ee,"class","mb-2 flex items-center justify-between"),y(ye,"class","inline-block rounded bg-base-300 px-2 py-1 font-bold"),ge(ye,"text-primary",r[4].monthlyDifference<0),y(de,"class","text-md mt-2 text-center"),y(W,"class","border-t pt-4"),y(j,"class","rounded-lg bg-base-200 p-6"),y(e,"class","space-y-6")},m(R,Y){P(R,e,Y),n(e,t),n(t,l),n(t,a),n(t,o),n(t,c),n(c,d),n(t,g),n(t,f),n(f,b),n(t,m),n(t,h),n(e,k),n(e,N),n(N,D),n(N,M),fe.m(N,null),n(e,A),n(e,j),n(j,T),n(j,ee),n(j,F),n(F,le),n(F,K),n(K,q),n(F,B),n(F,te),n(F,be),n(F,J),n(J,re),n(J,ke),n(J,ae),n(J,he),n(j,we),n(j,ce),n(ce,je),n(ce,Z),n(ce,Q),n(j,G),n(j,W),n(W,$),n(W,Be),n(W,oe),n(oe,_e),n(oe,Le),n(oe,ue),n(ue,me),n(me,Se),n(me,Ge),n(W,nt),n(W,Ee),n(Ee,Ue),n(Ee,at),n(Ee,Oe),n(Oe,Te),n(Te,ot),n(Te,Ke),n(W,rt),n(W,de),n(de,We),n(de,it),n(de,ye),n(ye,ct),n(ye,Xe),n(de,ut),n(de,Ze),n(de,dt)},p(R,Y){Y&16&&s!==(s=R[4].isIncreasing?"Increasing":"Decreasing")&&L(a,s),Y&16&&i!==(i=R[4].currentSeats+"")&&L(d,i),Y&16&&p!==(p=R[4].newSeats+"")&&L(b,p),Y&16&&C!==(C=R[4].newSeats>1?"s":"")&&L(h,C),$e===($e=St(R))&&fe?fe.p(R,Y):(fe.d(1),fe=$e(R),fe&&(fe.c(),fe.m(N,null))),Y&16&&z!==(z=R[4].anchorDate+"")&&L(q,z),Y&16&&O!==(O=R[4].billingCycle+"")&&L(te,O),Y&16&&ne!==(ne=Math.ceil(R[4].futureCost)+"")&&L(ke,ne),Y&16&&ie!==(ie=R[4].currency+"")&&L(he,ie),Y&16&&ve!==(ve=R[4].billingCycle+"")&&L(Z,ve),Y&16&&De!==(De=R[4].oldMonthly.toFixed(2)+"")&&L(Ge,De),Y&16&&Re!==(Re=R[4].newMonthly.toFixed(2)+"")&&L(Ke,Re),Y&16&&Ye!==(Ye=R[4].monthlyDifference>0?"Increase":"Savings")&&L(We,Ye),Y&16&&qe!==(qe=Math.abs(R[4].monthlyDifference).toFixed(2)+"")&&L(Xe,qe),Y&16&&ge(ye,"text-primary",R[4].monthlyDifference<0),Y&16&&Fe!==(Fe=R[4].currency+"")&&L(Ze,Fe)},d(R){R&&u(e),fe.d()}}}function Zt(r){let e,t='<div class="py-4"><div class="skeleton mb-2 h-6 w-3/4"></div></div> <div class="rounded-lg bg-base-200 p-6"><div class="skeleton mb-4 h-6 w-1/2"></div> <div class="skeleton mb-3 h-5 w-full"></div> <div class="skeleton h-4 w-2/3"></div></div> <div class="rounded-lg bg-base-200 p-6"><div class="skeleton mb-4 h-6 w-1/2"></div> <div class="skeleton mb-3 h-5 w-full"></div> <div class="skeleton mb-6 h-4 w-4/5"></div> <div class="border-t pt-4"><div class="skeleton mx-auto mb-4 h-5 w-1/2"></div> <div class="mb-3 flex items-center justify-between"><div class="skeleton h-4 w-1/3"></div> <div class="skeleton h-5 w-20"></div></div> <div class="mb-3 flex items-center justify-between"><div class="skeleton h-4 w-1/3"></div> <div class="skeleton h-5 w-20"></div></div> <div class="skeleton mx-auto mt-4 h-5 w-2/3"></div></div></div>';return{c(){e=v("div"),e.innerHTML=t,this.h()},l(l){e=_(l,"DIV",{class:!0,"data-svelte-h":!0}),U(e)!=="svelte-ccaglg"&&(e.innerHTML=t),this.h()},h(){y(e,"class","space-y-6")},m(l,s){P(l,e,s)},p:X,d(l){l&&u(e)}}}function $t(r){let e,t,l,s=r[4].currentSeats+"",a,o,c,i=r[4].daysUntilAnchor+"",d,g,f,p,b="No charges will be applied for reducing seats.";return{c(){e=v("p"),t=w(`Continued access to your\r
                  `),l=v("span"),a=w(s),o=w(`\r
                  seats for\r
\r
                  `),c=v("span"),d=w(i),g=w(`\r
\r
                  more days`),f=I(),p=v("p"),p.textContent=b,this.h()},l(m){e=_(m,"P",{class:!0});var C=E(e);t=S(C,`Continued access to your\r
                  `),l=_(C,"SPAN",{class:!0});var h=E(l);a=S(h,s),h.forEach(u),o=S(C,`\r
                  seats for\r
\r
                  `),c=_(C,"SPAN",{class:!0});var k=E(c);d=S(k,i),k.forEach(u),g=S(C,`\r
\r
                  more days`),C.forEach(u),f=x(m),p=_(m,"P",{class:!0,"data-svelte-h":!0}),U(p)!=="svelte-1g3k6ei"&&(p.textContent=b),this.h()},h(){y(l,"class","inline-block rounded bg-base-300 px-2 py-1 font-bold"),y(c,"class","inline-block rounded bg-base-300 px-2 py-1 font-bold"),y(e,"class","mb-2 text-lg"),y(p,"class","text-sm text-base-content/70")},m(m,C){P(m,e,C),n(e,t),n(e,l),n(l,a),n(e,o),n(e,c),n(c,d),n(e,g),P(m,f,C),P(m,p,C)},p(m,C){C&16&&s!==(s=m[4].currentSeats+"")&&L(a,s),C&16&&i!==(i=m[4].daysUntilAnchor+"")&&L(d,i)},d(m){m&&(u(e),u(f),u(p))}}}function es(r){let e,t,l=r[4].newSeats+"",s,a,o,c,i=Math.ceil(r[4].immediateCharge)+"",d,g,f=r[4].currency+"",p,b,m,C,h=r[4].newSeats-r[4].currentSeats>1?"s":"",k,N,D=r[4].daysUntilAnchor+"",V,M;return{c(){e=v("p"),t=w("You will be upgraded to "),s=w(l),a=w(` seats and be charged\r
                  `),o=v("span"),c=w("$"),d=w(i),g=I(),p=w(f),b=I(),m=v("p"),C=w("This fee covers the additional seat"),k=w(h),N=w(`\r
                  for `),V=w(D),M=w(" days."),this.h()},l(A){e=_(A,"P",{class:!0});var j=E(e);t=S(j,"You will be upgraded to "),s=S(j,l),a=S(j,` seats and be charged\r
                  `),o=_(j,"SPAN",{class:!0});var T=E(o);c=S(T,"$"),d=S(T,i),g=x(T),p=S(T,f),T.forEach(u),j.forEach(u),b=x(A),m=_(A,"P",{class:!0});var H=E(m);C=S(H,"This fee covers the additional seat"),k=S(H,h),N=S(H,`\r
                  for `),V=S(H,D),M=S(H," days."),H.forEach(u),this.h()},h(){y(o,"class","inline-block rounded bg-base-300 px-2 py-1 font-bold"),y(e,"class","mb-2"),y(m,"class","text-sm text-base-content/70")},m(A,j){P(A,e,j),n(e,t),n(e,s),n(e,a),n(e,o),n(o,c),n(o,d),n(o,g),n(o,p),P(A,b,j),P(A,m,j),n(m,C),n(m,k),n(m,N),n(m,V),n(m,M)},p(A,j){j&16&&l!==(l=A[4].newSeats+"")&&L(s,l),j&16&&i!==(i=Math.ceil(A[4].immediateCharge)+"")&&L(d,i),j&16&&f!==(f=A[4].currency+"")&&L(p,f),j&16&&h!==(h=A[4].newSeats-A[4].currentSeats>1?"s":"")&&L(k,h),j&16&&D!==(D=A[4].daysUntilAnchor+"")&&L(V,D)},d(A){A&&(u(e),u(b),u(m))}}}function ts(r){let e,t="Update Failed",l,s,a=r[5].error+"",o,c,i;function d(p,b){if(p[5].code==="card_declined")return ns;if(p[5].code==="insufficient_funds")return ls}let g=d(r),f=g&&g(r);return{c(){e=v("h3"),e.textContent=t,l=I(),s=v("p"),o=w(a),c=I(),f&&f.c(),i=se(),this.h()},l(p){e=_(p,"H3",{class:!0,"data-svelte-h":!0}),U(e)!=="svelte-msg6t8"&&(e.textContent=t),l=x(p),s=_(p,"P",{class:!0});var b=E(s);o=S(b,a),b.forEach(u),c=x(p),f&&f.l(p),i=se(),this.h()},h(){y(e,"class","mb-6 text-2xl font-bold"),y(s,"class","mb-4 rounded-lg bg-error/20 p-4")},m(p,b){P(p,e,b),P(p,l,b),P(p,s,b),n(s,o),P(p,c,b),f&&f.m(p,b),P(p,i,b)},p(p,b){b&32&&a!==(a=p[5].error+"")&&L(o,a),g!==(g=d(p))&&(f&&f.d(1),f=g&&g(p),f&&(f.c(),f.m(i.parentNode,i)))},d(p){p&&(u(e),u(l),u(s),u(c),u(i)),f&&f.d(p)}}}function ss(r){let e,t="Subscription Updated Successfully",l,s,a,o,c,i=r[5].newQuantity+"",d,g,f=r[5].discountApplied&&Tt();return{c(){e=v("h3"),e.textContent=t,l=I(),s=v("div"),f&&f.c(),a=I(),o=v("p"),c=w("Your seat count has been updated to "),d=w(i),g=w("."),this.h()},l(p){e=_(p,"H3",{class:!0,"data-svelte-h":!0}),U(e)!=="svelte-1wkr2m5"&&(e.textContent=t),l=x(p),s=_(p,"DIV",{class:!0});var b=E(s);f&&f.l(b),a=x(b),o=_(b,"P",{class:!0});var m=E(o);c=S(m,"Your seat count has been updated to "),d=S(m,i),g=S(m,"."),m.forEach(u),b.forEach(u),this.h()},h(){y(e,"class","mb-6 text-2xl font-bold"),y(o,"class","rounded-lg bg-success/20 p-4"),y(s,"class","space-y-4")},m(p,b){P(p,e,b),P(p,l,b),P(p,s,b),f&&f.m(s,null),n(s,a),n(s,o),n(o,c),n(o,d),n(o,g)},p(p,b){p[5].discountApplied?f||(f=Tt(),f.c(),f.m(s,a)):f&&(f.d(1),f=null),b&32&&i!==(i=p[5].newQuantity+"")&&L(d,i)},d(p){p&&(u(e),u(l),u(s)),f&&f.d()}}}function ls(r){let e,t=`Your card has insufficient funds. Please use a different payment\r
              method.`;return{c(){e=v("p"),e.textContent=t,this.h()},l(l){e=_(l,"P",{class:!0,"data-svelte-h":!0}),U(e)!=="svelte-586isf"&&(e.textContent=t),this.h()},h(){y(e,"class","rounded-lg bg-base-200 p-4")},m(l,s){P(l,e,s)},d(l){l&&u(e)}}}function ns(r){let e,t=`Your card was declined. Please update your payment method and try\r
              again.`;return{c(){e=v("p"),e.textContent=t,this.h()},l(l){e=_(l,"P",{class:!0,"data-svelte-h":!0}),U(e)!=="svelte-khude"&&(e.textContent=t),this.h()},h(){y(e,"class","rounded-lg bg-base-200 p-4")},m(l,s){P(l,e,s)},d(l){l&&u(e)}}}function Tt(r){let e,t="A discount has been applied to your subscription.";return{c(){e=v("p"),e.textContent=t,this.h()},l(l){e=_(l,"P",{class:!0,"data-svelte-h":!0}),U(e)!=="svelte-1y1cojs"&&(e.textContent=t),this.h()},h(){y(e,"class","rounded-lg bg-info/20 p-4")},m(l,s){P(l,e,s)},d(l){l&&u(e)}}}function Mt(r){let e,t,l,s;return{c(){e=v("button"),t=w("Confirm Update"),this.h()},l(a){e=_(a,"BUTTON",{type:!0,class:!0});var o=E(e);t=S(o,"Confirm Update"),o.forEach(u),this.h()},h(){y(e,"type","button"),y(e,"class","btn btn-primary"),e.disabled=r[3]},m(a,o){P(a,e,o),n(e,t),l||(s=pe(e,"click",r[12]),l=!0)},p(a,o){o&8&&(e.disabled=a[3])},d(a){a&&u(e),l=!1,s()}}}function as(r){let e,t,l="Manage Seats",s,a,o,c,i,d,g,f,p,b,m=r[0]===1?"seat":"seats",C,h,k,N,D,V,M,A,j,T,H,ee,F;function le(B,O){return B[8]?Qt:B[7]?Jt:zt}let K=le(r),z=K(r),q=r[2]&&Nt(r);return{c(){e=v("div"),t=v("h2"),t.textContent=l,s=I(),a=v("div"),o=v("button"),c=w("-"),g=I(),f=v("span"),p=w(r[0]),b=I(),C=w(m),h=I(),k=v("button"),N=w("+"),V=I(),M=v("button"),z.c(),T=I(),q&&q.c(),H=se(),this.h()},l(B){e=_(B,"DIV",{class:!0});var O=E(e);t=_(O,"H2",{class:!0,"data-svelte-h":!0}),U(t)!=="svelte-lkbcb"&&(t.textContent=l),s=x(O),a=_(O,"DIV",{class:!0});var te=E(a);o=_(te,"BUTTON",{class:!0});var be=E(o);c=S(be,"-"),be.forEach(u),g=x(te),f=_(te,"SPAN",{class:!0});var J=E(f);p=S(J,r[0]),b=x(J),C=S(J,m),J.forEach(u),h=x(te),k=_(te,"BUTTON",{class:!0});var re=E(k);N=S(re,"+"),re.forEach(u),te.forEach(u),V=x(O),M=_(O,"BUTTON",{class:!0});var ne=E(M);z.l(ne),ne.forEach(u),O.forEach(u),T=x(B),q&&q.l(B),H=se(),this.h()},h(){y(t,"class","mb-4 text-xl font-bold"),y(o,"class",i="btn btn-outline btn-sm "+(r[8]?"text-red-500":"")),o.disabled=d=r[0]===1,y(f,"class","mx-4 text-lg font-bold text-black"),y(k,"class",D="btn btn-outline btn-sm "+(r[7]?"hover:from-secondary-focus hover:to-accent-focus bg-gradient-to-r from-secondary to-accent text-secondary-content":"")),y(a,"class","mb-4 flex items-center justify-center"),y(M,"class",A="btn w-full "+(r[1]===0?"btn-disabled":r[8]?"btn-outline btn-warning":"hover:from-secondary-focus hover:to-accent-focus bg-gradient-to-r from-secondary to-accent text-secondary-content")),M.disabled=j=r[1]===0,y(e,"class","card mt-8 max-w-xl p-6 shadow")},m(B,O){P(B,e,O),n(e,t),n(e,s),n(e,a),n(a,o),n(o,c),n(a,g),n(a,f),n(f,p),n(f,b),n(f,C),n(a,h),n(a,k),n(k,N),n(e,V),n(e,M),z.m(M,null),P(B,T,O),q&&q.m(B,O),P(B,H,O),ee||(F=[pe(o,"click",r[10]),pe(k,"click",r[9]),pe(M,"click",r[11])],ee=!0)},p(B,[O]){O&256&&i!==(i="btn btn-outline btn-sm "+(B[8]?"text-red-500":""))&&y(o,"class",i),O&1&&d!==(d=B[0]===1)&&(o.disabled=d),O&1&&L(p,B[0]),O&1&&m!==(m=B[0]===1?"seat":"seats")&&L(C,m),O&128&&D!==(D="btn btn-outline btn-sm "+(B[7]?"hover:from-secondary-focus hover:to-accent-focus bg-gradient-to-r from-secondary to-accent text-secondary-content":""))&&y(k,"class",D),K===(K=le(B))&&z?z.p(B,O):(z.d(1),z=K(B),z&&(z.c(),z.m(M,null))),O&258&&A!==(A="btn w-full "+(B[1]===0?"btn-disabled":B[8]?"btn-outline btn-warning":"hover:from-secondary-focus hover:to-accent-focus bg-gradient-to-r from-secondary to-accent text-secondary-content"))&&y(M,"class",A),O&2&&j!==(j=B[1]===0)&&(M.disabled=j),B[2]?q?q.p(B,O):(q=Nt(B),q.c(),q.m(H.parentNode,H)):q&&(q.d(1),q=null)},i:X,o:X,d(B){B&&(u(e),u(T),u(H)),z.d(),q&&q.d(B),ee=!1,jt(F)}}}function os(r,e){try{const t=r.lines.data,l=t[0].quantity,s=t[1].quantity,a=new Date(t[0].period.end*1e3),o=Math.ceil((t[0].period.end-t[0].period.start)/(24*60*60)),c=t[2].amount/100,i=e?(t[0].amount+t[1].amount)/100:0,d=t[0].price.recurring.interval;console.log("IsIncreasing?",e);const g=e?a:new Date,f=t[0].currency,p=c/s,b=d==="year"?p/12:p,m=l*b,C=s*b,h=C-m;return{currentSeats:l,newSeats:s,billingCycle:d==="year"?"annual":"monthly",currency:f,changeAppliedDate:e?"immediately":"on next billing date",immediateCharge:i,futureCost:c,anchorDate:a.toISOString().split("T")[0],daysUntilAnchor:o,isIncreasing:e,nextPaymentDate:g.toISOString().split("T")[0],lineItems:t.map(k=>({description:k.description,amount:k.amount/100,proration:k.proration})),oldMonthly:m,newMonthly:C,monthlyDifference:h,monthlyCost:b}}catch(t){return console.error("Error extracting important info:",t),null}}function rs(r,e,t){let l,s,a,o;Bt(r,gt,T=>t(16,o=T));let{data:c}=e,{subscriptionData:i,seatManagementInfo:d}=c,g=i.stripeSubscription.quantity||1,f=g,p=!1,b=!1,m=null,C=null,h=null,k=null;function N(){t(0,f+=1)}function D(){f>1&&t(0,f-=1)}function V(){t(2,p=!0),t(3,b=!0),m=null,t(4,C=null),t(6,k=null),M()}async function M(){try{console.log("Fetching seat proration preview..."),console.log("Current auth token:",o.access_token?"Available":"Not available");const T=await fetch("/api/subscription/previews/prorated-seats",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o.access_token}`},body:JSON.stringify({quantity:f,appliedDate:s?"now":"later"})});if(console.log("Response status:",T.status),!T.ok){const ee=await T.json();throw console.error("Preview error response:",ee),t(6,k=ee.error||"Failed to fetch preview"),new Error(k)}const H=await T.json();if(console.log("Proration Preview result:",H),H.type==="success"){const F=JSON.parse(H.data)[2];console.log("Parsed Proration Preview:",F),m=F,t(4,C=os(F,s)),console.log("Important Information:",C)}else throw t(6,k=H.error||"Failed to calculate preview"),new Error(k)}catch(T){console.error("Error fetching proration preview:",T),Ae.error("Failed to load seat pricing preview"),t(6,k=T.message||"An unexpected error occurred")}finally{t(3,b=!1)}}async function A(){try{t(3,b=!0),console.log("Updating seats...");const T=await fetch("/api/subscription/actions/update-seats",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o.access_token}`},body:JSON.stringify({quantity:C.newSeats,appliedDate:C.isIncreasing?"now":"later"})});if(console.log("Update response status:",T.status),!T.ok){const H=await T.json();throw console.error("Update error response:",H),new Error(H.error||"Failed to update seats")}if(t(5,h=await T.json()),console.log("Update result:",h),h.success)Ae.success("Subscription updated successfully");else throw new Error(h.error||"Update failed")}catch(T){console.error("Error updating seats:",T),Ae.error("Failed to update subscription"),t(5,h={success:!1,error:T.message})}finally{t(3,b=!1)}}const j=()=>{h&&h.success?window.location.reload():(t(2,p=!1),t(5,h=null))};return r.$$set=T=>{"data"in T&&t(13,c=T.data)},r.$$.update=()=>{r.$$.dirty&1&&t(1,l=f-g),r.$$.dirty&2&&t(7,s=l>0),r.$$.dirty&2&&t(8,a=l<0)},[f,l,p,b,C,h,k,s,a,N,D,V,A,c,j]}class is extends Ct{constructor(e){super(),kt(this,e,rs,as,yt,{data:13})}}function Vt(r){let e,t,l,s=r[4]?"Reverse Subscription Cancellation":"Cancel Subscription",a,o,c,i,d,g,f=r[3]&&r[3].success?"Refresh Page":"Close",p,b,m;function C(D,V){return D[2]?ds:D[3]?us:cs}let h=C(r),k=h(r),N=!r[3]&&!r[2]&&At(r);return{c(){e=v("div"),t=v("div"),l=v("h3"),a=w(s),o=I(),k.c(),c=I(),i=v("div"),N&&N.c(),d=I(),g=v("button"),p=w(f),this.h()},l(D){e=_(D,"DIV",{class:!0});var V=E(e);t=_(V,"DIV",{class:!0});var M=E(t);l=_(M,"H3",{class:!0});var A=E(l);a=S(A,s),A.forEach(u),o=x(M),k.l(M),c=x(M),i=_(M,"DIV",{class:!0});var j=E(i);N&&N.l(j),d=x(j),g=_(j,"BUTTON",{class:!0});var T=E(g);p=S(T,f),T.forEach(u),j.forEach(u),M.forEach(u),V.forEach(u),this.h()},h(){y(l,"class","mb-6 text-2xl font-bold"),y(g,"class","btn btn-outline"),g.disabled=r[2],y(i,"class","modal-action mt-6"),y(t,"class","modal-box max-w-2xl"),y(e,"class","modal modal-open")},m(D,V){P(D,e,V),n(e,t),n(t,l),n(l,a),n(t,o),k.m(t,null),n(t,c),n(t,i),N&&N.m(i,null),n(i,d),n(i,g),n(g,p),b||(m=pe(g,"click",r[8]),b=!0)},p(D,V){V&16&&s!==(s=D[4]?"Reverse Subscription Cancellation":"Cancel Subscription")&&L(a,s),h===(h=C(D))&&k?k.p(D,V):(k.d(1),k=h(D),k&&(k.c(),k.m(t,c))),!D[3]&&!D[2]?N?N.p(D,V):(N=At(D),N.c(),N.m(i,d)):N&&(N.d(1),N=null),V&8&&f!==(f=D[3]&&D[3].success?"Refresh Page":"Close")&&L(p,f),V&4&&(g.disabled=D[2])},d(D){D&&u(e),k.d(),N&&N.d(),b=!1,m()}}}function cs(r){let e,t,l,s="Current Subscription Details:",a,o,c,i,d="Plan",g,f,p=r[0].appSubscription.name+"",b,m,C,h,k="Billing Cycle",N,D,V=r[0].stripeSubscription.plan.interval+"",M,A,j,T,H,ee="Number of Seats",F,le,K=r[0].stripeSubscription.quantity+"",z,q,B,O,te="Current Period End",be,J,re=new Date(r[0].stripeSubscription.current_period_end*1e3).toLocaleDateString()+"",ne,ke,ae,ie,he=r[4]?"Reversal Information:":"Cancellation Information:",we,ce;function je(Q,G){return Q[4]?ps:fs}let ve=je(r),Z=ve(r);return{c(){e=v("div"),t=v("div"),l=v("h4"),l.textContent=s,a=I(),o=v("div"),c=v("div"),i=v("p"),i.textContent=d,g=I(),f=v("p"),b=w(p),m=I(),C=v("div"),h=v("p"),h.textContent=k,N=I(),D=v("p"),M=w(V),A=w("ly"),j=I(),T=v("div"),H=v("p"),H.textContent=ee,F=I(),le=v("p"),z=w(K),q=I(),B=v("div"),O=v("p"),O.textContent=te,be=I(),J=v("p"),ne=w(re),ke=I(),ae=v("div"),ie=v("h4"),we=w(he),ce=I(),Z.c(),this.h()},l(Q){e=_(Q,"DIV",{class:!0});var G=E(e);t=_(G,"DIV",{class:!0});var W=E(t);l=_(W,"H4",{class:!0,"data-svelte-h":!0}),U(l)!=="svelte-widots"&&(l.textContent=s),a=x(W),o=_(W,"DIV",{class:!0});var $=E(o);c=_($,"DIV",{class:!0});var xe=E(c);i=_(xe,"P",{class:!0,"data-svelte-h":!0}),U(i)!=="svelte-1xf3t3m"&&(i.textContent=d),g=x(xe),f=_(xe,"P",{class:!0});var Be=E(f);b=S(Be,p),Be.forEach(u),xe.forEach(u),m=x($),C=_($,"DIV",{class:!0});var oe=E(C);h=_(oe,"P",{class:!0,"data-svelte-h":!0}),U(h)!=="svelte-1pfbt8a"&&(h.textContent=k),N=x(oe),D=_(oe,"P",{class:!0});var _e=E(D);M=S(_e,V),A=S(_e,"ly"),_e.forEach(u),oe.forEach(u),j=x($),T=_($,"DIV",{class:!0});var Ne=E(T);H=_(Ne,"P",{class:!0,"data-svelte-h":!0}),U(H)!=="svelte-q9tnhj"&&(H.textContent=ee),F=x(Ne),le=_(Ne,"P",{class:!0});var Le=E(le);z=S(Le,K),Le.forEach(u),Ne.forEach(u),q=x($),B=_($,"DIV",{class:!0});var ue=E(B);O=_(ue,"P",{class:!0,"data-svelte-h":!0}),U(O)!=="svelte-x9kj1m"&&(O.textContent=te),be=x(ue),J=_(ue,"P",{class:!0});var me=E(J);ne=S(me,re),me.forEach(u),ue.forEach(u),$.forEach(u),W.forEach(u),ke=x(G),ae=_(G,"DIV",{class:!0});var Se=E(ae);ie=_(Se,"H4",{class:!0});var De=E(ie);we=S(De,he),De.forEach(u),ce=x(Se),Z.l(Se),Se.forEach(u),G.forEach(u),this.h()},h(){y(l,"class","mb-3 text-lg font-semibold"),y(i,"class","text-sm"),y(f,"class","text-lg font-bold"),y(c,"class","rounded bg-base-100 p-3"),y(h,"class","text-sm"),y(D,"class","text-lg font-bold"),y(C,"class","rounded bg-base-100 p-3"),y(H,"class","text-sm"),y(le,"class","text-lg font-bold"),y(T,"class","rounded bg-base-100 p-3"),y(O,"class","text-sm"),y(J,"class","text-lg font-bold"),y(B,"class","rounded bg-base-100 p-3"),y(o,"class","grid grid-cols-2 gap-4"),y(t,"class","rounded-lg bg-base-200 p-6"),y(ie,"class","mb-3 text-lg font-semibold"),y(ae,"class","rounded-lg bg-base-200 p-6"),y(e,"class","space-y-6")},m(Q,G){P(Q,e,G),n(e,t),n(t,l),n(t,a),n(t,o),n(o,c),n(c,i),n(c,g),n(c,f),n(f,b),n(o,m),n(o,C),n(C,h),n(C,N),n(C,D),n(D,M),n(D,A),n(o,j),n(o,T),n(T,H),n(T,F),n(T,le),n(le,z),n(o,q),n(o,B),n(B,O),n(B,be),n(B,J),n(J,ne),n(e,ke),n(e,ae),n(ae,ie),n(ie,we),n(ae,ce),Z.m(ae,null)},p(Q,G){G&1&&p!==(p=Q[0].appSubscription.name+"")&&L(b,p),G&1&&V!==(V=Q[0].stripeSubscription.plan.interval+"")&&L(M,V),G&1&&K!==(K=Q[0].stripeSubscription.quantity+"")&&L(z,K),G&1&&re!==(re=new Date(Q[0].stripeSubscription.current_period_end*1e3).toLocaleDateString()+"")&&L(ne,re),G&16&&he!==(he=Q[4]?"Reversal Information:":"Cancellation Information:")&&L(we,he),ve===(ve=je(Q))&&Z?Z.p(Q,G):(Z.d(1),Z=ve(Q),Z&&(Z.c(),Z.m(ae,null)))},d(Q){Q&&u(e),Z.d()}}}function us(r){let e,t=r[3].message+"",l,s,a;function o(d,g){return d[3].success?hs:bs}let c=o(r),i=c(r);return{c(){e=v("p"),l=w(t),s=I(),i.c(),a=se(),this.h()},l(d){e=_(d,"P",{class:!0});var g=E(e);l=S(g,t),g.forEach(u),s=x(d),i.l(d),a=se(),this.h()},h(){y(e,"class","mb-4 rounded-lg bg-base-200 p-4")},m(d,g){P(d,e,g),n(e,l),P(d,s,g),i.m(d,g),P(d,a,g)},p(d,g){g&8&&t!==(t=d[3].message+"")&&L(l,t),c===(c=o(d))&&i?i.p(d,g):(i.d(1),i=c(d),i&&(i.c(),i.m(a.parentNode,a)))},d(d){d&&(u(e),u(s),u(a)),i.d(d)}}}function ds(r){let e,t='<div class="rounded-lg bg-base-200 p-6"><div class="skeleton mb-3 h-6 w-60"></div> <div class="grid grid-cols-2 gap-4"><div class="rounded bg-base-100 p-3"><div class="skeleton mb-1 h-3 w-12"></div> <div class="skeleton h-5 w-24"></div></div> <div class="rounded bg-base-100 p-3"><div class="skeleton mb-1 h-3 w-16"></div> <div class="skeleton h-5 w-20"></div></div> <div class="rounded bg-base-100 p-3"><div class="skeleton mb-1 h-3 w-20"></div> <div class="skeleton h-5 w-8"></div></div> <div class="rounded bg-base-100 p-3"><div class="skeleton mb-1 h-3 w-24"></div> <div class="skeleton h-5 w-24"></div></div></div></div> <div class="rounded-lg bg-base-200 p-6"><div class="skeleton mb-3 h-6 w-48"></div> <div class="skeleton mb-4 h-4 w-full"></div> <div class="space-y-3"><div class="flex items-start"><div class="skeleton mr-2 mt-1.5 h-2.5 w-2.5 rounded-full"></div> <div class="skeleton h-4 w-full"></div></div> <div class="flex items-start"><div class="skeleton mr-2 mt-1.5 h-2.5 w-2.5 rounded-full"></div> <div class="skeleton h-4 w-full"></div></div> <div class="flex items-start"><div class="skeleton mr-2 mt-1.5 h-2.5 w-2.5 rounded-full"></div> <div class="skeleton h-4 w-full"></div></div> <div class="flex items-start"><div class="skeleton mr-2 mt-1.5 h-2.5 w-2.5 rounded-full"></div> <div class="skeleton h-4 w-full"></div></div></div></div>';return{c(){e=v("div"),e.innerHTML=t,this.h()},l(l){e=_(l,"DIV",{class:!0,"data-svelte-h":!0}),U(e)!=="svelte-gm7qha"&&(e.innerHTML=t),this.h()},h(){y(e,"class","space-y-6")},m(l,s){P(l,e,s)},p:X,d(l){l&&u(e)}}}function fs(r){let e,t="If you proceed with cancellation:",l,s,a,o,c,i=new Date(r[0].stripeSubscription.current_period_end*1e3).toLocaleDateString()+"",d,g,f,p,b,m=`You'll continue to have access to your current number of seats\r
                  and features during this period.`,C,h,k=`After the end date, your account will be moved to the free\r
                  tier plan.`,N,D,V="No further charges will be incurred after cancellation.";return{c(){e=v("p"),e.textContent=t,l=I(),s=v("ul"),a=v("li"),o=w(`Your current subscription will remain active until\r
                  `),c=v("span"),d=w(i),g=I(),f=w("."),p=I(),b=v("li"),b.textContent=m,C=I(),h=v("li"),h.textContent=k,N=I(),D=v("li"),D.textContent=V,this.h()},l(M){e=_(M,"P",{class:!0,"data-svelte-h":!0}),U(e)!=="svelte-mduid0"&&(e.textContent=t),l=x(M),s=_(M,"UL",{class:!0});var A=E(s);a=_(A,"LI",{});var j=E(a);o=S(j,`Your current subscription will remain active until\r
                  `),c=_(j,"SPAN",{class:!0});var T=E(c);d=S(T,i),g=x(T),T.forEach(u),f=S(j,"."),j.forEach(u),p=x(A),b=_(A,"LI",{"data-svelte-h":!0}),U(b)!=="svelte-9ejv9b"&&(b.textContent=m),C=x(A),h=_(A,"LI",{"data-svelte-h":!0}),U(h)!=="svelte-19brn99"&&(h.textContent=k),N=x(A),D=_(A,"LI",{"data-svelte-h":!0}),U(D)!=="svelte-irm8fa"&&(D.textContent=V),A.forEach(u),this.h()},h(){y(e,"class","mb-4"),y(c,"class","font-bold"),y(s,"class","list-disc space-y-2 pl-6")},m(M,A){P(M,e,A),P(M,l,A),P(M,s,A),n(s,a),n(a,o),n(a,c),n(c,d),n(c,g),n(a,f),n(s,p),n(s,b),n(s,C),n(s,h),n(s,N),n(s,D)},p(M,A){A&1&&i!==(i=new Date(M[0].stripeSubscription.current_period_end*1e3).toLocaleDateString()+"")&&L(d,i)},d(M){M&&(u(e),u(l),u(s))}}}function ps(r){let e,t="If you reverse the cancellation:",l,s,a,o="Your subscription will continue without interruption.",c,i,d="You'll retain access to all current features and seats.",g,f,p,b=new Date(r[0].stripeSubscription.current_period_end*1e3).toLocaleDateString()+"",m,C,h,k,N="Regular billing will resume on this date.";return{c(){e=v("p"),e.textContent=t,l=I(),s=v("ul"),a=v("li"),a.textContent=o,c=I(),i=v("li"),i.textContent=d,g=I(),f=v("li"),p=w("Your next billing date will remain "),m=w(b),C=w("."),h=I(),k=v("li"),k.textContent=N,this.h()},l(D){e=_(D,"P",{class:!0,"data-svelte-h":!0}),U(e)!=="svelte-g9ocx1"&&(e.textContent=t),l=x(D),s=_(D,"UL",{class:!0});var V=E(s);a=_(V,"LI",{"data-svelte-h":!0}),U(a)!=="svelte-4ixbcs"&&(a.textContent=o),c=x(V),i=_(V,"LI",{"data-svelte-h":!0}),U(i)!=="svelte-ihxa6k"&&(i.textContent=d),g=x(V),f=_(V,"LI",{});var M=E(f);p=S(M,"Your next billing date will remain "),m=S(M,b),C=S(M,"."),M.forEach(u),h=x(V),k=_(V,"LI",{"data-svelte-h":!0}),U(k)!=="svelte-k0gamx"&&(k.textContent=N),V.forEach(u),this.h()},h(){y(e,"class","mb-4"),y(s,"class","list-disc space-y-2 pl-6")},m(D,V){P(D,e,V),P(D,l,V),P(D,s,V),n(s,a),n(s,c),n(s,i),n(s,g),n(s,f),n(f,p),n(f,m),n(f,C),n(s,h),n(s,k)},p(D,V){V&1&&b!==(b=new Date(D[0].stripeSubscription.current_period_end*1e3).toLocaleDateString()+"")&&L(m,b)},d(D){D&&(u(e),u(l),u(s))}}}function bs(r){let e,t=`<p>There was a problem with your request. Please try again or contact
              support.</p>`;return{c(){e=v("div"),e.innerHTML=t,this.h()},l(l){e=_(l,"DIV",{class:!0,"data-svelte-h":!0}),U(e)!=="svelte-8uajfm"&&(e.innerHTML=t),this.h()},h(){y(e,"class","mt-4 rounded-lg bg-error/10 p-4")},m(l,s){P(l,e,s)},p:X,d(l){l&&u(e)}}}function hs(r){let e;function t(a,o){return a[4]?_s:vs}let l=t(r),s=l(r);return{c(){e=v("div"),s.c(),this.h()},l(a){e=_(a,"DIV",{class:!0});var o=E(e);s.l(o),o.forEach(u),this.h()},h(){y(e,"class","mt-4 rounded-lg bg-success/10 p-4")},m(a,o){P(a,e,o),s.m(e,null)},p(a,o){l!==(l=t(a))&&(s.d(1),s=l(a),s&&(s.c(),s.m(e,null)))},d(a){a&&u(e),s.d()}}}function vs(r){let e,t=`Your subscription will remain active until the end of your\r
                current billing period.`;return{c(){e=v("p"),e.textContent=t},l(l){e=_(l,"P",{"data-svelte-h":!0}),U(e)!=="svelte-13o1l1h"&&(e.textContent=t)},m(l,s){P(l,e,s)},d(l){l&&u(e)}}}function _s(r){let e,t="Your subscription will continue without interruption.";return{c(){e=v("p"),e.textContent=t},l(l){e=_(l,"P",{"data-svelte-h":!0}),U(e)!=="svelte-1qny0ue"&&(e.textContent=t)},m(l,s){P(l,e,s)},d(l){l&&u(e)}}}function At(r){let e,t=r[4]?"Confirm Reversal":"Confirm Cancellation",l,s,a;return{c(){e=v("button"),l=w(t),this.h()},l(o){e=_(o,"BUTTON",{type:!0,class:!0});var c=E(e);l=S(c,t),c.forEach(u),this.h()},h(){y(e,"type","button"),y(e,"class","btn"),e.disabled=r[2],ge(e,"btn-error",!r[4]),ge(e,"btn-success",r[4])},m(o,c){P(o,e,c),n(e,l),s||(a=pe(e,"click",r[7]),s=!0)},p(o,c){c&16&&t!==(t=o[4]?"Confirm Reversal":"Confirm Cancellation")&&L(l,t),c&4&&(e.disabled=o[2]),c&16&&ge(e,"btn-error",!o[4]),c&16&&ge(e,"btn-success",o[4])},d(o){o&&u(e),s=!1,a()}}}function ms(r){let e,t,l=r[4]?"Subscription Cancellation":"Cancel Subscription",s,a,o,c=r[4]?"Reverse Cancellation":"Cancel Subscription",i,d,g,f,p,b=r[1]&&Vt(r);return{c(){e=v("div"),t=v("h2"),s=w(l),a=I(),o=v("button"),i=w(c),d=I(),b&&b.c(),g=se(),this.h()},l(m){e=_(m,"DIV",{class:!0});var C=E(e);t=_(C,"H2",{class:!0});var h=E(t);s=S(h,l),h.forEach(u),a=x(C),o=_(C,"BUTTON",{class:!0});var k=E(o);i=S(k,c),k.forEach(u),C.forEach(u),d=x(m),b&&b.l(m),g=se(),this.h()},h(){y(t,"class","mb-4 text-xl font-bold"),y(o,"class","btn w-full"),ge(o,"btn-error",!r[4]),ge(o,"btn-success",r[4]),y(e,"class","card mt-8 max-w-xl p-6 shadow")},m(m,C){P(m,e,C),n(e,t),n(t,s),n(e,a),n(e,o),n(o,i),P(m,d,C),b&&b.m(m,C),P(m,g,C),f||(p=pe(o,"click",r[5]),f=!0)},p(m,[C]){C&16&&l!==(l=m[4]?"Subscription Cancellation":"Cancel Subscription")&&L(s,l),C&16&&c!==(c=m[4]?"Reverse Cancellation":"Cancel Subscription")&&L(i,c),C&16&&ge(o,"btn-error",!m[4]),C&16&&ge(o,"btn-success",m[4]),m[1]?b?b.p(m,C):(b=Vt(m),b.c(),b.m(g.parentNode,g)):b&&(b.d(1),b=null)},i:X,o:X,d(m){m&&(u(e),u(d),u(g)),b&&b.d(m),f=!1,p()}}}function gs(r,e,t){let l,s;Bt(r,gt,b=>t(9,s=b));let{subscriptionData:a}=e,o=!1,c=!1,i=null;function d(){t(1,o=!0),t(2,c=!0),t(3,i=null),console.log("Subscription Data:",a),l?setTimeout(()=>{g(!0)},100):setTimeout(()=>{t(2,c=!1)},300)}async function g(b=!1){try{t(2,c=!0),console.log("Starting cancel action, isReversal=",b);const m=b?"/api/subscription/actions/reverse-cancel":"/api/subscription/actions/cancel";console.log("Using endpoint:",m),console.log("Authorization token available:",!!s.access_token);const C=await fetch(m,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s.access_token}`},body:JSON.stringify({})});console.log("Response status:",C.status);const h=C.headers.get("content-type");if(h&&h.includes("application/json")){const k=await C.json();if(console.log("Response data:",k),!C.ok)throw new Error(k.error||k.message||"Request failed");t(3,i=k)}else throw console.error("Empty or non-JSON response"),new Error("Invalid response from server");if(i.success)Ae.success(b?"Cancellation reversed successfully":"Subscription cancelled successfully");else throw new Error(i.message||"Action failed")}catch(m){console.error("Error processing cancel action:",m),Ae.error(b?"Failed to reverse cancellation":"Failed to cancel subscription"),t(3,i={success:!1,message:m.message})}finally{t(2,c=!1)}}const f=()=>g(l),p=()=>{i&&i.success?window.location.reload():(t(1,o=!1),t(3,i=null))};return r.$$set=b=>{"subscriptionData"in b&&t(0,a=b.subscriptionData)},r.$$.update=()=>{r.$$.dirty&1&&t(4,l=a.stripeSubscription.cancel_at_period_end)},[a,o,c,i,l,d,g,f,p]}class ys extends Ct{constructor(e){super(),kt(this,e,gs,ms,yt,{subscriptionData:0})}}function Cs(r){let e,t,l,s="No subscription data available",a,o,c="Return to Billing",i,d;return{c(){e=v("div"),t=v("div"),l=v("p"),l.textContent=s,a=I(),o=v("button"),o.textContent=c,this.h()},l(g){e=_(g,"DIV",{class:!0});var f=E(e);t=_(f,"DIV",{class:!0});var p=E(t);l=_(p,"P",{class:!0,"data-svelte-h":!0}),U(l)!=="svelte-73103j"&&(l.textContent=s),a=x(p),o=_(p,"BUTTON",{class:!0,"data-svelte-h":!0}),U(o)!=="svelte-oktbn0"&&(o.textContent=c),p.forEach(u),f.forEach(u),this.h()},h(){y(l,"class","mb-4 text-lg"),y(o,"class","rounded bg-primary px-4 py-2 text-white"),y(t,"class","text-center"),y(e,"class","flex h-48 items-center justify-center")},m(g,f){P(g,e,f),n(e,t),n(t,l),n(t,a),n(t,o),i||(d=pe(o,"click",r[8]),i=!0)},p:X,i:X,o:X,d(g){g&&u(e),i=!1,d()}}}function ks(r){var b,m,C;let e,t="Manage Billing",l,s,a=`<div><h3 class="font-bold">Pricing Section is new, Contact us to handle it directly</h3> <div class="text-sm">If their are any issues or the pricing details seems wrong, please
        contact us at 0439405248, or send a message in the chat. We&#39;ll be happy
        to assist you.</div></div>`,o,c,i,d,g,f,p;return c=new Yt({props:{title:"Current Subscription",editable:!1,fields:[{id:"planName",label:"Current Plan",initialValue:r[1].appSubscription.name},{id:"planStatus",label:"Status",initialValue:r[1].stripeSubscription.status},{id:"quantity",label:"Quantity",initialValue:((C=(m=(b=r[1])==null?void 0:b.stripeSubscription)==null?void 0:m.quantity)==null?void 0:C.toString())??"1"},{id:"interval",label:"Billing Interval",initialValue:r[2]?"Yearly":"Monthly"},{id:"nextBilling",label:"Next Billing Date",initialValue:new Date(r[1].stripeSubscription.current_period_end*1e3).toLocaleDateString()}],editButtonTitle:"Home",editLink:"/account"}}),d=new is({props:{data:r[0]}}),f=new ys({props:{subscriptionData:r[1]}}),{c(){e=v("h1"),e.textContent=t,l=I(),s=v("div"),s.innerHTML=a,o=I(),ht(c.$$.fragment),i=I(),ht(d.$$.fragment),g=I(),ht(f.$$.fragment),this.h()},l(h){e=_(h,"H1",{class:!0,"data-svelte-h":!0}),U(e)!=="svelte-2pdsts"&&(e.textContent=t),l=x(h),s=_(h,"DIV",{class:!0,"data-svelte-h":!0}),U(s)!=="svelte-id6dm2"&&(s.innerHTML=a),o=x(h),vt(c.$$.fragment,h),i=x(h),vt(d.$$.fragment,h),g=x(h),vt(f.$$.fragment,h),this.h()},h(){y(e,"class","mb-6 text-2xl font-bold"),y(s,"class","alert alert-info mb-4 mt-2 w-4/5")},m(h,k){P(h,e,k),P(h,l,k),P(h,s,k),P(h,o,k),_t(c,h,k),P(h,i,k),_t(d,h,k),P(h,g,k),_t(f,h,k),p=!0},p(h,k){var M,A,j;const N={};k&6&&(N.fields=[{id:"planName",label:"Current Plan",initialValue:h[1].appSubscription.name},{id:"planStatus",label:"Status",initialValue:h[1].stripeSubscription.status},{id:"quantity",label:"Quantity",initialValue:((j=(A=(M=h[1])==null?void 0:M.stripeSubscription)==null?void 0:A.quantity)==null?void 0:j.toString())??"1"},{id:"interval",label:"Billing Interval",initialValue:h[2]?"Yearly":"Monthly"},{id:"nextBilling",label:"Next Billing Date",initialValue:new Date(h[1].stripeSubscription.current_period_end*1e3).toLocaleDateString()}]),c.$set(N);const D={};k&1&&(D.data=h[0]),d.$set(D);const V={};k&2&&(V.subscriptionData=h[1]),f.$set(V)},i(h){p||(Qe(c.$$.fragment,h),Qe(d.$$.fragment,h),Qe(f.$$.fragment,h),p=!0)},o(h){Je(c.$$.fragment,h),Je(d.$$.fragment,h),Je(f.$$.fragment,h),p=!1},d(h){h&&(u(e),u(l),u(s),u(o),u(i),u(g)),mt(c,h),mt(d,h),mt(f,h)}}}function ws(r){let e,t,l="Error Loading Billing Information",s,a,o,c,i,d,g="Try Again",f,p,b="Return to Billing",m,C;return{c(){e=v("div"),t=v("h2"),t.textContent=l,s=I(),a=v("p"),o=w(r[4]),c=I(),i=v("div"),d=v("button"),d.textContent=g,f=I(),p=v("button"),p.textContent=b,this.h()},l(h){e=_(h,"DIV",{class:!0});var k=E(e);t=_(k,"H2",{class:!0,"data-svelte-h":!0}),U(t)!=="svelte-ho2c7i"&&(t.textContent=l),s=x(k),a=_(k,"P",{class:!0});var N=E(a);o=S(N,r[4]),N.forEach(u),c=x(k),i=_(k,"DIV",{class:!0});var D=E(i);d=_(D,"BUTTON",{class:!0,"data-svelte-h":!0}),U(d)!=="svelte-18f68qk"&&(d.textContent=g),f=x(D),p=_(D,"BUTTON",{class:!0,"data-svelte-h":!0}),U(p)!=="svelte-1u8qu2s"&&(p.textContent=b),D.forEach(u),k.forEach(u),this.h()},h(){y(t,"class","mb-4 text-xl font-bold text-red-700"),y(a,"class","text-red-600"),y(d,"class","rounded bg-primary px-4 py-2 text-white"),y(p,"class","rounded bg-secondary px-4 py-2 text-white"),y(i,"class","mt-4 flex justify-center gap-4"),y(e,"class","mx-auto my-8 max-w-xl rounded-lg bg-red-50 p-6 text-center")},m(h,k){P(h,e,k),n(e,t),n(e,s),n(e,a),n(a,o),n(e,c),n(e,i),n(i,d),n(i,f),n(i,p),m||(C=[pe(d,"click",r[6]),pe(p,"click",r[7])],m=!0)},p:X,i:X,o:X,d(h){h&&u(e),m=!1,jt(C)}}}function Ss(r){let e,t='<div class="h-12 w-12 animate-spin rounded-full border-4 border-primary border-t-transparent"></div>';return{c(){e=v("div"),e.innerHTML=t,this.h()},l(l){e=_(l,"DIV",{class:!0,"data-svelte-h":!0}),U(e)!=="svelte-ot77dz"&&(e.innerHTML=t),this.h()},h(){y(e,"class","flex h-48 items-center justify-center")},m(l,s){P(l,e,s)},p:X,i:X,o:X,d(l){l&&u(e)}}}function Ds(r){let e,t,l,s,a;const o=[Ss,ws,ks,Cs],c=[];function i(d,g){return d[3]?0:d[4]?1:d[1]?2:3}return t=i(r),l=c[t]=o[t](r),{c(){e=I(),l.c(),s=se(),this.h()},l(d){Ut("svelte-pje245",document.head).forEach(u),e=x(d),l.l(d),s=se(),this.h()},h(){document.title="Manage Billing"},m(d,g){P(d,e,g),c[t].m(d,g),P(d,s,g),a=!0},p(d,[g]){let f=t;t=i(d),t===f?c[t].p(d,g):(Rt(),Je(c[f],1,1,()=>{c[f]=null}),Ht(),l=c[t],l?l.p(d,g):(l=c[t]=o[t](d),l.c()),Qe(l,1),l.m(s.parentNode,s))},i(d){a||(Qe(l),a=!0)},o(d){Je(l),a=!1},d(d){d&&(u(e),u(s)),c[t].d(d)}}}function Es(r,e,t){let l,s,{data:a}=e,o=a.loading,c=a.error,i=null;Ot(()=>{if(c){Ae.error(c),He("/account/billing");return}!o&&a.subscriptionData&&t(1,i=a.subscriptionData)});const d=()=>window.location.reload(),g=()=>He("/account/billing"),f=()=>He("/account/billing");return r.$$set=p=>{"data"in p&&t(0,a=p.data)},r.$$.update=()=>{var p,b;r.$$.dirty&2&&t(5,l=((b=(p=i==null?void 0:i.stripeSubscription)==null?void 0:p.plan)==null?void 0:b.interval)||"month"),r.$$.dirty&32&&t(2,s=l==="year")},[a,i,s,o,c,l,d,g,f]}class js extends Ct{constructor(e){super(),kt(this,e,Es,Ds,yt,{data:0})}}export{js as component,As as universal};
