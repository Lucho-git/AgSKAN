import{g as nt}from"../chunks/CsvQbYGG.js";import{s as Z}from"../chunks/Ehf4wK3b.js";import{s as lt,d as p,i as I,r as at,f as P,z as K,k,A as rt,n as E,b as _,c as g,g as D,j as v,a as f,e as V,h as tt,t as et,w as st}from"../chunks/DjMlahvE.js";import{S as ot,i as ct,t as $,a as w,d as A,m as H,c as N,b as B,g as ut,e as dt}from"../chunks/KhAD1Hhl.js";import{S as ft}from"../chunks/BoQ59VT2.js";import{P as it}from"../chunks/o-up3uFB.js";import"../chunks/DSS83BMa.js";import{t as R}from"../chunks/C31GE7Pe.js";const pt=async({parent:o})=>{var e;await o();const t={loading:!0,isActiveCustomer:!1,hasEverHadSubscription:!1,currentPlanId:"free",subscriptionData:null,error:null};try{const i=await Z.getSubscriptionData();if(!i.success)throw new Error(i.message||"Failed to fetch subscription data");return{loading:!1,isActiveCustomer:i.isActiveCustomer,hasEverHadSubscription:i.hasEverHadSubscription,currentPlanId:i.currentPlanId,subscriptionData:i.subscriptionData,error:null}}catch(i){return console.error("Error loading billing data:",i),(e=i.message)!=null&&e.includes("Not authenticated")&&nt("/login"),{...t,loading:!1,error:i.message}}},mt=!1,Et=Object.freeze(Object.defineProperty({__proto__:null,load:pt,ssr:mt},Symbol.toStringTag,{value:"Module"}));function ht(o){var a,u,m,b,d,S,x,y,L,T;let t,e,i="Billing",c,r,l,s;r=new ft({props:{title:"Subscription",editable:!1,fields:[{id:"planName",label:"Current Plan",initialValue:o[2]},{id:"planStatus",label:"Status",initialValue:((u=(a=o[7])==null?void 0:a.stripeSubscription)==null?void 0:u.status)??"N/A"},{id:"quantity",label:"Quantity",initialValue:((d=(b=(m=o[7])==null?void 0:m.stripeSubscription)==null?void 0:b.quantity)==null?void 0:d.toString())??"1"},...(y=(x=(S=o[7])==null?void 0:S.stripeSubscription)==null?void 0:x.plan)!=null&&y.interval?[{id:"interval",label:"Billing Interval",initialValue:o[7].stripeSubscription.plan.interval==="year"?"Annually":"Monthly"}]:[],{id:"nextBilling",label:"Next Billing Date",initialValue:(T=(L=o[7])==null?void 0:L.stripeSubscription)!=null&&T.current_period_end?new Date(o[7].stripeSubscription.current_period_end*1e3).toLocaleDateString():"N/A"}],editButtonTitle:"Manage Subscription",editLink:"/account/billing/manage"}});let n=o[1]&&W();return{c(){t=v("div"),e=v("h1"),e.textContent=i,c=k(),B(r.$$.fragment),l=k(),n&&n.c(),this.h()},l(h){t=g(h,"DIV",{class:!0});var C=V(t);e=g(C,"H1",{class:!0,"data-svelte-h":!0}),D(e)!=="svelte-1s0bwqe"&&(e.textContent=i),c=P(C),N(r.$$.fragment,C),l=P(C),n&&n.l(C),C.forEach(p),this.h()},h(){_(e,"class","mb-6 text-center text-2xl font-bold"),_(t,"class","container mx-auto px-4")},m(h,C){I(h,t,C),f(t,e),f(t,c),H(r,t,null),f(t,l),n&&n.m(t,null),s=!0},p(h,C){var q,F,j,O,z,U,Q,Y,G,J;const M={};C&4&&(M.fields=[{id:"planName",label:"Current Plan",initialValue:h[2]},{id:"planStatus",label:"Status",initialValue:((F=(q=h[7])==null?void 0:q.stripeSubscription)==null?void 0:F.status)??"N/A"},{id:"quantity",label:"Quantity",initialValue:((z=(O=(j=h[7])==null?void 0:j.stripeSubscription)==null?void 0:O.quantity)==null?void 0:z.toString())??"1"},...(Y=(Q=(U=h[7])==null?void 0:U.stripeSubscription)==null?void 0:Q.plan)!=null&&Y.interval?[{id:"interval",label:"Billing Interval",initialValue:h[7].stripeSubscription.plan.interval==="year"?"Annually":"Monthly"}]:[],{id:"nextBilling",label:"Next Billing Date",initialValue:(J=(G=h[7])==null?void 0:G.stripeSubscription)!=null&&J.current_period_end?new Date(h[7].stripeSubscription.current_period_end*1e3).toLocaleDateString():"N/A"}]),r.$set(M),h[1]?n?C&2&&w(n,1):(n=W(),n.c(),w(n,1),n.m(t,null)):n&&(ut(),$(n,1,1,()=>{n=null}),dt())},i(h){s||(w(r.$$.fragment,h),w(n),s=!0)},o(h){$(r.$$.fragment,h),$(n),s=!1},d(h){h&&p(t),A(r),n&&n.d()}}}function bt(o){let t,e,i,c="Upgrade Your Account",r,l,s="Choose a paid plan to unlock additional features and capabilities",n,a,u,m;a=new it({props:{currentPlanId:"free",useFullPrice:!0}});let b=o[6]&&vt(o);return{c(){t=v("div"),e=v("div"),i=v("h1"),i.textContent=c,r=k(),l=v("p"),l.textContent=s,n=k(),B(a.$$.fragment),u=k(),b&&b.c(),this.h()},l(d){t=g(d,"DIV",{class:!0});var S=V(t);e=g(S,"DIV",{class:!0});var x=V(e);i=g(x,"H1",{class:!0,"data-svelte-h":!0}),D(i)!=="svelte-cdv42h"&&(i.textContent=c),r=P(x),l=g(x,"P",{class:!0,"data-svelte-h":!0}),D(l)!=="svelte-1814l9o"&&(l.textContent=s),n=P(x),N(a.$$.fragment,x),x.forEach(p),u=P(S),b&&b.l(S),S.forEach(p),this.h()},h(){_(i,"class","mb-4 text-center text-4xl font-bold"),_(l,"class","mb-8 text-center text-lg text-base-content/80"),_(e,"class","py-2"),_(t,"class","container mx-auto px-4")},m(d,S){I(d,t,S),f(t,e),f(e,i),f(e,r),f(e,l),f(e,n),H(a,e,null),f(t,u),b&&b.m(t,null),m=!0},p(d,S){d[6]&&b.p(d,S)},i(d){m||(w(a.$$.fragment,d),m=!0)},o(d){$(a.$$.fragment,d),m=!1},d(d){d&&p(t),A(a),b&&b.d()}}}function _t(o){let t,e,i="Error Loading Billing Information",c,r,l,s,n,a='<a href="/account/billing" class="rounded bg-primary px-4 py-2 text-white">Try Again</a>';return{c(){t=v("div"),e=v("h2"),e.textContent=i,c=k(),r=v("p"),l=et(o[4]),s=k(),n=v("div"),n.innerHTML=a,this.h()},l(u){t=g(u,"DIV",{class:!0});var m=V(t);e=g(m,"H2",{class:!0,"data-svelte-h":!0}),D(e)!=="svelte-ho2c7i"&&(e.textContent=i),c=P(m),r=g(m,"P",{class:!0});var b=V(r);l=tt(b,o[4]),b.forEach(p),s=P(m),n=g(m,"DIV",{class:!0,"data-svelte-h":!0}),D(n)!=="svelte-qsfx7l"&&(n.innerHTML=a),m.forEach(p),this.h()},h(){_(e,"class","mb-4 text-xl font-bold text-red-700"),_(r,"class","text-red-600"),_(n,"class","mt-4"),_(t,"class","mx-auto my-8 max-w-xl rounded-lg bg-red-50 p-6 text-center")},m(u,m){I(u,t,m),f(t,e),f(t,c),f(t,r),f(r,l),f(t,s),f(t,n)},p:E,i:E,o:E,d(u){u&&p(t)}}}function gt(o){let t,e='<div class="skeleton h-12 w-12 rounded-full"></div>';return{c(){t=v("div"),t.innerHTML=e,this.h()},l(i){t=g(i,"DIV",{class:!0,"data-svelte-h":!0}),D(t)!=="svelte-1ab2xdg"&&(t.innerHTML=e),this.h()},h(){_(t,"class","flex h-48 items-center justify-center")},m(i,c){I(i,t,c)},p:E,i:E,o:E,d(i){i&&p(t)}}}function W(o){let t,e,i="Upgrade Options",c,r,l;return r=new it({props:{currentPlanId:"free",useFullPrice:!0}}),{c(){t=v("div"),e=v("h2"),e.textContent=i,c=k(),B(r.$$.fragment),this.h()},l(s){t=g(s,"DIV",{class:!0});var n=V(t);e=g(n,"H2",{class:!0,"data-svelte-h":!0}),D(e)!=="svelte-166zgsd"&&(e.textContent=i),c=P(n),N(r.$$.fragment,n),n.forEach(p),this.h()},h(){_(e,"class","mb-6 text-center text-xl font-bold"),_(t,"class","mt-12")},m(s,n){I(s,t,n),f(t,e),f(t,c),H(r,t,null),l=!0},i(s){l||(w(r.$$.fragment,s),l=!0)},o(s){$(r.$$.fragment,s),l=!1},d(s){s&&p(t),A(r)}}}function vt(o){let t,e,i,c,r,l=o[0]&&X();return{c(){t=v("div"),e=v("button"),l&&l.c(),i=et(`\r
          View Past Invoices`),this.h()},l(s){t=g(s,"DIV",{class:!0});var n=V(t);e=g(n,"BUTTON",{class:!0});var a=V(e);l&&l.l(a),i=tt(a,`\r
          View Past Invoices`),a.forEach(p),n.forEach(p),this.h()},h(){_(e,"class","btn btn-outline btn-sm"),e.disabled=o[0],_(t,"class","mt-10 text-center")},m(s,n){I(s,t,n),f(t,e),l&&l.m(e,null),f(e,i),c||(r=st(e,"click",o[8]),c=!0)},p(s,n){s[0]?l||(l=X(),l.c(),l.m(e,i)):l&&(l.d(1),l=null),n&1&&(e.disabled=s[0])},d(s){s&&p(t),l&&l.d(),c=!1,r()}}}function X(o){let t;return{c(){t=v("span"),this.h()},l(e){t=g(e,"SPAN",{class:!0}),V(t).forEach(p),this.h()},h(){_(t,"class","loading loading-spinner loading-xs mr-2")},m(e,i){I(e,t,i)},d(e){e&&p(t)}}}function St(o){let t,e,i,c,r;const l=[gt,_t,bt,ht],s=[];function n(a,u){return a[3]?0:a[4]?1:a[5]?3:2}return e=n(o),i=s[e]=l[e](o),{c(){t=k(),i.c(),c=K(),this.h()},l(a){at("svelte-y42mya",document.head).forEach(p),t=P(a),i.l(a),c=K(),this.h()},h(){document.title="Billing"},m(a,u){I(a,t,u),s[e].m(a,u),I(a,c,u),r=!0},p(a,[u]){i.p(a,u)},i(a){r||(w(i),r=!0)},o(a){$(i),r=!1},d(a){a&&(p(t),p(c)),s[e].d(a)}}}function xt(o,t,e){var x;let i,c;rt("adminSection").set("billing");let{data:l}=t,s=l.loading,n=l.error,a=!1,u=l.currentPlanId||"free",m=l.isActiveCustomer||!1,b=l.hasEverHadSubscription||!1,d=l.subscriptionData;async function S(){try{e(0,a=!0);const y=await Z.createPortalSession();y.success&&y.url?window.location.href=y.url:R.error(y.message||"Failed to open billing portal")}catch(y){R.error("Error: "+(y.message||"Failed to open billing portal"))}finally{e(0,a=!1)}}return o.$$set=y=>{"data"in y&&e(9,l=y.data)},e(2,i=((x=d==null?void 0:d.appSubscription)==null?void 0:x.name)||"Free Plan"),e(1,c=u==="free"||!u||u==="none"),[a,c,i,s,n,m,b,d,S,l]}class $t extends ot{constructor(t){super(),ct(this,t,xt,St,lt,{data:9})}}export{$t as component,Et as universal};
