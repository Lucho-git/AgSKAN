import{s as Ae,d,i as Q,a,b as r,c as f,e as C,g as ee,f as j,j as p,k as q,l as _e,K as ce,q as ie,U as le,w as W,h as Y,t as Z,E as he,F as be}from"../chunks/DjMlahvE.js";import{S as Te,i as Le,t as $,a as R,e as Ne,d as de,m as fe,c as pe,b as me,g as Pe}from"../chunks/KhAD1Hhl.js";import{g as je}from"../chunks/BEF5l8Zs.js";import{a as ne}from"../chunks/DSS83BMa.js";import{p as ve}from"../chunks/C1kVPyTF.js";import{c as ge}from"../chunks/BoF3N7P3.js";import{m as ke}from"../chunks/C58cqHmn.js";import{o as Ee,s as we}from"../chunks/BvQflP90.js";import{t as oe}from"../chunks/C31GE7Pe.js";import{m as qe}from"../chunks/DLI7RhRl.js";import{U as Ve}from"../chunks/DWpPqQw9.js";import{M as Be}from"../chunks/nBD434NM.js";const Oe=()=>({}),tt=Object.freeze(Object.defineProperty({__proto__:null,load:Oe},Symbol.toStringTag,{value:"Module"}));function Ue(s){let t,e,l,g,v,u,o,i,h="Full Name",y,m,c,I,b,B,S,O,T,N="I'll add my map ID later",w,_,n,M=s[0]?"Continue Setup":"Complete Setup",A,D,U,J,G,L=s[6]&&ye(s);u=new Ve({props:{size:18,class:"text-base-content/70"}});let V=!s[0]&&Ie(s),k=s[8]&&Me();return{c(){L&&L.c(),t=q(),e=p("div"),l=p("div"),g=p("div"),v=p("label"),me(u.$$.fragment),o=q(),i=p("span"),i.textContent=h,y=q(),m=p("input"),c=q(),V&&V.c(),I=q(),b=p("div"),B=p("label"),S=p("input"),O=q(),T=p("span"),T.textContent=N,w=q(),_=p("button"),k&&k.c(),n=q(),A=Z(M),this.h()},l(E){L&&L.l(E),t=j(E),e=f(E,"DIV",{class:!0});var F=C(e);l=f(F,"DIV",{class:!0});var K=C(l);g=f(K,"DIV",{class:!0});var X=C(g);v=f(X,"LABEL",{class:!0});var P=C(v);pe(u.$$.fragment,P),o=j(P),i=f(P,"SPAN",{class:!0,"data-svelte-h":!0}),ee(i)!=="svelte-8nvrpr"&&(i.textContent=h),P.forEach(d),y=j(X),m=f(X,"INPUT",{type:!0,placeholder:!0,class:!0}),X.forEach(d),c=j(K),V&&V.l(K),I=j(K),b=f(K,"DIV",{class:!0});var x=C(b);B=f(x,"LABEL",{class:!0});var z=C(B);S=f(z,"INPUT",{type:!0,class:!0}),O=j(z),T=f(z,"SPAN",{class:!0,"data-svelte-h":!0}),ee(T)!=="svelte-1f0ujgz"&&(T.textContent=N),z.forEach(d),x.forEach(d),w=j(K),_=f(K,"BUTTON",{class:!0});var H=C(_);k&&k.l(H),n=j(H),A=Y(H,M),H.forEach(d),K.forEach(d),F.forEach(d),this.h()},h(){r(i,"class","label-text"),r(v,"class","label items-center gap-2"),r(m,"type","text"),r(m,"placeholder","Enter your full name"),r(m,"class","input input-bordered w-full"),m.required=!0,r(g,"class","form-control mb-6"),r(S,"type","checkbox"),r(S,"class","checkbox checkbox-sm"),r(T,"class","label-text"),r(B,"class","label cursor-pointer justify-start gap-2"),r(b,"class","form-control mb-6"),r(_,"class","btn btn-primary w-full"),_.disabled=D=!s[10]||s[8],r(l,"class","card-body"),r(e,"class","card bg-base-100 shadow-xl")},m(E,F){L&&L.m(E,F),Q(E,t,F),Q(E,e,F),a(e,l),a(l,g),a(g,v),fe(u,v,null),a(v,o),a(v,i),a(g,y),a(g,m),le(m,s[3]),a(l,c),V&&V.m(l,null),a(l,I),a(l,b),a(b,B),a(B,S),S.checked=s[0],a(B,O),a(B,T),a(l,w),a(l,_),k&&k.m(_,null),a(_,n),a(_,A),U=!0,J||(G=[W(m,"input",s[15]),W(S,"change",s[17]),W(_,"click",s[13])],J=!0)},p(E,F){E[6]?L?L.p(E,F):(L=ye(E),L.c(),L.m(t.parentNode,t)):L&&(L.d(1),L=null),F&8&&m.value!==E[3]&&le(m,E[3]),E[0]?V&&(Pe(),$(V,1,1,()=>{V=null}),Ne()):V?(V.p(E,F),F&1&&R(V,1)):(V=Ie(E),V.c(),R(V,1),V.m(l,I)),F&1&&(S.checked=E[0]),E[8]?k||(k=Me(),k.c(),k.m(_,n)):k&&(k.d(1),k=null),(!U||F&1)&&M!==(M=E[0]?"Continue Setup":"Complete Setup")&&ie(A,M),(!U||F&1280&&D!==(D=!E[10]||E[8]))&&(_.disabled=D)},i(E){U||(R(u.$$.fragment,E),R(V),U=!0)},o(E){$(u.$$.fragment,E),$(V),U=!1},d(E){E&&(d(t),d(e)),L&&L.d(E),de(u),V&&V.d(),k&&k.d(),J=!1,ce(G)}}}function Fe(s){var E,F,K,X;let t,e,l,g,v="Connected Map",u,o,i=(((E=s[5])==null?void 0:E.map_name)||((F=s[2])==null?void 0:F.map_name))+"",h,y,m,c,I=(((K=s[5])==null?void 0:K.owner)||((X=s[2])==null?void 0:X.owner))+"",b,B,S,O,T,N,w,_="Full Name",n,M,A,D,U,J,G,L,V;T=new Ve({props:{size:18,class:"text-base-content/70"}});let k=s[8]&&De();return{c(){t=p("div"),e=p("div"),l=p("div"),g=p("h2"),g.textContent=v,u=q(),o=p("p"),h=Z(i),y=q(),m=p("p"),c=Z("Owned by "),b=Z(I),B=q(),S=p("div"),O=p("label"),me(T.$$.fragment),N=q(),w=p("span"),w.textContent=_,n=q(),M=p("input"),A=q(),D=p("button"),k&&k.c(),U=Z(`\r
            Continue`),this.h()},l(P){t=f(P,"DIV",{class:!0});var x=C(t);e=f(x,"DIV",{class:!0});var z=C(e);l=f(z,"DIV",{class:!0});var H=C(l);g=f(H,"H2",{class:!0,"data-svelte-h":!0}),ee(g)!=="svelte-3m5xzy"&&(g.textContent=v),u=j(H),o=f(H,"P",{class:!0});var ae=C(o);h=Y(ae,i),ae.forEach(d),y=j(H),m=f(H,"P",{class:!0});var te=C(m);c=Y(te,"Owned by "),b=Y(te,I),te.forEach(d),H.forEach(d),B=j(z),S=f(z,"DIV",{class:!0});var se=C(S);O=f(se,"LABEL",{class:!0});var re=C(O);pe(T.$$.fragment,re),N=j(re),w=f(re,"SPAN",{class:!0,"data-svelte-h":!0}),ee(w)!=="svelte-8nvrpr"&&(w.textContent=_),re.forEach(d),n=j(se),M=f(se,"INPUT",{type:!0,placeholder:!0,class:!0}),se.forEach(d),A=j(z),D=f(z,"BUTTON",{class:!0});var ue=C(D);k&&k.l(ue),U=Y(ue,`\r
            Continue`),ue.forEach(d),z.forEach(d),x.forEach(d),this.h()},h(){r(g,"class","mb-2 text-lg font-semibold"),r(o,"class","text-base-content"),r(m,"class","text-sm opacity-70"),r(l,"class","mb-6 rounded-lg bg-base-200 p-4"),r(w,"class","label-text"),r(O,"class","label items-center gap-2"),r(M,"type","text"),r(M,"placeholder","Enter your full name"),r(M,"class","input input-bordered w-full"),M.required=!0,r(S,"class","form-control mb-6"),r(D,"class","btn btn-primary w-full"),D.disabled=J=!s[3].trim()||s[8],r(e,"class","card-body"),r(t,"class","card bg-base-100 shadow-xl")},m(P,x){Q(P,t,x),a(t,e),a(e,l),a(l,g),a(l,u),a(l,o),a(o,h),a(l,y),a(l,m),a(m,c),a(m,b),a(e,B),a(e,S),a(S,O),fe(T,O,null),a(O,N),a(O,w),a(S,n),a(S,M),le(M,s[3]),a(e,A),a(e,D),k&&k.m(D,null),a(D,U),G=!0,L||(V=[W(M,"input",s[14]),W(D,"click",s[13])],L=!0)},p(P,x){var z,H,ae,te;(!G||x&36)&&i!==(i=(((z=P[5])==null?void 0:z.map_name)||((H=P[2])==null?void 0:H.map_name))+"")&&ie(h,i),(!G||x&36)&&I!==(I=(((ae=P[5])==null?void 0:ae.owner)||((te=P[2])==null?void 0:te.owner))+"")&&ie(b,I),x&8&&M.value!==P[3]&&le(M,P[3]),P[8]?k||(k=De(),k.c(),k.m(D,U)):k&&(k.d(1),k=null),(!G||x&264&&J!==(J=!P[3].trim()||P[8]))&&(D.disabled=J)},i(P){G||(R(T.$$.fragment,P),G=!0)},o(P){$(T.$$.fragment,P),G=!1},d(P){P&&d(t),de(T),k&&k.d(),L=!1,ce(V)}}}function ye(s){let t,e,l,g,v,u;return{c(){t=p("div"),e=be("svg"),l=be("path"),g=q(),v=p("span"),u=Z(s[6]),this.h()},l(o){t=f(o,"DIV",{class:!0});var i=C(t);e=he(i,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0});var h=C(e);l=he(h,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),C(l).forEach(d),h.forEach(d),g=j(i),v=f(i,"SPAN",{});var y=C(v);u=Y(y,s[6]),y.forEach(d),i.forEach(d),this.h()},h(){r(l,"stroke-linecap","round"),r(l,"stroke-linejoin","round"),r(l,"stroke-width","2"),r(l,"d","M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"),r(e,"xmlns","http://www.w3.org/2000/svg"),r(e,"class","h-6 w-6 shrink-0 stroke-current"),r(e,"fill","none"),r(e,"viewBox","0 0 24 24"),r(t,"class","alert alert-error mb-6")},m(o,i){Q(o,t,i),a(t,e),a(e,l),a(t,g),a(t,v),a(v,u)},p(o,i){i&64&&ie(u,o[6])},d(o){o&&d(t)}}}function Ie(s){let t,e,l,g,v,u="Map ID",o,i,h,y,m,c,I,b,B,S,O,T;l=new Be({props:{size:18,class:"text-base-content/70"}});let N=s[9]&&Ce(),w=s[1]&&!s[7]&&Se();return{c(){t=p("div"),e=p("label"),me(l.$$.fragment),g=q(),v=p("span"),v.textContent=u,o=q(),i=p("div"),h=p("input"),m=q(),c=p("button"),N&&N.c(),I=Z(`\r
                  Join`),B=q(),w&&w.c(),this.h()},l(_){t=f(_,"DIV",{class:!0});var n=C(t);e=f(n,"LABEL",{class:!0});var M=C(e);pe(l.$$.fragment,M),g=j(M),v=f(M,"SPAN",{class:!0,"data-svelte-h":!0}),ee(v)!=="svelte-fs4ily"&&(v.textContent=u),M.forEach(d),o=j(n),i=f(n,"DIV",{class:!0});var A=C(i);h=f(A,"INPUT",{type:!0,placeholder:!0,class:!0}),m=j(A),c=f(A,"BUTTON",{type:!0,class:!0});var D=C(c);N&&N.l(D),I=Y(D,`\r
                  Join`),D.forEach(d),A.forEach(d),B=j(n),w&&w.l(n),n.forEach(d),this.h()},h(){r(v,"class","label-text"),r(e,"class","label items-center gap-2"),r(h,"type","text"),r(h,"placeholder","Enter map ID"),r(h,"class","input input-bordered flex-1"),h.required=y=!s[0],r(c,"type","button"),r(c,"class","btn btn-primary"),c.disabled=b=!s[7]||s[9],r(i,"class","flex gap-2"),r(t,"class","form-control mb-6")},m(_,n){Q(_,t,n),a(t,e),fe(l,e,null),a(e,g),a(e,v),a(t,o),a(t,i),a(i,h),le(h,s[1]),a(i,m),a(i,c),N&&N.m(c,null),a(c,I),a(t,B),w&&w.m(t,null),S=!0,O||(T=[W(h,"input",s[16]),W(h,"input",s[11]),W(c,"click",s[12])],O=!0)},p(_,n){(!S||n&1&&y!==(y=!_[0]))&&(h.required=y),n&2&&h.value!==_[1]&&le(h,_[1]),_[9]?N||(N=Ce(),N.c(),N.m(c,I)):N&&(N.d(1),N=null),(!S||n&640&&b!==(b=!_[7]||_[9]))&&(c.disabled=b),_[1]&&!_[7]?w||(w=Se(),w.c(),w.m(t,null)):w&&(w.d(1),w=null)},i(_){S||(R(l.$$.fragment,_),S=!0)},o(_){$(l.$$.fragment,_),S=!1},d(_){_&&d(t),de(l),N&&N.d(),w&&w.d(),O=!1,ce(T)}}}function Ce(s){let t;return{c(){t=p("span"),this.h()},l(e){t=f(e,"SPAN",{class:!0}),C(t).forEach(d),this.h()},h(){r(t,"class","loading loading-spinner")},m(e,l){Q(e,t,l)},d(e){e&&d(t)}}}function Se(s){let t,e='<span class="label-text-alt text-error">Invalid Map ID</span>';return{c(){t=p("label"),t.innerHTML=e,this.h()},l(l){t=f(l,"LABEL",{class:!0,"data-svelte-h":!0}),ee(t)!=="svelte-1mi0jd7"&&(t.innerHTML=e),this.h()},h(){r(t,"class","label")},m(l,g){Q(l,t,g)},d(l){l&&d(t)}}}function Me(s){let t;return{c(){t=p("span"),this.h()},l(e){t=f(e,"SPAN",{class:!0}),C(t).forEach(d),this.h()},h(){r(t,"class","loading loading-spinner")},m(e,l){Q(e,t,l)},d(e){e&&d(t)}}}function De(s){let t;return{c(){t=p("span"),this.h()},l(e){t=f(e,"SPAN",{class:!0}),C(t).forEach(d),this.h()},h(){r(t,"class","loading loading-spinner")},m(e,l){Q(e,t,l)},d(e){e&&d(t)}}}function ze(s){let t,e,l,g='<h1 class="mb-4 text-5xl font-bold text-base-content">Join Map</h1> <p class="text-xl text-base-content/70">Connect to your farm&#39;s map</p>',v,u,o,i;const h=[Fe,Ue],y=[];function m(c,I){return c[4]?0:1}return u=m(s),o=y[u]=h[u](s),{c(){t=p("div"),e=p("div"),l=p("div"),l.innerHTML=g,v=q(),o.c(),this.h()},l(c){t=f(c,"DIV",{class:!0});var I=C(t);e=f(I,"DIV",{class:!0});var b=C(e);l=f(b,"DIV",{class:!0,"data-svelte-h":!0}),ee(l)!=="svelte-1qkega7"&&(l.innerHTML=g),v=j(b),o.l(b),b.forEach(d),I.forEach(d),this.h()},h(){r(l,"class","mb-16 text-center"),r(e,"class","mx-auto max-w-xl"),r(t,"class","min-h-screen bg-base-200 px-4 py-12")},m(c,I){Q(c,t,I),a(t,e),a(e,l),a(e,v),y[u].m(e,null),i=!0},p(c,[I]){let b=u;u=m(c),u===b?y[u].p(c,I):(Pe(),$(y[b],1,1,()=>{y[b]=null}),Ne(),o=y[u],o?o.p(c,I):(o=y[u]=h[u](c),o.c()),R(o,1),o.m(e,null))},i(c){i||(R(o),i=!0)},o(c){$(o),i=!1},d(c){c&&d(t),y[u].d()}}}function He(s,t,e){let l,g,v,u;_e(s,ve,n=>e(18,v=n)),_e(s,ge,n=>e(5,u=n));let o=null,i=!1,h="",y=!1,m=null,c=!1,I=!1,b="";async function B(){if(!h){e(7,y=!1);return}const{data:n,error:M}=await ne.from("master_maps").select("id").eq("id",h).single();e(7,y=!M&&n!==null)}async function S(){e(9,I=!0),e(6,o=null);try{const n=await qe.connectToMap(h);if(!n.success)throw new Error(n.message||"Failed to join map");e(2,m={id:n.data.connectedMap.id,map_name:n.data.connectedMap.map_name,owner:n.data.connectedMap.owner}),ge.set(n.data.connectedMap),ke.set(n.data.mapActivity),n.data.operations&&n.data.operations.length>0&&(Ee.set(n.data.operations),n.data.operation&&we.set(n.data.operation)),oe.success("Successfully joined map")}catch(n){e(6,o=n.message||"Failed to join map"),oe.error(o)}finally{e(9,I=!1)}}async function O(){e(8,c=!0),e(6,o=null);try{const n={full_name:b,role:"operator",onboarded:!0,updated_at:new Date().toISOString()};if(l){const A=(m==null?void 0:m.id)||u.id,{data:D,error:U}=await ne.from("operations").select("id").eq("master_map_id",A).limit(1).single();if(!U&&D){n.selected_operation_id=D.id;const{data:J}=await ne.from("operations").select("*").eq("id",D.id).single();J&&(Ee.set([J]),we.set(J))}n.master_map_id=A}const{error:M}=await ne.from("profiles").update(n).eq("id",v.id);if(M)throw new Error("Failed to update profile");ve.update(A=>({...A,full_name:b,user_type:"operator",master_map_id:l?(m==null?void 0:m.id)||u.id:null,selected_operation_id:n.selected_operation_id||null})),l&&ke.update(A=>{const D=A.connected_profiles.map(U=>U.id===v.id?{...U,full_name:b}:U);return{...A,connected_profiles:D}}),oe.success("Setup completed successfully!"),je("/account")}catch(n){e(6,o=n.message||"Failed to complete setup"),oe.error(o)}finally{e(8,c=!1)}}function T(){b=this.value,e(3,b)}function N(){b=this.value,e(3,b)}function w(){h=this.value,e(1,h)}function _(){i=this.checked,e(0,i)}return s.$$.update=()=>{s.$$.dirty&36&&e(4,l=(u==null?void 0:u.id)||m),s.$$.dirty&25&&e(10,g=b.trim().length>0&&(i||l)),s.$$.dirty&2&&h&&B()},[i,h,m,b,l,u,o,y,c,I,g,B,S,O,T,N,w,_]}class lt extends Te{constructor(t){super(),Le(this,t,He,ze,Ae,{})}}export{lt as component,tt as universal};
