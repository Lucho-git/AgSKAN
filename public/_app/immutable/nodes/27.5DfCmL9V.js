import{s as q,d as g,H as z,q as P,i as T,a as h,b as w,c as b,e as S,h as C,f as I,j as y,t as V,k as D,z as H,I as $}from"../chunks/scheduler.BVGjjnGO.js";import{S as L,i as A,f as O}from"../chunks/index.Vv2yv23T.js";import"../chunks/entry.Do23-0vY.js";import{s as R}from"../chunks/supabaseClient.CPicN285.js";import{f as M}from"../chunks/index.B6XYjUrf.js";function j(p){let r,l,a,u,d;return{c(){r=y("div"),l=y("div"),a=y("div"),u=D(),d=y("div"),this.h()},l(i){r=b(i,"DIV",{class:!0});var n=S(r);l=b(n,"DIV",{class:!0});var f=S(l);a=b(f,"DIV",{class:!0,style:!0}),S(a).forEach(g),f.forEach(g),n.forEach(g),u=I(i),d=b(i,"DIV",{class:!0}),S(d).forEach(g),this.h()},h(){w(a,"class","h-2 rounded-full bg-blue-600 transition-all duration-500"),$(a,"width",p[2]+"%"),w(l,"class","h-2 w-full rounded-full bg-gray-200"),w(r,"class","mb-4"),w(d,"class","loading loading-spinner loading-md text-blue-600")},m(i,n){T(i,r,n),h(r,l),h(l,a),T(i,u,n),T(i,d,n)},p(i,n){n&4&&$(a,"width",i[2]+"%")},d(i){i&&(g(r),g(u),g(d))}}}function B(p){let r,l,a,u,d,i,n,f,_,m,v,s=p[3]&&j(p);return{c(){r=y("div"),l=y("div"),a=y("div"),u=y("h1"),d=V(p[0]),i=D(),n=y("p"),f=V(p[1]),_=D(),s&&s.c(),this.h()},l(e){r=b(e,"DIV",{class:!0});var c=S(r);l=b(c,"DIV",{class:!0});var k=S(l);a=b(k,"DIV",{class:!0});var t=S(a);u=b(t,"H1",{class:!0});var o=S(u);d=C(o,p[0]),o.forEach(g),i=I(t),n=b(t,"P",{class:!0});var E=S(n);f=C(E,p[1]),E.forEach(g),_=I(t),s&&s.l(t),t.forEach(g),k.forEach(g),c.forEach(g),this.h()},h(){w(u,"class","mb-2 text-2xl font-bold"),w(n,"class","mb-6 text-sm"),w(a,"class","rounded-lg p-8 shadow-lg"),w(l,"class","w-full max-w-md p-8 text-center"),w(r,"class","flex min-h-screen items-center justify-center")},m(e,c){T(e,r,c),h(r,l),h(l,a),h(a,u),h(u,d),h(a,i),h(a,n),h(n,f),h(a,_),s&&s.m(a,null),v=!0},p(e,[c]){(!v||c&1)&&P(d,e[0]),(!v||c&2)&&P(f,e[1]),e[3]?s?s.p(e,c):(s=j(e),s.c(),s.m(a,null)):s&&(s.d(1),s=null)},i(e){v||(e&&z(()=>{v&&(m||(m=O(a,M,{},!0)),m.run(1))}),v=!0)},o(e){e&&(m||(m=O(a,M,{},!1)),m.run(0)),v=!1},d(e){e&&g(r),s&&s.d(),e&&m&&m.end()}}}function F(p,r,l){let a="Preparing to sign out...",u="Initializing...",d=0,i=!1,n=!1;const f=(s,e,c)=>{l(0,a=s),l(1,u=e),l(2,d=c)},_=()=>{console.group("Storage Cleanup");let s=0,e=0;try{for(let t=0;t<localStorage.length;t++){const o=localStorage.key(t);(o?.includes("supabase")||o?.includes("sb-"))&&e++}for(let t=0;t<sessionStorage.length;t++){const o=sessionStorage.key(t);(o?.includes("supabase")||o?.includes("sb-"))&&e++}document.cookie.split(";").forEach(t=>{const o=t.split("=")[0].trim();(o.includes("supabase")||o.includes("sb-"))&&e++});for(let t=0;t<localStorage.length;t++){const o=localStorage.key(t);(o?.includes("supabase")||o?.includes("sb-"))&&(localStorage.removeItem(o),s++,console.log(`Cleared localStorage: ${o}`))}for(let t=0;t<sessionStorage.length;t++){const o=sessionStorage.key(t);(o?.includes("supabase")||o?.includes("sb-"))&&(sessionStorage.removeItem(o),s++,console.log(`Cleared sessionStorage: ${o}`))}const c=[window.location.hostname,`.${window.location.hostname}`,window.location.hostname.split(".").slice(1).join("."),""],k=["/",""];return document.cookie.split(";").forEach(t=>{const o=t.split("=")[0].trim();(o.includes("supabase")||o.includes("sb-"))&&(c.forEach(E=>{k.forEach(x=>{document.cookie=`${o}=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=${x}${E?`; domain=${E}`:""}`})}),s++,console.log(`Cleared cookie: ${o}`))}),{success:!0,clearedItems:s,totalItems:e}}catch(c){return console.error("Error clearing storage:",c),{success:!1,error:c}}finally{console.groupEnd()}},m=()=>{window.location.replace("/login")},v=async()=>{if(!i){l(3,i=!0),console.group("Sign-out Process"),console.time("Total Sign-out Duration");try{f("Signing out...","Contacting server...",20),await new Promise(e=>setTimeout(e,400));try{const e=new FormData,c=await fetch("?/signout",{method:"POST",body:e})}catch(e){console.log("Server-side signout skipped:",e)}f("Signing out...","Clearing authentication...",40),await new Promise(e=>setTimeout(e,400)),f("Cleaning up...","Removing stored data...",60),await new Promise(e=>setTimeout(e,400)),_().success||console.warn("Storage cleanup had issues"),f("Verifying...","Making sure everything is cleared...",80),await new Promise(e=>setTimeout(e,400)),_(),f("Success!","Taking you to login...",100),await new Promise(e=>setTimeout(e,400)),n=!0,await R.auth.signOut({scope:"global"}),setTimeout(()=>{m()},100)}catch(s){console.error("Sign-out failed:",s),f("Error during sign-out","Attempting emergency cleanup...",100);try{_(),n=!0,await R.auth.signOut({scope:"global"})}catch(e){console.error("Recovery attempt failed:",e)}setTimeout(()=>{m()},500)}finally{console.timeEnd("Total Sign-out Duration"),console.groupEnd()}}};return H(()=>{window.addEventListener("beforeunload",()=>{if(n)return m(),null}),v()}),[a,u,d,i]}class U extends L{constructor(r){super(),A(this,r,F,B,q,{})}}export{U as component};
