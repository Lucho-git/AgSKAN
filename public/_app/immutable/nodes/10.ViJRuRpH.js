import{g as He}from"../chunks/entry.Do23-0vY.js";import{s as gt}from"../chunks/sessionStore.B10XaNYZ.js";import{P as Ut,s as yt,n as X,d,K as jt,b as g,q as U,i as P,a as n,A as pe,c as v,e as E,g as B,f as I,h as C,x as se,j as _,k as x,t as k,l as Lt,_ as ge,w as Bt,z as Ot}from"../chunks/scheduler.BVGjjnGO.js";import{S as Ct,i as kt,t as Je,a as Qe,e as Ht,d as ht,m as vt,c as _t,b as mt,g as Rt}from"../chunks/index.Vv2yv23T.js";import{t as Ae}from"../chunks/Toaster.svelte_svelte_type_style_lang.BcvbULy5.js";import{S as Yt}from"../chunks/settings_module.8P1bMYdC.js";const qt=async()=>{try{const a=Ut(gt);if(!a?.access_token)return console.error("No valid session for billing management"),He("/login"),{loading:!0};console.log("Making request to /api/subscription/manage");const e=await fetch("/api/subscription/manage",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a.access_token}`}});if(console.log("Response status:",e.status),!e.ok){const s=await e.text();console.error("API error response:",s);try{const l=JSON.parse(s);throw new Error(l.error||"Failed to fetch subscription details")}catch{throw new Error(`Failed to fetch subscription details (${e.status})`)}}const t=await e.json();return console.log("Response data structure:",Object.keys(t)),console.log("Has subscriptionData:",t.subscriptionData?"Yes":"No"),console.log("Has primarySubscription:",t.subscriptionData?.primarySubscription?"Yes":"No"),t.subscriptionData?.primarySubscription?{loading:!1,subscriptionData:t.subscriptionData.primarySubscription,seatManagementInfo:t.seatManagementInfo,error:null}:(console.log("No primary subscription found in data"),He("/account/billing"),{loading:!0})}catch(a){return console.error("Error loading subscription management data:",a),Ae.error("Failed to load subscription details"),setTimeout(()=>He("/account/billing"),2e3),{loading:!1,error:a.message,subscriptionData:null,seatManagementInfo:null}}},Ft=!1,Vs=Object.freeze(Object.defineProperty({__proto__:null,load:qt,ssr:Ft},Symbol.toStringTag,{value:"Module"}));function zt(a){let e;return{c(){e=k("Modify number of seats")},l(t){e=C(t,"Modify number of seats")},m(t,s){P(t,e,s)},p:X,d(t){t&&d(e)}}}function Jt(a){let e,t,s;return{c(){e=k("Add "),t=k(a[1]),s=k(" seats")},l(l){e=C(l,"Add "),t=C(l,a[1]),s=C(l," seats")},m(l,o){P(l,e,o),P(l,t,o),P(l,s,o)},p(l,o){o&2&&U(t,l[1])},d(l){l&&(d(e),d(t),d(s))}}}function Qt(a){let e,t=Math.abs(a[1])+"",s,l;return{c(){e=k("Reduce "),s=k(t),l=k(" seats")},l(o){e=C(o,"Reduce "),s=C(o,t),l=C(o," seats")},m(o,r){P(o,e,r),P(o,s,r),P(o,l,r)},p(o,r){r&2&&t!==(t=Math.abs(o[1])+"")&&U(s,t)},d(o){o&&(d(e),d(s),d(l))}}}function Nt(a){let e,t,s,l,o,r,u=a[5]&&a[5].success?"Refresh Page":"Close",i,f,m;function p(y,S){return y[5]?Kt:Gt}let h=p(a),c=h(a),b=!a[5]&&a[4]&&Mt(a);return{c(){e=_("div"),t=_("div"),c.c(),s=x(),l=_("div"),b&&b.c(),o=x(),r=_("button"),i=k(u),this.h()},l(y){e=v(y,"DIV",{class:!0});var S=E(e);t=v(S,"DIV",{class:!0});var w=E(t);c.l(w),s=I(w),l=v(w,"DIV",{class:!0});var N=E(l);b&&b.l(N),o=I(N),r=v(N,"BUTTON",{class:!0});var D=E(r);i=C(D,u),D.forEach(d),N.forEach(d),w.forEach(d),S.forEach(d),this.h()},h(){g(r,"class","btn btn-outline"),r.disabled=a[3],g(l,"class","modal-action mt-6"),g(t,"class","modal-box max-w-2xl"),g(e,"class","modal modal-open")},m(y,S){P(y,e,S),n(e,t),c.m(t,null),n(t,s),n(t,l),b&&b.m(l,null),n(l,o),n(l,r),n(r,i),f||(m=pe(r,"click",a[14]),f=!0)},p(y,S){h===(h=p(y))&&c?c.p(y,S):(c.d(1),c=h(y),c&&(c.c(),c.m(t,s))),!y[5]&&y[4]?b?b.p(y,S):(b=Mt(y),b.c(),b.m(l,o)):b&&(b.d(1),b=null),S&32&&u!==(u=y[5]&&y[5].success?"Refresh Page":"Close")&&U(i,u),S&8&&(r.disabled=y[3])},d(y){y&&d(e),c.d(),b&&b.d(),f=!1,m()}}}function Gt(a){let e,t="Confirm Seat Update",s,l;function o(i,f){if(i[3])return Zt;if(i[4])return Xt;if(i[6])return Wt}let r=o(a),u=r&&r(a);return{c(){e=_("h3"),e.textContent=t,s=x(),u&&u.c(),l=se(),this.h()},l(i){e=v(i,"H3",{class:!0,"data-svelte-h":!0}),B(e)!=="svelte-1mspo0w"&&(e.textContent=t),s=I(i),u&&u.l(i),l=se(),this.h()},h(){g(e,"class","mb-6 text-2xl font-bold")},m(i,f){P(i,e,f),P(i,s,f),u&&u.m(i,f),P(i,l,f)},p(i,f){r===(r=o(i))&&u?u.p(i,f):(u&&u.d(1),u=r&&r(i),u&&(u.c(),u.m(l.parentNode,l)))},d(i){i&&(d(e),d(s),d(l)),u&&u.d(i)}}}function Kt(a){let e;function t(o,r){return o[5].success?ss:ts}let s=t(a),l=s(a);return{c(){l.c(),e=se()},l(o){l.l(o),e=se()},m(o,r){l.m(o,r),P(o,e,r)},p(o,r){s===(s=t(o))&&l?l.p(o,r):(l.d(1),l=s(o),l&&(l.c(),l.m(e.parentNode,e)))},d(o){o&&d(e),l.d(o)}}}function Wt(a){let e,t,s="Unable to load preview information. Please try again.",l,o,r,u;return{c(){e=_("div"),t=_("p"),t.textContent=s,l=x(),o=_("span"),r=k("Error: "),u=k(a[6]),this.h()},l(i){e=v(i,"DIV",{class:!0});var f=E(e);t=v(f,"P",{"data-svelte-h":!0}),B(t)!=="svelte-vm1z5r"&&(t.textContent=s),l=I(f),o=v(f,"SPAN",{class:!0});var m=E(o);r=C(m,"Error: "),u=C(m,a[6]),m.forEach(d),f.forEach(d),this.h()},h(){g(o,"class","mt-2 block font-medium"),g(e,"class","rounded-lg bg-error/20 p-4")},m(i,f){P(i,e,f),n(e,t),n(e,l),n(e,o),n(o,r),n(o,u)},p(i,f){f&64&&U(u,i[6])},d(i){i&&d(e)}}}function Xt(a){let e,t,s,l=a[4].isIncreasing?"Increasing":"Decreasing",o,r,u,i=a[4].currentSeats+"",f,m,p,h=a[4].newSeats+"",c,b,y=a[4].newSeats>1?"s":"",S,w,N,D,V="Immediate Changes:",M,A,j,T,H="Future Billing:",ee,F,le,K,z=a[4].anchorDate+"",q,L,O=a[4].billingCycle+"",te,be,J,re,ne=Math.ceil(a[4].futureCost)+"",ke,ae,ie=a[4].currency+"",he,we,ce,je,ve=a[4].billingCycle+"",Z,Q,G,W,$,xe="Monthly Cost Comparison",Le,oe,_e,Ne="Current monthly rate:",Ue,ue,me,Se,De=a[4].oldMonthly.toFixed(2)+"",Ge,nt,Ee,Be,wt="New monthly rate:",at,Oe,Te,ot,Re=a[4].newMonthly.toFixed(2)+"",Ke,rt,de,Ye=a[4].monthlyDifference>0?"Increase":"Savings",We,it,ye,ct,qe=Math.abs(a[4].monthlyDifference).toFixed(2)+"",Xe,ut,Fe=a[4].currency+"",Ze,dt;function St(R,Y){return R[4].isIncreasing?es:$t}let $e=St(a),fe=$e(a);return{c(){e=_("div"),t=_("p"),s=k("You are "),o=k(l),r=k(`\r
              your subscription from\r
              `),u=_("span"),f=k(i),m=k(`\r
              to\r
              `),p=_("span"),c=k(h),b=k(`\r
              seat`),S=k(y),w=x(),N=_("div"),D=_("h4"),D.textContent=V,M=x(),fe.c(),A=x(),j=_("div"),T=_("h4"),T.textContent=H,ee=x(),F=_("p"),le=k("On "),K=_("span"),q=k(z),L=k(", your new "),te=k(O),be=k(` subscription cost will be\r
                `),J=_("span"),re=k("$"),ke=k(ne),ae=x(),he=k(ie),we=x(),ce=_("p"),je=k("This will be your new "),Z=k(ve),Q=k(` rate unless further\r
                changes are made.`),G=x(),W=_("div"),$=_("p"),$.textContent=xe,Le=x(),oe=_("div"),_e=_("span"),_e.textContent=Ne,Ue=x(),ue=_("span"),me=_("span"),Se=k("$"),Ge=k(De),nt=x(),Ee=_("div"),Be=_("span"),Be.textContent=wt,at=x(),Oe=_("span"),Te=_("span"),ot=k("$"),Ke=k(Re),rt=x(),de=_("p"),We=k(Ye),it=k(`\r
                  of\r
                  `),ye=_("span"),ct=k("$"),Xe=k(qe),ut=x(),Ze=k(Fe),dt=k(" per month"),this.h()},l(R){e=v(R,"DIV",{class:!0});var Y=E(e);t=v(Y,"P",{class:!0});var Ce=E(t);s=C(Ce,"You are "),o=C(Ce,l),r=C(Ce,`\r
              your subscription from\r
              `),u=v(Ce,"SPAN",{class:!0});var Dt=E(u);f=C(Dt,i),Dt.forEach(d),m=C(Ce,`\r
              to\r
              `),p=v(Ce,"SPAN",{class:!0});var Et=E(p);c=C(Et,h),Et.forEach(d),b=C(Ce,`\r
              seat`),S=C(Ce,y),Ce.forEach(d),w=I(Y),N=v(Y,"DIV",{class:!0});var et=E(N);D=v(et,"H4",{class:!0,"data-svelte-h":!0}),B(D)!=="svelte-yy5pt0"&&(D.textContent=V),M=I(et),fe.l(et),et.forEach(d),A=I(Y),j=v(Y,"DIV",{class:!0});var Pe=E(j);T=v(Pe,"H4",{class:!0,"data-svelte-h":!0}),B(T)!=="svelte-16lxgl8"&&(T.textContent=H),ee=I(Pe),F=v(Pe,"P",{class:!0});var Me=E(F);le=C(Me,"On "),K=v(Me,"SPAN",{class:!0});var Pt=E(K);q=C(Pt,z),Pt.forEach(d),L=C(Me,", your new "),te=C(Me,O),be=C(Me,` subscription cost will be\r
                `),J=v(Me,"SPAN",{class:!0});var ze=E(J);re=C(ze,"$"),ke=C(ze,ne),ae=I(ze),he=C(ze,ie),ze.forEach(d),Me.forEach(d),we=I(Pe),ce=v(Pe,"P",{class:!0});var tt=E(ce);je=C(tt,"This will be your new "),Z=C(tt,ve),Q=C(tt,` rate unless further\r
                changes are made.`),tt.forEach(d),G=I(Pe),W=v(Pe,"DIV",{class:!0});var Ie=E(W);$=v(Ie,"P",{class:!0,"data-svelte-h":!0}),B($)!=="svelte-u1tf3k"&&($.textContent=xe),Le=I(Ie),oe=v(Ie,"DIV",{class:!0});var st=E(oe);_e=v(st,"SPAN",{"data-svelte-h":!0}),B(_e)!=="svelte-15vwbc6"&&(_e.textContent=Ne),Ue=I(st),ue=v(st,"SPAN",{class:!0});var It=E(ue);me=v(It,"SPAN",{class:!0});var ft=E(me);Se=C(ft,"$"),Ge=C(ft,De),ft.forEach(d),It.forEach(d),st.forEach(d),nt=I(Ie),Ee=v(Ie,"DIV",{class:!0});var lt=E(Ee);Be=v(lt,"SPAN",{"data-svelte-h":!0}),B(Be)!=="svelte-klfbl3"&&(Be.textContent=wt),at=I(lt),Oe=v(lt,"SPAN",{class:!0});var xt=E(Oe);Te=v(xt,"SPAN",{class:!0});var pt=E(Te);ot=C(pt,"$"),Ke=C(pt,Re),pt.forEach(d),xt.forEach(d),lt.forEach(d),rt=I(Ie),de=v(Ie,"P",{class:!0});var Ve=E(de);We=C(Ve,Ye),it=C(Ve,`\r
                  of\r
                  `),ye=v(Ve,"SPAN",{class:!0});var bt=E(ye);ct=C(bt,"$"),Xe=C(bt,qe),bt.forEach(d),ut=I(Ve),Ze=C(Ve,Fe),dt=C(Ve," per month"),Ve.forEach(d),Ie.forEach(d),Pe.forEach(d),Y.forEach(d),this.h()},h(){g(u,"class","inline-block rounded bg-base-300 px-2 py-1 font-semibold"),g(p,"class","inline-block rounded bg-base-300 px-2 py-1 font-semibold"),g(t,"class","text-lg"),g(D,"class","mb-3 text-lg font-semibold"),g(N,"class","rounded-lg bg-base-200 p-6"),g(T,"class","mb-3 text-lg font-semibold"),g(K,"class","font-semibold"),g(J,"class","inline-block rounded bg-base-300 px-2 py-1 font-bold"),g(F,"class","mb-2"),g(ce,"class","mb-4 text-sm text-base-content/70"),g($,"class","mb-2 text-center font-semibold"),g(me,"class","inline-block rounded bg-base-300 px-2 py-1"),g(ue,"class","font-bold"),g(oe,"class","mb-2 flex items-center justify-between"),g(Te,"class","inline-block rounded bg-base-300 px-2 py-1"),g(Oe,"class","font-bold"),g(Ee,"class","mb-2 flex items-center justify-between"),g(ye,"class","inline-block rounded bg-base-300 px-2 py-1 font-bold"),ge(ye,"text-primary",a[4].monthlyDifference<0),g(de,"class","text-md mt-2 text-center"),g(W,"class","border-t pt-4"),g(j,"class","rounded-lg bg-base-200 p-6"),g(e,"class","space-y-6")},m(R,Y){P(R,e,Y),n(e,t),n(t,s),n(t,o),n(t,r),n(t,u),n(u,f),n(t,m),n(t,p),n(p,c),n(t,b),n(t,S),n(e,w),n(e,N),n(N,D),n(N,M),fe.m(N,null),n(e,A),n(e,j),n(j,T),n(j,ee),n(j,F),n(F,le),n(F,K),n(K,q),n(F,L),n(F,te),n(F,be),n(F,J),n(J,re),n(J,ke),n(J,ae),n(J,he),n(j,we),n(j,ce),n(ce,je),n(ce,Z),n(ce,Q),n(j,G),n(j,W),n(W,$),n(W,Le),n(W,oe),n(oe,_e),n(oe,Ue),n(oe,ue),n(ue,me),n(me,Se),n(me,Ge),n(W,nt),n(W,Ee),n(Ee,Be),n(Ee,at),n(Ee,Oe),n(Oe,Te),n(Te,ot),n(Te,Ke),n(W,rt),n(W,de),n(de,We),n(de,it),n(de,ye),n(ye,ct),n(ye,Xe),n(de,ut),n(de,Ze),n(de,dt)},p(R,Y){Y&16&&l!==(l=R[4].isIncreasing?"Increasing":"Decreasing")&&U(o,l),Y&16&&i!==(i=R[4].currentSeats+"")&&U(f,i),Y&16&&h!==(h=R[4].newSeats+"")&&U(c,h),Y&16&&y!==(y=R[4].newSeats>1?"s":"")&&U(S,y),$e===($e=St(R))&&fe?fe.p(R,Y):(fe.d(1),fe=$e(R),fe&&(fe.c(),fe.m(N,null))),Y&16&&z!==(z=R[4].anchorDate+"")&&U(q,z),Y&16&&O!==(O=R[4].billingCycle+"")&&U(te,O),Y&16&&ne!==(ne=Math.ceil(R[4].futureCost)+"")&&U(ke,ne),Y&16&&ie!==(ie=R[4].currency+"")&&U(he,ie),Y&16&&ve!==(ve=R[4].billingCycle+"")&&U(Z,ve),Y&16&&De!==(De=R[4].oldMonthly.toFixed(2)+"")&&U(Ge,De),Y&16&&Re!==(Re=R[4].newMonthly.toFixed(2)+"")&&U(Ke,Re),Y&16&&Ye!==(Ye=R[4].monthlyDifference>0?"Increase":"Savings")&&U(We,Ye),Y&16&&qe!==(qe=Math.abs(R[4].monthlyDifference).toFixed(2)+"")&&U(Xe,qe),Y&16&&ge(ye,"text-primary",R[4].monthlyDifference<0),Y&16&&Fe!==(Fe=R[4].currency+"")&&U(Ze,Fe)},d(R){R&&d(e),fe.d()}}}function Zt(a){let e,t='<div class="py-4"><div class="skeleton mb-2 h-6 w-3/4"></div></div> <div class="rounded-lg bg-base-200 p-6"><div class="skeleton mb-4 h-6 w-1/2"></div> <div class="skeleton mb-3 h-5 w-full"></div> <div class="skeleton h-4 w-2/3"></div></div> <div class="rounded-lg bg-base-200 p-6"><div class="skeleton mb-4 h-6 w-1/2"></div> <div class="skeleton mb-3 h-5 w-full"></div> <div class="skeleton mb-6 h-4 w-4/5"></div> <div class="border-t pt-4"><div class="skeleton mx-auto mb-4 h-5 w-1/2"></div> <div class="mb-3 flex items-center justify-between"><div class="skeleton h-4 w-1/3"></div> <div class="skeleton h-5 w-20"></div></div> <div class="mb-3 flex items-center justify-between"><div class="skeleton h-4 w-1/3"></div> <div class="skeleton h-5 w-20"></div></div> <div class="skeleton mx-auto mt-4 h-5 w-2/3"></div></div></div>';return{c(){e=_("div"),e.innerHTML=t,this.h()},l(s){e=v(s,"DIV",{class:!0,"data-svelte-h":!0}),B(e)!=="svelte-ccaglg"&&(e.innerHTML=t),this.h()},h(){g(e,"class","space-y-6")},m(s,l){P(s,e,l)},p:X,d(s){s&&d(e)}}}function $t(a){let e,t,s,l=a[4].currentSeats+"",o,r,u,i=a[4].daysUntilAnchor+"",f,m,p,h,c="No charges will be applied for reducing seats.";return{c(){e=_("p"),t=k(`Continued access to your\r
                  `),s=_("span"),o=k(l),r=k(`\r
                  seats for\r
\r
                  `),u=_("span"),f=k(i),m=k(`\r
\r
                  more days`),p=x(),h=_("p"),h.textContent=c,this.h()},l(b){e=v(b,"P",{class:!0});var y=E(e);t=C(y,`Continued access to your\r
                  `),s=v(y,"SPAN",{class:!0});var S=E(s);o=C(S,l),S.forEach(d),r=C(y,`\r
                  seats for\r
\r
                  `),u=v(y,"SPAN",{class:!0});var w=E(u);f=C(w,i),w.forEach(d),m=C(y,`\r
\r
                  more days`),y.forEach(d),p=I(b),h=v(b,"P",{class:!0,"data-svelte-h":!0}),B(h)!=="svelte-1g3k6ei"&&(h.textContent=c),this.h()},h(){g(s,"class","inline-block rounded bg-base-300 px-2 py-1 font-bold"),g(u,"class","inline-block rounded bg-base-300 px-2 py-1 font-bold"),g(e,"class","mb-2 text-lg"),g(h,"class","text-sm text-base-content/70")},m(b,y){P(b,e,y),n(e,t),n(e,s),n(s,o),n(e,r),n(e,u),n(u,f),n(e,m),P(b,p,y),P(b,h,y)},p(b,y){y&16&&l!==(l=b[4].currentSeats+"")&&U(o,l),y&16&&i!==(i=b[4].daysUntilAnchor+"")&&U(f,i)},d(b){b&&(d(e),d(p),d(h))}}}function es(a){let e,t,s=a[4].newSeats+"",l,o,r,u,i=Math.ceil(a[4].immediateCharge)+"",f,m,p=a[4].currency+"",h,c,b,y,S=a[4].newSeats-a[4].currentSeats>1?"s":"",w,N,D=a[4].daysUntilAnchor+"",V,M;return{c(){e=_("p"),t=k("You will be upgraded to "),l=k(s),o=k(` seats and be charged\r
                  `),r=_("span"),u=k("$"),f=k(i),m=x(),h=k(p),c=x(),b=_("p"),y=k("This fee covers the additional seat"),w=k(S),N=k(`\r
                  for `),V=k(D),M=k(" days."),this.h()},l(A){e=v(A,"P",{class:!0});var j=E(e);t=C(j,"You will be upgraded to "),l=C(j,s),o=C(j,` seats and be charged\r
                  `),r=v(j,"SPAN",{class:!0});var T=E(r);u=C(T,"$"),f=C(T,i),m=I(T),h=C(T,p),T.forEach(d),j.forEach(d),c=I(A),b=v(A,"P",{class:!0});var H=E(b);y=C(H,"This fee covers the additional seat"),w=C(H,S),N=C(H,`\r
                  for `),V=C(H,D),M=C(H," days."),H.forEach(d),this.h()},h(){g(r,"class","inline-block rounded bg-base-300 px-2 py-1 font-bold"),g(e,"class","mb-2"),g(b,"class","text-sm text-base-content/70")},m(A,j){P(A,e,j),n(e,t),n(e,l),n(e,o),n(e,r),n(r,u),n(r,f),n(r,m),n(r,h),P(A,c,j),P(A,b,j),n(b,y),n(b,w),n(b,N),n(b,V),n(b,M)},p(A,j){j&16&&s!==(s=A[4].newSeats+"")&&U(l,s),j&16&&i!==(i=Math.ceil(A[4].immediateCharge)+"")&&U(f,i),j&16&&p!==(p=A[4].currency+"")&&U(h,p),j&16&&S!==(S=A[4].newSeats-A[4].currentSeats>1?"s":"")&&U(w,S),j&16&&D!==(D=A[4].daysUntilAnchor+"")&&U(V,D)},d(A){A&&(d(e),d(c),d(b))}}}function ts(a){let e,t="Update Failed",s,l,o=a[5].error+"",r,u,i;function f(h,c){if(h[5].code==="card_declined")return ns;if(h[5].code==="insufficient_funds")return ls}let m=f(a),p=m&&m(a);return{c(){e=_("h3"),e.textContent=t,s=x(),l=_("p"),r=k(o),u=x(),p&&p.c(),i=se(),this.h()},l(h){e=v(h,"H3",{class:!0,"data-svelte-h":!0}),B(e)!=="svelte-msg6t8"&&(e.textContent=t),s=I(h),l=v(h,"P",{class:!0});var c=E(l);r=C(c,o),c.forEach(d),u=I(h),p&&p.l(h),i=se(),this.h()},h(){g(e,"class","mb-6 text-2xl font-bold"),g(l,"class","mb-4 rounded-lg bg-error/20 p-4")},m(h,c){P(h,e,c),P(h,s,c),P(h,l,c),n(l,r),P(h,u,c),p&&p.m(h,c),P(h,i,c)},p(h,c){c&32&&o!==(o=h[5].error+"")&&U(r,o),m!==(m=f(h))&&(p&&p.d(1),p=m&&m(h),p&&(p.c(),p.m(i.parentNode,i)))},d(h){h&&(d(e),d(s),d(l),d(u),d(i)),p&&p.d(h)}}}function ss(a){let e,t="Subscription Updated Successfully",s,l,o,r,u,i=a[5].newQuantity+"",f,m,p=a[5].discountApplied&&Tt();return{c(){e=_("h3"),e.textContent=t,s=x(),l=_("div"),p&&p.c(),o=x(),r=_("p"),u=k("Your seat count has been updated to "),f=k(i),m=k("."),this.h()},l(h){e=v(h,"H3",{class:!0,"data-svelte-h":!0}),B(e)!=="svelte-1wkr2m5"&&(e.textContent=t),s=I(h),l=v(h,"DIV",{class:!0});var c=E(l);p&&p.l(c),o=I(c),r=v(c,"P",{class:!0});var b=E(r);u=C(b,"Your seat count has been updated to "),f=C(b,i),m=C(b,"."),b.forEach(d),c.forEach(d),this.h()},h(){g(e,"class","mb-6 text-2xl font-bold"),g(r,"class","rounded-lg bg-success/20 p-4"),g(l,"class","space-y-4")},m(h,c){P(h,e,c),P(h,s,c),P(h,l,c),p&&p.m(l,null),n(l,o),n(l,r),n(r,u),n(r,f),n(r,m)},p(h,c){h[5].discountApplied?p||(p=Tt(),p.c(),p.m(l,o)):p&&(p.d(1),p=null),c&32&&i!==(i=h[5].newQuantity+"")&&U(f,i)},d(h){h&&(d(e),d(s),d(l)),p&&p.d()}}}function ls(a){let e,t=`Your card has insufficient funds. Please use a different payment\r
              method.`;return{c(){e=_("p"),e.textContent=t,this.h()},l(s){e=v(s,"P",{class:!0,"data-svelte-h":!0}),B(e)!=="svelte-586isf"&&(e.textContent=t),this.h()},h(){g(e,"class","rounded-lg bg-base-200 p-4")},m(s,l){P(s,e,l)},d(s){s&&d(e)}}}function ns(a){let e,t=`Your card was declined. Please update your payment method and try\r
              again.`;return{c(){e=_("p"),e.textContent=t,this.h()},l(s){e=v(s,"P",{class:!0,"data-svelte-h":!0}),B(e)!=="svelte-khude"&&(e.textContent=t),this.h()},h(){g(e,"class","rounded-lg bg-base-200 p-4")},m(s,l){P(s,e,l)},d(s){s&&d(e)}}}function Tt(a){let e,t="A discount has been applied to your subscription.";return{c(){e=_("p"),e.textContent=t,this.h()},l(s){e=v(s,"P",{class:!0,"data-svelte-h":!0}),B(e)!=="svelte-1y1cojs"&&(e.textContent=t),this.h()},h(){g(e,"class","rounded-lg bg-info/20 p-4")},m(s,l){P(s,e,l)},d(s){s&&d(e)}}}function Mt(a){let e,t,s,l;return{c(){e=_("button"),t=k("Confirm Update"),this.h()},l(o){e=v(o,"BUTTON",{type:!0,class:!0});var r=E(e);t=C(r,"Confirm Update"),r.forEach(d),this.h()},h(){g(e,"type","button"),g(e,"class","btn btn-primary"),e.disabled=a[3]},m(o,r){P(o,e,r),n(e,t),s||(l=pe(e,"click",a[12]),s=!0)},p(o,r){r&8&&(e.disabled=o[3])},d(o){o&&d(e),s=!1,l()}}}function as(a){let e,t,s="Manage Seats",l,o,r,u,i,f,m,p,h,c,b=a[0]===1?"seat":"seats",y,S,w,N,D,V,M,A,j,T,H,ee,F;function le(L,O){return L[8]?Qt:L[7]?Jt:zt}let K=le(a),z=K(a),q=a[2]&&Nt(a);return{c(){e=_("div"),t=_("h2"),t.textContent=s,l=x(),o=_("div"),r=_("button"),u=k("-"),m=x(),p=_("span"),h=k(a[0]),c=x(),y=k(b),S=x(),w=_("button"),N=k("+"),V=x(),M=_("button"),z.c(),T=x(),q&&q.c(),H=se(),this.h()},l(L){e=v(L,"DIV",{class:!0});var O=E(e);t=v(O,"H2",{class:!0,"data-svelte-h":!0}),B(t)!=="svelte-lkbcb"&&(t.textContent=s),l=I(O),o=v(O,"DIV",{class:!0});var te=E(o);r=v(te,"BUTTON",{class:!0});var be=E(r);u=C(be,"-"),be.forEach(d),m=I(te),p=v(te,"SPAN",{class:!0});var J=E(p);h=C(J,a[0]),c=I(J),y=C(J,b),J.forEach(d),S=I(te),w=v(te,"BUTTON",{class:!0});var re=E(w);N=C(re,"+"),re.forEach(d),te.forEach(d),V=I(O),M=v(O,"BUTTON",{class:!0});var ne=E(M);z.l(ne),ne.forEach(d),O.forEach(d),T=I(L),q&&q.l(L),H=se(),this.h()},h(){g(t,"class","mb-4 text-xl font-bold"),g(r,"class",i="btn btn-outline btn-sm "+(a[8]?"text-red-500":"")),r.disabled=f=a[0]===1,g(p,"class","mx-4 text-lg font-bold text-black"),g(w,"class",D="btn btn-outline btn-sm "+(a[7]?"hover:from-secondary-focus hover:to-accent-focus bg-gradient-to-r from-secondary to-accent text-secondary-content":"")),g(o,"class","mb-4 flex items-center justify-center"),g(M,"class",A="btn w-full "+(a[1]===0?"btn-disabled":a[8]?"btn-outline btn-warning":"hover:from-secondary-focus hover:to-accent-focus bg-gradient-to-r from-secondary to-accent text-secondary-content")),M.disabled=j=a[1]===0,g(e,"class","card mt-8 max-w-xl p-6 shadow")},m(L,O){P(L,e,O),n(e,t),n(e,l),n(e,o),n(o,r),n(r,u),n(o,m),n(o,p),n(p,h),n(p,c),n(p,y),n(o,S),n(o,w),n(w,N),n(e,V),n(e,M),z.m(M,null),P(L,T,O),q&&q.m(L,O),P(L,H,O),ee||(F=[pe(r,"click",a[10]),pe(w,"click",a[9]),pe(M,"click",a[11])],ee=!0)},p(L,[O]){O&256&&i!==(i="btn btn-outline btn-sm "+(L[8]?"text-red-500":""))&&g(r,"class",i),O&1&&f!==(f=L[0]===1)&&(r.disabled=f),O&1&&U(h,L[0]),O&1&&b!==(b=L[0]===1?"seat":"seats")&&U(y,b),O&128&&D!==(D="btn btn-outline btn-sm "+(L[7]?"hover:from-secondary-focus hover:to-accent-focus bg-gradient-to-r from-secondary to-accent text-secondary-content":""))&&g(w,"class",D),K===(K=le(L))&&z?z.p(L,O):(z.d(1),z=K(L),z&&(z.c(),z.m(M,null))),O&258&&A!==(A="btn w-full "+(L[1]===0?"btn-disabled":L[8]?"btn-outline btn-warning":"hover:from-secondary-focus hover:to-accent-focus bg-gradient-to-r from-secondary to-accent text-secondary-content"))&&g(M,"class",A),O&2&&j!==(j=L[1]===0)&&(M.disabled=j),L[2]?q?q.p(L,O):(q=Nt(L),q.c(),q.m(H.parentNode,H)):q&&(q.d(1),q=null)},i:X,o:X,d(L){L&&(d(e),d(T),d(H)),z.d(),q&&q.d(L),ee=!1,jt(F)}}}function os(a,e){try{const t=a.lines.data,s=t[0].quantity,l=t[1].quantity,o=new Date(t[0].period.end*1e3),r=Math.ceil((t[0].period.end-t[0].period.start)/(24*60*60)),u=t[2].amount/100,i=e?(t[0].amount+t[1].amount)/100:0,f=t[0].price.recurring.interval;console.log("IsIncreasing?",e);const m=e?o:new Date,p=t[0].currency,h=u/l,c=f==="year"?h/12:h,b=s*c,y=l*c,S=y-b;return{currentSeats:s,newSeats:l,billingCycle:f==="year"?"annual":"monthly",currency:p,changeAppliedDate:e?"immediately":"on next billing date",immediateCharge:i,futureCost:u,anchorDate:o.toISOString().split("T")[0],daysUntilAnchor:r,isIncreasing:e,nextPaymentDate:m.toISOString().split("T")[0],lineItems:t.map(w=>({description:w.description,amount:w.amount/100,proration:w.proration})),oldMonthly:b,newMonthly:y,monthlyDifference:S,monthlyCost:c}}catch(t){return console.error("Error extracting important info:",t),null}}function rs(a,e,t){let s,l,o,r;Lt(a,gt,T=>t(16,r=T));let{data:u}=e,{subscriptionData:i,seatManagementInfo:f}=u,m=i.stripeSubscription.quantity||1,p=m,h=!1,c=!1,b=null,y=null,S=null,w=null;function N(){t(0,p+=1)}function D(){p>1&&t(0,p-=1)}function V(){t(2,h=!0),t(3,c=!0),b=null,t(4,y=null),t(6,w=null),M()}async function M(){try{console.log("Fetching seat proration preview..."),console.log("Current auth token:",r.access_token?"Available":"Not available");const T=await fetch("/api/subscription/previews/prorated-seats",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r.access_token}`},body:JSON.stringify({quantity:p,appliedDate:l?"now":"later"})});if(console.log("Response status:",T.status),!T.ok){const ee=await T.json();throw console.error("Preview error response:",ee),t(6,w=ee.error||"Failed to fetch preview"),new Error(w)}const H=await T.json();if(console.log("Proration Preview result:",H),H.type==="success"){const F=JSON.parse(H.data)[2];console.log("Parsed Proration Preview:",F),b=F,t(4,y=os(F,l)),console.log("Important Information:",y)}else throw t(6,w=H.error||"Failed to calculate preview"),new Error(w)}catch(T){console.error("Error fetching proration preview:",T),Ae.error("Failed to load seat pricing preview"),t(6,w=T.message||"An unexpected error occurred")}finally{t(3,c=!1)}}async function A(){try{t(3,c=!0),console.log("Updating seats...");const T=await fetch("/api/subscription/actions/update-seats",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r.access_token}`},body:JSON.stringify({quantity:y.newSeats,appliedDate:y.isIncreasing?"now":"later"})});if(console.log("Update response status:",T.status),!T.ok){const H=await T.json();throw console.error("Update error response:",H),new Error(H.error||"Failed to update seats")}if(t(5,S=await T.json()),console.log("Update result:",S),S.success)Ae.success("Subscription updated successfully");else throw new Error(S.error||"Update failed")}catch(T){console.error("Error updating seats:",T),Ae.error("Failed to update subscription"),t(5,S={success:!1,error:T.message})}finally{t(3,c=!1)}}const j=()=>{S&&S.success?window.location.reload():(t(2,h=!1),t(5,S=null))};return a.$$set=T=>{"data"in T&&t(13,u=T.data)},a.$$.update=()=>{a.$$.dirty&1&&t(1,s=p-m),a.$$.dirty&2&&t(7,l=s>0),a.$$.dirty&2&&t(8,o=s<0)},[p,s,h,c,y,S,w,l,o,N,D,V,A,u,j]}class is extends Ct{constructor(e){super(),kt(this,e,rs,as,yt,{data:13})}}function Vt(a){let e,t,s,l=a[4]?"Reverse Subscription Cancellation":"Cancel Subscription",o,r,u,i,f,m,p=a[3]&&a[3].success?"Refresh Page":"Close",h,c,b;function y(D,V){return D[2]?ds:D[3]?us:cs}let S=y(a),w=S(a),N=!a[3]&&!a[2]&&At(a);return{c(){e=_("div"),t=_("div"),s=_("h3"),o=k(l),r=x(),w.c(),u=x(),i=_("div"),N&&N.c(),f=x(),m=_("button"),h=k(p),this.h()},l(D){e=v(D,"DIV",{class:!0});var V=E(e);t=v(V,"DIV",{class:!0});var M=E(t);s=v(M,"H3",{class:!0});var A=E(s);o=C(A,l),A.forEach(d),r=I(M),w.l(M),u=I(M),i=v(M,"DIV",{class:!0});var j=E(i);N&&N.l(j),f=I(j),m=v(j,"BUTTON",{class:!0});var T=E(m);h=C(T,p),T.forEach(d),j.forEach(d),M.forEach(d),V.forEach(d),this.h()},h(){g(s,"class","mb-6 text-2xl font-bold"),g(m,"class","btn btn-outline"),m.disabled=a[2],g(i,"class","modal-action mt-6"),g(t,"class","modal-box max-w-2xl"),g(e,"class","modal modal-open")},m(D,V){P(D,e,V),n(e,t),n(t,s),n(s,o),n(t,r),w.m(t,null),n(t,u),n(t,i),N&&N.m(i,null),n(i,f),n(i,m),n(m,h),c||(b=pe(m,"click",a[8]),c=!0)},p(D,V){V&16&&l!==(l=D[4]?"Reverse Subscription Cancellation":"Cancel Subscription")&&U(o,l),S===(S=y(D))&&w?w.p(D,V):(w.d(1),w=S(D),w&&(w.c(),w.m(t,u))),!D[3]&&!D[2]?N?N.p(D,V):(N=At(D),N.c(),N.m(i,f)):N&&(N.d(1),N=null),V&8&&p!==(p=D[3]&&D[3].success?"Refresh Page":"Close")&&U(h,p),V&4&&(m.disabled=D[2])},d(D){D&&d(e),w.d(),N&&N.d(),c=!1,b()}}}function cs(a){let e,t,s,l="Current Subscription Details:",o,r,u,i,f="Plan",m,p,h=a[0].appSubscription.name+"",c,b,y,S,w="Billing Cycle",N,D,V=a[0].stripeSubscription.plan.interval+"",M,A,j,T,H,ee="Number of Seats",F,le,K=a[0].stripeSubscription.quantity+"",z,q,L,O,te="Current Period End",be,J,re=new Date(a[0].stripeSubscription.current_period_end*1e3).toLocaleDateString()+"",ne,ke,ae,ie,he=a[4]?"Reversal Information:":"Cancellation Information:",we,ce;function je(Q,G){return Q[4]?ps:fs}let ve=je(a),Z=ve(a);return{c(){e=_("div"),t=_("div"),s=_("h4"),s.textContent=l,o=x(),r=_("div"),u=_("div"),i=_("p"),i.textContent=f,m=x(),p=_("p"),c=k(h),b=x(),y=_("div"),S=_("p"),S.textContent=w,N=x(),D=_("p"),M=k(V),A=k("ly"),j=x(),T=_("div"),H=_("p"),H.textContent=ee,F=x(),le=_("p"),z=k(K),q=x(),L=_("div"),O=_("p"),O.textContent=te,be=x(),J=_("p"),ne=k(re),ke=x(),ae=_("div"),ie=_("h4"),we=k(he),ce=x(),Z.c(),this.h()},l(Q){e=v(Q,"DIV",{class:!0});var G=E(e);t=v(G,"DIV",{class:!0});var W=E(t);s=v(W,"H4",{class:!0,"data-svelte-h":!0}),B(s)!=="svelte-widots"&&(s.textContent=l),o=I(W),r=v(W,"DIV",{class:!0});var $=E(r);u=v($,"DIV",{class:!0});var xe=E(u);i=v(xe,"P",{class:!0,"data-svelte-h":!0}),B(i)!=="svelte-1xf3t3m"&&(i.textContent=f),m=I(xe),p=v(xe,"P",{class:!0});var Le=E(p);c=C(Le,h),Le.forEach(d),xe.forEach(d),b=I($),y=v($,"DIV",{class:!0});var oe=E(y);S=v(oe,"P",{class:!0,"data-svelte-h":!0}),B(S)!=="svelte-1pfbt8a"&&(S.textContent=w),N=I(oe),D=v(oe,"P",{class:!0});var _e=E(D);M=C(_e,V),A=C(_e,"ly"),_e.forEach(d),oe.forEach(d),j=I($),T=v($,"DIV",{class:!0});var Ne=E(T);H=v(Ne,"P",{class:!0,"data-svelte-h":!0}),B(H)!=="svelte-q9tnhj"&&(H.textContent=ee),F=I(Ne),le=v(Ne,"P",{class:!0});var Ue=E(le);z=C(Ue,K),Ue.forEach(d),Ne.forEach(d),q=I($),L=v($,"DIV",{class:!0});var ue=E(L);O=v(ue,"P",{class:!0,"data-svelte-h":!0}),B(O)!=="svelte-x9kj1m"&&(O.textContent=te),be=I(ue),J=v(ue,"P",{class:!0});var me=E(J);ne=C(me,re),me.forEach(d),ue.forEach(d),$.forEach(d),W.forEach(d),ke=I(G),ae=v(G,"DIV",{class:!0});var Se=E(ae);ie=v(Se,"H4",{class:!0});var De=E(ie);we=C(De,he),De.forEach(d),ce=I(Se),Z.l(Se),Se.forEach(d),G.forEach(d),this.h()},h(){g(s,"class","mb-3 text-lg font-semibold"),g(i,"class","text-sm"),g(p,"class","text-lg font-bold"),g(u,"class","rounded bg-base-100 p-3"),g(S,"class","text-sm"),g(D,"class","text-lg font-bold"),g(y,"class","rounded bg-base-100 p-3"),g(H,"class","text-sm"),g(le,"class","text-lg font-bold"),g(T,"class","rounded bg-base-100 p-3"),g(O,"class","text-sm"),g(J,"class","text-lg font-bold"),g(L,"class","rounded bg-base-100 p-3"),g(r,"class","grid grid-cols-2 gap-4"),g(t,"class","rounded-lg bg-base-200 p-6"),g(ie,"class","mb-3 text-lg font-semibold"),g(ae,"class","rounded-lg bg-base-200 p-6"),g(e,"class","space-y-6")},m(Q,G){P(Q,e,G),n(e,t),n(t,s),n(t,o),n(t,r),n(r,u),n(u,i),n(u,m),n(u,p),n(p,c),n(r,b),n(r,y),n(y,S),n(y,N),n(y,D),n(D,M),n(D,A),n(r,j),n(r,T),n(T,H),n(T,F),n(T,le),n(le,z),n(r,q),n(r,L),n(L,O),n(L,be),n(L,J),n(J,ne),n(e,ke),n(e,ae),n(ae,ie),n(ie,we),n(ae,ce),Z.m(ae,null)},p(Q,G){G&1&&h!==(h=Q[0].appSubscription.name+"")&&U(c,h),G&1&&V!==(V=Q[0].stripeSubscription.plan.interval+"")&&U(M,V),G&1&&K!==(K=Q[0].stripeSubscription.quantity+"")&&U(z,K),G&1&&re!==(re=new Date(Q[0].stripeSubscription.current_period_end*1e3).toLocaleDateString()+"")&&U(ne,re),G&16&&he!==(he=Q[4]?"Reversal Information:":"Cancellation Information:")&&U(we,he),ve===(ve=je(Q))&&Z?Z.p(Q,G):(Z.d(1),Z=ve(Q),Z&&(Z.c(),Z.m(ae,null)))},d(Q){Q&&d(e),Z.d()}}}function us(a){let e,t=a[3].message+"",s,l,o;function r(f,m){return f[3].success?hs:bs}let u=r(a),i=u(a);return{c(){e=_("p"),s=k(t),l=x(),i.c(),o=se(),this.h()},l(f){e=v(f,"P",{class:!0});var m=E(e);s=C(m,t),m.forEach(d),l=I(f),i.l(f),o=se(),this.h()},h(){g(e,"class","mb-4 rounded-lg bg-base-200 p-4")},m(f,m){P(f,e,m),n(e,s),P(f,l,m),i.m(f,m),P(f,o,m)},p(f,m){m&8&&t!==(t=f[3].message+"")&&U(s,t),u===(u=r(f))&&i?i.p(f,m):(i.d(1),i=u(f),i&&(i.c(),i.m(o.parentNode,o)))},d(f){f&&(d(e),d(l),d(o)),i.d(f)}}}function ds(a){let e,t='<div class="rounded-lg bg-base-200 p-6"><div class="skeleton mb-3 h-6 w-60"></div> <div class="grid grid-cols-2 gap-4"><div class="rounded bg-base-100 p-3"><div class="skeleton mb-1 h-3 w-12"></div> <div class="skeleton h-5 w-24"></div></div> <div class="rounded bg-base-100 p-3"><div class="skeleton mb-1 h-3 w-16"></div> <div class="skeleton h-5 w-20"></div></div> <div class="rounded bg-base-100 p-3"><div class="skeleton mb-1 h-3 w-20"></div> <div class="skeleton h-5 w-8"></div></div> <div class="rounded bg-base-100 p-3"><div class="skeleton mb-1 h-3 w-24"></div> <div class="skeleton h-5 w-24"></div></div></div></div> <div class="rounded-lg bg-base-200 p-6"><div class="skeleton mb-3 h-6 w-48"></div> <div class="skeleton mb-4 h-4 w-full"></div> <div class="space-y-3"><div class="flex items-start"><div class="skeleton mr-2 mt-1.5 h-2.5 w-2.5 rounded-full"></div> <div class="skeleton h-4 w-full"></div></div> <div class="flex items-start"><div class="skeleton mr-2 mt-1.5 h-2.5 w-2.5 rounded-full"></div> <div class="skeleton h-4 w-full"></div></div> <div class="flex items-start"><div class="skeleton mr-2 mt-1.5 h-2.5 w-2.5 rounded-full"></div> <div class="skeleton h-4 w-full"></div></div> <div class="flex items-start"><div class="skeleton mr-2 mt-1.5 h-2.5 w-2.5 rounded-full"></div> <div class="skeleton h-4 w-full"></div></div></div></div>';return{c(){e=_("div"),e.innerHTML=t,this.h()},l(s){e=v(s,"DIV",{class:!0,"data-svelte-h":!0}),B(e)!=="svelte-gm7qha"&&(e.innerHTML=t),this.h()},h(){g(e,"class","space-y-6")},m(s,l){P(s,e,l)},p:X,d(s){s&&d(e)}}}function fs(a){let e,t="If you proceed with cancellation:",s,l,o,r,u,i=new Date(a[0].stripeSubscription.current_period_end*1e3).toLocaleDateString()+"",f,m,p,h,c,b=`You'll continue to have access to your current number of seats\r
                  and features during this period.`,y,S,w=`After the end date, your account will be moved to the free\r
                  tier plan.`,N,D,V="No further charges will be incurred after cancellation.";return{c(){e=_("p"),e.textContent=t,s=x(),l=_("ul"),o=_("li"),r=k(`Your current subscription will remain active until\r
                  `),u=_("span"),f=k(i),m=x(),p=k("."),h=x(),c=_("li"),c.textContent=b,y=x(),S=_("li"),S.textContent=w,N=x(),D=_("li"),D.textContent=V,this.h()},l(M){e=v(M,"P",{class:!0,"data-svelte-h":!0}),B(e)!=="svelte-mduid0"&&(e.textContent=t),s=I(M),l=v(M,"UL",{class:!0});var A=E(l);o=v(A,"LI",{});var j=E(o);r=C(j,`Your current subscription will remain active until\r
                  `),u=v(j,"SPAN",{class:!0});var T=E(u);f=C(T,i),m=I(T),T.forEach(d),p=C(j,"."),j.forEach(d),h=I(A),c=v(A,"LI",{"data-svelte-h":!0}),B(c)!=="svelte-9ejv9b"&&(c.textContent=b),y=I(A),S=v(A,"LI",{"data-svelte-h":!0}),B(S)!=="svelte-19brn99"&&(S.textContent=w),N=I(A),D=v(A,"LI",{"data-svelte-h":!0}),B(D)!=="svelte-irm8fa"&&(D.textContent=V),A.forEach(d),this.h()},h(){g(e,"class","mb-4"),g(u,"class","font-bold"),g(l,"class","list-disc space-y-2 pl-6")},m(M,A){P(M,e,A),P(M,s,A),P(M,l,A),n(l,o),n(o,r),n(o,u),n(u,f),n(u,m),n(o,p),n(l,h),n(l,c),n(l,y),n(l,S),n(l,N),n(l,D)},p(M,A){A&1&&i!==(i=new Date(M[0].stripeSubscription.current_period_end*1e3).toLocaleDateString()+"")&&U(f,i)},d(M){M&&(d(e),d(s),d(l))}}}function ps(a){let e,t="If you reverse the cancellation:",s,l,o,r="Your subscription will continue without interruption.",u,i,f="You'll retain access to all current features and seats.",m,p,h,c=new Date(a[0].stripeSubscription.current_period_end*1e3).toLocaleDateString()+"",b,y,S,w,N="Regular billing will resume on this date.";return{c(){e=_("p"),e.textContent=t,s=x(),l=_("ul"),o=_("li"),o.textContent=r,u=x(),i=_("li"),i.textContent=f,m=x(),p=_("li"),h=k("Your next billing date will remain "),b=k(c),y=k("."),S=x(),w=_("li"),w.textContent=N,this.h()},l(D){e=v(D,"P",{class:!0,"data-svelte-h":!0}),B(e)!=="svelte-g9ocx1"&&(e.textContent=t),s=I(D),l=v(D,"UL",{class:!0});var V=E(l);o=v(V,"LI",{"data-svelte-h":!0}),B(o)!=="svelte-4ixbcs"&&(o.textContent=r),u=I(V),i=v(V,"LI",{"data-svelte-h":!0}),B(i)!=="svelte-ihxa6k"&&(i.textContent=f),m=I(V),p=v(V,"LI",{});var M=E(p);h=C(M,"Your next billing date will remain "),b=C(M,c),y=C(M,"."),M.forEach(d),S=I(V),w=v(V,"LI",{"data-svelte-h":!0}),B(w)!=="svelte-k0gamx"&&(w.textContent=N),V.forEach(d),this.h()},h(){g(e,"class","mb-4"),g(l,"class","list-disc space-y-2 pl-6")},m(D,V){P(D,e,V),P(D,s,V),P(D,l,V),n(l,o),n(l,u),n(l,i),n(l,m),n(l,p),n(p,h),n(p,b),n(p,y),n(l,S),n(l,w)},p(D,V){V&1&&c!==(c=new Date(D[0].stripeSubscription.current_period_end*1e3).toLocaleDateString()+"")&&U(b,c)},d(D){D&&(d(e),d(s),d(l))}}}function bs(a){let e,t=`<p>There was a problem with your request. Please try again or contact
              support.</p>`;return{c(){e=_("div"),e.innerHTML=t,this.h()},l(s){e=v(s,"DIV",{class:!0,"data-svelte-h":!0}),B(e)!=="svelte-8uajfm"&&(e.innerHTML=t),this.h()},h(){g(e,"class","mt-4 rounded-lg bg-error/10 p-4")},m(s,l){P(s,e,l)},p:X,d(s){s&&d(e)}}}function hs(a){let e;function t(o,r){return o[4]?_s:vs}let s=t(a),l=s(a);return{c(){e=_("div"),l.c(),this.h()},l(o){e=v(o,"DIV",{class:!0});var r=E(e);l.l(r),r.forEach(d),this.h()},h(){g(e,"class","mt-4 rounded-lg bg-success/10 p-4")},m(o,r){P(o,e,r),l.m(e,null)},p(o,r){s!==(s=t(o))&&(l.d(1),l=s(o),l&&(l.c(),l.m(e,null)))},d(o){o&&d(e),l.d()}}}function vs(a){let e,t=`Your subscription will remain active until the end of your\r
                current billing period.`;return{c(){e=_("p"),e.textContent=t},l(s){e=v(s,"P",{"data-svelte-h":!0}),B(e)!=="svelte-13o1l1h"&&(e.textContent=t)},m(s,l){P(s,e,l)},d(s){s&&d(e)}}}function _s(a){let e,t="Your subscription will continue without interruption.";return{c(){e=_("p"),e.textContent=t},l(s){e=v(s,"P",{"data-svelte-h":!0}),B(e)!=="svelte-1qny0ue"&&(e.textContent=t)},m(s,l){P(s,e,l)},d(s){s&&d(e)}}}function At(a){let e,t=a[4]?"Confirm Reversal":"Confirm Cancellation",s,l,o;return{c(){e=_("button"),s=k(t),this.h()},l(r){e=v(r,"BUTTON",{type:!0,class:!0});var u=E(e);s=C(u,t),u.forEach(d),this.h()},h(){g(e,"type","button"),g(e,"class","btn"),e.disabled=a[2],ge(e,"btn-error",!a[4]),ge(e,"btn-success",a[4])},m(r,u){P(r,e,u),n(e,s),l||(o=pe(e,"click",a[7]),l=!0)},p(r,u){u&16&&t!==(t=r[4]?"Confirm Reversal":"Confirm Cancellation")&&U(s,t),u&4&&(e.disabled=r[2]),u&16&&ge(e,"btn-error",!r[4]),u&16&&ge(e,"btn-success",r[4])},d(r){r&&d(e),l=!1,o()}}}function ms(a){let e,t,s=a[4]?"Subscription Cancellation":"Cancel Subscription",l,o,r,u=a[4]?"Reverse Cancellation":"Cancel Subscription",i,f,m,p,h,c=a[1]&&Vt(a);return{c(){e=_("div"),t=_("h2"),l=k(s),o=x(),r=_("button"),i=k(u),f=x(),c&&c.c(),m=se(),this.h()},l(b){e=v(b,"DIV",{class:!0});var y=E(e);t=v(y,"H2",{class:!0});var S=E(t);l=C(S,s),S.forEach(d),o=I(y),r=v(y,"BUTTON",{class:!0});var w=E(r);i=C(w,u),w.forEach(d),y.forEach(d),f=I(b),c&&c.l(b),m=se(),this.h()},h(){g(t,"class","mb-4 text-xl font-bold"),g(r,"class","btn w-full"),ge(r,"btn-error",!a[4]),ge(r,"btn-success",a[4]),g(e,"class","card mt-8 max-w-xl p-6 shadow")},m(b,y){P(b,e,y),n(e,t),n(t,l),n(e,o),n(e,r),n(r,i),P(b,f,y),c&&c.m(b,y),P(b,m,y),p||(h=pe(r,"click",a[5]),p=!0)},p(b,[y]){y&16&&s!==(s=b[4]?"Subscription Cancellation":"Cancel Subscription")&&U(l,s),y&16&&u!==(u=b[4]?"Reverse Cancellation":"Cancel Subscription")&&U(i,u),y&16&&ge(r,"btn-error",!b[4]),y&16&&ge(r,"btn-success",b[4]),b[1]?c?c.p(b,y):(c=Vt(b),c.c(),c.m(m.parentNode,m)):c&&(c.d(1),c=null)},i:X,o:X,d(b){b&&(d(e),d(f),d(m)),c&&c.d(b),p=!1,h()}}}function gs(a,e,t){let s,l;Lt(a,gt,c=>t(9,l=c));let{subscriptionData:o}=e,r=!1,u=!1,i=null;function f(){t(1,r=!0),t(2,u=!0),t(3,i=null),console.log("Subscription Data:",o),s?setTimeout(()=>{m(!0)},100):setTimeout(()=>{t(2,u=!1)},300)}async function m(c=!1){try{t(2,u=!0),console.log("Starting cancel action, isReversal=",c);const b=c?"/api/subscription/actions/reverse-cancel":"/api/subscription/actions/cancel";console.log("Using endpoint:",b),console.log("Authorization token available:",!!l.access_token);const y=await fetch(b,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l.access_token}`},body:JSON.stringify({})});console.log("Response status:",y.status);const S=y.headers.get("content-type");if(S&&S.includes("application/json")){const w=await y.json();if(console.log("Response data:",w),!y.ok)throw new Error(w.error||w.message||"Request failed");t(3,i=w)}else throw console.error("Empty or non-JSON response"),new Error("Invalid response from server");if(i.success)Ae.success(c?"Cancellation reversed successfully":"Subscription cancelled successfully");else throw new Error(i.message||"Action failed")}catch(b){console.error("Error processing cancel action:",b),Ae.error(c?"Failed to reverse cancellation":"Failed to cancel subscription"),t(3,i={success:!1,message:b.message})}finally{t(2,u=!1)}}const p=()=>m(s),h=()=>{i&&i.success?window.location.reload():(t(1,r=!1),t(3,i=null))};return a.$$set=c=>{"subscriptionData"in c&&t(0,o=c.subscriptionData)},a.$$.update=()=>{a.$$.dirty&1&&t(4,s=o.stripeSubscription.cancel_at_period_end)},[o,r,u,i,s,f,m,p,h]}class ys extends Ct{constructor(e){super(),kt(this,e,gs,ms,yt,{subscriptionData:0})}}function Cs(a){let e,t,s,l="No subscription data available",o,r,u="Return to Billing",i,f;return{c(){e=_("div"),t=_("div"),s=_("p"),s.textContent=l,o=x(),r=_("button"),r.textContent=u,this.h()},l(m){e=v(m,"DIV",{class:!0});var p=E(e);t=v(p,"DIV",{class:!0});var h=E(t);s=v(h,"P",{class:!0,"data-svelte-h":!0}),B(s)!=="svelte-73103j"&&(s.textContent=l),o=I(h),r=v(h,"BUTTON",{class:!0,"data-svelte-h":!0}),B(r)!=="svelte-oktbn0"&&(r.textContent=u),h.forEach(d),p.forEach(d),this.h()},h(){g(s,"class","mb-4 text-lg"),g(r,"class","rounded bg-primary px-4 py-2 text-white"),g(t,"class","text-center"),g(e,"class","flex h-48 items-center justify-center")},m(m,p){P(m,e,p),n(e,t),n(t,s),n(t,o),n(t,r),i||(f=pe(r,"click",a[8]),i=!0)},p:X,i:X,o:X,d(m){m&&d(e),i=!1,f()}}}function ks(a){let e,t="Manage Billing",s,l,o=`<div><h3 class="font-bold">Pricing Section is new, Contact us to handle it directly</h3> <div class="text-sm">If their are any issues or the pricing details seems wrong, please
        contact us at 0439405248, or send a message in the chat. We&#39;ll be happy
        to assist you.</div></div>`,r,u,i,f,m,p,h;return u=new Yt({props:{title:"Current Subscription",editable:!1,fields:[{id:"planName",label:"Current Plan",initialValue:a[1].appSubscription.name},{id:"planStatus",label:"Status",initialValue:a[1].stripeSubscription.status},{id:"quantity",label:"Quantity",initialValue:a[1]?.stripeSubscription?.quantity?.toString()??"1"},{id:"interval",label:"Billing Interval",initialValue:a[2]?"Yearly":"Monthly"},{id:"nextBilling",label:"Next Billing Date",initialValue:new Date(a[1].stripeSubscription.current_period_end*1e3).toLocaleDateString()}],editButtonTitle:"Home",editLink:"/account"}}),f=new is({props:{data:a[0]}}),p=new ys({props:{subscriptionData:a[1]}}),{c(){e=_("h1"),e.textContent=t,s=x(),l=_("div"),l.innerHTML=o,r=x(),mt(u.$$.fragment),i=x(),mt(f.$$.fragment),m=x(),mt(p.$$.fragment),this.h()},l(c){e=v(c,"H1",{class:!0,"data-svelte-h":!0}),B(e)!=="svelte-2pdsts"&&(e.textContent=t),s=I(c),l=v(c,"DIV",{class:!0,"data-svelte-h":!0}),B(l)!=="svelte-id6dm2"&&(l.innerHTML=o),r=I(c),_t(u.$$.fragment,c),i=I(c),_t(f.$$.fragment,c),m=I(c),_t(p.$$.fragment,c),this.h()},h(){g(e,"class","mb-6 text-2xl font-bold"),g(l,"class","alert alert-info mb-4 mt-2 w-4/5")},m(c,b){P(c,e,b),P(c,s,b),P(c,l,b),P(c,r,b),vt(u,c,b),P(c,i,b),vt(f,c,b),P(c,m,b),vt(p,c,b),h=!0},p(c,b){const y={};b&6&&(y.fields=[{id:"planName",label:"Current Plan",initialValue:c[1].appSubscription.name},{id:"planStatus",label:"Status",initialValue:c[1].stripeSubscription.status},{id:"quantity",label:"Quantity",initialValue:c[1]?.stripeSubscription?.quantity?.toString()??"1"},{id:"interval",label:"Billing Interval",initialValue:c[2]?"Yearly":"Monthly"},{id:"nextBilling",label:"Next Billing Date",initialValue:new Date(c[1].stripeSubscription.current_period_end*1e3).toLocaleDateString()}]),u.$set(y);const S={};b&1&&(S.data=c[0]),f.$set(S);const w={};b&2&&(w.subscriptionData=c[1]),p.$set(w)},i(c){h||(Qe(u.$$.fragment,c),Qe(f.$$.fragment,c),Qe(p.$$.fragment,c),h=!0)},o(c){Je(u.$$.fragment,c),Je(f.$$.fragment,c),Je(p.$$.fragment,c),h=!1},d(c){c&&(d(e),d(s),d(l),d(r),d(i),d(m)),ht(u,c),ht(f,c),ht(p,c)}}}function ws(a){let e,t,s="Error Loading Billing Information",l,o,r,u,i,f,m="Try Again",p,h,c="Return to Billing",b,y;return{c(){e=_("div"),t=_("h2"),t.textContent=s,l=x(),o=_("p"),r=k(a[4]),u=x(),i=_("div"),f=_("button"),f.textContent=m,p=x(),h=_("button"),h.textContent=c,this.h()},l(S){e=v(S,"DIV",{class:!0});var w=E(e);t=v(w,"H2",{class:!0,"data-svelte-h":!0}),B(t)!=="svelte-ho2c7i"&&(t.textContent=s),l=I(w),o=v(w,"P",{class:!0});var N=E(o);r=C(N,a[4]),N.forEach(d),u=I(w),i=v(w,"DIV",{class:!0});var D=E(i);f=v(D,"BUTTON",{class:!0,"data-svelte-h":!0}),B(f)!=="svelte-18f68qk"&&(f.textContent=m),p=I(D),h=v(D,"BUTTON",{class:!0,"data-svelte-h":!0}),B(h)!=="svelte-1u8qu2s"&&(h.textContent=c),D.forEach(d),w.forEach(d),this.h()},h(){g(t,"class","mb-4 text-xl font-bold text-red-700"),g(o,"class","text-red-600"),g(f,"class","rounded bg-primary px-4 py-2 text-white"),g(h,"class","rounded bg-secondary px-4 py-2 text-white"),g(i,"class","mt-4 flex justify-center gap-4"),g(e,"class","mx-auto my-8 max-w-xl rounded-lg bg-red-50 p-6 text-center")},m(S,w){P(S,e,w),n(e,t),n(e,l),n(e,o),n(o,r),n(e,u),n(e,i),n(i,f),n(i,p),n(i,h),b||(y=[pe(f,"click",a[6]),pe(h,"click",a[7])],b=!0)},p:X,i:X,o:X,d(S){S&&d(e),b=!1,jt(y)}}}function Ss(a){let e,t='<div class="h-12 w-12 animate-spin rounded-full border-4 border-primary border-t-transparent"></div>';return{c(){e=_("div"),e.innerHTML=t,this.h()},l(s){e=v(s,"DIV",{class:!0,"data-svelte-h":!0}),B(e)!=="svelte-ot77dz"&&(e.innerHTML=t),this.h()},h(){g(e,"class","flex h-48 items-center justify-center")},m(s,l){P(s,e,l)},p:X,i:X,o:X,d(s){s&&d(e)}}}function Ds(a){let e,t,s,l,o;const r=[Ss,ws,ks,Cs],u=[];function i(f,m){return f[3]?0:f[4]?1:f[1]?2:3}return t=i(a),s=u[t]=r[t](a),{c(){e=x(),s.c(),l=se(),this.h()},l(f){Bt("svelte-pje245",document.head).forEach(d),e=I(f),s.l(f),l=se(),this.h()},h(){document.title="Manage Billing"},m(f,m){P(f,e,m),u[t].m(f,m),P(f,l,m),o=!0},p(f,[m]){let p=t;t=i(f),t===p?u[t].p(f,m):(Rt(),Je(u[p],1,1,()=>{u[p]=null}),Ht(),s=u[t],s?s.p(f,m):(s=u[t]=r[t](f),s.c()),Qe(s,1),s.m(l.parentNode,l))},i(f){o||(Qe(s),o=!0)},o(f){Je(s),o=!1},d(f){f&&(d(e),d(l)),u[t].d(f)}}}function Es(a,e,t){let s,l,{data:o}=e,r=o.loading,u=o.error,i=null;Ot(()=>{if(u){Ae.error(u),He("/account/billing");return}!r&&o.subscriptionData&&t(1,i=o.subscriptionData)});const f=()=>window.location.reload(),m=()=>He("/account/billing"),p=()=>He("/account/billing");return a.$$set=h=>{"data"in h&&t(0,o=h.data)},a.$$.update=()=>{a.$$.dirty&2&&t(5,s=i?.stripeSubscription?.plan?.interval||"month"),a.$$.dirty&32&&t(2,l=s==="year")},[o,i,l,r,u,s,f,m,p]}class As extends Ct{constructor(e){super(),kt(this,e,Es,Ds,yt,{data:0})}}export{As as component,Vs as universal};
