import{s as w,n as c,d as g,i as b,b as y,c as _,g as v,j as k,l as S,z as j}from"../chunks/scheduler.BVGjjnGO.js";import{S as x,i as T}from"../chunks/index.Vv2yv23T.js";import{g as l}from"../chunks/entry.CJi6DTPP.js";import{s as E}from"../chunks/sessionStore.rIZpZ3yf.js";import{t as u}from"../chunks/Toaster.svelte_svelte_type_style_lang.BcvbULy5.js";const F=!1,C=({params:t})=>({slug:t.slug}),q=Object.freeze(Object.defineProperty({__proto__:null,load:C,prerender:F},Symbol.toStringTag,{value:"Module"})),P=async({session:t})=>{try{if(!t?.access_token)return{error:"No valid session"};const e=await fetch("/api/subscription/free",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t.access_token}`}});if(!e.ok){const s=await e.json();throw new Error(s.message||"Failed to create free subscription")}return{error:null}}catch(e){return console.error("Error in createFreeSubscription:",e),{error:e.message}}},z=async({session:t,priceId:e,seats:s=1,discount:o=!1,discountcode:n=null})=>{try{if(!t?.access_token)return{error:"No valid session",stripeUrl:null};const r=await fetch("/api/subscription/checkout",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t.access_token}`},body:JSON.stringify({priceId:e,seats:s,discount:o,discountcode:n})});if(!r.ok){const i=await r.json();throw new Error(i.message||"Failed to create checkout session")}const{stripeUrl:a}=await r.json();return{error:null,stripeUrl:a}}catch(r){return console.error("Error in createCheckoutSession:",r),{error:r.message,stripeUrl:null}}};function O(t){let e,s='<div class="flex flex-col items-center justify-center"><div class="h-16 w-16 animate-spin rounded-full border-4 border-primary border-t-transparent"></div> <p class="mt-4 text-lg">Processing payment information...</p></div>';return{c(){e=k("div"),e.innerHTML=s,this.h()},l(o){e=_(o,"DIV",{class:!0,"data-svelte-h":!0}),v(e)!=="svelte-1wd3opu"&&(e.innerHTML=s),this.h()},h(){y(e,"class","fixed inset-0 z-50 flex items-center justify-center bg-base-100 bg-opacity-50 backdrop-blur-sm")},m(o,n){b(o,e,n)},p:c,i:c,o:c,d(o){o&&g(e)}}}function U(t,e,s){let o;S(t,E,r=>s(1,o=r));let{data:n}=e;return j(async()=>{try{if(n.error){u.error(n.error),setTimeout(()=>l("/account/payment_plans"),2e3);return}if(!o)throw new Error("Authentication required");const r=new URLSearchParams(window.location.search),a=window.location.pathname.split("/").pop();if(a==="free_plan"){const{error:m}=await P({session:o});if(m)throw new Error(`Failed to activate free plan: ${m}`);u.success("Free plan activated!"),l("/account");return}const i=parseInt(r.get("seats")||"1"),f=r.get("discount")==="true",h=r.get("discountcode"),{error:p,stripeUrl:d}=await z({session:o,priceId:a,seats:i,discount:f,discountcode:h});if(p||!d)throw new Error(p||"Failed to create checkout session");window.location.href=d}catch(r){console.error("Error:",r),u.error(r.message||"An unexpected error occurred"),setTimeout(()=>l("/account/payment_plans"),2e3)}}),t.$$set=r=>{"data"in r&&s(0,n=r.data)},[n]}class B extends x{constructor(e){super(),T(this,e,U,O,w,{data:0})}}export{B as component,q as universal};
