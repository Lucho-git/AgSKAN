import{s as A,n as C,d as l,i as k,a as f,b as h,c as v,e as y,j as _,l as T,D as N,z,q as W,A as B,w as R,f as D,g as G,h as J,k as j,t as K}from"../chunks/Bqk-ehBx.js";import{S as H,i as L,d as Q,t as X,a as Y,m as Z,c as ee,b as te}from"../chunks/BSIXs_Xe.js";import{p as re}from"../chunks/Cakgdm1E.js";import{s as se}from"../chunks/BZNkLwfI.js";import{g as M}from"../chunks/BvwL7t0j.js";import{a as ae}from"../chunks/DsDOFx4q.js";import{p as U}from"../chunks/BRXscziQ.js";function oe(d){let r,t;return{c(){r=_("div"),t=_("div"),this.h()},l(e){r=v(e,"DIV",{class:!0});var s=y(r);t=v(s,"DIV",{id:!0,class:!0}),y(t).forEach(l),s.forEach(l),this.h()},h(){h(t,"id","container_"+$),h(t,"class","min-h-[90vh] overflow-auto"),h(r,"class","mx-auto max-w-2xl overflow-auto rounded-lg bg-green-200 p-4 shadow-md")},m(e,s){k(e,r,s),f(r,t)},p:C,i:C,o:C,d(e){e&&l(r)}}}const $="7d624884-1198-4af8-b49d-4b8b5efcb85c",q="AgSkan SurveyReal";function ne(d,r,t){let e;T(d,re,a=>t(2,e=a));const s=N();let o;return z(async()=>{const a=e.data.session;a&&(o=a.user.id);const p=document.createElement("script");return p.src="https://cdn.jsdelivr.net/npm/@feathery/react@latest/umd/index.js",p.async=!0,p.onload=()=>{Feathery.init($),o&&Feathery.updateUserId(o),Feathery.renderAt(`container_${$}`,{formName:q,initialLoader:{show:!0,loader:`
                  <div class="flex flex-col items-center space-y-4">
                    <div class="border-t-4 border-primary animate-spin rounded-full w-12 h-12 mb-4"></div>
                    <p class="text-lg text-primary-content">Loading form...</p>
                  </div>
                `,initialContainerHeight:"600px",initialContainerWidth:"100%"},onFormComplete:async u=>{const m={};for(const[c,i]of Object.entries(u.fields))c.startsWith("feathery.")||(m[c]=i.value||null);try{const{error:c}=await se.from("user_survey").upsert({user_id:o,response:{answers:m,form_id:$,form_name:q,submitted_at:new Date().toISOString()}},{onConflict:"user_id"});c?console.error("Error storing survey response:",c):(console.log("Survey response stored successfully"),s("complete"),M("/account/payment_plans"))}catch(c){console.error("Error storing survey response:",c)}}})},document.head.appendChild(p),()=>{document.head.removeChild(p)}}),[]}class ie extends H{constructor(r){super(),L(this,r,ne,oe,A,{})}}const ce=()=>({}),ye=Object.freeze(Object.defineProperty({__proto__:null,load:ce},Symbol.toStringTag,{value:"Module"}));function le(d){let r,t,e,s,o,a="User Survey",p,u,m,c,i,x=d[0]?"Processing...":"Skip Survey",S,b,I,F;return m=new ie({}),{c(){r=j(),t=_("div"),e=_("div"),s=_("div"),o=_("h1"),o.textContent=a,p=j(),u=_("div"),te(m.$$.fragment),c=j(),i=_("button"),S=K(x),this.h()},l(n){R("svelte-1tnm1ny",document.head).forEach(l),r=D(n),t=v(n,"DIV",{class:!0});var O=y(t);e=v(O,"DIV",{class:!0});var V=y(e);s=v(V,"DIV",{});var w=y(s);o=v(w,"H1",{class:!0,"data-svelte-h":!0}),G(o)!=="svelte-jwlscb"&&(o.textContent=a),p=D(w),u=v(w,"DIV",{class:!0});var E=y(u);ee(m.$$.fragment,E),c=D(E),i=v(E,"BUTTON",{type:!0,class:!0});var P=y(i);S=J(P,x),P.forEach(l),E.forEach(l),w.forEach(l),V.forEach(l),O.forEach(l),this.h()},h(){document.title="User Survey",h(o,"class","mb-6 text-2xl font-bold"),h(i,"type","button"),h(i,"class","btn btn-secondary mt-4"),i.disabled=d[0],h(u,"class","form-container"),h(e,"class","flex w-full flex-col px-6"),h(t,"class","mb-12 mt-4 flex min-h-[100vh] place-content-center content-center items-center text-center")},m(n,g){k(n,r,g),k(n,t,g),f(t,e),f(e,s),f(s,o),f(s,p),f(s,u),Z(m,u,null),f(u,c),f(u,i),f(i,S),b=!0,I||(F=B(i,"click",d[1]),I=!0)},p(n,[g]){(!b||g&1)&&x!==(x=n[0]?"Processing...":"Skip Survey")&&W(S,x),(!b||g&1)&&(i.disabled=n[0])},i(n){b||(Y(m.$$.fragment,n),b=!0)},o(n){X(m.$$.fragment,n),b=!1},d(n){n&&(l(r),l(t)),Q(m),I=!1,F()}}}function de(d,r,t){let e;T(d,U,a=>t(2,e=a));let s=!1;z(async()=>{try{e!=null&&e.id&&(await ae.from("profiles").update({onboarded:!0,updated_at:new Date().toISOString()}).eq("id",e.id),U.update(a=>({...a,onboarded:!0})))}catch(a){console.error("Error updating onboarded status:",a)}});async function o(){t(0,s=!0);try{await M("/account/payment_plans")}catch(a){console.error("Error navigating:",a)}finally{t(0,s=!1)}}return[s,o]}class be extends H{constructor(r){super(),L(this,r,de,le,A,{})}}export{be as component,ye as universal};
