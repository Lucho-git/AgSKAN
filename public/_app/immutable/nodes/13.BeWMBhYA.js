import{i as Bl,s as _o}from"../chunks/sessionStore.rIZpZ3yf.js";import"../chunks/index.BRIxT3F_.js";import{d as Jt,w as Ve}from"../chunks/index.BnUP_WGm.js";import{c as st,a as kr,u as Et,b as Kt,d as Qe,s as Ut,l as qr,m as xt,r as er,e as Ke,f as $t,g as br,h as at,i as po,o as vr,j as Fl,k as mr,M as bo,n as hn,p as mn}from"../chunks/MapViewer.svelte_svelte_type_style_lang.BRopMiAu.js";import{s as le,r as ee,n as Ee,d as k,R as yr,i as U,a as I,b as D,E as Xe,e as H,F as Ze,v as $e,m as be,u as ve,o as we,p as ke,a0 as Er,y as Gt,x as ne,O as Te,l as re,N as Ne,$ as tt,c as V,j as B,B as Ue,K as vt,A as Se,z as Ge,Q as mt,G as nr,g as Ce,f as J,k as K,I as Ae,ao as vo,a4 as Wr,a5 as Sr,_ as St,h as me,t as ge,D as rn,q as Fe,W as Mt,a1 as Ul,P as wo,L as ko}from"../chunks/scheduler.BVGjjnGO.js";import{S as ie,i as se,d as j,t as E,a as C,m as G,c as Q,b as Y,g as de,e as he,h as $r}from"../chunks/index.Vv2yv23T.js";import{g as Pr}from"../chunks/entry.CJi6DTPP.js";import{t as ce}from"../chunks/Toaster.svelte_svelte_type_style_lang.BcvbULy5.js";import{e as dt}from"../chunks/each.Ddz8tcEt.js";import{v as gn,I as Rl,S as It,R as yo}from"../chunks/v4.BRbdNgSc.js";import"../chunks/index.C--bTAyu.js";import{C as jr}from"../chunks/card.CdvKHEh3.js";import{C as Hl,a as ql,b as Wl}from"../chunks/card-title.eLvyKJBB.js";import{g as De,a as rt}from"../chunks/spread.CgU5AtxT.js";import{n as lr,v as To,w as Oe,m as pt,s as ft,q as At,p as je,a as Ot,b as qt,i as gt,o as jl,c as Gl,d as Or,x as _n,f as Co,h as Nr,k as et}from"../chunks/create.Ce5Y8ngh.js";import{t as Gr,o as Eo,r as Yl,g as Xl}from"../chunks/updater.DOgAoXFk.js";import{g as Zl}from"../chunks/id.DgJyTKp9.js";import{c as Jl,a as So}from"../chunks/events.CFQx83LM.js";import{c as ht}from"../chunks/utils.B-fZLt2p.js";import{g as $o,R as Mo,T as Io,a as zr}from"../chunks/index.DGhS-6YX.js";import{a as Ao,b as Lo}from"../chunks/platform.CrGG0hJ5.js";import{B as Wt}from"../chunks/button.DHi1-B5y.js";import{S as nn,M as Kl}from"../chunks/square-pen.Cvmolrto.js";import{I as or}from"../chunks/Icon.BjfYQTkH.js";import{I as Do,f as Po}from"../chunks/fileApi.CDDonNgb.js";import{m as Ql}from"../chunks/mapActivityStore.BMkPVnUJ.js";import{p as ln}from"../chunks/profileStore.DorDk9Q6.js";import{s as fe}from"../chunks/supabaseClient.CEfSaNHh.js";import{p as Oo}from"../chunks/stores.6DhR_UaX.js";import{X as xl}from"../chunks/x.C31NfBpR.js";import{d as gr,r as No,c as wr,p as tr,f as eo,a as Tr,b as zo,e as pn,g as Vo}from"../chunks/index.B2j4G_QV.js";import{T as to}from"../chunks/trash-2.Dbt-hAiK.js";import{A as Bo}from"../chunks/arrow-left.DsUtXb8R.js";import{A as Fo}from"../chunks/arrow-right.BhfSzXUk.js";import{s as bn}from"../chunks/operationStore.DMok4-vU.js";function Uo(l){let e,r,t,n=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 475.3 476.6"},l[0]],o={};for(let i=0;i<n.length;i+=1)o=ee(o,n[i]);return{c(){e=Ze("svg"),r=Ze("path"),t=Ze("path"),this.h()},l(i){e=Xe(i,"svg",{xmlns:!0,viewBox:!0});var c=H(e);r=Xe(c,"path",{d:!0}),H(r).forEach(k),t=Xe(c,"path",{d:!0}),H(t).forEach(k),c.forEach(k),this.h()},h(){D(r,"d","M235.1 25.7c-56.3 0-102 45.7-102 102s45.7 102 102 102 102-45.7 102-102c-.1-56.4-45.7-102-102-102m-64.3 145.9c-4.9 2.5-10.9.6-13.4-4.4-1.9-3.6-3.5-7.4-4.8-11.3-1.8-5.2 1-10.9 6.2-12.7s10.9 1 12.7 6.2c1 3 2.2 5.9 3.7 8.7 2.5 4.9.5 11-4.4 13.5m44.3-108.1c-26.1 8-44.7 31.1-47 58.4-.4 5.2-4.8 9.2-10 9.2h-.9c-5.5-.5-9.6-5.3-9.1-10.8 2.9-35.4 27.1-65.4 61-75.8 5.3-1.7 10.9 1.3 12.6 6.5s-1.4 10.8-6.6 12.5M230.1 392.1c3 2.1 7.1 2.1 10.1 0l10.3-143.4c-10.2 1.3-20.6 1.3-30.9 0z"),D(t,"d","M207.8 361.9c-34 2.1-65 8.1-88 17.1-21.7 8.5-34.7 19.1-34.7 28.3 0 19.3 57.1 46.3 150 46.3s150-27 150-46.3c0-9.3-13-19.8-34.7-28.3-23.1-9-54.1-15-88-17.1l-2.3 32c-.8 11.3-11.6 19.8-25 19.8s-24.1-8.5-25-19.8z"),yr(e,o)},m(i,c){U(i,e,c),I(e,r),I(e,t)},p(i,[c]){yr(e,o=De(n,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 475.3 476.6"},c&1&&i[0]]))},i:Ee,o:Ee,d(i){i&&k(e)}}}function Ro(l,e,r){return l.$$set=t=>{r(0,e=ee(ee({},e),$e(t)))},e=$e(e),[e]}let Ho=class extends ie{constructor(e){super(),se(this,e,Ro,Uo,le,{})}};function qo(l){let e,r,t=[{xmlns:"http://www.w3.org/2000/svg"},{width:"24"},{height:"24"},{viewBox:"0 0 100 100"},l[0]],n={};for(let o=0;o<t.length;o+=1)n=ee(n,t[o]);return{c(){e=Ze("svg"),r=Ze("path"),this.h()},l(o){e=Xe(o,"svg",{xmlns:!0,width:!0,height:!0,viewBox:!0});var i=H(e);r=Xe(i,"path",{fill:!0,d:!0,color:!0}),H(r).forEach(k),i.forEach(k),this.h()},h(){D(r,"fill","currentColor"),D(r,"d","M49.968 3.92a4.9 4.9 0 0 0-3.302 1.287L1.476 45.05l-.042.038C-.02 46.433-.358 48.628.374 50.23s2.448 2.749 4.394 2.75H16.42v38.508c0 2.629 2.288 4.59 4.797 4.591h57.564c2.509 0 4.797-1.962 4.797-4.59V52.98h11.653c1.946 0 3.662-1.146 4.394-2.749.732-1.602.394-3.798-1.06-5.143l-.042-.038-45.19-39.843a4.9 4.9 0 0 0-3.366-1.287M50 28.207c10.6 0 19.283 8.66 19.283 19.229 0 2.545-.507 4.979-1.42 7.208a11 11 0 0 1-.736 1.704l-14.79 25.17c-1.562 2.117-2.81 2.583-4.689.13l-13.41-23.181a19.05 19.05 0 0 1-3.521-11.031c0-10.57 8.683-19.23 19.283-19.23m0 9.01c-5.708 0-10.248 4.527-10.248 10.219S44.292 57.654 50 57.654s10.248-4.527 10.248-10.218c0-5.692-4.54-10.218-10.248-10.218"),D(r,"color","currentColor"),yr(e,n)},m(o,i){U(o,e,i),I(e,r)},p(o,[i]){yr(e,n=De(t,[{xmlns:"http://www.w3.org/2000/svg"},{width:"24"},{height:"24"},{viewBox:"0 0 100 100"},i&1&&o[0]]))},i:Ee,o:Ee,d(o){o&&k(e)}}}function Wo(l,e,r){return l.$$set=t=>{r(0,e=ee(ee({},e),$e(t)))},e=$e(e),[e]}class jo extends ie{constructor(e){super(),se(this,e,Wo,qo,le,{})}}const vn={location_drop:Ho,locate_home:jo};function Go(l){let e;const r=l[2].default,t=be(r,l,l[3],null);return{c(){t&&t.c()},l(n){t&&t.l(n)},m(n,o){t&&t.m(n,o),e=!0},p(n,o){t&&t.p&&(!e||o&8)&&ve(t,r,n,n[3],e?ke(r,n[3],o,null):we(n[3]),null)},i(n){e||(C(t,n),e=!0)},o(n){E(t,n),e=!1},d(n){t&&t.d(n)}}}function Yo(l){let e,r;const t=[{name:"gauge"},l[1],{iconNode:l[0]}];let n={$$slots:{default:[Go]},$$scope:{ctx:l}};for(let o=0;o<t.length;o+=1)n=ee(n,t[o]);return e=new or({props:n}),{c(){Y(e.$$.fragment)},l(o){Q(e.$$.fragment,o)},m(o,i){G(e,o,i),r=!0},p(o,[i]){const c=i&3?De(t,[t[0],i&2&&rt(o[1]),i&1&&{iconNode:o[0]}]):{};i&8&&(c.$$scope={dirty:i,ctx:o}),e.$set(c)},i(o){r||(C(e.$$.fragment,o),r=!0)},o(o){E(e.$$.fragment,o),r=!1},d(o){j(e,o)}}}function Xo(l,e,r){let{$$slots:t={},$$scope:n}=e;const o=[["path",{d:"m12 14 4-4"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0"}]];return l.$$set=i=>{r(1,e=ee(ee({},e),$e(i))),"$$scope"in i&&r(3,n=i.$$scope)},e=$e(e),[o,e,t,n]}class Zo extends ie{constructor(e){super(),se(this,e,Xo,Yo,le,{})}}function Jo(l){let e;const r=l[2].default,t=be(r,l,l[3],null);return{c(){t&&t.c()},l(n){t&&t.l(n)},m(n,o){t&&t.m(n,o),e=!0},p(n,o){t&&t.p&&(!e||o&8)&&ve(t,r,n,n[3],e?ke(r,n[3],o,null):we(n[3]),null)},i(n){e||(C(t,n),e=!0)},o(n){E(t,n),e=!1},d(n){t&&t.d(n)}}}function Ko(l){let e,r;const t=[{name:"paintbrush"},l[1],{iconNode:l[0]}];let n={$$slots:{default:[Jo]},$$scope:{ctx:l}};for(let o=0;o<t.length;o+=1)n=ee(n,t[o]);return e=new or({props:n}),{c(){Y(e.$$.fragment)},l(o){Q(e.$$.fragment,o)},m(o,i){G(e,o,i),r=!0},p(o,[i]){const c=i&3?De(t,[t[0],i&2&&rt(o[1]),i&1&&{iconNode:o[0]}]):{};i&8&&(c.$$scope={dirty:i,ctx:o}),e.$set(c)},i(o){r||(C(e.$$.fragment,o),r=!0)},o(o){E(e.$$.fragment,o),r=!1},d(o){j(e,o)}}}function Qo(l,e,r){let{$$slots:t={},$$scope:n}=e;const o=[["path",{d:"m14.622 17.897-10.68-2.913"}],["path",{d:"M18.376 2.622a1 1 0 1 1 3.002 3.002L17.36 9.643a.5.5 0 0 0 0 .707l.944.944a2.41 2.41 0 0 1 0 3.408l-.944.944a.5.5 0 0 1-.707 0L8.354 7.348a.5.5 0 0 1 0-.707l.944-.944a2.41 2.41 0 0 1 3.408 0l.944.944a.5.5 0 0 0 .707 0z"}],["path",{d:"M9 8c-1.804 2.71-3.97 3.46-6.583 3.948a.507.507 0 0 0-.302.819l7.32 8.883a1 1 0 0 0 1.185.204C12.735 20.405 16 16.792 16 15"}]];return l.$$set=i=>{r(1,e=ee(ee({},e),$e(i))),"$$scope"in i&&r(3,n=i.$$scope)},e=$e(e),[o,e,t,n]}class xo extends ie{constructor(e){super(),se(this,e,Qo,Ko,le,{})}}function ei(l){let e;const r=l[2].default,t=be(r,l,l[3],null);return{c(){t&&t.c()},l(n){t&&t.l(n)},m(n,o){t&&t.m(n,o),e=!0},p(n,o){t&&t.p&&(!e||o&8)&&ve(t,r,n,n[3],e?ke(r,n[3],o,null):we(n[3]),null)},i(n){e||(C(t,n),e=!0)},o(n){E(t,n),e=!1},d(n){t&&t.d(n)}}}function ti(l){let e,r;const t=[{name:"pen-off"},l[1],{iconNode:l[0]}];let n={$$slots:{default:[ei]},$$scope:{ctx:l}};for(let o=0;o<t.length;o+=1)n=ee(n,t[o]);return e=new or({props:n}),{c(){Y(e.$$.fragment)},l(o){Q(e.$$.fragment,o)},m(o,i){G(e,o,i),r=!0},p(o,[i]){const c=i&3?De(t,[t[0],i&2&&rt(o[1]),i&1&&{iconNode:o[0]}]):{};i&8&&(c.$$scope={dirty:i,ctx:o}),e.$set(c)},i(o){r||(C(e.$$.fragment,o),r=!0)},o(o){E(e.$$.fragment,o),r=!1},d(o){j(e,o)}}}function ri(l,e,r){let{$$slots:t={},$$scope:n}=e;const o=[["path",{d:"m10 10-6.157 6.162a2 2 0 0 0-.5.833l-1.322 4.36a.5.5 0 0 0 .622.624l4.358-1.323a2 2 0 0 0 .83-.5L14 13.982"}],["path",{d:"m12.829 7.172 4.359-4.346a1 1 0 1 1 3.986 3.986l-4.353 4.353"}],["path",{d:"m2 2 20 20"}]];return l.$$set=i=>{r(1,e=ee(ee({},e),$e(i))),"$$scope"in i&&r(3,n=i.$$scope)},e=$e(e),[o,e,t,n]}class ni extends ie{constructor(e){super(),se(this,e,ri,ti,le,{})}}function li(l){let e;const r=l[2].default,t=be(r,l,l[3],null);return{c(){t&&t.c()},l(n){t&&t.l(n)},m(n,o){t&&t.m(n,o),e=!0},p(n,o){t&&t.p&&(!e||o&8)&&ve(t,r,n,n[3],e?ke(r,n[3],o,null):we(n[3]),null)},i(n){e||(C(t,n),e=!0)},o(n){E(t,n),e=!1},d(n){t&&t.d(n)}}}function oi(l){let e,r;const t=[{name:"pencil-ruler"},l[1],{iconNode:l[0]}];let n={$$slots:{default:[li]},$$scope:{ctx:l}};for(let o=0;o<t.length;o+=1)n=ee(n,t[o]);return e=new or({props:n}),{c(){Y(e.$$.fragment)},l(o){Q(e.$$.fragment,o)},m(o,i){G(e,o,i),r=!0},p(o,[i]){const c=i&3?De(t,[t[0],i&2&&rt(o[1]),i&1&&{iconNode:o[0]}]):{};i&8&&(c.$$scope={dirty:i,ctx:o}),e.$set(c)},i(o){r||(C(e.$$.fragment,o),r=!0)},o(o){E(e.$$.fragment,o),r=!1},d(o){j(e,o)}}}function ii(l,e,r){let{$$slots:t={},$$scope:n}=e;const o=[["path",{d:"M13 7 8.7 2.7a2.41 2.41 0 0 0-3.4 0L2.7 5.3a2.41 2.41 0 0 0 0 3.4L7 13"}],["path",{d:"m8 6 2-2"}],["path",{d:"m18 16 2-2"}],["path",{d:"m17 11 4.3 4.3c.94.94.94 2.46 0 3.4l-2.6 2.6c-.94.94-2.46.94-3.4 0L11 17"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z"}],["path",{d:"m15 5 4 4"}]];return l.$$set=i=>{r(1,e=ee(ee({},e),$e(i))),"$$scope"in i&&r(3,n=i.$$scope)},e=$e(e),[o,e,t,n]}class si extends ie{constructor(e){super(),se(this,e,ii,oi,le,{})}}function ai(l){let e;const r=l[2].default,t=be(r,l,l[3],null);return{c(){t&&t.c()},l(n){t&&t.l(n)},m(n,o){t&&t.m(n,o),e=!0},p(n,o){t&&t.p&&(!e||o&8)&&ve(t,r,n,n[3],e?ke(r,n[3],o,null):we(n[3]),null)},i(n){e||(C(t,n),e=!0)},o(n){E(t,n),e=!1},d(n){t&&t.d(n)}}}function ci(l){let e,r;const t=[{name:"ruler"},l[1],{iconNode:l[0]}];let n={$$slots:{default:[ai]},$$scope:{ctx:l}};for(let o=0;o<t.length;o+=1)n=ee(n,t[o]);return e=new or({props:n}),{c(){Y(e.$$.fragment)},l(o){Q(e.$$.fragment,o)},m(o,i){G(e,o,i),r=!0},p(o,[i]){const c=i&3?De(t,[t[0],i&2&&rt(o[1]),i&1&&{iconNode:o[0]}]):{};i&8&&(c.$$scope={dirty:i,ctx:o}),e.$set(c)},i(o){r||(C(e.$$.fragment,o),r=!0)},o(o){E(e.$$.fragment,o),r=!1},d(o){j(e,o)}}}function ui(l,e,r){let{$$slots:t={},$$scope:n}=e;const o=[["path",{d:"M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0Z"}],["path",{d:"m14.5 12.5 2-2"}],["path",{d:"m11.5 9.5 2-2"}],["path",{d:"m8.5 6.5 2-2"}],["path",{d:"m17.5 15.5 2-2"}]];return l.$$set=i=>{r(1,e=ee(ee({},e),$e(i))),"$$scope"in i&&r(3,n=i.$$scope)},e=$e(e),[o,e,t,n]}class fi extends ie{constructor(e){super(),se(this,e,ui,ci,le,{})}}function Vr(l,e,r,t){const n=(l-(isNaN(e)?0:e))%t;let o=Math.abs(n)*2>=t?l+Math.sign(n)*(t-Math.abs(n)):l-n;isNaN(e)?!isNaN(r)&&o>r&&(o=Math.floor(r/t)*t):o<e?o=e:!isNaN(r)&&o>r&&(o=e+Math.floor((r-e)/t)*t);const i=t.toString(),c=i.indexOf("."),s=c>=0?i.length-c:0;if(s>0){const a=Math.pow(10,s);o=Math.round(o*a)/a}return o}function di(l,e,r){return Math.max(l,Math.min(e,r))}function ro(l,e){let r=0;return To(()=>{clearTimeout(r)}),()=>{window.clearTimeout(r),r=window.setTimeout(l,e)}}function Yr(l,e){let r=0;const t=new ResizeObserver(()=>{cancelAnimationFrame(r),r=requestAnimationFrame(e)});return t.observe(l),()=>{window.cancelAnimationFrame(r),t.unobserve(l)}}function hi(l,e=lr){let r={left:l.scrollLeft,top:l.scrollTop},t=0;return function n(){const o={left:l.scrollLeft,top:l.scrollTop},i=r.left!==o.left,c=r.top!==o.top;(i||c)&&e(),r=o,t=window.requestAnimationFrame(n)}(),()=>window.cancelAnimationFrame(t)}function wn(l,e){return l>0&&l<e}function no(l,e){return r=>{if(l[0]===l[1]||e[0]===e[1])return e[0];const t=(e[1]-e[0])/(l[1]-l[0]);return e[0]+t*(r-l[0])}}function _r(l){return l?parseInt(l,10):0}function lo(l,e){const r=l/e;return isNaN(r)?0:r}function Mr(l){const e=lo(l.viewport,l.content),r=l.scrollbar.paddingStart+l.scrollbar.paddingEnd,t=(l.scrollbar.size-r)*e;return Math.max(t,18)}function mi(l,e,r,t="ltr"){const n=Mr(r),o=n/2,i=e||o,c=n-i,s=r.scrollbar.paddingStart+i,a=r.scrollbar.size-r.scrollbar.paddingEnd-c,u=r.content-r.viewport,f=t==="ltr"?[0,u]:[u*-1,0];return no([s,a],f)(l)}function gi(l,e,r="ltr"){const t=Mr(e),n=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,o=e.scrollbar.size-n,i=e.content-e.viewport,c=o-t,[s,a]=r==="ltr"?[0,i]:[i*-1,0],u=di(s,l,a);return no([0,i],[0,c])(u)}function _i(l,e){const r=Oe.writable(l);function t(o){const i=r.get();return e[i][o]??i}return{state:r,dispatch:o=>{r.set(t(o))}}}function rr(l){const{rootState:e,scrollbarState:r}=l;r.isVisible.set(!0);function t(a){const u=r.domRect.get();if(!u)return;const f=a.clientX-u.left,g=a.clientY-u.top;r.isHorizontal.get()?r.onDragScroll(f):r.onDragScroll(g)}function n(a){if(a.button!==0)return;const u=a.target;if(!gt(u))return;u.setPointerCapture(a.pointerId);const f=a.currentTarget;if(!gt(f))return;r.domRect.set(f.getBoundingClientRect()),r.prevWebkitUserSelect.set(document.body.style.webkitUserSelect),document.body.style.webkitUserSelect="none";const g=e.viewportEl.get();g&&(g.style.scrollBehavior="auto"),t(a)}function o(a){t(a)}function i(a){const u=a.target;if(!gt(u))return;u.hasPointerCapture(a.pointerId)&&u.releasePointerCapture(a.pointerId),document.body.style.webkitUserSelect=r.prevWebkitUserSelect.get();const f=e.viewportEl.get();f&&(f.style.scrollBehavior=""),r.domRect.set(null)}function c(a){const u=a.target,f=a.currentTarget;if(!gt(u)||!gt(f)||!f.contains(u))return;const d=r.sizes.get();if(!d)return;const b=d.content-d.viewport;r.handleWheelScroll(a,b)}function s(a){r.scrollbarEl.set(a);const u=Ot(qt(a,"pointerdown",n),qt(a,"pointermove",o),qt(a,"pointerup",i),je(document,"wheel",c,{passive:!1})),f=At([e.contentEl],([g])=>g?Yr(g,r.handleSizeChange):lr);return{destroy(){u(),f()}}}return s}function pi(l){const e=rr(l),{rootState:r,scrollbarState:t}=l,n=ro(()=>{const i=r.viewportEl.get();if(!i)return;const c=i.offsetWidth<i.scrollWidth,s=i.offsetHeight<i.scrollHeight;t.isVisible.set(t.isHorizontal.get()?c:s)},10);function o(i){const c=e(i)?.destroy;n();const s=[],a=r.viewportEl.get();a&&s.push(Yr(a,n));const u=r.contentEl.get();return u&&s.push(Yr(u,n)),{destroy(){s.forEach(f=>f()),c()}}}return o}function bi(l){const e=rr(l),{rootState:r,scrollbarState:t}=l;t.isVisible.set(!1);let n;function o(){if(window.clearTimeout(n),t.isVisible.get())return;const s=r.viewportEl.get();if(!s)return;const a=s.offsetWidth<s.scrollWidth,u=s.offsetHeight<s.scrollHeight;t.isVisible.set(t.isHorizontal.get()?a:u)}function i(){n=window.setTimeout(()=>{t.isVisible.get()&&t.isVisible.set(!1)},r.options.hideDelay.get())}function c(s){const a=e(s)?.destroy,u=s.closest("[data-melt-scroll-area]");let f=lr;return u&&(Ao()?f=Ot(je(u,"touchstart",o),je(u,"touchend",i)):Lo()?f=Ot(je(u,"pointerenter",o),je(u,"mouseenter",o),je(u,"mouseleave",i)):f=Ot(je(u,"pointerenter",o),je(u,"pointerleave",i))),{destroy(){a?.(),f()}}}return c}function vi(l){const e=rr(l),{rootState:r,scrollbarState:t}=l,n=_i("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});At([n.state],([c])=>{c==="idle"&&window.setTimeout(()=>{n.dispatch("HIDE")},r.options.hideDelay.get()),c==="hidden"?t.isVisible.set(!1):t.isVisible.set(!0)});const o=ro(()=>n.dispatch("SCROLL_END"),100);At([r.viewportEl,t.isHorizontal],([c,s])=>{const a=s?"scrollLeft":"scrollTop";let u=lr;if(c){let f=c[a];u=je(c,"scroll",()=>{const d=c[a];f!==d&&(n.dispatch("SCROLL"),o()),f=d})}return()=>{u()}});function i(c){const s=e(c)?.destroy,a=Ot(je(c,"pointerenter",()=>n.dispatch("POINTER_ENTER")),je(c,"pointerleave",()=>n.dispatch("POINTER_LEAVE")));return{destroy(){s?.(),a()}}}return i}function wi(l,e){const r=e(l),{rootState:t,scrollbarState:n}=l;return pt(Nt("scrollbar"),{stores:[n.sizes,t.options.dir,n.isVisible],returned:([o,i,c])=>({style:ft({position:"absolute",bottom:0,left:i==="rtl"?"var(--melt-scroll-area-corner-width)":0,right:i==="ltr"?"var(--melt-scroll-area-corner-width)":0,"--melt-scroll-area-thumb-width":`${Mr(o)}px`,visibility:c?void 0:"hidden"}),"data-state":c?"visible":"hidden"}),action:o=>{const i=r(o)?.destroy;return t.scrollbarXEl.set(o),t.scrollbarXEnabled.set(!0),{destroy(){i?.(),t.scrollbarXEl.set(null)}}}})}function ki(l,e){const r=e(l),{rootState:t,scrollbarState:n}=l;return pt(Nt("scrollbar"),{stores:[n.sizes,t.options.dir,n.isVisible],returned:([o,i,c])=>({style:ft({position:"absolute",top:0,right:i==="ltr"?0:void 0,left:i==="rtl"?0:void 0,bottom:"var(--melt-scroll-area-corner-height)","--melt-scroll-area-thumb-height":`${Mr(o)}px`,visibility:c?void 0:"hidden"}),"data-state":c?"visible":"hidden"}),action:o=>{const i=r(o)?.destroy;return t.scrollbarYEl.set(o),t.scrollbarYEnabled.set(!0),{destroy(){i?.(),t.scrollbarYEl.set(null)}}}})}function yi(l){switch(l){case"always":return rr;case"auto":return pi;case"hover":return bi;case"scroll":return vi;default:return rr}}const{name:Nt}=Gl("scroll-area"),Ti=["root","viewport","content","scrollbarX","scrollbarY","thumbX","thumbY"],Ci={type:"hover",hideDelay:600,dir:"ltr"};function Ei(l){const e={...Ci,...l},r=Gr(jl(e,"ids")),t=Oe.writable(0),n=Oe.writable(0),o=Oe.writable(!1),i=Oe.writable(!1),c=Oe.writable(null),s=Oe.writable(null),a=Oe.writable(null),u=Oe.writable(null),f=Oe.writable(null),g=Gr({...Zl(Ti),...e.ids}),d={cornerWidth:t,cornerHeight:n,scrollbarXEnabled:o,scrollbarYEnabled:i,viewportEl:s,contentEl:a,options:r,scrollbarXEl:u,scrollbarYEl:f,scrollAreaEl:c,ids:g},b=pt(Nt(),{stores:[t,n,g.root],returned:([m,w,v])=>({style:ft({position:"relative","--melt-scroll-area-corner-width":`${m}px`,"--melt-scroll-area-corner-height":`${w}px`}),id:v}),action:m=>(c.set(m),{destroy(){c.set(null)}})}),h=pt(Nt("viewport"),{stores:[o,i,g.viewport],returned:([m,w,v])=>({style:ft({"scrollbar-width":"none","-ms-overflow-style":"none","-webkit-overflow-scrolling":"touch","-webkit-scrollbar":"none","overflow-x":m?"scroll":"hidden","overflow-y":w?"scroll":"hidden"}),id:v}),action:m=>{const w=document.createElement("style");return w.innerHTML=`
				/* Hide scrollbars cross-browser and enable momentum scroll for touch
					devices */
				[data-melt-scroll-area-viewport] {
					scrollbar-width: none;
					-ms-overflow-style: none;
					-webkit-overflow-scrolling: touch;
				}

				[data-melt-scroll-area-viewport]::-webkit-scrollbar {
					display: none;
				}
			`,m.parentElement?.insertBefore(w,m),s.set(m),{destroy(){w.remove(),s.set(null)}}}}),_=pt(Nt("content"),{stores:[g.content],returned:([m])=>({style:ft({"min-width":"100%",display:"table"}),id:m}),action:m=>(a.set(m),{destroy(){a.set(null)}})});function y(m="vertical"){const w=Oe.writable(m),v=Oe.writable(m==="horizontal"),A=Oe.writable(null),P=Oe.writable(""),O=Oe.writable(0),L=Oe.writable(null),F=Oe.writable(0),z=Oe.writable(null),W=Oe.writable({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),N=Oe.writable(!1),R=Oe.derived(W,ue=>{const Le=lo(ue.viewport,ue.content);return Le>0&&Le<1});function X(ue,Le){return mi(ue,O.get(),W.get(),Le)}function Z(ue,Le){const Pe=s.get();if(Pe)if(v.get()){const Re=Pe.scrollLeft+ue.deltaY;Pe.scrollLeft=Re,wn(Re,Le)&&ue.preventDefault()}else{const Re=Pe.scrollTop+ue.deltaY;Pe.scrollTop=Re,wn(Re,Le)&&ue.preventDefault()}}function te(ue){v.get()?O.set(ue.x):O.set(ue.y)}function q(){O.set(0)}function x(){const ue=s.get(),Le=L.get();if(!ue||!Le)return;const Pe=v.get()?ue.scrollLeft:ue.scrollTop,Re=gi(Pe,W.get(),d.options.dir.get());F.set(Re)}function pe(ue){const Le=s.get();Le&&(v.get()?Le.scrollLeft=X(ue,d.options.dir.get()):Le.scrollTop=X(ue))}function _e(){const ue=ye.scrollbarEl.get();if(!ue)return;const Le=ye.isHorizontal.get(),Pe=d.viewportEl.get();Le?ye.sizes.set({content:Pe?.scrollWidth??0,viewport:Pe?.offsetWidth??0,scrollbar:{size:ue.clientWidth??0,paddingStart:_r(getComputedStyle(ue).paddingLeft),paddingEnd:_r(getComputedStyle(ue).paddingRight)}}):ye.sizes.set({content:Pe?.scrollHeight??0,viewport:Pe?.offsetHeight??0,scrollbar:{size:ue.clientHeight??0,paddingStart:_r(getComputedStyle(ue).paddingLeft),paddingEnd:_r(getComputedStyle(ue).paddingRight)}})}const ye={isHorizontal:v,domRect:A,prevWebkitUserSelect:P,pointerOffset:O,thumbEl:L,thumbOffset:F,sizes:W,orientation:w,handleThumbDown:te,handleThumbUp:q,onThumbPositionChange:x,onDragScroll:pe,handleWheelScroll:Z,hasThumb:R,scrollbarEl:z,isVisible:N,handleSizeChange:_e},Me=yi(r.type.get()),ae={rootState:d,scrollbarState:ye},oe=m==="horizontal"?wi(ae,Me):ki(ae,Me),Ie=Si(ae);return{scrollbar:oe,thumb:Ie}}const{scrollbar:M,thumb:$}=y("horizontal"),{scrollbar:T,thumb:S}=y("vertical"),p=$i(d);return{options:r,elements:{root:b,viewport:h,content:_,corner:p,scrollbarX:M,scrollbarY:T,thumbX:$,thumbY:S}}}function Si(l){const{scrollbarState:e,rootState:r}=l;function t(s){const a=s.target;if(!gt(a))return;const u=a.getBoundingClientRect(),f=s.clientX-u.left,g=s.clientY-u.top;e.handleThumbDown({x:f,y:g})}function n(s){e.handleThumbUp(s)}let o;function i(){if(o)return;const s=r.viewportEl.get();s&&(o=hi(s,e.onThumbPositionChange)),e.onThumbPositionChange()}return pt(Nt("thumb"),{stores:[e.hasThumb,e.isHorizontal,e.thumbOffset],returned:([s,a,u])=>({style:ft({width:"var(--melt-scroll-area-thumb-width)",height:"var(--melt-scroll-area-thumb-height)",transform:a?`translate3d(${Math.round(u)}px, 0, 0)`:`translate3d(0, ${Math.round(u)}px, 0)`}),"data-state":s?"visible":"hidden"}),action:s=>{e.thumbEl.set(s);const a=At([e.sizes],([f])=>{const g=r.viewportEl.get();return g?(e.onThumbPositionChange(),je(g,"scroll",i)):lr}),u=Ot(qt(s,"pointerdown",t),qt(s,"pointerup",n));return{destroy(){o?.(),u(),a()}}}})}function $i(l){const e=Ve(0),r=Ve(0),t=Jt([e,r],([u,f])=>!!u&&!!f);function n(){const u=l.scrollbarXEl.get()?.offsetHeight||0;l.cornerHeight.set(u),r.set(u)}function o(){const u=l.scrollbarYEl.get()?.offsetWidth||0;l.cornerWidth.set(u),e.set(u)}At([l.scrollbarXEl],([u])=>{u&&n()}),At([l.scrollbarYEl],([u])=>{u&&o()});const i=Jt([l.scrollbarXEl,l.scrollbarYEl],([u,f])=>!!u&&!!f),c=Jt([l.options.type,i],([u,f])=>u!=="scroll"&&f),s=Jt([c,t],([u,f])=>u&&f);return pt(Nt("corner"),{stores:[e,r,l.options.dir,s],returned:([u,f,g,d])=>({style:ft({display:d?"block":"none",width:`${u}px`,height:`${f}px`,position:"absolute",right:g==="ltr"?0:void 0,left:g==="rtl"?0:void 0,bottom:0})})})}const Mi={defaultValue:[],min:0,max:100,step:1,orientation:"horizontal",dir:"ltr",disabled:!1},{name:pr}=Gl("slider"),Ii=l=>{const e={...Mi,...l},r=Gr(jl(e,"value","onValueChange","defaultValue")),{min:t,max:n,step:o,orientation:i,dir:c,disabled:s}=r,a=e.value??Ve(e.defaultValue),u=Eo(a,e?.onValueChange),f=Oe(Ve(!1)),g=Oe(Ve(0)),d=Oe(Ve(null)),b=Zl(["root"]),h=(m,w)=>{u.update(v=>{if(!v)return[m];if(v[w]===m)return v;const A=[...v],P=A[w]>m?-1:1;function O(){A[w]=A[w+P],A[w+P]=m;const W=_();W&&(W[w+P].focus(),d.set({thumb:W[w+P],index:w+P}))}if(P===-1&&m<A[w-1])return O(),A;if(P===1&&m>A[w+1])return O(),A;const L=t.get(),F=n.get(),z=o.get();return A[w]=Vr(m,L,F,z),A})},_=()=>{const m=Nr(b.root);return m?Array.from(m.querySelectorAll('[data-melt-part="thumb"]')).filter(w=>gt(w)):null},y=Jt([t,n],([m,w])=>v=>(v-m)/(w-m)*100),M=Oe.derived([i,c],([m,w])=>m==="horizontal"?w==="rtl"?"rl":"lr":w==="rtl"?"tb":"bt"),$=pt(pr(),{stores:[s,i,c],returned:([m,w,v])=>({dir:v,disabled:Or(m),"data-disabled":Or(m),"data-orientation":w,style:m?void 0:`touch-action: ${w==="horizontal"?"pan-y":"pan-x"}`,"data-melt-id":b.root})}),T=pt(pr("range"),{stores:[u,M,y],returned:([m,w,v])=>{const A=m.length>1?v(Math.min(...m)??0):0,P=100-v(Math.max(...m)??0),O={position:"absolute"};switch(w){case"lr":{O.left=`${A}%`,O.right=`${P}%`;break}case"rl":{O.right=`${A}%`,O.left=`${P}%`;break}case"bt":{O.bottom=`${A}%`,O.top=`${P}%`;break}case"tb":{O.top=`${A}%`,O.bottom=`${P}%`;break}}return{style:ft(O)}}}),S=_n(pr("thumb"),{stores:[u,y,t,n,s,i,M],returned:([m,w,v,A,P,O,L])=>Array.from({length:m.length||1},(z,W)=>{g.get()<m.length&&g.update(te=>te+1);const R=m[W],X=`${w(R)}%`,Z={position:"absolute"};switch(L){case"lr":{Z.left=X,Z.translate="-50% 0";break}case"rl":{Z.right=X,Z.translate="50% 0";break}case"bt":{Z.bottom=X,Z.translate="0 50%";break}case"tb":{Z.top=X,Z.translate="0 -50%";break}}return{role:"slider","aria-valuemin":v,"aria-valuemax":A,"aria-valuenow":R,"aria-disabled":Or(P),"aria-orientation":O,"data-melt-part":"thumb","data-value":R,style:ft(Z),tabindex:P?-1:0}}),action:m=>({destroy:qt(m,"keydown",v=>{if(s.get())return;const A=v.currentTarget;if(!gt(A))return;const P=_();if(!P?.length)return;const O=P.indexOf(A);if(g.set(O),![et.ARROW_LEFT,et.ARROW_RIGHT,et.ARROW_UP,et.ARROW_DOWN,et.HOME,et.END].includes(v.key))return;v.preventDefault();const L=t.get(),F=n.get(),z=o.get(),W=u.get(),N=i.get(),R=M.get(),X=W[O];switch(v.key){case et.HOME:{h(L,O);break}case et.END:{h(F,O);break}case et.ARROW_LEFT:{if(N!=="horizontal")break;v.metaKey?h(R==="rl"?F:L,O):R==="rl"&&X<F?h(X+z,O):R==="lr"&&X>L&&h(X-z,O);break}case et.ARROW_RIGHT:{if(N!=="horizontal")break;v.metaKey?h(R==="rl"?L:F,O):R==="rl"&&X>L?h(X-z,O):R==="lr"&&X<F&&h(X+z,O);break}case et.ARROW_UP:{v.metaKey?h(R==="tb"?L:F,O):R==="tb"&&X>L?h(X-z,O):R!=="tb"&&X<F&&h(X+z,O);break}case et.ARROW_DOWN:{v.metaKey?h(R==="tb"?F:L,O):R==="tb"&&X<F?h(X+z,O):R!=="tb"&&X>L&&h(X-z,O);break}}})})}),p=_n(pr("tick"),{stores:[u,t,n,o,M],returned:([m,w,v,A,P])=>{const O=v-w;let L=Math.ceil(O/A);return O%A==0&&L++,Array.from({length:L},(F,z)=>{const W=`${z*(A/(v-w))*100}%`,N=z===0,R=z===L-1,X=N?0:R?-100:-50,Z={position:"absolute"};switch(P){case"lr":{Z.left=W,Z.translate=`${X}% 0`;break}case"rl":{Z.right=W,Z.translate=`${-X}% 0`;break}case"bt":{Z.bottom=W,Z.translate=`0 ${-X}%`;break}case"tb":{Z.top=W,Z.translate=`0 ${X}%`;break}}const te=w+z*A;return{"data-bounded":(m.length===1?te<=m[0]:m[0]<=te&&te<=m[m.length-1])?!0:void 0,"data-value":te,style:ft(Z)}})}});return At([$,t,n,s,i,M,o],([m,w,v,A,P,O,L])=>{if(!Co||A)return;const F=(Z,te,q,x)=>{const _e=(Z-q)/(x-q)*(v-w)+w;if(_e<w)h(w,te);else if(_e>v)h(v,te);else{const ye=L,Me=w,ae=Math.floor((_e-Me)/ye),oe=Me+ae*ye+ye/2,Ie=Me+(ae+1)*ye+ye/2,ue=_e>=oe&&_e<Ie?(ae+1)*ye+Me:ae*ye+Me;ue<=v&&h(ue,te)}},z=Z=>{const te=_();if(!te)return;te.forEach(_e=>_e.blur());const q=te.map(_e=>{if(P==="horizontal"){const{left:ye,right:Me}=_e.getBoundingClientRect();return Math.abs(Z.clientX-(ye+Me)/2)}else{const{top:ye,bottom:Me}=_e.getBoundingClientRect();return Math.abs(Z.clientY-(ye+Me)/2)}}),x=te[q.indexOf(Math.min(...q))],pe=te.indexOf(x);return{thumb:x,index:pe}},W=Z=>{if(!f.get())return;Z.preventDefault(),Z.stopPropagation();const te=Nr(m["data-melt-id"]),q=d.get();if(!te||!q)return;q.thumb.focus();const{left:x,right:pe,top:_e,bottom:ye}=te.getBoundingClientRect();switch(O){case"lr":{F(Z.clientX,q.index,x,pe);break}case"rl":{F(Z.clientX,q.index,pe,x);break}case"bt":{F(Z.clientY,q.index,ye,_e);break}case"tb":{F(Z.clientY,q.index,_e,ye);break}}},N=Z=>{if(Z.button!==0)return;const te=Nr(m["data-melt-id"]),q=z(Z);if(!q||!te)return;const x=Z.target;!gt(x)||!te.contains(x)||(Z.preventDefault(),d.set(q),q.thumb.focus(),f.set(!0),W(Z))},R=()=>{f.set(!1)},X=Ot(je(document,"pointerdown",N),je(document,"pointerup",R),je(document,"pointerleave",R),je(document,"pointermove",W));return()=>{X()}}),At([o,t,n,u],function([w,v,A,P]){const O=F=>Vr(F,v,A,w)===F,L=F=>Vr(F,v,A,w);P.some(F=>!O(F))&&u.update(F=>F.map(L))}),{elements:{root:$,thumbs:S,range:T,ticks:p},states:{value:u},options:r}};function Ai(l){return Object.keys(l).reduce((e,r)=>l[r]===void 0?e:`${e}${r}:${l[r]};`,"")}function Ir(){return{NAME:"scroll-area",PARTS:["scrollbar-x","scrollbar-y","thumb-x","thumb-y","viewport","content","root","corner"],SCROLLBAR_NAME:"scrollbar"}}function Li(l){const{NAME:e,PARTS:r}=Ir(),t=Jl(e,r),n={...Ei(Yl(l)),getAttrs:t};return Er(e,n),{...n,updateOption:Xl(n.options)}}function zt(){const{NAME:l}=Ir();return Gt(l)}function Di(l){const{SCROLLBAR_NAME:e}=Ir();return Er(e,l)}function Pi(){const{SCROLLBAR_NAME:l}=Ir();return Gt(l)}const Oi=l=>({builder:l&8}),kn=l=>({builder:l[3]}),Ni=l=>({builder:l&8}),yn=l=>({builder:l[3]});function zi(l){let e,r,t,n;const o=l[10].default,i=be(o,l,l[9],kn);let c=[l[3],l[2]],s={};for(let a=0;a<c.length;a+=1)s=ee(s,c[a]);return{c(){e=B("div"),i&&i.c(),this.h()},l(a){e=V(a,"DIV",{});var u=H(e);i&&i.l(u),u.forEach(k),this.h()},h(){Ne(e,s)},m(a,u){U(a,e,u),i&&i.m(e,null),l[11](e),r=!0,t||(n=tt(l[3].action(e)),t=!0)},p(a,u){i&&i.p&&(!r||u&520)&&ve(i,o,a,a[9],r?ke(o,a[9],u,Oi):we(a[9]),kn),Ne(e,s=De(c,[u&8&&a[3],u&4&&a[2]]))},i(a){r||(C(i,a),r=!0)},o(a){E(i,a),r=!1},d(a){a&&k(e),i&&i.d(a),l[11](null),t=!1,n()}}}function Vi(l){let e;const r=l[10].default,t=be(r,l,l[9],yn);return{c(){t&&t.c()},l(n){t&&t.l(n)},m(n,o){t&&t.m(n,o),e=!0},p(n,o){t&&t.p&&(!e||o&520)&&ve(t,r,n,n[9],e?ke(r,n[9],o,Ni):we(n[9]),yn)},i(n){e||(C(t,n),e=!0)},o(n){E(t,n),e=!1},d(n){t&&t.d(n)}}}function Bi(l){let e,r,t,n;const o=[Vi,zi],i=[];function c(s,a){return s[1]?0:1}return e=c(l),r=i[e]=o[e](l),{c(){r.c(),t=ne()},l(s){r.l(s),t=ne()},m(s,a){i[e].m(s,a),U(s,t,a),n=!0},p(s,[a]){let u=e;e=c(s),e===u?i[e].p(s,a):(de(),E(i[u],1,1,()=>{i[u]=null}),he(),r=i[e],r?r.p(s,a):(r=i[e]=o[e](s),r.c()),C(r,1),r.m(t.parentNode,t))},i(s){n||(C(r),n=!0)},o(s){E(r),n=!1},d(s){s&&k(t),i[e].d(s)}}}function Fi(l,e,r){let t,n;const o=["type","dir","hideDelay","asChild","el"];let i=Te(e,o),c,{$$slots:s={},$$scope:a}=e,{type:u="hover"}=e,{dir:f="ltr"}=e,{hideDelay:g=600}=e,{asChild:d=!1}=e,{el:b=void 0}=e;const{elements:{root:h},updateOption:_,getAttrs:y}=Li({type:u,dir:f,hideDelay:g});re(l,h,S=>r(8,c=S));const M=y("root"),$=Ai({overflow:"hidden"});function T(S){Ue[S?"unshift":"push"](()=>{b=S,r(0,b)})}return l.$$set=S=>{e=ee(ee({},e),$e(S)),r(16,i=Te(e,o)),"type"in S&&r(5,u=S.type),"dir"in S&&r(6,f=S.dir),"hideDelay"in S&&r(7,g=S.hideDelay),"asChild"in S&&r(1,d=S.asChild),"el"in S&&r(0,b=S.el),"$$scope"in S&&r(9,a=S.$$scope)},l.$$.update=()=>{l.$$.dirty&256&&r(3,t=c),l.$$.dirty&32&&_("type",u),l.$$.dirty&64&&_("dir",f),l.$$.dirty&128&&_("hideDelay",g),r(2,n={...i,...M,style:$}),l.$$.dirty&12&&Object.assign(t,n)},[b,d,n,t,h,u,f,g,c,a,s,T]}let Ui=class extends ie{constructor(e){super(),se(this,e,Fi,Bi,le,{type:5,dir:6,hideDelay:7,asChild:1,el:0})}};const Ri=l=>({builder:l&4}),Tn=l=>({builder:l[2]}),Hi=l=>({builder:l&4}),Cn=l=>({builder:l[2]});function qi(l){let e,r,t,n;const o=l[7].default,i=be(o,l,l[6],Tn);let c=[l[2]],s={};for(let a=0;a<c.length;a+=1)s=ee(s,c[a]);return{c(){e=B("div"),i&&i.c(),this.h()},l(a){e=V(a,"DIV",{});var u=H(e);i&&i.l(u),u.forEach(k),this.h()},h(){Ne(e,s)},m(a,u){U(a,e,u),i&&i.m(e,null),l[8](e),r=!0,t||(n=tt(l[2].action(e)),t=!0)},p(a,u){i&&i.p&&(!r||u&68)&&ve(i,o,a,a[6],r?ke(o,a[6],u,Ri):we(a[6]),Tn),Ne(e,s=De(c,[u&4&&a[2]]))},i(a){r||(C(i,a),r=!0)},o(a){E(i,a),r=!1},d(a){a&&k(e),i&&i.d(a),l[8](null),t=!1,n()}}}function Wi(l){let e;const r=l[7].default,t=be(r,l,l[6],Cn);return{c(){t&&t.c()},l(n){t&&t.l(n)},m(n,o){t&&t.m(n,o),e=!0},p(n,o){t&&t.p&&(!e||o&68)&&ve(t,r,n,n[6],e?ke(r,n[6],o,Hi):we(n[6]),Cn)},i(n){e||(C(t,n),e=!0)},o(n){E(t,n),e=!1},d(n){t&&t.d(n)}}}function ji(l){let e,r,t,n;const o=[Wi,qi],i=[];function c(s,a){return s[1]?0:1}return e=c(l),r=i[e]=o[e](l),{c(){r.c(),t=ne()},l(s){r.l(s),t=ne()},m(s,a){i[e].m(s,a),U(s,t,a),n=!0},p(s,[a]){let u=e;e=c(s),e===u?i[e].p(s,a):(de(),E(i[u],1,1,()=>{i[u]=null}),he(),r=i[e],r?r.p(s,a):(r=i[e]=o[e](s),r.c()),C(r,1),r.m(t.parentNode,t))},i(s){n||(C(r),n=!0)},o(s){E(r),n=!1},d(s){s&&k(t),i[e].d(s)}}}function Gi(l,e,r){let t,n;const o=["asChild","el"];let i=Te(e,o),c,{$$slots:s={},$$scope:a}=e,{asChild:u=!1}=e,{el:f=void 0}=e;const{elements:{viewport:g},getAttrs:d}=zt();re(l,g,_=>r(5,c=_));const b=d("viewport");function h(_){Ue[_?"unshift":"push"](()=>{f=_,r(0,f)})}return l.$$set=_=>{e=ee(ee({},e),$e(_)),r(11,i=Te(e,o)),"asChild"in _&&r(1,u=_.asChild),"el"in _&&r(0,f=_.el),"$$scope"in _&&r(6,a=_.$$scope)},l.$$.update=()=>{r(4,t={...i,...b}),l.$$.dirty&32&&r(2,n=c),l.$$.dirty&20&&Object.assign(n,t)},[f,u,n,g,t,c,a,s,h]}class Yi extends ie{constructor(e){super(),se(this,e,Gi,ji,le,{asChild:1,el:0})}}const Xi=l=>({builder:l&4}),En=l=>({builder:l[2]}),Zi=l=>({builder:l&4}),Sn=l=>({builder:l[2]});function Ji(l){let e,r,t,n;const o=l[7].default,i=be(o,l,l[6],En);let c=[l[2]],s={};for(let a=0;a<c.length;a+=1)s=ee(s,c[a]);return{c(){e=B("div"),i&&i.c(),this.h()},l(a){e=V(a,"DIV",{});var u=H(e);i&&i.l(u),u.forEach(k),this.h()},h(){Ne(e,s)},m(a,u){U(a,e,u),i&&i.m(e,null),l[8](e),r=!0,t||(n=tt(l[2].action(e)),t=!0)},p(a,u){i&&i.p&&(!r||u&68)&&ve(i,o,a,a[6],r?ke(o,a[6],u,Xi):we(a[6]),En),Ne(e,s=De(c,[u&4&&a[2]]))},i(a){r||(C(i,a),r=!0)},o(a){E(i,a),r=!1},d(a){a&&k(e),i&&i.d(a),l[8](null),t=!1,n()}}}function Ki(l){let e;const r=l[7].default,t=be(r,l,l[6],Sn);return{c(){t&&t.c()},l(n){t&&t.l(n)},m(n,o){t&&t.m(n,o),e=!0},p(n,o){t&&t.p&&(!e||o&68)&&ve(t,r,n,n[6],e?ke(r,n[6],o,Zi):we(n[6]),Sn)},i(n){e||(C(t,n),e=!0)},o(n){E(t,n),e=!1},d(n){t&&t.d(n)}}}function Qi(l){let e,r,t,n;const o=[Ki,Ji],i=[];function c(s,a){return s[1]?0:1}return e=c(l),r=i[e]=o[e](l),{c(){r.c(),t=ne()},l(s){r.l(s),t=ne()},m(s,a){i[e].m(s,a),U(s,t,a),n=!0},p(s,[a]){let u=e;e=c(s),e===u?i[e].p(s,a):(de(),E(i[u],1,1,()=>{i[u]=null}),he(),r=i[e],r?r.p(s,a):(r=i[e]=o[e](s),r.c()),C(r,1),r.m(t.parentNode,t))},i(s){n||(C(r),n=!0)},o(s){E(r),n=!1},d(s){s&&k(t),i[e].d(s)}}}function xi(l,e,r){let t,n;const o=["asChild","el"];let i=Te(e,o),c,{$$slots:s={},$$scope:a}=e,{asChild:u=!1}=e,{el:f=void 0}=e;const{elements:{content:g},getAttrs:d}=zt();re(l,g,_=>r(5,c=_));const b=d("content");function h(_){Ue[_?"unshift":"push"](()=>{f=_,r(0,f)})}return l.$$set=_=>{e=ee(ee({},e),$e(_)),r(11,i=Te(e,o)),"asChild"in _&&r(1,u=_.asChild),"el"in _&&r(0,f=_.el),"$$scope"in _&&r(6,a=_.$$scope)},l.$$.update=()=>{r(4,t={...i,...b}),l.$$.dirty&32&&r(2,n=c),l.$$.dirty&20&&Object.assign(n,t)},[f,u,n,g,t,c,a,s,h]}class es extends ie{constructor(e){super(),se(this,e,xi,Qi,le,{asChild:1,el:0})}}const ts=l=>({builder:l&4}),$n=l=>({builder:l[2]}),rs=l=>({builder:l&4}),Mn=l=>({builder:l[2]});function ns(l){let e,r,t,n;const o=l[7].default,i=be(o,l,l[6],$n);let c=[l[2]],s={};for(let a=0;a<c.length;a+=1)s=ee(s,c[a]);return{c(){e=B("div"),i&&i.c(),this.h()},l(a){e=V(a,"DIV",{});var u=H(e);i&&i.l(u),u.forEach(k),this.h()},h(){Ne(e,s)},m(a,u){U(a,e,u),i&&i.m(e,null),l[8](e),r=!0,t||(n=tt(l[2].action(e)),t=!0)},p(a,u){i&&i.p&&(!r||u&68)&&ve(i,o,a,a[6],r?ke(o,a[6],u,ts):we(a[6]),$n),Ne(e,s=De(c,[u&4&&a[2]]))},i(a){r||(C(i,a),r=!0)},o(a){E(i,a),r=!1},d(a){a&&k(e),i&&i.d(a),l[8](null),t=!1,n()}}}function ls(l){let e;const r=l[7].default,t=be(r,l,l[6],Mn);return{c(){t&&t.c()},l(n){t&&t.l(n)},m(n,o){t&&t.m(n,o),e=!0},p(n,o){t&&t.p&&(!e||o&68)&&ve(t,r,n,n[6],e?ke(r,n[6],o,rs):we(n[6]),Mn)},i(n){e||(C(t,n),e=!0)},o(n){E(t,n),e=!1},d(n){t&&t.d(n)}}}function os(l){let e,r,t,n;const o=[ls,ns],i=[];function c(s,a){return s[1]?0:1}return e=c(l),r=i[e]=o[e](l),{c(){r.c(),t=ne()},l(s){r.l(s),t=ne()},m(s,a){i[e].m(s,a),U(s,t,a),n=!0},p(s,[a]){let u=e;e=c(s),e===u?i[e].p(s,a):(de(),E(i[u],1,1,()=>{i[u]=null}),he(),r=i[e],r?r.p(s,a):(r=i[e]=o[e](s),r.c()),C(r,1),r.m(t.parentNode,t))},i(s){n||(C(r),n=!0)},o(s){E(r),n=!1},d(s){s&&k(t),i[e].d(s)}}}function is(l,e,r){let t,n;const o=["asChild","el"];let i=Te(e,o),c,{$$slots:s={},$$scope:a}=e,{asChild:u=!1}=e,{el:f=void 0}=e;const{elements:{scrollbarY:g},getAttrs:d}=zt();re(l,g,_=>r(5,c=_));const b=d("scrollbar-y");function h(_){Ue[_?"unshift":"push"](()=>{f=_,r(0,f)})}return l.$$set=_=>{e=ee(ee({},e),$e(_)),r(11,i=Te(e,o)),"asChild"in _&&r(1,u=_.asChild),"el"in _&&r(0,f=_.el),"$$scope"in _&&r(6,a=_.$$scope)},l.$$.update=()=>{r(4,t={...i,...b}),l.$$.dirty&32&&r(2,n=c),l.$$.dirty&20&&Object.assign(n,t)},[f,u,n,g,t,c,a,s,h]}class ss extends ie{constructor(e){super(),se(this,e,is,os,le,{asChild:1,el:0})}}const as=l=>({builder:l&4}),In=l=>({builder:l[2]}),cs=l=>({builder:l&4}),An=l=>({builder:l[2]});function us(l){let e,r,t,n;const o=l[7].default,i=be(o,l,l[6],In);let c=[l[2]],s={};for(let a=0;a<c.length;a+=1)s=ee(s,c[a]);return{c(){e=B("div"),i&&i.c(),this.h()},l(a){e=V(a,"DIV",{});var u=H(e);i&&i.l(u),u.forEach(k),this.h()},h(){Ne(e,s)},m(a,u){U(a,e,u),i&&i.m(e,null),l[8](e),r=!0,t||(n=tt(l[2].action(e)),t=!0)},p(a,u){i&&i.p&&(!r||u&68)&&ve(i,o,a,a[6],r?ke(o,a[6],u,as):we(a[6]),In),Ne(e,s=De(c,[u&4&&a[2]]))},i(a){r||(C(i,a),r=!0)},o(a){E(i,a),r=!1},d(a){a&&k(e),i&&i.d(a),l[8](null),t=!1,n()}}}function fs(l){let e;const r=l[7].default,t=be(r,l,l[6],An);return{c(){t&&t.c()},l(n){t&&t.l(n)},m(n,o){t&&t.m(n,o),e=!0},p(n,o){t&&t.p&&(!e||o&68)&&ve(t,r,n,n[6],e?ke(r,n[6],o,cs):we(n[6]),An)},i(n){e||(C(t,n),e=!0)},o(n){E(t,n),e=!1},d(n){t&&t.d(n)}}}function ds(l){let e,r,t,n;const o=[fs,us],i=[];function c(s,a){return s[1]?0:1}return e=c(l),r=i[e]=o[e](l),{c(){r.c(),t=ne()},l(s){r.l(s),t=ne()},m(s,a){i[e].m(s,a),U(s,t,a),n=!0},p(s,[a]){let u=e;e=c(s),e===u?i[e].p(s,a):(de(),E(i[u],1,1,()=>{i[u]=null}),he(),r=i[e],r?r.p(s,a):(r=i[e]=o[e](s),r.c()),C(r,1),r.m(t.parentNode,t))},i(s){n||(C(r),n=!0)},o(s){E(r),n=!1},d(s){s&&k(t),i[e].d(s)}}}function hs(l,e,r){let t,n;const o=["asChild","el"];let i=Te(e,o),c,{$$slots:s={},$$scope:a}=e,{asChild:u=!1}=e,{el:f=void 0}=e;const{elements:{scrollbarX:g},getAttrs:d}=zt();re(l,g,_=>r(5,c=_));const b=d("scrollbar-x");function h(_){Ue[_?"unshift":"push"](()=>{f=_,r(0,f)})}return l.$$set=_=>{e=ee(ee({},e),$e(_)),r(11,i=Te(e,o)),"asChild"in _&&r(1,u=_.asChild),"el"in _&&r(0,f=_.el),"$$scope"in _&&r(6,a=_.$$scope)},l.$$.update=()=>{r(4,t={...i,...b}),l.$$.dirty&32&&r(2,n=c),l.$$.dirty&20&&Object.assign(n,t)},[f,u,n,g,t,c,a,s,h]}class ms extends ie{constructor(e){super(),se(this,e,hs,ds,le,{asChild:1,el:0})}}const gs=l=>({builder:l&64}),Ln=l=>({builder:l[6]}),_s=l=>({builder:l&64}),Dn=l=>({builder:l[6]});function ps(l){let e,r;const t=[l[2]];let n={$$slots:{default:[vs,({builder:o})=>({6:o}),({builder:o})=>o?64:0]},$$scope:{ctx:l}};for(let o=0;o<t.length;o+=1)n=ee(n,t[o]);return e=new ms({props:n}),{c(){Y(e.$$.fragment)},l(o){Q(e.$$.fragment,o)},m(o,i){G(e,o,i),r=!0},p(o,i){const c=i&4?De(t,[rt(o[2])]):{};i&96&&(c.$$scope={dirty:i,ctx:o}),e.$set(c)},i(o){r||(C(e.$$.fragment,o),r=!0)},o(o){E(e.$$.fragment,o),r=!1},d(o){j(e,o)}}}function bs(l){let e,r;const t=[l[2]];let n={$$slots:{default:[ws,({builder:o})=>({6:o}),({builder:o})=>o?64:0]},$$scope:{ctx:l}};for(let o=0;o<t.length;o+=1)n=ee(n,t[o]);return e=new ss({props:n}),{c(){Y(e.$$.fragment)},l(o){Q(e.$$.fragment,o)},m(o,i){G(e,o,i),r=!0},p(o,i){const c=i&4?De(t,[rt(o[2])]):{};i&96&&(c.$$scope={dirty:i,ctx:o}),e.$set(c)},i(o){r||(C(e.$$.fragment,o),r=!0)},o(o){E(e.$$.fragment,o),r=!1},d(o){j(e,o)}}}function vs(l){let e;const r=l[4].default,t=be(r,l,l[5],Ln);return{c(){t&&t.c()},l(n){t&&t.l(n)},m(n,o){t&&t.m(n,o),e=!0},p(n,o){t&&t.p&&(!e||o&96)&&ve(t,r,n,n[5],e?ke(r,n[5],o,gs):we(n[5]),Ln)},i(n){e||(C(t,n),e=!0)},o(n){E(t,n),e=!1},d(n){t&&t.d(n)}}}function ws(l){let e;const r=l[4].default,t=be(r,l,l[5],Dn);return{c(){t&&t.c()},l(n){t&&t.l(n)},m(n,o){t&&t.m(n,o),e=!0},p(n,o){t&&t.p&&(!e||o&96)&&ve(t,r,n,n[5],e?ke(r,n[5],o,_s):we(n[5]),Dn)},i(n){e||(C(t,n),e=!0)},o(n){E(t,n),e=!1},d(n){t&&t.d(n)}}}function ks(l){let e,r,t,n;const o=[bs,ps],i=[];function c(s,a){return s[0]==="vertical"?0:1}return e=c(l),r=i[e]=o[e](l),{c(){r.c(),t=ne()},l(s){r.l(s),t=ne()},m(s,a){i[e].m(s,a),U(s,t,a),n=!0},p(s,[a]){let u=e;e=c(s),e===u?i[e].p(s,a):(de(),E(i[u],1,1,()=>{i[u]=null}),he(),r=i[e],r?r.p(s,a):(r=i[e]=o[e](s),r.c()),C(r,1),r.m(t.parentNode,t))},i(s){n||(C(r),n=!0)},o(s){E(r),n=!1},d(s){s&&k(t),i[e].d(s)}}}function ys(l,e,r){const t=["orientation"];let n=Te(e,t),o,{$$slots:i={},$$scope:c}=e,{orientation:s}=e;const a=Ve(s);return re(l,a,u=>r(0,o=u)),Di(a),l.$$set=u=>{e=ee(ee({},e),$e(u)),r(2,n=Te(e,t)),"orientation"in u&&r(3,s=u.orientation),"$$scope"in u&&r(5,c=u.$$scope)},l.$$.update=()=>{l.$$.dirty&8&&a.set(s)},[o,a,n,s,i,c]}let Ts=class extends ie{constructor(e){super(),se(this,e,ys,ks,le,{orientation:3})}};const Cs=l=>({builder:l&4}),Pn=l=>({builder:l[2]}),Es=l=>({builder:l&4}),On=l=>({builder:l[2]});function Ss(l){let e,r,t,n;const o=l[7].default,i=be(o,l,l[6],Pn);let c=[l[2]],s={};for(let a=0;a<c.length;a+=1)s=ee(s,c[a]);return{c(){e=B("div"),i&&i.c(),this.h()},l(a){e=V(a,"DIV",{});var u=H(e);i&&i.l(u),u.forEach(k),this.h()},h(){Ne(e,s)},m(a,u){U(a,e,u),i&&i.m(e,null),l[8](e),r=!0,t||(n=tt(l[2].action(e)),t=!0)},p(a,u){i&&i.p&&(!r||u&68)&&ve(i,o,a,a[6],r?ke(o,a[6],u,Cs):we(a[6]),Pn),Ne(e,s=De(c,[u&4&&a[2]]))},i(a){r||(C(i,a),r=!0)},o(a){E(i,a),r=!1},d(a){a&&k(e),i&&i.d(a),l[8](null),t=!1,n()}}}function $s(l){let e;const r=l[7].default,t=be(r,l,l[6],On);return{c(){t&&t.c()},l(n){t&&t.l(n)},m(n,o){t&&t.m(n,o),e=!0},p(n,o){t&&t.p&&(!e||o&68)&&ve(t,r,n,n[6],e?ke(r,n[6],o,Es):we(n[6]),On)},i(n){e||(C(t,n),e=!0)},o(n){E(t,n),e=!1},d(n){t&&t.d(n)}}}function Ms(l){let e,r,t,n;const o=[$s,Ss],i=[];function c(s,a){return s[1]?0:1}return e=c(l),r=i[e]=o[e](l),{c(){r.c(),t=ne()},l(s){r.l(s),t=ne()},m(s,a){i[e].m(s,a),U(s,t,a),n=!0},p(s,[a]){let u=e;e=c(s),e===u?i[e].p(s,a):(de(),E(i[u],1,1,()=>{i[u]=null}),he(),r=i[e],r?r.p(s,a):(r=i[e]=o[e](s),r.c()),C(r,1),r.m(t.parentNode,t))},i(s){n||(C(r),n=!0)},o(s){E(r),n=!1},d(s){s&&k(t),i[e].d(s)}}}function Is(l,e,r){let t,n;const o=["asChild","el"];let i=Te(e,o),c,{$$slots:s={},$$scope:a}=e,{asChild:u=!1}=e,{el:f=void 0}=e;const{elements:{thumbY:g},getAttrs:d}=zt();re(l,g,_=>r(5,c=_));const b=d("thumb-y");function h(_){Ue[_?"unshift":"push"](()=>{f=_,r(0,f)})}return l.$$set=_=>{e=ee(ee({},e),$e(_)),r(11,i=Te(e,o)),"asChild"in _&&r(1,u=_.asChild),"el"in _&&r(0,f=_.el),"$$scope"in _&&r(6,a=_.$$scope)},l.$$.update=()=>{r(4,t={...i,...b}),l.$$.dirty&32&&r(2,n=c),l.$$.dirty&20&&Object.assign(n,t)},[f,u,n,g,t,c,a,s,h]}class As extends ie{constructor(e){super(),se(this,e,Is,Ms,le,{asChild:1,el:0})}}const Ls=l=>({builder:l&4}),Nn=l=>({builder:l[2]}),Ds=l=>({builder:l&4}),zn=l=>({builder:l[2]});function Ps(l){let e,r,t,n;const o=l[7].default,i=be(o,l,l[6],Nn);let c=[l[2]],s={};for(let a=0;a<c.length;a+=1)s=ee(s,c[a]);return{c(){e=B("div"),i&&i.c(),this.h()},l(a){e=V(a,"DIV",{});var u=H(e);i&&i.l(u),u.forEach(k),this.h()},h(){Ne(e,s)},m(a,u){U(a,e,u),i&&i.m(e,null),l[8](e),r=!0,t||(n=tt(l[2].action(e)),t=!0)},p(a,u){i&&i.p&&(!r||u&68)&&ve(i,o,a,a[6],r?ke(o,a[6],u,Ls):we(a[6]),Nn),Ne(e,s=De(c,[u&4&&a[2]]))},i(a){r||(C(i,a),r=!0)},o(a){E(i,a),r=!1},d(a){a&&k(e),i&&i.d(a),l[8](null),t=!1,n()}}}function Os(l){let e;const r=l[7].default,t=be(r,l,l[6],zn);return{c(){t&&t.c()},l(n){t&&t.l(n)},m(n,o){t&&t.m(n,o),e=!0},p(n,o){t&&t.p&&(!e||o&68)&&ve(t,r,n,n[6],e?ke(r,n[6],o,Ds):we(n[6]),zn)},i(n){e||(C(t,n),e=!0)},o(n){E(t,n),e=!1},d(n){t&&t.d(n)}}}function Ns(l){let e,r,t,n;const o=[Os,Ps],i=[];function c(s,a){return s[1]?0:1}return e=c(l),r=i[e]=o[e](l),{c(){r.c(),t=ne()},l(s){r.l(s),t=ne()},m(s,a){i[e].m(s,a),U(s,t,a),n=!0},p(s,[a]){let u=e;e=c(s),e===u?i[e].p(s,a):(de(),E(i[u],1,1,()=>{i[u]=null}),he(),r=i[e],r?r.p(s,a):(r=i[e]=o[e](s),r.c()),C(r,1),r.m(t.parentNode,t))},i(s){n||(C(r),n=!0)},o(s){E(r),n=!1},d(s){s&&k(t),i[e].d(s)}}}function zs(l,e,r){let t,n;const o=["asChild","el"];let i=Te(e,o),c,{$$slots:s={},$$scope:a}=e,{asChild:u=!1}=e,{el:f=void 0}=e;const{elements:{thumbX:g},getAttrs:d}=zt();re(l,g,_=>r(5,c=_));const b=d("thumb-x");function h(_){Ue[_?"unshift":"push"](()=>{f=_,r(0,f)})}return l.$$set=_=>{e=ee(ee({},e),$e(_)),r(11,i=Te(e,o)),"asChild"in _&&r(1,u=_.asChild),"el"in _&&r(0,f=_.el),"$$scope"in _&&r(6,a=_.$$scope)},l.$$.update=()=>{r(4,t={...i,...b}),l.$$.dirty&32&&r(2,n=c),l.$$.dirty&20&&Object.assign(n,t)},[f,u,n,g,t,c,a,s,h]}class Vs extends ie{constructor(e){super(),se(this,e,zs,Ns,le,{asChild:1,el:0})}}const Bs=l=>({builder:l&32}),Vn=l=>({builder:l[5]}),Fs=l=>({builder:l&32}),Bn=l=>({builder:l[5]});function Us(l){let e,r;const t=[l[2]];let n={$$slots:{default:[Hs,({builder:o})=>({5:o}),({builder:o})=>o?32:0]},$$scope:{ctx:l}};for(let o=0;o<t.length;o+=1)n=ee(n,t[o]);return e=new Vs({props:n}),{c(){Y(e.$$.fragment)},l(o){Q(e.$$.fragment,o)},m(o,i){G(e,o,i),r=!0},p(o,i){const c=i&4?De(t,[rt(o[2])]):{};i&48&&(c.$$scope={dirty:i,ctx:o}),e.$set(c)},i(o){r||(C(e.$$.fragment,o),r=!0)},o(o){E(e.$$.fragment,o),r=!1},d(o){j(e,o)}}}function Rs(l){let e,r;const t=[l[2]];let n={$$slots:{default:[qs,({builder:o})=>({5:o}),({builder:o})=>o?32:0]},$$scope:{ctx:l}};for(let o=0;o<t.length;o+=1)n=ee(n,t[o]);return e=new As({props:n}),{c(){Y(e.$$.fragment)},l(o){Q(e.$$.fragment,o)},m(o,i){G(e,o,i),r=!0},p(o,i){const c=i&4?De(t,[rt(o[2])]):{};i&48&&(c.$$scope={dirty:i,ctx:o}),e.$set(c)},i(o){r||(C(e.$$.fragment,o),r=!0)},o(o){E(e.$$.fragment,o),r=!1},d(o){j(e,o)}}}function Hs(l){let e;const r=l[3].default,t=be(r,l,l[4],Vn);return{c(){t&&t.c()},l(n){t&&t.l(n)},m(n,o){t&&t.m(n,o),e=!0},p(n,o){t&&t.p&&(!e||o&48)&&ve(t,r,n,n[4],e?ke(r,n[4],o,Bs):we(n[4]),Vn)},i(n){e||(C(t,n),e=!0)},o(n){E(t,n),e=!1},d(n){t&&t.d(n)}}}function qs(l){let e;const r=l[3].default,t=be(r,l,l[4],Bn);return{c(){t&&t.c()},l(n){t&&t.l(n)},m(n,o){t&&t.m(n,o),e=!0},p(n,o){t&&t.p&&(!e||o&48)&&ve(t,r,n,n[4],e?ke(r,n[4],o,Fs):we(n[4]),Bn)},i(n){e||(C(t,n),e=!0)},o(n){E(t,n),e=!1},d(n){t&&t.d(n)}}}function Ws(l){let e,r,t,n;const o=[Rs,Us],i=[];function c(s,a){return s[0]==="vertical"?0:1}return e=c(l),r=i[e]=o[e](l),{c(){r.c(),t=ne()},l(s){r.l(s),t=ne()},m(s,a){i[e].m(s,a),U(s,t,a),n=!0},p(s,[a]){let u=e;e=c(s),e===u?i[e].p(s,a):(de(),E(i[u],1,1,()=>{i[u]=null}),he(),r=i[e],r?r.p(s,a):(r=i[e]=o[e](s),r.c()),C(r,1),r.m(t.parentNode,t))},i(s){n||(C(r),n=!0)},o(s){E(r),n=!1},d(s){s&&k(t),i[e].d(s)}}}function js(l,e,r){const t=[];let n=Te(e,t),o,{$$slots:i={},$$scope:c}=e;const s=Pi();return re(l,s,a=>r(0,o=a)),l.$$set=a=>{e=ee(ee({},e),$e(a)),r(2,n=Te(e,t)),"$$scope"in a&&r(4,c=a.$$scope)},[o,s,n,i,c]}class Gs extends ie{constructor(e){super(),se(this,e,js,Ws,le,{})}}const Ys=l=>({builder:l&4}),Fn=l=>({builder:l[2]}),Xs=l=>({builder:l&4}),Un=l=>({builder:l[2]});function Zs(l){let e,r,t,n;const o=l[7].default,i=be(o,l,l[6],Fn);let c=[l[2]],s={};for(let a=0;a<c.length;a+=1)s=ee(s,c[a]);return{c(){e=B("div"),i&&i.c(),this.h()},l(a){e=V(a,"DIV",{});var u=H(e);i&&i.l(u),u.forEach(k),this.h()},h(){Ne(e,s)},m(a,u){U(a,e,u),i&&i.m(e,null),l[8](e),r=!0,t||(n=tt(l[2].action(e)),t=!0)},p(a,u){i&&i.p&&(!r||u&68)&&ve(i,o,a,a[6],r?ke(o,a[6],u,Ys):we(a[6]),Fn),Ne(e,s=De(c,[u&4&&a[2]]))},i(a){r||(C(i,a),r=!0)},o(a){E(i,a),r=!1},d(a){a&&k(e),i&&i.d(a),l[8](null),t=!1,n()}}}function Js(l){let e;const r=l[7].default,t=be(r,l,l[6],Un);return{c(){t&&t.c()},l(n){t&&t.l(n)},m(n,o){t&&t.m(n,o),e=!0},p(n,o){t&&t.p&&(!e||o&68)&&ve(t,r,n,n[6],e?ke(r,n[6],o,Xs):we(n[6]),Un)},i(n){e||(C(t,n),e=!0)},o(n){E(t,n),e=!1},d(n){t&&t.d(n)}}}function Ks(l){let e,r,t,n;const o=[Js,Zs],i=[];function c(s,a){return s[1]?0:1}return e=c(l),r=i[e]=o[e](l),{c(){r.c(),t=ne()},l(s){r.l(s),t=ne()},m(s,a){i[e].m(s,a),U(s,t,a),n=!0},p(s,[a]){let u=e;e=c(s),e===u?i[e].p(s,a):(de(),E(i[u],1,1,()=>{i[u]=null}),he(),r=i[e],r?r.p(s,a):(r=i[e]=o[e](s),r.c()),C(r,1),r.m(t.parentNode,t))},i(s){n||(C(r),n=!0)},o(s){E(r),n=!1},d(s){s&&k(t),i[e].d(s)}}}function Qs(l,e,r){let t,n;const o=["asChild","el"];let i=Te(e,o),c,{$$slots:s={},$$scope:a}=e,{asChild:u=!1}=e,{el:f=void 0}=e;const{elements:{corner:g},getAttrs:d}=zt();re(l,g,_=>r(5,c=_));const b=d("corner");function h(_){Ue[_?"unshift":"push"](()=>{f=_,r(0,f)})}return l.$$set=_=>{e=ee(ee({},e),$e(_)),r(11,i=Te(e,o)),"asChild"in _&&r(1,u=_.asChild),"el"in _&&r(0,f=_.el),"$$scope"in _&&r(6,a=_.$$scope)},l.$$.update=()=>{r(4,t={...i,...b}),l.$$.dirty&32&&r(2,n=c),l.$$.dirty&20&&Object.assign(n,t)},[f,u,n,g,t,c,a,s,h]}class xs extends ie{constructor(e){super(),se(this,e,Qs,Ks,le,{asChild:1,el:0})}}function oo(){return{NAME:"slider",PARTS:["root","input","range","thumb","tick"]}}function ea(l){const{NAME:e,PARTS:r}=oo(),t=Jl(e,r),n={...Ii(Yl(l)),getAttrs:t};return Er(e,n),{...n,updateOption:Xl(n.options)}}function io(){const{NAME:l}=oo();return Gt(l)}const ta=l=>({builder:l&4,ticks:l&8,thumbs:l&16}),Rn=l=>({builder:l[2],ticks:l[3],thumbs:l[4]}),ra=l=>({builder:l&4,ticks:l&8,thumbs:l&16}),Hn=l=>({builder:l[2],ticks:l[3],thumbs:l[4]});function na(l){let e,r,t,n;const o=l[19].default,i=be(o,l,l[18],Rn);let c=[l[2],l[8]],s={};for(let a=0;a<c.length;a+=1)s=ee(s,c[a]);return{c(){e=B("span"),i&&i.c(),this.h()},l(a){e=V(a,"SPAN",{});var u=H(e);i&&i.l(u),u.forEach(k),this.h()},h(){Ne(e,s)},m(a,u){U(a,e,u),i&&i.m(e,null),l[20](e),r=!0,t||(n=tt(l[2].action(e)),t=!0)},p(a,u){i&&i.p&&(!r||u&262172)&&ve(i,o,a,a[18],r?ke(o,a[18],u,ta):we(a[18]),Rn),Ne(e,s=De(c,[u&4&&a[2],u&256&&a[8]]))},i(a){r||(C(i,a),r=!0)},o(a){E(i,a),r=!1},d(a){a&&k(e),i&&i.d(a),l[20](null),t=!1,n()}}}function la(l){let e;const r=l[19].default,t=be(r,l,l[18],Hn);return{c(){t&&t.c()},l(n){t&&t.l(n)},m(n,o){t&&t.m(n,o),e=!0},p(n,o){t&&t.p&&(!e||o&262172)&&ve(t,r,n,n[18],e?ke(r,n[18],o,ra):we(n[18]),Hn)},i(n){e||(C(t,n),e=!0)},o(n){E(t,n),e=!1},d(n){t&&t.d(n)}}}function oa(l){let e,r,t,n;const o=[la,na],i=[];function c(s,a){return s[1]?0:1}return e=c(l),r=i[e]=o[e](l),{c(){r.c(),t=ne()},l(s){r.l(s),t=ne()},m(s,a){i[e].m(s,a),U(s,t,a),n=!0},p(s,[a]){let u=e;e=c(s),e===u?i[e].p(s,a):(de(),E(i[u],1,1,()=>{i[u]=null}),he(),r=i[e],r?r.p(s,a):(r=i[e]=o[e](s),r.c()),C(r,1),r.m(t.parentNode,t))},i(s){n||(C(r),n=!0)},o(s){E(r),n=!1},d(s){s&&k(t),i[e].d(s)}}}function ia(l,e,r){let t;const n=["disabled","min","max","step","orientation","dir","value","onValueChange","asChild","el"];let o=Te(e,n),i,c,s,{$$slots:a={},$$scope:u}=e,{disabled:f=void 0}=e,{min:g=void 0}=e,{max:d=void 0}=e,{step:b=void 0}=e,{orientation:h=void 0}=e,{dir:_=void 0}=e,{value:y=void 0}=e,{onValueChange:M=void 0}=e,{asChild:$=!1}=e,{el:T=void 0}=e;const{elements:{root:S,ticks:p,thumbs:m},states:{value:w},updateOption:v,getAttrs:A}=ea({disabled:f,dir:_,min:g,max:d,step:b,orientation:h,defaultValue:y,onValueChange:({next:L})=>(y!==L&&(M?.(L),r(9,y=L)),L)});re(l,S,L=>r(17,i=L)),re(l,p,L=>r(3,c=L)),re(l,m,L=>r(4,s=L));const P=A("root");function O(L){Ue[L?"unshift":"push"](()=>{T=L,r(0,T)})}return l.$$set=L=>{e=ee(ee({},e),$e(L)),r(8,o=Te(e,n)),"disabled"in L&&r(10,f=L.disabled),"min"in L&&r(11,g=L.min),"max"in L&&r(12,d=L.max),"step"in L&&r(13,b=L.step),"orientation"in L&&r(14,h=L.orientation),"dir"in L&&r(15,_=L.dir),"value"in L&&r(9,y=L.value),"onValueChange"in L&&r(16,M=L.onValueChange),"asChild"in L&&r(1,$=L.asChild),"el"in L&&r(0,T=L.el),"$$scope"in L&&r(18,u=L.$$scope)},l.$$.update=()=>{l.$$.dirty&512&&y!==void 0&&w.set(y),l.$$.dirty&1024&&v("disabled",f),l.$$.dirty&2048&&v("min",g),l.$$.dirty&4096&&v("max",d),l.$$.dirty&8192&&v("step",b),l.$$.dirty&16384&&v("orientation",h),l.$$.dirty&32768&&v("dir",_),l.$$.dirty&131072&&r(2,t=i),l.$$.dirty&4&&Object.assign(t,P)},[T,$,t,c,s,S,p,m,o,y,f,g,d,b,h,_,M,i,u,a,O]}let sa=class extends ie{constructor(e){super(),se(this,e,ia,oa,le,{disabled:10,min:11,max:12,step:13,orientation:14,dir:15,value:9,onValueChange:16,asChild:1,el:0})}};const aa=l=>({builder:l&4}),qn=l=>({builder:l[2]});function ca(l){let e,r,t,n=[l[2],l[4]],o={};for(let i=0;i<n.length;i+=1)o=ee(o,n[i]);return{c(){e=B("span"),this.h()},l(i){e=V(i,"SPAN",{}),H(e).forEach(k),this.h()},h(){Ne(e,o)},m(i,c){U(i,e,c),l[8](e),r||(t=tt(l[2].action(e)),r=!0)},p(i,c){Ne(e,o=De(n,[c&4&&i[2],c&16&&i[4]]))},i:Ee,o:Ee,d(i){i&&k(e),l[8](null),r=!1,t()}}}function ua(l){let e;const r=l[7].default,t=be(r,l,l[6],qn);return{c(){t&&t.c()},l(n){t&&t.l(n)},m(n,o){t&&t.m(n,o),e=!0},p(n,o){t&&t.p&&(!e||o&68)&&ve(t,r,n,n[6],e?ke(r,n[6],o,aa):we(n[6]),qn)},i(n){e||(C(t,n),e=!0)},o(n){E(t,n),e=!1},d(n){t&&t.d(n)}}}function fa(l){let e,r,t,n;const o=[ua,ca],i=[];function c(s,a){return s[1]?0:1}return e=c(l),r=i[e]=o[e](l),{c(){r.c(),t=ne()},l(s){r.l(s),t=ne()},m(s,a){i[e].m(s,a),U(s,t,a),n=!0},p(s,[a]){let u=e;e=c(s),e===u?i[e].p(s,a):(de(),E(i[u],1,1,()=>{i[u]=null}),he(),r=i[e],r?r.p(s,a):(r=i[e]=o[e](s),r.c()),C(r,1),r.m(t.parentNode,t))},i(s){n||(C(r),n=!0)},o(s){E(r),n=!1},d(s){s&&k(t),i[e].d(s)}}}function da(l,e,r){let t;const n=["asChild","el"];let o=Te(e,n),i,{$$slots:c={},$$scope:s}=e,{asChild:a=!1}=e,{el:u=void 0}=e;const{elements:{range:f},getAttrs:g}=io();re(l,f,h=>r(5,i=h));const d=g("range");function b(h){Ue[h?"unshift":"push"](()=>{u=h,r(0,u)})}return l.$$set=h=>{e=ee(ee({},e),$e(h)),r(4,o=Te(e,n)),"asChild"in h&&r(1,a=h.asChild),"el"in h&&r(0,u=h.el),"$$scope"in h&&r(6,s=h.$$scope)},l.$$.update=()=>{l.$$.dirty&32&&r(2,t=i),l.$$.dirty&4&&Object.assign(t,d)},[u,a,t,f,o,i,s,c,b]}class ha extends ie{constructor(e){super(),se(this,e,da,fa,le,{asChild:1,el:0})}}const ma=l=>({builder:l&4}),Wn=l=>({builder:l[2]});function ga(l){let e,r,t,n=[l[2],l[4]],o={};for(let i=0;i<n.length;i+=1)o=ee(o,n[i]);return{c(){e=B("span"),this.h()},l(i){e=V(i,"SPAN",{}),H(e).forEach(k),this.h()},h(){Ne(e,o)},m(i,c){U(i,e,c),l[8](e),r||(t=[tt(l[2].action(e)),Se(e,"m-keydown",l[3])],r=!0)},p(i,c){Ne(e,o=De(n,[c&4&&i[2],c&16&&i[4]]))},i:Ee,o:Ee,d(i){i&&k(e),l[8](null),r=!1,vt(t)}}}function _a(l){let e;const r=l[7].default,t=be(r,l,l[6],Wn);return{c(){t&&t.c()},l(n){t&&t.l(n)},m(n,o){t&&t.m(n,o),e=!0},p(n,o){t&&t.p&&(!e||o&68)&&ve(t,r,n,n[6],e?ke(r,n[6],o,ma):we(n[6]),Wn)},i(n){e||(C(t,n),e=!0)},o(n){E(t,n),e=!1},d(n){t&&t.d(n)}}}function pa(l){let e,r,t,n;const o=[_a,ga],i=[];function c(s,a){return s[1]?0:1}return e=c(l),r=i[e]=o[e](l),{c(){r.c(),t=ne()},l(s){r.l(s),t=ne()},m(s,a){i[e].m(s,a),U(s,t,a),n=!0},p(s,[a]){let u=e;e=c(s),e===u?i[e].p(s,a):(de(),E(i[u],1,1,()=>{i[u]=null}),he(),r=i[e],r?r.p(s,a):(r=i[e]=o[e](s),r.c()),C(r,1),r.m(t.parentNode,t))},i(s){n||(C(r),n=!0)},o(s){E(r),n=!1},d(s){s&&k(t),i[e].d(s)}}}function ba(l,e,r){let t;const n=["asChild","el","thumb"];let o=Te(e,n),{$$slots:i={},$$scope:c}=e,{asChild:s=!1}=e,{el:a=void 0}=e,{thumb:u}=e;const{getAttrs:f}=io(),g=So(),d=f("thumb");function b(h){Ue[h?"unshift":"push"](()=>{a=h,r(0,a)})}return l.$$set=h=>{e=ee(ee({},e),$e(h)),r(4,o=Te(e,n)),"asChild"in h&&r(1,s=h.asChild),"el"in h&&r(0,a=h.el),"thumb"in h&&r(5,u=h.thumb),"$$scope"in h&&r(6,c=h.$$scope)},l.$$.update=()=>{l.$$.dirty&32&&r(2,t=u),l.$$.dirty&4&&Object.assign(t,d)},[a,s,t,g,o,u,c,i,b]}class va extends ie{constructor(e){super(),se(this,e,ba,pa,le,{asChild:1,el:0,thumb:5})}}const wa=l=>({builder:l&4}),jn=l=>({builder:l[2]}),ka=l=>({builder:l&4}),Gn=l=>({builder:l[2]});function ya(l){let e,r,t,n;const o=l[8].default,i=be(o,l,l[7],jn);let c=[l[2],l[4]],s={};for(let a=0;a<c.length;a+=1)s=ee(s,c[a]);return{c(){e=B("div"),i&&i.c(),this.h()},l(a){e=V(a,"DIV",{});var u=H(e);i&&i.l(u),u.forEach(k),this.h()},h(){Ne(e,s)},m(a,u){U(a,e,u),i&&i.m(e,null),l[9](e),r=!0,t||(n=tt(l[2].action(e)),t=!0)},p(a,u){i&&i.p&&(!r||u&132)&&ve(i,o,a,a[7],r?ke(o,a[7],u,wa):we(a[7]),jn),Ne(e,s=De(c,[u&4&&a[2],u&16&&a[4]]))},i(a){r||(C(i,a),r=!0)},o(a){E(i,a),r=!1},d(a){a&&k(e),i&&i.d(a),l[9](null),t=!1,n()}}}function Ta(l){let e;const r=l[8].default,t=be(r,l,l[7],Gn);return{c(){t&&t.c()},l(n){t&&t.l(n)},m(n,o){t&&t.m(n,o),e=!0},p(n,o){t&&t.p&&(!e||o&132)&&ve(t,r,n,n[7],e?ke(r,n[7],o,ka):we(n[7]),Gn)},i(n){e||(C(t,n),e=!0)},o(n){E(t,n),e=!1},d(n){t&&t.d(n)}}}function Ca(l){let e,r,t,n;const o=[Ta,ya],i=[];function c(s,a){return s[1]?0:1}return e=c(l),r=i[e]=o[e](l),{c(){r.c(),t=ne()},l(s){r.l(s),t=ne()},m(s,a){i[e].m(s,a),U(s,t,a),n=!0},p(s,[a]){let u=e;e=c(s),e===u?i[e].p(s,a):(de(),E(i[u],1,1,()=>{i[u]=null}),he(),r=i[e],r?r.p(s,a):(r=i[e]=o[e](s),r.c()),C(r,1),r.m(t.parentNode,t))},i(s){n||(C(r),n=!0)},o(s){E(r),n=!1},d(s){s&&k(t),i[e].d(s)}}}function Ea(l,e,r){let t;const n=["value","asChild","el"];let o=Te(e,n),i,{$$slots:c={},$$scope:s}=e,{value:a}=e,{asChild:u=!1}=e,{el:f=void 0}=e;const{elements:{content:g},getAttrs:d}=$o();re(l,g,_=>r(6,i=_));const b=d("content");function h(_){Ue[_?"unshift":"push"](()=>{f=_,r(0,f)})}return l.$$set=_=>{e=ee(ee({},e),$e(_)),r(4,o=Te(e,n)),"value"in _&&r(5,a=_.value),"asChild"in _&&r(1,u=_.asChild),"el"in _&&r(0,f=_.el),"$$scope"in _&&r(7,s=_.$$scope)},l.$$.update=()=>{l.$$.dirty&96&&r(2,t=i(a)),l.$$.dirty&4&&Object.assign(t,b)},[f,u,t,g,o,a,i,s,c,h]}let Sa=class extends ie{constructor(e){super(),se(this,e,Ea,Ca,le,{value:5,asChild:1,el:0})}};function $a(l){let e;const r=l[3].default,t=be(r,l,l[4],null);return{c(){t&&t.c()},l(n){t&&t.l(n)},m(n,o){t&&t.m(n,o),e=!0},p(n,o){t&&t.p&&(!e||o&16)&&ve(t,r,n,n[4],e?ke(r,n[4],o,null):we(n[4]),null)},i(n){e||(C(t,n),e=!0)},o(n){E(t,n),e=!1},d(n){t&&t.d(n)}}}function Ma(l){let e,r;const t=[{class:ht("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",l[0])},{value:l[1]},l[2]];let n={$$slots:{default:[$a]},$$scope:{ctx:l}};for(let o=0;o<t.length;o+=1)n=ee(n,t[o]);return e=new Sa({props:n}),{c(){Y(e.$$.fragment)},l(o){Q(e.$$.fragment,o)},m(o,i){G(e,o,i),r=!0},p(o,[i]){const c=i&7?De(t,[i&1&&{class:ht("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",o[0])},i&2&&{value:o[1]},i&4&&rt(o[2])]):{};i&16&&(c.$$scope={dirty:i,ctx:o}),e.$set(c)},i(o){r||(C(e.$$.fragment,o),r=!0)},o(o){E(e.$$.fragment,o),r=!1},d(o){j(e,o)}}}function Ia(l,e,r){const t=["class","value"];let n=Te(e,t),{$$slots:o={},$$scope:i}=e,{class:c=void 0}=e,{value:s}=e;return l.$$set=a=>{e=ee(ee({},e),$e(a)),r(2,n=Te(e,t)),"class"in a&&r(0,c=a.class),"value"in a&&r(1,s=a.value),"$$scope"in a&&r(4,i=a.$$scope)},[c,s,n,o,i]}class Br extends ie{constructor(e){super(),se(this,e,Ia,Ma,le,{class:0,value:1})}}const Xr=Ve([]),ut=Ve({showMarkerMenu:!1,showVehicleMenu:!1}),Ht=Ve(!1),on=Ve(),Aa=Ve(!1),jt=Ve(!1),it=Ve([]),ot=Ve([]),La=!1,lt={controls:{showMarkerMenu:!1,showVehicleMenu:!1},showEndTrailModal:!1,trailingButtonPressed:!1,crispVisibility:!1,drawingModeEnabled:!1,currentTrail:null,coordinateBuffer:[],unsavedCoordinates:[],unsavedTrails:[],historicalTrails:[],otherActiveTrails:[]};function Da(){ut.set(lt.controls),Ht.set(lt.showEndTrailModal),on.set(lt.trailingButtonPressed),Aa.set(lt.crispVisibility),jt.set(lt.drawingModeEnabled),st.set(lt.currentTrail),kr.set(lt.coordinateBuffer),Et.set(lt.unsavedCoordinates),Kt.set(lt.unsavedTrails),it.set(lt.historicalTrails),ot.set(lt.otherActiveTrails)}const Pa=async({url:l,fetch:e,depends:r})=>{Da();const t=l.searchParams.get("field");let n=null,o=null;return["field","vehicle","marker"].forEach(i=>{const c=l.searchParams.get(i);c&&(n=i,o=c)}),{field:t,type:n,id:o}},Dd=Object.freeze(Object.defineProperty({__proto__:null,load:Pa,prerender:La},Symbol.toStringTag,{value:"Module"})),so=Ve(null),Zr=Ve(null),Oa=Ve(!1);function Yn(l,e,r){const t=l.slice();return t[19]=e[r],t}function Xn(l){let e,r,t,n,o='<svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>',i,c,s='<svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"></path></svg>',a,u,f,g,d,b,h=dt(l[1]),_=[];for(let M=0;M<h.length;M+=1)_[M]=Zn(Yn(l,h,M));const y=M=>E(_[M],1,1,()=>{_[M]=null});return{c(){e=B("div"),r=B("div"),t=B("div"),n=B("button"),n.innerHTML=o,i=K(),c=B("button"),c.innerHTML=s,a=K(),u=B("div"),f=B("div");for(let M=0;M<_.length;M+=1)_[M].c();this.h()},l(M){e=V(M,"DIV",{class:!0});var $=H(e);r=V($,"DIV",{class:!0});var T=H(r);t=V(T,"DIV",{class:!0});var S=H(t);n=V(S,"BUTTON",{class:!0,"data-svelte-h":!0}),Ce(n)!=="svelte-13ooeyd"&&(n.innerHTML=o),i=J(S),c=V(S,"BUTTON",{class:!0,"data-svelte-h":!0}),Ce(c)!=="svelte-7ywqrw"&&(c.innerHTML=s),S.forEach(k),a=J(T),u=V(T,"DIV",{class:!0});var p=H(u);f=V(p,"DIV",{class:!0});var m=H(f);for(let w=0;w<_.length;w+=1)_[w].l(m);m.forEach(k),p.forEach(k),T.forEach(k),$.forEach(k),this.h()},h(){D(n,"class","flex items-center justify-center border-r border-gray-300 p-4 transition duration-200 hover:bg-green-300"),D(c,"class","flex items-center justify-center p-4 transition duration-200 hover:bg-red-300"),D(t,"class","grid grid-cols-2 bg-gray-200"),D(f,"class","grid-auto-flow grid-auto-columns grid gap-2 svelte-swoi0v"),D(u,"class","max-h-64 overflow-auto p-2"),D(r,"class","w-11/12 overflow-hidden rounded-lg border-2 border-gray-300 bg-white bg-opacity-90 text-black shadow-lg sm:w-1/2"),D(e,"class","fixed bottom-0 left-0 right-0 z-10 mb-8 flex justify-center")},m(M,$){U(M,e,$),I(e,r),I(r,t),I(t,n),I(t,i),I(t,c),I(r,a),I(r,u),I(u,f);for(let T=0;T<_.length;T+=1)_[T]&&_[T].m(f,null);g=!0,d||(b=[Se(n,"click",l[2]),Se(c,"click",l[3])],d=!0)},p(M,$){if($&18){h=dt(M[1]);let T;for(T=0;T<h.length;T+=1){const S=Yn(M,h,T);_[T]?(_[T].p(S,$),C(_[T],1)):(_[T]=Zn(S),_[T].c(),C(_[T],1),_[T].m(f,null))}for(de(),T=h.length;T<_.length;T+=1)y(T);he()}},i(M){if(!g){for(let $=0;$<h.length;$+=1)C(_[$]);g=!0}},o(M){_=_.filter(Boolean);for(let $=0;$<_.length;$+=1)E(_[$]);g=!1},d(M){M&&k(e),nr(_,M),d=!1,vt(b)}}}function Na(l){let e;return{c(){e=B("i"),this.h()},l(r){e=V(r,"I",{class:!0}),H(e).forEach(k),this.h()},h(){D(e,"class",Wr(`${l[19].class} text-3xl text-gray-700`)+" svelte-swoi0v")},m(r,t){U(r,e,t)},p:Ee,i:Ee,o:Ee,d(r){r&&k(e)}}}function za(l){let e;return{c(){e=B("ion-icon"),this.h()},l(r){e=V(r,"ION-ICON",{name:!0,style:!0}),H(e).forEach(k),this.h()},h(){vo(e,"name",l[19].id),Ae(e,"font-size","32px")},m(r,t){U(r,e,t)},p:Ee,i:Ee,o:Ee,d(r){r&&k(e)}}}function Va(l){let e,r;return e=new Rl({props:{icon:l[19].id,size:"42px"}}),{c(){Y(e.$$.fragment)},l(t){Q(e.$$.fragment,t)},m(t,n){G(e,t,n),r=!0},p:Ee,i(t){r||(C(e.$$.fragment,t),r=!0)},o(t){E(e.$$.fragment,t),r=!1},d(t){j(e,t)}}}function Zn(l){let e,r,t,n,o,i,c,s;const a=[Va,za,Na],u=[];function f(d,b){return d[19].class.startsWith("custom-svg")?0:d[19].class.startsWith("ionic-")?1:2}t=f(l),n=u[t]=a[t](l);function g(){return l[7](l[19])}return{c(){e=B("button"),r=B("div"),n.c(),o=K(),this.h()},l(d){e=V(d,"BUTTON",{class:!0});var b=H(e);r=V(b,"DIV",{class:!0,style:!0});var h=H(r);n.l(h),h.forEach(k),o=J(b),b.forEach(k),this.h()},h(){D(r,"class","flex transform items-center justify-center rounded-lg bg-gray-200 p-3 transition duration-200 hover:scale-125 hover:bg-gray-300"),Ae(r,"width","50px"),Ae(r,"height","45px"),D(e,"class","marker-icon focus:outline-none svelte-swoi0v")},m(d,b){U(d,e,b),I(e,r),u[t].m(r,null),I(e,o),i=!0,c||(s=Se(e,"click",g),c=!0)},p(d,b){l=d,n.p(l,b)},i(d){i||(C(n),i=!0)},o(d){E(n),i=!1},d(d){d&&k(e),u[t].d(),c=!1,s()}}}function Ba(l){let e,r,t=l[0].showMarkerMenu&&Xn(l);return{c(){t&&t.c(),e=ne()},l(n){t&&t.l(n),e=ne()},m(n,o){t&&t.m(n,o),U(n,e,o),r=!0},p(n,[o]){n[0].showMarkerMenu?t?(t.p(n,o),o&1&&C(t,1)):(t=Xn(n),t.c(),C(t,1),t.m(e.parentNode,e)):t&&(de(),E(t,1,1,()=>{t=null}),he())},i(n){r||(C(t),r=!0)},o(n){E(t),r=!1},d(n){n&&k(e),t&&t.d(n)}}}function Jn(l,e){const r=new CustomEvent("handleUpdateMarkerListeners",{detail:{marker:l,id:e}});document.dispatchEvent(r)}function Fa(l,e,r){let t,n,o,i;re(l,Qe,p=>r(10,t=p)),re(l,Ut,p=>r(11,n=p)),re(l,qr,p=>r(12,o=p)),re(l,ut,p=>r(0,i=p));const{getMap:c}=Gt("map");let s,a;const u=[{id:"rock",class:"custom-svg"},{id:"tree13",class:"custom-svg"},{id:"watertank2",class:"custom-svg"},{id:"wheat2",class:"custom-svg"},{id:"kangaroo",class:"custom-svg"},{id:"electric_tower",class:"custom-svg"},{id:"gate",class:"custom-svg"},{id:"machine_pump",class:"custom-svg"},{id:"recharge_icon",class:"custom-svg"},{id:"repair_shop",class:"custom-svg"},{id:"tractor",class:"custom-svg"},{id:"silo2",class:"custom-svg"},{id:"tree_stump",class:"custom-svg"},{id:"workshop_icon",class:"custom-svg"},{id:"pin",class:"ionic-pin"},{id:"arrow-up-circle",class:"ionic-arrow-up-circle"},{id:"arrow-down-circle",class:"ionic-arrow-down-circle"},{id:"arrow-back-circle",class:"ionic-arrow-back-circle"},{id:"arrow-forward-circle",class:"ionic-arrow-forward-circle"},{id:"thumbs-down",class:"ionic-thumbs-down"},{id:"thumbs-up",class:"ionic-thumbs-up"},{id:"accessibility",class:"ionic-accessibility"},{id:"people",class:"ionic-people"},{id:"settings",class:"ionic-settings"},{id:"home",class:"ionic-home"},{id:"checkmark-circle",class:"ionic-checkmark-circle"},{id:"close-circle",class:"ionic-close-circle"},{id:"information-circle",class:"ionic-information-circle"},{id:"warning",class:"ionic-warning"},{id:"help-circle",class:"ionic-help-circle"},{id:"ban",class:"ionic-ban"},{id:"location",class:"ionic-location"},{id:"lock-closed",class:"ionic-lock-closed"},{id:"lock-open",class:"ionic-lock-open"},{id:"trash",class:"ionic-trash"},{id:"cart",class:"ionic-cart"},{id:"locate",class:"ionic-locate"},{id:"leaf",class:"ionic-leaf"},{id:"call",class:"ionic-call"},{id:"wifi",class:"ionic-wifi"},{id:"radio",class:"ionic-radio"},{id:"cloud-offline",class:"ionic-cloud-offline"},{id:"battery-charging",class:"ionic-battery-charging"},{id:"thermometer",class:"ionic-thermometer"},{id:"sunny",class:"ionic-sunny"},{id:"cloud",class:"ionic-cloud"},{id:"thunderstorm",class:"ionic-thunderstorm"},{id:"rainy",class:"ionic-rainy"},{id:"water",class:"ionic-water"},{id:"fast-food",class:"ionic-fast-food"},{id:"restaurant",class:"ionic-restaurant"},{id:"cart",class:"ionic-cart"},{id:"airplane",class:"ionic-airplane"},{id:"trail-sign",class:"ionic-trail-sign"},{id:"car",class:"ionic-car"},{id:"beer",class:"ionic-beer"},{id:"bonfire",class:"ionic-bonfire"},{id:"boat",class:"ionic-boat"},{id:"bed",class:"ionic-bed"},{id:"bicycle",class:"ionic-bicycle"},{id:"build",class:"ionic-build"},{id:"desktop",class:"ionic-desktop"},{id:"earth",class:"ionic-earth"},{id:"camera",class:"ionic-camera"},{id:"fish",class:"ionic-fish"},{id:"flame",class:"ionic-flame"},{id:"footsteps",class:"ionic-footsteps"},{id:"key",class:"ionic-key"},{id:"man",class:"ionic-man"},{id:"paw",class:"ionic-paw"},{id:"skull",class:"ionic-skull"},{id:"construct",class:"ionic-construct"},{id:"bus",class:"ionic-bus"},{id:"subway",class:"ionic-subway"},{id:"telescope",class:"ionic-telescope"},{id:"construction-truck",class:"at-construction-truck"},{id:"electric-car",class:"at-electric-car"},{id:"gasoline",class:"at-gasoline"},{id:"kg-weight",class:"at-kg-weight"},{id:"carrot",class:"at-carrot"},{id:"middle-finger",class:"at-middle-finger"},{id:"toilet-bathroom",class:"at-toilet-bathroom"},{id:"car-garage",class:"at-car-garage"},{id:"electricity-home",class:"at-electricity-home"},{id:"carrot-turnip-vegetable",class:"at-carrot-turnip-vegetable"},{id:"wheat-harvest",class:"at-wheat-harvest"},{id:"helicopter-travel",class:"at-helicopter-travel"},{id:"camper-vehicle",class:"at-camper-vehicle"},{id:"cargo-transport",class:"at-cargo-transport"},{id:"bulldozer",class:"at-bulldozer"},{id:"construction-transport",class:"at-construction-transport"},{id:"crane-truck",class:"at-crane-truck"},{id:"delivery-truck",class:"at-delivery-truck"},{id:"liquid-transportation",class:"at-liquid-transportation"},{id:"transport-truck",class:"at-transport-truck"},{id:"ladder-truck",class:"at-ladder-truck"}];let{markerPlacementEvent:f=null}=e,{markerClickEvent:g=null}=e;Ge(async()=>{await c(),document.querySelector(".map-container"),s=xt.subscribe(T),a=qr.subscribe(p=>{p&&d()})}),mt(()=>{console.log("Destroying MarkerManager"),s&&s(),a&&a(),Qe.set([]),er.set([]),xt.set([])});async function d(){const p=await c(),m=o;if(m){const w=new Ke.LngLat(m.longitude,m.latitude),v=gn(),A=b(w,"default",v);A.addTo(p),Qe.update(P=>[...P,{marker:A,id:v,last_confirmed:new Date().toISOString(),iconClass:"default"}]),p.flyTo({center:w,zoom:15,duration:1e3}),console.log("Marker placed at current location:",w)}else console.error("Unable to get current location")}function b(p,m,w){if(m==="default"){const P=new Ke.Marker().setLngLat(p);return P.getElement().setAttribute("data-marker-id",w),Jn(P,w),P}const v=document.createElement("div");if(v.style.width="35px",v.style.height="35px",v.setAttribute("data-marker-id",w),v.style.display="flex",v.style.justifyContent="center",v.style.alignItems="center",v.style.borderRadius="100%",v.style.backgroundColor="LightGray",v.style.opacity=.9,v.style.boxShadow="0 2px 4px rgba(0, 0, 0, 0.2)",m.startsWith("custom-svg-"))new Rl({target:v,props:{icon:m.replace("custom-svg-",""),size:"25px",color:"black"}}),v.querySelector("svg").dataset.icon=m.replace("custom-svg-","");else if(m.startsWith("ionic-")){const P=document.createElement("ion-icon");P.setAttribute("name",m.replace("ionic-","")),P.style.fontSize="28px",P.style.color="black",v.appendChild(P)}else{const P=document.createElement("i");P.className=m,P.style.fontSize="20px",P.style.color="black",P.style.fill="#ff6347",P.style.fontWeight="bold",v.appendChild(P)}const A=new Ke.Marker({element:v}).setLngLat(p);return Jn(A,w),A}async function h(p){const m=await c(),{lngLat:w}=p;if(w){if(n){const{marker:P}=n;P.remove()}const v=gn(),A=b(w,"default",v);A.setLngLat(w).addTo(m),Ut.set({marker:A,id:v}),m.flyTo({center:w,duration:1e3}),ut.update(P=>({...P,showMarkerMenu:!0})),console.log("Marker ID Placed:",v,n)}else console.error("Invalid event format. Missing lngLat property.")}function _(){if(n){const{marker:p,id:m}=n,w=new Date().toISOString(),v=t.find(F=>F.id===m);let A="default";const P=p.getElement(),O=P.querySelector("svg[data-icon]");if(O&&O.dataset.icon)A=`custom-svg-${O.dataset.icon}`;else{const F=P.querySelector("ion-icon");if(F)A=`ionic-${F.getAttribute("name")}`;else{const z=P.querySelector("i");z&&(A=z.className)}}const L={marker:p,id:m,last_confirmed:w,iconClass:A};v?(console.log("Updating existing marker:",L),Qe.update(F=>F.map(z=>z.id===m?L:z))):(console.log("Adding new marker:",L),Qe.update(F=>[...F,L])),Ut.set(null)}ut.update(p=>({...p,showMarkerMenu:!1}))}function y(){if(n){const{marker:p,id:m}=n;p.remove(),Ut.set(null);const w=t.find(v=>v.id===m);w&&(Qe.update(v=>{const A=v.filter(P=>P.id!==m);return er.update(P=>[...P,{id:m,last_confirmed:w.last_confirmed}]),A}),console.log("Marker removed:",m))}ut.update(p=>({...p,showMarkerMenu:!1}))}async function M(p){const m=await c(),{marker:w,id:v}=p;if(Ut.set({marker:w,id:v}),console.log(`Marker selected with ID: ${v}`,n),n){const A=w.getLngLat();m.flyTo({center:A,zoom:15,duration:1e3}),ut.update(P=>({...P,showMarkerMenu:!0}))}}async function $(p){const m=await c();let w=p.id;if(n){const{marker:v,id:A}=n,P=v.getLngLat();v.remove();let O;p.class.startsWith("custom-svg")?O=b(P,`custom-svg-${w}`,A):O=b(P,p.class,A),O.addTo(m);const L={marker:O,id:A};Ut.set(L)}}async function T(p){const m=await c(),w=[];p.forEach((v,A)=>{const{markerData:P}=v,{id:O,marker_data:L,last_confirmed:F,iconClass:z}=P;if(v.action==="add"||v.action==="update"){const{geometry:W,properties:N}=L,{coordinates:R}=W,X=new Ke.LngLat(R[0],R[1]),Z=z||N.icon,te=b(X,Z,O);te.setLngLat(X).addTo(m),v.action==="add"?Qe.update(q=>[...q,{marker:te,id:O,last_confirmed:F,iconClass:Z}]):Qe.update(q=>q.map(x=>x.id===O?{marker:te,id:O,last_confirmed:F,iconClass:Z}:x)),w.push(A)}else if(v.action==="delete"){const W=t.find(N=>N.id===O);if(W){const{marker:N}=W;N.remove(),Qe.update(R=>R.filter(X=>X.id!==O)),console.log("Marker removed:",P)}w.push(A)}}),w.length>0&&xt.update(v=>v.filter((A,P)=>!w.includes(P)))}const S=p=>$(p);return l.$$set=p=>{"markerPlacementEvent"in p&&r(5,f=p.markerPlacementEvent),"markerClickEvent"in p&&r(6,g=p.markerClickEvent)},l.$$.update=()=>{l.$$.dirty&32&&f&&h(f),l.$$.dirty&64&&g&&M(g)},[i,u,_,y,$,f,g,S]}class Ua extends ie{constructor(e){super(),se(this,e,Fa,Ba,le,{markerPlacementEvent:5,markerClickEvent:6})}}const Ra=Ve([]);function Kn(l,e,r){const t=l.slice();return t[5]=e[r],t}function Qn(l){let e,r;return e=new va({props:{thumb:l[5],class:"border-primary bg-background ring-offset-background focus-visible:ring-ring block h-5 w-5 rounded-full border-2 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"}}),{c(){Y(e.$$.fragment)},l(t){Q(e.$$.fragment,t)},m(t,n){G(e,t,n),r=!0},p(t,n){const o={};n&16&&(o.thumb=t[5]),e.$set(o)},i(t){r||(C(e.$$.fragment,t),r=!0)},o(t){E(e.$$.fragment,t),r=!1},d(t){j(e,t)}}}function Ha(l){let e,r,t,n,o;r=new ha({props:{class:"bg-primary absolute h-full"}});let i=dt(l[4]),c=[];for(let a=0;a<i.length;a+=1)c[a]=Qn(Kn(l,i,a));const s=a=>E(c[a],1,1,()=>{c[a]=null});return{c(){e=B("span"),Y(r.$$.fragment),t=K();for(let a=0;a<c.length;a+=1)c[a].c();n=ne(),this.h()},l(a){e=V(a,"SPAN",{class:!0});var u=H(e);Q(r.$$.fragment,u),u.forEach(k),t=J(a);for(let f=0;f<c.length;f+=1)c[f].l(a);n=ne(),this.h()},h(){D(e,"class","bg-secondary relative h-2 w-full grow overflow-hidden rounded-full")},m(a,u){U(a,e,u),G(r,e,null),U(a,t,u);for(let f=0;f<c.length;f+=1)c[f]&&c[f].m(a,u);U(a,n,u),o=!0},p(a,u){if(u&16){i=dt(a[4]);let f;for(f=0;f<i.length;f+=1){const g=Kn(a,i,f);c[f]?(c[f].p(g,u),C(c[f],1)):(c[f]=Qn(g),c[f].c(),C(c[f],1),c[f].m(n.parentNode,n))}for(de(),f=i.length;f<c.length;f+=1)s(f);he()}},i(a){if(!o){C(r.$$.fragment,a);for(let u=0;u<i.length;u+=1)C(c[u]);o=!0}},o(a){E(r.$$.fragment,a),c=c.filter(Boolean);for(let u=0;u<c.length;u+=1)E(c[u]);o=!1},d(a){a&&(k(e),k(t),k(n)),j(r),nr(c,a)}}}function qa(l){let e,r,t;const n=[{class:ht("relative flex w-full touch-none select-none items-center",l[1])},l[2]];function o(c){l[3](c)}let i={$$slots:{default:[Ha,({thumbs:c})=>({4:c}),({thumbs:c})=>c?16:0]},$$scope:{ctx:l}};for(let c=0;c<n.length;c+=1)i=ee(i,n[c]);return l[0]!==void 0&&(i.value=l[0]),e=new sa({props:i}),Ue.push(()=>$r(e,"value",o)),{c(){Y(e.$$.fragment)},l(c){Q(e.$$.fragment,c)},m(c,s){G(e,c,s),t=!0},p(c,[s]){const a=s&6?De(n,[s&2&&{class:ht("relative flex w-full touch-none select-none items-center",c[1])},s&4&&rt(c[2])]):{};s&272&&(a.$$scope={dirty:s,ctx:c}),!r&&s&1&&(r=!0,a.value=c[0],Sr(()=>r=!1)),e.$set(a)},i(c){t||(C(e.$$.fragment,c),t=!0)},o(c){E(e.$$.fragment,c),t=!1},d(c){j(e,c)}}}function Wa(l,e,r){const t=["class","value"];let n=Te(e,t),{class:o=void 0}=e,{value:i=[0]}=e;function c(s){i=s,r(0,i)}return l.$$set=s=>{e=ee(ee({},e),$e(s)),r(2,n=Te(e,t)),"class"in s&&r(1,o=s.class),"value"in s&&r(0,i=s.value)},[i,o,n,c]}class ja extends ie{constructor(e){super(),se(this,e,Wa,qa,le,{class:1,value:0})}}function Ga(l){let e,r,t;const n=l[2].default,o=be(n,l,l[3],null);return r=new Gs({props:{class:ht("bg-border relative rounded-full",l[1]==="vertical"&&"flex-1")}}),{c(){o&&o.c(),e=K(),Y(r.$$.fragment)},l(i){o&&o.l(i),e=J(i),Q(r.$$.fragment,i)},m(i,c){o&&o.m(i,c),U(i,e,c),G(r,i,c),t=!0},p(i,c){o&&o.p&&(!t||c&8)&&ve(o,n,i,i[3],t?ke(n,i[3],c,null):we(i[3]),null);const s={};c&2&&(s.class=ht("bg-border relative rounded-full",i[1]==="vertical"&&"flex-1")),r.$set(s)},i(i){t||(C(o,i),C(r.$$.fragment,i),t=!0)},o(i){E(o,i),E(r.$$.fragment,i),t=!1},d(i){i&&k(e),o&&o.d(i),j(r,i)}}}function Ya(l){let e,r;return e=new Ts({props:{orientation:l[1],class:ht("flex touch-none select-none transition-colors",l[1]==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-px",l[1]==="horizontal"&&"h-2.5 w-full border-t border-t-transparent p-px",l[0]),$$slots:{default:[Ga]},$$scope:{ctx:l}}}),{c(){Y(e.$$.fragment)},l(t){Q(e.$$.fragment,t)},m(t,n){G(e,t,n),r=!0},p(t,[n]){const o={};n&2&&(o.orientation=t[1]),n&3&&(o.class=ht("flex touch-none select-none transition-colors",t[1]==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-px",t[1]==="horizontal"&&"h-2.5 w-full border-t border-t-transparent p-px",t[0])),n&10&&(o.$$scope={dirty:n,ctx:t}),e.$set(o)},i(t){r||(C(e.$$.fragment,t),r=!0)},o(t){E(e.$$.fragment,t),r=!1},d(t){j(e,t)}}}function Xa(l,e,r){let{$$slots:t={},$$scope:n}=e,{class:o=void 0}=e,{orientation:i="vertical"}=e;return l.$$set=c=>{"class"in c&&r(0,o=c.class),"orientation"in c&&r(1,i=c.orientation),"$$scope"in c&&r(3,n=c.$$scope)},[o,i,t,n]}class ao extends ie{constructor(e){super(),se(this,e,Xa,Ya,le,{class:0,orientation:1})}}function Za(l){let e;const r=l[5].default,t=be(r,l,l[6],null);return{c(){t&&t.c()},l(n){t&&t.l(n)},m(n,o){t&&t.m(n,o),e=!0},p(n,o){t&&t.p&&(!e||o&64)&&ve(t,r,n,n[6],e?ke(r,n[6],o,null):we(n[6]),null)},i(n){e||(C(t,n),e=!0)},o(n){E(t,n),e=!1},d(n){t&&t.d(n)}}}function Ja(l){let e,r;return e=new es({props:{$$slots:{default:[Za]},$$scope:{ctx:l}}}),{c(){Y(e.$$.fragment)},l(t){Q(e.$$.fragment,t)},m(t,n){G(e,t,n),r=!0},p(t,n){const o={};n&64&&(o.$$scope={dirty:n,ctx:t}),e.$set(o)},i(t){r||(C(e.$$.fragment,t),r=!0)},o(t){E(e.$$.fragment,t),r=!1},d(t){j(e,t)}}}function xn(l){let e,r;return e=new ao({props:{orientation:"vertical",class:l[3]}}),{c(){Y(e.$$.fragment)},l(t){Q(e.$$.fragment,t)},m(t,n){G(e,t,n),r=!0},p(t,n){const o={};n&8&&(o.class=t[3]),e.$set(o)},i(t){r||(C(e.$$.fragment,t),r=!0)},o(t){E(e.$$.fragment,t),r=!1},d(t){j(e,t)}}}function el(l){let e,r;return e=new ao({props:{orientation:"horizontal",class:l[2]}}),{c(){Y(e.$$.fragment)},l(t){Q(e.$$.fragment,t)},m(t,n){G(e,t,n),r=!0},p(t,n){const o={};n&4&&(o.class=t[2]),e.$set(o)},i(t){r||(C(e.$$.fragment,t),r=!0)},o(t){E(e.$$.fragment,t),r=!1},d(t){j(e,t)}}}function Ka(l){let e,r,t,n,o,i;e=new Yi({props:{class:"h-full w-full rounded-[inherit]",$$slots:{default:[Ja]},$$scope:{ctx:l}}});let c=(l[1]==="vertical"||l[1]==="both")&&xn(l),s=(l[1]==="horizontal"||l[1]==="both")&&el(l);return o=new xs({}),{c(){Y(e.$$.fragment),r=K(),c&&c.c(),t=K(),s&&s.c(),n=K(),Y(o.$$.fragment)},l(a){Q(e.$$.fragment,a),r=J(a),c&&c.l(a),t=J(a),s&&s.l(a),n=J(a),Q(o.$$.fragment,a)},m(a,u){G(e,a,u),U(a,r,u),c&&c.m(a,u),U(a,t,u),s&&s.m(a,u),U(a,n,u),G(o,a,u),i=!0},p(a,u){const f={};u&64&&(f.$$scope={dirty:u,ctx:a}),e.$set(f),a[1]==="vertical"||a[1]==="both"?c?(c.p(a,u),u&2&&C(c,1)):(c=xn(a),c.c(),C(c,1),c.m(t.parentNode,t)):c&&(de(),E(c,1,1,()=>{c=null}),he()),a[1]==="horizontal"||a[1]==="both"?s?(s.p(a,u),u&2&&C(s,1)):(s=el(a),s.c(),C(s,1),s.m(n.parentNode,n)):s&&(de(),E(s,1,1,()=>{s=null}),he())},i(a){i||(C(e.$$.fragment,a),C(c),C(s),C(o.$$.fragment,a),i=!0)},o(a){E(e.$$.fragment,a),E(c),E(s),E(o.$$.fragment,a),i=!1},d(a){a&&(k(r),k(t),k(n)),j(e,a),c&&c.d(a),s&&s.d(a),j(o,a)}}}function Qa(l){let e,r;const t=[l[4],{class:ht("relative overflow-hidden",l[0])}];let n={$$slots:{default:[Ka]},$$scope:{ctx:l}};for(let o=0;o<t.length;o+=1)n=ee(n,t[o]);return e=new Ui({props:n}),{c(){Y(e.$$.fragment)},l(o){Q(e.$$.fragment,o)},m(o,i){G(e,o,i),r=!0},p(o,[i]){const c=i&17?De(t,[i&16&&rt(o[4]),i&1&&{class:ht("relative overflow-hidden",o[0])}]):{};i&78&&(c.$$scope={dirty:i,ctx:o}),e.$set(c)},i(o){r||(C(e.$$.fragment,o),r=!0)},o(o){E(e.$$.fragment,o),r=!1},d(o){j(e,o)}}}function xa(l,e,r){const t=["class","orientation","scrollbarXClasses","scrollbarYClasses"];let n=Te(e,t),{$$slots:o={},$$scope:i}=e,{class:c=void 0}=e,{orientation:s="vertical"}=e,{scrollbarXClasses:a=""}=e,{scrollbarYClasses:u=""}=e;return l.$$set=f=>{e=ee(ee({},e),$e(f)),r(4,n=Te(e,t)),"class"in f&&r(0,c=f.class),"orientation"in f&&r(1,s=f.orientation),"scrollbarXClasses"in f&&r(2,a=f.scrollbarXClasses),"scrollbarYClasses"in f&&r(3,u=f.scrollbarYClasses),"$$scope"in f&&r(6,i=f.$$scope)},[c,s,a,u,n,o,i]}class sn extends ie{constructor(e){super(),se(this,e,xa,Qa,le,{class:0,orientation:1,scrollbarXClasses:2,scrollbarYClasses:3})}}function tl(l,e,r){const t=l.slice();return t[28]=e[r],t}function rl(l,e,r){const t=l.slice();return t[31]=e[r],t}function nl(l,e,r){const t=l.slice();return t[34]=e[r],t}function ec(l){let e;return{c(){e=ge("Vehicles")},l(r){e=me(r,"Vehicles")},m(r,t){U(r,e,t)},d(r){r&&k(e)}}}function tc(l){let e;return{c(){e=ge("Colors")},l(r){e=me(r,"Colors")},m(r,t){U(r,e,t)},d(r){r&&k(e)}}}function rc(l){let e;return{c(){e=ge("Swath")},l(r){e=me(r,"Swath")},m(r,t){U(r,e,t)},d(r){r&&k(e)}}}function nc(l){let e,r,t,n,o,i;return e=new zr({props:{value:"vehicles",class:"rounded-md px-4 py-2 text-gray-700 transition-all duration-200 hover:bg-gray-200 data-[state=active]:bg-white data-[state=active]:shadow-md",$$slots:{default:[ec]},$$scope:{ctx:l}}}),t=new zr({props:{value:"colors",class:"rounded-md px-4 py-2 text-gray-700 transition-all duration-200 hover:bg-gray-200 data-[state=active]:bg-white data-[state=active]:shadow-md",$$slots:{default:[tc]},$$scope:{ctx:l}}}),o=new zr({props:{value:"swath",class:"rounded-md px-4 py-2 text-gray-700 transition-all duration-200 hover:bg-gray-200 data-[state=active]:bg-white data-[state=active]:shadow-md",$$slots:{default:[rc]},$$scope:{ctx:l}}}),{c(){Y(e.$$.fragment),r=K(),Y(t.$$.fragment),n=K(),Y(o.$$.fragment)},l(c){Q(e.$$.fragment,c),r=J(c),Q(t.$$.fragment,c),n=J(c),Q(o.$$.fragment,c)},m(c,s){G(e,c,s),U(c,r,s),G(t,c,s),U(c,n,s),G(o,c,s),i=!0},p(c,s){const a={};s[1]&64&&(a.$$scope={dirty:s,ctx:c}),e.$set(a);const u={};s[1]&64&&(u.$$scope={dirty:s,ctx:c}),t.$set(u);const f={};s[1]&64&&(f.$$scope={dirty:s,ctx:c}),o.$set(f)},i(c){i||(C(e.$$.fragment,c),C(t.$$.fragment,c),C(o.$$.fragment,c),i=!0)},o(c){E(e.$$.fragment,c),E(t.$$.fragment,c),E(o.$$.fragment,c),i=!1},d(c){c&&(k(r),k(n)),j(e,c),j(t,c),j(o,c)}}}function lc(l){let e,r,t;var n=It[l[34].type];function o(i,c){return{props:{bodyColor:i[34].bodyColor,size:"100%"}}}return n&&(e=Mt(n,o(l))),{c(){e&&Y(e.$$.fragment),r=K()},l(i){e&&Q(e.$$.fragment,i),r=J(i)},m(i,c){e&&G(e,i,c),U(i,r,c),t=!0},p(i,c){if(c[0]&8&&n!==(n=It[i[34].type])){if(e){de();const s=e;E(s.$$.fragment,1,0,()=>{j(s,1)}),he()}n?(e=Mt(n,o(i)),Y(e.$$.fragment),C(e.$$.fragment,1),G(e,r.parentNode,r)):e=null}else if(n){const s={};c[0]&8&&(s.bodyColor=i[34].bodyColor),e.$set(s)}},i(i){t||(e&&C(e.$$.fragment,i),t=!0)},o(i){e&&E(e.$$.fragment,i),t=!1},d(i){i&&k(r),e&&j(e,i)}}}function ll(l){let e,r;function t(){return l[18](l[34])}return e=new Wt({props:{variant:"outline",class:"h-24 w-24 border-2 p-2",$$slots:{default:[lc]},$$scope:{ctx:l}}}),e.$on("click",t),{c(){Y(e.$$.fragment)},l(n){Q(e.$$.fragment,n)},m(n,o){G(e,n,o),r=!0},p(n,o){l=n;const i={};o[0]&8|o[1]&64&&(i.$$scope={dirty:o,ctx:l}),e.$set(i)},i(n){r||(C(e.$$.fragment,n),r=!0)},o(n){E(e.$$.fragment,n),r=!1},d(n){j(e,n)}}}function oc(l){let e,r,t=dt(l[3]),n=[];for(let i=0;i<t.length;i+=1)n[i]=ll(nl(l,t,i));const o=i=>E(n[i],1,1,()=>{n[i]=null});return{c(){e=B("div");for(let i=0;i<n.length;i+=1)n[i].c();this.h()},l(i){e=V(i,"DIV",{class:!0});var c=H(e);for(let s=0;s<n.length;s+=1)n[s].l(c);c.forEach(k),this.h()},h(){D(e,"class","grid-container p-4 svelte-1it14s8")},m(i,c){U(i,e,c);for(let s=0;s<n.length;s+=1)n[s]&&n[s].m(e,null);r=!0},p(i,c){if(c[0]&264){t=dt(i[3]);let s;for(s=0;s<t.length;s+=1){const a=nl(i,t,s);n[s]?(n[s].p(a,c),C(n[s],1)):(n[s]=ll(a),n[s].c(),C(n[s],1),n[s].m(e,null))}for(de(),s=t.length;s<n.length;s+=1)o(s);he()}},i(i){if(!r){for(let c=0;c<t.length;c+=1)C(n[c]);r=!0}},o(i){n=n.filter(Boolean);for(let c=0;c<n.length;c+=1)E(n[c]);r=!1},d(i){i&&k(e),nr(n,i)}}}function ic(l){let e,r;return e=new sn({props:{class:"h-full",type:"auto",$$slots:{default:[oc]},$$scope:{ctx:l}}}),{c(){Y(e.$$.fragment)},l(t){Q(e.$$.fragment,t)},m(t,n){G(e,t,n),r=!0},p(t,n){const o={};n[0]&8|n[1]&64&&(o.$$scope={dirty:n,ctx:t}),e.$set(o)},i(t){r||(C(e.$$.fragment,t),r=!0)},o(t){E(e.$$.fragment,t),r=!1},d(t){j(e,t)}}}function ol(l){let e,r;function t(){return l[19](l[31])}return e=new Wt({props:{variant:"outline",class:"h-24 w-24 border-2 p-2",style:"background-color: "+l[31]+";"}}),e.$on("click",t),{c(){Y(e.$$.fragment)},l(n){Q(e.$$.fragment,n)},m(n,o){G(e,n,o),r=!0},p(n,o){l=n},i(n){r||(C(e.$$.fragment,n),r=!0)},o(n){E(e.$$.fragment,n),r=!1},d(n){j(e,n)}}}function sc(l){let e,r,t=dt(l[9]),n=[];for(let i=0;i<t.length;i+=1)n[i]=ol(rl(l,t,i));const o=i=>E(n[i],1,1,()=>{n[i]=null});return{c(){e=B("div");for(let i=0;i<n.length;i+=1)n[i].c();this.h()},l(i){e=V(i,"DIV",{class:!0});var c=H(e);for(let s=0;s<n.length;s+=1)n[s].l(c);c.forEach(k),this.h()},h(){D(e,"class","grid-container p-4 svelte-1it14s8")},m(i,c){U(i,e,c);for(let s=0;s<n.length;s+=1)n[s]&&n[s].m(e,null);r=!0},p(i,c){if(c[0]&4608){t=dt(i[9]);let s;for(s=0;s<t.length;s+=1){const a=rl(i,t,s);n[s]?(n[s].p(a,c),C(n[s],1)):(n[s]=ol(a),n[s].c(),C(n[s],1),n[s].m(e,null))}for(de(),s=t.length;s<n.length;s+=1)o(s);he()}},i(i){if(!r){for(let c=0;c<t.length;c+=1)C(n[c]);r=!0}},o(i){n=n.filter(Boolean);for(let c=0;c<n.length;c+=1)E(n[c]);r=!1},d(i){i&&k(e),nr(n,i)}}}function ac(l){let e,r;return e=new sn({props:{class:"h-full",type:"auto",$$slots:{default:[sc]},$$scope:{ctx:l}}}),{c(){Y(e.$$.fragment)},l(t){Q(e.$$.fragment,t)},m(t,n){G(e,t,n),r=!0},p(t,n){const o={};n[1]&64&&(o.$$scope={dirty:n,ctx:t}),e.$set(o)},i(t){r||(C(e.$$.fragment,t),r=!0)},o(t){E(e.$$.fragment,t),r=!1},d(t){j(e,t)}}}function cc(l){let e,r;return e=new Do({props:{class:"h-4 w-4"}}),{c(){Y(e.$$.fragment)},l(t){Q(e.$$.fragment,t)},m(t,n){G(e,t,n),r=!0},p:Ee,i(t){r||(C(e.$$.fragment,t),r=!0)},o(t){E(e.$$.fragment,t),r=!1},d(t){j(e,t)}}}function uc(l){let e,r,t;return r=new Wt({props:{variant:"ghost",size:"icon",class:"ml-2",$$slots:{default:[cc]},$$scope:{ctx:l}}}),r.$on("click",l[20]),{c(){e=ge(`Swath Width
                        `),Y(r.$$.fragment)},l(n){e=me(n,`Swath Width
                        `),Q(r.$$.fragment,n)},m(n,o){U(n,e,o),G(r,n,o),t=!0},p(n,o){const i={};o[1]&64&&(i.$$scope={dirty:o,ctx:n}),r.$set(i)},i(n){t||(C(r.$$.fragment,n),t=!0)},o(n){E(r.$$.fragment,n),t=!1},d(n){n&&k(e),j(r,n)}}}function fc(l){let e,r;return e=new Wl({props:{class:"flex items-center",$$slots:{default:[uc]},$$scope:{ctx:l}}}),{c(){Y(e.$$.fragment)},l(t){Q(e.$$.fragment,t)},m(t,n){G(e,t,n),r=!0},p(t,n){const o={};n[1]&64&&(o.$$scope={dirty:n,ctx:t}),e.$set(o)},i(t){r||(C(e.$$.fragment,t),r=!0)},o(t){E(e.$$.fragment,t),r=!1},d(t){j(e,t)}}}function il(l){let e,r,t,n,o,i;function c(){return l[21](l[28])}return{c(){e=B("button"),r=ge(l[28]),t=ge(`m
                          `),this.h()},l(s){e=V(s,"BUTTON",{class:!0});var a=H(e);r=me(a,l[28]),t=me(a,`m
                          `),a.forEach(k),this.h()},h(){D(e,"class",n="rounded-full px-3 py-1 text-sm "+(l[2].swath===l[28]?"bg-primary text-white":"bg-gray-200"))},m(s,a){U(s,e,a),I(e,r),I(e,t),o||(i=Se(e,"click",c),o=!0)},p(s,a){l=s,a[0]&4&&n!==(n="rounded-full px-3 py-1 text-sm "+(l[2].swath===l[28]?"bg-primary text-white":"bg-gray-200"))&&D(e,"class",n)},d(s){s&&k(e),o=!1,i()}}}function dc(l){let e,r,t,n,o,i,c,s,a=l[1][0]+"",u,f,g,d=dt([4,8,10,12,24,36]),b=[];for(let h=0;h<6;h+=1)b[h]=il(tl(l,d,h));return n=new Kl({props:{class:"h-5 w-5"}}),i=new ja({props:{value:l[1],onValueChange:l[7],min:2,max:50,step:1,class:"flex-grow [&_[role=slider]]:h-5 [&_[role=slider]]:w-5 [&_[role=slider]]:bg-gray-100 [&_[role=slider]]:shadow-[inset_-2px_-2px_5px_rgba(255,255,255,0.7),inset_2px_2px_5px_rgba(0,0,0,0.1)] [&_[role=track]]:h-2 [&_[role=track]]:bg-gray-200 [&_[role=track]]:shadow-[inset_1px_1px_3px_rgba(0,0,0,0.1),inset_-1px_-1px_3px_rgba(255,255,255,0.7)]"}}),{c(){e=B("div");for(let h=0;h<6;h+=1)b[h].c();r=K(),t=B("div"),Y(n.$$.fragment),o=K(),Y(i.$$.fragment),c=K(),s=B("span"),u=ge(a),f=ge("m"),this.h()},l(h){e=V(h,"DIV",{class:!0});var _=H(e);for(let $=0;$<6;$+=1)b[$].l(_);_.forEach(k),r=J(h),t=V(h,"DIV",{class:!0});var y=H(t);Q(n.$$.fragment,y),o=J(y),Q(i.$$.fragment,y),c=J(y),s=V(y,"SPAN",{class:!0});var M=H(s);u=me(M,a),f=me(M,"m"),M.forEach(k),y.forEach(k),this.h()},h(){D(e,"class","mb-4 grid grid-cols-3 gap-2"),D(s,"class","font-semibold"),D(t,"class","flex items-center space-x-2")},m(h,_){U(h,e,_);for(let y=0;y<6;y+=1)b[y]&&b[y].m(e,null);U(h,r,_),U(h,t,_),G(n,t,null),I(t,o),G(i,t,null),I(t,c),I(t,s),I(s,u),I(s,f),g=!0},p(h,_){if(_[0]&132){d=dt([4,8,10,12,24,36]);let M;for(M=0;M<6;M+=1){const $=tl(h,d,M);b[M]?b[M].p($,_):(b[M]=il($),b[M].c(),b[M].m(e,null))}for(;M<6;M+=1)b[M].d(1)}const y={};_[0]&2&&(y.value=h[1]),i.$set(y),(!g||_[0]&2)&&a!==(a=h[1][0]+"")&&Fe(u,a)},i(h){g||(C(n.$$.fragment,h),C(i.$$.fragment,h),g=!0)},o(h){E(n.$$.fragment,h),E(i.$$.fragment,h),g=!1},d(h){h&&(k(e),k(r),k(t)),nr(b,h),j(n),j(i)}}}function hc(l){let e,r,t,n;return e=new Hl({props:{class:"flex items-center",$$slots:{default:[fc]},$$scope:{ctx:l}}}),t=new ql({props:{$$slots:{default:[dc]},$$scope:{ctx:l}}}),{c(){Y(e.$$.fragment),r=K(),Y(t.$$.fragment)},l(o){Q(e.$$.fragment,o),r=J(o),Q(t.$$.fragment,o)},m(o,i){G(e,o,i),U(o,r,i),G(t,o,i),n=!0},p(o,i){const c={};i[1]&64&&(c.$$scope={dirty:i,ctx:o}),e.$set(c);const s={};i[0]&6|i[1]&64&&(s.$$scope={dirty:i,ctx:o}),t.$set(s)},i(o){n||(C(e.$$.fragment,o),C(t.$$.fragment,o),n=!0)},o(o){E(e.$$.fragment,o),E(t.$$.fragment,o),n=!1},d(o){o&&k(r),j(e,o),j(t,o)}}}function mc(l){let e,r,t;return r=new jr({props:{$$slots:{default:[hc]},$$scope:{ctx:l}}}),{c(){e=B("div"),Y(r.$$.fragment),this.h()},l(n){e=V(n,"DIV",{class:!0});var o=H(e);Q(r.$$.fragment,o),o.forEach(k),this.h()},h(){D(e,"class","space-y-4 p-4")},m(n,o){U(n,e,o),G(r,e,null),t=!0},p(n,o){const i={};o[0]&6|o[1]&64&&(i.$$scope={dirty:o,ctx:n}),r.$set(i)},i(n){t||(C(r.$$.fragment,n),t=!0)},o(n){E(r.$$.fragment,n),t=!1},d(n){n&&k(e),j(r)}}}function gc(l){let e,r;return e=new sn({props:{class:"h-full",type:"auto",$$slots:{default:[mc]},$$scope:{ctx:l}}}),{c(){Y(e.$$.fragment)},l(t){Q(e.$$.fragment,t)},m(t,n){G(e,t,n),r=!0},p(t,n){const o={};n[0]&6|n[1]&64&&(o.$$scope={dirty:n,ctx:t}),e.$set(o)},i(t){r||(C(e.$$.fragment,t),r=!0)},o(t){E(e.$$.fragment,t),r=!1},d(t){j(e,t)}}}function _c(l){let e,r,t,n,o,i,c,s,a;return e=new Io({props:{class:"grid w-full grid-cols-3 gap-1",$$slots:{default:[nc]},$$scope:{ctx:l}}}),n=new Br({props:{value:"vehicles",class:"h-full",$$slots:{default:[ic]},$$scope:{ctx:l}}}),i=new Br({props:{value:"colors",class:"h-full",$$slots:{default:[ac]},$$scope:{ctx:l}}}),s=new Br({props:{value:"swath",class:"h-full",$$slots:{default:[gc]},$$scope:{ctx:l}}}),{c(){Y(e.$$.fragment),r=K(),t=B("div"),Y(n.$$.fragment),o=K(),Y(i.$$.fragment),c=K(),Y(s.$$.fragment),this.h()},l(u){Q(e.$$.fragment,u),r=J(u),t=V(u,"DIV",{class:!0});var f=H(t);Q(n.$$.fragment,f),o=J(f),Q(i.$$.fragment,f),c=J(f),Q(s.$$.fragment,f),f.forEach(k),this.h()},h(){D(t,"class","flex-grow overflow-hidden")},m(u,f){G(e,u,f),U(u,r,f),U(u,t,f),G(n,t,null),I(t,o),G(i,t,null),I(t,c),G(s,t,null),a=!0},p(u,f){const g={};f[1]&64&&(g.$$scope={dirty:f,ctx:u}),e.$set(g);const d={};f[0]&8|f[1]&64&&(d.$$scope={dirty:f,ctx:u}),n.$set(d);const b={};f[1]&64&&(b.$$scope={dirty:f,ctx:u}),i.$set(b);const h={};f[0]&6|f[1]&64&&(h.$$scope={dirty:f,ctx:u}),s.$set(h)},i(u){a||(C(e.$$.fragment,u),C(n.$$.fragment,u),C(i.$$.fragment,u),C(s.$$.fragment,u),a=!0)},o(u){E(e.$$.fragment,u),E(n.$$.fragment,u),E(i.$$.fragment,u),E(s.$$.fragment,u),a=!1},d(u){u&&(k(r),k(t)),j(e,u),j(n),j(i),j(s)}}}function pc(l){let e,r;return e=new Mo({props:{value:l[4],onValueChange:l[22],class:"rounded-lg bg-gray-100 p-1 shadow-inner",$$slots:{default:[_c]},$$scope:{ctx:l}}}),{c(){Y(e.$$.fragment)},l(t){Q(e.$$.fragment,t)},m(t,n){G(e,t,n),r=!0},p(t,n){const o={};n[0]&16&&(o.value=t[4]),n[0]&16&&(o.onValueChange=t[22]),n[0]&14|n[1]&64&&(o.$$scope={dirty:n,ctx:t}),e.$set(o)},i(t){r||(C(e.$$.fragment,t),r=!0)},o(t){E(e.$$.fragment,t),r=!1},d(t){j(e,t)}}}function bc(l){let e=l[2].type+"",r;return{c(){r=ge(e)},l(t){r=me(t,e)},m(t,n){U(t,r,n)},p(t,n){n[0]&4&&e!==(e=t[2].type+"")&&Fe(r,e)},d(t){t&&k(r)}}}function vc(l){let e,r;return e=new Wl({props:{class:"max-w-full break-words px-2 text-xl font-semibold",$$slots:{default:[bc]},$$scope:{ctx:l}}}),{c(){Y(e.$$.fragment)},l(t){Q(e.$$.fragment,t)},m(t,n){G(e,t,n),r=!0},p(t,n){const o={};n[0]&4|n[1]&64&&(o.$$scope={dirty:n,ctx:t}),e.$set(o)},i(t){r||(C(e.$$.fragment,t),r=!0)},o(t){E(e.$$.fragment,t),r=!1},d(t){j(e,t)}}}function wc(l){let e,r,t,n,o;e=new nn({props:{class:"absolute right-2 top-2 h-4 w-4 text-gray-400"}});var i=It[l[2].type];function c(s,a){return{props:{bodyColor:s[2].bodyColor,size:`${s[2].size*1.8}px`}}}return i&&(t=Mt(i,c(l))),{c(){Y(e.$$.fragment),r=K(),t&&Y(t.$$.fragment),n=ne()},l(s){Q(e.$$.fragment,s),r=J(s),t&&Q(t.$$.fragment,s),n=ne()},m(s,a){G(e,s,a),U(s,r,a),t&&G(t,s,a),U(s,n,a),o=!0},p(s,a){if(a[0]&4&&i!==(i=It[s[2].type])){if(t){de();const u=t;E(u.$$.fragment,1,0,()=>{j(u,1)}),he()}i?(t=Mt(i,c(s)),Y(t.$$.fragment),C(t.$$.fragment,1),G(t,n.parentNode,n)):t=null}else if(i){const u={};a[0]&4&&(u.bodyColor=s[2].bodyColor),a[0]&4&&(u.size=`${s[2].size*1.8}px`),t.$set(u)}},i(s){o||(C(e.$$.fragment,s),t&&C(t.$$.fragment,s),o=!0)},o(s){E(e.$$.fragment,s),t&&E(t.$$.fragment,s),o=!1},d(s){s&&(k(r),k(n)),j(e,s),t&&j(t,s)}}}function kc(l){let e,r,t,n,o,i=l[2].bodyColor+"",c,s;return e=new nn({props:{class:"absolute right-2 top-2 h-4 w-4 text-gray-400"}}),t=new xo({props:{class:"mb-2 h-5 w-5"}}),{c(){Y(e.$$.fragment),r=K(),Y(t.$$.fragment),n=K(),o=B("span"),c=ge(i)},l(a){Q(e.$$.fragment,a),r=J(a),Q(t.$$.fragment,a),n=J(a),o=V(a,"SPAN",{});var u=H(o);c=me(u,i),u.forEach(k)},m(a,u){G(e,a,u),U(a,r,u),G(t,a,u),U(a,n,u),U(a,o,u),I(o,c),s=!0},p(a,u){(!s||u[0]&4)&&i!==(i=a[2].bodyColor+"")&&Fe(c,i)},i(a){s||(C(e.$$.fragment,a),C(t.$$.fragment,a),s=!0)},o(a){E(e.$$.fragment,a),E(t.$$.fragment,a),s=!1},d(a){a&&(k(r),k(n),k(o)),j(e,a),j(t,a)}}}function yc(l){let e,r,t,n,o,i=l[1][0]+"",c,s,a;return e=new nn({props:{class:"absolute right-2 top-2 h-4 w-4 text-gray-400"}}),t=new Kl({props:{class:"mb-2 h-5 w-5"}}),{c(){Y(e.$$.fragment),r=K(),Y(t.$$.fragment),n=K(),o=B("span"),c=ge(i),s=ge("m")},l(u){Q(e.$$.fragment,u),r=J(u),Q(t.$$.fragment,u),n=J(u),o=V(u,"SPAN",{});var f=H(o);c=me(f,i),s=me(f,"m"),f.forEach(k)},m(u,f){G(e,u,f),U(u,r,f),G(t,u,f),U(u,n,f),U(u,o,f),I(o,c),I(o,s),a=!0},p(u,f){(!a||f[0]&2)&&i!==(i=u[1][0]+"")&&Fe(c,i)},i(u){a||(C(e.$$.fragment,u),C(t.$$.fragment,u),a=!0)},o(u){E(e.$$.fragment,u),E(t.$$.fragment,u),a=!1},d(u){u&&(k(r),k(n),k(o)),j(e,u),j(t,u)}}}function Tc(l){let e,r,t,n,o,i,c;return e=new Wt({props:{variant:"outline",class:"relative flex h-40 w-full items-center justify-center",$$slots:{default:[wc]},$$scope:{ctx:l}}}),e.$on("click",l[23]),n=new Wt({props:{variant:"outline",class:"relative flex h-20 flex-col items-center justify-center",$$slots:{default:[kc]},$$scope:{ctx:l}}}),n.$on("click",l[24]),i=new Wt({props:{variant:"outline",class:"relative flex h-20 flex-col items-center justify-center",$$slots:{default:[yc]},$$scope:{ctx:l}}}),i.$on("click",l[25]),{c(){Y(e.$$.fragment),r=K(),t=B("div"),Y(n.$$.fragment),o=K(),Y(i.$$.fragment),this.h()},l(s){Q(e.$$.fragment,s),r=J(s),t=V(s,"DIV",{class:!0});var a=H(t);Q(n.$$.fragment,a),o=J(a),Q(i.$$.fragment,a),a.forEach(k),this.h()},h(){D(t,"class","grid grid-cols-2 gap-4")},m(s,a){G(e,s,a),U(s,r,a),U(s,t,a),G(n,t,null),I(t,o),G(i,t,null),c=!0},p(s,a){const u={};a[0]&4|a[1]&64&&(u.$$scope={dirty:a,ctx:s}),e.$set(u);const f={};a[0]&4|a[1]&64&&(f.$$scope={dirty:a,ctx:s}),n.$set(f);const g={};a[0]&2|a[1]&64&&(g.$$scope={dirty:a,ctx:s}),i.$set(g)},i(s){c||(C(e.$$.fragment,s),C(n.$$.fragment,s),C(i.$$.fragment,s),c=!0)},o(s){E(e.$$.fragment,s),E(n.$$.fragment,s),E(i.$$.fragment,s),c=!1},d(s){s&&(k(r),k(t)),j(e,s),j(n),j(i)}}}function Cc(l){let e,r,t,n;return e=new Hl({props:{class:"pb-2 text-center",$$slots:{default:[vc]},$$scope:{ctx:l}}}),t=new ql({props:{class:"space-y-4",$$slots:{default:[Tc]},$$scope:{ctx:l}}}),{c(){Y(e.$$.fragment),r=K(),Y(t.$$.fragment)},l(o){Q(e.$$.fragment,o),r=J(o),Q(t.$$.fragment,o)},m(o,i){G(e,o,i),U(o,r,i),G(t,o,i),n=!0},p(o,i){const c={};i[0]&4|i[1]&64&&(c.$$scope={dirty:i,ctx:o}),e.$set(c);const s={};i[0]&22|i[1]&64&&(s.$$scope={dirty:i,ctx:o}),t.$set(s)},i(o){n||(C(e.$$.fragment,o),C(t.$$.fragment,o),n=!0)},o(o){E(e.$$.fragment,o),E(t.$$.fragment,o),n=!1},d(o){o&&k(r),j(e,o),j(t,o)}}}function Ec(l){let e,r,t,n,o,i,c,s,a,u,f="Cancel",g,d,b,h,_,y,M,$;return n=new jr({props:{class:"h-full overflow-hidden border-2 border-gray-300",$$slots:{default:[pc]},$$scope:{ctx:l}}}),c=new jr({props:{class:"h-full w-full",$$slots:{default:[Cc]},$$scope:{ctx:l}}}),{c(){e=B("div"),r=B("div"),t=B("div"),Y(n.$$.fragment),o=K(),i=B("div"),Y(c.$$.fragment),s=K(),a=B("div"),u=B("button"),u.textContent=f,g=K(),d=B("button"),b=ge("Confirm"),this.h()},l(T){e=V(T,"DIV",{class:!0,style:!0});var S=H(e);r=V(S,"DIV",{class:!0});var p=H(r);t=V(p,"DIV",{class:!0});var m=H(t);Q(n.$$.fragment,m),m.forEach(k),o=J(p),i=V(p,"DIV",{class:!0});var w=H(i);Q(c.$$.fragment,w),w.forEach(k),p.forEach(k),s=J(S),a=V(S,"DIV",{class:!0});var v=H(a);u=V(v,"BUTTON",{class:!0,"data-svelte-h":!0}),Ce(u)!=="svelte-15xc6ca"&&(u.textContent=f),g=J(v),d=V(v,"BUTTON",{class:!0});var A=H(d);b=me(A,"Confirm"),A.forEach(k),v.forEach(k),S.forEach(k),this.h()},h(){D(t,"class","flex w-full flex-grow flex-col overflow-hidden sm:w-1/2 sm:pr-4"),D(i,"class","mt-4 flex w-full flex-col sm:mt-0 sm:w-1/2 sm:pl-4"),D(r,"class","flex flex-grow flex-col overflow-hidden text-black sm:flex-row"),D(u,"class","btn mr-2 flex-1"),D(d,"class","btn btn-primary ml-2 flex-1"),d.disabled=h=!l[6],D(a,"class","mt-6 flex"),D(e,"class","fixed bottom-0 left-0 right-0 z-20 flex transform flex-col rounded-t-lg bg-white p-6 shadow-lg transition-transform duration-300 sm:p-8"),D(e,"style",_=l[5]?"height: 100%;":"height: 60vh;"),St(e,"translate-y-full",!l[0]),St(e,"translate-y-0",l[0])},m(T,S){U(T,e,S),I(e,r),I(r,t),G(n,t,null),I(r,o),I(r,i),G(c,i,null),I(e,s),I(e,a),I(a,u),I(a,g),I(a,d),I(d,b),y=!0,M||($=[Se(u,"click",l[11]),Se(d,"click",l[10])],M=!0)},p(T,S){const p={};S[0]&30|S[1]&64&&(p.$$scope={dirty:S,ctx:T}),n.$set(p);const m={};S[0]&22|S[1]&64&&(m.$$scope={dirty:S,ctx:T}),c.$set(m),(!y||S[0]&64&&h!==(h=!T[6]))&&(d.disabled=h),(!y||S[0]&32&&_!==(_=T[5]?"height: 100%;":"height: 60vh;"))&&D(e,"style",_),(!y||S[0]&1)&&St(e,"translate-y-full",!T[0]),(!y||S[0]&1)&&St(e,"translate-y-0",T[0])},i(T){y||(C(n.$$.fragment,T),C(c.$$.fragment,T),y=!0)},o(T){E(n.$$.fragment,T),E(c.$$.fragment,T),y=!1},d(T){T&&k(e),j(n),j(c),M=!1,vt($)}}}function sl(l){return l[Math.floor(Math.random()*l.length)]}function Sc(l,e){const r=l.filter(n=>!e.includes(n));if(r.length===0)return e.length=0,sl(l);const t=sl(r);return e.push(t),t}function $c(l,e,r){let t,n,o,i;const c=rn();let{showMenu:s=!1}=e,{currentVehicleType:a}=e,{currentVehicleSize:u}=e,{currentVehicleColor:f}=e,{currentVehicleSwath:g}=e,d="vehicles",b=[],h=[12];function _(z){const W=Array.isArray(z)?z[0]:z;r(1,h=[W]),r(2,o={...o,swath:W})}function y(z){r(2,o={...z}),r(1,h=[z.swath||12])}let M=!1;const $=["Red","Blue","Green","Yellow","Orange","Purple","SkyBlue","LightGreen","HotPink"];Ge(()=>{const z=()=>{r(5,M=window.innerWidth<640)};return z(),window.addEventListener("resize",z),r(3,t=t.map(W=>W.type===a?{...W,size:u||60,bodyColor:f,swath:g}:{...W,bodyColor:Sc($,b)})),()=>{window.removeEventListener("resize",z)}});function T(){ce.success(`Selected Vehicle: [${o.bodyColor} ${o.type}]`),c("vehicleSelected",{...o,size:o.size,swath:h[0]}),c("closeMenu")}function S(){c("closeMenu")}function p(z){r(2,o={...o,bodyColor:z})}const m=z=>y(z),w=z=>p(z),v=()=>{ce.info("About Swath Width",{description:"Swath width is the area covered by your vehicle in one pass. Proper swath setting ensures correct trailing visuals.",duration:7e3})},A=z=>_(z),P=z=>r(4,d=z),O=()=>r(4,d="vehicles"),L=()=>r(4,d="colors"),F=()=>r(4,d="swath");return l.$$set=z=>{"showMenu"in z&&r(0,s=z.showMenu),"currentVehicleType"in z&&r(13,a=z.currentVehicleType),"currentVehicleSize"in z&&r(14,u=z.currentVehicleSize),"currentVehicleColor"in z&&r(15,f=z.currentVehicleColor),"currentVehicleSwath"in z&&r(16,g=z.currentVehicleSwath)},l.$$.update=()=>{l.$$.dirty[0]&8200&&r(17,n=t.find(z=>z.type===a)||t[0]),l.$$.dirty[0]&196608&&r(2,o={...n,swath:g||n.swath}),l.$$.dirty[0]&6&&o.swath!==h[0]&&r(1,h=[o.swath]),l.$$.dirty[0]&131076&&r(6,i=o.type!==n.type||o.bodyColor!==n.bodyColor||o.size!==n.size||o.swath!==n.swath)},r(3,t=[{type:"FourWheelDriveTractor",bodyColor:"green",size:60,swath:4},{type:"TowBetweenSeeder",bodyColor:"red",size:60,swath:12},{type:"TowBehindSeeder",bodyColor:"red",size:60,swath:12},{type:"TowBehindSeederTracks",bodyColor:"red",size:60,swath:12},{type:"TowBehindBoomspray",bodyColor:"red",size:60,swath:36},{type:"SelfPropelledBoomspray",bodyColor:"red",size:60,swath:36},{type:"ThreePointBoomspray",bodyColor:"red",size:60,swath:36},{type:"FarmUte",bodyColor:"red",size:60,swath:4},{type:"FrontWheelChaserBin",bodyColor:"red",size:60,swath:12},{type:"FourWheelDriveChaserBin",bodyColor:"red",size:60,swath:12},{type:"HeaderDuals",bodyColor:"red",size:60,swath:12},{type:"HeaderSingles",bodyColor:"red",size:60,swath:12},{type:"HeaderTracks",bodyColor:"red",size:60,swath:12},{type:"SelfPropelledSwather",bodyColor:"red",size:60,swath:12},{type:"Spreader",bodyColor:"red",size:60,swath:12},{type:"Truck",bodyColor:"red",size:60,swath:4},{type:"CabOverTruck",bodyColor:"red",size:60,swath:4},{type:"CabOverRoadTrain",bodyColor:"red",size:60,swath:4},{type:"Baler",bodyColor:"red",size:60,swath:12},{type:"Mower",bodyColor:"red",size:60,swath:12},{type:"SelfPropelledMower",bodyColor:"red",size:60,swath:12},{type:"Telehandler",bodyColor:"red",size:60,swath:12},{type:"Loader",bodyColor:"red",size:60,swath:4},{type:"SimpleTractor",bodyColor:"red",size:60,swath:4},{type:"Pointer",bodyColor:"green",size:60,swath:4},{type:"CombineHarvester",bodyColor:"yellow",size:60,swath:12},{type:"Excavator",bodyColor:"orange",size:60,swath:4},{type:"Tractor",bodyColor:"green",size:60,swath:4},{type:"WheelLoader",bodyColor:"yellow",size:60,swath:4},{type:"WorkCar",bodyColor:"red",size:60,swath:4},{type:"Airplane",bodyColor:"blue",size:60,swath:50}]),[s,h,o,t,d,M,i,_,y,$,T,S,p,a,u,f,g,n,m,w,v,A,P,O,L,F]}class Mc extends ie{constructor(e){super(),se(this,e,$c,Ec,le,{showMenu:0,currentVehicleType:13,currentVehicleSize:14,currentVehicleColor:15,currentVehicleSwath:16},null,[-1,-1])}}function Ic(l){let e,r;return e=new si({props:{size:24}}),{c(){Y(e.$$.fragment)},l(t){Q(e.$$.fragment,t)},m(t,n){G(e,t,n),r=!0},i(t){r||(C(e.$$.fragment,t),r=!0)},o(t){E(e.$$.fragment,t),r=!1},d(t){j(e,t)}}}function Ac(l){let e,r;return e=new ni({props:{size:24}}),{c(){Y(e.$$.fragment)},l(t){Q(e.$$.fragment,t)},m(t,n){G(e,t,n),r=!0},i(t){r||(C(e.$$.fragment,t),r=!0)},o(t){E(e.$$.fragment,t),r=!1},d(t){j(e,t)}}}function Lc(l){let e;return{c(){e=ge("Loading...")},l(r){e=me(r,"Loading...")},m(r,t){U(r,e,t)},p:Ee,i:Ee,o:Ee,d(r){r&&k(e)}}}function Dc(l){let e,r,t;var n=l[3];function o(i,c){return{props:{bodyColor:i[0].vehicle_marker.bodyColor,size:i[0].vehicle_marker.size,swath:i[0].vehicle_marker.swath}}}return n&&(e=Mt(n,o(l))),{c(){e&&Y(e.$$.fragment),r=ne()},l(i){e&&Q(e.$$.fragment,i),r=ne()},m(i,c){e&&G(e,i,c),U(i,r,c),t=!0},p(i,c){if(c&8&&n!==(n=i[3])){if(e){de();const s=e;E(s.$$.fragment,1,0,()=>{j(s,1)}),he()}n?(e=Mt(n,o(i)),Y(e.$$.fragment),C(e.$$.fragment,1),G(e,r.parentNode,r)):e=null}else if(n){const s={};c&1&&(s.bodyColor=i[0].vehicle_marker.bodyColor),c&1&&(s.size=i[0].vehicle_marker.size),c&1&&(s.swath=i[0].vehicle_marker.swath),e.$set(s)}},i(i){t||(e&&C(e.$$.fragment,i),t=!0)},o(i){e&&E(e.$$.fragment,i),t=!1},d(i){i&&k(r),e&&j(e,i)}}}function Pc(l){let e,r,t,n;return{c(){e=Ze("svg"),r=Ze("title"),t=ge("trail"),n=Ze("path"),this.h()},l(o){e=Xe(o,"svg",{fill:!0,width:!0,height:!0,viewBox:!0,version:!0,xmlns:!0});var i=H(e);r=Xe(i,"title",{});var c=H(r);t=me(c,"trail"),c.forEach(k),n=Xe(i,"path",{d:!0,class:!0}),H(n).forEach(k),i.forEach(k),this.h()},h(){D(n,"d","M30.165 30.887c-1.604 0.076-21.522-0.043-21.522-0.043-12.101-12.151 18.219-16.173-0.521-26.154l-1.311 1.383-1.746-4.582 5.635 0.439-1.128 1.267c23.438 6.83-3.151 19.631 20.594 27.69v0z"),D(n,"class","svelte-5z3w06"),D(e,"fill","currentColor"),D(e,"width","36px"),D(e,"height","36px"),D(e,"viewBox","0 0 32 32"),D(e,"version","1.1"),D(e,"xmlns","http://www.w3.org/2000/svg")},m(o,i){U(o,e,i),I(e,r),I(r,t),I(e,n)},p:Ee,d(o){o&&k(e)}}}function Oc(l){let e,r,t,n,o;return{c(){e=Ze("svg"),r=Ze("title"),t=ge("trail"),n=Ze("path"),this.h()},l(i){e=Xe(i,"svg",{class:!0,fill:!0,width:!0,height:!0,viewBox:!0,version:!0,xmlns:!0});var c=H(e);r=Xe(c,"title",{});var s=H(r);t=me(s,"trail"),s.forEach(k),n=Xe(c,"path",{d:!0,class:!0}),H(n).forEach(k),c.forEach(k),this.h()},h(){D(n,"d","M30.165 30.887c-1.604 0.076-21.522-0.043-21.522-0.043-12.101-12.151 18.219-16.173-0.521-26.154l-1.311 1.383-1.746-4.582 5.635 0.439-1.128 1.267c23.438 6.83-3.151 19.631 20.594 27.69v0z"),D(n,"class","svelte-5z3w06"),D(e,"class",o=Wr(l[6]?"animate-trail":"")+" svelte-5z3w06"),D(e,"fill","currentColor"),D(e,"width","36px"),D(e,"height","36px"),D(e,"viewBox","0 0 32 32"),D(e,"version","1.1"),D(e,"xmlns","http://www.w3.org/2000/svg")},m(i,c){U(i,e,c),I(e,r),I(r,t),I(e,n)},p(i,c){c&64&&o!==(o=Wr(i[6]?"animate-trail":"")+" svelte-5z3w06")&&D(e,"class",o)},d(i){i&&k(e)}}}function al(l){let e,r;return e=new Mc({props:{showMenu:l[1].showVehicleMenu,currentVehicleType:l[0].vehicle_marker.type,currentVehicleSize:l[0].vehicle_marker.size,currentVehicleColor:l[0].vehicle_marker.bodyColor,currentVehicleSwath:l[0].vehicle_marker.swath}}),e.$on("closeMenu",l[15]),e.$on("vehicleSelected",l[16]),{c(){Y(e.$$.fragment)},l(t){Q(e.$$.fragment,t)},m(t,n){G(e,t,n),r=!0},p(t,n){const o={};n&2&&(o.showMenu=t[1].showVehicleMenu),n&1&&(o.currentVehicleType=t[0].vehicle_marker.type),n&1&&(o.currentVehicleSize=t[0].vehicle_marker.size),n&1&&(o.currentVehicleColor=t[0].vehicle_marker.bodyColor),n&1&&(o.currentVehicleSwath=t[0].vehicle_marker.swath),e.$set(o)},i(t){r||(C(e.$$.fragment,t),r=!0)},o(t){E(e.$$.fragment,t),r=!1},d(t){j(e,t)}}}function Nc(l){let e,r,t,n,o,i,c,s,a,u,f,g,d,b,h,_,y,M,$,T,S,p,m,w,v,A,P,O,L,F,z,W,N,R;const X=[Ac,Ic],Z=[];function te(oe,Ie){return oe[5]?0:1}b=te(l),h=Z[b]=X[b](l),M=new vn.location_drop({props:{width:"48",height:"48",fill:"currentColor"}}),S=new vn.locate_home({props:{width:"40",height:"40",fill:"currentColor"}});const q=[Dc,Lc],x=[];function pe(oe,Ie){return oe[3]?0:1}v=pe(l),A=x[v]=q[v](l);function _e(oe,Ie){return oe[6]?Oc:Pc}let ye=_e(l),Me=ye(l),ae=l[2]&&al(l);return{c(){e=B("div"),r=B("button"),t=Ze("svg"),n=Ze("path"),o=K(),i=B("div"),c=B("button"),s=Ze("svg"),a=Ze("path"),f=K(),g=B("div"),d=B("button"),h.c(),_=K(),y=B("button"),Y(M.$$.fragment),$=K(),T=B("button"),Y(S.$$.fragment),p=K(),m=B("button"),w=B("div"),A.c(),P=K(),O=B("button"),Me.c(),z=K(),ae&&ae.c(),this.h()},l(oe){e=V(oe,"DIV",{});var Ie=H(e);r=V(Ie,"BUTTON",{class:!0});var ue=H(r);t=Xe(ue,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0,stroke:!0});var Le=H(t);n=Xe(Le,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0,class:!0}),H(n).forEach(k),Le.forEach(k),ue.forEach(k),o=J(Ie),i=V(Ie,"DIV",{class:!0});var Pe=H(i);c=V(Pe,"BUTTON",{class:!0});var Re=H(c);s=Xe(Re,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0,stroke:!0});var Yt=H(s);a=Xe(Yt,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0,class:!0}),H(a).forEach(k),Yt.forEach(k),Re.forEach(k),f=J(Pe),g=V(Pe,"DIV",{class:!0});var Je=H(g);d=V(Je,"BUTTON",{class:!0});var wt=H(d);h.l(wt),wt.forEach(k),_=J(Je),y=V(Je,"BUTTON",{class:!0});var Lt=H(y);Q(M.$$.fragment,Lt),Lt.forEach(k),$=J(Je),T=V(Je,"BUTTON",{class:!0});var Vt=H(T);Q(S.$$.fragment,Vt),Vt.forEach(k),p=J(Je),m=V(Je,"BUTTON",{class:!0});var Bt=H(m);w=V(Bt,"DIV",{class:!0});var nt=H(w);A.l(nt),nt.forEach(k),Bt.forEach(k),P=J(Je),O=V(Je,"BUTTON",{class:!0});var ct=H(O);Me.l(ct),ct.forEach(k),Je.forEach(k),Pe.forEach(k),z=J(Ie),ae&&ae.l(Ie),Ie.forEach(k),this.h()},h(){D(n,"stroke-linecap","round"),D(n,"stroke-linejoin","round"),D(n,"stroke-width","2"),D(n,"d","M10 19l-7-7m0 0l7-7m-7 7h18"),D(n,"class","svelte-5z3w06"),D(t,"xmlns","http://www.w3.org/2000/svg"),D(t,"class","h-6 w-6"),D(t,"fill","none"),D(t,"viewBox","0 0 24 24"),D(t,"stroke","currentColor"),D(r,"class","top-button "+Tt+" btn btn-circle btn-lg absolute left-4 top-4 z-10 bg-white bg-opacity-50 hover:bg-opacity-100 svelte-5z3w06"),D(a,"stroke-linecap","round"),D(a,"stroke-linejoin","round"),D(a,"stroke-width","2"),D(a,"d","M19 9l-7 7-7-7"),D(a,"class","svelte-5z3w06"),D(s,"xmlns","http://www.w3.org/2000/svg"),D(s,"class",u="h-8 w-8 transition-transform duration-300 "+(l[4]?"rotate-180":"")),D(s,"fill","none"),D(s,"viewBox","0 0 24 24"),D(s,"stroke","currentColor"),D(c,"class","top-button "+Tt+" btn btn-circle btn-lg mb-3 bg-white hover:bg-opacity-90 svelte-5z3w06"),D(d,"class","menu-button "+Tt+" btn btn-circle btn-lg bg-white hover:bg-opacity-90 svelte-5z3w06"),D(y,"class","menu-button "+Tt+" btn btn-circle btn-lg bg-white text-sm hover:bg-opacity-90 svelte-5z3w06"),D(T,"class","menu-button "+Tt+" btn btn-circle btn-lg bg-white hover:bg-opacity-90 svelte-5z3w06"),D(w,"class","flex h-full w-full items-center justify-center"),D(m,"class","menu-button "+Tt+" btn btn-circle btn-lg bg-white hover:bg-opacity-90 svelte-5z3w06"),D(O,"class",L="menu-button "+Tt+" btn btn-circle btn-lg bg-white hover:bg-opacity-90 "+(l[6]?"trailing-active":"")+" relative svelte-5z3w06"),D(g,"class",F="flex origin-top flex-col space-y-3 transition-all duration-700 ease-in-out "+(l[4]?"scale-100 opacity-90":"h-50 scale-0 overflow-hidden opacity-0")),D(i,"class","fixed right-4 top-4 z-20 flex flex-col items-end")},m(oe,Ie){U(oe,e,Ie),I(e,r),I(r,t),I(t,n),I(e,o),I(e,i),I(i,c),I(c,s),I(s,a),I(i,f),I(i,g),I(g,d),Z[b].m(d,null),I(g,_),I(g,y),G(M,y,null),I(g,$),I(g,T),G(S,T,null),I(g,p),I(g,m),I(m,w),x[v].m(w,null),I(g,P),I(g,O),Me.m(O,null),I(e,z),ae&&ae.m(e,null),W=!0,N||(R=[Se(r,"click",l[9]),Se(c,"click",l[10]),Se(d,"click",l[13]),Se(y,"click",l[11]),Se(T,"click",l[12]),Se(m,"click",l[8]),Se(O,"click",l[7])],N=!0)},p(oe,[Ie]){(!W||Ie&16&&u!==(u="h-8 w-8 transition-transform duration-300 "+(oe[4]?"rotate-180":"")))&&D(s,"class",u);let ue=b;b=te(oe),b!==ue&&(de(),E(Z[ue],1,1,()=>{Z[ue]=null}),he(),h=Z[b],h||(h=Z[b]=X[b](oe),h.c()),C(h,1),h.m(d,null));let Le=v;v=pe(oe),v===Le?x[v].p(oe,Ie):(de(),E(x[Le],1,1,()=>{x[Le]=null}),he(),A=x[v],A?A.p(oe,Ie):(A=x[v]=q[v](oe),A.c()),C(A,1),A.m(w,null)),ye===(ye=_e(oe))&&Me?Me.p(oe,Ie):(Me.d(1),Me=ye(oe),Me&&(Me.c(),Me.m(O,null))),(!W||Ie&64&&L!==(L="menu-button "+Tt+" btn btn-circle btn-lg bg-white hover:bg-opacity-90 "+(oe[6]?"trailing-active":"")+" relative svelte-5z3w06"))&&D(O,"class",L),(!W||Ie&16&&F!==(F="flex origin-top flex-col space-y-3 transition-all duration-700 ease-in-out "+(oe[4]?"scale-100 opacity-90":"h-50 scale-0 overflow-hidden opacity-0")))&&D(g,"class",F),oe[2]?ae?(ae.p(oe,Ie),Ie&4&&C(ae,1)):(ae=al(oe),ae.c(),C(ae,1),ae.m(e,null)):ae&&(de(),E(ae,1,1,()=>{ae=null}),he())},i(oe){W||(C(h),C(M.$$.fragment,oe),C(S.$$.fragment,oe),C(A),C(ae),W=!0)},o(oe){E(h),E(M.$$.fragment,oe),E(S.$$.fragment,oe),E(A),E(ae),W=!1},d(oe){oe&&k(e),Z[b].d(),j(M),j(S),x[v].d(),Me.d(),ae&&ae.d(),N=!1,vt(R)}}}let Tt="skan";function zc(l,e,r){let t,n,o,i;re(l,jt,S=>r(5,t=S)),re(l,$t,S=>r(0,n=S)),re(l,br,S=>r(18,S)),re(l,ut,S=>r(1,o=S)),re(l,at,S=>r(6,i=S)),Ge(async()=>{console.log("Mounting ButtonSection"),setTimeout(()=>{r(4,b=!0)},200)});let{isSatelliteView:c=!0}=e,s=!1,a;const u=rn();function f(){on.update(S=>!S),i?ce.info("Preparing to end trail recording..."):ce.info("Initiating trail recording...")}function g(){r(2,s=!s),console.log("Set vehicleMenuVisibility to",s),ut.update(S=>{const p={...S,showVehicleMenu:s};return console.log("Updated controlStore:",p),p})}function d(){u("backToDashboard")}let b=!1;function h(){r(4,b=!b)}function _(){const S=n.coordinates;S?qr.set(S):ce.error("Unable to get your current location")}function y(){u("locateHome")}function M(){Ul(jt,t=!t,t)}const $=()=>{ut.update(S=>({...S,showVehicleMenu:!1}))},T=S=>{$t.update(p=>({...p,vehicle_marker:S.detail})),ut.update(p=>({...p,showVehicleMenu:!1}))};return l.$$set=S=>{"isSatelliteView"in S&&r(14,c=S.isSatelliteView)},l.$$.update=()=>{l.$$.dirty&1&&n.vehicle_marker&&n.vehicle_marker.type&&r(3,a=It[n.vehicle_marker.type]||It.simpleTractor),l.$$.dirty&2&&r(2,s=o.showVehicleMenu)},[n,o,s,a,b,t,i,f,g,d,h,_,y,M,c,$,T]}class Vc extends ie{constructor(e){super(),se(this,e,zc,Nc,le,{isSatelliteView:14})}}const Bc=500,Fc=5;function Uc(l,e,r){let t;re(l,jt,m=>r(3,t=m));let{map:n}=e;const o=rn();let i=null,c=null,s=[],a=!0,u=!1;function f(m){if(!a)return;const w=m.target;w.style.cursor="pointer"}function g(m){if(!a)return;const w=m.target;w.style.cursor=""}function d(m){if(!a)return;m.stopPropagation();const w=m.target.closest(".mapboxgl-marker");if(w){const v=s.find(A=>A.marker.getElement()===w);if(v){const{marker:A,id:P}=v;o("markerClick",{marker:A,id:P})}else console.log("No matching marker found in confirmedMarkers array")}else console.log("No marker element found")}function b(m){if(!a)return;m.stopPropagation(),m.preventDefault(),clearTimeout(i);const w=m.target.closest(".mapboxgl-marker");if(w){const v=s.find(A=>A.marker.getElement()===w);if(v){const{marker:A,id:P}=v;o("markerClick",{marker:A,id:P})}}}function h(m){if(!a)return;const w=m.lngLat||m.target.getLngLat();w?o("markerPlacement",{lngLat:w}):console.error("Invalid event format. Missing lngLat property.")}function _(m){!a||m.originalEvent.target.closest(".mapboxgl-marker")||(clearTimeout(i),c={x:m.originalEvent.clientX||m.originalEvent.touches[0].clientX,y:m.originalEvent.clientY||m.originalEvent.touches[0].clientY},i=setTimeout(()=>{h(m),i=null},Bc))}function y(m){if(a&&c){const w=m.originalEvent.touches?m.originalEvent.touches[0]:m.originalEvent,v=w.clientX-c.x,A=w.clientY-c.y;Math.sqrt(v*v+A*A)>Fc&&(clearTimeout(i),i=null,c=null)}}function M(m){a&&(clearTimeout(i),i=null,c=null)}function $(m,w){const v=m.getElement();v.removeEventListener("mouseenter",f),v.removeEventListener("mouseleave",g),v.removeEventListener("click",d),v.removeEventListener("touchstart",b),v.removeAttribute("data-listeners-added"),v.addEventListener("mouseenter",f),v.addEventListener("mouseleave",g),v.addEventListener("click",d),v.addEventListener("touchstart",b),v.setAttribute("data-listeners-added","true");const A=s.findIndex(P=>P.id===w);A!==-1?s=s.map((P,O)=>O===A?{marker:m,id:w}:P):s=[...s,{marker:m,id:w}]}function T(m){const{marker:w,id:v}=m.detail;$(w,v)}function S(){!n||u||(n.on("mousedown",_),n.on("touchstart",_),n.on("drag",y),n.on("mouseup",M),document.addEventListener("handleUpdateMarkerListeners",T),r(2,u=!0))}function p(){!n||!u||(n.off("mousedown",_),n.off("touchstart",_),n.off("drag",y),n.off("mouseup",M),document.removeEventListener("handleUpdateMarkerListeners",T),r(2,u=!1))}return Ge(()=>{a&&!u&&S()}),mt(()=>{p()}),l.$$set=m=>{"map"in m&&r(0,n=m.map)},l.$$.update=()=>{l.$$.dirty&14&&t!==void 0&&(r(1,a=!t),a&&!u?S():!a&&u&&p())},[n,a,u,t]}class Rc extends ie{constructor(e){super(),se(this,e,Uc,null,le,{map:0})}}var Hc=typeof global=="object"&&global&&global.Object===Object&&global,qc=typeof self=="object"&&self&&self.Object===Object&&self,co=Hc||qc||Function("return this")(),Cr=co.Symbol,uo=Object.prototype,Wc=uo.hasOwnProperty,jc=uo.toString,Zt=Cr?Cr.toStringTag:void 0;function Gc(l){var e=Wc.call(l,Zt),r=l[Zt];try{l[Zt]=void 0;var t=!0}catch{}var n=jc.call(l);return t&&(e?l[Zt]=r:delete l[Zt]),n}var Yc=Object.prototype,Xc=Yc.toString;function Zc(l){return Xc.call(l)}var Jc="[object Null]",Kc="[object Undefined]",cl=Cr?Cr.toStringTag:void 0;function Qc(l){return l==null?l===void 0?Kc:Jc:cl&&cl in Object(l)?Gc(l):Zc(l)}function xc(l){return l!=null&&typeof l=="object"}var eu="[object Symbol]";function tu(l){return typeof l=="symbol"||xc(l)&&Qc(l)==eu}var ru=/\s/;function nu(l){for(var e=l.length;e--&&ru.test(l.charAt(e)););return e}var lu=/^\s+/;function ou(l){return l&&l.slice(0,nu(l)+1).replace(lu,"")}function Jr(l){var e=typeof l;return l!=null&&(e=="object"||e=="function")}var ul=NaN,iu=/^[-+]0x[0-9a-f]+$/i,su=/^0b[01]+$/i,au=/^0o[0-7]+$/i,cu=parseInt;function fl(l){if(typeof l=="number")return l;if(tu(l))return ul;if(Jr(l)){var e=typeof l.valueOf=="function"?l.valueOf():l;l=Jr(e)?e+"":e}if(typeof l!="string")return l===0?l:+l;l=ou(l);var r=su.test(l);return r||au.test(l)?cu(l.slice(2),r?2:8):iu.test(l)?ul:+l}var Fr=function(){return co.Date.now()},uu="Expected a function",fu=Math.max,du=Math.min;function hu(l,e,r){var t,n,o,i,c,s,a=0,u=!1,f=!1,g=!0;if(typeof l!="function")throw new TypeError(uu);e=fl(e)||0,Jr(r)&&(u=!!r.leading,f="maxWait"in r,o=f?fu(fl(r.maxWait)||0,e):o,g="trailing"in r?!!r.trailing:g);function d(p){var m=t,w=n;return t=n=void 0,a=p,i=l.apply(w,m),i}function b(p){return a=p,c=setTimeout(y,e),u?d(p):i}function h(p){var m=p-s,w=p-a,v=e-m;return f?du(v,o-w):v}function _(p){var m=p-s,w=p-a;return s===void 0||m>=e||m<0||f&&w>=o}function y(){var p=Fr();if(_(p))return M(p);c=setTimeout(y,h(p))}function M(p){return c=void 0,g&&t?d(p):(t=n=void 0,i)}function $(){c!==void 0&&clearTimeout(c),a=0,t=s=n=c=void 0}function T(){return c===void 0?i:M(Fr())}function S(){var p=Fr(),m=_(p);if(t=arguments,n=this,s=p,m){if(c===void 0)return b(s);if(f)return clearTimeout(c),c=setTimeout(y,e),d(s)}return c===void 0&&(c=setTimeout(y,e)),i}return S.cancel=$,S.flush=T,S}function mu(l,e,r){let t,n,o,i;re(l,Qe,p=>r(7,t=p)),re(l,er,p=>r(8,n=p)),re(l,Ql,p=>r(9,o=p)),re(l,ln,p=>r(10,i=p));const{LngLatBounds:c}=po;let s,a,u=!1,f,g,d,{map:b}=e;Ge(()=>{g=i.master_map_id,d=i.id,a=hu(y,500),f=fe.channel("map_markers_changes").on("postgres_changes",{event:"*",schema:"public",table:"map_markers",filter:`master_map_id=eq.${g}`},async p=>{if(p.new.update_user_id===d){console.log("Skipping synchronization, update made by current user");return}let m="Another user";const w=o.connected_profiles.find(L=>L.id===p.new.update_user_id);if(w)m=w.full_name;else{const{data:L}=await fe.from("profiles").select("full_name").eq("id",p.new.update_user_id).single();L&&(m=L.full_name)}const v=p.eventType,A=p.new.marker_data?.properties?.icon||"unknown",P=p.new.marker_data.geometry.coordinates,O=p.new.deleted===!0;_(m,v,A,O,P),u||a()}).subscribe(),y(),s=Qe.subscribe(p=>{u||a()}),br.update(p=>({...p,synchronizeMarkers:y}))}),mt(()=>{console.log("Destroying MapStateSaver"),a.cancel(),s&&s(),f&&fe.removeChannel(f),console.log("Removing all markers from the map"),Qe.update(p=>(p.forEach(({marker:m})=>{m.remove()}),[])),Qe.set([]),er.set([]),xt.set([])});function h(p,m,w){let v="",A="";switch(p){case"add":v="Marker Added",A=`You added a new ${m} marker`,ce.info(v,{description:A});break;case"update":w?(v="Marker Deleted",A=`You removed a ${m} marker`,ce.warning(v,{description:A})):(v="Marker Updated",A=`You updated a marker to ${m}`,ce.info(v,{description:A}));break}}function _(p,m,w,v,A){let P="",O="";switch(m){case"INSERT":P="Marker Added",O=`${p} added a new ${w} marker`,ce.info(P,{description:O,action:{label:"Locate",onClick:()=>{b.flyTo({center:A,zoom:15,duration:1e3})}}});break;case"UPDATE":v?(P="Marker Deleted",O=`${p} removed a ${w} marker`,ce.warning(P,{description:O})):(P="Marker Updated",O=`${p} updated a marker to ${w}`,ce.info(P,{description:O,action:{label:"Locate",onClick:()=>{b.flyTo({center:A,zoom:15,duration:1e3})}}}));break}}async function y(p){if(u){console.log("Synchronization already in progress. Skipping.");return}if(u=!0,br.update(m=>({...m,spinning:!0})),!d){console.error("User not authenticated"),ce.error("User not authenticated");return}try{const m=await T(),w=t;let{localMarkersToBeAdded:v,localMarkersToBeUpdated:A,localMarkersToBeDeleted:P,serverMarkersToBeAdded:O,serverMarkersToBeUpdated:L,serverMarkersToBeDeleted:F}=M(w,m);const z=[...v.map(W=>({action:"add",markerData:W})),...A.map(W=>({action:"update",markerData:W})),...P.map(W=>({action:"delete",markerData:W}))];xt.set(z),await $({serverMarkersToBeAdded:O,serverMarkersToBeUpdated:L,serverMarkersToBeDeleted:F}),S(),p&&ce.success(p)}catch(m){console.error("Error synchronizing markers:",m);let w="Synchronization Error",v=m.message||"Error synchronizing markers";m.message==="No master map assigned"&&(w="Map Assignment Error"),ce.error(w,{description:m.details||v,action:{label:"Reload",onClick:()=>{window.location.reload()}}})}u=!1,br.update(m=>({...m,spinning:!1}))}function M(p,m){let w=[],v=[],A=[],P=[],O=[],L=[];for(const F of p){const z=m.find(W=>W.id===F.id);if(z)z.deleted?new Date(F.last_confirmed)>new Date(z.deleted_at)?(O.push(F),h("update",F.iconClass,!1)):A.push(F):new Date(z.last_confirmed)>new Date(F.last_confirmed)?v.push(z):new Date(F.last_confirmed)>new Date(z.last_confirmed)&&(O.push(F),h("update",F.iconClass,!1));else if(!n.find(N=>N.id===F.id)){let N=F.iconClass||"default";P.push({...F,iconClass:N}),h("add",F.iconClass,!1)}}for(const F of m){const z=p.find(N=>N.id===F.id),W=n.find(N=>N.id===F.id);!z&&!F.deleted&&!W&&w.push(F)}for(const F of n){const z=m.find(W=>W.id===F.id);z&&new Date(F.last_confirmed)>=new Date(z.last_confirmed)&&(L.push(z),h("update",z.iconClass,!0))}return{localMarkersToBeAdded:w,localMarkersToBeUpdated:v,localMarkersToBeDeleted:A,serverMarkersToBeAdded:P,serverMarkersToBeUpdated:O,serverMarkersToBeDeleted:L}}async function $({serverMarkersToBeAdded:p,serverMarkersToBeUpdated:m,serverMarkersToBeDeleted:w}){if(!g)throw new Error("No master map assigned");if(p.length>0){const v=p.map(P=>{const{marker:O,id:L,last_confirmed:F,iconClass:z}=P,N={type:"Feature",geometry:{type:"Point",coordinates:O.getLngLat().toArray()},properties:{icon:z,id:L}};return{master_map_id:g,id:L,marker_data:N,last_confirmed:F,update_user_id:d}}),{error:A}=await fe.from("map_markers").insert(v);if(A)throw new Error("Failed to add markers to server")}if(m.length>0){const v=m.map(P=>{const{marker:O,id:L,last_confirmed:F,iconClass:z}=P,N={type:"Feature",geometry:{type:"Point",coordinates:O.getLngLat().toArray()},properties:{icon:z,id:L}};return{id:L,marker_data:N,last_confirmed:F,update_user_id:d}}),{error:A}=await fe.from("map_markers").upsert(v,{onConflict:"id"});if(A)throw new Error("Failed to update markers on server")}if(w.length>0){const v=w.map(P=>({id:P.id,deleted:!0,deleted_at:new Date().toISOString()})),{error:A}=await fe.from("map_markers").upsert(v,{onConflict:"id"});if(A)throw new Error("Failed to delete markers on server");er.update(P=>P.filter(O=>!w.some(L=>L.id===O.id)))}}async function T(){if(!g)throw new Error("No master map assigned");const{data:p,error:m}=await fe.from("map_markers").select("id, marker_data, last_confirmed, deleted, deleted_at").eq("master_map_id",g);if(m)throw new Error("Failed to retrieve latest markers from server");return p.map(w=>({...w,iconClass:w.marker_data.properties.icon}))}function S(){const p=t;if(p.length>0){const m=new c;p.forEach(({marker:w})=>{m.extend(w.getLngLat())}),Zr.set(m)}else Zr.set(null)}return l.$$set=p=>{"map"in p&&r(0,b=p.map)},[b]}class gu extends ie{constructor(e){super(),se(this,e,mu,null,le,{map:0})}}function dl(l){let e;return{c(){e=B("div"),this.h()},l(r){e=V(r,"DIV",{class:!0,style:!0}),H(e).forEach(k),this.h()},h(){D(e,"class","pulse-circle animate-pulse"),Ae(e,"width",l[1]),Ae(e,"height",l[1]),Ae(e,"border-radius","50%"),Ae(e,"background-color",l[0]),Ae(e,"box-shadow","0 0 0 10px "+l[0]),Ae(e,"position","absolute"),Ae(e,"top","50%"),Ae(e,"left","50%"),Ae(e,"transform","translate(-50%, -50%)"),Ae(e,"z-index","0")},m(r,t){U(r,e,t)},p(r,t){t&2&&Ae(e,"width",r[1]),t&2&&Ae(e,"height",r[1]),t&1&&Ae(e,"background-color",r[0]),t&1&&Ae(e,"box-shadow","0 0 0 10px "+r[0])},d(r){r&&k(e)}}}function _u(l){let e,r,t,n;var o=l[6];function i(s,a){return{props:{bodyColor:s[3],size:s[2],swath:s[4]}}}o&&(r=Mt(o,i(l)));let c=l[5]&&dl(l);return{c(){e=B("div"),r&&Y(r.$$.fragment),t=K(),c&&c.c(),this.h()},l(s){e=V(s,"DIV",{class:!0,style:!0});var a=H(e);r&&Q(r.$$.fragment,a),t=J(a),c&&c.l(a),a.forEach(k),this.h()},h(){D(e,"class","user-marker"),Ae(e,"position","relative"),Ae(e,"display","inline-block")},m(s,a){U(s,e,a),r&&G(r,e,null),I(e,t),c&&c.m(e,null),n=!0},p(s,[a]){if(a&64&&o!==(o=s[6])){if(r){de();const u=r;E(u.$$.fragment,1,0,()=>{j(u,1)}),he()}o?(r=Mt(o,i(s)),Y(r.$$.fragment),C(r.$$.fragment,1),G(r,e,t)):r=null}else if(o){const u={};a&8&&(u.bodyColor=s[3]),a&4&&(u.size=s[2]),a&16&&(u.swath=s[4]),r.$set(u)}s[5]?c?c.p(s,a):(c=dl(s),c.c(),c.m(e,null)):c&&(c.d(1),c=null)},i(s){n||(r&&C(r.$$.fragment,s),n=!0)},o(s){r&&E(r.$$.fragment,s),n=!1},d(s){s&&k(e),r&&j(r),c&&c.d()}}}function pu(l,e,r){let t,{pulseColor:n="rgba(172, 172, 230, 0.8)"}=e,{pulseSize:o="40px"}=e,{vehicleSize:i="60px"}=e,{userVehicle:c="tractor"}=e,{vehicleColor:s="yellow"}=e,{vehicleSwath:a=12}=e,{showPulse:u=!0}=e;return l.$$set=f=>{"pulseColor"in f&&r(0,n=f.pulseColor),"pulseSize"in f&&r(1,o=f.pulseSize),"vehicleSize"in f&&r(2,i=f.vehicleSize),"userVehicle"in f&&r(7,c=f.userVehicle),"vehicleColor"in f&&r(3,s=f.vehicleColor),"vehicleSwath"in f&&r(4,a=f.vehicleSwath),"showPulse"in f&&r(5,u=f.showPulse)},l.$$.update=()=>{l.$$.dirty&128&&r(6,t=It[c]||It.tractor)},[n,o,i,s,a,u,t,c]}class bu extends ie{constructor(e){super(),se(this,e,pu,_u,le,{pulseColor:0,pulseSize:1,vehicleSize:2,userVehicle:7,vehicleColor:3,vehicleSwath:4,showPulse:5})}}function vu(l){let e,r;return e=new Zo({props:{size:20}}),{c(){Y(e.$$.fragment)},l(t){Q(e.$$.fragment,t)},m(t,n){G(e,t,n),r=!0},i(t){r||(C(e.$$.fragment,t),r=!0)},o(t){E(e.$$.fragment,t),r=!1},d(t){j(e,t)}}}function wu(l){let e,r;return e=new xl({props:{size:20,color:"black"}}),{c(){Y(e.$$.fragment)},l(t){Q(e.$$.fragment,t)},m(t,n){G(e,t,n),r=!0},i(t){r||(C(e.$$.fragment,t),r=!0)},o(t){E(e.$$.fragment,t),r=!1},d(t){j(e,t)}}}function hl(l){let e,r,t,n,o,i="km/h";return{c(){e=B("div"),r=B("div"),t=ge(l[0]),n=K(),o=B("div"),o.textContent=i,this.h()},l(c){e=V(c,"DIV",{class:!0,style:!0});var s=H(e);r=V(s,"DIV",{class:!0});var a=H(r);t=me(a,l[0]),a.forEach(k),n=J(s),o=V(s,"DIV",{class:!0,"data-svelte-h":!0}),Ce(o)!=="svelte-11stotl"&&(o.textContent=i),s.forEach(k),this.h()},h(){D(r,"class","text-2xl font-bold"),D(o,"class","text-xs opacity-80"),D(e,"class","speed-fade-in fixed bottom-4 left-1/2 z-50 flex -translate-x-1/2 flex-col items-center rounded-lg bg-black/70 px-5 py-2.5 text-white backdrop-blur svelte-1p8pmuw"),Ae(e,"min-width","min-content")},m(c,s){U(c,e,s),I(e,r),I(r,t),I(e,n),I(e,o)},p(c,s){s&1&&Fe(t,c[0])},d(c){c&&k(e)}}}function ku(l){let e,r,t,n,o,i,c,s,a;const u=[wu,vu],f=[];function g(b,h){return b[1]?0:1}r=g(l),t=f[r]=u[r](l);let d=l[1]&&hl(l);return{c(){e=B("button"),t.c(),o=K(),d&&d.c(),i=ne(),this.h()},l(b){e=V(b,"BUTTON",{class:!0,style:!0,"aria-label":!0});var h=H(e);t.l(h),h.forEach(k),o=J(b),d&&d.l(b),i=ne(),this.h()},h(){D(e,"class","btn btn-circle fixed bottom-20 left-6 z-50 flex h-10 w-10 items-center justify-center border-none bg-black/70 text-white backdrop-blur transition-all hover:scale-110 hover:bg-black/90"),Ae(e,"background",l[1]?"rgba(255, 255, 255, 0.9)":""),D(e,"aria-label",n=l[1]?"Hide speed":"Show speed"),St(e,"text-black",l[1])},m(b,h){U(b,e,h),f[r].m(e,null),U(b,o,h),d&&d.m(b,h),U(b,i,h),c=!0,s||(a=Se(e,"click",l[2]),s=!0)},p(b,[h]){let _=r;r=g(b),r!==_&&(de(),E(f[_],1,1,()=>{f[_]=null}),he(),t=f[r],t||(t=f[r]=u[r](b),t.c()),C(t,1),t.m(e,null)),(!c||h&2)&&Ae(e,"background",b[1]?"rgba(255, 255, 255, 0.9)":""),(!c||h&2&&n!==(n=b[1]?"Hide speed":"Show speed"))&&D(e,"aria-label",n),(!c||h&2)&&St(e,"text-black",b[1]),b[1]?d?d.p(b,h):(d=hl(b),d.c(),d.m(i.parentNode,i)):d&&(d.d(1),d=null)},i(b){c||(C(t),c=!0)},o(b){E(t),c=!1},d(b){b&&(k(e),k(o),k(i)),f[r].d(),d&&d.d(b),s=!1,a()}}}const yu=30;function ml(l,e,r,t){const n=l.getLngLat(),o=l.getRotation(),i=e-n.lng,c=r-n.lat;let s=t-o;s>180?s-=360:s<-180&&(s+=360);const a=1e3,u=performance.now();function f(g){const d=g-u,b=Math.min(d/a,1),h=b<.5?2*b*b:-1+(4-2*b)*b,_=n.lng+i*h,y=n.lat+c*h,M=o+s*h;l.setLngLat([_,y]).setRotation(M),d<a&&requestAnimationFrame(f)}requestAnimationFrame(f)}function Tu(l,e,r){let t,n,o;re(l,at,v=>r(16,t=v)),re(l,$t,v=>r(17,n=v)),re(l,Oo,v=>r(18,o=v));let{map:i}=e,{disableAutoZoom:c=!1}=e,s,a,u=0,f=[],g=0,d=!1,b,h,_=null,y=null,M=null;function $(){r(1,d=!d)}Ge(()=>{console.log("Mounting VehicleTracker");const v=o.data.session;v&&v.user.id,s=new Ke.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0,showUserHeading:!0,showAccuracyCircle:!0,showUserLocation:!1,className:"custom-geolocate-control",fitBoundsOptions:{maxZoom:16}}),i.addControl(s,"bottom-right"),i.on("load",()=>{c||s.trigger()}),s.on("geolocate",A=>{console.log("Received geolocate event:",A);const{coords:P}=A;m(P)}),b=$t.subscribe(A=>{A.coordinates,S(A.vehicle_marker)}),h=vr.subscribe(T)}),mt(()=>{console.log("Unmounting VehicleTracker"),a&&a.remove(),b&&b(),h&&h()});function T(v){v.forEach(A=>{const{coordinates:P,heading:O,vehicle_marker:L,vehicle_id:F,update_types:z,is_trailing:W,last_update:N,full_name:R}=A,[X,Z]=P.slice(1,-1).split(",").map(parseFloat),te=f.findIndex(q=>q.getElement().getAttribute("data-vehicle-id")===F);if(te!==-1){const q=f[te];if(z.includes("vehicle_marker_changed")){q.remove();const x=new Ke.Marker({element:p(L,!1,F),pitchAlignment:"map",rotationAlignment:"map"});x.setLngLat([X,Z]).setRotation(O).addTo(i),f[te]=x}(z.includes("position_changed")||z.includes("heading_changed"))&&ml(q,X,Z,O)}else{const q=new Ke.Marker({element:p(L,!1,F),pitchAlignment:"map",rotationAlignment:"map"});q.setLngLat([X,Z]).setRotation(O).addTo(i),f.push(q)}Fl.update(q=>{const x=q.findIndex(pe=>pe.vehicle_id===F);if(x!==-1){const pe=q[x];z.includes("trailing_status_changed")&&!z.includes("new_vehicle")&&ce.info("Trailing Status Changed",{description:`${R}'s ${L.type} has ${W?"started":"stopped"} trailing`,action:{label:"Locate",onClick:()=>{i.flyTo({center:[X,Z],zoom:15,duration:1e3})}}}),q[x]={...pe,...A}}else q.push(A);return q})})}function S(v){if(!(a&&M&&v.type===M.type&&v.bodyColor===M.bodyColor&&v.size===M.size&&v.swath===M.swath)&&(a&&a.remove(),a=new Ke.Marker({element:p(v,!0),pitchAlignment:"map",rotationAlignment:"map"}),n.coordinates)){const{latitude:A,longitude:P}=n.coordinates;a.setLngLat([P,A]).addTo(i),M={...v}}}function p(v,A=!1,P=null){const O=document.createElement("div");return O.setAttribute("data-vehicle-id",P),new bu({target:O,props:{pulseColor:"rgba(172, 172, 230, 0.8)",pulseSize:"40px",vehicleSize:v.size,userVehicle:v.type,vehicleColor:v.bodyColor,vehicleSwath:v.swath,showPulse:A}}),O}function m(v){const{latitude:A,longitude:P,heading:O,speed:L}=v;r(0,g=L?Math.round(L*3.6):0);const F=Date.now(),z={coordinates:{latitude:A,longitude:P},last_update:F,vehicle_marker:n.vehicle_marker},W=O!==null?Math.round(O):O;w(F,z,W)}function w(v,A,P){if(v-u>=yu){const{coordinates:O}=A,{bodyColor:L,swath:F}=A.vehicle_marker,{latitude:z,longitude:W}=O;if(t){const N={coordinates:{latitude:z,longitude:W},timestamp:v,color:L,swath:F};console.log("Saving location data:",N),Ra.update(R=>[...R,N]),kr.set({coordinates:{latitude:z,longitude:W},timestamp:v})}if(!_||_.latitude!==z||_.longitude!==W||y!==P){let N="";if(!_)N+="Initial coordinates. ";else{if(_.latitude!==z){const R=z-_.latitude;N+=`Latitude changed by ${R.toFixed(6)}. `}if(_.longitude!==W){const R=W-_.longitude;N+=`Longitude changed by ${R.toFixed(6)}. `}}if(y!==P){const R=P-y;N+=`Heading changed by ${R.toFixed(2)}°.`}console.log("Changes detected:",N),$t.update(R=>({...R,coordinates:A.coordinates,last_update:A.last_update,vehicle_marker:A.vehicle_marker,heading:P})),a&&a.getLngLat()&&ml(a,W,z,P),_={latitude:z,longitude:W},y=P}u=v}}return l.$$set=v=>{"map"in v&&r(3,i=v.map),"disableAutoZoom"in v&&r(4,c=v.disableAutoZoom)},[g,d,$,i,c]}class Cu extends ie{constructor(e){super(),se(this,e,Tu,ku,le,{map:3,disableAutoZoom:4})}}const Eu=1e4;function Ur(l,e){return l.map(t=>{const n=e.find(i=>i.vehicle_id===t.vehicle_id),o={vehicle_id:t.vehicle_id,coordinates:t.coordinates,heading:t.heading,vehicle_marker:t.vehicle_marker,is_trailing:t.is_trailing,last_update:t.last_update,full_name:t.full_name||n?.full_name,update_types:[]};if(!n)o.update_types.push("new_vehicle");else{const i=JSON.stringify(t.vehicle_marker)!==JSON.stringify(n.vehicle_marker),c=t.coordinates!==n.coordinates,s=t.heading!==n.heading,a=t.is_trailing!==n.is_trailing,u=t.last_update!==n.last_update;i&&o.update_types.push("vehicle_marker_changed"),c&&o.update_types.push("position_changed"),s&&o.update_types.push("heading_changed"),a&&o.update_types.push("trailing_status_changed"),u&&o.update_types.push("last_update_changed")}return o}).filter(t=>t.update_types.length>0)}function Su(l,e,r){let t,n,o,i;re(l,Fl,h=>r(4,t=h)),re(l,mr,h=>r(5,n=h)),re(l,ln,h=>r(6,o=h)),re(l,at,h=>r(7,i=h));let c=null,s,a=0,u=null;async function f(h){const{data:_,error:y}=await fe.from("vehicle_state").select("*").eq("vehicle_id",h).single();return y?(console.error("Error fetching user vehicle data:",y),null):_}async function g(h,_){const{data:y,error:M}=await fe.from("vehicle_state").select(`
          *,
          profiles:vehicle_id (full_name)
        `).eq("master_map_id",h);return console.log("Vehicles:",y),M?(console.error("Error retrieving initial vehicle data:",M),[]):y.filter($=>$.vehicle_id!==_).map($=>({...$,full_name:$.profiles.full_name}))}async function d(h){const _=o.id,y=o.master_map_id,{coordinates:M,last_update:$,heading:T,vehicle_marker:S}=h;if(!M){console.warn("Coordinates not available. Skipping vehicle state update.");return}const p={vehicle_id:_,master_map_id:y,coordinates:`(${M.longitude},${M.latitude})`,last_update:new Date($).toISOString(),is_trailing:i,vehicle_marker:S,heading:T!==null?T:null};try{await c.send({type:"broadcast",event:"vehicle_update",payload:p})}catch(m){console.error("Error broadcasting vehicle state:",m)}}async function b(h,_=!1){const y=o.id,M=o.master_map_id,{coordinates:$,last_update:T,heading:S,vehicle_marker:p}=h;if(!$){console.warn("Coordinates not available. Skipping database update.");return}const m=u&&(JSON.stringify(h.vehicle_marker)!==JSON.stringify(u.vehicle_marker)||h.is_trailing!==u.is_trailing),w=Date.now();if(!(_||m||a===0||w-a>=Eu))return;const A={vehicle_id:y,master_map_id:M,coordinates:`(${$.longitude},${$.latitude})`,last_update:new Date(T).toISOString(),is_trailing:i,vehicle_marker:p,heading:S!==null?S:null},{data:P,error:O}=await fe.from("vehicle_state").upsert(A).single();O?console.error("Error updating vehicle state in database:",O):(console.log("Database updated successfully"),a=w),u={...h}}return Ge(async()=>{console.log("Initializing VehicleStateSynchronizer");const h=o.id,_=o.master_map_id,y=await f(h);if(y){const[T,S]=y.coordinates.slice(1,-1).split(",").map(parseFloat);$t.update(p=>({...p,...y,coordinates:{latitude:S,longitude:T}}))}const M=await g(_,h);console.log("Initial vehicle data:",M),mr.set(M);const $=Ur(n,t);vr.set($),c=fe.channel(`vehicle_updates_${_}`).on("broadcast",{event:"vehicle_update"},T=>{if(T.payload.vehicle_id!==h){mr.update(p=>{const m=p.findIndex(w=>w.vehicle_id===T.payload.vehicle_id);return m!==-1?p[m]={...p[m],...T.payload,full_name:p[m].full_name}:(console.log("pushing new vehicle",T.payload),p.push(T.payload)),p});const S=Ur(n,t);vr.set(S)}}).on("postgres_changes",{event:"*",schema:"public",table:"vehicle_state",filter:`master_map_id=eq.${_}`},T=>{if(T.new.vehicle_id!==h){mr.update(p=>{const m=p.findIndex(w=>w.vehicle_id===T.new.vehicle_id);return m!==-1?p[m]={...p[m],...T.new,full_name:p[m].full_name}:(console.log("pushing new vehicle from DB change",T.new),p.push(T.new)),p});const S=Ur(n,t);vr.set(S)}}).subscribe(),s=$t.subscribe(async T=>{console.log("Broadcasting vehicle state:",T),await d(T),await b(T)}),Oa.set(!0)}),mt(()=>{c&&fe.removeChannel(c),s&&s()}),[]}class $u extends ie{constructor(e){super(),se(this,e,Su,null,le,{})}}function Kr(l){if(!l)throw new Error("coord is required");if(!Array.isArray(l)){if(l.type==="Feature"&&l.geometry!==null&&l.geometry.type==="Point")return[...l.geometry.coordinates];if(l.type==="Point")return[...l.coordinates]}if(Array.isArray(l)&&l.length>=2&&!Array.isArray(l[0])&&!Array.isArray(l[1]))return[...l];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Mu(l){return l.type==="Feature"?l.geometry:l}function Iu(l,e,r={}){var t=Kr(l),n=Kr(e),o=gr(n[1]-t[1]),i=gr(n[0]-t[0]),c=gr(t[1]),s=gr(n[1]),a=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(c)*Math.cos(s);return No(2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)),r.units)}function Au(l,e={}){if(l.bbox!=null&&e.recompute!==!0)return l.bbox;const r=[1/0,1/0,-1/0,-1/0];return wr(l,t=>{r[0]>t[0]&&(r[0]=t[0]),r[1]>t[1]&&(r[1]=t[1]),r[2]<t[0]&&(r[2]=t[0]),r[3]<t[1]&&(r[3]=t[1])}),r}const bt=11102230246251565e-32,We=134217729,Lu=(3+8*bt)*bt;function Rr(l,e,r,t,n){let o,i,c,s,a=e[0],u=t[0],f=0,g=0;u>a==u>-a?(o=a,a=e[++f]):(o=u,u=t[++g]);let d=0;if(f<l&&g<r)for(u>a==u>-a?(i=a+o,c=o-(i-a),a=e[++f]):(i=u+o,c=o-(i-u),u=t[++g]),o=i,c!==0&&(n[d++]=c);f<l&&g<r;)u>a==u>-a?(i=o+a,s=i-o,c=o-(i-s)+(a-s),a=e[++f]):(i=o+u,s=i-o,c=o-(i-s)+(u-s),u=t[++g]),o=i,c!==0&&(n[d++]=c);for(;f<l;)i=o+a,s=i-o,c=o-(i-s)+(a-s),a=e[++f],o=i,c!==0&&(n[d++]=c);for(;g<r;)i=o+u,s=i-o,c=o-(i-s)+(u-s),u=t[++g],o=i,c!==0&&(n[d++]=c);return(o!==0||d===0)&&(n[d++]=o),d}function Du(l,e){let r=e[0];for(let t=1;t<l;t++)r+=e[t];return r}function ir(l){return new Float64Array(l)}const Pu=(3+16*bt)*bt,Ou=(2+12*bt)*bt,Nu=(9+64*bt)*bt*bt,Rt=ir(4),gl=ir(8),_l=ir(12),pl=ir(16),Ye=ir(4);function zu(l,e,r,t,n,o,i){let c,s,a,u,f,g,d,b,h,_,y,M,$,T,S,p,m,w;const v=l-n,A=r-n,P=e-o,O=t-o;T=v*O,g=We*v,d=g-(g-v),b=v-d,g=We*O,h=g-(g-O),_=O-h,S=b*_-(T-d*h-b*h-d*_),p=P*A,g=We*P,d=g-(g-P),b=P-d,g=We*A,h=g-(g-A),_=A-h,m=b*_-(p-d*h-b*h-d*_),y=S-m,f=S-y,Rt[0]=S-(y+f)+(f-m),M=T+y,f=M-T,$=T-(M-f)+(y-f),y=$-p,f=$-y,Rt[1]=$-(y+f)+(f-p),w=M+y,f=w-M,Rt[2]=M-(w-f)+(y-f),Rt[3]=w;let L=Du(4,Rt),F=Ou*i;if(L>=F||-L>=F||(f=l-v,c=l-(v+f)+(f-n),f=r-A,a=r-(A+f)+(f-n),f=e-P,s=e-(P+f)+(f-o),f=t-O,u=t-(O+f)+(f-o),c===0&&s===0&&a===0&&u===0)||(F=Nu*i+Lu*Math.abs(L),L+=v*u+O*c-(P*a+A*s),L>=F||-L>=F))return L;T=c*O,g=We*c,d=g-(g-c),b=c-d,g=We*O,h=g-(g-O),_=O-h,S=b*_-(T-d*h-b*h-d*_),p=s*A,g=We*s,d=g-(g-s),b=s-d,g=We*A,h=g-(g-A),_=A-h,m=b*_-(p-d*h-b*h-d*_),y=S-m,f=S-y,Ye[0]=S-(y+f)+(f-m),M=T+y,f=M-T,$=T-(M-f)+(y-f),y=$-p,f=$-y,Ye[1]=$-(y+f)+(f-p),w=M+y,f=w-M,Ye[2]=M-(w-f)+(y-f),Ye[3]=w;const z=Rr(4,Rt,4,Ye,gl);T=v*u,g=We*v,d=g-(g-v),b=v-d,g=We*u,h=g-(g-u),_=u-h,S=b*_-(T-d*h-b*h-d*_),p=P*a,g=We*P,d=g-(g-P),b=P-d,g=We*a,h=g-(g-a),_=a-h,m=b*_-(p-d*h-b*h-d*_),y=S-m,f=S-y,Ye[0]=S-(y+f)+(f-m),M=T+y,f=M-T,$=T-(M-f)+(y-f),y=$-p,f=$-y,Ye[1]=$-(y+f)+(f-p),w=M+y,f=w-M,Ye[2]=M-(w-f)+(y-f),Ye[3]=w;const W=Rr(z,gl,4,Ye,_l);T=c*u,g=We*c,d=g-(g-c),b=c-d,g=We*u,h=g-(g-u),_=u-h,S=b*_-(T-d*h-b*h-d*_),p=s*a,g=We*s,d=g-(g-s),b=s-d,g=We*a,h=g-(g-a),_=a-h,m=b*_-(p-d*h-b*h-d*_),y=S-m,f=S-y,Ye[0]=S-(y+f)+(f-m),M=T+y,f=M-T,$=T-(M-f)+(y-f),y=$-p,f=$-y,Ye[1]=$-(y+f)+(f-p),w=M+y,f=w-M,Ye[2]=M-(w-f)+(y-f),Ye[3]=w;const N=Rr(W,_l,4,Ye,pl);return pl[N-1]}function Vu(l,e,r,t,n,o){const i=(e-o)*(r-n),c=(l-n)*(t-o),s=i-c,a=Math.abs(i+c);return Math.abs(s)>=Pu*a?s:-zu(l,e,r,t,n,o,a)}function Bu(l,e){var r,t,n=0,o,i,c,s,a,u,f,g=l[0],d=l[1],b=e.length;for(r=0;r<b;r++){t=0;var h=e[r],_=h.length-1;if(u=h[0],u[0]!==h[_][0]&&u[1]!==h[_][1])throw new Error("First and last coordinates in a ring must be the same");for(i=u[0]-g,c=u[1]-d,t;t<_;t++){if(f=h[t+1],s=f[0]-g,a=f[1]-d,c===0&&a===0){if(s<=0&&i>=0||i<=0&&s>=0)return 0}else if(a>=0&&c<=0||a<=0&&c>=0){if(o=Vu(i,s,c,a,0,0),o===0)return 0;(o>0&&a>0&&c<=0||o<0&&a<=0&&c>0)&&n++}u=f,c=a,i=s}}return n%2!==0}function Qr(l,e,r={}){if(!l)throw new Error("point is required");if(!e)throw new Error("polygon is required");const t=Kr(l),n=Mu(e),o=n.type,i=e.bbox;let c=n.coordinates;if(i&&Fu(t,i)===!1)return!1;o==="Polygon"&&(c=[c]);let s=!1;for(var a=0;a<c.length;++a){const u=Bu(t,c[a]);if(u===0)return!r.ignoreBoundary;u&&(s=!0)}return s}function Fu(l,e){return e[0]<=l[0]&&e[1]<=l[1]&&e[2]>=l[0]&&e[3]>=l[1]}function xr(l,e={}){const r=Au(l),t=(r[0]+r[2])/2,n=(r[1]+r[3])/2;return tr([t,n],e.properties,e)}function Uu(l){if(!l)throw new Error("geojson is required");switch(l.type){case"Feature":return fo(l);case"FeatureCollection":return Ru(l);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return an(l);default:throw new Error("unknown GeoJSON type")}}function fo(l){const e={type:"Feature"};return Object.keys(l).forEach(r=>{switch(r){case"type":case"properties":case"geometry":return;default:e[r]=l[r]}}),e.properties=ho(l.properties),l.geometry==null?e.geometry=null:e.geometry=an(l.geometry),e}function ho(l){const e={};return l&&Object.keys(l).forEach(r=>{const t=l[r];typeof t=="object"?t===null?e[r]=null:Array.isArray(t)?e[r]=t.map(n=>n):e[r]=ho(t):e[r]=t}),e}function Ru(l){const e={type:"FeatureCollection"};return Object.keys(l).forEach(r=>{switch(r){case"type":case"features":return;default:e[r]=l[r]}}),e.features=l.features.map(r=>fo(r)),e}function an(l){const e={type:l.type};return l.bbox&&(e.bbox=l.bbox),l.type==="GeometryCollection"?(e.geometries=l.geometries.map(r=>an(r)),e):(e.coordinates=mo(l.coordinates),e)}function mo(l){const e=l;return typeof e[0]!="object"?e.slice():e.map(r=>mo(r))}function Hu(l){const e=[];return l.type==="FeatureCollection"?eo(l,function(r){wr(r,function(t){e.push(tr(t,r.properties))})}):l.type==="Feature"?wr(l,function(r){e.push(tr(r,l.properties))}):wr(l,function(r){e.push(tr(r))}),Tr(e)}var qu=Object.defineProperty,Wu=Object.defineProperties,ju=Object.getOwnPropertyDescriptors,bl=Object.getOwnPropertySymbols,Gu=Object.prototype.hasOwnProperty,Yu=Object.prototype.propertyIsEnumerable,vl=(l,e,r)=>e in l?qu(l,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):l[e]=r,wl=(l,e)=>{for(var r in e||(e={}))Gu.call(e,r)&&vl(l,r,e[r]);if(bl)for(var r of bl(e))Yu.call(e,r)&&vl(l,r,e[r]);return l},kl=(l,e)=>Wu(l,ju(e));function Xu(l,e,r={}){if(!l)throw new Error("targetPoint is required");if(!e)throw new Error("points is required");let t=1/0,n=0;eo(e,(i,c)=>{const s=Iu(l,i,r);s<t&&(n=c,t=s)});const o=Uu(e.features[n]);return kl(wl({},o),{properties:kl(wl({},o.properties),{featureIndex:n,distanceToPoint:t})})}function yl(l){const e=Zu(l),r=xr(e);let t=!1,n=0;for(;!t&&n<e.features.length;){const o=e.features[n].geometry;let i,c,s,a,u,f,g=!1;if(o.type==="Point")r.geometry.coordinates[0]===o.coordinates[0]&&r.geometry.coordinates[1]===o.coordinates[1]&&(t=!0);else if(o.type==="MultiPoint"){let d=!1,b=0;for(;!d&&b<o.coordinates.length;)r.geometry.coordinates[0]===o.coordinates[b][0]&&r.geometry.coordinates[1]===o.coordinates[b][1]&&(t=!0,d=!0),b++}else if(o.type==="LineString"){let d=0;for(;!g&&d<o.coordinates.length-1;)i=r.geometry.coordinates[0],c=r.geometry.coordinates[1],s=o.coordinates[d][0],a=o.coordinates[d][1],u=o.coordinates[d+1][0],f=o.coordinates[d+1][1],Tl(i,c,s,a,u,f)&&(g=!0,t=!0),d++}else if(o.type==="MultiLineString"){let d=0;for(;d<o.coordinates.length;){g=!1;let b=0;const h=o.coordinates[d];for(;!g&&b<h.length-1;)i=r.geometry.coordinates[0],c=r.geometry.coordinates[1],s=h[b][0],a=h[b][1],u=h[b+1][0],f=h[b+1][1],Tl(i,c,s,a,u,f)&&(g=!0,t=!0),b++;d++}}else(o.type==="Polygon"||o.type==="MultiPolygon")&&Qr(r,o)&&(t=!0);n++}if(t)return r;{const o=Tr([]);for(let i=0;i<e.features.length;i++)o.features=o.features.concat(Hu(e.features[i]).features);return tr(Xu(r,o).geometry.coordinates)}}function Zu(l){return l.type!=="FeatureCollection"?l.type!=="Feature"?Tr([zo(l)]):Tr([l]):l}function Tl(l,e,r,t,n,o){const i=Math.sqrt((n-r)*(n-r)+(o-t)*(o-t)),c=Math.sqrt((l-r)*(l-r)+(e-t)*(e-t)),s=Math.sqrt((n-l)*(n-l)+(o-e)*(o-e));return i===c+s}function Ju(l,e,r){let t;re(l,Xr,s=>r(1,t=s));let{map:n}=e;function o(s){if(console.log("Calculating bounding box for",s.length,"fields"),s.length===0)return console.warn("No fields to calculate bounding box"),null;const a=new Ke.LngLatBounds;return s.forEach((u,f)=>{(u.boundary.type==="Polygon"?u.boundary.coordinates[0]:u.boundary.coordinates.flat(1)).forEach(([d,b],h)=>{if(isNaN(d)||isNaN(b)){console.warn(`Invalid coordinate at field ${f}, coordinate ${h}: [${d}, ${b}]`);return}a.extend(new Ke.LngLat(d,b))})}),a.isEmpty()?(console.warn("Unable to calculate valid bounding box"),null):(console.log("Calculated bounding box:",a.toArray()),a)}function i(){if(n.getLayer("fields-labels")){const s=n.getZoom();n.removeLayer("fields-labels"),n.addLayer({id:"fields-labels",type:"symbol",source:"label-points",layout:{"text-field":["get","name"],"text-anchor":"center","symbol-sort-key":-1,"text-font":["DIN Pro Bold","Arial Unicode MS Bold"],"text-size":["interpolate",["linear"],["zoom"],10,0,11,8,13,12,15,28,17,48,19,96,20,120],"text-allow-overlap":!0,"text-ignore-placement":!1},paint:{"text-color":"#ffffff","text-halo-color":"#000000","text-halo-width":2}}),n.setZoom(s)}}function c(){const s=wo(Xr);if(console.log("Loading fields from",t),s.length>0){const a={type:"FeatureCollection",features:s.map((g,d)=>({type:"Feature",geometry:g.boundary,properties:{id:d,area:g.area,name:g.name}}))},u={type:"FeatureCollection",features:s.flatMap((g,d)=>{try{if(g.boundary.type==="Polygon"){const b=pn(g.boundary.coordinates),h=xr(b);return[{type:"Feature",geometry:(Qr(h.geometry.coordinates,b)?h:yl(b)).geometry,properties:{id:d,name:g.name}}]}else return g.boundary.type==="MultiPolygon"?g.boundary.coordinates.map(b=>{const h=pn(b),_=xr(h);return{type:"Feature",geometry:(Qr(_.geometry.coordinates,h)?_:yl(h)).geometry,properties:{id:d,name:g.name}}}):(console.warn(`Invalid geometry type for field ${d}: ${g.boundary.type}`),[])}catch(b){return console.warn(`Error processing field ${d}:`,b),[]}}).filter(g=>g!==null)};n.addSource("fields",{type:"geojson",data:a}),n.addSource("label-points",{type:"geojson",data:u}),n.addLayer({id:"fields-fill",type:"fill",source:"fields",paint:{"fill-color":"#0080ff","fill-opacity":.2}}),n.addLayer({id:"fields-outline",type:"line",source:"fields",paint:{"line-color":"#bfffbf","line-opacity":.5,"line-width":2}}),n.addLayer({id:"fields-labels",type:"symbol",source:"label-points",layout:{"text-field":["get","name"],"text-anchor":"center","symbol-sort-key":-1,"text-font":["DIN Pro Bold","Arial Unicode MS Bold"],"text-size":["interpolate",["linear"],["zoom"],10,0,11,8,13,12,15,28,17,48,19,96,20,120],"text-allow-overlap":!0,"text-ignore-placement":!1},paint:{"text-color":"#ffffff","text-halo-color":"#000000","text-halo-width":2}}),setTimeout(()=>{i()},1e4),setTimeout(()=>{i()},2e4);const f=o(s);f?(so.set(f.toArray()),console.log("Stored field bounding box")):console.warn("Unable to calculate valid bounding box")}}return Ge(()=>{if(!n){console.error("Map is not available");return}return console.log("MapFields component mounted"),n.loaded()?c():n.on("load",c),()=>{n.off("load",c)}}),l.$$set=s=>{"map"in s&&r(0,n=s.map)},[n]}class Ku extends ie{constructor(e){super(),se(this,e,Ju,null,le,{map:0})}}const Qu=300;function Cl(l,e){return l.reduce((r,t)=>{const n=t[e];return r[n]||(r[n]=[]),r[n].push(t),r},{})}const xu={timeoutMinutes:24*60,closeStaleTrails:!0,notifyOnClose:!0};function ef(l,e,r){const t=r.longitude-e.longitude,n=r.latitude-e.latitude;if(t===0&&n===0){const c=l.longitude-e.longitude,s=l.latitude-e.latitude;return Math.sqrt(c*c+s*s)}const o=Math.abs(n*l.longitude-t*l.latitude+r.longitude*e.latitude-r.latitude*e.longitude),i=Math.sqrt(t*t+n*n);return o/i}function en(l,e){if(l.length<=2)return l;let r=0,t=0;const n=l[0],o=l[l.length-1];for(let i=1;i<l.length-1;i++){const c=ef(l[i],n,o);c>r&&(r=c,t=i)}if(r>e){const i=en(l.slice(0,t+1),e),c=en(l.slice(t),e);return[...i.slice(0,-1),...c]}else return[n,o]}async function go(l,e,r){if(!r||r.length===0)return await fe.rpc("close_trail",{trail_id_param:l,end_time_param:e,path_param:null,detailed_path_param:null});const n=`SRID=4326;LINESTRING M(${r.map(s=>`${s.longitude} ${s.latitude} ${s.timestamp}`).join(",")})`,c=`SRID=4326;LINESTRING(${en(r,5e-6).map(s=>`${s.longitude} ${s.latitude}`).join(",")})`;return await fe.rpc("close_trail",{trail_id_param:l,end_time_param:e,path_param:c,detailed_path_param:n})}async function El(l,e){console.log(`
Checking freshness for trail ${l}`),console.log(`Timeout threshold: ${e} minutes`);const{data:r,error:t}=await fe.from("trail_stream").select("*").eq("trail_id",l).order("timestamp",{ascending:!1}).limit(1),n=new Date;let o,i;if(t||!r?.[0]?.timestamp){const{data:s}=await fe.from("trails").select("start_time").eq("id",l).single();i=s?.start_time||n.toISOString(),o=new Date(i),console.log("No points found, using trail start time as last activity")}else i=r[0].timestamp,o=new Date(i),console.log("Using last point timestamp as last activity");const c=(n.getTime()-o.getTime())/(1e3*60);return console.log(`Current time: ${n.toISOString()}`),console.log(`Last activity time: ${o.toISOString()}`),console.log(`Minutes since last activity: ${c.toFixed(2)}`),console.log(`Is fresh: ${c<=e}
`),{isFresh:c<=e,lastTimestamp:i,lastPoint:r?.[0]}}async function tn(l){console.log(`Processing and closing trail ${l}`);const{data:e,error:r}=await fe.from("trail_stream").select("*").eq("trail_id",l).order("timestamp",{ascending:!0});if(r)throw new Error(`Error fetching points for trail ${l}: ${r.message}`);if(!e||e.length<3)return console.log(`Trail ${l} has insufficient points (${e?.length||0}), deleting`),await fe.from("trail_stream").delete().eq("trail_id",l),await fe.from("trails").delete().eq("id",l),{deleted:!0,reason:"insufficient_points"};const t=e.map(i=>({longitude:i.coordinate.coordinates[0],latitude:i.coordinate.coordinates[1],timestamp:new Date(i.timestamp).getTime()})),n=e[e.length-1].timestamp,o=await go(l,n,t);if(o.error)throw new Error(`Failed to close trail: ${o.error.message}`);return{deleted:!1,closed:!0,message:"Trail closed successfully"}}async function tf(l,e,r={}){console.log(`
Handling open trails for vehicle ${l}`);const t={...xu,...r};let n=fe.from("trails").select("*").eq("vehicle_id",l).is("end_time",null).order("start_time",{ascending:!1});const{data:o,error:i}=await n;if(i)throw new Error(`Error fetching open trails: ${i.message}`);if(!o||o.length===0)return console.log("No open trails found"),{mostRecentTrail:null,processedTrails:[]};console.log(`Found ${o.length} open trails`);let[c,...s]=o;const a=[],{isFresh:u,lastTimestamp:f,lastPoint:g}=await El(c.id,t.timeoutMinutes);if(!u&&t.closeStaleTrails){console.log(`Trail ${c.id} is stale, processing for closure`);const d=await tn(c.id);a.push({trail_id:c.id,result:d,reason:`Trail inactive for more than ${t.timeoutMinutes} minutes`,last_activity:f}),c=null}else u&&console.log(`Trail ${c.id} is still active`);for(const d of s){console.log(`
Processing older trail ${d.id}`);const{lastTimestamp:b}=await El(d.id,t.timeoutMinutes),h=await tn(d.id);a.push({trail_id:d.id,result:h,reason:"older_trail",last_activity:b})}return{mostRecentTrail:c,processedTrails:a,config:t,staleTrailClosed:!u&&t.closeStaleTrails,lastActivity:f}}const _t={async closeTrail(l){try{console.log(`Closing trail ${l.trail_id}`);const{data:e}=await fe.auth.getSession();if(!e?.session?.user)throw console.error("No authenticated user session"),new Error("Authentication required");const r=l.path.map(i=>({longitude:i.longitude,latitude:i.latitude,timestamp:i.timestamp})),{error:t}=await go(l.trail_id,new Date().toISOString(),r);if(t)throw console.error("Error closing trail:",t),new Error(`Failed to close trail: ${t.message}`);const{data:n,error:o}=await fe.from("trails").select("*").eq("id",l.trail_id).single();return o&&console.error("Error fetching updated trail:",o),{success:!0,trail:n||{id:l.trail_id,vehicle_id:l.vehicle_id,operation_id:l.operation_id,trail_color:l.trail_color,trail_width:l.trail_width}}}catch(e){return console.error("Error in closeTrail:",e),{error:!0,message:e.message||"Failed to close trail"}}},async loadMapTrails(l){try{console.log("Loading trail data for master map ID:",l);const{data:e}=await fe.auth.getSession();if(!e?.session?.user)throw console.error("No authenticated user session"),new Error("Authentication required");const r=e.session.user.id;if(!l)throw console.error("No master map ID provided"),new Error("Master map ID is required");const t=Date.now()-Qu*24*60*60*1e3;console.log("Fetching user trail data...");const{data:n,error:o}=await fe.from("trail_data").select("*").eq("master_map_id",l).eq("vehicle_id",r).gte("timestamp",t).order("timestamp",{ascending:!0});if(o)throw console.error("Error fetching user trail data:",o),o;console.log(`Retrieved ${n?.length||0} user trail data points`),console.log("Fetching other users' trail data...");const{data:i,error:c}=await fe.rpc("get_other_trail_data",{p_master_map_id:l,p_user_id:r,p_retention_timestamp:t});if(c)throw console.error("Error fetching other trail data:",c),c;console.log(`Retrieved ${i?.length||0} other trail data points`);const s=Cl(n||[],"vehicle_id"),a=Cl(i||[],"vehicle_id");return{user:s,other:a}}catch(e){return console.error("Error in loadMapTrails:",e),{error:!0,message:e.message||"An error occurred while loading trail data",user:{},other:{}}}},async checkOpenTrails(l,e){try{console.log(`Checking open trails for vehicle ${l}`);const{data:r}=await fe.auth.getSession();if(!r?.session?.user)throw console.error("No authenticated user session"),new Error("Authentication required");if(!l)throw new Error("Missing vehicle_id");const t=await tf(l,void 0,{timeoutMinutes:e||30,closeStaleTrails:!0,notifyOnClose:!0}),{mostRecentTrail:n,processedTrails:o,staleTrailClosed:i,lastActivity:c}=t;if(i)return console.log("Trail was closed due to being stale, considering all trails inactive"),{openTrail:null,trailData:null,processedTrails:o,staleTrailClosed:i,lastActivity:c};if(n&&!i){console.log(`Fetching data for active trail ${n.id}`);const{data:s,error:a}=await fe.from("trail_stream").select("coordinate, timestamp").eq("trail_id",n.id).order("timestamp",{ascending:!0});if(a)throw new Error(`Failed to fetch trail data: ${a.message}`);const u=s.map(f=>({coordinates:{latitude:f.coordinate.coordinates[1],longitude:f.coordinate.coordinates[0]},timestamp:new Date(f.timestamp).getTime()}));return{openTrail:n,trailData:u,processedTrails:o,staleTrailClosed:i,lastActivity:c}}return console.log("No active trails found"),{openTrail:null,trailData:null,processedTrails:o,staleTrailClosed:i,lastActivity:c}}catch(r){return console.error("Error in checkOpenTrails:",r),{error:!0,message:r.message||"An unexpected error occurred while checking open trails"}}},async checkOtherActiveTrails(l,e){try{console.log(`Checking other active trails for operation ${l}`);const{data:r}=await fe.auth.getSession();if(!r?.session?.user)throw console.error("No authenticated user session"),new Error("Authentication required");if(!l||!e)throw new Error("Missing required parameters");const{data:t,error:n}=await fe.from("trails").select(`
                    id,
                    vehicle_id,
                    operation_id,
                    start_time,
                    end_time,
                    trail_color,
                    trail_width
                    `).eq("operation_id",l).neq("vehicle_id",e).is("end_time",null).order("start_time",{ascending:!1});if(n)throw n;const o=t.reduce((s,a)=>(s[a.vehicle_id]||(s[a.vehicle_id]=[]),s[a.vehicle_id].push(a),s),{}),i=[],c=[];for(const[s,a]of Object.entries(o)){if(a.length===0)continue;const[u,...f]=a;if(f.length>0){console.log(`Found ${f.length} additional open trails for vehicle ${s}`);for(const g of f){console.log(`Processing trail ${g.id} for vehicle ${s} (started at ${g.start_time})`);try{const d=await tn(g.id);d.deleted?console.log(`Deleted trail ${g.id} - ${d.reason}`):console.log(`Successfully closed trail ${g.id}`)}catch(d){const b=`Error processing trail ${g.id}: ${d.message}`;console.error(b),i.push(b)}}}try{const{data:g,error:d}=await fe.from("trail_stream").select("coordinate, timestamp").eq("trail_id",u.id).order("timestamp",{ascending:!0});if(d){d.code==="57014"?i.push(`Timeout error while loading trail data for vehicle ${s}`):i.push(`Error loading trail data for vehicle ${s}: ${d.message}`);continue}const b=g.map(h=>({coordinates:{latitude:h.coordinate.coordinates[1],longitude:h.coordinate.coordinates[0]},timestamp:new Date(h.timestamp).getTime()}));c.push({...u,trailData:b})}catch(g){i.push(`Error processing trail data for vehicle ${s}: ${g.message}`)}}return{activeTrails:c,errors:i.length>0?i:void 0}}catch(r){return console.error("Error in checkOtherActiveTrails:",r),{error:!0,message:r.message||"Failed to fetch active trails",code:r?.code}}},async deleteTrail(l){try{console.log(`Deleting trail ${l}`);const{data:e}=await fe.auth.getSession();if(!e?.session?.user)throw console.error("No authenticated user session"),new Error("Authentication required");const{error:r}=await fe.from("trail_stream").delete().eq("trail_id",l);r&&console.error("Error deleting trail points:",r);const{error:t}=await fe.from("trails").delete().eq("id",l);if(t)throw console.error("Error deleting trail:",t),new Error(`Failed to delete trail: ${t.message}`);return{success:!0,message:"Trail deleted successfully"}}catch(e){return console.error("Error in deleteTrail:",e),{error:!0,message:e.message||"Failed to delete trail"}}},async openNewTrail(l,e,r){try{console.log(`Creating new trail for vehicle ${l} in operation ${e}`);const{data:t}=await fe.auth.getSession();if(!t?.session?.user)throw console.error("No authenticated user session"),new Error("Authentication required");const o={id:crypto.randomUUID(),vehicle_id:l,operation_id:e,start_time:new Date().toISOString(),trail_color:r.vehicle_marker?.bodyColor||"#000000",trail_width:r.vehicle_marker?.swath||11},{data:i,error:c}=await fe.from("trails").insert([o]).select("*");if(c)throw console.error("Error creating new trail:",c),new Error(`Failed to create new trail: ${c.message}`);if(!i||i.length===0)throw new Error("No trail data returned after creation");return{trail:i[0]}}catch(t){return console.error("Error in openNewTrail:",t),{error:!0,message:t.message||"Failed to create new trail"}}},async saveCoordinates(l,e,r){try{console.log(`Saving ${r.length} coordinates for trail ${e}`);const{data:t}=await fe.auth.getSession();if(!t?.session?.user)throw console.error("No authenticated user session"),new Error("Authentication required");if(!e||!r||r.length===0)throw new Error("Missing required fields");const n=r.map(({coordinates:c,timestamp:s})=>({operation_id:l,trail_id:e,coordinate:`POINT(${c.longitude} ${c.latitude})`,timestamp:new Date(s).toISOString()})),{data:o,error:i}=await fe.from("trail_stream").insert(n).select();if(i)throw console.error("Error saving coordinates:",i),new Error(`Failed to save coordinates: ${i.message}`);return console.log(`Successfully saved ${o.length} coordinates`),{coordinates:o}}catch(t){return console.error("Error in saveCoordinates:",t),{error:!0,message:t.message||"Failed to save coordinates"}}}};function Sl(l){let e,r,t,n,o,i="Close",c,s,a;const u=[nf,rf],f=[];function g(d,b){return d[5]?0:1}return r=g(l),t=f[r]=u[r](l),{c(){e=B("div"),t.c(),n=K(),o=B("label"),o.textContent=i,this.h()},l(d){e=V(d,"DIV",{class:!0});var b=H(e);t.l(b),n=J(b),o=V(b,"LABEL",{class:!0,for:!0,"data-svelte-h":!0}),Ce(o)!=="svelte-jlumqq"&&(o.textContent=i),b.forEach(k),this.h()},h(){D(o,"class","modal-backdrop"),D(o,"for","end-trail-modal"),D(e,"class","modal modal-open")},m(d,b){U(d,e,b),f[r].m(e,null),I(e,n),I(e,o),c=!0,s||(a=Se(o,"click",l[7]),s=!0)},p(d,b){let h=r;r=g(d),r===h?f[r].p(d,b):(de(),E(f[h],1,1,()=>{f[h]=null}),he(),t=f[r],t?t.p(d,b):(t=f[r]=u[r](d),t.c()),C(t,1),t.m(e,n))},i(d){c||(C(t),c=!0)},o(d){E(t),c=!1},d(d){d&&k(e),f[r].d(),s=!1,a()}}}function rf(l){let e,r,t="End Trail Submission",n,o,i,c,s="Start Time (UTC):",a,u=new Date(l[2].start_time).toUTCString()+"",f,g,d,b,h="Current Time (UTC):",_,y=l[1].toUTCString()+"",M,$,T,S,p="Duration:",m,w,v,A,P,O="Raw Time Difference (ms):",L,F,z,W,N,R="Trail Color:",X,Z,te,q=l[2].trail_color+"",x,pe,_e,ye,Me="Trail Width:",ae,oe=l[2].trail_width+"",Ie,ue,Le,Pe,Re,Yt="Number of Coordinates:",Je,wt=l[2].path.length+"",Lt,Vt,Bt,nt,ct,Dt,Ar,Pt,kt,cn="Submit Trail",Lr,yt,un="Continue",xe,Dr,fn,He=l[6].length>0&&$l(l);return Dt=new to({props:{size:20}}),{c(){e=B("div"),r=B("h3"),r.textContent=t,n=K(),o=B("div"),i=B("p"),c=B("strong"),c.textContent=s,a=K(),f=ge(u),g=K(),d=B("p"),b=B("strong"),b.textContent=h,_=K(),M=ge(y),$=K(),T=B("p"),S=B("strong"),S.textContent=p,m=K(),w=ge(l[4]),v=K(),A=B("p"),P=B("strong"),P.textContent=O,L=K(),F=ge(l[0]),z=K(),W=B("p"),N=B("strong"),N.textContent=R,X=K(),Z=B("span"),te=K(),x=ge(q),pe=K(),_e=B("p"),ye=B("strong"),ye.textContent=Me,ae=K(),Ie=ge(oe),ue=ge("px"),Le=K(),Pe=B("p"),Re=B("strong"),Re.textContent=Yt,Je=K(),Lt=ge(wt),Vt=K(),He&&He.c(),Bt=K(),nt=B("div"),ct=B("button"),Y(Dt.$$.fragment),Ar=K(),Pt=B("div"),kt=B("button"),kt.textContent=cn,Lr=K(),yt=B("button"),yt.textContent=un,this.h()},l(ze){e=V(ze,"DIV",{class:!0});var Be=H(e);r=V(Be,"H3",{class:!0,"data-svelte-h":!0}),Ce(r)!=="svelte-3agsw4"&&(r.textContent=t),n=J(Be),o=V(Be,"DIV",{class:!0});var qe=H(o);i=V(qe,"P",{});var sr=H(i);c=V(sr,"STRONG",{"data-svelte-h":!0}),Ce(c)!=="svelte-1ygkz80"&&(c.textContent=s),a=J(sr),f=me(sr,u),sr.forEach(k),g=J(qe),d=V(qe,"P",{});var ar=H(d);b=V(ar,"STRONG",{"data-svelte-h":!0}),Ce(b)!=="svelte-65n9tn"&&(b.textContent=h),_=J(ar),M=me(ar,y),ar.forEach(k),$=J(qe),T=V(qe,"P",{});var cr=H(T);S=V(cr,"STRONG",{"data-svelte-h":!0}),Ce(S)!=="svelte-1on1bp8"&&(S.textContent=p),m=J(cr),w=me(cr,l[4]),cr.forEach(k),v=J(qe),A=V(qe,"P",{});var ur=H(A);P=V(ur,"STRONG",{"data-svelte-h":!0}),Ce(P)!=="svelte-1wg6fgl"&&(P.textContent=O),L=J(ur),F=me(ur,l[0]),ur.forEach(k),z=J(qe),W=V(qe,"P",{});var Ft=H(W);N=V(Ft,"STRONG",{"data-svelte-h":!0}),Ce(N)!=="svelte-1au0zqn"&&(N.textContent=R),X=J(Ft),Z=V(Ft,"SPAN",{class:!0,style:!0}),H(Z).forEach(k),te=J(Ft),x=me(Ft,q),Ft.forEach(k),pe=J(qe),_e=V(qe,"P",{});var Xt=H(_e);ye=V(Xt,"STRONG",{"data-svelte-h":!0}),Ce(ye)!=="svelte-1uw2qy2"&&(ye.textContent=Me),ae=J(Xt),Ie=me(Xt,oe),ue=me(Xt,"px"),Xt.forEach(k),Le=J(qe),Pe=V(qe,"P",{});var fr=H(Pe);Re=V(fr,"STRONG",{"data-svelte-h":!0}),Ce(Re)!=="svelte-kcko15"&&(Re.textContent=Yt),Je=J(fr),Lt=me(fr,wt),fr.forEach(k),Vt=J(qe),He&&He.l(qe),qe.forEach(k),Bt=J(Be),nt=V(Be,"DIV",{class:!0});var dr=H(nt);ct=V(dr,"BUTTON",{class:!0});var dn=H(ct);Q(Dt.$$.fragment,dn),dn.forEach(k),Ar=J(dr),Pt=V(dr,"DIV",{});var hr=H(Pt);kt=V(hr,"BUTTON",{class:!0,"data-svelte-h":!0}),Ce(kt)!=="svelte-160kdpc"&&(kt.textContent=cn),Lr=J(hr),yt=V(hr,"BUTTON",{class:!0,"data-svelte-h":!0}),Ce(yt)!=="svelte-txagx3"&&(yt.textContent=un),hr.forEach(k),dr.forEach(k),Be.forEach(k),this.h()},h(){D(r,"class","text-lg font-bold"),D(Z,"class","inline-block h-4 w-4"),Ae(Z,"background-color",l[2].trail_color),D(o,"class","py-4"),D(ct,"class","btn btn-square btn-error"),D(kt,"class","btn btn-primary ml-2"),D(yt,"class","btn ml-2"),D(nt,"class","modal-action flex justify-between"),D(e,"class","modal-box")},m(ze,Be){U(ze,e,Be),I(e,r),I(e,n),I(e,o),I(o,i),I(i,c),I(i,a),I(i,f),I(o,g),I(o,d),I(d,b),I(d,_),I(d,M),I(o,$),I(o,T),I(T,S),I(T,m),I(T,w),I(o,v),I(o,A),I(A,P),I(A,L),I(A,F),I(o,z),I(o,W),I(W,N),I(W,X),I(W,Z),I(W,te),I(W,x),I(o,pe),I(o,_e),I(_e,ye),I(_e,ae),I(_e,Ie),I(_e,ue),I(o,Le),I(o,Pe),I(Pe,Re),I(Pe,Je),I(Pe,Lt),I(o,Vt),He&&He.m(o,null),I(e,Bt),I(e,nt),I(nt,ct),G(Dt,ct,null),I(nt,Ar),I(nt,Pt),I(Pt,kt),I(Pt,Lr),I(Pt,yt),xe=!0,Dr||(fn=[Se(ct,"click",l[8]),Se(kt,"click",l[11]),Se(yt,"click",l[7])],Dr=!0)},p(ze,Be){(!xe||Be&4)&&u!==(u=new Date(ze[2].start_time).toUTCString()+"")&&Fe(f,u),(!xe||Be&2)&&y!==(y=ze[1].toUTCString()+"")&&Fe(M,y),(!xe||Be&16)&&Fe(w,ze[4]),(!xe||Be&1)&&Fe(F,ze[0]),(!xe||Be&4)&&Ae(Z,"background-color",ze[2].trail_color),(!xe||Be&4)&&q!==(q=ze[2].trail_color+"")&&Fe(x,q),(!xe||Be&4)&&oe!==(oe=ze[2].trail_width+"")&&Fe(Ie,oe),(!xe||Be&4)&&wt!==(wt=ze[2].path.length+"")&&Fe(Lt,wt),ze[6].length>0?He?He.p(ze,Be):(He=$l(ze),He.c(),He.m(o,null)):He&&(He.d(1),He=null)},i(ze){xe||(C(Dt.$$.fragment,ze),xe=!0)},o(ze){E(Dt.$$.fragment,ze),xe=!1},d(ze){ze&&k(e),He&&He.d(),j(Dt),Dr=!1,vt(fn)}}}function nf(l){let e,r,t="Confirm Delete Trail",n,o,i=`<p>Are you sure you want to delete this trail? This action cannot be
            undone.</p>`,c,s,a,u="Confirm Delete",f,g,d="Cancel",b,h;return{c(){e=B("div"),r=B("h3"),r.textContent=t,n=K(),o=B("div"),o.innerHTML=i,c=K(),s=B("div"),a=B("button"),a.textContent=u,f=K(),g=B("button"),g.textContent=d,this.h()},l(_){e=V(_,"DIV",{class:!0});var y=H(e);r=V(y,"H3",{class:!0,"data-svelte-h":!0}),Ce(r)!=="svelte-1bidisu"&&(r.textContent=t),n=J(y),o=V(y,"DIV",{class:!0,"data-svelte-h":!0}),Ce(o)!=="svelte-1teiw7t"&&(o.innerHTML=i),c=J(y),s=V(y,"DIV",{class:!0});var M=H(s);a=V(M,"BUTTON",{class:!0,"data-svelte-h":!0}),Ce(a)!=="svelte-1m4fmxi"&&(a.textContent=u),f=J(M),g=V(M,"BUTTON",{class:!0,"data-svelte-h":!0}),Ce(g)!=="svelte-1a5gsau"&&(g.textContent=d),M.forEach(k),y.forEach(k),this.h()},h(){D(r,"class","text-lg font-bold text-red-600"),D(o,"class","py-4"),D(a,"class","btn btn-error"),D(g,"class","btn"),D(s,"class","modal-action"),D(e,"class","modal-box")},m(_,y){U(_,e,y),I(e,r),I(e,n),I(e,o),I(e,c),I(e,s),I(s,a),I(s,f),I(s,g),b||(h=[Se(a,"click",l[10]),Se(g,"click",l[9])],b=!0)},p:Ee,i:Ee,o:Ee,d(_){_&&k(e),b=!1,vt(h)}}}function $l(l){let e,r,t,n=l[6].length+"",o,i;return{c(){e=B("div"),r=B("p"),t=ge("There are "),o=ge(n),i=ge(" unsaved trails pending sync"),this.h()},l(c){e=V(c,"DIV",{class:!0});var s=H(e);r=V(s,"P",{class:!0});var a=H(r);t=me(a,"There are "),o=me(a,n),i=me(a," unsaved trails pending sync"),a.forEach(k),s.forEach(k),this.h()},h(){D(r,"class","text-yellow-800"),D(e,"class","mt-4 rounded bg-yellow-100 p-4")},m(c,s){U(c,e,s),I(e,r),I(r,t),I(r,o),I(r,i)},p(c,s){s&64&&n!==(n=c[6].length+"")&&Fe(o,n)},d(c){c&&k(e)}}}function lf(l){let e,r,t=l[3]&&l[2]&&Sl(l);return{c(){t&&t.c(),e=ne()},l(n){t&&t.l(n),e=ne()},m(n,o){t&&t.m(n,o),U(n,e,o),r=!0},p(n,[o]){n[3]&&n[2]?t?(t.p(n,o),o&12&&C(t,1)):(t=Sl(n),t.c(),C(t,1),t.m(e.parentNode,e)):t&&(de(),E(t,1,1,()=>{t=null}),he())},i(n){r||(C(t),r=!0)},o(n){E(t),r=!1},d(n){n&&k(e),t&&t.d(n)}}}function of(l){const e=Math.floor(l/36e5),r=Math.floor(l%36e5/6e4),t=Math.floor(l%6e4/1e3);return`${e}h ${r}m ${t}s`}function sf(l,e,r){let t,n,o;re(l,st,T=>r(2,t=T)),re(l,Kt,T=>r(6,n=T)),re(l,Ht,T=>r(3,o=T));let i,c,s,a,u=!1;Ge(async()=>{await Bl(),n.length>0&&g()}),mt(()=>{a&&clearInterval(a)});async function f(T){try{const S=await _t.deleteTrail(T);if(S.error)throw new Error(S.message||"Failed to delete trail");ce.success("Trail deleted successfully"),st.set(null),at.set(!1),Ht.set(!1),r(5,u=!1)}catch(S){console.error("Error deleting trail:",S),ce.error(`Failed to delete trail: ${S.message}`)}}function g(){a=setInterval(d,3e4)}async function d(){if(!n.length){clearInterval(a);return}console.log("Attempting to sync unsaved trails:",n.length);for(const T of n)try{const S=await _t.closeTrail(T);if(S.error)throw new Error(S.message||"Failed to close trail");Kt.remove(T),Et.clear(),ce.success(`Successfully synced trail ${T.trail_id}`)}catch(S){console.error(`Error syncing trail: ${S.message}`),!S.message.includes("Failed to fetch")&&!S.message.includes("ERR_INTERNET_DISCONNECTED")&&(Kt.remove(T),ce.error(`Failed to sync trail ${T.trail_id}: ${S.message}`))}n.length===0&&clearInterval(a)}function b(){Ht.set(!1),at.set(!0),r(5,u=!1)}function h(){r(5,u=!0)}function _(){r(5,u=!1)}async function y(){t&&await f(t.id)}async function M(){if(!t){ce.error("No active trail to close");return}console.log("Submitting trail data:",t);const T=t.path.map(p=>({latitude:p.coordinates.latitude,longitude:p.coordinates.longitude,timestamp:p.timestamp}));if(T.length===0||T.length===1){const p=T.length===0?"empty trail":"trail with only one coordinate";ce.info(`Deleting ${p}`),await _t.deleteTrail(t.id);return}const S={trail_id:t.id,vehicle_id:t.vehicle_id,operation_id:t.operation_id,path:T,trail_color:t.trail_color,trail_width:t.trail_width};try{const p=await _t.closeTrail(S);if(p.error)throw new Error(p.message||"Failed to close trail");const m={type:"LineString",coordinates:T.map(v=>[v.longitude,v.latitude])},w={...p.trail,path:m};it.update(v=>[...v,w]),ce.success("Trail closed successfully"),console.log("Trail closed successfully:",p),Et.clear(),st.set(null),at.set(!1)}catch(p){console.error("Error closing trail:",p),p.message.includes("Failed to fetch")||p.message.includes("ERR_INTERNET_DISCONNECTED")?(ce.error("Device appears to be offline. Trail will be saved when connection is restored."),Kt.add(S),g()):ce.error(`Error closing trail: ${p.message}`),st.set(null),at.set(!1)}Ht.set(!1)}function $(){console.log("End trail event received in EndTrailModal"),Ht.set(!0)}return l.$$.update=()=>{l.$$.dirty&15&&o&&t&&(r(1,s=new Date),r(0,i=s.getTime()-new Date(t.start_time).getTime()),r(4,c=of(i)))},[i,s,t,o,c,u,n,b,h,_,y,M,$]}class af extends ie{constructor(e){super(),se(this,e,sf,lf,le,{triggerEndTrail:12})}get triggerEndTrail(){return this.$$.ctx[12]}}const cf=l=>({}),Ml=l=>({calculateZoomDependentWidth:l[1],generateTrailIds:Ct,deleteTrail:l[2]});function uf(l){let e,r;const t=l[11].default,n=be(t,l,l[10],Ml);return{c(){e=ge(`svelte Copy\r
`),n&&n.c()},l(o){e=me(o,`svelte Copy\r
`),n&&n.l(o)},m(o,i){U(o,e,i),n&&n.m(o,i),r=!0},p(o,[i]){n&&n.p&&(!r||i&1024)&&ve(n,t,o,o[10],r?ke(t,o[10],i,cf):we(o[10]),Ml)},i(o){r||(C(n,o),r=!0)},o(o){E(n,o),r=!1},d(o){o&&k(e),n&&n.d(o)}}}function Ct(l){return{sourceId:`trail-source-${l}`,layerId:`trail-layer-${l}`,highlightLayerId:`trail-highlight-${l}`,highlightBackgroundLayerId:`trail-highlight-bg-${l}`}}function Il(l){const e="type"in l?l:Qt(l);return{type:"Feature",properties:{},geometry:e}}function Qt(l){return{type:"LineString",coordinates:[...l].sort((r,t)=>r.timestamp-t.timestamp).map(r=>[r.coordinates.longitude,r.coordinates.latitude])}}function ff(l,e,r){let t,n;re(l,it,$=>r(14,t=$)),re(l,st,$=>r(15,n=$));let{$$slots:o={},$$scope:i}=e;const c={MULTIPLIER:1,MIN_ZOOM:10,MAX_ZOOM:24,MIN_POWER:-6,MAX_POWER:8,DEFAULT_OPACITY:.5,LOAD_DELAY:10};let{map:s}=e,a=0;function u($,T=1){return["interpolate",["exponential",2],["zoom"],c.MIN_ZOOM,["*",$*c.MULTIPLIER*T,["^",2,c.MIN_POWER]],c.MAX_ZOOM,["*",$*c.MULTIPLIER*T,["^",2,c.MAX_POWER]]]}function f($){const{sourceId:T,layerId:S,highlightLayerId:p,highlightBackgroundLayerId:m}=Ct($);[p,m,S].forEach(v=>{s.getLayer(v)&&s.removeLayer(v)}),s.getSource(T)&&s.removeSource(T)}async function g($){try{console.log(`Deleting trail: ${$}`);const T=await _t.deleteTrail($);if(T.error)throw console.error("API returned error:",T.message),ce.error(`Failed to delete trail: ${T.message}`),new Error(T.message||"Failed to delete trail");return it.update(S=>S.filter(p=>p.id!==$)),ce.success("Trail deleted successfully"),!0}catch(T){return console.error("Error deleting trail:",T),ce.error(`Error deleting trail: ${T.message||"Unknown error"}`),!1}}function d($){const{sourceId:T,layerId:S}=Ct($.id),p=u($.trail_width||3,1);s.addSource(T,{type:"geojson",data:Il($.path)}),s.addLayer({id:S,type:"line",source:T,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":$.trail_color||"#FF0000","line-width":p,"line-opacity":c.DEFAULT_OPACITY}})}function b($){const{sourceId:T,layerId:S}=Ct($.id);if(n&&n.id!==$.id&&(console.log("Cleaning up old trail:",n.id),f(n.id)),s.getSource(T)){const p=s.getSource(T),m=Qt($.path),w=m.coordinates.length;if(w!==a){const v={type:"Feature",properties:{},geometry:m};p.setData(v),a=w}}else{console.log("Creating new trail source:",T);const p={...$,path:Qt($.path)};d(p)}}function h($){const{sourceId:T,layerId:S}=Ct($.id);if(s.getSource(T)){const p=s.getSource(T),m=Qt($.path),w={type:"Feature",properties:{},geometry:m};p.setData(w)}else{console.log("Creating new trail source:",T);const p={...$,path:Qt($.path)};d(p)}}async function _(){console.log("Starting to load historical trails",{totalTrails:t.length,trails:t});for(let $=0;$<t.length;$++){const T=t[$];try{await d(T),await new Promise(S=>setTimeout(S,c.LOAD_DELAY))}catch(S){console.log(`Failed to load trail [${$+1}/${t.length}]:`,{trailId:T.id||"unknown",error:S,trailData:T}),console.error(`Failed to load trail [${$+1}/${t.length}]:`,{trailId:T.id||"unknown",error:S,trailData:T}),ce.error("Failed to load corrupt trail data. Please try refreshing.",{description:`Trail ${$+1}/${t.length} (ID: ${T.id||"unknown"})`})}}console.log("Finished loading historical trails")}let y={currentTrailUnsubscribe:null,otherActiveTrailsUnsubscribe:null,historicalTrailsUnsubscribe:null};Ge(()=>{_(),y.currentTrailUnsubscribe=st.subscribe(T=>{T&&T.path&&b(T)}),y.otherActiveTrailsUnsubscribe=ot.subscribe(T=>{T&&T.forEach(S=>{S&&S.path&&h(S)})});let $=t;y.historicalTrailsUnsubscribe=it.subscribe(T=>{$&&T&&$.filter(p=>!T.some(m=>m.id===p.id)).forEach(p=>{console.log("Deleting historical trail:",p.id),f(p.id)}),$=T})}),mt(()=>{console.log("Cleaning up trail subscriptions"),y.currentTrailUnsubscribe&&y.currentTrailUnsubscribe(),y.otherActiveTrailsUnsubscribe&&y.otherActiveTrailsUnsubscribe(),y.historicalTrailsUnsubscribe&&y.historicalTrailsUnsubscribe()});const M={addTrail:d,removeTrail:f,deleteTrail:g,reloadAll:_,updateCurrentTrail:b,generateTrailIds:Ct,calculateZoomDependentWidth:u,createTrailGeoJSON:Il};return l.$$set=$=>{"map"in $&&r(4,s=$.map),"$$scope"in $&&r(10,i=$.$$scope)},[Ct,u,g,c,s,f,d,b,h,M,i,o]}class df extends ie{constructor(e){super(),se(this,e,ff,uf,le,{TRAIL_CONFIG:3,map:4,generateTrailIds:0,calculateZoomDependentWidth:1,removeTrail:5,deleteTrail:2,addTrail:6,updateCurrentTrail:7,updateOtherActiveTrail:8,trailManagerAPI:9})}get TRAIL_CONFIG(){return this.$$.ctx[3]}get generateTrailIds(){return Ct}get calculateZoomDependentWidth(){return this.$$.ctx[1]}get removeTrail(){return this.$$.ctx[5]}get deleteTrail(){return this.$$.ctx[2]}get addTrail(){return this.$$.ctx[6]}get updateCurrentTrail(){return this.$$.ctx[7]}get updateOtherActiveTrail(){return this.$$.ctx[8]}get trailManagerAPI(){return this.$$.ctx[9]}}function hf(l){let e,r;return e=new yo({props:{size:20}}),{c(){Y(e.$$.fragment)},l(t){Q(e.$$.fragment,t)},m(t,n){G(e,t,n),r=!0},i(t){r||(C(e.$$.fragment,t),r=!0)},o(t){E(e.$$.fragment,t),r=!1},d(t){j(e,t)}}}function mf(l){let e,r;return e=new xl({props:{size:20,color:"black"}}),{c(){Y(e.$$.fragment)},l(t){Q(e.$$.fragment,t)},m(t,n){G(e,t,n),r=!0},i(t){r||(C(e.$$.fragment,t),r=!0)},o(t){E(e.$$.fragment,t),r=!1},d(t){j(e,t)}}}function Al(l){let e,r,t,n,o,i,c,s,a,u,f,g,d,b,h;n=new Bo({props:{size:20}});let _=l[4].length>0&&Ll(l);return a=new Fo({props:{size:20}}),g=new to({props:{size:20}}),{c(){e=B("div"),r=B("div"),t=B("button"),Y(n.$$.fragment),o=K(),i=B("div"),_&&_.c(),c=K(),s=B("button"),Y(a.$$.fragment),u=K(),f=B("button"),Y(g.$$.fragment),this.h()},l(y){e=V(y,"DIV",{class:!0,style:!0});var M=H(e);r=V(M,"DIV",{class:!0});var $=H(r);t=V($,"BUTTON",{class:!0});var T=H(t);Q(n.$$.fragment,T),T.forEach(k),o=J($),i=V($,"DIV",{class:!0});var S=H(i);_&&_.l(S),S.forEach(k),c=J($),s=V($,"BUTTON",{class:!0});var p=H(s);Q(a.$$.fragment,p),p.forEach(k),u=J($),f=V($,"BUTTON",{class:!0});var m=H(f);Q(g.$$.fragment,m),m.forEach(k),$.forEach(k),M.forEach(k),this.h()},h(){D(t,"class","btn btn-circle h-10 w-10 shrink-0 border-none bg-white text-lg hover:bg-gray-100"),t.disabled=!1,D(i,"class","mx-1 truncate text-center text-sm text-white"),D(s,"class","btn btn-circle h-10 w-10 shrink-0 border-none bg-white text-lg hover:bg-gray-100"),s.disabled=!1,D(f,"class","btn btn-circle btn-error h-10 w-10 shrink-0 border-none hover:bg-error/90"),D(r,"class","flex items-center justify-between gap-x-[max(0.25rem,min(1rem,1.5vw))] p-[max(0.25rem,min(1rem,1.5vw))]"),D(e,"class","navigation-fade-in fixed bottom-4 left-1/2 flex -translate-x-1/2 items-center rounded-full bg-black/70 backdrop-blur svelte-3zmpjl"),Ae(e,"max-width","calc(70vw - 2rem)"),Ae(e,"min-width","min-content")},m(y,M){U(y,e,M),I(e,r),I(r,t),G(n,t,null),I(r,o),I(r,i),_&&_.m(i,null),I(r,c),I(r,s),G(a,s,null),I(r,u),I(r,f),G(g,f,null),d=!0,b||(h=[Se(t,"click",l[7]),Se(s,"click",l[8]),Se(f,"click",l[14])],b=!0)},p(y,M){y[4].length>0?_?_.p(y,M):(_=Ll(y),_.c(),_.m(i,null)):_&&(_.d(1),_=null)},i(y){d||(C(n.$$.fragment,y),C(a.$$.fragment,y),C(g.$$.fragment,y),d=!0)},o(y){E(n.$$.fragment,y),E(a.$$.fragment,y),E(g.$$.fragment,y),d=!1},d(y){y&&k(e),j(n),_&&_.d(),j(a),j(g),b=!1,vt(h)}}}function Ll(l){let e,r=l[0]+1+"",t,n,o=l[4].length+"",i;return{c(){e=ge("Trail "),t=ge(r),n=ge(" of "),i=ge(o)},l(c){e=me(c,"Trail "),t=me(c,r),n=me(c," of "),i=me(c,o)},m(c,s){U(c,e,s),U(c,t,s),U(c,n,s),U(c,i,s)},p(c,s){s&1&&r!==(r=c[0]+1+"")&&Fe(t,r),s&16&&o!==(o=c[4].length+"")&&Fe(i,o)},d(c){c&&(k(e),k(t),k(n),k(i))}}}function Dl(l){let e,r,t,n="Delete Trail?",o,i,c=`Are you sure you want to delete this trail? This action cannot be
        undone.`,s,a,u,f="Cancel",g,d,b="Delete",h,_,y,M="close",$,T;return{c(){e=B("dialog"),r=B("div"),t=B("h3"),t.textContent=n,o=K(),i=B("p"),i.textContent=c,s=K(),a=B("div"),u=B("button"),u.textContent=f,g=K(),d=B("button"),d.textContent=b,h=K(),_=B("form"),y=B("button"),y.textContent=M,this.h()},l(S){e=V(S,"DIALOG",{class:!0});var p=H(e);r=V(p,"DIV",{class:!0});var m=H(r);t=V(m,"H3",{class:!0,"data-svelte-h":!0}),Ce(t)!=="svelte-ox39ht"&&(t.textContent=n),o=J(m),i=V(m,"P",{class:!0,"data-svelte-h":!0}),Ce(i)!=="svelte-uzgtjw"&&(i.textContent=c),s=J(m),a=V(m,"DIV",{class:!0});var w=H(a);u=V(w,"BUTTON",{class:!0,"data-svelte-h":!0}),Ce(u)!=="svelte-afpmp3"&&(u.textContent=f),g=J(w),d=V(w,"BUTTON",{class:!0,"data-svelte-h":!0}),Ce(d)!=="svelte-14b26fi"&&(d.textContent=b),w.forEach(k),m.forEach(k),h=J(p),_=V(p,"FORM",{method:!0,class:!0});var v=H(_);y=V(v,"BUTTON",{"data-svelte-h":!0}),Ce(y)!=="svelte-opg30q"&&(y.textContent=M),v.forEach(k),p.forEach(k),this.h()},h(){D(t,"class","text-lg font-bold"),D(i,"class","py-4"),D(u,"class","btn btn-ghost"),D(d,"class","btn btn-error"),D(a,"class","modal-action"),D(r,"class","modal-box"),D(_,"method","dialog"),D(_,"class","modal-backdrop"),D(e,"class","modal modal-open")},m(S,p){U(S,e,p),I(e,r),I(r,t),I(r,o),I(r,i),I(r,s),I(r,a),I(a,u),I(a,g),I(a,d),I(e,h),I(e,_),I(_,y),$||(T=[Se(u,"click",l[15]),Se(d,"click",l[5]),Se(y,"click",l[16])],$=!0)},p:Ee,d(S){S&&k(e),$=!1,vt(T)}}}function gf(l){let e,r,t,n,o,i,c,s,a;const u=[mf,hf],f=[];function g(h,_){return h[1]?0:1}r=g(l),t=f[r]=u[r](l);let d=l[1]&&Al(l),b=l[2]&&l[3]&&Dl(l);return{c(){e=B("button"),t.c(),n=K(),d&&d.c(),o=K(),b&&b.c(),i=ne(),this.h()},l(h){e=V(h,"BUTTON",{class:!0,style:!0});var _=H(e);t.l(_),_.forEach(k),n=J(h),d&&d.l(h),o=J(h),b&&b.l(h),i=ne(),this.h()},h(){D(e,"class","btn btn-circle fixed bottom-8 left-6 z-50 h-10 w-10 border-none bg-black/70 text-white backdrop-blur transition-transform hover:scale-110 hover:bg-black/80"),Ae(e,"background",l[1]?"rgba(255, 255, 255, 0.9)":""),St(e,"text-black",l[1])},m(h,_){U(h,e,_),f[r].m(e,null),U(h,n,_),d&&d.m(h,_),U(h,o,_),b&&b.m(h,_),U(h,i,_),c=!0,s||(a=Se(e,"click",l[6]),s=!0)},p(h,[_]){let y=r;r=g(h),r!==y&&(de(),E(f[y],1,1,()=>{f[y]=null}),he(),t=f[r],t||(t=f[r]=u[r](h),t.c()),C(t,1),t.m(e,null)),(!c||_&2)&&Ae(e,"background",h[1]?"rgba(255, 255, 255, 0.9)":""),(!c||_&2)&&St(e,"text-black",h[1]),h[1]?d?(d.p(h,_),_&2&&C(d,1)):(d=Al(h),d.c(),C(d,1),d.m(o.parentNode,o)):d&&(de(),E(d,1,1,()=>{d=null}),he()),h[2]&&h[3]?b?b.p(h,_):(b=Dl(h),b.c(),b.m(i.parentNode,i)):b&&(b.d(1),b=null)},i(h){c||(C(t),C(d),c=!0)},o(h){E(t),E(d),c=!1},d(h){h&&(k(e),k(n),k(o),k(i)),f[r].d(),d&&d.d(h),b&&b.d(h),s=!1,a()}}}function _f(l,e,r){let t;re(l,it,L=>r(4,t=L));let{calculateZoomDependentWidth:n}=e,{generateTrailIds:o}=e,{deleteTrail:i}=e,{map:c}=e,s=0,a=!0,u=!1,f=!1,g=null;const d={FLIGHT_DURATION:2e3,HIGHLIGHT_WIDTH_MULTIPLIER:1.2,MAX_FLIGHT_ZOOM:19},b=[[0,4,3],[.5,4,2.5],[1,4,2],[1.5,4,1.5],[2,4,1],[2.5,4,.5],[3,4,0],[0,.5,3,3.5],[0,1,3,3],[0,1.5,3,2.5],[0,2,3,2],[0,2.5,3,1.5],[0,3,3,1],[0,3.5,3,.5]];async function h(){g&&await i(g.id)&&(r(2,f=!1),r(3,g=null),t.length===0?r(1,u=!1):(s>=t.length&&r(0,s=Math.max(0,t.length-1)),p(s)))}function _(){if(!t.length){ce.error("No trails available. Create some trails first!");return}if(r(1,u=!u),!u)t.forEach(L=>S(L.id));else if(t.length>0){const L=t[s];T(L),M(L)}}function y(L){const{sourceId:F,highlightLayerId:z}=o(L.id),W=L.trail_width*d.HIGHLIGHT_WIDTH_MULTIPLIER;c.addLayer({type:"line",source:F,id:z,paint:{"line-color":"white","line-width":n(W,1.5),"line-opacity":.8},layout:{"line-cap":"round","line-join":"round"}});const N=`${z}-inner`;return c.addLayer({type:"line",source:F,id:N,paint:{"line-color":L.trail_color,"line-width":n(W,.8),"line-opacity":1},layout:{"line-cap":"round","line-join":"round"}}),()=>{c.getLayer(z)&&c.removeLayer(z),c.getLayer(N)&&c.removeLayer(N)}}function M(L){const{sourceId:F,highlightBackgroundLayerId:z}=o(L.id);let W=0;const N=L.trail_width*d.HIGHLIGHT_WIDTH_MULTIPLIER,R=[.3,.4,.6,.8,1,.8,.6,.4];let X=null;if(!c.getSource(F))return;c.addLayer({type:"line",source:F,id:z,paint:{"line-color":L.trail_color,"line-width":n(N,2.2),"line-opacity":.3,"line-blur":n(N,.8)},layout:{"line-cap":"round","line-join":"bevel"}});function Z(te){if(!a||!c){X&&cancelAnimationFrame(X);return}try{const q=parseInt(te/100%R.length);q!==W&&c.getLayer(z)&&(c.setPaintProperty(z,"line-opacity",R[W]),W=q),c.getLayer(z)&&(X=requestAnimationFrame(Z))}catch{console.log("Animation stopped due to map cleanup"),X&&cancelAnimationFrame(X)}}return Z(0),()=>{X&&cancelAnimationFrame(X)}}function $(L){const{sourceId:F,highlightLayerId:z,highlightBackgroundLayerId:W}=o(L.id);let N=0;const R=L.trail_width*d.HIGHLIGHT_WIDTH_MULTIPLIER,X=L.trail_color.match(/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i);let Z=L.trail_color;if(X){const x=parseInt(X[1],16),pe=parseInt(X[2],16),_e=parseInt(X[3],16);Z=`rgb(${Math.min(x+80,255)}, ${Math.min(pe+80,255)}, ${Math.min(_e+80,255)})`}const te=[.3,.4,.6,.8,1,.8,.6,.4];c.addLayer({type:"line",source:F,id:W,paint:{"line-color":L.trail_color,"line-width":n(R,2.2),"line-opacity":.3,"line-blur":n(R,.8)},layout:{"line-cap":"round","line-join":"bevel"}}),c.addLayer({type:"line",source:F,id:z,paint:{"line-color":Z,"line-width":n(R,.8),"line-dasharray":b[0],"line-opacity":1},layout:{"line-cap":"butt","line-join":"bevel"}});function q(x){if(!a)return;const pe=parseInt(x/100%te.length);try{pe!==N&&c?.getLayer(W)&&(c.setPaintProperty(W,"line-opacity",te[N]),N=pe),c?.getLayer(W)&&requestAnimationFrame(q)}catch{console.log("Animation stopped due to map cleanup"),a=!1}}q(0)}function T(L){const F=L.path.coordinates,z=F.reduce((W,N)=>W.extend(N),new Ke.LngLatBounds(F[0],F[0]));c.fitBounds(z,{padding:50,duration:d.FLIGHT_DURATION,maxZoom:d.MAX_FLIGHT_ZOOM})}function S(L){const{highlightLayerId:F,highlightBackgroundLayerId:z}=o(L);try{c&&c.getLayer(F)&&c.removeLayer(F),c&&c.getLayer(z)&&c.removeLayer(z)}catch(W){console.log("Error removing highlight layers:",W)}}async function p(L){if(t.length===0)return;t.forEach(z=>S(z.id)),r(0,s=L),s>=t.length?r(0,s=0):s<0&&r(0,s=t.length-1);const F=t[s];T(F),M(F),await new Promise(z=>setTimeout(z,d.FLIGHT_DURATION))}function m(){p(s-1)}function w(){p(s+1)}const v={highlightTrail:$,glowTrail:M,outlineTrail:y,removeHighlight:S,flyToTrail:T,nextTrail:w,previousTrail:m,navigateToTrail:p};Ge(()=>()=>{a=!1});const A=()=>{r(3,g=t[s]),r(2,f=!0)},P=()=>r(2,f=!1),O=()=>r(2,f=!1);return l.$$set=L=>{"calculateZoomDependentWidth"in L&&r(9,n=L.calculateZoomDependentWidth),"generateTrailIds"in L&&r(10,o=L.generateTrailIds),"deleteTrail"in L&&r(11,i=L.deleteTrail),"map"in L&&r(12,c=L.map)},[s,u,f,g,t,h,_,m,w,n,o,i,c,v,A,P,O]}class pf extends ie{constructor(e){super(),se(this,e,_f,gf,le,{calculateZoomDependentWidth:9,generateTrailIds:10,deleteTrail:11,map:12,highlighterAPI:13})}get highlighterAPI(){return this.$$.ctx[13]}}function bf(l){let e,r,t;function n(i){l[3](i)}let o={map:l[2],calculateZoomDependentWidth:l[5],generateTrailIds:l[6],deleteTrail:l[7]};return l[1]!==void 0&&(o.highlighterAPI=l[1]),e=new pf({props:o}),Ue.push(()=>$r(e,"highlighterAPI",n)),{c(){Y(e.$$.fragment)},l(i){Q(e.$$.fragment,i)},m(i,c){G(e,i,c),t=!0},p(i,c){const s={};c&4&&(s.map=i[2]),c&32&&(s.calculateZoomDependentWidth=i[5]),c&64&&(s.generateTrailIds=i[6]),c&128&&(s.deleteTrail=i[7]),!r&&c&2&&(r=!0,s.highlighterAPI=i[1],Sr(()=>r=!1)),e.$set(s)},i(i){t||(C(e.$$.fragment,i),t=!0)},o(i){E(e.$$.fragment,i),t=!1},d(i){j(e,i)}}}function vf(l){let e,r,t;function n(i){l[4](i)}let o={map:l[2],$$slots:{default:[bf,({calculateZoomDependentWidth:i,generateTrailIds:c,deleteTrail:s})=>({5:i,6:c,7:s}),({calculateZoomDependentWidth:i,generateTrailIds:c,deleteTrail:s})=>(i?32:0)|(c?64:0)|(s?128:0)]},$$scope:{ctx:l}};return l[0]!==void 0&&(o.trailManagerAPI=l[0]),e=new df({props:o}),Ue.push(()=>$r(e,"trailManagerAPI",n)),{c(){Y(e.$$.fragment)},l(i){Q(e.$$.fragment,i)},m(i,c){G(e,i,c),t=!0},p(i,[c]){const s={};c&4&&(s.map=i[2]),c&486&&(s.$$scope={dirty:c,ctx:i}),!r&&c&1&&(r=!0,s.trailManagerAPI=i[0],Sr(()=>r=!1)),e.$set(s)},i(i){t||(C(e.$$.fragment,i),t=!0)},o(i){E(e.$$.fragment,i),t=!1},d(i){j(e,i)}}}function wf(l,e,r){let{map:t}=e,{trailManagerAPI:n}=e,{highlighterAPI:o}=e;function i(s){o=s,r(1,o)}function c(s){n=s,r(0,n)}return l.$$set=s=>{"map"in s&&r(2,t=s.map),"trailManagerAPI"in s&&r(0,n=s.trailManagerAPI),"highlighterAPI"in s&&r(1,o=s.highlighterAPI)},[n,o,t,i,c]}class kf extends ie{constructor(e){super(),se(this,e,wf,vf,le,{map:2,trailManagerAPI:0,highlighterAPI:1})}}function Pl(l){let e,r;return e=new kf({props:{map:l[0]}}),{c(){Y(e.$$.fragment)},l(t){Q(e.$$.fragment,t)},m(t,n){G(e,t,n),r=!0},p(t,n){const o={};n&1&&(o.map=t[0]),e.$set(o)},i(t){r||(C(e.$$.fragment,t),r=!0)},o(t){E(e.$$.fragment,t),r=!1},d(t){j(e,t)}}}function yf(l){let e,r,t,n,o;function i(a){l[4](a)}let c={};l[1]!==void 0&&(c.triggerEndTrail=l[1]),e=new af({props:c}),Ue.push(()=>$r(e,"triggerEndTrail",i));let s=l[2]&&Pl(l);return{c(){Y(e.$$.fragment),t=K(),s&&s.c(),n=ne()},l(a){Q(e.$$.fragment,a),t=J(a),s&&s.l(a),n=ne()},m(a,u){G(e,a,u),U(a,t,u),s&&s.m(a,u),U(a,n,u),o=!0},p(a,[u]){const f={};!r&&u&2&&(r=!0,f.triggerEndTrail=a[1],Sr(()=>r=!1)),e.$set(f),a[2]?s?(s.p(a,u),u&4&&C(s,1)):(s=Pl(a),s.c(),C(s,1),s.m(n.parentNode,n)):s&&(de(),E(s,1,1,()=>{s=null}),he())},i(a){o||(C(e.$$.fragment,a),C(s),o=!0)},o(a){E(e.$$.fragment,a),E(s),o=!1},d(a){a&&(k(t),k(n)),j(e,a),s&&s.d(a)}}}const Tf=5e3;function Cf(l,e,r){let t,n,o,i,c,s,a,u;re(l,$t,N=>r(8,t=N)),re(l,Ql,N=>r(9,n=N)),re(l,ln,N=>r(10,o=N)),re(l,st,N=>r(11,i=N)),re(l,Et,N=>r(12,c=N)),re(l,ot,N=>r(13,s=N)),re(l,it,N=>r(14,a=N)),re(l,at,N=>r(15,u=N));let{selectedOperation:f}=e,{map:g}=e,d,b,h=null,_=!1,y={trailingUnsubscribe:null,coordinateBufferUnsubscribe:null,unsavedCoordinatesUnsubscribe:null};Ge(async()=>{console.log("🚀 TrailSynchronizer: Initializing..."),await Bl(),await P(),await O(),await A(),y.trailingUnsubscribe=(()=>{let N=!0;return on.subscribe(async R=>{if(N){N=!1;return}console.log("Pressed trailing button",R,"Trailing State:",u),u?u&&(console.log("Triggering end trail"),b()):(console.log("Handling trail creation"),await L())})})(),y.coordinateBufferUnsubscribe=kr.subscribe(N=>{N&&N.coordinates&&u&&T(N)}),y.unsavedCoordinatesUnsubscribe=Et.subscribe(N=>{N.length>0&&!h?S():N.length===0&&h&&w()}),console.log("active trials",s),await M(),await $(),console.log("✅ TrailSynchronizer: Setup completed")}),mt(()=>{console.log("🧹 TrailSynchronizer: Cleaning up resources"),y.trailingUnsubscribe&&y.trailingUnsubscribe(),y.coordinateBufferUnsubscribe&&y.coordinateBufferUnsubscribe(),y.unsavedCoordinatesUnsubscribe&&y.unsavedCoordinatesUnsubscribe(),d&&d.unsubscribe(),w(),at.set(!1)});async function M(){const N=o.id;console.log("📡 TrailSynchronizer: Subscribing to trail changes of operation",f.id,"and not vehicle:",N),d=fe.channel("trail_changes").on("postgres_changes",{event:"INSERT",schema:"public",table:"trails",filter:`operation_id=eq.${f.id}`},R).on("postgres_changes",{event:"UPDATE",schema:"public",table:"trails",filter:`operation_id=eq.${f.id}`},X).on("postgres_changes",{event:"DELETE",schema:"public",table:"trails",filter:`operation_id=eq.${f.id}`},Z).subscribe();function R(te){if(!te.new)return;const q=te.new;q.vehicle_id!==N&&(console.log("🆕 New trail detected:",q.id),s?.length||ot.set([]),ot.update((x=[])=>[...x,{id:q.id,vehicle_id:q.vehicle_id,operation_id:q.operation_id,start_time:q.start_time,end_time:q.end_time,task_id:q.task_id,trail_color:q.trail_color,trail_width:q.trail_width,path:[],detailed_path:q.detailed_path}]),console.log("active trails",s))}function X(te){if(console.log("🔄 Trail update detected:",te),!te.new)return;const q=te.new;q.vehicle_id!==N&&(console.log("🔄 Trail update detected:",q.id),s?.length||ot.set([]),ot.update((x=[])=>{const pe=x.findIndex(ae=>ae.id===q.id);if(pe===-1)return x;const _e=x[pe];console.log("Updating existing trail:",q.id);const ye={type:"LineString",coordinates:_e.path.map(ae=>[ae.coordinates.longitude,ae.coordinates.latitude])},Me={id:q.id,vehicle_id:q.vehicle_id,operation_id:q.operation_id,start_time:q.start_time,end_time:q.end_time,trail_color:q.trail_color,trail_width:q.trail_width,path:ye,detailed_path:q.detailed_path};return it.update(ae=>[...ae,Me]),x.filter(ae=>ae.id!==q.id)}),console.log("active trails",s))}function Z(te){if(console.log("🗑️ Trail deletion detected:",te),!te.old)return;const q=te.old;console.log(q.vehicle_id===N),q.vehicle_id!==N&&(console.log("🗑️ Trail deletion detected:",q.id),new Date(q.start_time),new Date(q.end_time),ce.info("Trail deleted by another user",{description:`${q.trail_width}m ${q.trail_color.toLowerCase()} trail`}),s?.length&&ot.update((x=[])=>x.filter(pe=>pe.id!==q.id)),a?.length&&a.some(pe=>pe.id===q.id)&&it.update(pe=>pe.filter(_e=>_e.id!==q.id)),console.log("active trails",s))}}async function $(){console.log("📡 TrailSynchronizer: Subscribing to trail streams"),d=fe.channel("trail_stream_changes").on("postgres_changes",{event:"INSERT",schema:"public",table:"trail_stream",filter:`operation_id=eq.${f.id}`},N=>{if(!N.new)return;const{trail_id:R,coordinate:X,timestamp:Z}=N.new;!s?.length||!s.some(q=>q.id===R)||ot.update(q=>q.map(x=>x.id===R?{...x,path:[...x.path,{coordinates:{latitude:X.coordinates[1],longitude:X.coordinates[0]},timestamp:Z}]}:x))}).subscribe()}function T(N){z(N);const R={coordinates:N.coordinates,timestamp:N.timestamp};Et.update(X=>[...X,R]),kr.set(null)}function S(){h||(console.log("🔄 TrailSynchronizer: Starting periodic sync"),h=setInterval(()=>{p()},Tf))}async function p(){await m()}async function m(){const N=c;if(N.length===0)return;const R=[...N];Et.set([]);try{console.log(`📤 TrailSynchronizer: Sending batch of ${R.length} coordinates`);const X=await _t.saveCoordinates(f.id,i.id,R.map(Z=>({coordinates:Z.coordinates,timestamp:Z.timestamp})));if(X.error)throw new Error(X.message||"Failed to save coordinates");console.log(`✅ TrailSynchronizer: Successfully synced ${R.length} coordinates`)}catch(X){console.log("❌ TrailSynchronizer: Failed to sync coordinates:",X),Et.update(Z=>[...R,...Z])}}function w(){h&&(console.log("⏹️ TrailSynchronizer: Stopping periodic sync"),clearInterval(h),h=null)}async function v(N){try{console.log(`Fetching trails for operation ${N}`);const{data:R,error:X}=await fe.from("trails").select(`
        id,
        vehicle_id,
        operation_id,
        start_time,
        end_time,
        trail_color,
        trail_width
        `).eq("operation_id",N).not("end_time","is",null).order("start_time",{ascending:!0});if(X)throw console.error("Error fetching trails:",X),new Error(`Failed to fetch trails: ${X.message}`);return!R||R.length===0?(console.log("No trails found for this operation"),[]):(console.log(`Found ${R.length} trails, fetching path data...`),await Promise.all(R.map(async te=>{try{const{data:q,error:x}=await fe.rpc("get_trail_path_as_geojson",{trail_id_param:te.id});return x?(console.error(`Error fetching path for trail ${te.id}:`,x),{...te,path:null}):{...te,path:q}}catch(q){return console.error(`Error processing path for trail ${te.id}:`,q),{...te,path:null}}})))}catch(R){throw console.error("Error in getOperationTrails:",R),R}}async function A(){console.log("📥 TrailSynchronizer: Fetching operation trails"),ce.promise((async()=>{const N=await v(f.id);return it.set([]),it.update(R=>[...R,...N]),r(2,_=!0),console.log(`✅ TrailSynchronizer: Loaded ${N.length} historical trails`),console.log("Operation",f),N})(),{loading:`Loading trails from ${f.name} (${f.year})...`,success:N=>`Loaded ${N.length} trails from ${f.name} (${f.year})`,error:N=>`Failed to fetch trails from ${f.name}: ${N.message}`},{duration:4e3})}async function P(){try{const N=await _t.checkOpenTrails(o.id);if(N.error)throw new Error(N.message||"Failed to check for open trails");const{openTrail:R,trailData:X}=N;if(console.log("Opentrail",R,"data",X),R){console.log("🔄 TrailSynchronizer: Found existing open trail"),st.set({...R,start_time:R.start_time,trail_color:R.trail_color,trail_width:R.trail_width,path:X||[]}),at.set(!0);const Z=new Date(R.start_time),te=Math.round((Date.now()-Z.getTime())/(1e3*60));ce.info(`Found existing ${R.trail_width}m ${R.trail_color.toLowerCase()} trail`,{description:`Started ${te} minutes ago. Trailing will continue automatically.`,duration:5e3})}}catch(N){console.error("❌ TrailSynchronizer: Failed to check open trails:",N),ce.error("Failed to check for open trails")}}async function O(){const N=ce.promise((async()=>{console.log("Getting other active trails... from operation:",f.id,"and profile:",o.id);const R=await _t.checkOtherActiveTrails(f.id,o.id);if(R.error)throw new Error(R.message||"Failed to check for other active trails");R.errors&&R.errors.forEach(Z=>{ce.error(Z,{duration:6e3})});const{activeTrails:X}=R;if(X&&X.length>0){console.log(`📍 TrailSynchronizer: Found ${X.length} other active trails`,X);const Z=X.map(x=>({id:x.id,vehicle_id:x.vehicle_id,operation_id:x.operation_id,task_id:x.task_id||null,start_time:x.start_time,end_time:x.end_time,trail_color:x.trail_color,trail_width:x.trail_width,path:x.trailData||[],detailed_path:null})),te=n?.connected_profiles||[],q=X.map(x=>{const pe=te.find(_e=>_e.id===x.vehicle_id);return pe?pe.full_name:null}).filter(x=>x!==null);return ot.set(Z),q.length>0?`Active trails from: ${q.join(", ")}`:`Found ${X.length} active ${X.length===1?"trail":"trails"} from unknown vehicles`}else return ot.set([]),"No active trails found"})(),{loading:"Checking for active trails...",success:R=>R,error:R=>R instanceof Error?R.message:"Failed to check for other active trails"},{duration:6e3});try{await N}catch(R){console.error("❌ TrailSynchronizer: Failed to check other active trails:",R)}}async function L(){const N=t.vehicle_id;try{await F(N)}catch(R){console.error("❌ TrailSynchronizer: Error creating trail:",R),ce.error(`Error creating trail: ${R.message}`)}}async function F(N){console.log("🆕 TrailSynchronizer: Creating new trail");try{const R=await _t.openNewTrail(N,f.id,t);if(R.error)throw new Error(R.message||"Failed to create trail");console.log("✅ TrailSynchronizer: New trail created successfully"),ce.success("New trail created successfully"),st.set({...R.trail,start_time:R.trail.start_time,trail_color:R.trail.trail_color,trail_width:R.trail.trail_width,path:[]}),at.set(!0)}catch(R){throw console.error("❌ TrailSynchronizer: Error creating trail:",R),ce.error(`Error creating trail: ${R.message}`),R}}function z(N){st.update(R=>{if(R){const X=[...R.path||[],N];return{...R,path:X}}return R})}function W(N){b=N,r(1,b)}return l.$$set=N=>{"selectedOperation"in N&&r(3,f=N.selectedOperation),"map"in N&&r(0,g=N.map)},[g,b,_,f,W]}class Ef extends ie{constructor(e){super(),se(this,e,Cf,yf,le,{selectedOperation:3,map:0})}}function Ol(l){let e,r,t,n='<svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>',o,i,c,s,a,u,f="Measured Area",g,d,b,h;s=new fi({props:{class:"h-3.5 w-3.5"}});function _($,T){return $[2]?$[3]?Sf:$f:Mf}let y=_(l),M=y(l);return{c(){e=B("div"),r=B("div"),t=B("button"),t.innerHTML=n,o=K(),i=B("div"),c=B("div"),Y(s.$$.fragment),a=K(),u=B("span"),u.textContent=f,g=K(),M.c(),this.h()},l($){e=V($,"DIV",{class:!0});var T=H(e);r=V(T,"DIV",{class:!0});var S=H(r);t=V(S,"BUTTON",{class:!0,"data-svelte-h":!0}),Ce(t)!=="svelte-lmi83i"&&(t.innerHTML=n),o=J(S),i=V(S,"DIV",{class:!0});var p=H(i);c=V(p,"DIV",{class:!0});var m=H(c);Q(s.$$.fragment,m),a=J(m),u=V(m,"SPAN",{"data-svelte-h":!0}),Ce(u)!=="svelte-464exh"&&(u.textContent=f),m.forEach(k),g=J(p),M.l(p),p.forEach(k),S.forEach(k),T.forEach(k),this.h()},h(){D(t,"class","absolute -right-2 -top-2 flex h-5 w-5 items-center justify-center rounded-full border border-gray-200 bg-white text-gray-500 hover:bg-gray-50"),D(c,"class","flex items-center gap-1.5 text-[11px] font-medium uppercase tracking-wider text-gray-600"),D(i,"class","flex flex-col items-center gap-2"),D(r,"class","relative min-w-[180px] rounded-lg border border-gray-200 bg-white/90 p-3 backdrop-blur-sm"),D(e,"class","absolute left-1/2 top-3 z-10 -translate-x-1/2 transform")},m($,T){U($,e,T),I(e,r),I(r,t),I(r,o),I(r,i),I(i,c),G(s,c,null),I(c,a),I(c,u),I(i,g),M.m(i,null),d=!0,b||(h=Se(t,"click",l[6]),b=!0)},p($,T){y===(y=_($))&&M?M.p($,T):(M.d(1),M=y($),M&&(M.c(),M.m(i,null)))},i($){d||(C(s.$$.fragment,$),d=!0)},o($){E(s.$$.fragment,$),d=!1},d($){$&&k(e),j(s),M.d(),b=!1,h()}}}function Sf(l){let e,r,t=l[1].hectares+"",n,o,i,c="ha",s,a,u=l[1].squareMeters.toLocaleString()+"",f,g;return{c(){e=B("div"),r=B("div"),n=ge(t),o=K(),i=B("span"),i.textContent=c,s=K(),a=B("div"),f=ge(u),g=ge(" m²"),this.h()},l(d){e=V(d,"DIV",{class:!0});var b=H(e);r=V(b,"DIV",{class:!0});var h=H(r);n=me(h,t),o=J(h),i=V(h,"SPAN",{class:!0,"data-svelte-h":!0}),Ce(i)!=="svelte-1c7zf12"&&(i.textContent=c),h.forEach(k),s=J(b),a=V(b,"DIV",{class:!0});var _=H(a);f=me(_,u),g=me(_," m²"),_.forEach(k),b.forEach(k),this.h()},h(){D(i,"class","text-xs font-normal"),D(r,"class","flex items-baseline gap-1 text-2xl font-bold text-gray-800"),D(a,"class","text-xs text-gray-500"),D(e,"class","flex flex-col items-center")},m(d,b){U(d,e,b),I(e,r),I(r,n),I(r,o),I(r,i),I(e,s),I(e,a),I(a,f),I(a,g)},p(d,b){b&2&&t!==(t=d[1].hectares+"")&&Fe(n,t),b&2&&u!==(u=d[1].squareMeters.toLocaleString()+"")&&Fe(f,u)},d(d){d&&k(e)}}}function $f(l){let e,r="Complete the shape";return{c(){e=B("div"),e.textContent=r,this.h()},l(t){e=V(t,"DIV",{class:!0,"data-svelte-h":!0}),Ce(e)!=="svelte-1298jjy"&&(e.textContent=r),this.h()},h(){D(e,"class","text-sm text-gray-600")},m(t,n){U(t,e,n)},p:Ee,d(t){t&&k(e)}}}function Mf(l){let e,r="Click to start measuring";return{c(){e=B("div"),e.textContent=r,this.h()},l(t){e=V(t,"DIV",{class:!0,"data-svelte-h":!0}),Ce(e)!=="svelte-116r9bz"&&(e.textContent=r),this.h()},h(){D(e,"class","text-sm text-gray-600")},m(t,n){U(t,e,n)},p:Ee,d(t){t&&k(e)}}}function If(l){let e,r,t=l[0]&&Ol(l);return{c(){t&&t.c(),e=ne()},l(n){t&&t.l(n),e=ne()},m(n,o){t&&t.m(n,o),U(n,e,o),r=!0},p(n,[o]){n[0]?t?(t.p(n,o),o&1&&C(t,1)):(t=Ol(n),t.c(),C(t,1),t.m(e.parentNode,e)):t&&(de(),E(t,1,1,()=>{t=null}),he())},i(n){r||(C(t),r=!0)},o(n){E(t),r=!1},d(n){n&&k(e),t&&t.d(n)}}}function Af(l){return{squareMeters:Math.round(l),hectares:Math.round(l/1e4*100)/100}}function Lf(l,e,r){let t;re(l,jt,g=>r(0,t=g));let{map:n}=e,o,i={hectares:0,squareMeters:0},c=!1,s=!1;const a={create:()=>u(),delete:()=>u(),update:()=>u()};Ge(()=>{r(5,o=new bo({displayControlsDefault:!1,controls:{},defaultMode:"draw_polygon",clickBuffer:6,touchBuffer:6,snapToFinish:!0,finishDrawingOnSnapToFinish:!0,touchEnabled:!0,boxSelect:!1,translateEnabled:!1,rotateEnabled:!1,styles:[{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#0ea5e9","fill-opacity":.25}},{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"]],paint:{"fill-color":"#0ea5e9","fill-opacity":.4}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#0ea5e9","line-width":2,"line-dasharray":[2,2]}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#0ea5e9","line-width":3}},{id:"gl-draw-polygon-and-line-vertex-active",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"]],paint:{"circle-radius":6,"circle-color":"#fff","circle-stroke-color":"#0ea5e9","circle-stroke-width":2}},{id:"gl-draw-polygon-and-line-midpoint-active",type:"circle",filter:["all",["==","meta","midpoint"],["==","$type","Point"]],paint:{"circle-radius":4,"circle-color":"#0ea5e9","circle-stroke-color":"#fff","circle-stroke-width":2}}]})),n.addControl(o),n.on("draw.create",a.create),n.on("draw.delete",a.delete),n.on("draw.update",a.update)});function u(){if(!o)return;const g=o.getAll();g.features.length>0?(r(1,i=Af(Vo(g))),r(2,c=!0),r(3,s=!0)):(r(2,c=!1),r(3,s=!1),r(1,i={hectares:0,squareMeters:0}))}const f=()=>Ul(jt,t=!1,t);return l.$$set=g=>{"map"in g&&r(4,n=g.map)},l.$$.update=()=>{l.$$.dirty&33&&o&&t!==void 0&&(t?o.changeMode("draw_polygon"):(o.deleteAll(),o.changeMode("simple_select"),r(2,c=!1),r(3,s=!1)))},[t,i,c,s,n,o,f]}class Df extends ie{constructor(e){super(),se(this,e,Lf,If,le,{map:4})}}function Pf(l){let e,r=null,t=0,n=null;const{getMap:o}=Gt("map");class i extends Ke.NavigationControl{constructor(s){super(s),this._trackingEnabled=!1}onAdd(s){const a=super.onAdd(s),u=a.querySelector(".mapboxgl-ctrl-compass");return u&&u.addEventListener("click",f=>{f.preventDefault(),f.stopPropagation(),this._handleCompassClick(s)}),a}_handleCompassClick(s){n&&clearTimeout(n),t++,n=setTimeout(()=>{t=0},500),t===1?(s.resetNorth(),this._trackingEnabled&&this._disableTracking()):t===2&&(t=0,this._toggleTracking(s))}_toggleTracking(s){this._trackingEnabled=!this._trackingEnabled;const a=document.querySelector(".mapboxgl-ctrl-compass");this._trackingEnabled&&navigator.geolocation?(r=navigator.geolocation.watchPosition(u=>{s.easeTo({center:[u.coords.longitude,u.coords.latitude],bearing:u.coords.heading||0,duration:1e3})},null,{enableHighAccuracy:!0}),a&&a.classList.add("tracking-active")):this._disableTracking()}_disableTracking(){this._trackingEnabled=!1,r&&(navigator.geolocation.clearWatch(r),r=null);const s=document.querySelector(".mapboxgl-ctrl-compass");s&&s.classList.remove("tracking-active")}}return Ge(async()=>{try{e=await o();const c=new i({showZoom:!1,showCompass:!0,visualizePitch:!0});e.addControl(c,"bottom-right")}catch(c){console.warn("Map initialization error:",c)}}),[]}class Of extends ie{constructor(e){super(),se(this,e,Pf,null,le,{})}}function Nl(l){let e,r,t,n,o,i,c,s,a,u,f,g,d,b,h,_,y,M,$,T;e=new Vc({}),e.$on("toggleMapStyleDispatcher",l[11]),e.$on("backToDashboard",function(){ko(l[0])&&l[0].apply(this,arguments)}),e.$on("locateHome",l[12]),t=new Of({}),o=new Ua({props:{markerPlacementEvent:l[7],markerClickEvent:l[8]}}),c=new gu({props:{map:l[4]}});let S={map:l[4]};a=new Rc({props:S}),l[13](a),a.$on("markerPlacement",l[9]),a.$on("markerClick",l[10]),f=new $u({}),d=new Cu({props:{map:l[4],disableAutoZoom:l[1]}}),h=new Ku({props:{map:l[4]}}),y=new Df({props:{map:l[4]}});let p=l[2]&&zl(l);return{c(){Y(e.$$.fragment),r=K(),Y(t.$$.fragment),n=K(),Y(o.$$.fragment),i=K(),Y(c.$$.fragment),s=K(),Y(a.$$.fragment),u=K(),Y(f.$$.fragment),g=K(),Y(d.$$.fragment),b=K(),Y(h.$$.fragment),_=K(),Y(y.$$.fragment),M=K(),p&&p.c(),$=ne()},l(m){Q(e.$$.fragment,m),r=J(m),Q(t.$$.fragment,m),n=J(m),Q(o.$$.fragment,m),i=J(m),Q(c.$$.fragment,m),s=J(m),Q(a.$$.fragment,m),u=J(m),Q(f.$$.fragment,m),g=J(m),Q(d.$$.fragment,m),b=J(m),Q(h.$$.fragment,m),_=J(m),Q(y.$$.fragment,m),M=J(m),p&&p.l(m),$=ne()},m(m,w){G(e,m,w),U(m,r,w),G(t,m,w),U(m,n,w),G(o,m,w),U(m,i,w),G(c,m,w),U(m,s,w),G(a,m,w),U(m,u,w),G(f,m,w),U(m,g,w),G(d,m,w),U(m,b,w),G(h,m,w),U(m,_,w),G(y,m,w),U(m,M,w),p&&p.m(m,w),U(m,$,w),T=!0},p(m,w){l=m;const v={};w&128&&(v.markerPlacementEvent=l[7]),w&256&&(v.markerClickEvent=l[8]),o.$set(v);const A={};w&16&&(A.map=l[4]),c.$set(A);const P={};w&16&&(P.map=l[4]),a.$set(P);const O={};w&16&&(O.map=l[4]),w&2&&(O.disableAutoZoom=l[1]),d.$set(O);const L={};w&16&&(L.map=l[4]),h.$set(L);const F={};w&16&&(F.map=l[4]),y.$set(F),l[2]?p?(p.p(l,w),w&4&&C(p,1)):(p=zl(l),p.c(),C(p,1),p.m($.parentNode,$)):p&&(de(),E(p,1,1,()=>{p=null}),he())},i(m){T||(C(e.$$.fragment,m),C(t.$$.fragment,m),C(o.$$.fragment,m),C(c.$$.fragment,m),C(a.$$.fragment,m),C(f.$$.fragment,m),C(d.$$.fragment,m),C(h.$$.fragment,m),C(y.$$.fragment,m),C(p),T=!0)},o(m){E(e.$$.fragment,m),E(t.$$.fragment,m),E(o.$$.fragment,m),E(c.$$.fragment,m),E(a.$$.fragment,m),E(f.$$.fragment,m),E(d.$$.fragment,m),E(h.$$.fragment,m),E(y.$$.fragment,m),E(p),T=!1},d(m){m&&(k(r),k(n),k(i),k(s),k(u),k(g),k(b),k(_),k(M),k($)),j(e,m),j(t,m),j(o,m),j(c,m),l[13](null),j(a,m),j(f,m),j(d,m),j(h,m),j(y,m),p&&p.d(m)}}}function zl(l){let e,r;return e=new Ef({props:{selectedOperation:l[2],map:l[4]}}),{c(){Y(e.$$.fragment)},l(t){Q(e.$$.fragment,t)},m(t,n){G(e,t,n),r=!0},p(t,n){const o={};n&4&&(o.selectedOperation=t[2]),n&16&&(o.map=t[4]),e.$set(o)},i(t){r||(C(e.$$.fragment,t),r=!0)},o(t){E(e.$$.fragment,t),r=!1},d(t){j(e,t)}}}function Nf(l){let e,r,t=l[6]&&Nl(l);return{c(){e=B("div"),t&&t.c(),this.h()},l(n){e=V(n,"DIV",{class:!0});var o=H(e);t&&t.l(o),o.forEach(k),this.h()},h(){D(e,"class","map-container svelte-1s99y2r")},m(n,o){U(n,e,o),t&&t.m(e,null),l[14](e),r=!0},p(n,[o]){n[6]?t?(t.p(n,o),o&64&&C(t,1)):(t=Nl(n),t.c(),C(t,1),t.m(e,null)):t&&(de(),E(t,1,1,()=>{t=null}),he())},i(n){r||(C(t),r=!0)},o(n){E(t),r=!1},d(n){n&&k(e),t&&t.d(),l[14](null)}}}const zf="pk.eyJ1IjoibHVjaG9kb3JlIiwiYSI6ImNsdndpd2NvNjA5OWUybG14anc1aWJpbXMifQ.7DSbOP9x-3sTZdJ5ee4UKw",Hr="mapbox://styles/mapbox/satellite-streets-v12",Vf="mapbox://styles/mapbox/outdoors-v12";function Bf(l,e,r){let t,n;re(l,Zr,v=>r(21,t=v)),re(l,so,v=>r(22,n=v));let{handleBackToDashboard:o}=e,{initialLocation:i}=e,{selectedOperation:c}=e,s,a=!0,u=Hr,f,g,d,b=!1;Er("map",{getMap:()=>Promise.resolve(g)});const h={container:null,style:Hr,center:[90,-40],zoom:2};function _(){if(i&&Array.isArray(i))if(i.length===4){const v=[[i[0],i[1]],[i[2],i[3]]];g.fitBounds(v,{padding:50,maxZoom:15})}else i.length===2&&g.flyTo({center:i,zoom:15,duration:4e3})}Ge(async()=>{console.log("Selected operation on mount!",c),Ke.accessToken=zf,h.container=f,r(4,g=new Ke.Map(h)),g.setMaxPitch(0),g.setMinPitch(0),hn.set(g),r(6,b=!0),g.loaded()?_():g.on("load",()=>{_()});try{await mn.open(),s=mn}catch(v){console.error("Error opening IndexedDB database:",v)}}),mt(()=>{g&&(g.off(),g.remove(),r(4,g=null),hn.set(null)),d&&d.$destroy()});let y=null,M=null;function $(v){r(7,y=v.detail)}function T(v){r(8,M=v.detail)}function S(){a?u=Vf:u=Hr,g.setStyle(u),g.once("load",()=>{_()}),a=!a}function p(){n?g.fitBounds(n,{padding:50,maxZoom:15}):t?g.fitBounds(t,{padding:50,maxZoom:15}):ce.error("Please place markers or upload field boundaries to set a home location",{duration:4e3})}function m(v){Ue[v?"unshift":"push"](()=>{d=v,r(5,d)})}function w(v){Ue[v?"unshift":"push"](()=>{f=v,r(3,f)})}return l.$$set=v=>{"handleBackToDashboard"in v&&r(0,o=v.handleBackToDashboard),"initialLocation"in v&&r(1,i=v.initialLocation),"selectedOperation"in v&&r(2,c=v.selectedOperation)},[o,i,c,f,g,d,b,y,M,$,T,S,p,m,w]}class Ff extends ie{constructor(e){super(),se(this,e,Bf,Nf,le,{handleBackToDashboard:0,initialLocation:1,selectedOperation:2})}}function Uf(l){let e,r,t,n;const o=[qf,Hf,Rf],i=[];function c(s,a){return s[0]?0:s[1]?1:2}return e=c(l),r=i[e]=o[e](l),{c(){r.c(),t=ne()},l(s){r.l(s),t=ne()},m(s,a){i[e].m(s,a),U(s,t,a),n=!0},p(s,a){let u=e;e=c(s),e===u?i[e].p(s,a):(de(),E(i[u],1,1,()=>{i[u]=null}),he(),r=i[e],r?r.p(s,a):(r=i[e]=o[e](s),r.c()),C(r,1),r.m(t.parentNode,t))},i(s){n||(C(r),n=!0)},o(s){E(r),n=!1},d(s){s&&k(t),i[e].d(s)}}}function Rf(l){let e,r=l[3],t,n=Vl(l);return{c(){e=B("div"),n.c(),this.h()},l(o){e=V(o,"DIV",{class:!0});var i=H(e);n.l(i),i.forEach(k),this.h()},h(){D(e,"class","fixed left-0 top-0 h-full w-full overflow-hidden")},m(o,i){U(o,e,i),n.m(e,null),t=!0},p(o,i){i&8&&le(r,r=o[3])?(de(),E(n,1,1,Ee),he(),n=Vl(o),n.c(),C(n,1),n.m(e,null)):n.p(o,i)},i(o){t||(C(n),t=!0)},o(o){E(n),t=!1},d(o){o&&k(e),n.d(o)}}}function Hf(l){let e,r,t,n="Error Loading Map",o,i,c,s,a,u,f="Try Again",g,d,b="Back to Dashboard",h,_;return{c(){e=B("div"),r=B("div"),t=B("h2"),t.textContent=n,o=K(),i=B("p"),c=ge(l[1]),s=K(),a=B("div"),u=B("button"),u.textContent=f,g=K(),d=B("button"),d.textContent=b,this.h()},l(y){e=V(y,"DIV",{class:!0});var M=H(e);r=V(M,"DIV",{class:!0});var $=H(r);t=V($,"H2",{class:!0,"data-svelte-h":!0}),Ce(t)!=="svelte-3pt6ml"&&(t.textContent=n),o=J($),i=V($,"P",{class:!0});var T=H(i);c=me(T,l[1]),T.forEach(k),s=J($),a=V($,"DIV",{class:!0});var S=H(a);u=V(S,"BUTTON",{class:!0,"data-svelte-h":!0}),Ce(u)!=="svelte-9gqfuk"&&(u.textContent=f),g=J(S),d=V(S,"BUTTON",{class:!0,"data-svelte-h":!0}),Ce(d)!=="svelte-jngz7b"&&(d.textContent=b),S.forEach(k),$.forEach(k),M.forEach(k),this.h()},h(){D(t,"class","text-2xl font-bold text-red-700"),D(i,"class","mt-2 text-red-600"),D(u,"class","rounded bg-primary px-4 py-2 text-white"),D(d,"class","rounded border border-gray-300 bg-white px-4 py-2 text-gray-700"),D(a,"class","mt-6 flex justify-center space-x-4"),D(r,"class","max-w-md rounded-lg bg-red-50 p-6 text-center shadow-lg"),D(e,"class","fixed left-0 top-0 flex h-full w-full items-center justify-center")},m(y,M){U(y,e,M),I(e,r),I(r,t),I(r,o),I(r,i),I(i,c),I(r,s),I(r,a),I(a,u),I(a,g),I(a,d),h||(_=[Se(u,"click",l[7]),Se(d,"click",l[4])],h=!0)},p(y,M){M&2&&Fe(c,y[1])},i:Ee,o:Ee,d(y){y&&k(e),h=!1,vt(_)}}}function qf(l){let e,r='<div class="flex flex-col items-center"><div class="h-16 w-16 animate-spin rounded-full border-4 border-primary border-t-transparent"></div> <p class="mt-4 text-xl font-medium">Loading map data...</p></div>';return{c(){e=B("div"),e.innerHTML=r,this.h()},l(t){e=V(t,"DIV",{class:!0,"data-svelte-h":!0}),Ce(e)!=="svelte-18ukp73"&&(e.innerHTML=r),this.h()},h(){D(e,"class","fixed left-0 top-0 flex h-full w-full items-center justify-center")},m(t,n){U(t,e,n)},p:Ee,i:Ee,o:Ee,d(t){t&&k(e)}}}function Vl(l){let e,r;return e=new Ff({props:{handleBackToDashboard:l[4],initialLocation:l[2],selectedOperation:l[3]}}),{c(){Y(e.$$.fragment)},l(t){Q(e.$$.fragment,t)},m(t,n){G(e,t,n),r=!0},p(t,n){const o={};n&4&&(o.initialLocation=t[2]),n&8&&(o.selectedOperation=t[3]),e.$set(o)},i(t){r||(C(e.$$.fragment,t),r=!0)},o(t){E(e.$$.fragment,t),r=!1},d(t){j(e,t)}}}function Wf(l){let e,r,t=Uf(l);return{c(){t&&t.c(),e=ne()},l(n){t&&t.l(n),e=ne()},m(n,o){t&&t.m(n,o),U(n,e,o),r=!0},p(n,[o]){t.p(n,o)},i(n){r||(C(t),r=!0)},o(n){E(t),r=!1},d(n){n&&k(e),t&&t.d(n)}}}function jf(l,e,r){let t,n;re(l,_o,p=>r(6,t=p)),re(l,bn,p=>r(11,n=p));let{data:o}=e,i=!0,c=null,s=[],a=null,u=null;console.log("1. MapViewer Page Load - Initial data:",o),Gt("adminSection").set("mapviewer");let g=null;console.log("2. Current selectedOperationStore value:",n);let d=n;console.log("3. Local selectedOperation variable set to:",d),bn.subscribe(p=>{console.log("4. selectedOperationStore changed to:",p),r(3,d=p),console.log("5. Local selectedOperation updated to:",d)});function b(){return/Android/.test(navigator.userAgent)}async function h(){if(b()&&"wakeLock"in navigator)try{g=await navigator.wakeLock.request("screen")}catch(p){p.name!=="NotAllowedError"&&ce.error(`Couldn't keep screen awake: ${p.message}`)}}function _(){g&&g.release().then(()=>{g=null}).catch(p=>{console.error(`Error releasing wake lock: ${p.message}`)})}async function y(){try{if(console.log("Attempting to fetch fields using fileApi..."),!t?.user?.id)throw console.error("No authenticated user"),new Error("Authentication required");const p=await Po.loadFields();if(p.error)throw console.error("Fields API error:",p.error),new Error(`Failed to fetch fields: ${p.error}`);return s=p.fields||[],Xr.set(s),console.log("Fields loaded successfully:",s),s}catch(p){throw console.error("Error loading fields:",p),r(1,c=p.message||"Failed to load fields"),ce.error("Failed to load field data"),p}}async function M(){if(!o.type||!o.id)return null;try{if(!t?.access_token)return console.error("No access token available"),null;const p=t.access_token;console.log("Using token for location API:",p.substring(0,5)+"...");const m=await fetch(`/api/location?type=${o.type}&id=${o.id}`,{headers:{Authorization:`Bearer ${p}`}});if(!m.ok){const v=await m.text();throw console.error("Location API error:",m.status,v),new Error(`Failed to fetch location: ${m.status}`)}return a=(await m.json()).location,r(2,u=a),console.log(`Fetched ${o.type} location:`,a),a}catch(p){return console.error(`Error fetching ${o.type} location:`,p),ce.error(`Failed to load ${o.type} location`),null}}Ge(async()=>{console.log("6. MapViewer Page Mount - selectedOperation:",d),console.log("7. MapViewer Page Mount - store value:",n);{if(t)console.log("Session available on mount:",{userId:t.user?.id,hasToken:!!t.access_token});else{console.log("No session on mount, redirecting to login"),Pr("/login");return}r(0,i=!0);try{await y(),await M(),r(0,i=!1)}catch(p){console.error("Error loading map data:",p),r(0,i=!1)}h(),document.addEventListener("visibilitychange",$)}}),mt(()=>{_(),document.removeEventListener("visibilitychange",$)});function $(){document.visibilityState==="visible"?h():_()}function T(){_(),Pr("/account")}const S=()=>window.location.reload();return l.$$set=p=>{"data"in p&&r(5,o=p.data)},l.$$.update=()=>{l.$$.dirty&64&&(t?console.log("Session found:",t.user?.email):(console.log("No session found, redirecting to login"),Pr("/login")))},[i,c,u,d,T,o,t,S]}class Pd extends ie{constructor(e){super(),se(this,e,jf,Wf,le,{data:5})}}export{Pd as component,Dd as universal};
