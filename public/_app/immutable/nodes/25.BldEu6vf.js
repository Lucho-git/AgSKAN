import{s as N,d as f,i as C,b as h,r as A,f as w,c as m,e as g,k as E,j as _,l as H,v as L,n as P,g as D,q as U,a as u,w as B,h as G,t as J}from"../chunks/DjMlahvE.js";import{S as K,i as Q,t as V,a as j,e as R,d as W,m as X,c as Y,b as Z,g as $}from"../chunks/KhAD1Hhl.js";import{P as ee}from"../chunks/o-up3uFB.js";import{a as te,s as re}from"../chunks/DSS83BMa.js";import{p as M}from"../chunks/C1kVPyTF.js";import{t as q}from"../chunks/C31GE7Pe.js";import{g as ae}from"../chunks/CsvQbYGG.js";const se=()=>({}),ve=Object.freeze(Object.defineProperty({__proto__:null,load:se},Symbol.toStringTag,{value:"Module"}));function oe(v){let t,r,a="Select a Plan",s,o,i,c,l,e,n,d,b,p,y,T,F;return i=new ee({props:{currentPlanId:"none",useFullPrice:!0}}),{c(){t=_("div"),r=_("h1"),r.textContent=a,s=E(),o=_("div"),Z(i.$$.fragment),c=E(),l=_("div"),e=_("div"),n=_("div"),d=_("button"),b=E(),p=_("div"),this.h()},l(x){t=m(x,"DIV",{class:!0});var k=g(t);r=m(k,"H1",{class:!0,"data-svelte-h":!0}),D(r)!=="svelte-1ms61ox"&&(r.textContent=a),s=w(k),o=m(k,"DIV",{class:!0});var I=g(o);Y(i.$$.fragment,I),c=w(I),l=m(I,"DIV",{class:!0});var O=g(l);e=m(O,"DIV",{class:!0});var S=g(e);n=m(S,"DIV",{class:!0});var z=g(n);d=m(z,"BUTTON",{class:!0,"aria-label":!0}),g(d).forEach(f),z.forEach(f),b=w(S),p=m(S,"DIV",{}),g(p).forEach(f),S.forEach(f),O.forEach(f),I.forEach(f),k.forEach(f),this.h()},h(){h(r,"class","mb-4 text-center text-4xl font-bold"),h(d,"class","pointer-events-auto absolute bottom-[calc(50%-80px)] left-1/2 h-12 w-[90%] -translate-x-1/2 opacity-0"),h(d,"aria-label","Get Started with Free Plan"),h(n,"class","relative"),h(e,"class","grid h-full md:grid-cols-2"),h(l,"class","pointer-events-none absolute left-0 top-0 z-10 h-full w-full"),h(o,"class","relative"),h(t,"class","py-2")},m(x,k){C(x,t,k),u(t,r),u(t,s),u(t,o),X(i,o,null),u(o,c),u(o,l),u(l,e),u(e,n),u(n,d),u(e,b),u(e,p),y=!0,T||(F=B(d,"click",v[2]),T=!0)},p:P,i(x){y||(j(i.$$.fragment,x),y=!0)},o(x){V(i.$$.fragment,x),y=!1},d(x){x&&f(t),W(i),T=!1,F()}}}function ne(v){let t,r,a="Error",s,o,i,c,l,e="Try Again",n,d;return{c(){t=_("div"),r=_("h2"),r.textContent=a,s=E(),o=_("p"),i=J(v[1]),c=E(),l=_("button"),l.textContent=e,this.h()},l(b){t=m(b,"DIV",{class:!0});var p=g(t);r=m(p,"H2",{class:!0,"data-svelte-h":!0}),D(r)!=="svelte-1ndfz0n"&&(r.textContent=a),s=w(p),o=m(p,"P",{class:!0});var y=g(o);i=G(y,v[1]),y.forEach(f),c=w(p),l=m(p,"BUTTON",{class:!0,"data-svelte-h":!0}),D(l)!=="svelte-12xr3ni"&&(l.textContent=e),p.forEach(f),this.h()},h(){h(r,"class","mb-4 text-xl font-bold text-red-700"),h(o,"class","text-red-600"),h(l,"class","mt-4 rounded bg-primary px-4 py-2 text-white"),h(t,"class","my-8 rounded-lg bg-red-50 p-6 text-center")},m(b,p){C(b,t,p),u(t,r),u(t,s),u(t,o),u(o,i),u(t,c),u(t,l),n||(d=B(l,"click",v[3]),n=!0)},p(b,p){p&2&&U(i,b[1])},i:P,o:P,d(b){b&&f(t),n=!1,d()}}}function le(v){let t,r='<div class="skeleton mb-4 h-12 w-12 rounded-full"></div>';return{c(){t=_("div"),t.innerHTML=r,this.h()},l(a){t=m(a,"DIV",{class:!0,"data-svelte-h":!0}),D(t)!=="svelte-1d3xhww"&&(t.innerHTML=r),this.h()},h(){h(t,"class","flex h-48 items-center justify-center")},m(a,s){C(a,t,s)},p:P,i:P,o:P,d(a){a&&f(t)}}}function ie(v){let t,r,a,s,o;const i=[le,ne,oe],c=[];function l(e,n){return e[0]?0:e[1]?1:2}return a=l(v),s=c[a]=i[a](v),{c(){t=E(),r=_("div"),s.c(),this.h()},l(e){A("svelte-1dceu6j",document.head).forEach(f),t=w(e),r=m(e,"DIV",{class:!0});var d=g(r);s.l(d),d.forEach(f),this.h()},h(){document.title="Select a Plan",h(r,"class","container mx-auto px-4")},m(e,n){C(e,t,n),C(e,r,n),c[a].m(r,null),o=!0},p(e,[n]){let d=a;a=l(e),a===d?c[a].p(e,n):($(),V(c[d],1,1,()=>{c[d]=null}),R(),s=c[a],s?s.p(e,n):(s=c[a]=i[a](e),s.c()),j(s,1),s.m(r,null))},i(e){o||(j(s),o=!0)},o(e){V(s),o=!1},d(e){e&&(f(t),f(r)),c[a].d()}}}function ce(v,t,r){let a,s;H(v,re,e=>r(4,a=e)),H(v,M,e=>r(5,s=e));let o=!0,i=null;L(async()=>{try{if(s!=null&&s.id){const{error:e}=await te.from("profiles").update({onboarded:!0,updated_at:new Date().toISOString()}).eq("id",s.id);e&&console.error("Error updating onboarding status:",e),M.update(n=>({...n,onboarded:!0}))}r(0,o=!1)}catch(e){console.error("Error initializing payment page:",e),r(1,i=e.message),r(0,o=!1)}});async function c(){try{if(!(a!=null&&a.access_token))throw new Error("No authentication token available");if(!(await fetch("/api/subscription/free",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a.access_token}`}})).ok)throw new Error("Failed to activate free plan");q.success("Free plan activated!"),ae("/account")}catch(e){console.error(e),q.error("Failed to activate free plan. Please try again.")}}return[o,i,c,()=>window.location.reload()]}class be extends K{constructor(t){super(),Q(this,t,ce,ie,N,{})}}export{be as component,ve as universal};
