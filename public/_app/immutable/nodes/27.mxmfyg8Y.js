import{s as q,d as g,H as z,q as C,i as D,a as h,b as w,c as b,e as S,h as V,f as y,j as _,t as $,k as P,z as H,I as O}from"../chunks/Bqk-ehBx.js";import{S as L,i as A,f as R}from"../chunks/BSIXs_Xe.js";import"../chunks/kCv0HOyK.js";import{s as M}from"../chunks/BZNkLwfI.js";import{f as j}from"../chunks/dj070IVl.js";function k(p){let r,l,a,u,d;return{c(){r=_("div"),l=_("div"),a=_("div"),u=P(),d=_("div"),this.h()},l(i){r=b(i,"DIV",{class:!0});var n=S(r);l=b(n,"DIV",{class:!0});var f=S(l);a=b(f,"DIV",{class:!0,style:!0}),S(a).forEach(g),f.forEach(g),n.forEach(g),u=y(i),d=b(i,"DIV",{class:!0}),S(d).forEach(g),this.h()},h(){w(a,"class","h-2 rounded-full bg-blue-600 transition-all duration-500"),O(a,"width",p[2]+"%"),w(l,"class","h-2 w-full rounded-full bg-gray-200"),w(r,"class","mb-4"),w(d,"class","loading loading-spinner loading-md text-blue-600")},m(i,n){D(i,r,n),h(r,l),h(l,a),D(i,u,n),D(i,d,n)},p(i,n){n&4&&O(a,"width",i[2]+"%")},d(i){i&&(g(r),g(u),g(d))}}}function B(p){let r,l,a,u,d,i,n,f,E,m,v,t=p[3]&&k(p);return{c(){r=_("div"),l=_("div"),a=_("div"),u=_("h1"),d=$(p[0]),i=P(),n=_("p"),f=$(p[1]),E=P(),t&&t.c(),this.h()},l(s){r=b(s,"DIV",{class:!0});var c=S(r);l=b(c,"DIV",{class:!0});var I=S(l);a=b(I,"DIV",{class:!0});var o=S(a);u=b(o,"H1",{class:!0});var e=S(u);d=V(e,p[0]),e.forEach(g),i=y(o),n=b(o,"P",{class:!0});var T=S(n);f=V(T,p[1]),T.forEach(g),E=y(o),t&&t.l(o),o.forEach(g),I.forEach(g),c.forEach(g),this.h()},h(){w(u,"class","mb-2 text-2xl font-bold"),w(n,"class","mb-6 text-sm"),w(a,"class","rounded-lg p-8 shadow-lg"),w(l,"class","w-full max-w-md p-8 text-center"),w(r,"class","flex min-h-screen items-center justify-center")},m(s,c){D(s,r,c),h(r,l),h(l,a),h(a,u),h(u,d),h(a,i),h(a,n),h(n,f),h(a,E),t&&t.m(a,null),v=!0},p(s,[c]){(!v||c&1)&&C(d,s[0]),(!v||c&2)&&C(f,s[1]),s[3]?t?t.p(s,c):(t=k(s),t.c(),t.m(a,null)):t&&(t.d(1),t=null)},i(s){v||(s&&z(()=>{v&&(m||(m=R(a,j,{},!0)),m.run(1))}),v=!0)},o(s){s&&(m||(m=R(a,j,{},!1)),m.run(0)),v=!1},d(s){s&&g(r),t&&t.d(),s&&m&&m.end()}}}function F(p,r,l){let a="Preparing to sign out...",u="Initializing...",d=0,i=!1,n=!1;const f=(t,s,c)=>{l(0,a=t),l(1,u=s),l(2,d=c)},E=()=>{console.group("Storage Cleanup");let t=0,s=0;try{for(let o=0;o<localStorage.length;o++){const e=localStorage.key(o);(e!=null&&e.includes("supabase")||e!=null&&e.includes("sb-"))&&s++}for(let o=0;o<sessionStorage.length;o++){const e=sessionStorage.key(o);(e!=null&&e.includes("supabase")||e!=null&&e.includes("sb-"))&&s++}document.cookie.split(";").forEach(o=>{const e=o.split("=")[0].trim();(e.includes("supabase")||e.includes("sb-"))&&s++});for(let o=0;o<localStorage.length;o++){const e=localStorage.key(o);(e!=null&&e.includes("supabase")||e!=null&&e.includes("sb-"))&&(localStorage.removeItem(e),t++,console.log(`Cleared localStorage: ${e}`))}for(let o=0;o<sessionStorage.length;o++){const e=sessionStorage.key(o);(e!=null&&e.includes("supabase")||e!=null&&e.includes("sb-"))&&(sessionStorage.removeItem(e),t++,console.log(`Cleared sessionStorage: ${e}`))}const c=[window.location.hostname,`.${window.location.hostname}`,window.location.hostname.split(".").slice(1).join("."),""],I=["/",""];return document.cookie.split(";").forEach(o=>{const e=o.split("=")[0].trim();(e.includes("supabase")||e.includes("sb-"))&&(c.forEach(T=>{I.forEach(x=>{document.cookie=`${e}=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=${x}${T?`; domain=${T}`:""}`})}),t++,console.log(`Cleared cookie: ${e}`))}),{success:!0,clearedItems:t,totalItems:s}}catch(c){return console.error("Error clearing storage:",c),{success:!1,error:c}}finally{console.groupEnd()}},m=()=>{window.location.replace("/login")},v=async()=>{if(!i){l(3,i=!0),console.group("Sign-out Process"),console.time("Total Sign-out Duration");try{f("Signing out...","Contacting server...",20),await new Promise(s=>setTimeout(s,400));try{const s=new FormData,c=await fetch("?/signout",{method:"POST",body:s})}catch(s){console.log("Server-side signout skipped:",s)}f("Signing out...","Clearing authentication...",40),await new Promise(s=>setTimeout(s,400)),f("Cleaning up...","Removing stored data...",60),await new Promise(s=>setTimeout(s,400)),E().success||console.warn("Storage cleanup had issues"),f("Verifying...","Making sure everything is cleared...",80),await new Promise(s=>setTimeout(s,400)),E(),f("Success!","Taking you to login...",100),await new Promise(s=>setTimeout(s,400)),n=!0,await M.auth.signOut({scope:"global"}),setTimeout(()=>{m()},100)}catch(t){console.error("Sign-out failed:",t),f("Error during sign-out","Attempting emergency cleanup...",100);try{E(),n=!0,await M.auth.signOut({scope:"global"})}catch(s){console.error("Recovery attempt failed:",s)}setTimeout(()=>{m()},500)}finally{console.timeEnd("Total Sign-out Duration"),console.groupEnd()}}};return H(()=>{window.addEventListener("beforeunload",()=>{if(n)return m(),null}),v()}),[a,u,d,i]}class U extends L{constructor(r){super(),A(this,r,F,B,q,{})}}export{U as component};
