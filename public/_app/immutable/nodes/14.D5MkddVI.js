import{i as zl,s as go}from"../chunks/DSS83BMa.js";import"../chunks/B842dgTK.js";import{d as Kt,w as Fe}from"../chunks/CAuzrzLJ.js";import{c as ot,a as kr,u as Ct,b as Qt,d as Je,s as Ut,l as Hr,m as er,r as tr,e as Ze,f as $t,g as br,h as it,i as _o,o as vr,j as Vl,k as mr,M as po,n as dn,p as hn}from"../chunks/Cg1a1K1Q.js";import{s as se,x as ee,y as Le,m as ve,u as we,o as ke,p as ye,a0 as Er,A as Gt,d as w,i as U,z as ne,O as Ee,l as re,N as Ne,$ as et,c as V,e as q,j as F,B as Ue,n as $e,K as mt,w as Se,v as Ge,Q as gt,G as lr,a as A,b as D,g as be,f as X,k as Z,I as Ae,ao as bo,a4 as jr,a5 as Cr,_ as St,h as ge,t as _e,D as rn,q as Ve,X as Mt,E as ct,F as ut,a1 as Fl,P as vo,L as Bl}from"../chunks/DjMlahvE.js";import{S as ce,i as ue,d as W,t as C,a as T,m as G,c as Q,b as Y,g as de,e as he,h as Sr}from"../chunks/KhAD1Hhl.js";import{g as Dr}from"../chunks/BEF5l8Zs.js";import{t as oe}from"../chunks/C31GE7Pe.js";import{f as mn}from"../chunks/fQFbg8Ms.js";import{e as dt}from"../chunks/Bb_pmx5I.js";import{p as $r}from"../chunks/C1kVPyTF.js";import{v as gn,I as Ul,S as It,R as wo}from"../chunks/wxT23kMx.js";import"../chunks/BWDwsojb.js";import{C as Wr}from"../chunks/dygaiJ73.js";import{C as Rl,a as ql,b as Hl}from"../chunks/UqB1tdux.js";import{g as Oe,a as Ke}from"../chunks/CgU5AtxT.js";import{n as or,v as ko,w as De,m as bt,s as ft,q as Lt,p as We,a as Ot,b as Ht,i as _t,o as jl,c as Wl,d as Or,x as _n,f as yo,h as Nr,k as xe}from"../chunks/C_1Z-JuE.js";import{t as Gr,o as To,r as Gl,g as Yl}from"../chunks/PxNejdew.js";import{g as Xl}from"../chunks/DgJyTKp9.js";import{c as Zl,a as Eo}from"../chunks/DegEEPwQ.js";import{c as ht}from"../chunks/BNe2q0eJ.js";import{g as Co,R as So,T as $o,a as zr}from"../chunks/BSi0AJmE.js";import{a as Mo,b as Io}from"../chunks/Cc2R5-Bm.js";import{B as jt}from"../chunks/BJvKbOIU.js";import{S as nn,M as Jl}from"../chunks/O-gaH_xA.js";import{I as Yt}from"../chunks/BQRQFwEA.js";import{I as Lo,f as Ao}from"../chunks/C6qshsd-.js";import{M as Po}from"../chunks/CMxPyc5P.js";import{m as Kl}from"../chunks/C58cqHmn.js";import{s as le}from"../chunks/BaPH9Oqq.js";import{p as Do}from"../chunks/1ZeRG0_x.js";import{X as Ql}from"../chunks/CIS0RtgP.js";import{d as gr,r as Oo,c as wr,p as rr,f as xl,a as yr,b as No,e as pn,g as zo}from"../chunks/DGvxl_Sj.js";import{T as eo}from"../chunks/BaJfaAmE.js";import{A as Vo}from"../chunks/DI3UA9Lc.js";import{A as Fo}from"../chunks/BHJbHlni.js";import{s as bn}from"../chunks/BvQflP90.js";function Bo(l){let e;const r=l[2].default,t=ve(r,l,l[3],null);return{c(){t&&t.c()},l(n){t&&t.l(n)},m(n,o){t&&t.m(n,o),e=!0},p(n,o){t&&t.p&&(!e||o&8)&&we(t,r,n,n[3],e?ye(r,n[3],o,null):ke(n[3]),null)},i(n){e||(T(t,n),e=!0)},o(n){C(t,n),e=!1},d(n){t&&t.d(n)}}}function Uo(l){let e,r;const t=[{name:"gauge"},l[1],{iconNode:l[0]}];let n={$$slots:{default:[Bo]},$$scope:{ctx:l}};for(let o=0;o<t.length;o+=1)n=ee(n,t[o]);return e=new Yt({props:n}),{c(){Y(e.$$.fragment)},l(o){Q(e.$$.fragment,o)},m(o,i){G(e,o,i),r=!0},p(o,[i]){const c=i&3?Oe(t,[t[0],i&2&&Ke(o[1]),i&1&&{iconNode:o[0]}]):{};i&8&&(c.$$scope={dirty:i,ctx:o}),e.$set(c)},i(o){r||(T(e.$$.fragment,o),r=!0)},o(o){C(e.$$.fragment,o),r=!1},d(o){W(e,o)}}}function Ro(l,e,r){let{$$slots:t={},$$scope:n}=e;const o=[["path",{d:"m12 14 4-4"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0"}]];return l.$$set=i=>{r(1,e=ee(ee({},e),Le(i))),"$$scope"in i&&r(3,n=i.$$scope)},e=Le(e),[o,e,t,n]}class qo extends ce{constructor(e){super(),ue(this,e,Ro,Uo,se,{})}}function Ho(l){let e;const r=l[2].default,t=ve(r,l,l[3],null);return{c(){t&&t.c()},l(n){t&&t.l(n)},m(n,o){t&&t.m(n,o),e=!0},p(n,o){t&&t.p&&(!e||o&8)&&we(t,r,n,n[3],e?ye(r,n[3],o,null):ke(n[3]),null)},i(n){e||(T(t,n),e=!0)},o(n){C(t,n),e=!1},d(n){t&&t.d(n)}}}function jo(l){let e,r;const t=[{name:"house"},l[1],{iconNode:l[0]}];let n={$$slots:{default:[Ho]},$$scope:{ctx:l}};for(let o=0;o<t.length;o+=1)n=ee(n,t[o]);return e=new Yt({props:n}),{c(){Y(e.$$.fragment)},l(o){Q(e.$$.fragment,o)},m(o,i){G(e,o,i),r=!0},p(o,[i]){const c=i&3?Oe(t,[t[0],i&2&&Ke(o[1]),i&1&&{iconNode:o[0]}]):{};i&8&&(c.$$scope={dirty:i,ctx:o}),e.$set(c)},i(o){r||(T(e.$$.fragment,o),r=!0)},o(o){C(e.$$.fragment,o),r=!1},d(o){W(e,o)}}}function Wo(l,e,r){let{$$slots:t={},$$scope:n}=e;const o=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}]];return l.$$set=i=>{r(1,e=ee(ee({},e),Le(i))),"$$scope"in i&&r(3,n=i.$$scope)},e=Le(e),[o,e,t,n]}class Go extends ce{constructor(e){super(),ue(this,e,Wo,jo,se,{})}}function Yo(l){let e;const r=l[2].default,t=ve(r,l,l[3],null);return{c(){t&&t.c()},l(n){t&&t.l(n)},m(n,o){t&&t.m(n,o),e=!0},p(n,o){t&&t.p&&(!e||o&8)&&we(t,r,n,n[3],e?ye(r,n[3],o,null):ke(n[3]),null)},i(n){e||(T(t,n),e=!0)},o(n){C(t,n),e=!1},d(n){t&&t.d(n)}}}function Xo(l){let e,r;const t=[{name:"paintbrush"},l[1],{iconNode:l[0]}];let n={$$slots:{default:[Yo]},$$scope:{ctx:l}};for(let o=0;o<t.length;o+=1)n=ee(n,t[o]);return e=new Yt({props:n}),{c(){Y(e.$$.fragment)},l(o){Q(e.$$.fragment,o)},m(o,i){G(e,o,i),r=!0},p(o,[i]){const c=i&3?Oe(t,[t[0],i&2&&Ke(o[1]),i&1&&{iconNode:o[0]}]):{};i&8&&(c.$$scope={dirty:i,ctx:o}),e.$set(c)},i(o){r||(T(e.$$.fragment,o),r=!0)},o(o){C(e.$$.fragment,o),r=!1},d(o){W(e,o)}}}function Zo(l,e,r){let{$$slots:t={},$$scope:n}=e;const o=[["path",{d:"m14.622 17.897-10.68-2.913"}],["path",{d:"M18.376 2.622a1 1 0 1 1 3.002 3.002L17.36 9.643a.5.5 0 0 0 0 .707l.944.944a2.41 2.41 0 0 1 0 3.408l-.944.944a.5.5 0 0 1-.707 0L8.354 7.348a.5.5 0 0 1 0-.707l.944-.944a2.41 2.41 0 0 1 3.408 0l.944.944a.5.5 0 0 0 .707 0z"}],["path",{d:"M9 8c-1.804 2.71-3.97 3.46-6.583 3.948a.507.507 0 0 0-.302.819l7.32 8.883a1 1 0 0 0 1.185.204C12.735 20.405 16 16.792 16 15"}]];return l.$$set=i=>{r(1,e=ee(ee({},e),Le(i))),"$$scope"in i&&r(3,n=i.$$scope)},e=Le(e),[o,e,t,n]}class Jo extends ce{constructor(e){super(),ue(this,e,Zo,Xo,se,{})}}function Ko(l){let e;const r=l[2].default,t=ve(r,l,l[3],null);return{c(){t&&t.c()},l(n){t&&t.l(n)},m(n,o){t&&t.m(n,o),e=!0},p(n,o){t&&t.p&&(!e||o&8)&&we(t,r,n,n[3],e?ye(r,n[3],o,null):ke(n[3]),null)},i(n){e||(T(t,n),e=!0)},o(n){C(t,n),e=!1},d(n){t&&t.d(n)}}}function Qo(l){let e,r;const t=[{name:"pen-off"},l[1],{iconNode:l[0]}];let n={$$slots:{default:[Ko]},$$scope:{ctx:l}};for(let o=0;o<t.length;o+=1)n=ee(n,t[o]);return e=new Yt({props:n}),{c(){Y(e.$$.fragment)},l(o){Q(e.$$.fragment,o)},m(o,i){G(e,o,i),r=!0},p(o,[i]){const c=i&3?Oe(t,[t[0],i&2&&Ke(o[1]),i&1&&{iconNode:o[0]}]):{};i&8&&(c.$$scope={dirty:i,ctx:o}),e.$set(c)},i(o){r||(T(e.$$.fragment,o),r=!0)},o(o){C(e.$$.fragment,o),r=!1},d(o){W(e,o)}}}function xo(l,e,r){let{$$slots:t={},$$scope:n}=e;const o=[["path",{d:"m10 10-6.157 6.162a2 2 0 0 0-.5.833l-1.322 4.36a.5.5 0 0 0 .622.624l4.358-1.323a2 2 0 0 0 .83-.5L14 13.982"}],["path",{d:"m12.829 7.172 4.359-4.346a1 1 0 1 1 3.986 3.986l-4.353 4.353"}],["path",{d:"m2 2 20 20"}]];return l.$$set=i=>{r(1,e=ee(ee({},e),Le(i))),"$$scope"in i&&r(3,n=i.$$scope)},e=Le(e),[o,e,t,n]}class ei extends ce{constructor(e){super(),ue(this,e,xo,Qo,se,{})}}function ti(l){let e;const r=l[2].default,t=ve(r,l,l[3],null);return{c(){t&&t.c()},l(n){t&&t.l(n)},m(n,o){t&&t.m(n,o),e=!0},p(n,o){t&&t.p&&(!e||o&8)&&we(t,r,n,n[3],e?ye(r,n[3],o,null):ke(n[3]),null)},i(n){e||(T(t,n),e=!0)},o(n){C(t,n),e=!1},d(n){t&&t.d(n)}}}function ri(l){let e,r;const t=[{name:"pencil-ruler"},l[1],{iconNode:l[0]}];let n={$$slots:{default:[ti]},$$scope:{ctx:l}};for(let o=0;o<t.length;o+=1)n=ee(n,t[o]);return e=new Yt({props:n}),{c(){Y(e.$$.fragment)},l(o){Q(e.$$.fragment,o)},m(o,i){G(e,o,i),r=!0},p(o,[i]){const c=i&3?Oe(t,[t[0],i&2&&Ke(o[1]),i&1&&{iconNode:o[0]}]):{};i&8&&(c.$$scope={dirty:i,ctx:o}),e.$set(c)},i(o){r||(T(e.$$.fragment,o),r=!0)},o(o){C(e.$$.fragment,o),r=!1},d(o){W(e,o)}}}function ni(l,e,r){let{$$slots:t={},$$scope:n}=e;const o=[["path",{d:"M13 7 8.7 2.7a2.41 2.41 0 0 0-3.4 0L2.7 5.3a2.41 2.41 0 0 0 0 3.4L7 13"}],["path",{d:"m8 6 2-2"}],["path",{d:"m18 16 2-2"}],["path",{d:"m17 11 4.3 4.3c.94.94.94 2.46 0 3.4l-2.6 2.6c-.94.94-2.46.94-3.4 0L11 17"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z"}],["path",{d:"m15 5 4 4"}]];return l.$$set=i=>{r(1,e=ee(ee({},e),Le(i))),"$$scope"in i&&r(3,n=i.$$scope)},e=Le(e),[o,e,t,n]}class li extends ce{constructor(e){super(),ue(this,e,ni,ri,se,{})}}function oi(l){let e;const r=l[2].default,t=ve(r,l,l[3],null);return{c(){t&&t.c()},l(n){t&&t.l(n)},m(n,o){t&&t.m(n,o),e=!0},p(n,o){t&&t.p&&(!e||o&8)&&we(t,r,n,n[3],e?ye(r,n[3],o,null):ke(n[3]),null)},i(n){e||(T(t,n),e=!0)},o(n){C(t,n),e=!1},d(n){t&&t.d(n)}}}function ii(l){let e,r;const t=[{name:"ruler"},l[1],{iconNode:l[0]}];let n={$$slots:{default:[oi]},$$scope:{ctx:l}};for(let o=0;o<t.length;o+=1)n=ee(n,t[o]);return e=new Yt({props:n}),{c(){Y(e.$$.fragment)},l(o){Q(e.$$.fragment,o)},m(o,i){G(e,o,i),r=!0},p(o,[i]){const c=i&3?Oe(t,[t[0],i&2&&Ke(o[1]),i&1&&{iconNode:o[0]}]):{};i&8&&(c.$$scope={dirty:i,ctx:o}),e.$set(c)},i(o){r||(T(e.$$.fragment,o),r=!0)},o(o){C(e.$$.fragment,o),r=!1},d(o){W(e,o)}}}function si(l,e,r){let{$$slots:t={},$$scope:n}=e;const o=[["path",{d:"M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0Z"}],["path",{d:"m14.5 12.5 2-2"}],["path",{d:"m11.5 9.5 2-2"}],["path",{d:"m8.5 6.5 2-2"}],["path",{d:"m17.5 15.5 2-2"}]];return l.$$set=i=>{r(1,e=ee(ee({},e),Le(i))),"$$scope"in i&&r(3,n=i.$$scope)},e=Le(e),[o,e,t,n]}class ai extends ce{constructor(e){super(),ue(this,e,si,ii,se,{})}}function Vr(l,e,r,t){const n=(l-(isNaN(e)?0:e))%t;let o=Math.abs(n)*2>=t?l+Math.sign(n)*(t-Math.abs(n)):l-n;isNaN(e)?!isNaN(r)&&o>r&&(o=Math.floor(r/t)*t):o<e?o=e:!isNaN(r)&&o>r&&(o=e+Math.floor((r-e)/t)*t);const i=t.toString(),c=i.indexOf("."),s=c>=0?i.length-c:0;if(s>0){const a=Math.pow(10,s);o=Math.round(o*a)/a}return o}function ci(l,e,r){return Math.max(l,Math.min(e,r))}function to(l,e){let r=0;return ko(()=>{clearTimeout(r)}),()=>{window.clearTimeout(r),r=window.setTimeout(l,e)}}function Yr(l,e){let r=0;const t=new ResizeObserver(()=>{cancelAnimationFrame(r),r=requestAnimationFrame(e)});return t.observe(l),()=>{window.cancelAnimationFrame(r),t.unobserve(l)}}function ui(l,e=or){let r={left:l.scrollLeft,top:l.scrollTop},t=0;return function n(){const o={left:l.scrollLeft,top:l.scrollTop},i=r.left!==o.left,c=r.top!==o.top;(i||c)&&e(),r=o,t=window.requestAnimationFrame(n)}(),()=>window.cancelAnimationFrame(t)}function vn(l,e){return l>0&&l<e}function ro(l,e){return r=>{if(l[0]===l[1]||e[0]===e[1])return e[0];const t=(e[1]-e[0])/(l[1]-l[0]);return e[0]+t*(r-l[0])}}function _r(l){return l?parseInt(l,10):0}function no(l,e){const r=l/e;return isNaN(r)?0:r}function Mr(l){const e=no(l.viewport,l.content),r=l.scrollbar.paddingStart+l.scrollbar.paddingEnd,t=(l.scrollbar.size-r)*e;return Math.max(t,18)}function fi(l,e,r,t="ltr"){const n=Mr(r),o=n/2,i=e||o,c=n-i,s=r.scrollbar.paddingStart+i,a=r.scrollbar.size-r.scrollbar.paddingEnd-c,u=r.content-r.viewport,f=t==="ltr"?[0,u]:[u*-1,0];return ro([s,a],f)(l)}function di(l,e,r="ltr"){const t=Mr(e),n=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,o=e.scrollbar.size-n,i=e.content-e.viewport,c=o-t,[s,a]=r==="ltr"?[0,i]:[i*-1,0],u=ci(s,l,a);return ro([0,i],[0,c])(u)}function hi(l,e){const r=De.writable(l);function t(o){const i=r.get();return e[i][o]??i}return{state:r,dispatch:o=>{r.set(t(o))}}}function nr(l){const{rootState:e,scrollbarState:r}=l;r.isVisible.set(!0);function t(a){const u=r.domRect.get();if(!u)return;const f=a.clientX-u.left,_=a.clientY-u.top;r.isHorizontal.get()?r.onDragScroll(f):r.onDragScroll(_)}function n(a){if(a.button!==0)return;const u=a.target;if(!_t(u))return;u.setPointerCapture(a.pointerId);const f=a.currentTarget;if(!_t(f))return;r.domRect.set(f.getBoundingClientRect()),r.prevWebkitUserSelect.set(document.body.style.webkitUserSelect),document.body.style.webkitUserSelect="none";const _=e.viewportEl.get();_&&(_.style.scrollBehavior="auto"),t(a)}function o(a){t(a)}function i(a){const u=a.target;if(!_t(u))return;u.hasPointerCapture(a.pointerId)&&u.releasePointerCapture(a.pointerId),document.body.style.webkitUserSelect=r.prevWebkitUserSelect.get();const f=e.viewportEl.get();f&&(f.style.scrollBehavior=""),r.domRect.set(null)}function c(a){const u=a.target,f=a.currentTarget;if(!_t(u)||!_t(f)||!f.contains(u))return;const d=r.sizes.get();if(!d)return;const p=d.content-d.viewport;r.handleWheelScroll(a,p)}function s(a){r.scrollbarEl.set(a);const u=Ot(Ht(a,"pointerdown",n),Ht(a,"pointermove",o),Ht(a,"pointerup",i),We(document,"wheel",c,{passive:!1})),f=Lt([e.contentEl],([_])=>_?Yr(_,r.handleSizeChange):or);return{destroy(){u(),f()}}}return s}function mi(l){const e=nr(l),{rootState:r,scrollbarState:t}=l,n=to(()=>{const i=r.viewportEl.get();if(!i)return;const c=i.offsetWidth<i.scrollWidth,s=i.offsetHeight<i.scrollHeight;t.isVisible.set(t.isHorizontal.get()?c:s)},10);function o(i){var f;const c=(f=e(i))==null?void 0:f.destroy;n();const s=[],a=r.viewportEl.get();a&&s.push(Yr(a,n));const u=r.contentEl.get();return u&&s.push(Yr(u,n)),{destroy(){s.forEach(_=>_()),c()}}}return o}function gi(l){const e=nr(l),{rootState:r,scrollbarState:t}=l;t.isVisible.set(!1);let n;function o(){if(window.clearTimeout(n),t.isVisible.get())return;const s=r.viewportEl.get();if(!s)return;const a=s.offsetWidth<s.scrollWidth,u=s.offsetHeight<s.scrollHeight;t.isVisible.set(t.isHorizontal.get()?a:u)}function i(){n=window.setTimeout(()=>{t.isVisible.get()&&t.isVisible.set(!1)},r.options.hideDelay.get())}function c(s){var _;const a=(_=e(s))==null?void 0:_.destroy,u=s.closest("[data-melt-scroll-area]");let f=or;return u&&(Mo()?f=Ot(We(u,"touchstart",o),We(u,"touchend",i)):Io()?f=Ot(We(u,"pointerenter",o),We(u,"mouseenter",o),We(u,"mouseleave",i)):f=Ot(We(u,"pointerenter",o),We(u,"pointerleave",i))),{destroy(){a==null||a(),f()}}}return c}function _i(l){const e=nr(l),{rootState:r,scrollbarState:t}=l,n=hi("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});Lt([n.state],([c])=>{c==="idle"&&window.setTimeout(()=>{n.dispatch("HIDE")},r.options.hideDelay.get()),c==="hidden"?t.isVisible.set(!1):t.isVisible.set(!0)});const o=to(()=>n.dispatch("SCROLL_END"),100);Lt([r.viewportEl,t.isHorizontal],([c,s])=>{const a=s?"scrollLeft":"scrollTop";let u=or;if(c){let f=c[a];u=We(c,"scroll",()=>{const d=c[a];f!==d&&(n.dispatch("SCROLL"),o()),f=d})}return()=>{u()}});function i(c){var u;const s=(u=e(c))==null?void 0:u.destroy,a=Ot(We(c,"pointerenter",()=>n.dispatch("POINTER_ENTER")),We(c,"pointerleave",()=>n.dispatch("POINTER_LEAVE")));return{destroy(){s==null||s(),a()}}}return i}function pi(l,e){const r=e(l),{rootState:t,scrollbarState:n}=l;return bt(Nt("scrollbar"),{stores:[n.sizes,t.options.dir,n.isVisible],returned:([o,i,c])=>({style:ft({position:"absolute",bottom:0,left:i==="rtl"?"var(--melt-scroll-area-corner-width)":0,right:i==="ltr"?"var(--melt-scroll-area-corner-width)":0,"--melt-scroll-area-thumb-width":`${Mr(o)}px`,visibility:c?void 0:"hidden"}),"data-state":c?"visible":"hidden"}),action:o=>{var c;const i=(c=r(o))==null?void 0:c.destroy;return t.scrollbarXEl.set(o),t.scrollbarXEnabled.set(!0),{destroy(){i==null||i(),t.scrollbarXEl.set(null)}}}})}function bi(l,e){const r=e(l),{rootState:t,scrollbarState:n}=l;return bt(Nt("scrollbar"),{stores:[n.sizes,t.options.dir,n.isVisible],returned:([o,i,c])=>({style:ft({position:"absolute",top:0,right:i==="ltr"?0:void 0,left:i==="rtl"?0:void 0,bottom:"var(--melt-scroll-area-corner-height)","--melt-scroll-area-thumb-height":`${Mr(o)}px`,visibility:c?void 0:"hidden"}),"data-state":c?"visible":"hidden"}),action:o=>{var c;const i=(c=r(o))==null?void 0:c.destroy;return t.scrollbarYEl.set(o),t.scrollbarYEnabled.set(!0),{destroy(){i==null||i(),t.scrollbarYEl.set(null)}}}})}function vi(l){switch(l){case"always":return nr;case"auto":return mi;case"hover":return gi;case"scroll":return _i;default:return nr}}const{name:Nt}=Wl("scroll-area"),wi=["root","viewport","content","scrollbarX","scrollbarY","thumbX","thumbY"],ki={type:"hover",hideDelay:600,dir:"ltr"};function yi(l){const e={...ki,...l},r=Gr(jl(e,"ids")),t=De.writable(0),n=De.writable(0),o=De.writable(!1),i=De.writable(!1),c=De.writable(null),s=De.writable(null),a=De.writable(null),u=De.writable(null),f=De.writable(null),_=Gr({...Xl(wi),...e.ids}),d={cornerWidth:t,cornerHeight:n,scrollbarXEnabled:o,scrollbarYEnabled:i,viewportEl:s,contentEl:a,options:r,scrollbarXEl:u,scrollbarYEl:f,scrollAreaEl:c,ids:_},p=bt(Nt(),{stores:[t,n,_.root],returned:([h,b,y])=>({style:ft({position:"relative","--melt-scroll-area-corner-width":`${h}px`,"--melt-scroll-area-corner-height":`${b}px`}),id:y}),action:h=>(c.set(h),{destroy(){c.set(null)}})}),m=bt(Nt("viewport"),{stores:[o,i,_.viewport],returned:([h,b,y])=>({style:ft({"scrollbar-width":"none","-ms-overflow-style":"none","-webkit-overflow-scrolling":"touch","-webkit-scrollbar":"none","overflow-x":h?"scroll":"hidden","overflow-y":b?"scroll":"hidden"}),id:y}),action:h=>{var y;const b=document.createElement("style");return b.innerHTML=`
				/* Hide scrollbars cross-browser and enable momentum scroll for touch
					devices */
				[data-melt-scroll-area-viewport] {
					scrollbar-width: none;
					-ms-overflow-style: none;
					-webkit-overflow-scrolling: touch;
				}

				[data-melt-scroll-area-viewport]::-webkit-scrollbar {
					display: none;
				}
			`,(y=h.parentElement)==null||y.insertBefore(b,h),s.set(h),{destroy(){b.remove(),s.set(null)}}}}),g=bt(Nt("content"),{stores:[_.content],returned:([h])=>({style:ft({"min-width":"100%",display:"table"}),id:h}),action:h=>(a.set(h),{destroy(){a.set(null)}})});function v(h="vertical"){const b=De.writable(h),y=De.writable(h==="horizontal"),L=De.writable(null),N=De.writable(""),M=De.writable(0),P=De.writable(null),H=De.writable(0),O=De.writable(null),R=De.writable({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),z=De.writable(!1),B=De.derived(R,fe=>{const Pe=no(fe.viewport,fe.content);return Pe>0&&Pe<1});function J(fe,Pe){return fi(fe,M.get(),R.get(),Pe)}function K(fe,Pe){const Ce=s.get();if(Ce)if(y.get()){const Re=Ce.scrollLeft+fe.deltaY;Ce.scrollLeft=Re,vn(Re,Pe)&&fe.preventDefault()}else{const Re=Ce.scrollTop+fe.deltaY;Ce.scrollTop=Re,vn(Re,Pe)&&fe.preventDefault()}}function te(fe){y.get()?M.set(fe.x):M.set(fe.y)}function j(){M.set(0)}function x(){const fe=s.get(),Pe=P.get();if(!fe||!Pe)return;const Ce=y.get()?fe.scrollLeft:fe.scrollTop,Re=di(Ce,R.get(),d.options.dir.get());H.set(Re)}function me(fe){const Pe=s.get();Pe&&(y.get()?Pe.scrollLeft=J(fe,d.options.dir.get()):Pe.scrollTop=J(fe))}function pe(){const fe=Te.scrollbarEl.get();if(!fe)return;const Pe=Te.isHorizontal.get(),Ce=d.viewportEl.get();Pe?Te.sizes.set({content:(Ce==null?void 0:Ce.scrollWidth)??0,viewport:(Ce==null?void 0:Ce.offsetWidth)??0,scrollbar:{size:fe.clientWidth??0,paddingStart:_r(getComputedStyle(fe).paddingLeft),paddingEnd:_r(getComputedStyle(fe).paddingRight)}}):Te.sizes.set({content:(Ce==null?void 0:Ce.scrollHeight)??0,viewport:(Ce==null?void 0:Ce.offsetHeight)??0,scrollbar:{size:fe.clientHeight??0,paddingStart:_r(getComputedStyle(fe).paddingLeft),paddingEnd:_r(getComputedStyle(fe).paddingRight)}})}const Te={isHorizontal:y,domRect:L,prevWebkitUserSelect:N,pointerOffset:M,thumbEl:P,thumbOffset:H,sizes:R,orientation:b,handleThumbDown:te,handleThumbUp:j,onThumbPositionChange:x,onDragScroll:me,handleWheelScroll:K,hasThumb:B,scrollbarEl:O,isVisible:z,handleSizeChange:pe},Me=vi(r.type.get()),ae={rootState:d,scrollbarState:Te},ie=h==="horizontal"?pi(ae,Me):bi(ae,Me),Ie=Ti(ae);return{scrollbar:ie,thumb:Ie}}const{scrollbar:$,thumb:I}=v("horizontal"),{scrollbar:k,thumb:S}=v("vertical"),E=Ei(d);return{options:r,elements:{root:p,viewport:m,content:g,corner:E,scrollbarX:$,scrollbarY:k,thumbX:I,thumbY:S}}}function Ti(l){const{scrollbarState:e,rootState:r}=l;function t(s){const a=s.target;if(!_t(a))return;const u=a.getBoundingClientRect(),f=s.clientX-u.left,_=s.clientY-u.top;e.handleThumbDown({x:f,y:_})}function n(s){e.handleThumbUp(s)}let o;function i(){if(o)return;const s=r.viewportEl.get();s&&(o=ui(s,e.onThumbPositionChange)),e.onThumbPositionChange()}return bt(Nt("thumb"),{stores:[e.hasThumb,e.isHorizontal,e.thumbOffset],returned:([s,a,u])=>({style:ft({width:"var(--melt-scroll-area-thumb-width)",height:"var(--melt-scroll-area-thumb-height)",transform:a?`translate3d(${Math.round(u)}px, 0, 0)`:`translate3d(0, ${Math.round(u)}px, 0)`}),"data-state":s?"visible":"hidden"}),action:s=>{e.thumbEl.set(s);const a=Lt([e.sizes],([f])=>{const _=r.viewportEl.get();return _?(e.onThumbPositionChange(),We(_,"scroll",i)):or}),u=Ot(Ht(s,"pointerdown",t),Ht(s,"pointerup",n));return{destroy(){o==null||o(),u(),a()}}}})}function Ei(l){const e=Fe(0),r=Fe(0),t=Kt([e,r],([u,f])=>!!u&&!!f);function n(){var f;const u=((f=l.scrollbarXEl.get())==null?void 0:f.offsetHeight)||0;l.cornerHeight.set(u),r.set(u)}function o(){var f;const u=((f=l.scrollbarYEl.get())==null?void 0:f.offsetWidth)||0;l.cornerWidth.set(u),e.set(u)}Lt([l.scrollbarXEl],([u])=>{u&&n()}),Lt([l.scrollbarYEl],([u])=>{u&&o()});const i=Kt([l.scrollbarXEl,l.scrollbarYEl],([u,f])=>!!u&&!!f),c=Kt([l.options.type,i],([u,f])=>u!=="scroll"&&f),s=Kt([c,t],([u,f])=>u&&f);return bt(Nt("corner"),{stores:[e,r,l.options.dir,s],returned:([u,f,_,d])=>({style:ft({display:d?"block":"none",width:`${u}px`,height:`${f}px`,position:"absolute",right:_==="ltr"?0:void 0,left:_==="rtl"?0:void 0,bottom:0})})})}const Ci={defaultValue:[],min:0,max:100,step:1,orientation:"horizontal",dir:"ltr",disabled:!1},{name:pr}=Wl("slider"),Si=l=>{const e={...Ci,...l},r=Gr(jl(e,"value","onValueChange","defaultValue")),{min:t,max:n,step:o,orientation:i,dir:c,disabled:s}=r,a=e.value??Fe(e.defaultValue),u=To(a,e==null?void 0:e.onValueChange),f=De(Fe(!1)),_=De(Fe(0)),d=De(Fe(null)),p=Xl(["root"]),m=(h,b)=>{u.update(y=>{if(!y)return[h];if(y[b]===h)return y;const L=[...y],N=L[b]>h?-1:1;function M(){L[b]=L[b+N],L[b+N]=h;const R=g();R&&(R[b+N].focus(),d.set({thumb:R[b+N],index:b+N}))}if(N===-1&&h<L[b-1])return M(),L;if(N===1&&h>L[b+1])return M(),L;const P=t.get(),H=n.get(),O=o.get();return L[b]=Vr(h,P,H,O),L})},g=()=>{const h=Nr(p.root);return h?Array.from(h.querySelectorAll('[data-melt-part="thumb"]')).filter(b=>_t(b)):null},v=Kt([t,n],([h,b])=>y=>(y-h)/(b-h)*100),$=De.derived([i,c],([h,b])=>h==="horizontal"?b==="rtl"?"rl":"lr":b==="rtl"?"tb":"bt"),I=bt(pr(),{stores:[s,i,c],returned:([h,b,y])=>({dir:y,disabled:Or(h),"data-disabled":Or(h),"data-orientation":b,style:h?void 0:`touch-action: ${b==="horizontal"?"pan-y":"pan-x"}`,"data-melt-id":p.root})}),k=bt(pr("range"),{stores:[u,$,v],returned:([h,b,y])=>{const L=h.length>1?y(Math.min(...h)??0):0,N=100-y(Math.max(...h)??0),M={position:"absolute"};switch(b){case"lr":{M.left=`${L}%`,M.right=`${N}%`;break}case"rl":{M.right=`${L}%`,M.left=`${N}%`;break}case"bt":{M.bottom=`${L}%`,M.top=`${N}%`;break}case"tb":{M.top=`${L}%`,M.bottom=`${N}%`;break}}return{style:ft(M)}}}),S=_n(pr("thumb"),{stores:[u,v,t,n,s,i,$],returned:([h,b,y,L,N,M,P])=>Array.from({length:h.length||1},(O,R)=>{_.get()<h.length&&_.update(te=>te+1);const B=h[R],J=`${b(B)}%`,K={position:"absolute"};switch(P){case"lr":{K.left=J,K.translate="-50% 0";break}case"rl":{K.right=J,K.translate="50% 0";break}case"bt":{K.bottom=J,K.translate="0 50%";break}case"tb":{K.top=J,K.translate="0 -50%";break}}return{role:"slider","aria-valuemin":y,"aria-valuemax":L,"aria-valuenow":B,"aria-disabled":Or(N),"aria-orientation":M,"data-melt-part":"thumb","data-value":B,style:ft(K),tabindex:N?-1:0}}),action:h=>({destroy:Ht(h,"keydown",y=>{if(s.get())return;const L=y.currentTarget;if(!_t(L))return;const N=g();if(!(N!=null&&N.length))return;const M=N.indexOf(L);if(_.set(M),![xe.ARROW_LEFT,xe.ARROW_RIGHT,xe.ARROW_UP,xe.ARROW_DOWN,xe.HOME,xe.END].includes(y.key))return;y.preventDefault();const P=t.get(),H=n.get(),O=o.get(),R=u.get(),z=i.get(),B=$.get(),J=R[M];switch(y.key){case xe.HOME:{m(P,M);break}case xe.END:{m(H,M);break}case xe.ARROW_LEFT:{if(z!=="horizontal")break;y.metaKey?m(B==="rl"?H:P,M):B==="rl"&&J<H?m(J+O,M):B==="lr"&&J>P&&m(J-O,M);break}case xe.ARROW_RIGHT:{if(z!=="horizontal")break;y.metaKey?m(B==="rl"?P:H,M):B==="rl"&&J>P?m(J-O,M):B==="lr"&&J<H&&m(J+O,M);break}case xe.ARROW_UP:{y.metaKey?m(B==="tb"?P:H,M):B==="tb"&&J>P?m(J-O,M):B!=="tb"&&J<H&&m(J+O,M);break}case xe.ARROW_DOWN:{y.metaKey?m(B==="tb"?H:P,M):B==="tb"&&J<H?m(J+O,M):B!=="tb"&&J>P&&m(J-O,M);break}}})})}),E=_n(pr("tick"),{stores:[u,t,n,o,$],returned:([h,b,y,L,N])=>{const M=y-b;let P=Math.ceil(M/L);return M%L==0&&P++,Array.from({length:P},(H,O)=>{const R=`${O*(L/(y-b))*100}%`,z=O===0,B=O===P-1,J=z?0:B?-100:-50,K={position:"absolute"};switch(N){case"lr":{K.left=R,K.translate=`${J}% 0`;break}case"rl":{K.right=R,K.translate=`${-J}% 0`;break}case"bt":{K.bottom=R,K.translate=`0 ${-J}%`;break}case"tb":{K.top=R,K.translate=`0 ${J}%`;break}}const te=b+O*L;return{"data-bounded":(h.length===1?te<=h[0]:h[0]<=te&&te<=h[h.length-1])?!0:void 0,"data-value":te,style:ft(K)}})}});return Lt([I,t,n,s,i,$,o],([h,b,y,L,N,M,P])=>{if(!yo||L)return;const H=(K,te,j,x)=>{const pe=(K-j)/(x-j)*(y-b)+b;if(pe<b)m(b,te);else if(pe>y)m(y,te);else{const Te=P,Me=b,ae=Math.floor((pe-Me)/Te),ie=Me+ae*Te+Te/2,Ie=Me+(ae+1)*Te+Te/2,fe=pe>=ie&&pe<Ie?(ae+1)*Te+Me:ae*Te+Me;fe<=y&&m(fe,te)}},O=K=>{const te=g();if(!te)return;te.forEach(pe=>pe.blur());const j=te.map(pe=>{if(N==="horizontal"){const{left:Te,right:Me}=pe.getBoundingClientRect();return Math.abs(K.clientX-(Te+Me)/2)}else{const{top:Te,bottom:Me}=pe.getBoundingClientRect();return Math.abs(K.clientY-(Te+Me)/2)}}),x=te[j.indexOf(Math.min(...j))],me=te.indexOf(x);return{thumb:x,index:me}},R=K=>{if(!f.get())return;K.preventDefault(),K.stopPropagation();const te=Nr(h["data-melt-id"]),j=d.get();if(!te||!j)return;j.thumb.focus();const{left:x,right:me,top:pe,bottom:Te}=te.getBoundingClientRect();switch(M){case"lr":{H(K.clientX,j.index,x,me);break}case"rl":{H(K.clientX,j.index,me,x);break}case"bt":{H(K.clientY,j.index,Te,pe);break}case"tb":{H(K.clientY,j.index,pe,Te);break}}},z=K=>{if(K.button!==0)return;const te=Nr(h["data-melt-id"]),j=O(K);if(!j||!te)return;const x=K.target;!_t(x)||!te.contains(x)||(K.preventDefault(),d.set(j),j.thumb.focus(),f.set(!0),R(K))},B=()=>{f.set(!1)},J=Ot(We(document,"pointerdown",z),We(document,"pointerup",B),We(document,"pointerleave",B),We(document,"pointermove",R));return()=>{J()}}),Lt([o,t,n,u],function([b,y,L,N]){const M=H=>Vr(H,y,L,b)===H,P=H=>Vr(H,y,L,b);N.some(H=>!M(H))&&u.update(H=>H.map(P))}),{elements:{root:I,thumbs:S,range:k,ticks:E},states:{value:u},options:r}};function $i(l){return Object.keys(l).reduce((e,r)=>l[r]===void 0?e:`${e}${r}:${l[r]};`,"")}function Ir(){return{NAME:"scroll-area",PARTS:["scrollbar-x","scrollbar-y","thumb-x","thumb-y","viewport","content","root","corner"],SCROLLBAR_NAME:"scrollbar"}}function Mi(l){const{NAME:e,PARTS:r}=Ir(),t=Zl(e,r),n={...yi(Gl(l)),getAttrs:t};return Er(e,n),{...n,updateOption:Yl(n.options)}}function zt(){const{NAME:l}=Ir();return Gt(l)}function Ii(l){const{SCROLLBAR_NAME:e}=Ir();return Er(e,l)}function Li(){const{SCROLLBAR_NAME:l}=Ir();return Gt(l)}const Ai=l=>({builder:l&8}),wn=l=>({builder:l[3]}),Pi=l=>({builder:l&8}),kn=l=>({builder:l[3]});function Di(l){let e,r,t,n;const o=l[10].default,i=ve(o,l,l[9],wn);let c=[l[3],l[2]],s={};for(let a=0;a<c.length;a+=1)s=ee(s,c[a]);return{c(){e=F("div"),i&&i.c(),this.h()},l(a){e=V(a,"DIV",{});var u=q(e);i&&i.l(u),u.forEach(w),this.h()},h(){Ne(e,s)},m(a,u){U(a,e,u),i&&i.m(e,null),l[11](e),r=!0,t||(n=et(l[3].action(e)),t=!0)},p(a,u){i&&i.p&&(!r||u&520)&&we(i,o,a,a[9],r?ye(o,a[9],u,Ai):ke(a[9]),wn),Ne(e,s=Oe(c,[u&8&&a[3],u&4&&a[2]]))},i(a){r||(T(i,a),r=!0)},o(a){C(i,a),r=!1},d(a){a&&w(e),i&&i.d(a),l[11](null),t=!1,n()}}}function Oi(l){let e;const r=l[10].default,t=ve(r,l,l[9],kn);return{c(){t&&t.c()},l(n){t&&t.l(n)},m(n,o){t&&t.m(n,o),e=!0},p(n,o){t&&t.p&&(!e||o&520)&&we(t,r,n,n[9],e?ye(r,n[9],o,Pi):ke(n[9]),kn)},i(n){e||(T(t,n),e=!0)},o(n){C(t,n),e=!1},d(n){t&&t.d(n)}}}function Ni(l){let e,r,t,n;const o=[Oi,Di],i=[];function c(s,a){return s[1]?0:1}return e=c(l),r=i[e]=o[e](l),{c(){r.c(),t=ne()},l(s){r.l(s),t=ne()},m(s,a){i[e].m(s,a),U(s,t,a),n=!0},p(s,[a]){let u=e;e=c(s),e===u?i[e].p(s,a):(de(),C(i[u],1,1,()=>{i[u]=null}),he(),r=i[e],r?r.p(s,a):(r=i[e]=o[e](s),r.c()),T(r,1),r.m(t.parentNode,t))},i(s){n||(T(r),n=!0)},o(s){C(r),n=!1},d(s){s&&w(t),i[e].d(s)}}}function zi(l,e,r){let t,n;const o=["type","dir","hideDelay","asChild","el"];let i=Ee(e,o),c,{$$slots:s={},$$scope:a}=e,{type:u="hover"}=e,{dir:f="ltr"}=e,{hideDelay:_=600}=e,{asChild:d=!1}=e,{el:p=void 0}=e;const{elements:{root:m},updateOption:g,getAttrs:v}=Mi({type:u,dir:f,hideDelay:_});re(l,m,S=>r(8,c=S));const $=v("root"),I=$i({overflow:"hidden"});function k(S){Ue[S?"unshift":"push"](()=>{p=S,r(0,p)})}return l.$$set=S=>{e=ee(ee({},e),Le(S)),r(16,i=Ee(e,o)),"type"in S&&r(5,u=S.type),"dir"in S&&r(6,f=S.dir),"hideDelay"in S&&r(7,_=S.hideDelay),"asChild"in S&&r(1,d=S.asChild),"el"in S&&r(0,p=S.el),"$$scope"in S&&r(9,a=S.$$scope)},l.$$.update=()=>{l.$$.dirty&256&&r(3,t=c),l.$$.dirty&32&&g("type",u),l.$$.dirty&64&&g("dir",f),l.$$.dirty&128&&g("hideDelay",_),r(2,n={...i,...$,style:I}),l.$$.dirty&12&&Object.assign(t,n)},[p,d,n,t,m,u,f,_,c,a,s,k]}let Vi=class extends ce{constructor(e){super(),ue(this,e,zi,Ni,se,{type:5,dir:6,hideDelay:7,asChild:1,el:0})}};const Fi=l=>({builder:l&4}),yn=l=>({builder:l[2]}),Bi=l=>({builder:l&4}),Tn=l=>({builder:l[2]});function Ui(l){let e,r,t,n;const o=l[7].default,i=ve(o,l,l[6],yn);let c=[l[2]],s={};for(let a=0;a<c.length;a+=1)s=ee(s,c[a]);return{c(){e=F("div"),i&&i.c(),this.h()},l(a){e=V(a,"DIV",{});var u=q(e);i&&i.l(u),u.forEach(w),this.h()},h(){Ne(e,s)},m(a,u){U(a,e,u),i&&i.m(e,null),l[8](e),r=!0,t||(n=et(l[2].action(e)),t=!0)},p(a,u){i&&i.p&&(!r||u&68)&&we(i,o,a,a[6],r?ye(o,a[6],u,Fi):ke(a[6]),yn),Ne(e,s=Oe(c,[u&4&&a[2]]))},i(a){r||(T(i,a),r=!0)},o(a){C(i,a),r=!1},d(a){a&&w(e),i&&i.d(a),l[8](null),t=!1,n()}}}function Ri(l){let e;const r=l[7].default,t=ve(r,l,l[6],Tn);return{c(){t&&t.c()},l(n){t&&t.l(n)},m(n,o){t&&t.m(n,o),e=!0},p(n,o){t&&t.p&&(!e||o&68)&&we(t,r,n,n[6],e?ye(r,n[6],o,Bi):ke(n[6]),Tn)},i(n){e||(T(t,n),e=!0)},o(n){C(t,n),e=!1},d(n){t&&t.d(n)}}}function qi(l){let e,r,t,n;const o=[Ri,Ui],i=[];function c(s,a){return s[1]?0:1}return e=c(l),r=i[e]=o[e](l),{c(){r.c(),t=ne()},l(s){r.l(s),t=ne()},m(s,a){i[e].m(s,a),U(s,t,a),n=!0},p(s,[a]){let u=e;e=c(s),e===u?i[e].p(s,a):(de(),C(i[u],1,1,()=>{i[u]=null}),he(),r=i[e],r?r.p(s,a):(r=i[e]=o[e](s),r.c()),T(r,1),r.m(t.parentNode,t))},i(s){n||(T(r),n=!0)},o(s){C(r),n=!1},d(s){s&&w(t),i[e].d(s)}}}function Hi(l,e,r){let t,n;const o=["asChild","el"];let i=Ee(e,o),c,{$$slots:s={},$$scope:a}=e,{asChild:u=!1}=e,{el:f=void 0}=e;const{elements:{viewport:_},getAttrs:d}=zt();re(l,_,g=>r(5,c=g));const p=d("viewport");function m(g){Ue[g?"unshift":"push"](()=>{f=g,r(0,f)})}return l.$$set=g=>{e=ee(ee({},e),Le(g)),r(11,i=Ee(e,o)),"asChild"in g&&r(1,u=g.asChild),"el"in g&&r(0,f=g.el),"$$scope"in g&&r(6,a=g.$$scope)},l.$$.update=()=>{r(4,t={...i,...p}),l.$$.dirty&32&&r(2,n=c),l.$$.dirty&20&&Object.assign(n,t)},[f,u,n,_,t,c,a,s,m]}class ji extends ce{constructor(e){super(),ue(this,e,Hi,qi,se,{asChild:1,el:0})}}const Wi=l=>({builder:l&4}),En=l=>({builder:l[2]}),Gi=l=>({builder:l&4}),Cn=l=>({builder:l[2]});function Yi(l){let e,r,t,n;const o=l[7].default,i=ve(o,l,l[6],En);let c=[l[2]],s={};for(let a=0;a<c.length;a+=1)s=ee(s,c[a]);return{c(){e=F("div"),i&&i.c(),this.h()},l(a){e=V(a,"DIV",{});var u=q(e);i&&i.l(u),u.forEach(w),this.h()},h(){Ne(e,s)},m(a,u){U(a,e,u),i&&i.m(e,null),l[8](e),r=!0,t||(n=et(l[2].action(e)),t=!0)},p(a,u){i&&i.p&&(!r||u&68)&&we(i,o,a,a[6],r?ye(o,a[6],u,Wi):ke(a[6]),En),Ne(e,s=Oe(c,[u&4&&a[2]]))},i(a){r||(T(i,a),r=!0)},o(a){C(i,a),r=!1},d(a){a&&w(e),i&&i.d(a),l[8](null),t=!1,n()}}}function Xi(l){let e;const r=l[7].default,t=ve(r,l,l[6],Cn);return{c(){t&&t.c()},l(n){t&&t.l(n)},m(n,o){t&&t.m(n,o),e=!0},p(n,o){t&&t.p&&(!e||o&68)&&we(t,r,n,n[6],e?ye(r,n[6],o,Gi):ke(n[6]),Cn)},i(n){e||(T(t,n),e=!0)},o(n){C(t,n),e=!1},d(n){t&&t.d(n)}}}function Zi(l){let e,r,t,n;const o=[Xi,Yi],i=[];function c(s,a){return s[1]?0:1}return e=c(l),r=i[e]=o[e](l),{c(){r.c(),t=ne()},l(s){r.l(s),t=ne()},m(s,a){i[e].m(s,a),U(s,t,a),n=!0},p(s,[a]){let u=e;e=c(s),e===u?i[e].p(s,a):(de(),C(i[u],1,1,()=>{i[u]=null}),he(),r=i[e],r?r.p(s,a):(r=i[e]=o[e](s),r.c()),T(r,1),r.m(t.parentNode,t))},i(s){n||(T(r),n=!0)},o(s){C(r),n=!1},d(s){s&&w(t),i[e].d(s)}}}function Ji(l,e,r){let t,n;const o=["asChild","el"];let i=Ee(e,o),c,{$$slots:s={},$$scope:a}=e,{asChild:u=!1}=e,{el:f=void 0}=e;const{elements:{content:_},getAttrs:d}=zt();re(l,_,g=>r(5,c=g));const p=d("content");function m(g){Ue[g?"unshift":"push"](()=>{f=g,r(0,f)})}return l.$$set=g=>{e=ee(ee({},e),Le(g)),r(11,i=Ee(e,o)),"asChild"in g&&r(1,u=g.asChild),"el"in g&&r(0,f=g.el),"$$scope"in g&&r(6,a=g.$$scope)},l.$$.update=()=>{r(4,t={...i,...p}),l.$$.dirty&32&&r(2,n=c),l.$$.dirty&20&&Object.assign(n,t)},[f,u,n,_,t,c,a,s,m]}class Ki extends ce{constructor(e){super(),ue(this,e,Ji,Zi,se,{asChild:1,el:0})}}const Qi=l=>({builder:l&4}),Sn=l=>({builder:l[2]}),xi=l=>({builder:l&4}),$n=l=>({builder:l[2]});function es(l){let e,r,t,n;const o=l[7].default,i=ve(o,l,l[6],Sn);let c=[l[2]],s={};for(let a=0;a<c.length;a+=1)s=ee(s,c[a]);return{c(){e=F("div"),i&&i.c(),this.h()},l(a){e=V(a,"DIV",{});var u=q(e);i&&i.l(u),u.forEach(w),this.h()},h(){Ne(e,s)},m(a,u){U(a,e,u),i&&i.m(e,null),l[8](e),r=!0,t||(n=et(l[2].action(e)),t=!0)},p(a,u){i&&i.p&&(!r||u&68)&&we(i,o,a,a[6],r?ye(o,a[6],u,Qi):ke(a[6]),Sn),Ne(e,s=Oe(c,[u&4&&a[2]]))},i(a){r||(T(i,a),r=!0)},o(a){C(i,a),r=!1},d(a){a&&w(e),i&&i.d(a),l[8](null),t=!1,n()}}}function ts(l){let e;const r=l[7].default,t=ve(r,l,l[6],$n);return{c(){t&&t.c()},l(n){t&&t.l(n)},m(n,o){t&&t.m(n,o),e=!0},p(n,o){t&&t.p&&(!e||o&68)&&we(t,r,n,n[6],e?ye(r,n[6],o,xi):ke(n[6]),$n)},i(n){e||(T(t,n),e=!0)},o(n){C(t,n),e=!1},d(n){t&&t.d(n)}}}function rs(l){let e,r,t,n;const o=[ts,es],i=[];function c(s,a){return s[1]?0:1}return e=c(l),r=i[e]=o[e](l),{c(){r.c(),t=ne()},l(s){r.l(s),t=ne()},m(s,a){i[e].m(s,a),U(s,t,a),n=!0},p(s,[a]){let u=e;e=c(s),e===u?i[e].p(s,a):(de(),C(i[u],1,1,()=>{i[u]=null}),he(),r=i[e],r?r.p(s,a):(r=i[e]=o[e](s),r.c()),T(r,1),r.m(t.parentNode,t))},i(s){n||(T(r),n=!0)},o(s){C(r),n=!1},d(s){s&&w(t),i[e].d(s)}}}function ns(l,e,r){let t,n;const o=["asChild","el"];let i=Ee(e,o),c,{$$slots:s={},$$scope:a}=e,{asChild:u=!1}=e,{el:f=void 0}=e;const{elements:{scrollbarY:_},getAttrs:d}=zt();re(l,_,g=>r(5,c=g));const p=d("scrollbar-y");function m(g){Ue[g?"unshift":"push"](()=>{f=g,r(0,f)})}return l.$$set=g=>{e=ee(ee({},e),Le(g)),r(11,i=Ee(e,o)),"asChild"in g&&r(1,u=g.asChild),"el"in g&&r(0,f=g.el),"$$scope"in g&&r(6,a=g.$$scope)},l.$$.update=()=>{r(4,t={...i,...p}),l.$$.dirty&32&&r(2,n=c),l.$$.dirty&20&&Object.assign(n,t)},[f,u,n,_,t,c,a,s,m]}class ls extends ce{constructor(e){super(),ue(this,e,ns,rs,se,{asChild:1,el:0})}}const os=l=>({builder:l&4}),Mn=l=>({builder:l[2]}),is=l=>({builder:l&4}),In=l=>({builder:l[2]});function ss(l){let e,r,t,n;const o=l[7].default,i=ve(o,l,l[6],Mn);let c=[l[2]],s={};for(let a=0;a<c.length;a+=1)s=ee(s,c[a]);return{c(){e=F("div"),i&&i.c(),this.h()},l(a){e=V(a,"DIV",{});var u=q(e);i&&i.l(u),u.forEach(w),this.h()},h(){Ne(e,s)},m(a,u){U(a,e,u),i&&i.m(e,null),l[8](e),r=!0,t||(n=et(l[2].action(e)),t=!0)},p(a,u){i&&i.p&&(!r||u&68)&&we(i,o,a,a[6],r?ye(o,a[6],u,os):ke(a[6]),Mn),Ne(e,s=Oe(c,[u&4&&a[2]]))},i(a){r||(T(i,a),r=!0)},o(a){C(i,a),r=!1},d(a){a&&w(e),i&&i.d(a),l[8](null),t=!1,n()}}}function as(l){let e;const r=l[7].default,t=ve(r,l,l[6],In);return{c(){t&&t.c()},l(n){t&&t.l(n)},m(n,o){t&&t.m(n,o),e=!0},p(n,o){t&&t.p&&(!e||o&68)&&we(t,r,n,n[6],e?ye(r,n[6],o,is):ke(n[6]),In)},i(n){e||(T(t,n),e=!0)},o(n){C(t,n),e=!1},d(n){t&&t.d(n)}}}function cs(l){let e,r,t,n;const o=[as,ss],i=[];function c(s,a){return s[1]?0:1}return e=c(l),r=i[e]=o[e](l),{c(){r.c(),t=ne()},l(s){r.l(s),t=ne()},m(s,a){i[e].m(s,a),U(s,t,a),n=!0},p(s,[a]){let u=e;e=c(s),e===u?i[e].p(s,a):(de(),C(i[u],1,1,()=>{i[u]=null}),he(),r=i[e],r?r.p(s,a):(r=i[e]=o[e](s),r.c()),T(r,1),r.m(t.parentNode,t))},i(s){n||(T(r),n=!0)},o(s){C(r),n=!1},d(s){s&&w(t),i[e].d(s)}}}function us(l,e,r){let t,n;const o=["asChild","el"];let i=Ee(e,o),c,{$$slots:s={},$$scope:a}=e,{asChild:u=!1}=e,{el:f=void 0}=e;const{elements:{scrollbarX:_},getAttrs:d}=zt();re(l,_,g=>r(5,c=g));const p=d("scrollbar-x");function m(g){Ue[g?"unshift":"push"](()=>{f=g,r(0,f)})}return l.$$set=g=>{e=ee(ee({},e),Le(g)),r(11,i=Ee(e,o)),"asChild"in g&&r(1,u=g.asChild),"el"in g&&r(0,f=g.el),"$$scope"in g&&r(6,a=g.$$scope)},l.$$.update=()=>{r(4,t={...i,...p}),l.$$.dirty&32&&r(2,n=c),l.$$.dirty&20&&Object.assign(n,t)},[f,u,n,_,t,c,a,s,m]}class fs extends ce{constructor(e){super(),ue(this,e,us,cs,se,{asChild:1,el:0})}}const ds=l=>({builder:l&64}),Ln=l=>({builder:l[6]}),hs=l=>({builder:l&64}),An=l=>({builder:l[6]});function ms(l){let e,r;const t=[l[2]];let n={$$slots:{default:[_s,({builder:o})=>({6:o}),({builder:o})=>o?64:0]},$$scope:{ctx:l}};for(let o=0;o<t.length;o+=1)n=ee(n,t[o]);return e=new fs({props:n}),{c(){Y(e.$$.fragment)},l(o){Q(e.$$.fragment,o)},m(o,i){G(e,o,i),r=!0},p(o,i){const c=i&4?Oe(t,[Ke(o[2])]):{};i&96&&(c.$$scope={dirty:i,ctx:o}),e.$set(c)},i(o){r||(T(e.$$.fragment,o),r=!0)},o(o){C(e.$$.fragment,o),r=!1},d(o){W(e,o)}}}function gs(l){let e,r;const t=[l[2]];let n={$$slots:{default:[ps,({builder:o})=>({6:o}),({builder:o})=>o?64:0]},$$scope:{ctx:l}};for(let o=0;o<t.length;o+=1)n=ee(n,t[o]);return e=new ls({props:n}),{c(){Y(e.$$.fragment)},l(o){Q(e.$$.fragment,o)},m(o,i){G(e,o,i),r=!0},p(o,i){const c=i&4?Oe(t,[Ke(o[2])]):{};i&96&&(c.$$scope={dirty:i,ctx:o}),e.$set(c)},i(o){r||(T(e.$$.fragment,o),r=!0)},o(o){C(e.$$.fragment,o),r=!1},d(o){W(e,o)}}}function _s(l){let e;const r=l[4].default,t=ve(r,l,l[5],Ln);return{c(){t&&t.c()},l(n){t&&t.l(n)},m(n,o){t&&t.m(n,o),e=!0},p(n,o){t&&t.p&&(!e||o&96)&&we(t,r,n,n[5],e?ye(r,n[5],o,ds):ke(n[5]),Ln)},i(n){e||(T(t,n),e=!0)},o(n){C(t,n),e=!1},d(n){t&&t.d(n)}}}function ps(l){let e;const r=l[4].default,t=ve(r,l,l[5],An);return{c(){t&&t.c()},l(n){t&&t.l(n)},m(n,o){t&&t.m(n,o),e=!0},p(n,o){t&&t.p&&(!e||o&96)&&we(t,r,n,n[5],e?ye(r,n[5],o,hs):ke(n[5]),An)},i(n){e||(T(t,n),e=!0)},o(n){C(t,n),e=!1},d(n){t&&t.d(n)}}}function bs(l){let e,r,t,n;const o=[gs,ms],i=[];function c(s,a){return s[0]==="vertical"?0:1}return e=c(l),r=i[e]=o[e](l),{c(){r.c(),t=ne()},l(s){r.l(s),t=ne()},m(s,a){i[e].m(s,a),U(s,t,a),n=!0},p(s,[a]){let u=e;e=c(s),e===u?i[e].p(s,a):(de(),C(i[u],1,1,()=>{i[u]=null}),he(),r=i[e],r?r.p(s,a):(r=i[e]=o[e](s),r.c()),T(r,1),r.m(t.parentNode,t))},i(s){n||(T(r),n=!0)},o(s){C(r),n=!1},d(s){s&&w(t),i[e].d(s)}}}function vs(l,e,r){const t=["orientation"];let n=Ee(e,t),o,{$$slots:i={},$$scope:c}=e,{orientation:s}=e;const a=Fe(s);return re(l,a,u=>r(0,o=u)),Ii(a),l.$$set=u=>{e=ee(ee({},e),Le(u)),r(2,n=Ee(e,t)),"orientation"in u&&r(3,s=u.orientation),"$$scope"in u&&r(5,c=u.$$scope)},l.$$.update=()=>{l.$$.dirty&8&&a.set(s)},[o,a,n,s,i,c]}let ws=class extends ce{constructor(e){super(),ue(this,e,vs,bs,se,{orientation:3})}};const ks=l=>({builder:l&4}),Pn=l=>({builder:l[2]}),ys=l=>({builder:l&4}),Dn=l=>({builder:l[2]});function Ts(l){let e,r,t,n;const o=l[7].default,i=ve(o,l,l[6],Pn);let c=[l[2]],s={};for(let a=0;a<c.length;a+=1)s=ee(s,c[a]);return{c(){e=F("div"),i&&i.c(),this.h()},l(a){e=V(a,"DIV",{});var u=q(e);i&&i.l(u),u.forEach(w),this.h()},h(){Ne(e,s)},m(a,u){U(a,e,u),i&&i.m(e,null),l[8](e),r=!0,t||(n=et(l[2].action(e)),t=!0)},p(a,u){i&&i.p&&(!r||u&68)&&we(i,o,a,a[6],r?ye(o,a[6],u,ks):ke(a[6]),Pn),Ne(e,s=Oe(c,[u&4&&a[2]]))},i(a){r||(T(i,a),r=!0)},o(a){C(i,a),r=!1},d(a){a&&w(e),i&&i.d(a),l[8](null),t=!1,n()}}}function Es(l){let e;const r=l[7].default,t=ve(r,l,l[6],Dn);return{c(){t&&t.c()},l(n){t&&t.l(n)},m(n,o){t&&t.m(n,o),e=!0},p(n,o){t&&t.p&&(!e||o&68)&&we(t,r,n,n[6],e?ye(r,n[6],o,ys):ke(n[6]),Dn)},i(n){e||(T(t,n),e=!0)},o(n){C(t,n),e=!1},d(n){t&&t.d(n)}}}function Cs(l){let e,r,t,n;const o=[Es,Ts],i=[];function c(s,a){return s[1]?0:1}return e=c(l),r=i[e]=o[e](l),{c(){r.c(),t=ne()},l(s){r.l(s),t=ne()},m(s,a){i[e].m(s,a),U(s,t,a),n=!0},p(s,[a]){let u=e;e=c(s),e===u?i[e].p(s,a):(de(),C(i[u],1,1,()=>{i[u]=null}),he(),r=i[e],r?r.p(s,a):(r=i[e]=o[e](s),r.c()),T(r,1),r.m(t.parentNode,t))},i(s){n||(T(r),n=!0)},o(s){C(r),n=!1},d(s){s&&w(t),i[e].d(s)}}}function Ss(l,e,r){let t,n;const o=["asChild","el"];let i=Ee(e,o),c,{$$slots:s={},$$scope:a}=e,{asChild:u=!1}=e,{el:f=void 0}=e;const{elements:{thumbY:_},getAttrs:d}=zt();re(l,_,g=>r(5,c=g));const p=d("thumb-y");function m(g){Ue[g?"unshift":"push"](()=>{f=g,r(0,f)})}return l.$$set=g=>{e=ee(ee({},e),Le(g)),r(11,i=Ee(e,o)),"asChild"in g&&r(1,u=g.asChild),"el"in g&&r(0,f=g.el),"$$scope"in g&&r(6,a=g.$$scope)},l.$$.update=()=>{r(4,t={...i,...p}),l.$$.dirty&32&&r(2,n=c),l.$$.dirty&20&&Object.assign(n,t)},[f,u,n,_,t,c,a,s,m]}class $s extends ce{constructor(e){super(),ue(this,e,Ss,Cs,se,{asChild:1,el:0})}}const Ms=l=>({builder:l&4}),On=l=>({builder:l[2]}),Is=l=>({builder:l&4}),Nn=l=>({builder:l[2]});function Ls(l){let e,r,t,n;const o=l[7].default,i=ve(o,l,l[6],On);let c=[l[2]],s={};for(let a=0;a<c.length;a+=1)s=ee(s,c[a]);return{c(){e=F("div"),i&&i.c(),this.h()},l(a){e=V(a,"DIV",{});var u=q(e);i&&i.l(u),u.forEach(w),this.h()},h(){Ne(e,s)},m(a,u){U(a,e,u),i&&i.m(e,null),l[8](e),r=!0,t||(n=et(l[2].action(e)),t=!0)},p(a,u){i&&i.p&&(!r||u&68)&&we(i,o,a,a[6],r?ye(o,a[6],u,Ms):ke(a[6]),On),Ne(e,s=Oe(c,[u&4&&a[2]]))},i(a){r||(T(i,a),r=!0)},o(a){C(i,a),r=!1},d(a){a&&w(e),i&&i.d(a),l[8](null),t=!1,n()}}}function As(l){let e;const r=l[7].default,t=ve(r,l,l[6],Nn);return{c(){t&&t.c()},l(n){t&&t.l(n)},m(n,o){t&&t.m(n,o),e=!0},p(n,o){t&&t.p&&(!e||o&68)&&we(t,r,n,n[6],e?ye(r,n[6],o,Is):ke(n[6]),Nn)},i(n){e||(T(t,n),e=!0)},o(n){C(t,n),e=!1},d(n){t&&t.d(n)}}}function Ps(l){let e,r,t,n;const o=[As,Ls],i=[];function c(s,a){return s[1]?0:1}return e=c(l),r=i[e]=o[e](l),{c(){r.c(),t=ne()},l(s){r.l(s),t=ne()},m(s,a){i[e].m(s,a),U(s,t,a),n=!0},p(s,[a]){let u=e;e=c(s),e===u?i[e].p(s,a):(de(),C(i[u],1,1,()=>{i[u]=null}),he(),r=i[e],r?r.p(s,a):(r=i[e]=o[e](s),r.c()),T(r,1),r.m(t.parentNode,t))},i(s){n||(T(r),n=!0)},o(s){C(r),n=!1},d(s){s&&w(t),i[e].d(s)}}}function Ds(l,e,r){let t,n;const o=["asChild","el"];let i=Ee(e,o),c,{$$slots:s={},$$scope:a}=e,{asChild:u=!1}=e,{el:f=void 0}=e;const{elements:{thumbX:_},getAttrs:d}=zt();re(l,_,g=>r(5,c=g));const p=d("thumb-x");function m(g){Ue[g?"unshift":"push"](()=>{f=g,r(0,f)})}return l.$$set=g=>{e=ee(ee({},e),Le(g)),r(11,i=Ee(e,o)),"asChild"in g&&r(1,u=g.asChild),"el"in g&&r(0,f=g.el),"$$scope"in g&&r(6,a=g.$$scope)},l.$$.update=()=>{r(4,t={...i,...p}),l.$$.dirty&32&&r(2,n=c),l.$$.dirty&20&&Object.assign(n,t)},[f,u,n,_,t,c,a,s,m]}class Os extends ce{constructor(e){super(),ue(this,e,Ds,Ps,se,{asChild:1,el:0})}}const Ns=l=>({builder:l&32}),zn=l=>({builder:l[5]}),zs=l=>({builder:l&32}),Vn=l=>({builder:l[5]});function Vs(l){let e,r;const t=[l[2]];let n={$$slots:{default:[Bs,({builder:o})=>({5:o}),({builder:o})=>o?32:0]},$$scope:{ctx:l}};for(let o=0;o<t.length;o+=1)n=ee(n,t[o]);return e=new Os({props:n}),{c(){Y(e.$$.fragment)},l(o){Q(e.$$.fragment,o)},m(o,i){G(e,o,i),r=!0},p(o,i){const c=i&4?Oe(t,[Ke(o[2])]):{};i&48&&(c.$$scope={dirty:i,ctx:o}),e.$set(c)},i(o){r||(T(e.$$.fragment,o),r=!0)},o(o){C(e.$$.fragment,o),r=!1},d(o){W(e,o)}}}function Fs(l){let e,r;const t=[l[2]];let n={$$slots:{default:[Us,({builder:o})=>({5:o}),({builder:o})=>o?32:0]},$$scope:{ctx:l}};for(let o=0;o<t.length;o+=1)n=ee(n,t[o]);return e=new $s({props:n}),{c(){Y(e.$$.fragment)},l(o){Q(e.$$.fragment,o)},m(o,i){G(e,o,i),r=!0},p(o,i){const c=i&4?Oe(t,[Ke(o[2])]):{};i&48&&(c.$$scope={dirty:i,ctx:o}),e.$set(c)},i(o){r||(T(e.$$.fragment,o),r=!0)},o(o){C(e.$$.fragment,o),r=!1},d(o){W(e,o)}}}function Bs(l){let e;const r=l[3].default,t=ve(r,l,l[4],zn);return{c(){t&&t.c()},l(n){t&&t.l(n)},m(n,o){t&&t.m(n,o),e=!0},p(n,o){t&&t.p&&(!e||o&48)&&we(t,r,n,n[4],e?ye(r,n[4],o,Ns):ke(n[4]),zn)},i(n){e||(T(t,n),e=!0)},o(n){C(t,n),e=!1},d(n){t&&t.d(n)}}}function Us(l){let e;const r=l[3].default,t=ve(r,l,l[4],Vn);return{c(){t&&t.c()},l(n){t&&t.l(n)},m(n,o){t&&t.m(n,o),e=!0},p(n,o){t&&t.p&&(!e||o&48)&&we(t,r,n,n[4],e?ye(r,n[4],o,zs):ke(n[4]),Vn)},i(n){e||(T(t,n),e=!0)},o(n){C(t,n),e=!1},d(n){t&&t.d(n)}}}function Rs(l){let e,r,t,n;const o=[Fs,Vs],i=[];function c(s,a){return s[0]==="vertical"?0:1}return e=c(l),r=i[e]=o[e](l),{c(){r.c(),t=ne()},l(s){r.l(s),t=ne()},m(s,a){i[e].m(s,a),U(s,t,a),n=!0},p(s,[a]){let u=e;e=c(s),e===u?i[e].p(s,a):(de(),C(i[u],1,1,()=>{i[u]=null}),he(),r=i[e],r?r.p(s,a):(r=i[e]=o[e](s),r.c()),T(r,1),r.m(t.parentNode,t))},i(s){n||(T(r),n=!0)},o(s){C(r),n=!1},d(s){s&&w(t),i[e].d(s)}}}function qs(l,e,r){const t=[];let n=Ee(e,t),o,{$$slots:i={},$$scope:c}=e;const s=Li();return re(l,s,a=>r(0,o=a)),l.$$set=a=>{e=ee(ee({},e),Le(a)),r(2,n=Ee(e,t)),"$$scope"in a&&r(4,c=a.$$scope)},[o,s,n,i,c]}class Hs extends ce{constructor(e){super(),ue(this,e,qs,Rs,se,{})}}const js=l=>({builder:l&4}),Fn=l=>({builder:l[2]}),Ws=l=>({builder:l&4}),Bn=l=>({builder:l[2]});function Gs(l){let e,r,t,n;const o=l[7].default,i=ve(o,l,l[6],Fn);let c=[l[2]],s={};for(let a=0;a<c.length;a+=1)s=ee(s,c[a]);return{c(){e=F("div"),i&&i.c(),this.h()},l(a){e=V(a,"DIV",{});var u=q(e);i&&i.l(u),u.forEach(w),this.h()},h(){Ne(e,s)},m(a,u){U(a,e,u),i&&i.m(e,null),l[8](e),r=!0,t||(n=et(l[2].action(e)),t=!0)},p(a,u){i&&i.p&&(!r||u&68)&&we(i,o,a,a[6],r?ye(o,a[6],u,js):ke(a[6]),Fn),Ne(e,s=Oe(c,[u&4&&a[2]]))},i(a){r||(T(i,a),r=!0)},o(a){C(i,a),r=!1},d(a){a&&w(e),i&&i.d(a),l[8](null),t=!1,n()}}}function Ys(l){let e;const r=l[7].default,t=ve(r,l,l[6],Bn);return{c(){t&&t.c()},l(n){t&&t.l(n)},m(n,o){t&&t.m(n,o),e=!0},p(n,o){t&&t.p&&(!e||o&68)&&we(t,r,n,n[6],e?ye(r,n[6],o,Ws):ke(n[6]),Bn)},i(n){e||(T(t,n),e=!0)},o(n){C(t,n),e=!1},d(n){t&&t.d(n)}}}function Xs(l){let e,r,t,n;const o=[Ys,Gs],i=[];function c(s,a){return s[1]?0:1}return e=c(l),r=i[e]=o[e](l),{c(){r.c(),t=ne()},l(s){r.l(s),t=ne()},m(s,a){i[e].m(s,a),U(s,t,a),n=!0},p(s,[a]){let u=e;e=c(s),e===u?i[e].p(s,a):(de(),C(i[u],1,1,()=>{i[u]=null}),he(),r=i[e],r?r.p(s,a):(r=i[e]=o[e](s),r.c()),T(r,1),r.m(t.parentNode,t))},i(s){n||(T(r),n=!0)},o(s){C(r),n=!1},d(s){s&&w(t),i[e].d(s)}}}function Zs(l,e,r){let t,n;const o=["asChild","el"];let i=Ee(e,o),c,{$$slots:s={},$$scope:a}=e,{asChild:u=!1}=e,{el:f=void 0}=e;const{elements:{corner:_},getAttrs:d}=zt();re(l,_,g=>r(5,c=g));const p=d("corner");function m(g){Ue[g?"unshift":"push"](()=>{f=g,r(0,f)})}return l.$$set=g=>{e=ee(ee({},e),Le(g)),r(11,i=Ee(e,o)),"asChild"in g&&r(1,u=g.asChild),"el"in g&&r(0,f=g.el),"$$scope"in g&&r(6,a=g.$$scope)},l.$$.update=()=>{r(4,t={...i,...p}),l.$$.dirty&32&&r(2,n=c),l.$$.dirty&20&&Object.assign(n,t)},[f,u,n,_,t,c,a,s,m]}class Js extends ce{constructor(e){super(),ue(this,e,Zs,Xs,se,{asChild:1,el:0})}}function lo(){return{NAME:"slider",PARTS:["root","input","range","thumb","tick"]}}function Ks(l){const{NAME:e,PARTS:r}=lo(),t=Zl(e,r),n={...Si(Gl(l)),getAttrs:t};return Er(e,n),{...n,updateOption:Yl(n.options)}}function oo(){const{NAME:l}=lo();return Gt(l)}const Qs=l=>({builder:l&4,ticks:l&8,thumbs:l&16}),Un=l=>({builder:l[2],ticks:l[3],thumbs:l[4]}),xs=l=>({builder:l&4,ticks:l&8,thumbs:l&16}),Rn=l=>({builder:l[2],ticks:l[3],thumbs:l[4]});function ea(l){let e,r,t,n;const o=l[19].default,i=ve(o,l,l[18],Un);let c=[l[2],l[8]],s={};for(let a=0;a<c.length;a+=1)s=ee(s,c[a]);return{c(){e=F("span"),i&&i.c(),this.h()},l(a){e=V(a,"SPAN",{});var u=q(e);i&&i.l(u),u.forEach(w),this.h()},h(){Ne(e,s)},m(a,u){U(a,e,u),i&&i.m(e,null),l[20](e),r=!0,t||(n=et(l[2].action(e)),t=!0)},p(a,u){i&&i.p&&(!r||u&262172)&&we(i,o,a,a[18],r?ye(o,a[18],u,Qs):ke(a[18]),Un),Ne(e,s=Oe(c,[u&4&&a[2],u&256&&a[8]]))},i(a){r||(T(i,a),r=!0)},o(a){C(i,a),r=!1},d(a){a&&w(e),i&&i.d(a),l[20](null),t=!1,n()}}}function ta(l){let e;const r=l[19].default,t=ve(r,l,l[18],Rn);return{c(){t&&t.c()},l(n){t&&t.l(n)},m(n,o){t&&t.m(n,o),e=!0},p(n,o){t&&t.p&&(!e||o&262172)&&we(t,r,n,n[18],e?ye(r,n[18],o,xs):ke(n[18]),Rn)},i(n){e||(T(t,n),e=!0)},o(n){C(t,n),e=!1},d(n){t&&t.d(n)}}}function ra(l){let e,r,t,n;const o=[ta,ea],i=[];function c(s,a){return s[1]?0:1}return e=c(l),r=i[e]=o[e](l),{c(){r.c(),t=ne()},l(s){r.l(s),t=ne()},m(s,a){i[e].m(s,a),U(s,t,a),n=!0},p(s,[a]){let u=e;e=c(s),e===u?i[e].p(s,a):(de(),C(i[u],1,1,()=>{i[u]=null}),he(),r=i[e],r?r.p(s,a):(r=i[e]=o[e](s),r.c()),T(r,1),r.m(t.parentNode,t))},i(s){n||(T(r),n=!0)},o(s){C(r),n=!1},d(s){s&&w(t),i[e].d(s)}}}function na(l,e,r){let t;const n=["disabled","min","max","step","orientation","dir","value","onValueChange","asChild","el"];let o=Ee(e,n),i,c,s,{$$slots:a={},$$scope:u}=e,{disabled:f=void 0}=e,{min:_=void 0}=e,{max:d=void 0}=e,{step:p=void 0}=e,{orientation:m=void 0}=e,{dir:g=void 0}=e,{value:v=void 0}=e,{onValueChange:$=void 0}=e,{asChild:I=!1}=e,{el:k=void 0}=e;const{elements:{root:S,ticks:E,thumbs:h},states:{value:b},updateOption:y,getAttrs:L}=Ks({disabled:f,dir:g,min:_,max:d,step:p,orientation:m,defaultValue:v,onValueChange:({next:P})=>(v!==P&&($==null||$(P),r(9,v=P)),P)});re(l,S,P=>r(17,i=P)),re(l,E,P=>r(3,c=P)),re(l,h,P=>r(4,s=P));const N=L("root");function M(P){Ue[P?"unshift":"push"](()=>{k=P,r(0,k)})}return l.$$set=P=>{e=ee(ee({},e),Le(P)),r(8,o=Ee(e,n)),"disabled"in P&&r(10,f=P.disabled),"min"in P&&r(11,_=P.min),"max"in P&&r(12,d=P.max),"step"in P&&r(13,p=P.step),"orientation"in P&&r(14,m=P.orientation),"dir"in P&&r(15,g=P.dir),"value"in P&&r(9,v=P.value),"onValueChange"in P&&r(16,$=P.onValueChange),"asChild"in P&&r(1,I=P.asChild),"el"in P&&r(0,k=P.el),"$$scope"in P&&r(18,u=P.$$scope)},l.$$.update=()=>{l.$$.dirty&512&&v!==void 0&&b.set(v),l.$$.dirty&1024&&y("disabled",f),l.$$.dirty&2048&&y("min",_),l.$$.dirty&4096&&y("max",d),l.$$.dirty&8192&&y("step",p),l.$$.dirty&16384&&y("orientation",m),l.$$.dirty&32768&&y("dir",g),l.$$.dirty&131072&&r(2,t=i),l.$$.dirty&4&&Object.assign(t,N)},[k,I,t,c,s,S,E,h,o,v,f,_,d,p,m,g,$,i,u,a,M]}let la=class extends ce{constructor(e){super(),ue(this,e,na,ra,se,{disabled:10,min:11,max:12,step:13,orientation:14,dir:15,value:9,onValueChange:16,asChild:1,el:0})}};const oa=l=>({builder:l&4}),qn=l=>({builder:l[2]});function ia(l){let e,r,t,n=[l[2],l[4]],o={};for(let i=0;i<n.length;i+=1)o=ee(o,n[i]);return{c(){e=F("span"),this.h()},l(i){e=V(i,"SPAN",{}),q(e).forEach(w),this.h()},h(){Ne(e,o)},m(i,c){U(i,e,c),l[8](e),r||(t=et(l[2].action(e)),r=!0)},p(i,c){Ne(e,o=Oe(n,[c&4&&i[2],c&16&&i[4]]))},i:$e,o:$e,d(i){i&&w(e),l[8](null),r=!1,t()}}}function sa(l){let e;const r=l[7].default,t=ve(r,l,l[6],qn);return{c(){t&&t.c()},l(n){t&&t.l(n)},m(n,o){t&&t.m(n,o),e=!0},p(n,o){t&&t.p&&(!e||o&68)&&we(t,r,n,n[6],e?ye(r,n[6],o,oa):ke(n[6]),qn)},i(n){e||(T(t,n),e=!0)},o(n){C(t,n),e=!1},d(n){t&&t.d(n)}}}function aa(l){let e,r,t,n;const o=[sa,ia],i=[];function c(s,a){return s[1]?0:1}return e=c(l),r=i[e]=o[e](l),{c(){r.c(),t=ne()},l(s){r.l(s),t=ne()},m(s,a){i[e].m(s,a),U(s,t,a),n=!0},p(s,[a]){let u=e;e=c(s),e===u?i[e].p(s,a):(de(),C(i[u],1,1,()=>{i[u]=null}),he(),r=i[e],r?r.p(s,a):(r=i[e]=o[e](s),r.c()),T(r,1),r.m(t.parentNode,t))},i(s){n||(T(r),n=!0)},o(s){C(r),n=!1},d(s){s&&w(t),i[e].d(s)}}}function ca(l,e,r){let t;const n=["asChild","el"];let o=Ee(e,n),i,{$$slots:c={},$$scope:s}=e,{asChild:a=!1}=e,{el:u=void 0}=e;const{elements:{range:f},getAttrs:_}=oo();re(l,f,m=>r(5,i=m));const d=_("range");function p(m){Ue[m?"unshift":"push"](()=>{u=m,r(0,u)})}return l.$$set=m=>{e=ee(ee({},e),Le(m)),r(4,o=Ee(e,n)),"asChild"in m&&r(1,a=m.asChild),"el"in m&&r(0,u=m.el),"$$scope"in m&&r(6,s=m.$$scope)},l.$$.update=()=>{l.$$.dirty&32&&r(2,t=i),l.$$.dirty&4&&Object.assign(t,d)},[u,a,t,f,o,i,s,c,p]}class ua extends ce{constructor(e){super(),ue(this,e,ca,aa,se,{asChild:1,el:0})}}const fa=l=>({builder:l&4}),Hn=l=>({builder:l[2]});function da(l){let e,r,t,n=[l[2],l[4]],o={};for(let i=0;i<n.length;i+=1)o=ee(o,n[i]);return{c(){e=F("span"),this.h()},l(i){e=V(i,"SPAN",{}),q(e).forEach(w),this.h()},h(){Ne(e,o)},m(i,c){U(i,e,c),l[8](e),r||(t=[et(l[2].action(e)),Se(e,"m-keydown",l[3])],r=!0)},p(i,c){Ne(e,o=Oe(n,[c&4&&i[2],c&16&&i[4]]))},i:$e,o:$e,d(i){i&&w(e),l[8](null),r=!1,mt(t)}}}function ha(l){let e;const r=l[7].default,t=ve(r,l,l[6],Hn);return{c(){t&&t.c()},l(n){t&&t.l(n)},m(n,o){t&&t.m(n,o),e=!0},p(n,o){t&&t.p&&(!e||o&68)&&we(t,r,n,n[6],e?ye(r,n[6],o,fa):ke(n[6]),Hn)},i(n){e||(T(t,n),e=!0)},o(n){C(t,n),e=!1},d(n){t&&t.d(n)}}}function ma(l){let e,r,t,n;const o=[ha,da],i=[];function c(s,a){return s[1]?0:1}return e=c(l),r=i[e]=o[e](l),{c(){r.c(),t=ne()},l(s){r.l(s),t=ne()},m(s,a){i[e].m(s,a),U(s,t,a),n=!0},p(s,[a]){let u=e;e=c(s),e===u?i[e].p(s,a):(de(),C(i[u],1,1,()=>{i[u]=null}),he(),r=i[e],r?r.p(s,a):(r=i[e]=o[e](s),r.c()),T(r,1),r.m(t.parentNode,t))},i(s){n||(T(r),n=!0)},o(s){C(r),n=!1},d(s){s&&w(t),i[e].d(s)}}}function ga(l,e,r){let t;const n=["asChild","el","thumb"];let o=Ee(e,n),{$$slots:i={},$$scope:c}=e,{asChild:s=!1}=e,{el:a=void 0}=e,{thumb:u}=e;const{getAttrs:f}=oo(),_=Eo(),d=f("thumb");function p(m){Ue[m?"unshift":"push"](()=>{a=m,r(0,a)})}return l.$$set=m=>{e=ee(ee({},e),Le(m)),r(4,o=Ee(e,n)),"asChild"in m&&r(1,s=m.asChild),"el"in m&&r(0,a=m.el),"thumb"in m&&r(5,u=m.thumb),"$$scope"in m&&r(6,c=m.$$scope)},l.$$.update=()=>{l.$$.dirty&32&&r(2,t=u),l.$$.dirty&4&&Object.assign(t,d)},[a,s,t,_,o,u,c,i,p]}class _a extends ce{constructor(e){super(),ue(this,e,ga,ma,se,{asChild:1,el:0,thumb:5})}}const pa=l=>({builder:l&4}),jn=l=>({builder:l[2]}),ba=l=>({builder:l&4}),Wn=l=>({builder:l[2]});function va(l){let e,r,t,n;const o=l[8].default,i=ve(o,l,l[7],jn);let c=[l[2],l[4]],s={};for(let a=0;a<c.length;a+=1)s=ee(s,c[a]);return{c(){e=F("div"),i&&i.c(),this.h()},l(a){e=V(a,"DIV",{});var u=q(e);i&&i.l(u),u.forEach(w),this.h()},h(){Ne(e,s)},m(a,u){U(a,e,u),i&&i.m(e,null),l[9](e),r=!0,t||(n=et(l[2].action(e)),t=!0)},p(a,u){i&&i.p&&(!r||u&132)&&we(i,o,a,a[7],r?ye(o,a[7],u,pa):ke(a[7]),jn),Ne(e,s=Oe(c,[u&4&&a[2],u&16&&a[4]]))},i(a){r||(T(i,a),r=!0)},o(a){C(i,a),r=!1},d(a){a&&w(e),i&&i.d(a),l[9](null),t=!1,n()}}}function wa(l){let e;const r=l[8].default,t=ve(r,l,l[7],Wn);return{c(){t&&t.c()},l(n){t&&t.l(n)},m(n,o){t&&t.m(n,o),e=!0},p(n,o){t&&t.p&&(!e||o&132)&&we(t,r,n,n[7],e?ye(r,n[7],o,ba):ke(n[7]),Wn)},i(n){e||(T(t,n),e=!0)},o(n){C(t,n),e=!1},d(n){t&&t.d(n)}}}function ka(l){let e,r,t,n;const o=[wa,va],i=[];function c(s,a){return s[1]?0:1}return e=c(l),r=i[e]=o[e](l),{c(){r.c(),t=ne()},l(s){r.l(s),t=ne()},m(s,a){i[e].m(s,a),U(s,t,a),n=!0},p(s,[a]){let u=e;e=c(s),e===u?i[e].p(s,a):(de(),C(i[u],1,1,()=>{i[u]=null}),he(),r=i[e],r?r.p(s,a):(r=i[e]=o[e](s),r.c()),T(r,1),r.m(t.parentNode,t))},i(s){n||(T(r),n=!0)},o(s){C(r),n=!1},d(s){s&&w(t),i[e].d(s)}}}function ya(l,e,r){let t;const n=["value","asChild","el"];let o=Ee(e,n),i,{$$slots:c={},$$scope:s}=e,{value:a}=e,{asChild:u=!1}=e,{el:f=void 0}=e;const{elements:{content:_},getAttrs:d}=Co();re(l,_,g=>r(6,i=g));const p=d("content");function m(g){Ue[g?"unshift":"push"](()=>{f=g,r(0,f)})}return l.$$set=g=>{e=ee(ee({},e),Le(g)),r(4,o=Ee(e,n)),"value"in g&&r(5,a=g.value),"asChild"in g&&r(1,u=g.asChild),"el"in g&&r(0,f=g.el),"$$scope"in g&&r(7,s=g.$$scope)},l.$$.update=()=>{l.$$.dirty&96&&r(2,t=i(a)),l.$$.dirty&4&&Object.assign(t,p)},[f,u,t,_,o,a,i,s,c,m]}let Ta=class extends ce{constructor(e){super(),ue(this,e,ya,ka,se,{value:5,asChild:1,el:0})}};function Ea(l){let e;const r=l[3].default,t=ve(r,l,l[4],null);return{c(){t&&t.c()},l(n){t&&t.l(n)},m(n,o){t&&t.m(n,o),e=!0},p(n,o){t&&t.p&&(!e||o&16)&&we(t,r,n,n[4],e?ye(r,n[4],o,null):ke(n[4]),null)},i(n){e||(T(t,n),e=!0)},o(n){C(t,n),e=!1},d(n){t&&t.d(n)}}}function Ca(l){let e,r;const t=[{class:ht("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",l[0])},{value:l[1]},l[2]];let n={$$slots:{default:[Ea]},$$scope:{ctx:l}};for(let o=0;o<t.length;o+=1)n=ee(n,t[o]);return e=new Ta({props:n}),{c(){Y(e.$$.fragment)},l(o){Q(e.$$.fragment,o)},m(o,i){G(e,o,i),r=!0},p(o,[i]){const c=i&7?Oe(t,[i&1&&{class:ht("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",o[0])},i&2&&{value:o[1]},i&4&&Ke(o[2])]):{};i&16&&(c.$$scope={dirty:i,ctx:o}),e.$set(c)},i(o){r||(T(e.$$.fragment,o),r=!0)},o(o){C(e.$$.fragment,o),r=!1},d(o){W(e,o)}}}function Sa(l,e,r){const t=["class","value"];let n=Ee(e,t),{$$slots:o={},$$scope:i}=e,{class:c=void 0}=e,{value:s}=e;return l.$$set=a=>{e=ee(ee({},e),Le(a)),r(2,n=Ee(e,t)),"class"in a&&r(0,c=a.class),"value"in a&&r(1,s=a.value),"$$scope"in a&&r(4,i=a.$$scope)},[c,s,n,o,i]}class Fr extends ce{constructor(e){super(),ue(this,e,Sa,Ca,se,{class:0,value:1})}}const Xr=Fe([]),at=Fe({showMarkerMenu:!1,showVehicleMenu:!1}),qt=Fe(!1),ln=Fe(),$a=Fe(!1),Wt=Fe(!1),lt=Fe([]),nt=Fe([]),rt={controls:{showMarkerMenu:!1,showVehicleMenu:!1},showEndTrailModal:!1,trailingButtonPressed:!1,crispVisibility:!1,drawingModeEnabled:!1,currentTrail:null,coordinateBuffer:[],unsavedCoordinates:[],unsavedTrails:[],historicalTrails:[],otherActiveTrails:[]};function Ma(){at.set(rt.controls),qt.set(rt.showEndTrailModal),ln.set(rt.trailingButtonPressed),$a.set(rt.crispVisibility),Wt.set(rt.drawingModeEnabled),ot.set(rt.currentTrail),kr.set(rt.coordinateBuffer),Ct.set(rt.unsavedCoordinates),Qt.set(rt.unsavedTrails),lt.set(rt.historicalTrails),nt.set(rt.otherActiveTrails)}const Ia=async({url:l,fetch:e,depends:r})=>{Ma();const t=l.searchParams.get("field");let n=null,o=null;return["field","vehicle","marker"].forEach(i=>{const c=l.searchParams.get(i);c&&(n=i,o=c)}),{field:t,type:n,id:o}},Pd=Object.freeze(Object.defineProperty({__proto__:null,load:Ia},Symbol.toStringTag,{value:"Module"})),io=Fe(null),Zr=Fe(null),La=Fe(!1);function Gn(l,e,r){const t=l.slice();return t[20]=e[r],t}function Yn(l){let e,r,t,n,o='<svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>',i,c,s='<svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"></path></svg>',a,u,f,_,d,p,m=dt(l[1]),g=[];for(let $=0;$<m.length;$+=1)g[$]=Xn(Gn(l,m,$));const v=$=>C(g[$],1,1,()=>{g[$]=null});return{c(){e=F("div"),r=F("div"),t=F("div"),n=F("button"),n.innerHTML=o,i=Z(),c=F("button"),c.innerHTML=s,a=Z(),u=F("div"),f=F("div");for(let $=0;$<g.length;$+=1)g[$].c();this.h()},l($){e=V($,"DIV",{class:!0});var I=q(e);r=V(I,"DIV",{class:!0});var k=q(r);t=V(k,"DIV",{class:!0});var S=q(t);n=V(S,"BUTTON",{class:!0,"data-svelte-h":!0}),be(n)!=="svelte-13ooeyd"&&(n.innerHTML=o),i=X(S),c=V(S,"BUTTON",{class:!0,"data-svelte-h":!0}),be(c)!=="svelte-7ywqrw"&&(c.innerHTML=s),S.forEach(w),a=X(k),u=V(k,"DIV",{class:!0});var E=q(u);f=V(E,"DIV",{class:!0});var h=q(f);for(let b=0;b<g.length;b+=1)g[b].l(h);h.forEach(w),E.forEach(w),k.forEach(w),I.forEach(w),this.h()},h(){D(n,"class","flex items-center justify-center border-r border-gray-300 p-4 transition duration-200 hover:bg-green-300"),D(c,"class","flex items-center justify-center p-4 transition duration-200 hover:bg-red-300"),D(t,"class","grid grid-cols-2 bg-gray-200"),D(f,"class","grid-auto-flow grid-auto-columns grid gap-2 svelte-swoi0v"),D(u,"class","max-h-64 overflow-auto p-2"),D(r,"class","w-11/12 overflow-hidden rounded-lg border-2 border-gray-300 bg-white bg-opacity-90 text-black shadow-lg sm:w-1/2"),D(e,"class","fixed bottom-0 left-0 right-0 z-10 mb-8 flex justify-center")},m($,I){U($,e,I),A(e,r),A(r,t),A(t,n),A(t,i),A(t,c),A(r,a),A(r,u),A(u,f);for(let k=0;k<g.length;k+=1)g[k]&&g[k].m(f,null);_=!0,d||(p=[Se(n,"click",l[2]),Se(c,"click",l[3])],d=!0)},p($,I){if(I&18){m=dt($[1]);let k;for(k=0;k<m.length;k+=1){const S=Gn($,m,k);g[k]?(g[k].p(S,I),T(g[k],1)):(g[k]=Xn(S),g[k].c(),T(g[k],1),g[k].m(f,null))}for(de(),k=m.length;k<g.length;k+=1)v(k);he()}},i($){if(!_){for(let I=0;I<m.length;I+=1)T(g[I]);_=!0}},o($){g=g.filter(Boolean);for(let I=0;I<g.length;I+=1)C(g[I]);_=!1},d($){$&&w(e),lr(g,$),d=!1,mt(p)}}}function Aa(l){let e;return{c(){e=F("i"),this.h()},l(r){e=V(r,"I",{class:!0}),q(e).forEach(w),this.h()},h(){D(e,"class",jr(`${l[20].class} text-3xl text-gray-700`)+" svelte-swoi0v")},m(r,t){U(r,e,t)},p:$e,i:$e,o:$e,d(r){r&&w(e)}}}function Pa(l){let e;return{c(){e=F("ion-icon"),this.h()},l(r){e=V(r,"ION-ICON",{name:!0,style:!0}),q(e).forEach(w),this.h()},h(){bo(e,"name",l[20].id),Ae(e,"font-size","32px")},m(r,t){U(r,e,t)},p:$e,i:$e,o:$e,d(r){r&&w(e)}}}function Da(l){let e,r;return e=new Ul({props:{icon:l[20].id,size:"42px"}}),{c(){Y(e.$$.fragment)},l(t){Q(e.$$.fragment,t)},m(t,n){G(e,t,n),r=!0},p:$e,i(t){r||(T(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){W(e,t)}}}function Xn(l){let e,r,t,n,o,i,c,s;const a=[Da,Pa,Aa],u=[];function f(d,p){return d[20].class.startsWith("custom-svg")?0:d[20].class.startsWith("ionic-")?1:2}t=f(l),n=u[t]=a[t](l);function _(){return l[7](l[20])}return{c(){e=F("button"),r=F("div"),n.c(),o=Z(),this.h()},l(d){e=V(d,"BUTTON",{class:!0});var p=q(e);r=V(p,"DIV",{class:!0,style:!0});var m=q(r);n.l(m),m.forEach(w),o=X(p),p.forEach(w),this.h()},h(){D(r,"class","flex transform items-center justify-center rounded-lg bg-gray-200 p-3 transition duration-200 hover:scale-125 hover:bg-gray-300"),Ae(r,"width","50px"),Ae(r,"height","45px"),D(e,"class","marker-icon focus:outline-none svelte-swoi0v")},m(d,p){U(d,e,p),A(e,r),u[t].m(r,null),A(e,o),i=!0,c||(s=Se(e,"click",_),c=!0)},p(d,p){l=d,n.p(l,p)},i(d){i||(T(n),i=!0)},o(d){C(n),i=!1},d(d){d&&w(e),u[t].d(),c=!1,s()}}}function Oa(l){let e,r,t=l[0].showMarkerMenu&&Yn(l);return{c(){t&&t.c(),e=ne()},l(n){t&&t.l(n),e=ne()},m(n,o){t&&t.m(n,o),U(n,e,o),r=!0},p(n,[o]){n[0].showMarkerMenu?t?(t.p(n,o),o&1&&T(t,1)):(t=Yn(n),t.c(),T(t,1),t.m(e.parentNode,e)):t&&(de(),C(t,1,1,()=>{t=null}),he())},i(n){r||(T(t),r=!0)},o(n){C(t),r=!1},d(n){n&&w(e),t&&t.d(n)}}}function Zn(l,e){const r=new CustomEvent("handleUpdateMarkerListeners",{detail:{marker:l,id:e}});document.dispatchEvent(r)}function Na(l,e,r){let t,n,o,i,c;re(l,Je,h=>r(10,t=h)),re(l,Ut,h=>r(11,n=h)),re(l,$r,h=>r(12,o=h)),re(l,Hr,h=>r(13,i=h)),re(l,at,h=>r(0,c=h));const{getMap:s}=Gt("map");let a,u;const f=[{id:"rock",class:"custom-svg"},{id:"tree13",class:"custom-svg"},{id:"watertank2",class:"custom-svg"},{id:"wheat2",class:"custom-svg"},{id:"kangaroo",class:"custom-svg"},{id:"electric_tower",class:"custom-svg"},{id:"gate",class:"custom-svg"},{id:"machine_pump",class:"custom-svg"},{id:"recharge_icon",class:"custom-svg"},{id:"repair_shop",class:"custom-svg"},{id:"tractor",class:"custom-svg"},{id:"silo2",class:"custom-svg"},{id:"tree_stump",class:"custom-svg"},{id:"workshop_icon",class:"custom-svg"},{id:"pin",class:"ionic-pin"},{id:"arrow-up-circle",class:"ionic-arrow-up-circle"},{id:"arrow-down-circle",class:"ionic-arrow-down-circle"},{id:"arrow-back-circle",class:"ionic-arrow-back-circle"},{id:"arrow-forward-circle",class:"ionic-arrow-forward-circle"},{id:"thumbs-down",class:"ionic-thumbs-down"},{id:"thumbs-up",class:"ionic-thumbs-up"},{id:"accessibility",class:"ionic-accessibility"},{id:"people",class:"ionic-people"},{id:"settings",class:"ionic-settings"},{id:"home",class:"ionic-home"},{id:"checkmark-circle",class:"ionic-checkmark-circle"},{id:"close-circle",class:"ionic-close-circle"},{id:"information-circle",class:"ionic-information-circle"},{id:"warning",class:"ionic-warning"},{id:"help-circle",class:"ionic-help-circle"},{id:"ban",class:"ionic-ban"},{id:"location",class:"ionic-location"},{id:"lock-closed",class:"ionic-lock-closed"},{id:"lock-open",class:"ionic-lock-open"},{id:"trash",class:"ionic-trash"},{id:"cart",class:"ionic-cart"},{id:"locate",class:"ionic-locate"},{id:"leaf",class:"ionic-leaf"},{id:"call",class:"ionic-call"},{id:"wifi",class:"ionic-wifi"},{id:"radio",class:"ionic-radio"},{id:"cloud-offline",class:"ionic-cloud-offline"},{id:"battery-charging",class:"ionic-battery-charging"},{id:"thermometer",class:"ionic-thermometer"},{id:"sunny",class:"ionic-sunny"},{id:"cloud",class:"ionic-cloud"},{id:"thunderstorm",class:"ionic-thunderstorm"},{id:"rainy",class:"ionic-rainy"},{id:"water",class:"ionic-water"},{id:"fast-food",class:"ionic-fast-food"},{id:"restaurant",class:"ionic-restaurant"},{id:"cart",class:"ionic-cart"},{id:"airplane",class:"ionic-airplane"},{id:"trail-sign",class:"ionic-trail-sign"},{id:"car",class:"ionic-car"},{id:"beer",class:"ionic-beer"},{id:"bonfire",class:"ionic-bonfire"},{id:"boat",class:"ionic-boat"},{id:"bed",class:"ionic-bed"},{id:"bicycle",class:"ionic-bicycle"},{id:"build",class:"ionic-build"},{id:"desktop",class:"ionic-desktop"},{id:"earth",class:"ionic-earth"},{id:"camera",class:"ionic-camera"},{id:"fish",class:"ionic-fish"},{id:"flame",class:"ionic-flame"},{id:"footsteps",class:"ionic-footsteps"},{id:"key",class:"ionic-key"},{id:"man",class:"ionic-man"},{id:"paw",class:"ionic-paw"},{id:"skull",class:"ionic-skull"},{id:"construct",class:"ionic-construct"},{id:"bus",class:"ionic-bus"},{id:"subway",class:"ionic-subway"},{id:"telescope",class:"ionic-telescope"},{id:"construction-truck",class:"at-construction-truck"},{id:"electric-car",class:"at-electric-car"},{id:"gasoline",class:"at-gasoline"},{id:"kg-weight",class:"at-kg-weight"},{id:"carrot",class:"at-carrot"},{id:"middle-finger",class:"at-middle-finger"},{id:"toilet-bathroom",class:"at-toilet-bathroom"},{id:"car-garage",class:"at-car-garage"},{id:"electricity-home",class:"at-electricity-home"},{id:"carrot-turnip-vegetable",class:"at-carrot-turnip-vegetable"},{id:"wheat-harvest",class:"at-wheat-harvest"},{id:"helicopter-travel",class:"at-helicopter-travel"},{id:"camper-vehicle",class:"at-camper-vehicle"},{id:"cargo-transport",class:"at-cargo-transport"},{id:"bulldozer",class:"at-bulldozer"},{id:"construction-transport",class:"at-construction-transport"},{id:"crane-truck",class:"at-crane-truck"},{id:"delivery-truck",class:"at-delivery-truck"},{id:"liquid-transportation",class:"at-liquid-transportation"},{id:"transport-truck",class:"at-transport-truck"},{id:"ladder-truck",class:"at-ladder-truck"}];let{markerPlacementEvent:_=null}=e,{markerClickEvent:d=null}=e;Ge(async()=>{await s(),document.querySelector(".map-container"),a=er.subscribe(S),u=Hr.subscribe(h=>{h&&p()})}),gt(()=>{console.log("Destroying MarkerManager"),a&&a(),u&&u(),Je.set([]),tr.set([]),er.set([])});async function p(){const h=await s(),b=i;if(b){const y=new Ze.LngLat(b.longitude,b.latitude),L=gn(),N=m(y,"default",L);N.addTo(h),Je.update(M=>[...M,{marker:N,id:L,last_confirmed:new Date().toISOString(),iconClass:"default"}]),h.flyTo({center:y,zoom:15,duration:1e3}),console.log("Marker placed at current location:",y)}else console.error("Unable to get current location")}function m(h,b,y){if(b==="default"){const M=new Ze.Marker().setLngLat(h);return M.getElement().setAttribute("data-marker-id",y),Zn(M,y),M}const L=document.createElement("div");if(L.style.width="35px",L.style.height="35px",L.setAttribute("data-marker-id",y),L.style.display="flex",L.style.justifyContent="center",L.style.alignItems="center",L.style.borderRadius="100%",L.style.backgroundColor="LightGray",L.style.opacity=.9,L.style.boxShadow="0 2px 4px rgba(0, 0, 0, 0.2)",b.startsWith("custom-svg-"))new Ul({target:L,props:{icon:b.replace("custom-svg-",""),size:"25px",color:"black"}}),L.querySelector("svg").dataset.icon=b.replace("custom-svg-","");else if(b.startsWith("ionic-")){const M=document.createElement("ion-icon");M.setAttribute("name",b.replace("ionic-","")),M.style.fontSize="28px",M.style.color="black",L.appendChild(M)}else{const M=document.createElement("i");M.className=b,M.style.fontSize="20px",M.style.color="black",M.style.fill="#ff6347",M.style.fontWeight="bold",L.appendChild(M)}const N=new Ze.Marker({element:L}).setLngLat(h);return Zn(N,y),N}async function g(h){const b=await s(),{lngLat:y}=h;if(y){if(n){const{marker:M}=n;M.remove()}const L=gn(),N=m(y,"default",L);N.setLngLat(y).addTo(b),Ut.set({marker:N,id:L}),b.flyTo({center:y,duration:1e3}),at.update(M=>({...M,showMarkerMenu:!0})),console.log("Marker ID Placed:",L,n)}else console.error("Invalid event format. Missing lngLat property.")}function v(){if(n){const{marker:h,id:b}=n,y=new Date().toISOString(),L=t.find(O=>O.id===b);let N="default";const M=h.getElement(),P=M.querySelector("svg[data-icon]");if(P&&P.dataset.icon)N=`custom-svg-${P.dataset.icon}`;else{const O=M.querySelector("ion-icon");if(O)N=`ionic-${O.getAttribute("name")}`;else{const R=M.querySelector("i");R&&(N=R.className)}}const H={marker:h,id:b,last_confirmed:y,iconClass:N};L?(console.log("Updating existing marker:",H),Je.update(O=>O.map(R=>R.id===b?H:R))):(console.log("Adding new marker:",H),Je.update(O=>[...O,H])),Ut.set(null)}at.update(h=>({...h,showMarkerMenu:!1}))}function $(){if(n){const{marker:h,id:b}=n;h.remove(),Ut.set(null);let y=o.id;const L=t.find(N=>N.id===b);L&&(Je.update(N=>{const M=N.filter(P=>P.id!==b);return tr.update(P=>[...P,{id:b,deletedBy:y,last_confirmed:L.last_confirmed}]),M}),console.log("Marker removed:",b))}at.update(h=>({...h,showMarkerMenu:!1}))}async function I(h){const b=await s(),{marker:y,id:L}=h;if(Ut.set({marker:y,id:L}),console.log(`Marker selected with ID: ${L}`,n),n){const N=y.getLngLat();b.flyTo({center:N,zoom:15,duration:1e3}),at.update(M=>({...M,showMarkerMenu:!0}))}}async function k(h){const b=await s();let y=h.id;if(n){const{marker:L,id:N}=n,M=L.getLngLat();L.remove();let P;h.class.startsWith("custom-svg")?P=m(M,`custom-svg-${y}`,N):P=m(M,h.class,N),P.addTo(b);const H={marker:P,id:N};Ut.set(H)}}async function S(h){const b=await s(),y=[];h.forEach((L,N)=>{const{markerData:M}=L,{id:P,marker_data:H,last_confirmed:O,iconClass:R}=M;if(L.action==="add"||L.action==="update"){const{geometry:z,properties:B}=H,{coordinates:J}=z,K=new Ze.LngLat(J[0],J[1]),te=R||B.icon,j=m(K,te,P);j.setLngLat(K).addTo(b),L.action==="add"?Je.update(x=>[...x,{marker:j,id:P,last_confirmed:O,iconClass:te}]):Je.update(x=>x.map(me=>me.id===P?{marker:j,id:P,last_confirmed:O,iconClass:te}:me)),y.push(N)}else if(L.action==="delete"){const z=t.find(B=>B.id===P);if(z){const{marker:B}=z;B.remove(),Je.update(J=>J.filter(K=>K.id!==P)),console.log("Marker removed:",M)}y.push(N)}}),y.length>0&&er.update(L=>L.filter((N,M)=>!y.includes(M)))}const E=h=>k(h);return l.$$set=h=>{"markerPlacementEvent"in h&&r(5,_=h.markerPlacementEvent),"markerClickEvent"in h&&r(6,d=h.markerClickEvent)},l.$$.update=()=>{l.$$.dirty&32&&_&&g(_),l.$$.dirty&64&&d&&I(d)},[c,f,v,$,k,_,d,E]}class za extends ce{constructor(e){super(),ue(this,e,Na,Oa,se,{markerPlacementEvent:5,markerClickEvent:6})}}const Va=Fe([]);function Jn(l,e,r){const t=l.slice();return t[5]=e[r],t}function Kn(l){let e,r;return e=new _a({props:{thumb:l[5],class:"border-primary bg-background ring-offset-background focus-visible:ring-ring block h-5 w-5 rounded-full border-2 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"}}),{c(){Y(e.$$.fragment)},l(t){Q(e.$$.fragment,t)},m(t,n){G(e,t,n),r=!0},p(t,n){const o={};n&16&&(o.thumb=t[5]),e.$set(o)},i(t){r||(T(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){W(e,t)}}}function Fa(l){let e,r,t,n,o;r=new ua({props:{class:"bg-primary absolute h-full"}});let i=dt(l[4]),c=[];for(let a=0;a<i.length;a+=1)c[a]=Kn(Jn(l,i,a));const s=a=>C(c[a],1,1,()=>{c[a]=null});return{c(){e=F("span"),Y(r.$$.fragment),t=Z();for(let a=0;a<c.length;a+=1)c[a].c();n=ne(),this.h()},l(a){e=V(a,"SPAN",{class:!0});var u=q(e);Q(r.$$.fragment,u),u.forEach(w),t=X(a);for(let f=0;f<c.length;f+=1)c[f].l(a);n=ne(),this.h()},h(){D(e,"class","bg-secondary relative h-2 w-full grow overflow-hidden rounded-full")},m(a,u){U(a,e,u),G(r,e,null),U(a,t,u);for(let f=0;f<c.length;f+=1)c[f]&&c[f].m(a,u);U(a,n,u),o=!0},p(a,u){if(u&16){i=dt(a[4]);let f;for(f=0;f<i.length;f+=1){const _=Jn(a,i,f);c[f]?(c[f].p(_,u),T(c[f],1)):(c[f]=Kn(_),c[f].c(),T(c[f],1),c[f].m(n.parentNode,n))}for(de(),f=i.length;f<c.length;f+=1)s(f);he()}},i(a){if(!o){T(r.$$.fragment,a);for(let u=0;u<i.length;u+=1)T(c[u]);o=!0}},o(a){C(r.$$.fragment,a),c=c.filter(Boolean);for(let u=0;u<c.length;u+=1)C(c[u]);o=!1},d(a){a&&(w(e),w(t),w(n)),W(r),lr(c,a)}}}function Ba(l){let e,r,t;const n=[{class:ht("relative flex w-full touch-none select-none items-center",l[1])},l[2]];function o(c){l[3](c)}let i={$$slots:{default:[Fa,({thumbs:c})=>({4:c}),({thumbs:c})=>c?16:0]},$$scope:{ctx:l}};for(let c=0;c<n.length;c+=1)i=ee(i,n[c]);return l[0]!==void 0&&(i.value=l[0]),e=new la({props:i}),Ue.push(()=>Sr(e,"value",o)),{c(){Y(e.$$.fragment)},l(c){Q(e.$$.fragment,c)},m(c,s){G(e,c,s),t=!0},p(c,[s]){const a=s&6?Oe(n,[s&2&&{class:ht("relative flex w-full touch-none select-none items-center",c[1])},s&4&&Ke(c[2])]):{};s&272&&(a.$$scope={dirty:s,ctx:c}),!r&&s&1&&(r=!0,a.value=c[0],Cr(()=>r=!1)),e.$set(a)},i(c){t||(T(e.$$.fragment,c),t=!0)},o(c){C(e.$$.fragment,c),t=!1},d(c){W(e,c)}}}function Ua(l,e,r){const t=["class","value"];let n=Ee(e,t),{class:o=void 0}=e,{value:i=[0]}=e;function c(s){i=s,r(0,i)}return l.$$set=s=>{e=ee(ee({},e),Le(s)),r(2,n=Ee(e,t)),"class"in s&&r(1,o=s.class),"value"in s&&r(0,i=s.value)},[i,o,n,c]}class Ra extends ce{constructor(e){super(),ue(this,e,Ua,Ba,se,{class:1,value:0})}}function qa(l){let e,r,t;const n=l[2].default,o=ve(n,l,l[3],null);return r=new Hs({props:{class:ht("bg-border relative rounded-full",l[1]==="vertical"&&"flex-1")}}),{c(){o&&o.c(),e=Z(),Y(r.$$.fragment)},l(i){o&&o.l(i),e=X(i),Q(r.$$.fragment,i)},m(i,c){o&&o.m(i,c),U(i,e,c),G(r,i,c),t=!0},p(i,c){o&&o.p&&(!t||c&8)&&we(o,n,i,i[3],t?ye(n,i[3],c,null):ke(i[3]),null);const s={};c&2&&(s.class=ht("bg-border relative rounded-full",i[1]==="vertical"&&"flex-1")),r.$set(s)},i(i){t||(T(o,i),T(r.$$.fragment,i),t=!0)},o(i){C(o,i),C(r.$$.fragment,i),t=!1},d(i){i&&w(e),o&&o.d(i),W(r,i)}}}function Ha(l){let e,r;return e=new ws({props:{orientation:l[1],class:ht("flex touch-none select-none transition-colors",l[1]==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-px",l[1]==="horizontal"&&"h-2.5 w-full border-t border-t-transparent p-px",l[0]),$$slots:{default:[qa]},$$scope:{ctx:l}}}),{c(){Y(e.$$.fragment)},l(t){Q(e.$$.fragment,t)},m(t,n){G(e,t,n),r=!0},p(t,[n]){const o={};n&2&&(o.orientation=t[1]),n&3&&(o.class=ht("flex touch-none select-none transition-colors",t[1]==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-px",t[1]==="horizontal"&&"h-2.5 w-full border-t border-t-transparent p-px",t[0])),n&10&&(o.$$scope={dirty:n,ctx:t}),e.$set(o)},i(t){r||(T(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){W(e,t)}}}function ja(l,e,r){let{$$slots:t={},$$scope:n}=e,{class:o=void 0}=e,{orientation:i="vertical"}=e;return l.$$set=c=>{"class"in c&&r(0,o=c.class),"orientation"in c&&r(1,i=c.orientation),"$$scope"in c&&r(3,n=c.$$scope)},[o,i,t,n]}class so extends ce{constructor(e){super(),ue(this,e,ja,Ha,se,{class:0,orientation:1})}}function Wa(l){let e;const r=l[5].default,t=ve(r,l,l[6],null);return{c(){t&&t.c()},l(n){t&&t.l(n)},m(n,o){t&&t.m(n,o),e=!0},p(n,o){t&&t.p&&(!e||o&64)&&we(t,r,n,n[6],e?ye(r,n[6],o,null):ke(n[6]),null)},i(n){e||(T(t,n),e=!0)},o(n){C(t,n),e=!1},d(n){t&&t.d(n)}}}function Ga(l){let e,r;return e=new Ki({props:{$$slots:{default:[Wa]},$$scope:{ctx:l}}}),{c(){Y(e.$$.fragment)},l(t){Q(e.$$.fragment,t)},m(t,n){G(e,t,n),r=!0},p(t,n){const o={};n&64&&(o.$$scope={dirty:n,ctx:t}),e.$set(o)},i(t){r||(T(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){W(e,t)}}}function Qn(l){let e,r;return e=new so({props:{orientation:"vertical",class:l[3]}}),{c(){Y(e.$$.fragment)},l(t){Q(e.$$.fragment,t)},m(t,n){G(e,t,n),r=!0},p(t,n){const o={};n&8&&(o.class=t[3]),e.$set(o)},i(t){r||(T(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){W(e,t)}}}function xn(l){let e,r;return e=new so({props:{orientation:"horizontal",class:l[2]}}),{c(){Y(e.$$.fragment)},l(t){Q(e.$$.fragment,t)},m(t,n){G(e,t,n),r=!0},p(t,n){const o={};n&4&&(o.class=t[2]),e.$set(o)},i(t){r||(T(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){W(e,t)}}}function Ya(l){let e,r,t,n,o,i;e=new ji({props:{class:"h-full w-full rounded-[inherit]",$$slots:{default:[Ga]},$$scope:{ctx:l}}});let c=(l[1]==="vertical"||l[1]==="both")&&Qn(l),s=(l[1]==="horizontal"||l[1]==="both")&&xn(l);return o=new Js({}),{c(){Y(e.$$.fragment),r=Z(),c&&c.c(),t=Z(),s&&s.c(),n=Z(),Y(o.$$.fragment)},l(a){Q(e.$$.fragment,a),r=X(a),c&&c.l(a),t=X(a),s&&s.l(a),n=X(a),Q(o.$$.fragment,a)},m(a,u){G(e,a,u),U(a,r,u),c&&c.m(a,u),U(a,t,u),s&&s.m(a,u),U(a,n,u),G(o,a,u),i=!0},p(a,u){const f={};u&64&&(f.$$scope={dirty:u,ctx:a}),e.$set(f),a[1]==="vertical"||a[1]==="both"?c?(c.p(a,u),u&2&&T(c,1)):(c=Qn(a),c.c(),T(c,1),c.m(t.parentNode,t)):c&&(de(),C(c,1,1,()=>{c=null}),he()),a[1]==="horizontal"||a[1]==="both"?s?(s.p(a,u),u&2&&T(s,1)):(s=xn(a),s.c(),T(s,1),s.m(n.parentNode,n)):s&&(de(),C(s,1,1,()=>{s=null}),he())},i(a){i||(T(e.$$.fragment,a),T(c),T(s),T(o.$$.fragment,a),i=!0)},o(a){C(e.$$.fragment,a),C(c),C(s),C(o.$$.fragment,a),i=!1},d(a){a&&(w(r),w(t),w(n)),W(e,a),c&&c.d(a),s&&s.d(a),W(o,a)}}}function Xa(l){let e,r;const t=[l[4],{class:ht("relative overflow-hidden",l[0])}];let n={$$slots:{default:[Ya]},$$scope:{ctx:l}};for(let o=0;o<t.length;o+=1)n=ee(n,t[o]);return e=new Vi({props:n}),{c(){Y(e.$$.fragment)},l(o){Q(e.$$.fragment,o)},m(o,i){G(e,o,i),r=!0},p(o,[i]){const c=i&17?Oe(t,[i&16&&Ke(o[4]),i&1&&{class:ht("relative overflow-hidden",o[0])}]):{};i&78&&(c.$$scope={dirty:i,ctx:o}),e.$set(c)},i(o){r||(T(e.$$.fragment,o),r=!0)},o(o){C(e.$$.fragment,o),r=!1},d(o){W(e,o)}}}function Za(l,e,r){const t=["class","orientation","scrollbarXClasses","scrollbarYClasses"];let n=Ee(e,t),{$$slots:o={},$$scope:i}=e,{class:c=void 0}=e,{orientation:s="vertical"}=e,{scrollbarXClasses:a=""}=e,{scrollbarYClasses:u=""}=e;return l.$$set=f=>{e=ee(ee({},e),Le(f)),r(4,n=Ee(e,t)),"class"in f&&r(0,c=f.class),"orientation"in f&&r(1,s=f.orientation),"scrollbarXClasses"in f&&r(2,a=f.scrollbarXClasses),"scrollbarYClasses"in f&&r(3,u=f.scrollbarYClasses),"$$scope"in f&&r(6,i=f.$$scope)},[c,s,a,u,n,o,i]}class on extends ce{constructor(e){super(),ue(this,e,Za,Xa,se,{class:0,orientation:1,scrollbarXClasses:2,scrollbarYClasses:3})}}function el(l,e,r){const t=l.slice();return t[28]=e[r],t}function tl(l,e,r){const t=l.slice();return t[31]=e[r],t}function rl(l,e,r){const t=l.slice();return t[34]=e[r],t}function Ja(l){let e;return{c(){e=_e("Vehicles")},l(r){e=ge(r,"Vehicles")},m(r,t){U(r,e,t)},d(r){r&&w(e)}}}function Ka(l){let e;return{c(){e=_e("Colors")},l(r){e=ge(r,"Colors")},m(r,t){U(r,e,t)},d(r){r&&w(e)}}}function Qa(l){let e;return{c(){e=_e("Swath")},l(r){e=ge(r,"Swath")},m(r,t){U(r,e,t)},d(r){r&&w(e)}}}function xa(l){let e,r,t,n,o,i;return e=new zr({props:{value:"vehicles",class:"rounded-md px-4 py-2 text-gray-700 transition-all duration-200 hover:bg-gray-200 data-[state=active]:bg-white data-[state=active]:shadow-md",$$slots:{default:[Ja]},$$scope:{ctx:l}}}),t=new zr({props:{value:"colors",class:"rounded-md px-4 py-2 text-gray-700 transition-all duration-200 hover:bg-gray-200 data-[state=active]:bg-white data-[state=active]:shadow-md",$$slots:{default:[Ka]},$$scope:{ctx:l}}}),o=new zr({props:{value:"swath",class:"rounded-md px-4 py-2 text-gray-700 transition-all duration-200 hover:bg-gray-200 data-[state=active]:bg-white data-[state=active]:shadow-md",$$slots:{default:[Qa]},$$scope:{ctx:l}}}),{c(){Y(e.$$.fragment),r=Z(),Y(t.$$.fragment),n=Z(),Y(o.$$.fragment)},l(c){Q(e.$$.fragment,c),r=X(c),Q(t.$$.fragment,c),n=X(c),Q(o.$$.fragment,c)},m(c,s){G(e,c,s),U(c,r,s),G(t,c,s),U(c,n,s),G(o,c,s),i=!0},p(c,s){const a={};s[1]&64&&(a.$$scope={dirty:s,ctx:c}),e.$set(a);const u={};s[1]&64&&(u.$$scope={dirty:s,ctx:c}),t.$set(u);const f={};s[1]&64&&(f.$$scope={dirty:s,ctx:c}),o.$set(f)},i(c){i||(T(e.$$.fragment,c),T(t.$$.fragment,c),T(o.$$.fragment,c),i=!0)},o(c){C(e.$$.fragment,c),C(t.$$.fragment,c),C(o.$$.fragment,c),i=!1},d(c){c&&(w(r),w(n)),W(e,c),W(t,c),W(o,c)}}}function ec(l){let e,r,t;var n=It[l[34].type];function o(i,c){return{props:{bodyColor:i[34].bodyColor,size:"100%"}}}return n&&(e=Mt(n,o(l))),{c(){e&&Y(e.$$.fragment),r=Z()},l(i){e&&Q(e.$$.fragment,i),r=X(i)},m(i,c){e&&G(e,i,c),U(i,r,c),t=!0},p(i,c){if(c[0]&8&&n!==(n=It[i[34].type])){if(e){de();const s=e;C(s.$$.fragment,1,0,()=>{W(s,1)}),he()}n?(e=Mt(n,o(i)),Y(e.$$.fragment),T(e.$$.fragment,1),G(e,r.parentNode,r)):e=null}else if(n){const s={};c[0]&8&&(s.bodyColor=i[34].bodyColor),e.$set(s)}},i(i){t||(e&&T(e.$$.fragment,i),t=!0)},o(i){e&&C(e.$$.fragment,i),t=!1},d(i){i&&w(r),e&&W(e,i)}}}function nl(l){let e,r;function t(){return l[18](l[34])}return e=new jt({props:{variant:"outline",class:"h-24 w-24 border-2 p-2",$$slots:{default:[ec]},$$scope:{ctx:l}}}),e.$on("click",t),{c(){Y(e.$$.fragment)},l(n){Q(e.$$.fragment,n)},m(n,o){G(e,n,o),r=!0},p(n,o){l=n;const i={};o[0]&8|o[1]&64&&(i.$$scope={dirty:o,ctx:l}),e.$set(i)},i(n){r||(T(e.$$.fragment,n),r=!0)},o(n){C(e.$$.fragment,n),r=!1},d(n){W(e,n)}}}function tc(l){let e,r,t=dt(l[3]),n=[];for(let i=0;i<t.length;i+=1)n[i]=nl(rl(l,t,i));const o=i=>C(n[i],1,1,()=>{n[i]=null});return{c(){e=F("div");for(let i=0;i<n.length;i+=1)n[i].c();this.h()},l(i){e=V(i,"DIV",{class:!0});var c=q(e);for(let s=0;s<n.length;s+=1)n[s].l(c);c.forEach(w),this.h()},h(){D(e,"class","grid-container p-4 svelte-1it14s8")},m(i,c){U(i,e,c);for(let s=0;s<n.length;s+=1)n[s]&&n[s].m(e,null);r=!0},p(i,c){if(c[0]&264){t=dt(i[3]);let s;for(s=0;s<t.length;s+=1){const a=rl(i,t,s);n[s]?(n[s].p(a,c),T(n[s],1)):(n[s]=nl(a),n[s].c(),T(n[s],1),n[s].m(e,null))}for(de(),s=t.length;s<n.length;s+=1)o(s);he()}},i(i){if(!r){for(let c=0;c<t.length;c+=1)T(n[c]);r=!0}},o(i){n=n.filter(Boolean);for(let c=0;c<n.length;c+=1)C(n[c]);r=!1},d(i){i&&w(e),lr(n,i)}}}function rc(l){let e,r;return e=new on({props:{class:"h-full",type:"auto",$$slots:{default:[tc]},$$scope:{ctx:l}}}),{c(){Y(e.$$.fragment)},l(t){Q(e.$$.fragment,t)},m(t,n){G(e,t,n),r=!0},p(t,n){const o={};n[0]&8|n[1]&64&&(o.$$scope={dirty:n,ctx:t}),e.$set(o)},i(t){r||(T(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){W(e,t)}}}function ll(l){let e,r;function t(){return l[19](l[31])}return e=new jt({props:{variant:"outline",class:"h-24 w-24 border-2 p-2",style:"background-color: "+l[31]+";"}}),e.$on("click",t),{c(){Y(e.$$.fragment)},l(n){Q(e.$$.fragment,n)},m(n,o){G(e,n,o),r=!0},p(n,o){l=n},i(n){r||(T(e.$$.fragment,n),r=!0)},o(n){C(e.$$.fragment,n),r=!1},d(n){W(e,n)}}}function nc(l){let e,r,t=dt(l[9]),n=[];for(let i=0;i<t.length;i+=1)n[i]=ll(tl(l,t,i));const o=i=>C(n[i],1,1,()=>{n[i]=null});return{c(){e=F("div");for(let i=0;i<n.length;i+=1)n[i].c();this.h()},l(i){e=V(i,"DIV",{class:!0});var c=q(e);for(let s=0;s<n.length;s+=1)n[s].l(c);c.forEach(w),this.h()},h(){D(e,"class","grid-container p-4 svelte-1it14s8")},m(i,c){U(i,e,c);for(let s=0;s<n.length;s+=1)n[s]&&n[s].m(e,null);r=!0},p(i,c){if(c[0]&4608){t=dt(i[9]);let s;for(s=0;s<t.length;s+=1){const a=tl(i,t,s);n[s]?(n[s].p(a,c),T(n[s],1)):(n[s]=ll(a),n[s].c(),T(n[s],1),n[s].m(e,null))}for(de(),s=t.length;s<n.length;s+=1)o(s);he()}},i(i){if(!r){for(let c=0;c<t.length;c+=1)T(n[c]);r=!0}},o(i){n=n.filter(Boolean);for(let c=0;c<n.length;c+=1)C(n[c]);r=!1},d(i){i&&w(e),lr(n,i)}}}function lc(l){let e,r;return e=new on({props:{class:"h-full",type:"auto",$$slots:{default:[nc]},$$scope:{ctx:l}}}),{c(){Y(e.$$.fragment)},l(t){Q(e.$$.fragment,t)},m(t,n){G(e,t,n),r=!0},p(t,n){const o={};n[1]&64&&(o.$$scope={dirty:n,ctx:t}),e.$set(o)},i(t){r||(T(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){W(e,t)}}}function oc(l){let e,r;return e=new Lo({props:{class:"h-4 w-4"}}),{c(){Y(e.$$.fragment)},l(t){Q(e.$$.fragment,t)},m(t,n){G(e,t,n),r=!0},p:$e,i(t){r||(T(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){W(e,t)}}}function ic(l){let e,r,t;return r=new jt({props:{variant:"ghost",size:"icon",class:"ml-2",$$slots:{default:[oc]},$$scope:{ctx:l}}}),r.$on("click",l[20]),{c(){e=_e(`Swath Width
                        `),Y(r.$$.fragment)},l(n){e=ge(n,`Swath Width
                        `),Q(r.$$.fragment,n)},m(n,o){U(n,e,o),G(r,n,o),t=!0},p(n,o){const i={};o[1]&64&&(i.$$scope={dirty:o,ctx:n}),r.$set(i)},i(n){t||(T(r.$$.fragment,n),t=!0)},o(n){C(r.$$.fragment,n),t=!1},d(n){n&&w(e),W(r,n)}}}function sc(l){let e,r;return e=new Hl({props:{class:"flex items-center",$$slots:{default:[ic]},$$scope:{ctx:l}}}),{c(){Y(e.$$.fragment)},l(t){Q(e.$$.fragment,t)},m(t,n){G(e,t,n),r=!0},p(t,n){const o={};n[1]&64&&(o.$$scope={dirty:n,ctx:t}),e.$set(o)},i(t){r||(T(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){W(e,t)}}}function ol(l){let e,r,t,n,o,i;function c(){return l[21](l[28])}return{c(){e=F("button"),r=_e(l[28]),t=_e(`m
                          `),this.h()},l(s){e=V(s,"BUTTON",{class:!0});var a=q(e);r=ge(a,l[28]),t=ge(a,`m
                          `),a.forEach(w),this.h()},h(){D(e,"class",n="rounded-full px-3 py-1 text-sm "+(l[2].swath===l[28]?"bg-primary text-white":"bg-gray-200"))},m(s,a){U(s,e,a),A(e,r),A(e,t),o||(i=Se(e,"click",c),o=!0)},p(s,a){l=s,a[0]&4&&n!==(n="rounded-full px-3 py-1 text-sm "+(l[2].swath===l[28]?"bg-primary text-white":"bg-gray-200"))&&D(e,"class",n)},d(s){s&&w(e),o=!1,i()}}}function ac(l){let e,r,t,n,o,i,c,s,a=l[1][0]+"",u,f,_,d=dt([4,8,10,12,24,36]),p=[];for(let m=0;m<6;m+=1)p[m]=ol(el(l,d,m));return n=new Jl({props:{class:"h-5 w-5"}}),i=new Ra({props:{value:l[1],onValueChange:l[7],min:2,max:50,step:1,class:"flex-grow [&_[role=slider]]:h-5 [&_[role=slider]]:w-5 [&_[role=slider]]:bg-gray-100 [&_[role=slider]]:shadow-[inset_-2px_-2px_5px_rgba(255,255,255,0.7),inset_2px_2px_5px_rgba(0,0,0,0.1)] [&_[role=track]]:h-2 [&_[role=track]]:bg-gray-200 [&_[role=track]]:shadow-[inset_1px_1px_3px_rgba(0,0,0,0.1),inset_-1px_-1px_3px_rgba(255,255,255,0.7)]"}}),{c(){e=F("div");for(let m=0;m<6;m+=1)p[m].c();r=Z(),t=F("div"),Y(n.$$.fragment),o=Z(),Y(i.$$.fragment),c=Z(),s=F("span"),u=_e(a),f=_e("m"),this.h()},l(m){e=V(m,"DIV",{class:!0});var g=q(e);for(let I=0;I<6;I+=1)p[I].l(g);g.forEach(w),r=X(m),t=V(m,"DIV",{class:!0});var v=q(t);Q(n.$$.fragment,v),o=X(v),Q(i.$$.fragment,v),c=X(v),s=V(v,"SPAN",{class:!0});var $=q(s);u=ge($,a),f=ge($,"m"),$.forEach(w),v.forEach(w),this.h()},h(){D(e,"class","mb-4 grid grid-cols-3 gap-2"),D(s,"class","font-semibold"),D(t,"class","flex items-center space-x-2")},m(m,g){U(m,e,g);for(let v=0;v<6;v+=1)p[v]&&p[v].m(e,null);U(m,r,g),U(m,t,g),G(n,t,null),A(t,o),G(i,t,null),A(t,c),A(t,s),A(s,u),A(s,f),_=!0},p(m,g){if(g[0]&132){d=dt([4,8,10,12,24,36]);let $;for($=0;$<6;$+=1){const I=el(m,d,$);p[$]?p[$].p(I,g):(p[$]=ol(I),p[$].c(),p[$].m(e,null))}for(;$<6;$+=1)p[$].d(1)}const v={};g[0]&2&&(v.value=m[1]),i.$set(v),(!_||g[0]&2)&&a!==(a=m[1][0]+"")&&Ve(u,a)},i(m){_||(T(n.$$.fragment,m),T(i.$$.fragment,m),_=!0)},o(m){C(n.$$.fragment,m),C(i.$$.fragment,m),_=!1},d(m){m&&(w(e),w(r),w(t)),lr(p,m),W(n),W(i)}}}function cc(l){let e,r,t,n;return e=new Rl({props:{class:"flex items-center",$$slots:{default:[sc]},$$scope:{ctx:l}}}),t=new ql({props:{$$slots:{default:[ac]},$$scope:{ctx:l}}}),{c(){Y(e.$$.fragment),r=Z(),Y(t.$$.fragment)},l(o){Q(e.$$.fragment,o),r=X(o),Q(t.$$.fragment,o)},m(o,i){G(e,o,i),U(o,r,i),G(t,o,i),n=!0},p(o,i){const c={};i[1]&64&&(c.$$scope={dirty:i,ctx:o}),e.$set(c);const s={};i[0]&6|i[1]&64&&(s.$$scope={dirty:i,ctx:o}),t.$set(s)},i(o){n||(T(e.$$.fragment,o),T(t.$$.fragment,o),n=!0)},o(o){C(e.$$.fragment,o),C(t.$$.fragment,o),n=!1},d(o){o&&w(r),W(e,o),W(t,o)}}}function uc(l){let e,r,t;return r=new Wr({props:{$$slots:{default:[cc]},$$scope:{ctx:l}}}),{c(){e=F("div"),Y(r.$$.fragment),this.h()},l(n){e=V(n,"DIV",{class:!0});var o=q(e);Q(r.$$.fragment,o),o.forEach(w),this.h()},h(){D(e,"class","space-y-4 p-4")},m(n,o){U(n,e,o),G(r,e,null),t=!0},p(n,o){const i={};o[0]&6|o[1]&64&&(i.$$scope={dirty:o,ctx:n}),r.$set(i)},i(n){t||(T(r.$$.fragment,n),t=!0)},o(n){C(r.$$.fragment,n),t=!1},d(n){n&&w(e),W(r)}}}function fc(l){let e,r;return e=new on({props:{class:"h-full",type:"auto",$$slots:{default:[uc]},$$scope:{ctx:l}}}),{c(){Y(e.$$.fragment)},l(t){Q(e.$$.fragment,t)},m(t,n){G(e,t,n),r=!0},p(t,n){const o={};n[0]&6|n[1]&64&&(o.$$scope={dirty:n,ctx:t}),e.$set(o)},i(t){r||(T(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){W(e,t)}}}function dc(l){let e,r,t,n,o,i,c,s,a;return e=new $o({props:{class:"grid w-full grid-cols-3 gap-1",$$slots:{default:[xa]},$$scope:{ctx:l}}}),n=new Fr({props:{value:"vehicles",class:"h-full",$$slots:{default:[rc]},$$scope:{ctx:l}}}),i=new Fr({props:{value:"colors",class:"h-full",$$slots:{default:[lc]},$$scope:{ctx:l}}}),s=new Fr({props:{value:"swath",class:"h-full",$$slots:{default:[fc]},$$scope:{ctx:l}}}),{c(){Y(e.$$.fragment),r=Z(),t=F("div"),Y(n.$$.fragment),o=Z(),Y(i.$$.fragment),c=Z(),Y(s.$$.fragment),this.h()},l(u){Q(e.$$.fragment,u),r=X(u),t=V(u,"DIV",{class:!0});var f=q(t);Q(n.$$.fragment,f),o=X(f),Q(i.$$.fragment,f),c=X(f),Q(s.$$.fragment,f),f.forEach(w),this.h()},h(){D(t,"class","flex-grow overflow-hidden")},m(u,f){G(e,u,f),U(u,r,f),U(u,t,f),G(n,t,null),A(t,o),G(i,t,null),A(t,c),G(s,t,null),a=!0},p(u,f){const _={};f[1]&64&&(_.$$scope={dirty:f,ctx:u}),e.$set(_);const d={};f[0]&8|f[1]&64&&(d.$$scope={dirty:f,ctx:u}),n.$set(d);const p={};f[1]&64&&(p.$$scope={dirty:f,ctx:u}),i.$set(p);const m={};f[0]&6|f[1]&64&&(m.$$scope={dirty:f,ctx:u}),s.$set(m)},i(u){a||(T(e.$$.fragment,u),T(n.$$.fragment,u),T(i.$$.fragment,u),T(s.$$.fragment,u),a=!0)},o(u){C(e.$$.fragment,u),C(n.$$.fragment,u),C(i.$$.fragment,u),C(s.$$.fragment,u),a=!1},d(u){u&&(w(r),w(t)),W(e,u),W(n),W(i),W(s)}}}function hc(l){let e,r;return e=new So({props:{value:l[4],onValueChange:l[22],class:"rounded-lg bg-gray-100 p-1 shadow-inner",$$slots:{default:[dc]},$$scope:{ctx:l}}}),{c(){Y(e.$$.fragment)},l(t){Q(e.$$.fragment,t)},m(t,n){G(e,t,n),r=!0},p(t,n){const o={};n[0]&16&&(o.value=t[4]),n[0]&16&&(o.onValueChange=t[22]),n[0]&14|n[1]&64&&(o.$$scope={dirty:n,ctx:t}),e.$set(o)},i(t){r||(T(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){W(e,t)}}}function mc(l){let e=l[2].type+"",r;return{c(){r=_e(e)},l(t){r=ge(t,e)},m(t,n){U(t,r,n)},p(t,n){n[0]&4&&e!==(e=t[2].type+"")&&Ve(r,e)},d(t){t&&w(r)}}}function gc(l){let e,r;return e=new Hl({props:{class:"max-w-full break-words px-2 text-xl font-semibold",$$slots:{default:[mc]},$$scope:{ctx:l}}}),{c(){Y(e.$$.fragment)},l(t){Q(e.$$.fragment,t)},m(t,n){G(e,t,n),r=!0},p(t,n){const o={};n[0]&4|n[1]&64&&(o.$$scope={dirty:n,ctx:t}),e.$set(o)},i(t){r||(T(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){W(e,t)}}}function _c(l){let e,r,t,n,o;e=new nn({props:{class:"absolute right-2 top-2 h-4 w-4 text-gray-400"}});var i=It[l[2].type];function c(s,a){return{props:{bodyColor:s[2].bodyColor,size:`${s[2].size*1.8}px`}}}return i&&(t=Mt(i,c(l))),{c(){Y(e.$$.fragment),r=Z(),t&&Y(t.$$.fragment),n=ne()},l(s){Q(e.$$.fragment,s),r=X(s),t&&Q(t.$$.fragment,s),n=ne()},m(s,a){G(e,s,a),U(s,r,a),t&&G(t,s,a),U(s,n,a),o=!0},p(s,a){if(a[0]&4&&i!==(i=It[s[2].type])){if(t){de();const u=t;C(u.$$.fragment,1,0,()=>{W(u,1)}),he()}i?(t=Mt(i,c(s)),Y(t.$$.fragment),T(t.$$.fragment,1),G(t,n.parentNode,n)):t=null}else if(i){const u={};a[0]&4&&(u.bodyColor=s[2].bodyColor),a[0]&4&&(u.size=`${s[2].size*1.8}px`),t.$set(u)}},i(s){o||(T(e.$$.fragment,s),t&&T(t.$$.fragment,s),o=!0)},o(s){C(e.$$.fragment,s),t&&C(t.$$.fragment,s),o=!1},d(s){s&&(w(r),w(n)),W(e,s),t&&W(t,s)}}}function pc(l){let e,r,t,n,o,i=l[2].bodyColor+"",c,s;return e=new nn({props:{class:"absolute right-2 top-2 h-4 w-4 text-gray-400"}}),t=new Jo({props:{class:"mb-2 h-5 w-5"}}),{c(){Y(e.$$.fragment),r=Z(),Y(t.$$.fragment),n=Z(),o=F("span"),c=_e(i)},l(a){Q(e.$$.fragment,a),r=X(a),Q(t.$$.fragment,a),n=X(a),o=V(a,"SPAN",{});var u=q(o);c=ge(u,i),u.forEach(w)},m(a,u){G(e,a,u),U(a,r,u),G(t,a,u),U(a,n,u),U(a,o,u),A(o,c),s=!0},p(a,u){(!s||u[0]&4)&&i!==(i=a[2].bodyColor+"")&&Ve(c,i)},i(a){s||(T(e.$$.fragment,a),T(t.$$.fragment,a),s=!0)},o(a){C(e.$$.fragment,a),C(t.$$.fragment,a),s=!1},d(a){a&&(w(r),w(n),w(o)),W(e,a),W(t,a)}}}function bc(l){let e,r,t,n,o,i=l[1][0]+"",c,s,a;return e=new nn({props:{class:"absolute right-2 top-2 h-4 w-4 text-gray-400"}}),t=new Jl({props:{class:"mb-2 h-5 w-5"}}),{c(){Y(e.$$.fragment),r=Z(),Y(t.$$.fragment),n=Z(),o=F("span"),c=_e(i),s=_e("m")},l(u){Q(e.$$.fragment,u),r=X(u),Q(t.$$.fragment,u),n=X(u),o=V(u,"SPAN",{});var f=q(o);c=ge(f,i),s=ge(f,"m"),f.forEach(w)},m(u,f){G(e,u,f),U(u,r,f),G(t,u,f),U(u,n,f),U(u,o,f),A(o,c),A(o,s),a=!0},p(u,f){(!a||f[0]&2)&&i!==(i=u[1][0]+"")&&Ve(c,i)},i(u){a||(T(e.$$.fragment,u),T(t.$$.fragment,u),a=!0)},o(u){C(e.$$.fragment,u),C(t.$$.fragment,u),a=!1},d(u){u&&(w(r),w(n),w(o)),W(e,u),W(t,u)}}}function vc(l){let e,r,t,n,o,i,c;return e=new jt({props:{variant:"outline",class:"relative flex h-40 w-full items-center justify-center",$$slots:{default:[_c]},$$scope:{ctx:l}}}),e.$on("click",l[23]),n=new jt({props:{variant:"outline",class:"relative flex h-20 flex-col items-center justify-center",$$slots:{default:[pc]},$$scope:{ctx:l}}}),n.$on("click",l[24]),i=new jt({props:{variant:"outline",class:"relative flex h-20 flex-col items-center justify-center",$$slots:{default:[bc]},$$scope:{ctx:l}}}),i.$on("click",l[25]),{c(){Y(e.$$.fragment),r=Z(),t=F("div"),Y(n.$$.fragment),o=Z(),Y(i.$$.fragment),this.h()},l(s){Q(e.$$.fragment,s),r=X(s),t=V(s,"DIV",{class:!0});var a=q(t);Q(n.$$.fragment,a),o=X(a),Q(i.$$.fragment,a),a.forEach(w),this.h()},h(){D(t,"class","grid grid-cols-2 gap-4")},m(s,a){G(e,s,a),U(s,r,a),U(s,t,a),G(n,t,null),A(t,o),G(i,t,null),c=!0},p(s,a){const u={};a[0]&4|a[1]&64&&(u.$$scope={dirty:a,ctx:s}),e.$set(u);const f={};a[0]&4|a[1]&64&&(f.$$scope={dirty:a,ctx:s}),n.$set(f);const _={};a[0]&2|a[1]&64&&(_.$$scope={dirty:a,ctx:s}),i.$set(_)},i(s){c||(T(e.$$.fragment,s),T(n.$$.fragment,s),T(i.$$.fragment,s),c=!0)},o(s){C(e.$$.fragment,s),C(n.$$.fragment,s),C(i.$$.fragment,s),c=!1},d(s){s&&(w(r),w(t)),W(e,s),W(n),W(i)}}}function wc(l){let e,r,t,n;return e=new Rl({props:{class:"pb-2 text-center",$$slots:{default:[gc]},$$scope:{ctx:l}}}),t=new ql({props:{class:"space-y-4",$$slots:{default:[vc]},$$scope:{ctx:l}}}),{c(){Y(e.$$.fragment),r=Z(),Y(t.$$.fragment)},l(o){Q(e.$$.fragment,o),r=X(o),Q(t.$$.fragment,o)},m(o,i){G(e,o,i),U(o,r,i),G(t,o,i),n=!0},p(o,i){const c={};i[0]&4|i[1]&64&&(c.$$scope={dirty:i,ctx:o}),e.$set(c);const s={};i[0]&22|i[1]&64&&(s.$$scope={dirty:i,ctx:o}),t.$set(s)},i(o){n||(T(e.$$.fragment,o),T(t.$$.fragment,o),n=!0)},o(o){C(e.$$.fragment,o),C(t.$$.fragment,o),n=!1},d(o){o&&w(r),W(e,o),W(t,o)}}}function kc(l){let e,r,t,n,o,i,c,s,a,u,f="Cancel",_,d,p,m,g,v,$,I;return n=new Wr({props:{class:"h-full overflow-hidden border-2 border-gray-300",$$slots:{default:[hc]},$$scope:{ctx:l}}}),c=new Wr({props:{class:"h-full w-full",$$slots:{default:[wc]},$$scope:{ctx:l}}}),{c(){e=F("div"),r=F("div"),t=F("div"),Y(n.$$.fragment),o=Z(),i=F("div"),Y(c.$$.fragment),s=Z(),a=F("div"),u=F("button"),u.textContent=f,_=Z(),d=F("button"),p=_e("Confirm"),this.h()},l(k){e=V(k,"DIV",{class:!0,style:!0});var S=q(e);r=V(S,"DIV",{class:!0});var E=q(r);t=V(E,"DIV",{class:!0});var h=q(t);Q(n.$$.fragment,h),h.forEach(w),o=X(E),i=V(E,"DIV",{class:!0});var b=q(i);Q(c.$$.fragment,b),b.forEach(w),E.forEach(w),s=X(S),a=V(S,"DIV",{class:!0});var y=q(a);u=V(y,"BUTTON",{class:!0,"data-svelte-h":!0}),be(u)!=="svelte-15xc6ca"&&(u.textContent=f),_=X(y),d=V(y,"BUTTON",{class:!0});var L=q(d);p=ge(L,"Confirm"),L.forEach(w),y.forEach(w),S.forEach(w),this.h()},h(){D(t,"class","flex w-full flex-grow flex-col overflow-hidden sm:w-1/2 sm:pr-4"),D(i,"class","mt-4 flex w-full flex-col sm:mt-0 sm:w-1/2 sm:pl-4"),D(r,"class","flex flex-grow flex-col overflow-hidden text-black sm:flex-row"),D(u,"class","btn mr-2 flex-1"),D(d,"class","btn btn-primary ml-2 flex-1"),d.disabled=m=!l[6],D(a,"class","mt-6 flex"),D(e,"class","fixed bottom-0 left-0 right-0 z-20 flex transform flex-col rounded-t-lg bg-white p-6 shadow-lg transition-transform duration-300 sm:p-8"),D(e,"style",g=l[5]?"height: 100%;":"height: 60vh;"),St(e,"translate-y-full",!l[0]),St(e,"translate-y-0",l[0])},m(k,S){U(k,e,S),A(e,r),A(r,t),G(n,t,null),A(r,o),A(r,i),G(c,i,null),A(e,s),A(e,a),A(a,u),A(a,_),A(a,d),A(d,p),v=!0,$||(I=[Se(u,"click",l[11]),Se(d,"click",l[10])],$=!0)},p(k,S){const E={};S[0]&30|S[1]&64&&(E.$$scope={dirty:S,ctx:k}),n.$set(E);const h={};S[0]&22|S[1]&64&&(h.$$scope={dirty:S,ctx:k}),c.$set(h),(!v||S[0]&64&&m!==(m=!k[6]))&&(d.disabled=m),(!v||S[0]&32&&g!==(g=k[5]?"height: 100%;":"height: 60vh;"))&&D(e,"style",g),(!v||S[0]&1)&&St(e,"translate-y-full",!k[0]),(!v||S[0]&1)&&St(e,"translate-y-0",k[0])},i(k){v||(T(n.$$.fragment,k),T(c.$$.fragment,k),v=!0)},o(k){C(n.$$.fragment,k),C(c.$$.fragment,k),v=!1},d(k){k&&w(e),W(n),W(c),$=!1,mt(I)}}}function il(l){return l[Math.floor(Math.random()*l.length)]}function yc(l,e){const r=l.filter(n=>!e.includes(n));if(r.length===0)return e.length=0,il(l);const t=il(r);return e.push(t),t}function Tc(l,e,r){let t,n,o,i;const c=rn();let{showMenu:s=!1}=e,{currentVehicleType:a}=e,{currentVehicleSize:u}=e,{currentVehicleColor:f}=e,{currentVehicleSwath:_}=e,d="vehicles",p=[],m=[12];function g(O){const R=Array.isArray(O)?O[0]:O;r(1,m=[R]),r(2,o={...o,swath:R})}function v(O){r(2,o={...O}),r(1,m=[O.swath||12])}let $=!1;const I=["Red","Blue","Green","Yellow","Orange","Purple","SkyBlue","LightGreen","HotPink"];Ge(()=>{const O=()=>{r(5,$=window.innerWidth<640)};return O(),window.addEventListener("resize",O),r(3,t=t.map(R=>R.type===a?{...R,size:u||60,bodyColor:f,swath:_}:{...R,bodyColor:yc(I,p)})),()=>{window.removeEventListener("resize",O)}});function k(){oe.success(`Selected Vehicle: [${o.bodyColor} ${o.type}]`),c("vehicleSelected",{...o,size:o.size,swath:m[0]}),c("closeMenu")}function S(){c("closeMenu")}function E(O){r(2,o={...o,bodyColor:O})}const h=O=>v(O),b=O=>E(O),y=()=>{oe.info("About Swath Width",{description:"Swath width is the area covered by your vehicle in one pass. Proper swath setting ensures correct trailing visuals.",duration:7e3})},L=O=>g(O),N=O=>r(4,d=O),M=()=>r(4,d="vehicles"),P=()=>r(4,d="colors"),H=()=>r(4,d="swath");return l.$$set=O=>{"showMenu"in O&&r(0,s=O.showMenu),"currentVehicleType"in O&&r(13,a=O.currentVehicleType),"currentVehicleSize"in O&&r(14,u=O.currentVehicleSize),"currentVehicleColor"in O&&r(15,f=O.currentVehicleColor),"currentVehicleSwath"in O&&r(16,_=O.currentVehicleSwath)},l.$$.update=()=>{l.$$.dirty[0]&8200&&r(17,n=t.find(O=>O.type===a)||t[0]),l.$$.dirty[0]&196608&&r(2,o={...n,swath:_||n.swath}),l.$$.dirty[0]&6&&o.swath!==m[0]&&r(1,m=[o.swath]),l.$$.dirty[0]&131076&&r(6,i=o.type!==n.type||o.bodyColor!==n.bodyColor||o.size!==n.size||o.swath!==n.swath)},r(3,t=[{type:"FourWheelDriveTractor",bodyColor:"green",size:60,swath:4},{type:"TowBetweenSeeder",bodyColor:"red",size:60,swath:12},{type:"TowBehindSeeder",bodyColor:"red",size:60,swath:12},{type:"TowBehindSeederTracks",bodyColor:"red",size:60,swath:12},{type:"TowBehindBoomspray",bodyColor:"red",size:60,swath:36},{type:"SelfPropelledBoomspray",bodyColor:"red",size:60,swath:36},{type:"ThreePointBoomspray",bodyColor:"red",size:60,swath:36},{type:"FarmUte",bodyColor:"red",size:60,swath:4},{type:"FrontWheelChaserBin",bodyColor:"red",size:60,swath:12},{type:"FourWheelDriveChaserBin",bodyColor:"red",size:60,swath:12},{type:"HeaderDuals",bodyColor:"red",size:60,swath:12},{type:"HeaderSingles",bodyColor:"red",size:60,swath:12},{type:"HeaderTracks",bodyColor:"red",size:60,swath:12},{type:"SelfPropelledSwather",bodyColor:"red",size:60,swath:12},{type:"Spreader",bodyColor:"red",size:60,swath:12},{type:"Truck",bodyColor:"red",size:60,swath:4},{type:"CabOverTruck",bodyColor:"red",size:60,swath:4},{type:"CabOverRoadTrain",bodyColor:"red",size:60,swath:4},{type:"Baler",bodyColor:"red",size:60,swath:12},{type:"Mower",bodyColor:"red",size:60,swath:12},{type:"SelfPropelledMower",bodyColor:"red",size:60,swath:12},{type:"Telehandler",bodyColor:"red",size:60,swath:12},{type:"Loader",bodyColor:"red",size:60,swath:4},{type:"SimpleTractor",bodyColor:"red",size:60,swath:4},{type:"Pointer",bodyColor:"green",size:60,swath:4},{type:"CombineHarvester",bodyColor:"yellow",size:60,swath:12},{type:"Excavator",bodyColor:"orange",size:60,swath:4},{type:"Tractor",bodyColor:"green",size:60,swath:4},{type:"WheelLoader",bodyColor:"yellow",size:60,swath:4},{type:"WorkCar",bodyColor:"red",size:60,swath:4},{type:"Airplane",bodyColor:"blue",size:60,swath:50}]),[s,m,o,t,d,$,i,g,v,I,k,S,E,a,u,f,_,n,h,b,y,L,N,M,P,H]}class Ec extends ce{constructor(e){super(),ue(this,e,Tc,kc,se,{showMenu:0,currentVehicleType:13,currentVehicleSize:14,currentVehicleColor:15,currentVehicleSwath:16},null,[-1,-1])}}function Cc(l){let e,r;return e=new li({props:{size:24}}),{c(){Y(e.$$.fragment)},l(t){Q(e.$$.fragment,t)},m(t,n){G(e,t,n),r=!0},i(t){r||(T(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){W(e,t)}}}function Sc(l){let e,r;return e=new ei({props:{size:24}}),{c(){Y(e.$$.fragment)},l(t){Q(e.$$.fragment,t)},m(t,n){G(e,t,n),r=!0},i(t){r||(T(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){W(e,t)}}}function $c(l){let e;return{c(){e=_e("Loading...")},l(r){e=ge(r,"Loading...")},m(r,t){U(r,e,t)},p:$e,i:$e,o:$e,d(r){r&&w(e)}}}function Mc(l){let e,r,t;var n=l[3];function o(i,c){return{props:{bodyColor:i[0].vehicle_marker.bodyColor,size:i[0].vehicle_marker.size,swath:i[0].vehicle_marker.swath}}}return n&&(e=Mt(n,o(l))),{c(){e&&Y(e.$$.fragment),r=ne()},l(i){e&&Q(e.$$.fragment,i),r=ne()},m(i,c){e&&G(e,i,c),U(i,r,c),t=!0},p(i,c){if(c&8&&n!==(n=i[3])){if(e){de();const s=e;C(s.$$.fragment,1,0,()=>{W(s,1)}),he()}n?(e=Mt(n,o(i)),Y(e.$$.fragment),T(e.$$.fragment,1),G(e,r.parentNode,r)):e=null}else if(n){const s={};c&1&&(s.bodyColor=i[0].vehicle_marker.bodyColor),c&1&&(s.size=i[0].vehicle_marker.size),c&1&&(s.swath=i[0].vehicle_marker.swath),e.$set(s)}},i(i){t||(e&&T(e.$$.fragment,i),t=!0)},o(i){e&&C(e.$$.fragment,i),t=!1},d(i){i&&w(r),e&&W(e,i)}}}function Ic(l){let e,r,t,n;return{c(){e=ut("svg"),r=ut("title"),t=_e("trail"),n=ut("path"),this.h()},l(o){e=ct(o,"svg",{fill:!0,width:!0,height:!0,viewBox:!0,version:!0,xmlns:!0});var i=q(e);r=ct(i,"title",{});var c=q(r);t=ge(c,"trail"),c.forEach(w),n=ct(i,"path",{d:!0,class:!0}),q(n).forEach(w),i.forEach(w),this.h()},h(){D(n,"d","M30.165 30.887c-1.604 0.076-21.522-0.043-21.522-0.043-12.101-12.151 18.219-16.173-0.521-26.154l-1.311 1.383-1.746-4.582 5.635 0.439-1.128 1.267c23.438 6.83-3.151 19.631 20.594 27.69v0z"),D(n,"class","svelte-5z3w06"),D(e,"fill","currentColor"),D(e,"width","36px"),D(e,"height","36px"),D(e,"viewBox","0 0 32 32"),D(e,"version","1.1"),D(e,"xmlns","http://www.w3.org/2000/svg")},m(o,i){U(o,e,i),A(e,r),A(r,t),A(e,n)},p:$e,d(o){o&&w(e)}}}function Lc(l){let e,r,t,n,o;return{c(){e=ut("svg"),r=ut("title"),t=_e("trail"),n=ut("path"),this.h()},l(i){e=ct(i,"svg",{class:!0,fill:!0,width:!0,height:!0,viewBox:!0,version:!0,xmlns:!0});var c=q(e);r=ct(c,"title",{});var s=q(r);t=ge(s,"trail"),s.forEach(w),n=ct(c,"path",{d:!0,class:!0}),q(n).forEach(w),c.forEach(w),this.h()},h(){D(n,"d","M30.165 30.887c-1.604 0.076-21.522-0.043-21.522-0.043-12.101-12.151 18.219-16.173-0.521-26.154l-1.311 1.383-1.746-4.582 5.635 0.439-1.128 1.267c23.438 6.83-3.151 19.631 20.594 27.69v0z"),D(n,"class","svelte-5z3w06"),D(e,"class",o=jr(l[6]?"animate-trail":"")+" svelte-5z3w06"),D(e,"fill","currentColor"),D(e,"width","36px"),D(e,"height","36px"),D(e,"viewBox","0 0 32 32"),D(e,"version","1.1"),D(e,"xmlns","http://www.w3.org/2000/svg")},m(i,c){U(i,e,c),A(e,r),A(r,t),A(e,n)},p(i,c){c&64&&o!==(o=jr(i[6]?"animate-trail":"")+" svelte-5z3w06")&&D(e,"class",o)},d(i){i&&w(e)}}}function sl(l){let e,r;return e=new Ec({props:{showMenu:l[1].showVehicleMenu,currentVehicleType:l[0].vehicle_marker.type,currentVehicleSize:l[0].vehicle_marker.size,currentVehicleColor:l[0].vehicle_marker.bodyColor,currentVehicleSwath:l[0].vehicle_marker.swath}}),e.$on("closeMenu",l[15]),e.$on("vehicleSelected",l[16]),{c(){Y(e.$$.fragment)},l(t){Q(e.$$.fragment,t)},m(t,n){G(e,t,n),r=!0},p(t,n){const o={};n&2&&(o.showMenu=t[1].showVehicleMenu),n&1&&(o.currentVehicleType=t[0].vehicle_marker.type),n&1&&(o.currentVehicleSize=t[0].vehicle_marker.size),n&1&&(o.currentVehicleColor=t[0].vehicle_marker.bodyColor),n&1&&(o.currentVehicleSwath=t[0].vehicle_marker.swath),e.$set(o)},i(t){r||(T(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){W(e,t)}}}function Ac(l){let e,r,t,n,o,i,c,s,a,u,f,_,d,p,m,g,v,$,I,k,S,E,h,b,y,L,N,M,P,H,O,R,z,B;const J=[Sc,Cc],K=[];function te(ie,Ie){return ie[5]?0:1}p=te(l),m=K[p]=J[p](l),$=new Po({props:{size:24}}),S=new Go({props:{size:24}});const j=[Mc,$c],x=[];function me(ie,Ie){return ie[3]?0:1}y=me(l),L=x[y]=j[y](l);function pe(ie,Ie){return ie[6]?Lc:Ic}let Te=pe(l),Me=Te(l),ae=l[2]&&sl(l);return{c(){e=F("div"),r=F("button"),t=ut("svg"),n=ut("path"),o=Z(),i=F("div"),c=F("button"),s=ut("svg"),a=ut("path"),f=Z(),_=F("div"),d=F("button"),m.c(),g=Z(),v=F("button"),Y($.$$.fragment),I=Z(),k=F("button"),Y(S.$$.fragment),E=Z(),h=F("button"),b=F("div"),L.c(),N=Z(),M=F("button"),Me.c(),O=Z(),ae&&ae.c(),this.h()},l(ie){e=V(ie,"DIV",{});var Ie=q(e);r=V(Ie,"BUTTON",{class:!0});var fe=q(r);t=ct(fe,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0,stroke:!0});var Pe=q(t);n=ct(Pe,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0,class:!0}),q(n).forEach(w),Pe.forEach(w),fe.forEach(w),o=X(Ie),i=V(Ie,"DIV",{class:!0});var Ce=q(i);c=V(Ce,"BUTTON",{class:!0});var Re=q(c);s=ct(Re,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0,stroke:!0});var Xt=q(s);a=ct(Xt,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0,class:!0}),q(a).forEach(w),Xt.forEach(w),Re.forEach(w),f=X(Ce),_=V(Ce,"DIV",{class:!0});var Xe=q(_);d=V(Xe,"BUTTON",{class:!0});var wt=q(d);m.l(wt),wt.forEach(w),g=X(Xe),v=V(Xe,"BUTTON",{class:!0});var At=q(v);Q($.$$.fragment,At),At.forEach(w),I=X(Xe),k=V(Xe,"BUTTON",{class:!0});var Vt=q(k);Q(S.$$.fragment,Vt),Vt.forEach(w),E=X(Xe),h=V(Xe,"BUTTON",{class:!0});var Ft=q(h);b=V(Ft,"DIV",{class:!0});var tt=q(b);L.l(tt),tt.forEach(w),Ft.forEach(w),N=X(Xe),M=V(Xe,"BUTTON",{class:!0});var st=q(M);Me.l(st),st.forEach(w),Xe.forEach(w),Ce.forEach(w),O=X(Ie),ae&&ae.l(Ie),Ie.forEach(w),this.h()},h(){D(n,"stroke-linecap","round"),D(n,"stroke-linejoin","round"),D(n,"stroke-width","2"),D(n,"d","M10 19l-7-7m0 0l7-7m-7 7h18"),D(n,"class","svelte-5z3w06"),D(t,"xmlns","http://www.w3.org/2000/svg"),D(t,"class","h-6 w-6"),D(t,"fill","none"),D(t,"viewBox","0 0 24 24"),D(t,"stroke","currentColor"),D(r,"class","top-button "+Tt+" btn btn-circle btn-lg absolute left-4 top-4 z-10 bg-white bg-opacity-50 hover:bg-opacity-100 svelte-5z3w06"),D(a,"stroke-linecap","round"),D(a,"stroke-linejoin","round"),D(a,"stroke-width","2"),D(a,"d","M19 9l-7 7-7-7"),D(a,"class","svelte-5z3w06"),D(s,"xmlns","http://www.w3.org/2000/svg"),D(s,"class",u="h-8 w-8 transition-transform duration-300 "+(l[4]?"rotate-180":"")),D(s,"fill","none"),D(s,"viewBox","0 0 24 24"),D(s,"stroke","currentColor"),D(c,"class","top-button "+Tt+" btn btn-circle btn-lg mb-3 bg-white hover:bg-opacity-90 svelte-5z3w06"),D(d,"class","menu-button "+Tt+" btn btn-circle btn-lg bg-white hover:bg-opacity-90 svelte-5z3w06"),D(v,"class","menu-button "+Tt+" btn btn-circle btn-lg bg-white text-sm hover:bg-opacity-90 svelte-5z3w06"),D(k,"class","menu-button "+Tt+" btn btn-circle btn-lg bg-white hover:bg-opacity-90 svelte-5z3w06"),D(b,"class","flex h-full w-full items-center justify-center"),D(h,"class","menu-button "+Tt+" btn btn-circle btn-lg bg-white hover:bg-opacity-90 svelte-5z3w06"),D(M,"class",P="menu-button "+Tt+" btn btn-circle btn-lg bg-white hover:bg-opacity-90 "+(l[6]?"trailing-active":"")+" relative svelte-5z3w06"),D(_,"class",H="flex origin-top flex-col space-y-3 transition-all duration-700 ease-in-out "+(l[4]?"scale-100 opacity-90":"h-50 scale-0 overflow-hidden opacity-0")),D(i,"class","fixed right-4 top-4 z-20 flex flex-col items-end")},m(ie,Ie){U(ie,e,Ie),A(e,r),A(r,t),A(t,n),A(e,o),A(e,i),A(i,c),A(c,s),A(s,a),A(i,f),A(i,_),A(_,d),K[p].m(d,null),A(_,g),A(_,v),G($,v,null),A(_,I),A(_,k),G(S,k,null),A(_,E),A(_,h),A(h,b),x[y].m(b,null),A(_,N),A(_,M),Me.m(M,null),A(e,O),ae&&ae.m(e,null),R=!0,z||(B=[Se(r,"click",l[9]),Se(c,"click",l[10]),Se(d,"click",l[13]),Se(v,"click",l[11]),Se(k,"click",l[12]),Se(h,"click",l[8]),Se(M,"click",l[7])],z=!0)},p(ie,[Ie]){(!R||Ie&16&&u!==(u="h-8 w-8 transition-transform duration-300 "+(ie[4]?"rotate-180":"")))&&D(s,"class",u);let fe=p;p=te(ie),p!==fe&&(de(),C(K[fe],1,1,()=>{K[fe]=null}),he(),m=K[p],m||(m=K[p]=J[p](ie),m.c()),T(m,1),m.m(d,null));let Pe=y;y=me(ie),y===Pe?x[y].p(ie,Ie):(de(),C(x[Pe],1,1,()=>{x[Pe]=null}),he(),L=x[y],L?L.p(ie,Ie):(L=x[y]=j[y](ie),L.c()),T(L,1),L.m(b,null)),Te===(Te=pe(ie))&&Me?Me.p(ie,Ie):(Me.d(1),Me=Te(ie),Me&&(Me.c(),Me.m(M,null))),(!R||Ie&64&&P!==(P="menu-button "+Tt+" btn btn-circle btn-lg bg-white hover:bg-opacity-90 "+(ie[6]?"trailing-active":"")+" relative svelte-5z3w06"))&&D(M,"class",P),(!R||Ie&16&&H!==(H="flex origin-top flex-col space-y-3 transition-all duration-700 ease-in-out "+(ie[4]?"scale-100 opacity-90":"h-50 scale-0 overflow-hidden opacity-0")))&&D(_,"class",H),ie[2]?ae?(ae.p(ie,Ie),Ie&4&&T(ae,1)):(ae=sl(ie),ae.c(),T(ae,1),ae.m(e,null)):ae&&(de(),C(ae,1,1,()=>{ae=null}),he())},i(ie){R||(T(m),T($.$$.fragment,ie),T(S.$$.fragment,ie),T(L),T(ae),R=!0)},o(ie){C(m),C($.$$.fragment,ie),C(S.$$.fragment,ie),C(L),C(ae),R=!1},d(ie){ie&&w(e),K[p].d(),W($),W(S),x[y].d(),Me.d(),ae&&ae.d(),z=!1,mt(B)}}}let Tt="skan";function Pc(l,e,r){let t,n,o,i;re(l,Wt,S=>r(5,t=S)),re(l,$t,S=>r(0,n=S)),re(l,br,S=>r(18,S)),re(l,at,S=>r(1,o=S)),re(l,it,S=>r(6,i=S)),Ge(async()=>{console.log("Mounting ButtonSection"),setTimeout(()=>{r(4,p=!0)},200)});let{isSatelliteView:c=!0}=e,s=!1,a;const u=rn();function f(){ln.update(S=>!S),i?oe.info("Preparing to end trail recording..."):oe.info("Initiating trail recording...")}function _(){r(2,s=!s),console.log("Set vehicleMenuVisibility to",s),at.update(S=>{const E={...S,showVehicleMenu:s};return console.log("Updated controlStore:",E),E})}function d(){u("backToDashboard")}let p=!1;function m(){r(4,p=!p)}function g(){const S=n.coordinates;S?Hr.set(S):oe.error("Unable to get your current location")}function v(){u("locateHome")}function $(){Fl(Wt,t=!t,t)}const I=()=>{at.update(S=>({...S,showVehicleMenu:!1}))},k=S=>{$t.update(E=>({...E,vehicle_marker:S.detail})),at.update(E=>({...E,showVehicleMenu:!1}))};return l.$$set=S=>{"isSatelliteView"in S&&r(14,c=S.isSatelliteView)},l.$$.update=()=>{l.$$.dirty&1&&n.vehicle_marker&&n.vehicle_marker.type&&r(3,a=It[n.vehicle_marker.type]||It.simpleTractor),l.$$.dirty&2&&r(2,s=o.showVehicleMenu)},[n,o,s,a,p,t,i,f,_,d,m,g,v,$,c,I,k]}class Dc extends ce{constructor(e){super(),ue(this,e,Pc,Ac,se,{isSatelliteView:14})}}const Oc=500,Nc=5;function zc(l,e,r){let t;re(l,Wt,h=>r(3,t=h));let{map:n}=e;const o=rn();let i=null,c=null,s=[],a=!0,u=!1;function f(h){if(!a)return;const b=h.target;b.style.cursor="pointer"}function _(h){if(!a)return;const b=h.target;b.style.cursor=""}function d(h){if(!a)return;h.stopPropagation();const b=h.target.closest(".mapboxgl-marker");if(b){const y=s.find(L=>L.marker.getElement()===b);if(y){const{marker:L,id:N}=y;o("markerClick",{marker:L,id:N})}else console.log("No matching marker found in confirmedMarkers array")}else console.log("No marker element found")}function p(h){if(!a)return;h.stopPropagation(),h.preventDefault(),clearTimeout(i);const b=h.target.closest(".mapboxgl-marker");if(b){const y=s.find(L=>L.marker.getElement()===b);if(y){const{marker:L,id:N}=y;o("markerClick",{marker:L,id:N})}}}function m(h){if(!a)return;const b=h.lngLat||h.target.getLngLat();b?o("markerPlacement",{lngLat:b}):console.error("Invalid event format. Missing lngLat property.")}function g(h){!a||h.originalEvent.target.closest(".mapboxgl-marker")||(clearTimeout(i),c={x:h.originalEvent.clientX||h.originalEvent.touches[0].clientX,y:h.originalEvent.clientY||h.originalEvent.touches[0].clientY},i=setTimeout(()=>{m(h),i=null},Oc))}function v(h){if(a&&c){const b=h.originalEvent.touches?h.originalEvent.touches[0]:h.originalEvent,y=b.clientX-c.x,L=b.clientY-c.y;Math.sqrt(y*y+L*L)>Nc&&(clearTimeout(i),i=null,c=null)}}function $(h){a&&(clearTimeout(i),i=null,c=null)}function I(h,b){const y=h.getElement();y.removeEventListener("mouseenter",f),y.removeEventListener("mouseleave",_),y.removeEventListener("click",d),y.removeEventListener("touchstart",p),y.removeAttribute("data-listeners-added"),y.addEventListener("mouseenter",f),y.addEventListener("mouseleave",_),y.addEventListener("click",d),y.addEventListener("touchstart",p),y.setAttribute("data-listeners-added","true");const L=s.findIndex(N=>N.id===b);L!==-1?s=s.map((N,M)=>M===L?{marker:h,id:b}:N):s=[...s,{marker:h,id:b}]}function k(h){const{marker:b,id:y}=h.detail;I(b,y)}function S(){!n||u||(n.on("mousedown",g),n.on("touchstart",g),n.on("drag",v),n.on("mouseup",$),document.addEventListener("handleUpdateMarkerListeners",k),r(2,u=!0))}function E(){!n||!u||(n.off("mousedown",g),n.off("touchstart",g),n.off("drag",v),n.off("mouseup",$),document.removeEventListener("handleUpdateMarkerListeners",k),r(2,u=!1))}return Ge(()=>{a&&!u&&S()}),gt(()=>{E()}),l.$$set=h=>{"map"in h&&r(0,n=h.map)},l.$$.update=()=>{l.$$.dirty&14&&t!==void 0&&(r(1,a=!t),a&&!u?S():!a&&u&&E())},[n,a,u,t]}class Vc extends ce{constructor(e){super(),ue(this,e,zc,null,se,{map:0})}}var Fc=typeof global=="object"&&global&&global.Object===Object&&global,Bc=typeof self=="object"&&self&&self.Object===Object&&self,ao=Fc||Bc||Function("return this")(),Tr=ao.Symbol,co=Object.prototype,Uc=co.hasOwnProperty,Rc=co.toString,Jt=Tr?Tr.toStringTag:void 0;function qc(l){var e=Uc.call(l,Jt),r=l[Jt];try{l[Jt]=void 0;var t=!0}catch{}var n=Rc.call(l);return t&&(e?l[Jt]=r:delete l[Jt]),n}var Hc=Object.prototype,jc=Hc.toString;function Wc(l){return jc.call(l)}var Gc="[object Null]",Yc="[object Undefined]",al=Tr?Tr.toStringTag:void 0;function Xc(l){return l==null?l===void 0?Yc:Gc:al&&al in Object(l)?qc(l):Wc(l)}function Zc(l){return l!=null&&typeof l=="object"}var Jc="[object Symbol]";function Kc(l){return typeof l=="symbol"||Zc(l)&&Xc(l)==Jc}var Qc=/\s/;function xc(l){for(var e=l.length;e--&&Qc.test(l.charAt(e)););return e}var eu=/^\s+/;function tu(l){return l&&l.slice(0,xc(l)+1).replace(eu,"")}function Jr(l){var e=typeof l;return l!=null&&(e=="object"||e=="function")}var cl=NaN,ru=/^[-+]0x[0-9a-f]+$/i,nu=/^0b[01]+$/i,lu=/^0o[0-7]+$/i,ou=parseInt;function ul(l){if(typeof l=="number")return l;if(Kc(l))return cl;if(Jr(l)){var e=typeof l.valueOf=="function"?l.valueOf():l;l=Jr(e)?e+"":e}if(typeof l!="string")return l===0?l:+l;l=tu(l);var r=nu.test(l);return r||lu.test(l)?ou(l.slice(2),r?2:8):ru.test(l)?cl:+l}var Br=function(){return ao.Date.now()},iu="Expected a function",su=Math.max,au=Math.min;function cu(l,e,r){var t,n,o,i,c,s,a=0,u=!1,f=!1,_=!0;if(typeof l!="function")throw new TypeError(iu);e=ul(e)||0,Jr(r)&&(u=!!r.leading,f="maxWait"in r,o=f?su(ul(r.maxWait)||0,e):o,_="trailing"in r?!!r.trailing:_);function d(E){var h=t,b=n;return t=n=void 0,a=E,i=l.apply(b,h),i}function p(E){return a=E,c=setTimeout(v,e),u?d(E):i}function m(E){var h=E-s,b=E-a,y=e-h;return f?au(y,o-b):y}function g(E){var h=E-s,b=E-a;return s===void 0||h>=e||h<0||f&&b>=o}function v(){var E=Br();if(g(E))return $(E);c=setTimeout(v,m(E))}function $(E){return c=void 0,_&&t?d(E):(t=n=void 0,i)}function I(){c!==void 0&&clearTimeout(c),a=0,t=s=n=c=void 0}function k(){return c===void 0?i:$(Br())}function S(){var E=Br(),h=g(E);if(t=arguments,n=this,s=E,h){if(c===void 0)return p(s);if(f)return clearTimeout(c),c=setTimeout(v,e),d(s)}return c===void 0&&(c=setTimeout(v,e)),i}return S.cancel=I,S.flush=k,S}function uu(l,e,r){let t,n,o,i;re(l,Je,h=>r(8,t=h)),re(l,tr,h=>r(9,n=h)),re(l,Kl,h=>r(10,o=h)),re(l,$r,h=>r(11,i=h));const{LngLatBounds:c}=_o;let s,a,u=!1,f,_,d,p=!1,{map:m}=e;Ge(()=>{_=i.master_map_id,d=i.id,a=cu($,500),f=le.channel("map_markers_changes").on("postgres_changes",{event:"*",schema:"public",table:"map_markers",filter:`master_map_id=eq.${_}`},async h=>{var H,O;if(h.new.update_user_id===d||h.new.deleted&&p){console.log("Skipping synchronization, update made by current user");return}let b="Another user";const y=o.connected_profiles.find(R=>R.id===h.new.update_user_id);if(y)b=y.full_name;else{const{data:R}=await le.from("profiles").select("full_name").eq("id",h.new.update_user_id).single();R&&(b=R.full_name)}const L=h.eventType,N=((O=(H=h.new.marker_data)==null?void 0:H.properties)==null?void 0:O.icon)||"unknown",M=h.new.marker_data.geometry.coordinates,P=h.new.deleted===!0;v(b,L,N,P,M),u||a()}).subscribe(),$(),s=Je.subscribe(h=>{u||a()}),br.update(h=>({...h,synchronizeMarkers:$}))}),gt(()=>{console.log("Destroying MapStateSaver"),a.cancel(),s&&s(),f&&le.removeChannel(f),console.log("Removing all markers from the map"),Je.update(h=>(h.forEach(({marker:b})=>{b.remove()}),[])),Je.set([]),tr.set([]),er.set([])});function g(h,b,y){let L="",N="";switch(h){case"add":L="Marker Added",N=`You added a new ${b} marker`,oe.info(L,{description:N});break;case"update":y?(L="Marker Deleted",N=`You removed a ${b} marker`,oe.warning(L,{description:N})):(L="Marker Updated",N=`You updated a marker to ${b}`,oe.info(L,{description:N}));break}}function v(h,b,y,L,N){let M="",P="";switch(b){case"INSERT":M="Marker Added",P=`${h} added a new ${y} marker`,oe.info(M,{description:P,action:{label:"Locate",onClick:()=>{m.flyTo({center:N,zoom:15,duration:1e3})}}});break;case"UPDATE":L?(M="Marker Deleted",P=`${h} removed a ${y} marker`,oe.warning(M,{description:P})):(M="Marker Updated",P=`${h} updated a marker to ${y}`,oe.info(M,{description:P,action:{label:"Locate",onClick:()=>{m.flyTo({center:N,zoom:15,duration:1e3})}}}));break}}async function $(h){if(u){console.log("Synchronization already in progress. Skipping.");return}if(u=!0,br.update(b=>({...b,spinning:!0})),!d){console.error("User not authenticated"),oe.error("User not authenticated");return}try{const b=await S(),y=t;let{localMarkersToBeAdded:L,localMarkersToBeUpdated:N,localMarkersToBeDeleted:M,serverMarkersToBeAdded:P,serverMarkersToBeUpdated:H,serverMarkersToBeDeleted:O}=I(y,b);const R=[...L.map(z=>({action:"add",markerData:z})),...N.map(z=>({action:"update",markerData:z})),...M.map(z=>({action:"delete",markerData:z}))];er.set(R),await k({serverMarkersToBeAdded:P,serverMarkersToBeUpdated:H,serverMarkersToBeDeleted:O}),E(),h&&oe.success(h)}catch(b){console.error("Error synchronizing markers:",b);let y="Synchronization Error",L=b.message||"Error synchronizing markers";b.message==="No master map assigned"&&(y="Map Assignment Error"),oe.error(y,{description:b.details||L,action:{label:"Reload",onClick:()=>{window.location.reload()}}})}u=!1,br.update(b=>({...b,spinning:!1}))}function I(h,b){let y=[],L=[],N=[],M=[],P=[],H=[];for(const O of h){const R=b.find(z=>z.id===O.id);if(R)R.deleted?new Date(O.last_confirmed)>new Date(R.deleted_at)?(P.push(O),g("update",O.iconClass,!1)):N.push(O):new Date(R.last_confirmed)>new Date(O.last_confirmed)?L.push(R):new Date(O.last_confirmed)>new Date(R.last_confirmed)&&(P.push(O),g("update",O.iconClass,!1));else if(!n.find(B=>B.id===O.id)){let B=O.iconClass||"default";M.push({...O,iconClass:B}),g("add",O.iconClass,!1)}}for(const O of b){const R=h.find(B=>B.id===O.id),z=n.find(B=>B.id===O.id);!R&&!O.deleted&&!z&&y.push(O)}for(const O of n){const R=b.find(z=>z.id===O.id);R&&(O.deletedBy===d?(p=!0,H.push(R),g("update",R.iconClass,!0)):(p=!1,N.push(R)))}return{localMarkersToBeAdded:y,localMarkersToBeUpdated:L,localMarkersToBeDeleted:N,serverMarkersToBeAdded:M,serverMarkersToBeUpdated:P,serverMarkersToBeDeleted:H}}async function k({serverMarkersToBeAdded:h,serverMarkersToBeUpdated:b,serverMarkersToBeDeleted:y}){if(!_)throw new Error("No master map assigned");if(h.length>0){const L=h.map(M=>{const{marker:P,id:H,last_confirmed:O,iconClass:R}=M,B={type:"Feature",geometry:{type:"Point",coordinates:P.getLngLat().toArray()},properties:{icon:R,id:H}};return{master_map_id:_,id:H,marker_data:B,last_confirmed:O,update_user_id:d}}),{error:N}=await le.from("map_markers").insert(L);if(N)throw new Error("Failed to add markers to server")}if(b.length>0){const L=b.map(M=>{const{marker:P,id:H,last_confirmed:O,iconClass:R}=M,B={type:"Feature",geometry:{type:"Point",coordinates:P.getLngLat().toArray()},properties:{icon:R,id:H}};return{id:H,marker_data:B,last_confirmed:O,update_user_id:d}}),{error:N}=await le.from("map_markers").upsert(L,{onConflict:"id"});if(N)throw new Error("Failed to update markers on server")}if(y.length>0){const L=y.map(M=>({id:M.id,deleted:!0,deleted_at:new Date().toISOString()})),{error:N}=await le.from("map_markers").upsert(L,{onConflict:"id"});if(N)throw new Error("Failed to delete markers on server");tr.update(M=>M.filter(P=>!y.some(H=>H.id===P.id)))}}async function S(){if(!_)throw new Error("No master map assigned");const{data:h,error:b}=await le.from("map_markers").select("id, marker_data, last_confirmed, deleted, deleted_at").eq("master_map_id",_);if(b)throw new Error("Failed to retrieve latest markers from server");return h.map(y=>({...y,iconClass:y.marker_data.properties.icon}))}function E(){const h=t;if(h.length>0){const b=new c;h.forEach(({marker:y})=>{b.extend(y.getLngLat())}),Zr.set(b)}else Zr.set(null)}return l.$$set=h=>{"map"in h&&r(0,m=h.map)},[m]}class fu extends ce{constructor(e){super(),ue(this,e,uu,null,se,{map:0})}}function fl(l){let e;return{c(){e=F("div"),this.h()},l(r){e=V(r,"DIV",{class:!0,style:!0}),q(e).forEach(w),this.h()},h(){D(e,"class","pulse-circle animate-pulse"),Ae(e,"width",l[1]),Ae(e,"height",l[1]),Ae(e,"border-radius","50%"),Ae(e,"background-color",l[0]),Ae(e,"box-shadow","0 0 0 10px "+l[0]),Ae(e,"position","absolute"),Ae(e,"top","50%"),Ae(e,"left","50%"),Ae(e,"transform","translate(-50%, -50%)"),Ae(e,"z-index","0")},m(r,t){U(r,e,t)},p(r,t){t&2&&Ae(e,"width",r[1]),t&2&&Ae(e,"height",r[1]),t&1&&Ae(e,"background-color",r[0]),t&1&&Ae(e,"box-shadow","0 0 0 10px "+r[0])},d(r){r&&w(e)}}}function du(l){let e,r,t,n;var o=l[6];function i(s,a){return{props:{bodyColor:s[3],size:s[2],swath:s[4]}}}o&&(r=Mt(o,i(l)));let c=l[5]&&fl(l);return{c(){e=F("div"),r&&Y(r.$$.fragment),t=Z(),c&&c.c(),this.h()},l(s){e=V(s,"DIV",{class:!0,style:!0});var a=q(e);r&&Q(r.$$.fragment,a),t=X(a),c&&c.l(a),a.forEach(w),this.h()},h(){D(e,"class","user-marker"),Ae(e,"position","relative"),Ae(e,"display","inline-block")},m(s,a){U(s,e,a),r&&G(r,e,null),A(e,t),c&&c.m(e,null),n=!0},p(s,[a]){if(a&64&&o!==(o=s[6])){if(r){de();const u=r;C(u.$$.fragment,1,0,()=>{W(u,1)}),he()}o?(r=Mt(o,i(s)),Y(r.$$.fragment),T(r.$$.fragment,1),G(r,e,t)):r=null}else if(o){const u={};a&8&&(u.bodyColor=s[3]),a&4&&(u.size=s[2]),a&16&&(u.swath=s[4]),r.$set(u)}s[5]?c?c.p(s,a):(c=fl(s),c.c(),c.m(e,null)):c&&(c.d(1),c=null)},i(s){n||(r&&T(r.$$.fragment,s),n=!0)},o(s){r&&C(r.$$.fragment,s),n=!1},d(s){s&&w(e),r&&W(r),c&&c.d()}}}function hu(l,e,r){let t,{pulseColor:n="rgba(172, 172, 230, 0.8)"}=e,{pulseSize:o="40px"}=e,{vehicleSize:i="60px"}=e,{userVehicle:c="tractor"}=e,{vehicleColor:s="yellow"}=e,{vehicleSwath:a=12}=e,{showPulse:u=!0}=e;return l.$$set=f=>{"pulseColor"in f&&r(0,n=f.pulseColor),"pulseSize"in f&&r(1,o=f.pulseSize),"vehicleSize"in f&&r(2,i=f.vehicleSize),"userVehicle"in f&&r(7,c=f.userVehicle),"vehicleColor"in f&&r(3,s=f.vehicleColor),"vehicleSwath"in f&&r(4,a=f.vehicleSwath),"showPulse"in f&&r(5,u=f.showPulse)},l.$$.update=()=>{l.$$.dirty&128&&r(6,t=It[c]||It.tractor)},[n,o,i,s,a,u,t,c]}class mu extends ce{constructor(e){super(),ue(this,e,hu,du,se,{pulseColor:0,pulseSize:1,vehicleSize:2,userVehicle:7,vehicleColor:3,vehicleSwath:4,showPulse:5})}}function gu(l){let e,r;return e=new qo({props:{size:20}}),{c(){Y(e.$$.fragment)},l(t){Q(e.$$.fragment,t)},m(t,n){G(e,t,n),r=!0},i(t){r||(T(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){W(e,t)}}}function _u(l){let e,r;return e=new Ql({props:{size:20,color:"black"}}),{c(){Y(e.$$.fragment)},l(t){Q(e.$$.fragment,t)},m(t,n){G(e,t,n),r=!0},i(t){r||(T(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){W(e,t)}}}function dl(l){let e,r,t,n,o,i="km/h";return{c(){e=F("div"),r=F("div"),t=_e(l[0]),n=Z(),o=F("div"),o.textContent=i,this.h()},l(c){e=V(c,"DIV",{class:!0,style:!0});var s=q(e);r=V(s,"DIV",{class:!0});var a=q(r);t=ge(a,l[0]),a.forEach(w),n=X(s),o=V(s,"DIV",{class:!0,"data-svelte-h":!0}),be(o)!=="svelte-11stotl"&&(o.textContent=i),s.forEach(w),this.h()},h(){D(r,"class","text-2xl font-bold"),D(o,"class","text-xs opacity-80"),D(e,"class","speed-fade-in fixed bottom-4 left-1/2 z-50 flex -translate-x-1/2 flex-col items-center rounded-lg bg-black/70 px-5 py-2.5 text-white backdrop-blur svelte-1p8pmuw"),Ae(e,"min-width","min-content")},m(c,s){U(c,e,s),A(e,r),A(r,t),A(e,n),A(e,o)},p(c,s){s&1&&Ve(t,c[0])},d(c){c&&w(e)}}}function pu(l){let e,r,t,n,o,i,c,s,a;const u=[_u,gu],f=[];function _(p,m){return p[1]?0:1}r=_(l),t=f[r]=u[r](l);let d=l[1]&&dl(l);return{c(){e=F("button"),t.c(),o=Z(),d&&d.c(),i=ne(),this.h()},l(p){e=V(p,"BUTTON",{class:!0,style:!0,"aria-label":!0});var m=q(e);t.l(m),m.forEach(w),o=X(p),d&&d.l(p),i=ne(),this.h()},h(){D(e,"class","btn btn-circle fixed bottom-20 left-6 z-50 flex h-10 w-10 items-center justify-center border-none bg-black/70 text-white backdrop-blur transition-all hover:scale-110 hover:bg-black/90"),Ae(e,"background",l[1]?"rgba(255, 255, 255, 0.9)":""),D(e,"aria-label",n=l[1]?"Hide speed":"Show speed"),St(e,"text-black",l[1])},m(p,m){U(p,e,m),f[r].m(e,null),U(p,o,m),d&&d.m(p,m),U(p,i,m),c=!0,s||(a=Se(e,"click",l[2]),s=!0)},p(p,[m]){let g=r;r=_(p),r!==g&&(de(),C(f[g],1,1,()=>{f[g]=null}),he(),t=f[r],t||(t=f[r]=u[r](p),t.c()),T(t,1),t.m(e,null)),(!c||m&2)&&Ae(e,"background",p[1]?"rgba(255, 255, 255, 0.9)":""),(!c||m&2&&n!==(n=p[1]?"Hide speed":"Show speed"))&&D(e,"aria-label",n),(!c||m&2)&&St(e,"text-black",p[1]),p[1]?d?d.p(p,m):(d=dl(p),d.c(),d.m(i.parentNode,i)):d&&(d.d(1),d=null)},i(p){c||(T(t),c=!0)},o(p){C(t),c=!1},d(p){p&&(w(e),w(o),w(i)),f[r].d(),d&&d.d(p),s=!1,a()}}}const bu=30;function hl(l,e,r,t){const n=l.getLngLat(),o=l.getRotation(),i=e-n.lng,c=r-n.lat;let s=t-o;s>180?s-=360:s<-180&&(s+=360);const a=1e3,u=performance.now();function f(_){const d=_-u,p=Math.min(d/a,1),m=p<.5?2*p*p:-1+(4-2*p)*p,g=n.lng+i*m,v=n.lat+c*m,$=o+s*m;l.setLngLat([g,v]).setRotation($),d<a&&requestAnimationFrame(f)}requestAnimationFrame(f)}function vu(l,e,r){let t,n,o;re(l,it,y=>r(16,t=y)),re(l,$t,y=>r(17,n=y)),re(l,Do,y=>r(18,o=y));let{map:i}=e,{disableAutoZoom:c=!1}=e,s,a,u=0,f=[],_=0,d=!1,p,m,g=null,v=null,$=null;function I(){r(1,d=!d)}Ge(()=>{console.log("Mounting VehicleTracker");const y=o.data.session;y&&y.user.id,s=new Ze.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0,showUserHeading:!0,showAccuracyCircle:!0,showUserLocation:!1,className:"custom-geolocate-control",fitBoundsOptions:{maxZoom:16}}),i.addControl(s,"bottom-right"),i.on("load",()=>{c||s.trigger()}),s.on("geolocate",L=>{console.log("Received geolocate event:",L);const{coords:N}=L;h(N)}),p=$t.subscribe(L=>{L.coordinates,S(L.vehicle_marker)}),m=vr.subscribe(k)}),gt(()=>{console.log("Unmounting VehicleTracker"),a&&a.remove(),p&&p(),m&&m()});function k(y){y.forEach(L=>{const{coordinates:N,heading:M,vehicle_marker:P,vehicle_id:H,update_types:O,is_trailing:R,last_update:z,full_name:B}=L,[J,K]=N.slice(1,-1).split(",").map(parseFloat),te=f.findIndex(j=>j.getElement().getAttribute("data-vehicle-id")===H);if(te!==-1){const j=f[te];if(O.includes("vehicle_marker_changed")){j.remove();const x=new Ze.Marker({element:E(P,!1,H),pitchAlignment:"map",rotationAlignment:"map"});x.setLngLat([J,K]).setRotation(M).addTo(i),f[te]=x}(O.includes("position_changed")||O.includes("heading_changed"))&&hl(j,J,K,M)}else{const j=new Ze.Marker({element:E(P,!1,H),pitchAlignment:"map",rotationAlignment:"map"});j.setLngLat([J,K]).setRotation(M).addTo(i),f.push(j)}Vl.update(j=>{const x=j.findIndex(me=>me.vehicle_id===H);if(x!==-1){const me=j[x];O.includes("trailing_status_changed")&&!O.includes("new_vehicle")&&oe.info("Trailing Status Changed",{description:`${B}'s ${P.type} has ${R?"started":"stopped"} trailing`,action:{label:"Locate",onClick:()=>{i.flyTo({center:[J,K],zoom:15,duration:1e3})}}}),j[x]={...me,...L}}else j.push(L);return j})})}function S(y){if(!(a&&$&&y.type===$.type&&y.bodyColor===$.bodyColor&&y.size===$.size&&y.swath===$.swath)&&(a&&a.remove(),a=new Ze.Marker({element:E(y,!0),pitchAlignment:"map",rotationAlignment:"map"}),n.coordinates)){const{latitude:L,longitude:N}=n.coordinates;a.setLngLat([N,L]).addTo(i),$={...y}}}function E(y,L=!1,N=null){const M=document.createElement("div");return M.setAttribute("data-vehicle-id",N),new mu({target:M,props:{pulseColor:"rgba(172, 172, 230, 0.8)",pulseSize:"40px",vehicleSize:y.size,userVehicle:y.type,vehicleColor:y.bodyColor,vehicleSwath:y.swath,showPulse:L}}),M}function h(y){const{latitude:L,longitude:N,heading:M,speed:P}=y;r(0,_=P?Math.round(P*3.6):0);const H=Date.now(),O={coordinates:{latitude:L,longitude:N},last_update:H,vehicle_marker:n.vehicle_marker},R=M!==null?Math.round(M):M;b(H,O,R)}function b(y,L,N){if(y-u>=bu){const{coordinates:M}=L,{bodyColor:P,swath:H}=L.vehicle_marker,{latitude:O,longitude:R}=M;if(t){const z={coordinates:{latitude:O,longitude:R},timestamp:y,color:P,swath:H};console.log("Saving location data:",z),Va.update(B=>[...B,z]),kr.set({coordinates:{latitude:O,longitude:R},timestamp:y})}if(!g||g.latitude!==O||g.longitude!==R||v!==N){let z="";if(!g)z+="Initial coordinates. ";else{if(g.latitude!==O){const B=O-g.latitude;z+=`Latitude changed by ${B.toFixed(6)}. `}if(g.longitude!==R){const B=R-g.longitude;z+=`Longitude changed by ${B.toFixed(6)}. `}}if(v!==N){const B=N-v;z+=`Heading changed by ${B.toFixed(2)}.`}console.log("Changes detected:",z),$t.update(B=>({...B,coordinates:L.coordinates,last_update:L.last_update,vehicle_marker:L.vehicle_marker,heading:N})),a&&a.getLngLat()&&hl(a,R,O,N),g={latitude:O,longitude:R},v=N}u=y}}return l.$$set=y=>{"map"in y&&r(3,i=y.map),"disableAutoZoom"in y&&r(4,c=y.disableAutoZoom)},[_,d,I,i,c]}class wu extends ce{constructor(e){super(),ue(this,e,vu,pu,se,{map:3,disableAutoZoom:4})}}const ku=1e4;function Ur(l,e){return l.map(t=>{const n=e.find(i=>i.vehicle_id===t.vehicle_id),o={vehicle_id:t.vehicle_id,coordinates:t.coordinates,heading:t.heading,vehicle_marker:t.vehicle_marker,is_trailing:t.is_trailing,last_update:t.last_update,full_name:t.full_name||(n==null?void 0:n.full_name),update_types:[]};if(!n)o.update_types.push("new_vehicle");else{const i=JSON.stringify(t.vehicle_marker)!==JSON.stringify(n.vehicle_marker),c=t.coordinates!==n.coordinates,s=t.heading!==n.heading,a=t.is_trailing!==n.is_trailing,u=t.last_update!==n.last_update;i&&o.update_types.push("vehicle_marker_changed"),c&&o.update_types.push("position_changed"),s&&o.update_types.push("heading_changed"),a&&o.update_types.push("trailing_status_changed"),u&&o.update_types.push("last_update_changed")}return o}).filter(t=>t.update_types.length>0)}function yu(l,e,r){let t,n,o,i;re(l,Vl,m=>r(4,t=m)),re(l,mr,m=>r(5,n=m)),re(l,$r,m=>r(6,o=m)),re(l,it,m=>r(7,i=m));let c=null,s,a=0,u=null;async function f(m){const{data:g,error:v}=await le.from("vehicle_state").select("*").eq("vehicle_id",m).single();return v?(console.error("Error fetching user vehicle data:",v),null):g}async function _(m,g){const{data:v,error:$}=await le.from("vehicle_state").select(`
          *,
          profiles:vehicle_id (full_name)
        `).eq("master_map_id",m);return console.log("Vehicles:",v),$?(console.error("Error retrieving initial vehicle data:",$),[]):v.filter(I=>I.vehicle_id!==g).map(I=>({...I,full_name:I.profiles.full_name}))}async function d(m){const g=o.id,v=o.master_map_id,{coordinates:$,last_update:I,heading:k,vehicle_marker:S}=m;if(!$){console.warn("Coordinates not available. Skipping vehicle state update.");return}const E={vehicle_id:g,master_map_id:v,coordinates:`(${$.longitude},${$.latitude})`,last_update:new Date(I).toISOString(),is_trailing:i,vehicle_marker:S,heading:k!==null?k:null};try{await c.send({type:"broadcast",event:"vehicle_update",payload:E})}catch(h){console.error("Error broadcasting vehicle state:",h)}}async function p(m,g=!1){const v=o.id,$=o.master_map_id,{coordinates:I,last_update:k,heading:S,vehicle_marker:E}=m;if(!I){console.warn("Coordinates not available. Skipping database update.");return}const h=u&&(JSON.stringify(m.vehicle_marker)!==JSON.stringify(u.vehicle_marker)||m.is_trailing!==u.is_trailing),b=Date.now();if(!(g||h||a===0||b-a>=ku))return;const L={vehicle_id:v,master_map_id:$,coordinates:`(${I.longitude},${I.latitude})`,last_update:new Date(k).toISOString(),is_trailing:i,vehicle_marker:E,heading:S!==null?S:null},{data:N,error:M}=await le.from("vehicle_state").upsert(L).single();M?console.error("Error updating vehicle state in database:",M):(console.log("Database updated successfully"),a=b),u={...m}}return Ge(async()=>{console.log("Initializing VehicleStateSynchronizer");const m=o.id,g=o.master_map_id,v=await f(m);if(v){const[k,S]=v.coordinates.slice(1,-1).split(",").map(parseFloat);$t.update(E=>({...E,...v,coordinates:{latitude:S,longitude:k}}))}const $=await _(g,m);console.log("Initial vehicle data:",$),mr.set($);const I=Ur(n,t);vr.set(I),c=le.channel(`vehicle_updates_${g}`).on("broadcast",{event:"vehicle_update"},k=>{if(k.payload.vehicle_id!==m){mr.update(E=>{const h=E.findIndex(b=>b.vehicle_id===k.payload.vehicle_id);return h!==-1?E[h]={...E[h],...k.payload,full_name:E[h].full_name}:(console.log("pushing new vehicle",k.payload),E.push(k.payload)),E});const S=Ur(n,t);vr.set(S)}}).on("postgres_changes",{event:"*",schema:"public",table:"vehicle_state",filter:`master_map_id=eq.${g}`},k=>{if(k.new.vehicle_id!==m){mr.update(E=>{const h=E.findIndex(b=>b.vehicle_id===k.new.vehicle_id);return h!==-1?E[h]={...E[h],...k.new,full_name:E[h].full_name}:(console.log("pushing new vehicle from DB change",k.new),E.push(k.new)),E});const S=Ur(n,t);vr.set(S)}}).subscribe(),s=$t.subscribe(async k=>{console.log("Broadcasting vehicle state:",k),await d(k),await p(k)}),La.set(!0)}),gt(()=>{c&&le.removeChannel(c),s&&s()}),[]}class Tu extends ce{constructor(e){super(),ue(this,e,yu,null,se,{})}}function Kr(l){if(!l)throw new Error("coord is required");if(!Array.isArray(l)){if(l.type==="Feature"&&l.geometry!==null&&l.geometry.type==="Point")return[...l.geometry.coordinates];if(l.type==="Point")return[...l.coordinates]}if(Array.isArray(l)&&l.length>=2&&!Array.isArray(l[0])&&!Array.isArray(l[1]))return[...l];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Eu(l){return l.type==="Feature"?l.geometry:l}function Cu(l,e,r={}){var t=Kr(l),n=Kr(e),o=gr(n[1]-t[1]),i=gr(n[0]-t[0]),c=gr(t[1]),s=gr(n[1]),a=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(c)*Math.cos(s);return Oo(2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)),r.units)}function Su(l,e={}){if(l.bbox!=null&&e.recompute!==!0)return l.bbox;const r=[1/0,1/0,-1/0,-1/0];return wr(l,t=>{r[0]>t[0]&&(r[0]=t[0]),r[1]>t[1]&&(r[1]=t[1]),r[2]<t[0]&&(r[2]=t[0]),r[3]<t[1]&&(r[3]=t[1])}),r}const vt=11102230246251565e-32,je=134217729,$u=(3+8*vt)*vt;function Rr(l,e,r,t,n){let o,i,c,s,a=e[0],u=t[0],f=0,_=0;u>a==u>-a?(o=a,a=e[++f]):(o=u,u=t[++_]);let d=0;if(f<l&&_<r)for(u>a==u>-a?(i=a+o,c=o-(i-a),a=e[++f]):(i=u+o,c=o-(i-u),u=t[++_]),o=i,c!==0&&(n[d++]=c);f<l&&_<r;)u>a==u>-a?(i=o+a,s=i-o,c=o-(i-s)+(a-s),a=e[++f]):(i=o+u,s=i-o,c=o-(i-s)+(u-s),u=t[++_]),o=i,c!==0&&(n[d++]=c);for(;f<l;)i=o+a,s=i-o,c=o-(i-s)+(a-s),a=e[++f],o=i,c!==0&&(n[d++]=c);for(;_<r;)i=o+u,s=i-o,c=o-(i-s)+(u-s),u=t[++_],o=i,c!==0&&(n[d++]=c);return(o!==0||d===0)&&(n[d++]=o),d}function Mu(l,e){let r=e[0];for(let t=1;t<l;t++)r+=e[t];return r}function ir(l){return new Float64Array(l)}const Iu=(3+16*vt)*vt,Lu=(2+12*vt)*vt,Au=(9+64*vt)*vt*vt,Rt=ir(4),ml=ir(8),gl=ir(12),_l=ir(16),Ye=ir(4);function Pu(l,e,r,t,n,o,i){let c,s,a,u,f,_,d,p,m,g,v,$,I,k,S,E,h,b;const y=l-n,L=r-n,N=e-o,M=t-o;k=y*M,_=je*y,d=_-(_-y),p=y-d,_=je*M,m=_-(_-M),g=M-m,S=p*g-(k-d*m-p*m-d*g),E=N*L,_=je*N,d=_-(_-N),p=N-d,_=je*L,m=_-(_-L),g=L-m,h=p*g-(E-d*m-p*m-d*g),v=S-h,f=S-v,Rt[0]=S-(v+f)+(f-h),$=k+v,f=$-k,I=k-($-f)+(v-f),v=I-E,f=I-v,Rt[1]=I-(v+f)+(f-E),b=$+v,f=b-$,Rt[2]=$-(b-f)+(v-f),Rt[3]=b;let P=Mu(4,Rt),H=Lu*i;if(P>=H||-P>=H||(f=l-y,c=l-(y+f)+(f-n),f=r-L,a=r-(L+f)+(f-n),f=e-N,s=e-(N+f)+(f-o),f=t-M,u=t-(M+f)+(f-o),c===0&&s===0&&a===0&&u===0)||(H=Au*i+$u*Math.abs(P),P+=y*u+M*c-(N*a+L*s),P>=H||-P>=H))return P;k=c*M,_=je*c,d=_-(_-c),p=c-d,_=je*M,m=_-(_-M),g=M-m,S=p*g-(k-d*m-p*m-d*g),E=s*L,_=je*s,d=_-(_-s),p=s-d,_=je*L,m=_-(_-L),g=L-m,h=p*g-(E-d*m-p*m-d*g),v=S-h,f=S-v,Ye[0]=S-(v+f)+(f-h),$=k+v,f=$-k,I=k-($-f)+(v-f),v=I-E,f=I-v,Ye[1]=I-(v+f)+(f-E),b=$+v,f=b-$,Ye[2]=$-(b-f)+(v-f),Ye[3]=b;const O=Rr(4,Rt,4,Ye,ml);k=y*u,_=je*y,d=_-(_-y),p=y-d,_=je*u,m=_-(_-u),g=u-m,S=p*g-(k-d*m-p*m-d*g),E=N*a,_=je*N,d=_-(_-N),p=N-d,_=je*a,m=_-(_-a),g=a-m,h=p*g-(E-d*m-p*m-d*g),v=S-h,f=S-v,Ye[0]=S-(v+f)+(f-h),$=k+v,f=$-k,I=k-($-f)+(v-f),v=I-E,f=I-v,Ye[1]=I-(v+f)+(f-E),b=$+v,f=b-$,Ye[2]=$-(b-f)+(v-f),Ye[3]=b;const R=Rr(O,ml,4,Ye,gl);k=c*u,_=je*c,d=_-(_-c),p=c-d,_=je*u,m=_-(_-u),g=u-m,S=p*g-(k-d*m-p*m-d*g),E=s*a,_=je*s,d=_-(_-s),p=s-d,_=je*a,m=_-(_-a),g=a-m,h=p*g-(E-d*m-p*m-d*g),v=S-h,f=S-v,Ye[0]=S-(v+f)+(f-h),$=k+v,f=$-k,I=k-($-f)+(v-f),v=I-E,f=I-v,Ye[1]=I-(v+f)+(f-E),b=$+v,f=b-$,Ye[2]=$-(b-f)+(v-f),Ye[3]=b;const z=Rr(R,gl,4,Ye,_l);return _l[z-1]}function Du(l,e,r,t,n,o){const i=(e-o)*(r-n),c=(l-n)*(t-o),s=i-c,a=Math.abs(i+c);return Math.abs(s)>=Iu*a?s:-Pu(l,e,r,t,n,o,a)}function Ou(l,e){var r,t,n=0,o,i,c,s,a,u,f,_=l[0],d=l[1],p=e.length;for(r=0;r<p;r++){t=0;var m=e[r],g=m.length-1;if(u=m[0],u[0]!==m[g][0]&&u[1]!==m[g][1])throw new Error("First and last coordinates in a ring must be the same");for(i=u[0]-_,c=u[1]-d,t;t<g;t++){if(f=m[t+1],s=f[0]-_,a=f[1]-d,c===0&&a===0){if(s<=0&&i>=0||i<=0&&s>=0)return 0}else if(a>=0&&c<=0||a<=0&&c>=0){if(o=Du(i,s,c,a,0,0),o===0)return 0;(o>0&&a>0&&c<=0||o<0&&a<=0&&c>0)&&n++}u=f,c=a,i=s}}return n%2!==0}function Qr(l,e,r={}){if(!l)throw new Error("point is required");if(!e)throw new Error("polygon is required");const t=Kr(l),n=Eu(e),o=n.type,i=e.bbox;let c=n.coordinates;if(i&&Nu(t,i)===!1)return!1;o==="Polygon"&&(c=[c]);let s=!1;for(var a=0;a<c.length;++a){const u=Ou(t,c[a]);if(u===0)return!r.ignoreBoundary;u&&(s=!0)}return s}function Nu(l,e){return e[0]<=l[0]&&e[1]<=l[1]&&e[2]>=l[0]&&e[3]>=l[1]}function xr(l,e={}){const r=Su(l),t=(r[0]+r[2])/2,n=(r[1]+r[3])/2;return rr([t,n],e.properties,e)}function zu(l){if(!l)throw new Error("geojson is required");switch(l.type){case"Feature":return uo(l);case"FeatureCollection":return Vu(l);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return sn(l);default:throw new Error("unknown GeoJSON type")}}function uo(l){const e={type:"Feature"};return Object.keys(l).forEach(r=>{switch(r){case"type":case"properties":case"geometry":return;default:e[r]=l[r]}}),e.properties=fo(l.properties),l.geometry==null?e.geometry=null:e.geometry=sn(l.geometry),e}function fo(l){const e={};return l&&Object.keys(l).forEach(r=>{const t=l[r];typeof t=="object"?t===null?e[r]=null:Array.isArray(t)?e[r]=t.map(n=>n):e[r]=fo(t):e[r]=t}),e}function Vu(l){const e={type:"FeatureCollection"};return Object.keys(l).forEach(r=>{switch(r){case"type":case"features":return;default:e[r]=l[r]}}),e.features=l.features.map(r=>uo(r)),e}function sn(l){const e={type:l.type};return l.bbox&&(e.bbox=l.bbox),l.type==="GeometryCollection"?(e.geometries=l.geometries.map(r=>sn(r)),e):(e.coordinates=ho(l.coordinates),e)}function ho(l){const e=l;return typeof e[0]!="object"?e.slice():e.map(r=>ho(r))}function Fu(l){const e=[];return l.type==="FeatureCollection"?xl(l,function(r){wr(r,function(t){e.push(rr(t,r.properties))})}):l.type==="Feature"?wr(l,function(r){e.push(rr(r,l.properties))}):wr(l,function(r){e.push(rr(r))}),yr(e)}var Bu=Object.defineProperty,Uu=Object.defineProperties,Ru=Object.getOwnPropertyDescriptors,pl=Object.getOwnPropertySymbols,qu=Object.prototype.hasOwnProperty,Hu=Object.prototype.propertyIsEnumerable,bl=(l,e,r)=>e in l?Bu(l,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):l[e]=r,vl=(l,e)=>{for(var r in e||(e={}))qu.call(e,r)&&bl(l,r,e[r]);if(pl)for(var r of pl(e))Hu.call(e,r)&&bl(l,r,e[r]);return l},wl=(l,e)=>Uu(l,Ru(e));function ju(l,e,r={}){if(!l)throw new Error("targetPoint is required");if(!e)throw new Error("points is required");let t=1/0,n=0;xl(e,(i,c)=>{const s=Cu(l,i,r);s<t&&(n=c,t=s)});const o=zu(e.features[n]);return wl(vl({},o),{properties:wl(vl({},o.properties),{featureIndex:n,distanceToPoint:t})})}function kl(l){const e=Wu(l),r=xr(e);let t=!1,n=0;for(;!t&&n<e.features.length;){const o=e.features[n].geometry;let i,c,s,a,u,f,_=!1;if(o.type==="Point")r.geometry.coordinates[0]===o.coordinates[0]&&r.geometry.coordinates[1]===o.coordinates[1]&&(t=!0);else if(o.type==="MultiPoint"){let d=!1,p=0;for(;!d&&p<o.coordinates.length;)r.geometry.coordinates[0]===o.coordinates[p][0]&&r.geometry.coordinates[1]===o.coordinates[p][1]&&(t=!0,d=!0),p++}else if(o.type==="LineString"){let d=0;for(;!_&&d<o.coordinates.length-1;)i=r.geometry.coordinates[0],c=r.geometry.coordinates[1],s=o.coordinates[d][0],a=o.coordinates[d][1],u=o.coordinates[d+1][0],f=o.coordinates[d+1][1],yl(i,c,s,a,u,f)&&(_=!0,t=!0),d++}else if(o.type==="MultiLineString"){let d=0;for(;d<o.coordinates.length;){_=!1;let p=0;const m=o.coordinates[d];for(;!_&&p<m.length-1;)i=r.geometry.coordinates[0],c=r.geometry.coordinates[1],s=m[p][0],a=m[p][1],u=m[p+1][0],f=m[p+1][1],yl(i,c,s,a,u,f)&&(_=!0,t=!0),p++;d++}}else(o.type==="Polygon"||o.type==="MultiPolygon")&&Qr(r,o)&&(t=!0);n++}if(t)return r;{const o=yr([]);for(let i=0;i<e.features.length;i++)o.features=o.features.concat(Fu(e.features[i]).features);return rr(ju(r,o).geometry.coordinates)}}function Wu(l){return l.type!=="FeatureCollection"?l.type!=="Feature"?yr([No(l)]):yr([l]):l}function yl(l,e,r,t,n,o){const i=Math.sqrt((n-r)*(n-r)+(o-t)*(o-t)),c=Math.sqrt((l-r)*(l-r)+(e-t)*(e-t)),s=Math.sqrt((n-l)*(n-l)+(o-e)*(o-e));return i===c+s}function Gu(l,e,r){let t;re(l,Xr,s=>r(1,t=s));let{map:n}=e;function o(s){if(console.log("Calculating bounding box for",s.length,"fields"),s.length===0)return console.warn("No fields to calculate bounding box"),null;const a=new Ze.LngLatBounds;return s.forEach((u,f)=>{(u.boundary.type==="Polygon"?u.boundary.coordinates[0]:u.boundary.coordinates.flat(1)).forEach(([d,p],m)=>{if(isNaN(d)||isNaN(p)){console.warn(`Invalid coordinate at field ${f}, coordinate ${m}: [${d}, ${p}]`);return}a.extend(new Ze.LngLat(d,p))})}),a.isEmpty()?(console.warn("Unable to calculate valid bounding box"),null):(console.log("Calculated bounding box:",a.toArray()),a)}function i(){if(n.getLayer("fields-labels")){const s=n.getZoom();n.removeLayer("fields-labels"),n.addLayer({id:"fields-labels",type:"symbol",source:"label-points",layout:{"text-field":["get","name"],"text-anchor":"center","symbol-sort-key":-1,"text-font":["DIN Pro Bold","Arial Unicode MS Bold"],"text-size":["interpolate",["linear"],["zoom"],10,0,11,8,13,12,15,28,17,48,19,96,20,120],"text-allow-overlap":!0,"text-ignore-placement":!1},paint:{"text-color":"#ffffff","text-halo-color":"#000000","text-halo-width":2}}),n.setZoom(s)}}function c(){const s=vo(Xr);if(console.log("Loading fields from",t),s.length>0){const a={type:"FeatureCollection",features:s.map((_,d)=>({type:"Feature",geometry:_.boundary,properties:{id:d,area:_.area,name:_.name}}))},u={type:"FeatureCollection",features:s.flatMap((_,d)=>{try{if(_.boundary.type==="Polygon"){const p=pn(_.boundary.coordinates),m=xr(p);return[{type:"Feature",geometry:(Qr(m.geometry.coordinates,p)?m:kl(p)).geometry,properties:{id:d,name:_.name}}]}else return _.boundary.type==="MultiPolygon"?_.boundary.coordinates.map(p=>{const m=pn(p),g=xr(m);return{type:"Feature",geometry:(Qr(g.geometry.coordinates,m)?g:kl(m)).geometry,properties:{id:d,name:_.name}}}):(console.warn(`Invalid geometry type for field ${d}: ${_.boundary.type}`),[])}catch(p){return console.warn(`Error processing field ${d}:`,p),[]}}).filter(_=>_!==null)};n.addSource("fields",{type:"geojson",data:a}),n.addSource("label-points",{type:"geojson",data:u}),n.addLayer({id:"fields-fill",type:"fill",source:"fields",paint:{"fill-color":"#0080ff","fill-opacity":.2}}),n.addLayer({id:"fields-outline",type:"line",source:"fields",paint:{"line-color":"#bfffbf","line-opacity":.5,"line-width":2}}),n.addLayer({id:"fields-labels",type:"symbol",source:"label-points",layout:{"text-field":["get","name"],"text-anchor":"center","symbol-sort-key":-1,"text-font":["DIN Pro Bold","Arial Unicode MS Bold"],"text-size":["interpolate",["linear"],["zoom"],10,0,11,8,13,12,15,28,17,48,19,96,20,120],"text-allow-overlap":!0,"text-ignore-placement":!1},paint:{"text-color":"#ffffff","text-halo-color":"#000000","text-halo-width":2}}),setTimeout(()=>{i()},1e4),setTimeout(()=>{i()},2e4);const f=o(s);f?(io.set(f.toArray()),console.log("Stored field bounding box")):console.warn("Unable to calculate valid bounding box")}}return Ge(()=>{if(!n){console.error("Map is not available");return}return console.log("MapFields component mounted"),n.loaded()?c():n.on("load",c),()=>{n.off("load",c)}}),l.$$set=s=>{"map"in s&&r(0,n=s.map)},[n]}class Yu extends ce{constructor(e){super(),ue(this,e,Gu,null,se,{map:0})}}const Xu=300;function Tl(l,e){return l.reduce((r,t)=>{const n=t[e];return r[n]||(r[n]=[]),r[n].push(t),r},{})}const Zu={timeoutMinutes:24*60,closeStaleTrails:!0,notifyOnClose:!0};function Ju(l,e,r){const t=r.longitude-e.longitude,n=r.latitude-e.latitude;if(t===0&&n===0){const c=l.longitude-e.longitude,s=l.latitude-e.latitude;return Math.sqrt(c*c+s*s)}const o=Math.abs(n*l.longitude-t*l.latitude+r.longitude*e.latitude-r.latitude*e.longitude),i=Math.sqrt(t*t+n*n);return o/i}function en(l,e){if(l.length<=2)return l;let r=0,t=0;const n=l[0],o=l[l.length-1];for(let i=1;i<l.length-1;i++){const c=Ju(l[i],n,o);c>r&&(r=c,t=i)}if(r>e){const i=en(l.slice(0,t+1),e),c=en(l.slice(t),e);return[...i.slice(0,-1),...c]}else return[n,o]}async function mo(l,e,r){if(!r||r.length===0)return await le.rpc("close_trail",{trail_id_param:l,end_time_param:e,path_param:null,detailed_path_param:null});const n=`SRID=4326;LINESTRING M(${r.map(s=>`${s.longitude} ${s.latitude} ${s.timestamp}`).join(",")})`,c=`SRID=4326;LINESTRING(${en(r,5e-6).map(s=>`${s.longitude} ${s.latitude}`).join(",")})`;return await le.rpc("close_trail",{trail_id_param:l,end_time_param:e,path_param:c,detailed_path_param:n})}async function El(l,e){var s;console.log(`
Checking freshness for trail ${l}`),console.log(`Timeout threshold: ${e} minutes`);const{data:r,error:t}=await le.from("trail_stream").select("*").eq("trail_id",l).order("timestamp",{ascending:!1}).limit(1),n=new Date;let o,i;if(t||!((s=r==null?void 0:r[0])!=null&&s.timestamp)){const{data:a}=await le.from("trails").select("start_time").eq("id",l).single();i=(a==null?void 0:a.start_time)||n.toISOString(),o=new Date(i),console.log("No points found, using trail start time as last activity")}else i=r[0].timestamp,o=new Date(i),console.log("Using last point timestamp as last activity");const c=(n.getTime()-o.getTime())/(1e3*60);return console.log(`Current time: ${n.toISOString()}`),console.log(`Last activity time: ${o.toISOString()}`),console.log(`Minutes since last activity: ${c.toFixed(2)}`),console.log(`Is fresh: ${c<=e}
`),{isFresh:c<=e,lastTimestamp:i,lastPoint:r==null?void 0:r[0]}}async function tn(l){console.log(`Processing and closing trail ${l}`);const{data:e,error:r}=await le.from("trail_stream").select("*").eq("trail_id",l).order("timestamp",{ascending:!0});if(r)throw new Error(`Error fetching points for trail ${l}: ${r.message}`);if(!e||e.length<3)return console.log(`Trail ${l} has insufficient points (${(e==null?void 0:e.length)||0}), deleting`),await le.from("trail_stream").delete().eq("trail_id",l),await le.from("trails").delete().eq("id",l),{deleted:!0,reason:"insufficient_points"};const t=e.map(i=>({longitude:i.coordinate.coordinates[0],latitude:i.coordinate.coordinates[1],timestamp:new Date(i.timestamp).getTime()})),n=e[e.length-1].timestamp,o=await mo(l,n,t);if(o.error)throw new Error(`Failed to close trail: ${o.error.message}`);return{deleted:!1,closed:!0,message:"Trail closed successfully"}}async function Ku(l,e,r={}){console.log(`
Handling open trails for vehicle ${l}`);const t={...Zu,...r};let n=le.from("trails").select("*").eq("vehicle_id",l).is("end_time",null).order("start_time",{ascending:!1});const{data:o,error:i}=await n;if(i)throw new Error(`Error fetching open trails: ${i.message}`);if(!o||o.length===0)return console.log("No open trails found"),{mostRecentTrail:null,processedTrails:[]};console.log(`Found ${o.length} open trails`);let[c,...s]=o;const a=[],{isFresh:u,lastTimestamp:f,lastPoint:_}=await El(c.id,t.timeoutMinutes);if(!u&&t.closeStaleTrails){console.log(`Trail ${c.id} is stale, processing for closure`);const d=await tn(c.id);a.push({trail_id:c.id,result:d,reason:`Trail inactive for more than ${t.timeoutMinutes} minutes`,last_activity:f}),c=null}else u&&console.log(`Trail ${c.id} is still active`);for(const d of s){console.log(`
Processing older trail ${d.id}`);const{lastTimestamp:p}=await El(d.id,t.timeoutMinutes),m=await tn(d.id);a.push({trail_id:d.id,result:m,reason:"older_trail",last_activity:p})}return{mostRecentTrail:c,processedTrails:a,config:t,staleTrailClosed:!u&&t.closeStaleTrails,lastActivity:f}}const pt={async closeTrail(l){var e;try{console.log(`Closing trail ${l.trail_id}`);const{data:r}=await le.auth.getSession();if(!((e=r==null?void 0:r.session)!=null&&e.user))throw console.error("No authenticated user session"),new Error("Authentication required");const t=l.path.map(c=>({longitude:c.longitude,latitude:c.latitude,timestamp:c.timestamp})),{error:n}=await mo(l.trail_id,new Date().toISOString(),t);if(n)throw console.error("Error closing trail:",n),new Error(`Failed to close trail: ${n.message}`);const{data:o,error:i}=await le.from("trails").select("*").eq("id",l.trail_id).single();return i&&console.error("Error fetching updated trail:",i),{success:!0,trail:o||{id:l.trail_id,vehicle_id:l.vehicle_id,operation_id:l.operation_id,trail_color:l.trail_color,trail_width:l.trail_width}}}catch(r){return console.error("Error in closeTrail:",r),{error:!0,message:r.message||"Failed to close trail"}}},async loadMapTrails(l){var e;try{console.log("Loading trail data for master map ID:",l);const{data:r}=await le.auth.getSession();if(!((e=r==null?void 0:r.session)!=null&&e.user))throw console.error("No authenticated user session"),new Error("Authentication required");const t=r.session.user.id;if(!l)throw console.error("No master map ID provided"),new Error("Master map ID is required");const n=Date.now()-Xu*24*60*60*1e3;console.log("Fetching user trail data...");const{data:o,error:i}=await le.from("trail_data").select("*").eq("master_map_id",l).eq("vehicle_id",t).gte("timestamp",n).order("timestamp",{ascending:!0});if(i)throw console.error("Error fetching user trail data:",i),i;console.log(`Retrieved ${(o==null?void 0:o.length)||0} user trail data points`),console.log("Fetching other users' trail data...");const{data:c,error:s}=await le.rpc("get_other_trail_data",{p_master_map_id:l,p_user_id:t,p_retention_timestamp:n});if(s)throw console.error("Error fetching other trail data:",s),s;console.log(`Retrieved ${(c==null?void 0:c.length)||0} other trail data points`);const a=Tl(o||[],"vehicle_id"),u=Tl(c||[],"vehicle_id");return{user:a,other:u}}catch(r){return console.error("Error in loadMapTrails:",r),{error:!0,message:r.message||"An error occurred while loading trail data",user:{},other:{}}}},async checkOpenTrails(l,e){var r;try{console.log(`Checking open trails for vehicle ${l}`);const{data:t}=await le.auth.getSession();if(!((r=t==null?void 0:t.session)!=null&&r.user))throw console.error("No authenticated user session"),new Error("Authentication required");if(!l)throw new Error("Missing vehicle_id");const n=await Ku(l,void 0,{timeoutMinutes:e||30,closeStaleTrails:!0,notifyOnClose:!0}),{mostRecentTrail:o,processedTrails:i,staleTrailClosed:c,lastActivity:s}=n;if(c)return console.log("Trail was closed due to being stale, considering all trails inactive"),{openTrail:null,trailData:null,processedTrails:i,staleTrailClosed:c,lastActivity:s};if(o&&!c){console.log(`Fetching data for active trail ${o.id}`);const{data:a,error:u}=await le.from("trail_stream").select("coordinate, timestamp").eq("trail_id",o.id).order("timestamp",{ascending:!0});if(u)throw new Error(`Failed to fetch trail data: ${u.message}`);const f=a.map(_=>({coordinates:{latitude:_.coordinate.coordinates[1],longitude:_.coordinate.coordinates[0]},timestamp:new Date(_.timestamp).getTime()}));return{openTrail:o,trailData:f,processedTrails:i,staleTrailClosed:c,lastActivity:s}}return console.log("No active trails found"),{openTrail:null,trailData:null,processedTrails:i,staleTrailClosed:c,lastActivity:s}}catch(t){return console.error("Error in checkOpenTrails:",t),{error:!0,message:t.message||"An unexpected error occurred while checking open trails"}}},async checkOtherActiveTrails(l,e){var r;try{console.log(`Checking other active trails for operation ${l}`);const{data:t}=await le.auth.getSession();if(!((r=t==null?void 0:t.session)!=null&&r.user))throw console.error("No authenticated user session"),new Error("Authentication required");if(!l||!e)throw new Error("Missing required parameters");const{data:n,error:o}=await le.from("trails").select(`
                    id,
                    vehicle_id,
                    operation_id,
                    start_time,
                    end_time,
                    trail_color,
                    trail_width
                    `).eq("operation_id",l).neq("vehicle_id",e).is("end_time",null).order("start_time",{ascending:!1});if(o)throw o;const i=n.reduce((a,u)=>(a[u.vehicle_id]||(a[u.vehicle_id]=[]),a[u.vehicle_id].push(u),a),{}),c=[],s=[];for(const[a,u]of Object.entries(i)){if(u.length===0)continue;const[f,..._]=u;if(_.length>0){console.log(`Found ${_.length} additional open trails for vehicle ${a}`);for(const d of _){console.log(`Processing trail ${d.id} for vehicle ${a} (started at ${d.start_time})`);try{const p=await tn(d.id);p.deleted?console.log(`Deleted trail ${d.id} - ${p.reason}`):console.log(`Successfully closed trail ${d.id}`)}catch(p){const m=`Error processing trail ${d.id}: ${p.message}`;console.error(m),c.push(m)}}}try{const{data:d,error:p}=await le.from("trail_stream").select("coordinate, timestamp").eq("trail_id",f.id).order("timestamp",{ascending:!0});if(p){p.code==="57014"?c.push(`Timeout error while loading trail data for vehicle ${a}`):c.push(`Error loading trail data for vehicle ${a}: ${p.message}`);continue}const m=d.map(g=>({coordinates:{latitude:g.coordinate.coordinates[1],longitude:g.coordinate.coordinates[0]},timestamp:new Date(g.timestamp).getTime()}));s.push({...f,trailData:m})}catch(d){c.push(`Error processing trail data for vehicle ${a}: ${d.message}`)}}return{activeTrails:s,errors:c.length>0?c:void 0}}catch(t){return console.error("Error in checkOtherActiveTrails:",t),{error:!0,message:t.message||"Failed to fetch active trails",code:t==null?void 0:t.code}}},async deleteTrail(l){var e;try{console.log(`Deleting trail ${l}`);const{data:r}=await le.auth.getSession();if(!((e=r==null?void 0:r.session)!=null&&e.user))throw console.error("No authenticated user session"),new Error("Authentication required");const{error:t}=await le.from("trail_stream").delete().eq("trail_id",l);t&&console.error("Error deleting trail points:",t);const{error:n}=await le.from("trails").delete().eq("id",l);if(n)throw console.error("Error deleting trail:",n),new Error(`Failed to delete trail: ${n.message}`);return{success:!0,message:"Trail deleted successfully"}}catch(r){return console.error("Error in deleteTrail:",r),{error:!0,message:r.message||"Failed to delete trail"}}},async openNewTrail(l,e,r){var t,n,o;try{console.log(`Creating new trail for vehicle ${l} in operation ${e}`);const{data:i}=await le.auth.getSession();if(!((t=i==null?void 0:i.session)!=null&&t.user))throw console.error("No authenticated user session"),new Error("Authentication required");const s={id:crypto.randomUUID(),vehicle_id:l,operation_id:e,start_time:new Date().toISOString(),trail_color:((n=r.vehicle_marker)==null?void 0:n.bodyColor)||"#000000",trail_width:((o=r.vehicle_marker)==null?void 0:o.swath)||11},{data:a,error:u}=await le.from("trails").insert([s]).select("*");if(u)throw console.error("Error creating new trail:",u),new Error(`Failed to create new trail: ${u.message}`);if(!a||a.length===0)throw new Error("No trail data returned after creation");return{trail:a[0]}}catch(i){return console.error("Error in openNewTrail:",i),{error:!0,message:i.message||"Failed to create new trail"}}},async saveCoordinates(l,e,r){var t;try{console.log(`Saving ${r.length} coordinates for trail ${e}`);const{data:n}=await le.auth.getSession();if(!((t=n==null?void 0:n.session)!=null&&t.user))throw console.error("No authenticated user session"),new Error("Authentication required");if(!e||!r||r.length===0)throw new Error("Missing required fields");const o=r.map(({coordinates:s,timestamp:a})=>({operation_id:l,trail_id:e,coordinate:`POINT(${s.longitude} ${s.latitude})`,timestamp:new Date(a).toISOString()})),{data:i,error:c}=await le.from("trail_stream").insert(o).select();if(c)throw console.error("Error saving coordinates:",c),new Error(`Failed to save coordinates: ${c.message}`);return console.log(`Successfully saved ${i.length} coordinates`),{coordinates:i}}catch(n){return console.error("Error in saveCoordinates:",n),{error:!0,message:n.message||"Failed to save coordinates"}}}};function Cl(l){let e,r,t,n,o,i="Close",c,s,a;const u=[xu,Qu],f=[];function _(d,p){return d[5]?0:1}return r=_(l),t=f[r]=u[r](l),{c(){e=F("div"),t.c(),n=Z(),o=F("label"),o.textContent=i,this.h()},l(d){e=V(d,"DIV",{class:!0});var p=q(e);t.l(p),n=X(p),o=V(p,"LABEL",{class:!0,for:!0,"data-svelte-h":!0}),be(o)!=="svelte-jlumqq"&&(o.textContent=i),p.forEach(w),this.h()},h(){D(o,"class","modal-backdrop"),D(o,"for","end-trail-modal"),D(e,"class","modal modal-open")},m(d,p){U(d,e,p),f[r].m(e,null),A(e,n),A(e,o),c=!0,s||(a=Se(o,"click",l[7]),s=!0)},p(d,p){let m=r;r=_(d),r===m?f[r].p(d,p):(de(),C(f[m],1,1,()=>{f[m]=null}),he(),t=f[r],t?t.p(d,p):(t=f[r]=u[r](d),t.c()),T(t,1),t.m(e,n))},i(d){c||(T(t),c=!0)},o(d){C(t),c=!1},d(d){d&&w(e),f[r].d(),s=!1,a()}}}function Qu(l){let e,r,t="End Trail Submission",n,o,i,c,s="Start Time (UTC):",a,u=new Date(l[2].start_time).toUTCString()+"",f,_,d,p,m="Current Time (UTC):",g,v=l[1].toUTCString()+"",$,I,k,S,E="Duration:",h,b,y,L,N,M="Raw Time Difference (ms):",P,H,O,R,z,B="Trail Color:",J,K,te,j=l[2].trail_color+"",x,me,pe,Te,Me="Trail Width:",ae,ie=l[2].trail_width+"",Ie,fe,Pe,Ce,Re,Xt="Number of Coordinates:",Xe,wt=l[2].path.length+"",At,Vt,Ft,tt,st,Pt,Lr,Dt,kt,an="Submit Trail",Ar,yt,cn="Continue",Qe,Pr,un,qe=l[6].length>0&&Sl(l);return Pt=new eo({props:{size:20}}),{c(){e=F("div"),r=F("h3"),r.textContent=t,n=Z(),o=F("div"),i=F("p"),c=F("strong"),c.textContent=s,a=Z(),f=_e(u),_=Z(),d=F("p"),p=F("strong"),p.textContent=m,g=Z(),$=_e(v),I=Z(),k=F("p"),S=F("strong"),S.textContent=E,h=Z(),b=_e(l[4]),y=Z(),L=F("p"),N=F("strong"),N.textContent=M,P=Z(),H=_e(l[0]),O=Z(),R=F("p"),z=F("strong"),z.textContent=B,J=Z(),K=F("span"),te=Z(),x=_e(j),me=Z(),pe=F("p"),Te=F("strong"),Te.textContent=Me,ae=Z(),Ie=_e(ie),fe=_e("px"),Pe=Z(),Ce=F("p"),Re=F("strong"),Re.textContent=Xt,Xe=Z(),At=_e(wt),Vt=Z(),qe&&qe.c(),Ft=Z(),tt=F("div"),st=F("button"),Y(Pt.$$.fragment),Lr=Z(),Dt=F("div"),kt=F("button"),kt.textContent=an,Ar=Z(),yt=F("button"),yt.textContent=cn,this.h()},l(ze){e=V(ze,"DIV",{class:!0});var Be=q(e);r=V(Be,"H3",{class:!0,"data-svelte-h":!0}),be(r)!=="svelte-3agsw4"&&(r.textContent=t),n=X(Be),o=V(Be,"DIV",{class:!0});var He=q(o);i=V(He,"P",{});var sr=q(i);c=V(sr,"STRONG",{"data-svelte-h":!0}),be(c)!=="svelte-1ygkz80"&&(c.textContent=s),a=X(sr),f=ge(sr,u),sr.forEach(w),_=X(He),d=V(He,"P",{});var ar=q(d);p=V(ar,"STRONG",{"data-svelte-h":!0}),be(p)!=="svelte-65n9tn"&&(p.textContent=m),g=X(ar),$=ge(ar,v),ar.forEach(w),I=X(He),k=V(He,"P",{});var cr=q(k);S=V(cr,"STRONG",{"data-svelte-h":!0}),be(S)!=="svelte-1on1bp8"&&(S.textContent=E),h=X(cr),b=ge(cr,l[4]),cr.forEach(w),y=X(He),L=V(He,"P",{});var ur=q(L);N=V(ur,"STRONG",{"data-svelte-h":!0}),be(N)!=="svelte-1wg6fgl"&&(N.textContent=M),P=X(ur),H=ge(ur,l[0]),ur.forEach(w),O=X(He),R=V(He,"P",{});var Bt=q(R);z=V(Bt,"STRONG",{"data-svelte-h":!0}),be(z)!=="svelte-1au0zqn"&&(z.textContent=B),J=X(Bt),K=V(Bt,"SPAN",{class:!0,style:!0}),q(K).forEach(w),te=X(Bt),x=ge(Bt,j),Bt.forEach(w),me=X(He),pe=V(He,"P",{});var Zt=q(pe);Te=V(Zt,"STRONG",{"data-svelte-h":!0}),be(Te)!=="svelte-1uw2qy2"&&(Te.textContent=Me),ae=X(Zt),Ie=ge(Zt,ie),fe=ge(Zt,"px"),Zt.forEach(w),Pe=X(He),Ce=V(He,"P",{});var fr=q(Ce);Re=V(fr,"STRONG",{"data-svelte-h":!0}),be(Re)!=="svelte-kcko15"&&(Re.textContent=Xt),Xe=X(fr),At=ge(fr,wt),fr.forEach(w),Vt=X(He),qe&&qe.l(He),He.forEach(w),Ft=X(Be),tt=V(Be,"DIV",{class:!0});var dr=q(tt);st=V(dr,"BUTTON",{class:!0});var fn=q(st);Q(Pt.$$.fragment,fn),fn.forEach(w),Lr=X(dr),Dt=V(dr,"DIV",{});var hr=q(Dt);kt=V(hr,"BUTTON",{class:!0,"data-svelte-h":!0}),be(kt)!=="svelte-160kdpc"&&(kt.textContent=an),Ar=X(hr),yt=V(hr,"BUTTON",{class:!0,"data-svelte-h":!0}),be(yt)!=="svelte-txagx3"&&(yt.textContent=cn),hr.forEach(w),dr.forEach(w),Be.forEach(w),this.h()},h(){D(r,"class","text-lg font-bold"),D(K,"class","inline-block h-4 w-4"),Ae(K,"background-color",l[2].trail_color),D(o,"class","py-4"),D(st,"class","btn btn-square btn-error"),D(kt,"class","btn btn-primary ml-2"),D(yt,"class","btn ml-2"),D(tt,"class","modal-action flex justify-between"),D(e,"class","modal-box")},m(ze,Be){U(ze,e,Be),A(e,r),A(e,n),A(e,o),A(o,i),A(i,c),A(i,a),A(i,f),A(o,_),A(o,d),A(d,p),A(d,g),A(d,$),A(o,I),A(o,k),A(k,S),A(k,h),A(k,b),A(o,y),A(o,L),A(L,N),A(L,P),A(L,H),A(o,O),A(o,R),A(R,z),A(R,J),A(R,K),A(R,te),A(R,x),A(o,me),A(o,pe),A(pe,Te),A(pe,ae),A(pe,Ie),A(pe,fe),A(o,Pe),A(o,Ce),A(Ce,Re),A(Ce,Xe),A(Ce,At),A(o,Vt),qe&&qe.m(o,null),A(e,Ft),A(e,tt),A(tt,st),G(Pt,st,null),A(tt,Lr),A(tt,Dt),A(Dt,kt),A(Dt,Ar),A(Dt,yt),Qe=!0,Pr||(un=[Se(st,"click",l[8]),Se(kt,"click",l[11]),Se(yt,"click",l[7])],Pr=!0)},p(ze,Be){(!Qe||Be&4)&&u!==(u=new Date(ze[2].start_time).toUTCString()+"")&&Ve(f,u),(!Qe||Be&2)&&v!==(v=ze[1].toUTCString()+"")&&Ve($,v),(!Qe||Be&16)&&Ve(b,ze[4]),(!Qe||Be&1)&&Ve(H,ze[0]),(!Qe||Be&4)&&Ae(K,"background-color",ze[2].trail_color),(!Qe||Be&4)&&j!==(j=ze[2].trail_color+"")&&Ve(x,j),(!Qe||Be&4)&&ie!==(ie=ze[2].trail_width+"")&&Ve(Ie,ie),(!Qe||Be&4)&&wt!==(wt=ze[2].path.length+"")&&Ve(At,wt),ze[6].length>0?qe?qe.p(ze,Be):(qe=Sl(ze),qe.c(),qe.m(o,null)):qe&&(qe.d(1),qe=null)},i(ze){Qe||(T(Pt.$$.fragment,ze),Qe=!0)},o(ze){C(Pt.$$.fragment,ze),Qe=!1},d(ze){ze&&w(e),qe&&qe.d(),W(Pt),Pr=!1,mt(un)}}}function xu(l){let e,r,t="Confirm Delete Trail",n,o,i=`<p>Are you sure you want to delete this trail? This action cannot be
            undone.</p>`,c,s,a,u="Confirm Delete",f,_,d="Cancel",p,m;return{c(){e=F("div"),r=F("h3"),r.textContent=t,n=Z(),o=F("div"),o.innerHTML=i,c=Z(),s=F("div"),a=F("button"),a.textContent=u,f=Z(),_=F("button"),_.textContent=d,this.h()},l(g){e=V(g,"DIV",{class:!0});var v=q(e);r=V(v,"H3",{class:!0,"data-svelte-h":!0}),be(r)!=="svelte-1bidisu"&&(r.textContent=t),n=X(v),o=V(v,"DIV",{class:!0,"data-svelte-h":!0}),be(o)!=="svelte-1teiw7t"&&(o.innerHTML=i),c=X(v),s=V(v,"DIV",{class:!0});var $=q(s);a=V($,"BUTTON",{class:!0,"data-svelte-h":!0}),be(a)!=="svelte-1m4fmxi"&&(a.textContent=u),f=X($),_=V($,"BUTTON",{class:!0,"data-svelte-h":!0}),be(_)!=="svelte-1a5gsau"&&(_.textContent=d),$.forEach(w),v.forEach(w),this.h()},h(){D(r,"class","text-lg font-bold text-red-600"),D(o,"class","py-4"),D(a,"class","btn btn-error"),D(_,"class","btn"),D(s,"class","modal-action"),D(e,"class","modal-box")},m(g,v){U(g,e,v),A(e,r),A(e,n),A(e,o),A(e,c),A(e,s),A(s,a),A(s,f),A(s,_),p||(m=[Se(a,"click",l[10]),Se(_,"click",l[9])],p=!0)},p:$e,i:$e,o:$e,d(g){g&&w(e),p=!1,mt(m)}}}function Sl(l){let e,r,t,n=l[6].length+"",o,i;return{c(){e=F("div"),r=F("p"),t=_e("There are "),o=_e(n),i=_e(" unsaved trails pending sync"),this.h()},l(c){e=V(c,"DIV",{class:!0});var s=q(e);r=V(s,"P",{class:!0});var a=q(r);t=ge(a,"There are "),o=ge(a,n),i=ge(a," unsaved trails pending sync"),a.forEach(w),s.forEach(w),this.h()},h(){D(r,"class","text-yellow-800"),D(e,"class","mt-4 rounded bg-yellow-100 p-4")},m(c,s){U(c,e,s),A(e,r),A(r,t),A(r,o),A(r,i)},p(c,s){s&64&&n!==(n=c[6].length+"")&&Ve(o,n)},d(c){c&&w(e)}}}function ef(l){let e,r,t=l[3]&&l[2]&&Cl(l);return{c(){t&&t.c(),e=ne()},l(n){t&&t.l(n),e=ne()},m(n,o){t&&t.m(n,o),U(n,e,o),r=!0},p(n,[o]){n[3]&&n[2]?t?(t.p(n,o),o&12&&T(t,1)):(t=Cl(n),t.c(),T(t,1),t.m(e.parentNode,e)):t&&(de(),C(t,1,1,()=>{t=null}),he())},i(n){r||(T(t),r=!0)},o(n){C(t),r=!1},d(n){n&&w(e),t&&t.d(n)}}}function tf(l){const e=Math.floor(l/36e5),r=Math.floor(l%36e5/6e4),t=Math.floor(l%6e4/1e3);return`${e}h ${r}m ${t}s`}function rf(l,e,r){let t,n,o;re(l,ot,k=>r(2,t=k)),re(l,Qt,k=>r(6,n=k)),re(l,qt,k=>r(3,o=k));let i,c,s,a,u=!1;Ge(async()=>{await zl(),n.length>0&&_()}),gt(()=>{a&&clearInterval(a)});async function f(k){try{const S=await pt.deleteTrail(k);if(S.error)throw new Error(S.message||"Failed to delete trail");oe.success("Trail deleted successfully"),ot.set(null),it.set(!1),qt.set(!1),r(5,u=!1)}catch(S){console.error("Error deleting trail:",S),oe.error(`Failed to delete trail: ${S.message}`)}}function _(){a=setInterval(d,3e4)}async function d(){if(!n.length){clearInterval(a);return}console.log("Attempting to sync unsaved trails:",n.length);for(const k of n)try{const S=await pt.closeTrail(k);if(S.error)throw new Error(S.message||"Failed to close trail");Qt.remove(k),Ct.clear(),oe.success(`Successfully synced trail ${k.trail_id}`)}catch(S){console.error(`Error syncing trail: ${S.message}`),!S.message.includes("Failed to fetch")&&!S.message.includes("ERR_INTERNET_DISCONNECTED")&&(Qt.remove(k),oe.error(`Failed to sync trail ${k.trail_id}: ${S.message}`))}n.length===0&&clearInterval(a)}function p(){qt.set(!1),it.set(!0),r(5,u=!1)}function m(){r(5,u=!0)}function g(){r(5,u=!1)}async function v(){t&&await f(t.id)}async function $(){if(!t){oe.error("No active trail to close");return}console.log("Submitting trail data:",t);const k=t.path.map(E=>({latitude:E.coordinates.latitude,longitude:E.coordinates.longitude,timestamp:E.timestamp}));if(k.length===0||k.length===1){const E=k.length===0?"empty trail":"trail with only one coordinate";oe.info(`Deleting ${E}`),await pt.deleteTrail(t.id);return}const S={trail_id:t.id,vehicle_id:t.vehicle_id,operation_id:t.operation_id,path:k,trail_color:t.trail_color,trail_width:t.trail_width};try{const E=await pt.closeTrail(S);if(E.error)throw new Error(E.message||"Failed to close trail");const h={type:"LineString",coordinates:k.map(y=>[y.longitude,y.latitude])},b={...E.trail,path:h};lt.update(y=>[...y,b]),oe.success("Trail closed successfully"),console.log("Trail closed successfully:",E),Ct.clear(),ot.set(null),it.set(!1)}catch(E){console.error("Error closing trail:",E),E.message.includes("Failed to fetch")||E.message.includes("ERR_INTERNET_DISCONNECTED")?(oe.error("Device appears to be offline. Trail will be saved when connection is restored."),Qt.add(S),_()):oe.error(`Error closing trail: ${E.message}`),ot.set(null),it.set(!1)}qt.set(!1)}function I(){console.log("End trail event received in EndTrailModal"),qt.set(!0)}return l.$$.update=()=>{l.$$.dirty&15&&o&&t&&(r(1,s=new Date),r(0,i=s.getTime()-new Date(t.start_time).getTime()),r(4,c=tf(i)))},[i,s,t,o,c,u,n,p,m,g,v,$,I]}class nf extends ce{constructor(e){super(),ue(this,e,rf,ef,se,{triggerEndTrail:12})}get triggerEndTrail(){return this.$$.ctx[12]}}const lf=l=>({}),$l=l=>({calculateZoomDependentWidth:l[1],generateTrailIds:Et,deleteTrail:l[2]});function of(l){let e,r;const t=l[11].default,n=ve(t,l,l[10],$l);return{c(){e=_e(`svelte Copy\r
`),n&&n.c()},l(o){e=ge(o,`svelte Copy\r
`),n&&n.l(o)},m(o,i){U(o,e,i),n&&n.m(o,i),r=!0},p(o,[i]){n&&n.p&&(!r||i&1024)&&we(n,t,o,o[10],r?ye(t,o[10],i,lf):ke(o[10]),$l)},i(o){r||(T(n,o),r=!0)},o(o){C(n,o),r=!1},d(o){o&&w(e),n&&n.d(o)}}}function Et(l){return{sourceId:`trail-source-${l}`,layerId:`trail-layer-${l}`,highlightLayerId:`trail-highlight-${l}`,highlightBackgroundLayerId:`trail-highlight-bg-${l}`}}function Ml(l){const e="type"in l?l:xt(l);return{type:"Feature",properties:{},geometry:e}}function xt(l){return{type:"LineString",coordinates:[...l].sort((r,t)=>r.timestamp-t.timestamp).map(r=>[r.coordinates.longitude,r.coordinates.latitude])}}function sf(l,e,r){let t,n;re(l,lt,I=>r(14,t=I)),re(l,ot,I=>r(15,n=I));let{$$slots:o={},$$scope:i}=e;const c={MULTIPLIER:1,MIN_ZOOM:10,MAX_ZOOM:24,MIN_POWER:-6,MAX_POWER:8,DEFAULT_OPACITY:.5,LOAD_DELAY:10};let{map:s}=e,a=0;function u(I,k=1){return["interpolate",["exponential",2],["zoom"],c.MIN_ZOOM,["*",I*c.MULTIPLIER*k,["^",2,c.MIN_POWER]],c.MAX_ZOOM,["*",I*c.MULTIPLIER*k,["^",2,c.MAX_POWER]]]}function f(I){const{sourceId:k,layerId:S,highlightLayerId:E,highlightBackgroundLayerId:h}=Et(I);[E,h,S].forEach(y=>{s.getLayer(y)&&s.removeLayer(y)}),s.getSource(k)&&s.removeSource(k)}async function _(I){try{console.log(`Deleting trail: ${I}`);const k=await pt.deleteTrail(I);if(k.error)throw console.error("API returned error:",k.message),oe.error(`Failed to delete trail: ${k.message}`),new Error(k.message||"Failed to delete trail");return lt.update(S=>S.filter(E=>E.id!==I)),oe.success("Trail deleted successfully"),!0}catch(k){return console.error("Error deleting trail:",k),oe.error(`Error deleting trail: ${k.message||"Unknown error"}`),!1}}function d(I){const{sourceId:k,layerId:S}=Et(I.id),E=u(I.trail_width||3,1);s.addSource(k,{type:"geojson",data:Ml(I.path)}),s.addLayer({id:S,type:"line",source:k,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":I.trail_color||"#FF0000","line-width":E,"line-opacity":c.DEFAULT_OPACITY}})}function p(I){const{sourceId:k,layerId:S}=Et(I.id);if(n&&n.id!==I.id&&(console.log("Cleaning up old trail:",n.id),f(n.id)),s.getSource(k)){const E=s.getSource(k),h=xt(I.path),b=h.coordinates.length;if(b!==a){const y={type:"Feature",properties:{},geometry:h};E.setData(y),a=b}}else{console.log("Creating new trail source:",k);const E={...I,path:xt(I.path)};d(E)}}function m(I){const{sourceId:k,layerId:S}=Et(I.id);if(s.getSource(k)){const E=s.getSource(k),h=xt(I.path),b={type:"Feature",properties:{},geometry:h};E.setData(b)}else{console.log("Creating new trail source:",k);const E={...I,path:xt(I.path)};d(E)}}async function g(){console.log("Starting to load historical trails",{totalTrails:t.length,trails:t});for(let I=0;I<t.length;I++){const k=t[I];try{await d(k),await new Promise(S=>setTimeout(S,c.LOAD_DELAY))}catch(S){console.log(`Failed to load trail [${I+1}/${t.length}]:`,{trailId:k.id||"unknown",error:S,trailData:k}),console.error(`Failed to load trail [${I+1}/${t.length}]:`,{trailId:k.id||"unknown",error:S,trailData:k}),oe.error("Failed to load corrupt trail data. Please try refreshing.",{description:`Trail ${I+1}/${t.length} (ID: ${k.id||"unknown"})`})}}console.log("Finished loading historical trails")}let v={currentTrailUnsubscribe:null,otherActiveTrailsUnsubscribe:null,historicalTrailsUnsubscribe:null};Ge(()=>{g(),v.currentTrailUnsubscribe=ot.subscribe(k=>{k&&k.path&&p(k)}),v.otherActiveTrailsUnsubscribe=nt.subscribe(k=>{k&&k.forEach(S=>{S&&S.path&&m(S)})});let I=t;v.historicalTrailsUnsubscribe=lt.subscribe(k=>{I&&k&&I.filter(E=>!k.some(h=>h.id===E.id)).forEach(E=>{console.log("Deleting historical trail:",E.id),f(E.id)}),I=k})}),gt(()=>{console.log("Cleaning up trail subscriptions"),v.currentTrailUnsubscribe&&v.currentTrailUnsubscribe(),v.otherActiveTrailsUnsubscribe&&v.otherActiveTrailsUnsubscribe(),v.historicalTrailsUnsubscribe&&v.historicalTrailsUnsubscribe()});const $={addTrail:d,removeTrail:f,deleteTrail:_,reloadAll:g,updateCurrentTrail:p,generateTrailIds:Et,calculateZoomDependentWidth:u,createTrailGeoJSON:Ml};return l.$$set=I=>{"map"in I&&r(4,s=I.map),"$$scope"in I&&r(10,i=I.$$scope)},[Et,u,_,c,s,f,d,p,m,$,i,o]}class af extends ce{constructor(e){super(),ue(this,e,sf,of,se,{TRAIL_CONFIG:3,map:4,generateTrailIds:0,calculateZoomDependentWidth:1,removeTrail:5,deleteTrail:2,addTrail:6,updateCurrentTrail:7,updateOtherActiveTrail:8,trailManagerAPI:9})}get TRAIL_CONFIG(){return this.$$.ctx[3]}get generateTrailIds(){return Et}get calculateZoomDependentWidth(){return this.$$.ctx[1]}get removeTrail(){return this.$$.ctx[5]}get deleteTrail(){return this.$$.ctx[2]}get addTrail(){return this.$$.ctx[6]}get updateCurrentTrail(){return this.$$.ctx[7]}get updateOtherActiveTrail(){return this.$$.ctx[8]}get trailManagerAPI(){return this.$$.ctx[9]}}function cf(l){let e,r;return e=new wo({props:{size:20}}),{c(){Y(e.$$.fragment)},l(t){Q(e.$$.fragment,t)},m(t,n){G(e,t,n),r=!0},i(t){r||(T(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){W(e,t)}}}function uf(l){let e,r;return e=new Ql({props:{size:20,color:"black"}}),{c(){Y(e.$$.fragment)},l(t){Q(e.$$.fragment,t)},m(t,n){G(e,t,n),r=!0},i(t){r||(T(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){W(e,t)}}}function Il(l){let e,r,t,n,o,i,c,s,a,u,f,_,d,p,m;n=new Vo({props:{size:20}});let g=l[4].length>0&&Ll(l);return a=new Fo({props:{size:20}}),_=new eo({props:{size:20}}),{c(){e=F("div"),r=F("div"),t=F("button"),Y(n.$$.fragment),o=Z(),i=F("div"),g&&g.c(),c=Z(),s=F("button"),Y(a.$$.fragment),u=Z(),f=F("button"),Y(_.$$.fragment),this.h()},l(v){e=V(v,"DIV",{class:!0,style:!0});var $=q(e);r=V($,"DIV",{class:!0});var I=q(r);t=V(I,"BUTTON",{class:!0});var k=q(t);Q(n.$$.fragment,k),k.forEach(w),o=X(I),i=V(I,"DIV",{class:!0});var S=q(i);g&&g.l(S),S.forEach(w),c=X(I),s=V(I,"BUTTON",{class:!0});var E=q(s);Q(a.$$.fragment,E),E.forEach(w),u=X(I),f=V(I,"BUTTON",{class:!0});var h=q(f);Q(_.$$.fragment,h),h.forEach(w),I.forEach(w),$.forEach(w),this.h()},h(){D(t,"class","btn btn-circle h-10 w-10 shrink-0 border-none bg-white text-lg hover:bg-gray-100"),t.disabled=!1,D(i,"class","mx-1 truncate text-center text-sm text-white"),D(s,"class","btn btn-circle h-10 w-10 shrink-0 border-none bg-white text-lg hover:bg-gray-100"),s.disabled=!1,D(f,"class","btn btn-circle btn-error h-10 w-10 shrink-0 border-none hover:bg-error/90"),D(r,"class","flex items-center justify-between gap-x-[max(0.25rem,min(1rem,1.5vw))] p-[max(0.25rem,min(1rem,1.5vw))]"),D(e,"class","navigation-fade-in fixed bottom-4 left-1/2 flex -translate-x-1/2 items-center rounded-full bg-black/70 backdrop-blur svelte-3zmpjl"),Ae(e,"max-width","calc(70vw - 2rem)"),Ae(e,"min-width","min-content")},m(v,$){U(v,e,$),A(e,r),A(r,t),G(n,t,null),A(r,o),A(r,i),g&&g.m(i,null),A(r,c),A(r,s),G(a,s,null),A(r,u),A(r,f),G(_,f,null),d=!0,p||(m=[Se(t,"click",l[7]),Se(s,"click",l[8]),Se(f,"click",l[14])],p=!0)},p(v,$){v[4].length>0?g?g.p(v,$):(g=Ll(v),g.c(),g.m(i,null)):g&&(g.d(1),g=null)},i(v){d||(T(n.$$.fragment,v),T(a.$$.fragment,v),T(_.$$.fragment,v),d=!0)},o(v){C(n.$$.fragment,v),C(a.$$.fragment,v),C(_.$$.fragment,v),d=!1},d(v){v&&w(e),W(n),g&&g.d(),W(a),W(_),p=!1,mt(m)}}}function Ll(l){let e,r=l[0]+1+"",t,n,o=l[4].length+"",i;return{c(){e=_e("Trail "),t=_e(r),n=_e(" of "),i=_e(o)},l(c){e=ge(c,"Trail "),t=ge(c,r),n=ge(c," of "),i=ge(c,o)},m(c,s){U(c,e,s),U(c,t,s),U(c,n,s),U(c,i,s)},p(c,s){s&1&&r!==(r=c[0]+1+"")&&Ve(t,r),s&16&&o!==(o=c[4].length+"")&&Ve(i,o)},d(c){c&&(w(e),w(t),w(n),w(i))}}}function Al(l){let e,r,t,n="Delete Trail?",o,i,c=`Are you sure you want to delete this trail? This action cannot be\r
        undone.`,s,a,u,f="Cancel",_,d,p="Delete",m,g,v,$="close",I,k;return{c(){e=F("dialog"),r=F("div"),t=F("h3"),t.textContent=n,o=Z(),i=F("p"),i.textContent=c,s=Z(),a=F("div"),u=F("button"),u.textContent=f,_=Z(),d=F("button"),d.textContent=p,m=Z(),g=F("form"),v=F("button"),v.textContent=$,this.h()},l(S){e=V(S,"DIALOG",{class:!0});var E=q(e);r=V(E,"DIV",{class:!0});var h=q(r);t=V(h,"H3",{class:!0,"data-svelte-h":!0}),be(t)!=="svelte-ox39ht"&&(t.textContent=n),o=X(h),i=V(h,"P",{class:!0,"data-svelte-h":!0}),be(i)!=="svelte-uzgtjw"&&(i.textContent=c),s=X(h),a=V(h,"DIV",{class:!0});var b=q(a);u=V(b,"BUTTON",{class:!0,"data-svelte-h":!0}),be(u)!=="svelte-afpmp3"&&(u.textContent=f),_=X(b),d=V(b,"BUTTON",{class:!0,"data-svelte-h":!0}),be(d)!=="svelte-14b26fi"&&(d.textContent=p),b.forEach(w),h.forEach(w),m=X(E),g=V(E,"FORM",{method:!0,class:!0});var y=q(g);v=V(y,"BUTTON",{"data-svelte-h":!0}),be(v)!=="svelte-opg30q"&&(v.textContent=$),y.forEach(w),E.forEach(w),this.h()},h(){D(t,"class","text-lg font-bold"),D(i,"class","py-4"),D(u,"class","btn btn-ghost"),D(d,"class","btn btn-error"),D(a,"class","modal-action"),D(r,"class","modal-box"),D(g,"method","dialog"),D(g,"class","modal-backdrop"),D(e,"class","modal modal-open")},m(S,E){U(S,e,E),A(e,r),A(r,t),A(r,o),A(r,i),A(r,s),A(r,a),A(a,u),A(a,_),A(a,d),A(e,m),A(e,g),A(g,v),I||(k=[Se(u,"click",l[15]),Se(d,"click",l[5]),Se(v,"click",l[16])],I=!0)},p:$e,d(S){S&&w(e),I=!1,mt(k)}}}function ff(l){let e,r,t,n,o,i,c,s,a;const u=[uf,cf],f=[];function _(m,g){return m[1]?0:1}r=_(l),t=f[r]=u[r](l);let d=l[1]&&Il(l),p=l[2]&&l[3]&&Al(l);return{c(){e=F("button"),t.c(),n=Z(),d&&d.c(),o=Z(),p&&p.c(),i=ne(),this.h()},l(m){e=V(m,"BUTTON",{class:!0,style:!0});var g=q(e);t.l(g),g.forEach(w),n=X(m),d&&d.l(m),o=X(m),p&&p.l(m),i=ne(),this.h()},h(){D(e,"class","btn btn-circle fixed bottom-8 left-6 z-50 h-10 w-10 border-none bg-black/70 text-white backdrop-blur transition-transform hover:scale-110 hover:bg-black/80"),Ae(e,"background",l[1]?"rgba(255, 255, 255, 0.9)":""),St(e,"text-black",l[1])},m(m,g){U(m,e,g),f[r].m(e,null),U(m,n,g),d&&d.m(m,g),U(m,o,g),p&&p.m(m,g),U(m,i,g),c=!0,s||(a=Se(e,"click",l[6]),s=!0)},p(m,[g]){let v=r;r=_(m),r!==v&&(de(),C(f[v],1,1,()=>{f[v]=null}),he(),t=f[r],t||(t=f[r]=u[r](m),t.c()),T(t,1),t.m(e,null)),(!c||g&2)&&Ae(e,"background",m[1]?"rgba(255, 255, 255, 0.9)":""),(!c||g&2)&&St(e,"text-black",m[1]),m[1]?d?(d.p(m,g),g&2&&T(d,1)):(d=Il(m),d.c(),T(d,1),d.m(o.parentNode,o)):d&&(de(),C(d,1,1,()=>{d=null}),he()),m[2]&&m[3]?p?p.p(m,g):(p=Al(m),p.c(),p.m(i.parentNode,i)):p&&(p.d(1),p=null)},i(m){c||(T(t),T(d),c=!0)},o(m){C(t),C(d),c=!1},d(m){m&&(w(e),w(n),w(o),w(i)),f[r].d(),d&&d.d(m),p&&p.d(m),s=!1,a()}}}function df(l,e,r){let t;re(l,lt,P=>r(4,t=P));let{calculateZoomDependentWidth:n}=e,{generateTrailIds:o}=e,{deleteTrail:i}=e,{map:c}=e,s=0,a=!0,u=!1,f=!1,_=null;const d={FLIGHT_DURATION:2e3,HIGHLIGHT_WIDTH_MULTIPLIER:1.2,MAX_FLIGHT_ZOOM:19},p=[[0,4,3],[.5,4,2.5],[1,4,2],[1.5,4,1.5],[2,4,1],[2.5,4,.5],[3,4,0],[0,.5,3,3.5],[0,1,3,3],[0,1.5,3,2.5],[0,2,3,2],[0,2.5,3,1.5],[0,3,3,1],[0,3.5,3,.5]];async function m(){_&&await i(_.id)&&(r(2,f=!1),r(3,_=null),t.length===0?r(1,u=!1):(s>=t.length&&r(0,s=Math.max(0,t.length-1)),E(s)))}function g(){if(!t.length){oe.error("No trails available. Create some trails first!");return}if(r(1,u=!u),!u)t.forEach(P=>S(P.id));else if(t.length>0){const P=t[s];k(P),$(P)}}function v(P){const{sourceId:H,highlightLayerId:O}=o(P.id),R=P.trail_width*d.HIGHLIGHT_WIDTH_MULTIPLIER;c.addLayer({type:"line",source:H,id:O,paint:{"line-color":"white","line-width":n(R,1.5),"line-opacity":.8},layout:{"line-cap":"round","line-join":"round"}});const z=`${O}-inner`;return c.addLayer({type:"line",source:H,id:z,paint:{"line-color":P.trail_color,"line-width":n(R,.8),"line-opacity":1},layout:{"line-cap":"round","line-join":"round"}}),()=>{c.getLayer(O)&&c.removeLayer(O),c.getLayer(z)&&c.removeLayer(z)}}function $(P){const{sourceId:H,highlightBackgroundLayerId:O}=o(P.id);let R=0;const z=P.trail_width*d.HIGHLIGHT_WIDTH_MULTIPLIER,B=[.3,.4,.6,.8,1,.8,.6,.4];let J=null;if(!c.getSource(H))return;c.addLayer({type:"line",source:H,id:O,paint:{"line-color":P.trail_color,"line-width":n(z,2.2),"line-opacity":.3,"line-blur":n(z,.8)},layout:{"line-cap":"round","line-join":"bevel"}});function K(te){if(!a||!c){J&&cancelAnimationFrame(J);return}try{const j=parseInt(te/100%B.length);j!==R&&c.getLayer(O)&&(c.setPaintProperty(O,"line-opacity",B[R]),R=j),c.getLayer(O)&&(J=requestAnimationFrame(K))}catch{console.log("Animation stopped due to map cleanup"),J&&cancelAnimationFrame(J)}}return K(0),()=>{J&&cancelAnimationFrame(J)}}function I(P){const{sourceId:H,highlightLayerId:O,highlightBackgroundLayerId:R}=o(P.id);let z=0;const B=P.trail_width*d.HIGHLIGHT_WIDTH_MULTIPLIER,J=P.trail_color.match(/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i);let K=P.trail_color;if(J){const x=parseInt(J[1],16),me=parseInt(J[2],16),pe=parseInt(J[3],16);K=`rgb(${Math.min(x+80,255)}, ${Math.min(me+80,255)}, ${Math.min(pe+80,255)})`}const te=[.3,.4,.6,.8,1,.8,.6,.4];c.addLayer({type:"line",source:H,id:R,paint:{"line-color":P.trail_color,"line-width":n(B,2.2),"line-opacity":.3,"line-blur":n(B,.8)},layout:{"line-cap":"round","line-join":"bevel"}}),c.addLayer({type:"line",source:H,id:O,paint:{"line-color":K,"line-width":n(B,.8),"line-dasharray":p[0],"line-opacity":1},layout:{"line-cap":"butt","line-join":"bevel"}});function j(x){if(!a)return;const me=parseInt(x/100%te.length);try{me!==z&&(c!=null&&c.getLayer(R))&&(c.setPaintProperty(R,"line-opacity",te[z]),z=me),c!=null&&c.getLayer(R)&&requestAnimationFrame(j)}catch{console.log("Animation stopped due to map cleanup"),a=!1}}j(0)}function k(P){const H=P.path.coordinates,O=H.reduce((R,z)=>R.extend(z),new Ze.LngLatBounds(H[0],H[0]));c.fitBounds(O,{padding:50,duration:d.FLIGHT_DURATION,maxZoom:d.MAX_FLIGHT_ZOOM})}function S(P){const{highlightLayerId:H,highlightBackgroundLayerId:O}=o(P);try{c&&c.getLayer(H)&&c.removeLayer(H),c&&c.getLayer(O)&&c.removeLayer(O)}catch(R){console.log("Error removing highlight layers:",R)}}async function E(P){if(t.length===0)return;t.forEach(O=>S(O.id)),r(0,s=P),s>=t.length?r(0,s=0):s<0&&r(0,s=t.length-1);const H=t[s];k(H),$(H),await new Promise(O=>setTimeout(O,d.FLIGHT_DURATION))}function h(){E(s-1)}function b(){E(s+1)}const y={highlightTrail:I,glowTrail:$,outlineTrail:v,removeHighlight:S,flyToTrail:k,nextTrail:b,previousTrail:h,navigateToTrail:E};Ge(()=>()=>{a=!1});const L=()=>{r(3,_=t[s]),r(2,f=!0)},N=()=>r(2,f=!1),M=()=>r(2,f=!1);return l.$$set=P=>{"calculateZoomDependentWidth"in P&&r(9,n=P.calculateZoomDependentWidth),"generateTrailIds"in P&&r(10,o=P.generateTrailIds),"deleteTrail"in P&&r(11,i=P.deleteTrail),"map"in P&&r(12,c=P.map)},[s,u,f,_,t,m,g,h,b,n,o,i,c,y,L,N,M]}class hf extends ce{constructor(e){super(),ue(this,e,df,ff,se,{calculateZoomDependentWidth:9,generateTrailIds:10,deleteTrail:11,map:12,highlighterAPI:13})}get highlighterAPI(){return this.$$.ctx[13]}}function mf(l){let e,r,t;function n(i){l[3](i)}let o={map:l[2],calculateZoomDependentWidth:l[5],generateTrailIds:l[6],deleteTrail:l[7]};return l[1]!==void 0&&(o.highlighterAPI=l[1]),e=new hf({props:o}),Ue.push(()=>Sr(e,"highlighterAPI",n)),{c(){Y(e.$$.fragment)},l(i){Q(e.$$.fragment,i)},m(i,c){G(e,i,c),t=!0},p(i,c){const s={};c&4&&(s.map=i[2]),c&32&&(s.calculateZoomDependentWidth=i[5]),c&64&&(s.generateTrailIds=i[6]),c&128&&(s.deleteTrail=i[7]),!r&&c&2&&(r=!0,s.highlighterAPI=i[1],Cr(()=>r=!1)),e.$set(s)},i(i){t||(T(e.$$.fragment,i),t=!0)},o(i){C(e.$$.fragment,i),t=!1},d(i){W(e,i)}}}function gf(l){let e,r,t;function n(i){l[4](i)}let o={map:l[2],$$slots:{default:[mf,({calculateZoomDependentWidth:i,generateTrailIds:c,deleteTrail:s})=>({5:i,6:c,7:s}),({calculateZoomDependentWidth:i,generateTrailIds:c,deleteTrail:s})=>(i?32:0)|(c?64:0)|(s?128:0)]},$$scope:{ctx:l}};return l[0]!==void 0&&(o.trailManagerAPI=l[0]),e=new af({props:o}),Ue.push(()=>Sr(e,"trailManagerAPI",n)),{c(){Y(e.$$.fragment)},l(i){Q(e.$$.fragment,i)},m(i,c){G(e,i,c),t=!0},p(i,[c]){const s={};c&4&&(s.map=i[2]),c&486&&(s.$$scope={dirty:c,ctx:i}),!r&&c&1&&(r=!0,s.trailManagerAPI=i[0],Cr(()=>r=!1)),e.$set(s)},i(i){t||(T(e.$$.fragment,i),t=!0)},o(i){C(e.$$.fragment,i),t=!1},d(i){W(e,i)}}}function _f(l,e,r){let{map:t}=e,{trailManagerAPI:n}=e,{highlighterAPI:o}=e;function i(s){o=s,r(1,o)}function c(s){n=s,r(0,n)}return l.$$set=s=>{"map"in s&&r(2,t=s.map),"trailManagerAPI"in s&&r(0,n=s.trailManagerAPI),"highlighterAPI"in s&&r(1,o=s.highlighterAPI)},[n,o,t,i,c]}class pf extends ce{constructor(e){super(),ue(this,e,_f,gf,se,{map:2,trailManagerAPI:0,highlighterAPI:1})}}function Pl(l){let e,r;return e=new pf({props:{map:l[0]}}),{c(){Y(e.$$.fragment)},l(t){Q(e.$$.fragment,t)},m(t,n){G(e,t,n),r=!0},p(t,n){const o={};n&1&&(o.map=t[0]),e.$set(o)},i(t){r||(T(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){W(e,t)}}}function bf(l){let e,r,t,n,o;function i(a){l[4](a)}let c={};l[1]!==void 0&&(c.triggerEndTrail=l[1]),e=new nf({props:c}),Ue.push(()=>Sr(e,"triggerEndTrail",i));let s=l[2]&&Pl(l);return{c(){Y(e.$$.fragment),t=Z(),s&&s.c(),n=ne()},l(a){Q(e.$$.fragment,a),t=X(a),s&&s.l(a),n=ne()},m(a,u){G(e,a,u),U(a,t,u),s&&s.m(a,u),U(a,n,u),o=!0},p(a,[u]){const f={};!r&&u&2&&(r=!0,f.triggerEndTrail=a[1],Cr(()=>r=!1)),e.$set(f),a[2]?s?(s.p(a,u),u&4&&T(s,1)):(s=Pl(a),s.c(),T(s,1),s.m(n.parentNode,n)):s&&(de(),C(s,1,1,()=>{s=null}),he())},i(a){o||(T(e.$$.fragment,a),T(s),o=!0)},o(a){C(e.$$.fragment,a),C(s),o=!1},d(a){a&&(w(t),w(n)),W(e,a),s&&s.d(a)}}}const vf=5e3;function wf(l,e,r){let t,n,o,i,c,s,a,u;re(l,$t,z=>r(8,t=z)),re(l,Kl,z=>r(9,n=z)),re(l,$r,z=>r(10,o=z)),re(l,ot,z=>r(11,i=z)),re(l,Ct,z=>r(12,c=z)),re(l,nt,z=>r(13,s=z)),re(l,lt,z=>r(14,a=z)),re(l,it,z=>r(15,u=z));let{selectedOperation:f}=e,{map:_}=e,d,p,m=null,g=!1,v={trailingUnsubscribe:null,coordinateBufferUnsubscribe:null,unsavedCoordinatesUnsubscribe:null};Ge(async()=>{console.log(" TrailSynchronizer: Initializing..."),await zl(),await N(),await M(),await L(),v.trailingUnsubscribe=(()=>{let z=!0;return ln.subscribe(async B=>{if(z){z=!1;return}console.log("Pressed trailing button",B,"Trailing State:",u),u?u&&(console.log("Triggering end trail"),p()):(console.log("Handling trail creation"),await P())})})(),v.coordinateBufferUnsubscribe=kr.subscribe(z=>{z&&z.coordinates&&u&&k(z)}),v.unsavedCoordinatesUnsubscribe=Ct.subscribe(z=>{z.length>0&&!m?S():z.length===0&&m&&b()}),console.log("active trials",s),await $(),await I(),console.log(" TrailSynchronizer: Setup completed")}),gt(()=>{console.log(" TrailSynchronizer: Cleaning up resources"),v.trailingUnsubscribe&&v.trailingUnsubscribe(),v.coordinateBufferUnsubscribe&&v.coordinateBufferUnsubscribe(),v.unsavedCoordinatesUnsubscribe&&v.unsavedCoordinatesUnsubscribe(),d&&d.unsubscribe(),b(),it.set(!1)});async function $(){const z=o.id;console.log(" TrailSynchronizer: Subscribing to trail changes of operation",f.id,"and not vehicle:",z),d=le.channel("trail_changes").on("postgres_changes",{event:"INSERT",schema:"public",table:"trails",filter:`operation_id=eq.${f.id}`},B).on("postgres_changes",{event:"UPDATE",schema:"public",table:"trails",filter:`operation_id=eq.${f.id}`},J).on("postgres_changes",{event:"DELETE",schema:"public",table:"trails",filter:`operation_id=eq.${f.id}`},K).subscribe();function B(te){if(!te.new)return;const j=te.new;j.vehicle_id!==z&&(console.log(" New trail detected:",j.id),s!=null&&s.length||nt.set([]),nt.update((x=[])=>[...x,{id:j.id,vehicle_id:j.vehicle_id,operation_id:j.operation_id,start_time:j.start_time,end_time:j.end_time,task_id:j.task_id,trail_color:j.trail_color,trail_width:j.trail_width,path:[],detailed_path:j.detailed_path}]),console.log("active trails",s))}function J(te){if(console.log(" Trail update detected:",te),!te.new)return;const j=te.new;j.vehicle_id!==z&&(console.log(" Trail update detected:",j.id),s!=null&&s.length||nt.set([]),nt.update((x=[])=>{const me=x.findIndex(ae=>ae.id===j.id);if(me===-1)return x;const pe=x[me];console.log("Updating existing trail:",j.id);const Te={type:"LineString",coordinates:pe.path.map(ae=>[ae.coordinates.longitude,ae.coordinates.latitude])},Me={id:j.id,vehicle_id:j.vehicle_id,operation_id:j.operation_id,start_time:j.start_time,end_time:j.end_time,trail_color:j.trail_color,trail_width:j.trail_width,path:Te,detailed_path:j.detailed_path};return lt.update(ae=>[...ae,Me]),x.filter(ae=>ae.id!==j.id)}),console.log("active trails",s))}function K(te){if(console.log(" Trail deletion detected:",te),!te.old)return;const j=te.old;console.log(j.vehicle_id===z),j.vehicle_id!==z&&(console.log(" Trail deletion detected:",j.id),new Date(j.start_time),new Date(j.end_time),oe.info("Trail deleted by another user",{description:`${j.trail_width}m ${j.trail_color.toLowerCase()} trail`}),s!=null&&s.length&&nt.update((x=[])=>x.filter(me=>me.id!==j.id)),a!=null&&a.length&&a.some(me=>me.id===j.id)&&lt.update(me=>me.filter(pe=>pe.id!==j.id)),console.log("active trails",s))}}async function I(){console.log(" TrailSynchronizer: Subscribing to trail streams"),d=le.channel("trail_stream_changes").on("postgres_changes",{event:"INSERT",schema:"public",table:"trail_stream",filter:`operation_id=eq.${f.id}`},z=>{if(!z.new)return;const{trail_id:B,coordinate:J,timestamp:K}=z.new;!(s!=null&&s.length)||!s.some(j=>j.id===B)||nt.update(j=>j.map(x=>x.id===B?{...x,path:[...x.path,{coordinates:{latitude:J.coordinates[1],longitude:J.coordinates[0]},timestamp:K}]}:x))}).subscribe()}function k(z){O(z);const B={coordinates:z.coordinates,timestamp:z.timestamp};Ct.update(J=>[...J,B]),kr.set(null)}function S(){m||(console.log(" TrailSynchronizer: Starting periodic sync"),m=setInterval(()=>{E()},vf))}async function E(){await h()}async function h(){const z=c;if(z.length===0)return;const B=[...z];Ct.set([]);try{console.log(` TrailSynchronizer: Sending batch of ${B.length} coordinates`);const J=await pt.saveCoordinates(f.id,i.id,B.map(K=>({coordinates:K.coordinates,timestamp:K.timestamp})));if(J.error)throw new Error(J.message||"Failed to save coordinates");console.log(` TrailSynchronizer: Successfully synced ${B.length} coordinates`)}catch(J){console.log(" TrailSynchronizer: Failed to sync coordinates:",J),Ct.update(K=>[...B,...K])}}function b(){m&&(console.log(" TrailSynchronizer: Stopping periodic sync"),clearInterval(m),m=null)}async function y(z){try{console.log(`Fetching trails for operation ${z}`);const{data:B,error:J}=await le.from("trails").select(`
        id,
        vehicle_id,
        operation_id,
        start_time,
        end_time,
        trail_color,
        trail_width
        `).eq("operation_id",z).not("end_time","is",null).order("start_time",{ascending:!0});if(J)throw console.error("Error fetching trails:",J),new Error(`Failed to fetch trails: ${J.message}`);return!B||B.length===0?(console.log("No trails found for this operation"),[]):(console.log(`Found ${B.length} trails, fetching path data...`),await Promise.all(B.map(async te=>{try{const{data:j,error:x}=await le.rpc("get_trail_path_as_geojson",{trail_id_param:te.id});return x?(console.error(`Error fetching path for trail ${te.id}:`,x),{...te,path:null}):{...te,path:j}}catch(j){return console.error(`Error processing path for trail ${te.id}:`,j),{...te,path:null}}})))}catch(B){throw console.error("Error in getOperationTrails:",B),B}}async function L(){console.log(" TrailSynchronizer: Fetching operation trails"),oe.promise((async()=>{const z=await y(f.id);return lt.set([]),lt.update(B=>[...B,...z]),r(2,g=!0),console.log(` TrailSynchronizer: Loaded ${z.length} historical trails`),console.log("Operation",f),z})(),{loading:`Loading trails from ${f.name} (${f.year})...`,success:z=>`Loaded ${z.length} trails from ${f.name} (${f.year})`,error:z=>`Failed to fetch trails from ${f.name}: ${z.message}`},{duration:4e3})}async function N(){try{const z=await pt.checkOpenTrails(o.id);if(z.error)throw new Error(z.message||"Failed to check for open trails");const{openTrail:B,trailData:J}=z;if(console.log("Opentrail",B,"data",J),B){console.log(" TrailSynchronizer: Found existing open trail"),ot.set({...B,start_time:B.start_time,trail_color:B.trail_color,trail_width:B.trail_width,path:J||[]}),it.set(!0);const K=new Date(B.start_time),te=Math.round((Date.now()-K.getTime())/(1e3*60));oe.info(`Found existing ${B.trail_width}m ${B.trail_color.toLowerCase()} trail`,{description:`Started ${te} minutes ago. Trailing will continue automatically.`,duration:5e3})}}catch(z){console.error(" TrailSynchronizer: Failed to check open trails:",z),oe.error("Failed to check for open trails")}}async function M(){const z=oe.promise((async()=>{console.log("Getting other active trails... from operation:",f.id,"and profile:",o.id);const B=await pt.checkOtherActiveTrails(f.id,o.id);if(B.error)throw new Error(B.message||"Failed to check for other active trails");B.errors&&B.errors.forEach(K=>{oe.error(K,{duration:6e3})});const{activeTrails:J}=B;if(J&&J.length>0){console.log(` TrailSynchronizer: Found ${J.length} other active trails`,J);const K=J.map(x=>({id:x.id,vehicle_id:x.vehicle_id,operation_id:x.operation_id,task_id:x.task_id||null,start_time:x.start_time,end_time:x.end_time,trail_color:x.trail_color,trail_width:x.trail_width,path:x.trailData||[],detailed_path:null})),te=(n==null?void 0:n.connected_profiles)||[],j=J.map(x=>{const me=te.find(pe=>pe.id===x.vehicle_id);return me?me.full_name:null}).filter(x=>x!==null);return nt.set(K),j.length>0?`Active trails from: ${j.join(", ")}`:`Found ${J.length} active ${J.length===1?"trail":"trails"} from unknown vehicles`}else return nt.set([]),"No active trails found"})(),{loading:"Checking for active trails...",success:B=>B,error:B=>B instanceof Error?B.message:"Failed to check for other active trails"},{duration:6e3});try{await z}catch(B){console.error(" TrailSynchronizer: Failed to check other active trails:",B)}}async function P(){const z=t.vehicle_id;try{await H(z)}catch(B){console.error(" TrailSynchronizer: Error creating trail:",B),oe.error(`Error creating trail: ${B.message}`)}}async function H(z){console.log(" TrailSynchronizer: Creating new trail");try{const B=await pt.openNewTrail(z,f.id,t);if(B.error)throw new Error(B.message||"Failed to create trail");console.log(" TrailSynchronizer: New trail created successfully"),oe.success("New trail created successfully"),ot.set({...B.trail,start_time:B.trail.start_time,trail_color:B.trail.trail_color,trail_width:B.trail.trail_width,path:[]}),it.set(!0)}catch(B){throw console.error(" TrailSynchronizer: Error creating trail:",B),oe.error(`Error creating trail: ${B.message}`),B}}function O(z){ot.update(B=>{if(B){const J=[...B.path||[],z];return{...B,path:J}}return B})}function R(z){p=z,r(1,p)}return l.$$set=z=>{"selectedOperation"in z&&r(3,f=z.selectedOperation),"map"in z&&r(0,_=z.map)},[_,p,g,f,R]}class kf extends ce{constructor(e){super(),ue(this,e,wf,bf,se,{selectedOperation:3,map:0})}}function Dl(l){let e,r,t,n='<svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>',o,i,c,s,a,u,f="Measured Area",_,d,p,m;s=new ai({props:{class:"h-3.5 w-3.5"}});function g(I,k){return I[2]?I[3]?yf:Tf:Ef}let v=g(l),$=v(l);return{c(){e=F("div"),r=F("div"),t=F("button"),t.innerHTML=n,o=Z(),i=F("div"),c=F("div"),Y(s.$$.fragment),a=Z(),u=F("span"),u.textContent=f,_=Z(),$.c(),this.h()},l(I){e=V(I,"DIV",{class:!0});var k=q(e);r=V(k,"DIV",{class:!0});var S=q(r);t=V(S,"BUTTON",{class:!0,"data-svelte-h":!0}),be(t)!=="svelte-lmi83i"&&(t.innerHTML=n),o=X(S),i=V(S,"DIV",{class:!0});var E=q(i);c=V(E,"DIV",{class:!0});var h=q(c);Q(s.$$.fragment,h),a=X(h),u=V(h,"SPAN",{"data-svelte-h":!0}),be(u)!=="svelte-464exh"&&(u.textContent=f),h.forEach(w),_=X(E),$.l(E),E.forEach(w),S.forEach(w),k.forEach(w),this.h()},h(){D(t,"class","absolute -right-2 -top-2 flex h-5 w-5 items-center justify-center rounded-full border border-gray-200 bg-white text-gray-500 hover:bg-gray-50"),D(c,"class","flex items-center gap-1.5 text-[11px] font-medium uppercase tracking-wider text-gray-600"),D(i,"class","flex flex-col items-center gap-2"),D(r,"class","relative min-w-[180px] rounded-lg border border-gray-200 bg-white/90 p-3 backdrop-blur-sm"),D(e,"class","absolute left-1/2 top-3 z-10 -translate-x-1/2 transform")},m(I,k){U(I,e,k),A(e,r),A(r,t),A(r,o),A(r,i),A(i,c),G(s,c,null),A(c,a),A(c,u),A(i,_),$.m(i,null),d=!0,p||(m=Se(t,"click",l[6]),p=!0)},p(I,k){v===(v=g(I))&&$?$.p(I,k):($.d(1),$=v(I),$&&($.c(),$.m(i,null)))},i(I){d||(T(s.$$.fragment,I),d=!0)},o(I){C(s.$$.fragment,I),d=!1},d(I){I&&w(e),W(s),$.d(),p=!1,m()}}}function yf(l){let e,r,t=l[1].hectares+"",n,o,i,c="ha",s,a,u=l[1].squareMeters.toLocaleString()+"",f,_;return{c(){e=F("div"),r=F("div"),n=_e(t),o=Z(),i=F("span"),i.textContent=c,s=Z(),a=F("div"),f=_e(u),_=_e(" m"),this.h()},l(d){e=V(d,"DIV",{class:!0});var p=q(e);r=V(p,"DIV",{class:!0});var m=q(r);n=ge(m,t),o=X(m),i=V(m,"SPAN",{class:!0,"data-svelte-h":!0}),be(i)!=="svelte-1c7zf12"&&(i.textContent=c),m.forEach(w),s=X(p),a=V(p,"DIV",{class:!0});var g=q(a);f=ge(g,u),_=ge(g," m"),g.forEach(w),p.forEach(w),this.h()},h(){D(i,"class","text-xs font-normal"),D(r,"class","flex items-baseline gap-1 text-2xl font-bold text-gray-800"),D(a,"class","text-xs text-gray-500"),D(e,"class","flex flex-col items-center")},m(d,p){U(d,e,p),A(e,r),A(r,n),A(r,o),A(r,i),A(e,s),A(e,a),A(a,f),A(a,_)},p(d,p){p&2&&t!==(t=d[1].hectares+"")&&Ve(n,t),p&2&&u!==(u=d[1].squareMeters.toLocaleString()+"")&&Ve(f,u)},d(d){d&&w(e)}}}function Tf(l){let e,r="Complete the shape";return{c(){e=F("div"),e.textContent=r,this.h()},l(t){e=V(t,"DIV",{class:!0,"data-svelte-h":!0}),be(e)!=="svelte-1298jjy"&&(e.textContent=r),this.h()},h(){D(e,"class","text-sm text-gray-600")},m(t,n){U(t,e,n)},p:$e,d(t){t&&w(e)}}}function Ef(l){let e,r="Click to start measuring";return{c(){e=F("div"),e.textContent=r,this.h()},l(t){e=V(t,"DIV",{class:!0,"data-svelte-h":!0}),be(e)!=="svelte-116r9bz"&&(e.textContent=r),this.h()},h(){D(e,"class","text-sm text-gray-600")},m(t,n){U(t,e,n)},p:$e,d(t){t&&w(e)}}}function Cf(l){let e,r,t=l[0]&&Dl(l);return{c(){t&&t.c(),e=ne()},l(n){t&&t.l(n),e=ne()},m(n,o){t&&t.m(n,o),U(n,e,o),r=!0},p(n,[o]){n[0]?t?(t.p(n,o),o&1&&T(t,1)):(t=Dl(n),t.c(),T(t,1),t.m(e.parentNode,e)):t&&(de(),C(t,1,1,()=>{t=null}),he())},i(n){r||(T(t),r=!0)},o(n){C(t),r=!1},d(n){n&&w(e),t&&t.d(n)}}}function Sf(l){return{squareMeters:Math.round(l),hectares:Math.round(l/1e4*100)/100}}function $f(l,e,r){let t;re(l,Wt,_=>r(0,t=_));let{map:n}=e,o,i={hectares:0,squareMeters:0},c=!1,s=!1;const a={create:()=>u(),delete:()=>u(),update:()=>u()};Ge(()=>{r(5,o=new po({displayControlsDefault:!1,controls:{},defaultMode:"draw_polygon",clickBuffer:6,touchBuffer:6,snapToFinish:!0,finishDrawingOnSnapToFinish:!0,touchEnabled:!0,boxSelect:!1,translateEnabled:!1,rotateEnabled:!1,styles:[{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#0ea5e9","fill-opacity":.25}},{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"]],paint:{"fill-color":"#0ea5e9","fill-opacity":.4}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#0ea5e9","line-width":2,"line-dasharray":[2,2]}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#0ea5e9","line-width":3}},{id:"gl-draw-polygon-and-line-vertex-active",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"]],paint:{"circle-radius":6,"circle-color":"#fff","circle-stroke-color":"#0ea5e9","circle-stroke-width":2}},{id:"gl-draw-polygon-and-line-midpoint-active",type:"circle",filter:["all",["==","meta","midpoint"],["==","$type","Point"]],paint:{"circle-radius":4,"circle-color":"#0ea5e9","circle-stroke-color":"#fff","circle-stroke-width":2}}]})),n.addControl(o),n.on("draw.create",a.create),n.on("draw.delete",a.delete),n.on("draw.update",a.update)});function u(){if(!o)return;const _=o.getAll();_.features.length>0?(r(1,i=Sf(zo(_))),r(2,c=!0),r(3,s=!0)):(r(2,c=!1),r(3,s=!1),r(1,i={hectares:0,squareMeters:0}))}const f=()=>Fl(Wt,t=!1,t);return l.$$set=_=>{"map"in _&&r(4,n=_.map)},l.$$.update=()=>{l.$$.dirty&33&&o&&t!==void 0&&(t?o.changeMode("draw_polygon"):(o.deleteAll(),o.changeMode("simple_select"),r(2,c=!1),r(3,s=!1)))},[t,i,c,s,n,o,f]}class Mf extends ce{constructor(e){super(),ue(this,e,$f,Cf,se,{map:4})}}function If(l){let e,r=null,t=0,n=null;const{getMap:o}=Gt("map");class i extends Ze.NavigationControl{constructor(s){super(s),this._trackingEnabled=!1}onAdd(s){const a=super.onAdd(s),u=a.querySelector(".mapboxgl-ctrl-compass");return u&&u.addEventListener("click",f=>{f.preventDefault(),f.stopPropagation(),this._handleCompassClick(s)}),a}_handleCompassClick(s){n&&clearTimeout(n),t++,n=setTimeout(()=>{t=0},500),t===1?(s.resetNorth(),this._trackingEnabled&&this._disableTracking()):t===2&&(t=0,this._toggleTracking(s))}_toggleTracking(s){this._trackingEnabled=!this._trackingEnabled;const a=document.querySelector(".mapboxgl-ctrl-compass");this._trackingEnabled&&navigator.geolocation?(r=navigator.geolocation.watchPosition(u=>{s.easeTo({center:[u.coords.longitude,u.coords.latitude],bearing:u.coords.heading||0,duration:1e3})},null,{enableHighAccuracy:!0}),a&&a.classList.add("tracking-active")):this._disableTracking()}_disableTracking(){this._trackingEnabled=!1,r&&(navigator.geolocation.clearWatch(r),r=null);const s=document.querySelector(".mapboxgl-ctrl-compass");s&&s.classList.remove("tracking-active")}}return Ge(async()=>{try{e=await o();const c=new i({showZoom:!1,showCompass:!0,visualizePitch:!0});e.addControl(c,"bottom-right")}catch(c){console.warn("Map initialization error:",c)}}),[]}class Lf extends ce{constructor(e){super(),ue(this,e,If,null,se,{})}}function Af(l){let e,r,t,n,o,i,c,s,a,u,f,_,d,p,m,g,v,$,I,k;e=new Dc({}),e.$on("toggleMapStyleDispatcher",l[12]),e.$on("backToDashboard",function(){Bl(l[0])&&l[0].apply(this,arguments)}),e.$on("locateHome",l[13]),t=new Lf({}),o=new za({props:{markerPlacementEvent:l[8],markerClickEvent:l[9]}}),c=new fu({props:{map:l[4]}});let S={map:l[4]};a=new Vc({props:S}),l[15](a),a.$on("markerPlacement",l[10]),a.$on("markerClick",l[11]),f=new Tu({}),d=new wu({props:{map:l[4],disableAutoZoom:l[1]}}),m=new Yu({props:{map:l[4]}}),v=new Mf({props:{map:l[4]}});let E=l[2]&&Ol(l);return{c(){Y(e.$$.fragment),r=Z(),Y(t.$$.fragment),n=Z(),Y(o.$$.fragment),i=Z(),Y(c.$$.fragment),s=Z(),Y(a.$$.fragment),u=Z(),Y(f.$$.fragment),_=Z(),Y(d.$$.fragment),p=Z(),Y(m.$$.fragment),g=Z(),Y(v.$$.fragment),$=Z(),E&&E.c(),I=ne()},l(h){Q(e.$$.fragment,h),r=X(h),Q(t.$$.fragment,h),n=X(h),Q(o.$$.fragment,h),i=X(h),Q(c.$$.fragment,h),s=X(h),Q(a.$$.fragment,h),u=X(h),Q(f.$$.fragment,h),_=X(h),Q(d.$$.fragment,h),p=X(h),Q(m.$$.fragment,h),g=X(h),Q(v.$$.fragment,h),$=X(h),E&&E.l(h),I=ne()},m(h,b){G(e,h,b),U(h,r,b),G(t,h,b),U(h,n,b),G(o,h,b),U(h,i,b),G(c,h,b),U(h,s,b),G(a,h,b),U(h,u,b),G(f,h,b),U(h,_,b),G(d,h,b),U(h,p,b),G(m,h,b),U(h,g,b),G(v,h,b),U(h,$,b),E&&E.m(h,b),U(h,I,b),k=!0},p(h,b){l=h;const y={};b&256&&(y.markerPlacementEvent=l[8]),b&512&&(y.markerClickEvent=l[9]),o.$set(y);const L={};b&16&&(L.map=l[4]),c.$set(L);const N={};b&16&&(N.map=l[4]),a.$set(N);const M={};b&16&&(M.map=l[4]),b&2&&(M.disableAutoZoom=l[1]),d.$set(M);const P={};b&16&&(P.map=l[4]),m.$set(P);const H={};b&16&&(H.map=l[4]),v.$set(H),l[2]?E?(E.p(l,b),b&4&&T(E,1)):(E=Ol(l),E.c(),T(E,1),E.m(I.parentNode,I)):E&&(de(),C(E,1,1,()=>{E=null}),he())},i(h){k||(T(e.$$.fragment,h),T(t.$$.fragment,h),T(o.$$.fragment,h),T(c.$$.fragment,h),T(a.$$.fragment,h),T(f.$$.fragment,h),T(d.$$.fragment,h),T(m.$$.fragment,h),T(v.$$.fragment,h),T(E),k=!0)},o(h){C(e.$$.fragment,h),C(t.$$.fragment,h),C(o.$$.fragment,h),C(c.$$.fragment,h),C(a.$$.fragment,h),C(f.$$.fragment,h),C(d.$$.fragment,h),C(m.$$.fragment,h),C(v.$$.fragment,h),C(E),k=!1},d(h){h&&(w(r),w(n),w(i),w(s),w(u),w(_),w(p),w(g),w($),w(I)),W(e,h),W(t,h),W(o,h),W(c,h),l[15](null),W(a,h),W(f,h),W(d,h),W(m,h),W(v,h),E&&E.d(h)}}}function Pf(l){let e,r,t="Map Initialization Error",n,o,i,c,s,a="Retry",u,f,_="Back to Dashboard",d,p;return{c(){e=F("div"),r=F("h2"),r.textContent=t,n=Z(),o=F("p"),i=_e(l[7]),c=Z(),s=F("button"),s.textContent=a,u=Z(),f=F("button"),f.textContent=_,this.h()},l(m){e=V(m,"DIV",{class:!0});var g=q(e);r=V(g,"H2",{class:!0,"data-svelte-h":!0}),be(r)!=="svelte-yg673q"&&(r.textContent=t),n=X(g),o=V(g,"P",{});var v=q(o);i=ge(v,l[7]),v.forEach(w),c=X(g),s=V(g,"BUTTON",{class:!0,"data-svelte-h":!0}),be(s)!=="svelte-1f8l0ov"&&(s.textContent=a),u=X(g),f=V(g,"BUTTON",{class:!0,"data-svelte-h":!0}),be(f)!=="svelte-bxxq9y"&&(f.textContent=_),g.forEach(w),this.h()},h(){D(r,"class","svelte-zxkj3d"),D(s,"class","svelte-zxkj3d"),D(f,"class","svelte-zxkj3d"),D(e,"class","error-container svelte-zxkj3d")},m(m,g){U(m,e,g),A(e,r),A(e,n),A(e,o),A(o,i),A(e,c),A(e,s),A(e,u),A(e,f),d||(p=[Se(s,"click",l[14]),Se(f,"click",function(){Bl(l[0])&&l[0].apply(this,arguments)})],d=!0)},p(m,g){l=m,g&128&&Ve(i,l[7])},i:$e,o:$e,d(m){m&&w(e),d=!1,mt(p)}}}function Ol(l){let e,r;return e=new kf({props:{selectedOperation:l[2],map:l[4]}}),{c(){Y(e.$$.fragment)},l(t){Q(e.$$.fragment,t)},m(t,n){G(e,t,n),r=!0},p(t,n){const o={};n&4&&(o.selectedOperation=t[2]),n&16&&(o.map=t[4]),e.$set(o)},i(t){r||(T(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){W(e,t)}}}function Df(l){let e,r,t,n;const o=[Pf,Af],i=[];function c(s,a){return s[7]?0:s[6]?1:-1}return~(r=c(l))&&(t=i[r]=o[r](l)),{c(){e=F("div"),t&&t.c(),this.h()},l(s){e=V(s,"DIV",{class:!0});var a=q(e);t&&t.l(a),a.forEach(w),this.h()},h(){D(e,"class","map-container svelte-zxkj3d")},m(s,a){U(s,e,a),~r&&i[r].m(e,null),l[16](e),n=!0},p(s,[a]){let u=r;r=c(s),r===u?~r&&i[r].p(s,a):(t&&(de(),C(i[u],1,1,()=>{i[u]=null}),he()),~r?(t=i[r],t?t.p(s,a):(t=i[r]=o[r](s),t.c()),T(t,1),t.m(e,null)):t=null)},i(s){n||(T(t),n=!0)},o(s){C(t),n=!1},d(s){s&&w(e),~r&&i[r].d(),l[16](null)}}}const qr="mapbox://styles/mapbox/satellite-streets-v12",Of="mapbox://styles/mapbox/outdoors-v12";function Nf(l,e,r){let t,n;re(l,Zr,M=>r(23,t=M)),re(l,io,M=>r(24,n=M));let{handleBackToDashboard:o}=e,{initialLocation:i}=e,{selectedOperation:c}=e,s,a=!0,u=qr,f=!1,_,d,p,m=!1,g=null;Er("map",{getMap:()=>Promise.resolve(d)});const v={container:null,style:qr,center:[90,-40],zoom:2};function $(){if(!(!d||!i||!Array.isArray(i)))try{if(i.length===4){const M=[[i[0],i[1]],[i[2],i[3]]];d.fitBounds(M,{padding:50,maxZoom:15})}else i.length===2&&d.flyTo({center:i,zoom:15,duration:4e3})}catch(M){console.error("Error initializing map location:",M)}}Ge(async()=>{try{Ze.accessToken=mn,v.container=_,r(4,d=new Ze.Map({...v,accessToken:mn})),d.setMaxPitch(0),d.setMinPitch(0),dn.set(d),r(6,m=!0),d.loaded()?(f=!0,$()):d.on("load",()=>{f=!0,$()}),d.on("error",M=>{var P;console.error("Mapbox error:",M.error),oe.error(`Map error: ${((P=M.error)==null?void 0:P.message)||"Unknown map error"}`)});try{await hn.open(),s=hn}catch(M){console.error("Error opening IndexedDB database:",M)}}catch(M){console.error("Error initializing Mapbox:",M),r(7,g=M.message),oe.error(`Failed to initialize map: ${M.message}`)}}),gt(()=>{d&&(d.off(),d.remove(),r(4,d=null),dn.set(null)),p&&p.$destroy()});let I=null,k=null;function S(M){r(8,I=M.detail)}function E(M){r(9,k=M.detail)}function h(){d&&(f=!1,a?u=Of:u=qr,d.setStyle(u),d.once("load",()=>{f=!0,$()}),a=!a)}function b(){d&&(n?d.fitBounds(n,{padding:50,maxZoom:15}):t?d.fitBounds(t,{padding:50,maxZoom:15}):oe.error("Please place markers or upload field boundaries to set a home location",{duration:4e3}))}const y=()=>window.location.reload();function L(M){Ue[M?"unshift":"push"](()=>{p=M,r(5,p)})}function N(M){Ue[M?"unshift":"push"](()=>{_=M,r(3,_)})}return l.$$set=M=>{"handleBackToDashboard"in M&&r(0,o=M.handleBackToDashboard),"initialLocation"in M&&r(1,i=M.initialLocation),"selectedOperation"in M&&r(2,c=M.selectedOperation)},[o,i,c,_,d,p,m,g,I,k,S,E,h,b,y,L,N]}class zf extends ce{constructor(e){super(),ue(this,e,Nf,Df,se,{handleBackToDashboard:0,initialLocation:1,selectedOperation:2})}}function Vf(l){let e=1/0,r=-1/0,t=1/0,n=-1/0;return l.forEach(o=>{o.forEach(i=>{i.forEach(([c,s])=>{e=Math.min(e,c),r=Math.max(r,c),t=Math.min(t,s),n=Math.max(n,s)})})}),[e,t,r,n]}const Ff={async getLocation(l,e){var r;try{const{data:t}=await le.auth.getSession();if(!((r=t==null?void 0:t.session)!=null&&r.user))throw new Error("Not authenticated");const n=t.session.user.id,{data:o,error:i}=await le.from("profiles").select("master_map_id").eq("id",n).single();if(i)throw console.error("Error fetching profile:",i),new Error(`Failed to fetch profile: ${i.message}`);const c=o.master_map_id;if(!c)throw new Error("No master map associated with user");let s,a;switch(l){case"field":const{data:u,error:f}=await le.from("fields").select("boundary").eq("map_id",c).eq("field_id",e).single();if(f)throw console.error("Error fetching field:",f),new Error(`Failed to fetch field: ${f.message}`);const _=u.boundary;if(_&&(_.type==="MultiPolygon"||_.type==="Polygon")){const $=_.type==="MultiPolygon"?_.coordinates:[_.coordinates];s=Vf($),a="boundingBox"}else throw new Error("Invalid geometry type");break;case"vehicle":const{data:d,error:p}=await le.from("vehicle_state").select("coordinates").eq("master_map_id",c).eq("vehicle_id",e).single();if(p)throw console.error("Error fetching vehicle:",p),new Error(`Failed to fetch vehicle: ${p.message}`);if(!d||!d.coordinates)throw new Error("Vehicle location not found");const m=d.coordinates.match(/\(([-\d.]+),([-\d.]+)\)/);if(!m)throw new Error("Invalid coordinate format");const g=parseFloat(m[1]),v=parseFloat(m[2]);s=[g,v],a="coordinate";break;case"marker":s=[0,0],a="coordinate";break;default:throw new Error("Invalid object type")}if(!s)throw new Error("Location could not be calculated");return{success:!0,location:s,type:a}}catch(t){return console.error("Error getting location:",t),{success:!1,error:t.message}}}};function Bf(l){let e,r,t,n;const o=[qf,Rf,Uf],i=[];function c(s,a){return s[0]?0:s[1]?1:2}return e=c(l),r=i[e]=o[e](l),{c(){r.c(),t=ne()},l(s){r.l(s),t=ne()},m(s,a){i[e].m(s,a),U(s,t,a),n=!0},p(s,a){let u=e;e=c(s),e===u?i[e].p(s,a):(de(),C(i[u],1,1,()=>{i[u]=null}),he(),r=i[e],r?r.p(s,a):(r=i[e]=o[e](s),r.c()),T(r,1),r.m(t.parentNode,t))},i(s){n||(T(r),n=!0)},o(s){C(r),n=!1},d(s){s&&w(t),i[e].d(s)}}}function Uf(l){let e,r=l[3],t,n=Nl(l);return{c(){e=F("div"),n.c(),this.h()},l(o){e=V(o,"DIV",{class:!0});var i=q(e);n.l(i),i.forEach(w),this.h()},h(){D(e,"class","fixed left-0 top-0 h-full w-full overflow-hidden")},m(o,i){U(o,e,i),n.m(e,null),t=!0},p(o,i){i&8&&se(r,r=o[3])?(de(),C(n,1,1,$e),he(),n=Nl(o),n.c(),T(n,1),n.m(e,null)):n.p(o,i)},i(o){t||(T(n),t=!0)},o(o){C(n),t=!1},d(o){o&&w(e),n.d(o)}}}function Rf(l){let e,r,t,n="Error Loading Map",o,i,c,s,a,u,f="Try Again",_,d,p="Back to Dashboard",m,g;return{c(){e=F("div"),r=F("div"),t=F("h2"),t.textContent=n,o=Z(),i=F("p"),c=_e(l[1]),s=Z(),a=F("div"),u=F("button"),u.textContent=f,_=Z(),d=F("button"),d.textContent=p,this.h()},l(v){e=V(v,"DIV",{class:!0});var $=q(e);r=V($,"DIV",{class:!0});var I=q(r);t=V(I,"H2",{class:!0,"data-svelte-h":!0}),be(t)!=="svelte-3pt6ml"&&(t.textContent=n),o=X(I),i=V(I,"P",{class:!0});var k=q(i);c=ge(k,l[1]),k.forEach(w),s=X(I),a=V(I,"DIV",{class:!0});var S=q(a);u=V(S,"BUTTON",{class:!0,"data-svelte-h":!0}),be(u)!=="svelte-9gqfuk"&&(u.textContent=f),_=X(S),d=V(S,"BUTTON",{class:!0,"data-svelte-h":!0}),be(d)!=="svelte-jngz7b"&&(d.textContent=p),S.forEach(w),I.forEach(w),$.forEach(w),this.h()},h(){D(t,"class","text-2xl font-bold text-red-700"),D(i,"class","mt-2 text-red-600"),D(u,"class","rounded bg-primary px-4 py-2 text-white"),D(d,"class","rounded border border-gray-300 bg-white px-4 py-2 text-gray-700"),D(a,"class","mt-6 flex justify-center space-x-4"),D(r,"class","max-w-md rounded-lg bg-red-50 p-6 text-center shadow-lg"),D(e,"class","fixed left-0 top-0 flex h-full w-full items-center justify-center")},m(v,$){U(v,e,$),A(e,r),A(r,t),A(r,o),A(r,i),A(i,c),A(r,s),A(r,a),A(a,u),A(a,_),A(a,d),m||(g=[Se(u,"click",l[7]),Se(d,"click",l[4])],m=!0)},p(v,$){$&2&&Ve(c,v[1])},i:$e,o:$e,d(v){v&&w(e),m=!1,mt(g)}}}function qf(l){let e,r='<div class="flex flex-col items-center"><div class="skeleton mb-4 h-12 w-12 rounded-full"></div> <p class="mt-4 text-xl font-medium">Loading map data...</p></div>';return{c(){e=F("div"),e.innerHTML=r,this.h()},l(t){e=V(t,"DIV",{class:!0,"data-svelte-h":!0}),be(e)!=="svelte-ui4ia0"&&(e.innerHTML=r),this.h()},h(){D(e,"class","fixed left-0 top-0 flex h-full w-full items-center justify-center")},m(t,n){U(t,e,n)},p:$e,i:$e,o:$e,d(t){t&&w(e)}}}function Nl(l){let e,r;return e=new zf({props:{handleBackToDashboard:l[4],initialLocation:l[2],selectedOperation:l[3]}}),{c(){Y(e.$$.fragment)},l(t){Q(e.$$.fragment,t)},m(t,n){G(e,t,n),r=!0},p(t,n){const o={};n&4&&(o.initialLocation=t[2]),n&8&&(o.selectedOperation=t[3]),e.$set(o)},i(t){r||(T(e.$$.fragment,t),r=!0)},o(t){C(e.$$.fragment,t),r=!1},d(t){W(e,t)}}}function Hf(l){let e,r,t=Bf(l);return{c(){t&&t.c(),e=ne()},l(n){t&&t.l(n),e=ne()},m(n,o){t&&t.m(n,o),U(n,e,o),r=!0},p(n,[o]){t.p(n,o)},i(n){r||(T(t),r=!0)},o(n){C(t),r=!1},d(n){n&&w(e),t&&t.d(n)}}}function jf(l,e,r){let t,n;re(l,go,E=>r(6,t=E)),re(l,bn,E=>r(11,n=E));let{data:o}=e,i=!0,c=null,s=[],a=null,u=null;console.log("1. MapViewer Page Load - Initial data:",o),Gt("adminSection").set("mapviewer");let _=null;console.log("2. Current selectedOperationStore value:",n);let d=n;console.log("3. Local selectedOperation variable set to:",d),bn.subscribe(E=>{console.log("4. selectedOperationStore changed to:",E),r(3,d=E),console.log("5. Local selectedOperation updated to:",d)});function p(){return/Android/.test(navigator.userAgent)}async function m(){if(p()&&"wakeLock"in navigator)try{_=await navigator.wakeLock.request("screen")}catch(E){E.name!=="NotAllowedError"&&oe.error(`Couldn't keep screen awake: ${E.message}`)}}function g(){_&&_.release().then(()=>{_=null}).catch(E=>{console.error(`Error releasing wake lock: ${E.message}`)})}async function v(){var E;try{if(console.log("Attempting to fetch fields using fileApi..."),!((E=t==null?void 0:t.user)!=null&&E.id))throw console.error("No authenticated user"),new Error("Authentication required");const h=await Ao.loadFields();if(h.error)throw console.error("Fields API error:",h.error),new Error(`Failed to fetch fields: ${h.error}`);return s=h.fields||[],Xr.set(s),console.log("Fields loaded successfully:",s),s}catch(h){throw console.error("Error loading fields:",h),r(1,c=h.message||"Failed to load fields"),oe.error("Failed to load field data"),h}}async function $(){if(!o.type||!o.id)return null;try{const E=await Ff.getLocation(o.type,o.id);return E.success?(a=E.location,r(2,u=a),console.log(`Fetched ${o.type} location:`,a),a):(console.error(`Error fetching ${o.type} location:`,E.error),oe.error(`Failed to load ${o.type} location`),null)}catch(E){return console.error(`Error fetching ${o.type} location:`,E),oe.error(`Failed to load ${o.type} location`),null}}Ge(async()=>{var E;console.log("6. MapViewer Page Mount - selectedOperation:",d),console.log("7. MapViewer Page Mount - store value:",n);{if(t)console.log("Session available on mount:",{userId:(E=t.user)==null?void 0:E.id,hasToken:!!t.access_token});else{console.log("No session on mount, redirecting to login"),Dr("/login");return}r(0,i=!0);try{await v(),await $(),r(0,i=!1)}catch(h){console.error("Error loading map data:",h),r(0,i=!1)}m(),document.addEventListener("visibilitychange",I)}}),gt(()=>{g(),document.removeEventListener("visibilitychange",I)});function I(){document.visibilityState==="visible"?m():g()}function k(){g(),Dr("/account")}const S=()=>window.location.reload();return l.$$set=E=>{"data"in E&&r(5,o=E.data)},l.$$.update=()=>{var E;l.$$.dirty&64&&(t?console.log("Session found:",(E=t.user)==null?void 0:E.email):(console.log("No session found, redirecting to login"),Dr("/login")))},[i,c,u,d,k,o,t,S]}class Dd extends ce{constructor(e){super(),ue(this,e,jf,Hf,se,{data:5})}}export{Dd as component,Pd as universal};
