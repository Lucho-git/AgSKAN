import{g as X}from"../chunks/BJMRJ4uH.js";import{s as Z}from"../chunks/DsDOFx4q.js";import{P as tt,s as et,d as b,i as $,w as it,f as C,x as K,k,y as nt,n as D,b as _,c as g,g as P,j as v,a as m,e as I,h as at,t as rt}from"../chunks/Bqk-ehBx.js";import{S as lt,i as st,t as w,a as V,d as E,m as H,c as A,b as B,g as ot,e as ct}from"../chunks/BSIXs_Xe.js";import{S as ut}from"../chunks/Aqk3KmQt.js";import{P as W}from"../chunks/DWR7yFpr.js";import"../chunks/7sStqI9Q.js";const dt=async({parent:c})=>{var e,n;await c();const t={loading:!0,isActiveCustomer:!1,hasEverHadSubscription:!1,currentPlanId:"free",subscriptionData:null,error:null};try{const s=tt(Z);if(!(s!=null&&s.access_token))return console.error("No valid session for billing page"),X("/login"),t;const a=await fetch("/api/customer/subscription",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s.access_token}`}});if(!a.ok){const o=await a.json();throw new Error(o.error||"Failed to fetch subscription data")}const r=await a.json();return{loading:!1,isActiveCustomer:!!r.primarySubscription,hasEverHadSubscription:r.hasEverHadSubscription,currentPlanId:((n=(e=r.primarySubscription)==null?void 0:e.appSubscription)==null?void 0:n.id)||"free",subscriptionData:r.primarySubscription,error:null}}catch(s){return console.error("Error loading billing data:",s),{...t,loading:!1,error:s.message}}},ft=!1,Vt=Object.freeze(Object.defineProperty({__proto__:null,load:dt,ssr:ft},Symbol.toStringTag,{value:"Module"}));function pt(c){var l,u,f,d,h,x,y,T,L,M;let t,e,n="Billing",s,a,r,o;a=new ut({props:{title:"Subscription",editable:!1,fields:[{id:"planName",label:"Current Plan",initialValue:c[1]},{id:"planStatus",label:"Status",initialValue:((u=(l=c[6])==null?void 0:l.stripeSubscription)==null?void 0:u.status)??"N/A"},{id:"quantity",label:"Quantity",initialValue:((h=(d=(f=c[6])==null?void 0:f.stripeSubscription)==null?void 0:d.quantity)==null?void 0:h.toString())??"1"},...(T=(y=(x=c[6])==null?void 0:x.stripeSubscription)==null?void 0:y.plan)!=null&&T.interval?[{id:"interval",label:"Billing Interval",initialValue:c[6].stripeSubscription.plan.interval==="year"?"Annually":"Monthly"}]:[],{id:"nextBilling",label:"Next Billing Date",initialValue:(M=(L=c[6])==null?void 0:L.stripeSubscription)!=null&&M.current_period_end?new Date(c[6].stripeSubscription.current_period_end*1e3).toLocaleDateString():"N/A"}],editButtonTitle:"Manage Subscription",editLink:"/account/billing/manage"}});let i=c[0]&&R();return{c(){t=v("div"),e=v("h1"),e.textContent=n,s=k(),B(a.$$.fragment),r=k(),i&&i.c(),this.h()},l(p){t=g(p,"DIV",{class:!0});var S=I(t);e=g(S,"H1",{class:!0,"data-svelte-h":!0}),P(e)!=="svelte-1s0bwqe"&&(e.textContent=n),s=C(S),A(a.$$.fragment,S),r=C(S),i&&i.l(S),S.forEach(b),this.h()},h(){_(e,"class","mb-6 text-center text-2xl font-bold"),_(t,"class","container mx-auto px-4")},m(p,S){$(p,t,S),m(t,e),m(t,s),H(a,t,null),m(t,r),i&&i.m(t,null),o=!0},p(p,S){var j,q,F,z,O,Q,U,G,Y,J;const N={};S&2&&(N.fields=[{id:"planName",label:"Current Plan",initialValue:p[1]},{id:"planStatus",label:"Status",initialValue:((q=(j=p[6])==null?void 0:j.stripeSubscription)==null?void 0:q.status)??"N/A"},{id:"quantity",label:"Quantity",initialValue:((O=(z=(F=p[6])==null?void 0:F.stripeSubscription)==null?void 0:z.quantity)==null?void 0:O.toString())??"1"},...(G=(U=(Q=p[6])==null?void 0:Q.stripeSubscription)==null?void 0:U.plan)!=null&&G.interval?[{id:"interval",label:"Billing Interval",initialValue:p[6].stripeSubscription.plan.interval==="year"?"Annually":"Monthly"}]:[],{id:"nextBilling",label:"Next Billing Date",initialValue:(J=(Y=p[6])==null?void 0:Y.stripeSubscription)!=null&&J.current_period_end?new Date(p[6].stripeSubscription.current_period_end*1e3).toLocaleDateString():"N/A"}]),a.$set(N),p[0]?i?S&1&&V(i,1):(i=R(),i.c(),V(i,1),i.m(t,null)):i&&(ot(),w(i,1,1,()=>{i=null}),ct())},i(p){o||(V(a.$$.fragment,p),V(i),o=!0)},o(p){w(a.$$.fragment,p),w(i),o=!1},d(p){p&&b(t),E(a),i&&i.d()}}}function mt(c){let t,e,n,s="Upgrade Your Account",a,r,o="Choose a paid plan to unlock additional features and capabilities",i,l,u,f;l=new W({props:{currentPlanId:"free",useFullPrice:!0}});let d=c[5]&&_t();return{c(){t=v("div"),e=v("div"),n=v("h1"),n.textContent=s,a=k(),r=v("p"),r.textContent=o,i=k(),B(l.$$.fragment),u=k(),d&&d.c(),this.h()},l(h){t=g(h,"DIV",{class:!0});var x=I(t);e=g(x,"DIV",{class:!0});var y=I(e);n=g(y,"H1",{class:!0,"data-svelte-h":!0}),P(n)!=="svelte-cdv42h"&&(n.textContent=s),a=C(y),r=g(y,"P",{class:!0,"data-svelte-h":!0}),P(r)!=="svelte-1814l9o"&&(r.textContent=o),i=C(y),A(l.$$.fragment,y),y.forEach(b),u=C(x),d&&d.l(x),x.forEach(b),this.h()},h(){_(n,"class","mb-4 text-center text-4xl font-bold"),_(r,"class","mb-8 text-center text-lg text-base-content/80"),_(e,"class","py-2"),_(t,"class","container mx-auto px-4")},m(h,x){$(h,t,x),m(t,e),m(e,n),m(e,a),m(e,r),m(e,i),H(l,e,null),m(t,u),d&&d.m(t,null),f=!0},p:D,i(h){f||(V(l.$$.fragment,h),f=!0)},o(h){w(l.$$.fragment,h),f=!1},d(h){h&&b(t),E(l),d&&d.d()}}}function ht(c){let t,e,n="Error Loading Billing Information",s,a,r,o,i,l='<a href="/account/billing" class="rounded bg-primary px-4 py-2 text-white">Try Again</a>';return{c(){t=v("div"),e=v("h2"),e.textContent=n,s=k(),a=v("p"),r=rt(c[3]),o=k(),i=v("div"),i.innerHTML=l,this.h()},l(u){t=g(u,"DIV",{class:!0});var f=I(t);e=g(f,"H2",{class:!0,"data-svelte-h":!0}),P(e)!=="svelte-ho2c7i"&&(e.textContent=n),s=C(f),a=g(f,"P",{class:!0});var d=I(a);r=at(d,c[3]),d.forEach(b),o=C(f),i=g(f,"DIV",{class:!0,"data-svelte-h":!0}),P(i)!=="svelte-qsfx7l"&&(i.innerHTML=l),f.forEach(b),this.h()},h(){_(e,"class","mb-4 text-xl font-bold text-red-700"),_(a,"class","text-red-600"),_(i,"class","mt-4"),_(t,"class","mx-auto my-8 max-w-xl rounded-lg bg-red-50 p-6 text-center")},m(u,f){$(u,t,f),m(t,e),m(t,s),m(t,a),m(a,r),m(t,o),m(t,i)},p:D,i:D,o:D,d(u){u&&b(t)}}}function bt(c){let t,e='<div class="skeleton h-12 w-12 rounded-full"></div>';return{c(){t=v("div"),t.innerHTML=e,this.h()},l(n){t=g(n,"DIV",{class:!0,"data-svelte-h":!0}),P(t)!=="svelte-1ab2xdg"&&(t.innerHTML=e),this.h()},h(){_(t,"class","flex h-48 items-center justify-center")},m(n,s){$(n,t,s)},p:D,i:D,o:D,d(n){n&&b(t)}}}function R(c){let t,e,n="Upgrade Options",s,a,r;return a=new W({props:{currentPlanId:"free",useFullPrice:!0}}),{c(){t=v("div"),e=v("h2"),e.textContent=n,s=k(),B(a.$$.fragment),this.h()},l(o){t=g(o,"DIV",{class:!0});var i=I(t);e=g(i,"H2",{class:!0,"data-svelte-h":!0}),P(e)!=="svelte-166zgsd"&&(e.textContent=n),s=C(i),A(a.$$.fragment,i),i.forEach(b),this.h()},h(){_(e,"class","mb-6 text-center text-xl font-bold"),_(t,"class","mt-12")},m(o,i){$(o,t,i),m(t,e),m(t,s),H(a,t,null),r=!0},i(o){r||(V(a.$$.fragment,o),r=!0)},o(o){w(a.$$.fragment,o),r=!1},d(o){o&&b(t),E(a)}}}function _t(c){let t,e='<a href="/account/billing/manage" class="link">View past invoices</a>';return{c(){t=v("div"),t.innerHTML=e,this.h()},l(n){t=g(n,"DIV",{class:!0,"data-svelte-h":!0}),P(t)!=="svelte-1tjb8ac"&&(t.innerHTML=e),this.h()},h(){_(t,"class","mt-10 text-center")},m(n,s){$(n,t,s)},d(n){n&&b(t)}}}function gt(c){let t,e,n,s,a;const r=[bt,ht,mt,pt],o=[];function i(l,u){return l[2]?0:l[3]?1:l[4]?3:2}return e=i(c),n=o[e]=r[e](c),{c(){t=k(),n.c(),s=K(),this.h()},l(l){it("svelte-y42mya",document.head).forEach(b),t=C(l),n.l(l),s=K(),this.h()},h(){document.title="Billing"},m(l,u){$(l,t,u),o[e].m(l,u),$(l,s,u),a=!0},p(l,[u]){n.p(l,u)},i(l){a||(V(n),a=!0)},o(l){w(n),a=!1},d(l){l&&(b(t),b(s)),o[e].d(l)}}}function vt(c,t,e){var h;let n,s;nt("adminSection").set("billing");let{data:r}=t,o=r.loading,i=r.error,l=r.currentPlanId||"free",u=r.isActiveCustomer||!1,f=r.hasEverHadSubscription||!1,d=r.subscriptionData;return c.$$set=x=>{"data"in x&&e(7,r=x.data)},e(1,n=((h=d==null?void 0:d.appSubscription)==null?void 0:h.name)||"Free Plan"),e(0,s=l==="free"||!l||l==="none"),[s,n,o,i,u,f,d,r]}class Dt extends lt{constructor(t){super(),st(this,t,vt,gt,et,{data:7})}}export{Dt as component,Vt as universal};
