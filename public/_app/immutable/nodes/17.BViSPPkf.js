import{s as R,d as m,i as y,b,w as J,f as S,c as g,g as B,x as Y,k as E,j as v,l as z,y as K,z as Q,n as T,q as W,a as _,A as X,e as V,h as A,t as I,B as Z}from"../chunks/scheduler.BVGjjnGO.js";import{S as $,i as ee,t as N,a as O,e as te,d as se,m as ne,c as oe,b as ae,g as le}from"../chunks/index.Vv2yv23T.js";import{p as re}from"../chunks/stores.6DhR_UaX.js";import{S as ie}from"../chunks/settings_module.Cvn9yWrB.js";import{s as ue,a as ce}from"../chunks/sessionStore.rIZpZ3yf.js";import{g as G}from"../chunks/entry.CJi6DTPP.js";import{u as de}from"../chunks/userSettingsApi.BXqvB3js.js";function fe(r){let e,t,n,s,i,o=r[5]?.user?.email+"",u,w,C,c,d,a,f,h,l,D,M,q;function U(p,k){return p[1]?_e:pe}let F=U(r),P=F(r);return{c(){e=v("div"),t=v("div"),P.c(),n=E(),s=v("div"),i=I("The button below will send you an email at "),u=I(o),w=I(` which\r
        will allow you to set your password.`),C=E(),c=v("button"),d=I("Send Set Password Email"),f=E(),h=v("div"),l=I(`Sent email! Please check your inbox and use the link to set your\r
        password.`),this.h()},l(p){e=g(p,"DIV",{class:!0});var k=V(e);t=g(k,"DIV",{class:!0});var x=V(t);P.l(x),n=S(x),s=g(x,"DIV",{});var H=V(s);i=A(H,"The button below will send you an email at "),u=A(H,o),w=A(H,` which\r
        will allow you to set your password.`),H.forEach(m),C=S(x),c=g(x,"BUTTON",{class:!0});var j=V(c);d=A(j,"Send Set Password Email"),j.forEach(m),f=S(x),h=g(x,"DIV",{class:!0});var L=V(h);l=A(L,`Sent email! Please check your inbox and use the link to set your\r
        password.`),L.forEach(m),x.forEach(m),k.forEach(m),this.h()},h(){b(c,"class",a="btn btn-outline btn-wide "+(r[4]?"hidden":"")),b(h,"class",D="success alert alert-success "+(r[4]?"":"hidden")),b(t,"class","flex flex-col gap-y-4"),b(e,"class","card mt-8 flex max-w-md max-w-xl flex-col p-6 pb-7 shadow md:flex-row")},m(p,k){y(p,e,k),_(e,t),P.m(t,null),_(t,n),_(t,s),_(s,i),_(s,u),_(s,w),_(t,C),_(t,c),_(c,d),r[9](c),_(t,f),_(t,h),_(h,l),M||(q=X(c,"click",r[8]),M=!0)},p(p,k){F!==(F=U(p))&&(P.d(1),P=F(p),P&&(P.c(),P.m(t,n))),k&32&&o!==(o=p[5]?.user?.email+"")&&W(u,o),k&16&&a!==(a="btn btn-outline btn-wide "+(p[4]?"hidden":""))&&b(c,"class",a),k&16&&D!==(D="success alert alert-success "+(p[4]?"":"hidden"))&&b(h,"class",D)},i:T,o:T,d(p){p&&m(e),P.d(),r[9](null),M=!1,q()}}}function me(r){let e,t;return e=new ie({props:{title:"Change Password",editable:!0,saveButtonTitle:"Change Password",successTitle:"Password Changed",successBody:"On next sign in, use your new password.",apiHandler:r[6],fields:[{id:"newPassword1",label:"New Password",initialValue:"",inputType:"password"},{id:"newPassword2",label:"Confirm New Password",initialValue:"",inputType:"password"},{id:"currentPassword",label:"Current Password",initialValue:"",inputType:"password"}]}}),e.$on("success",r[7]),{c(){ae(e.$$.fragment)},l(n){oe(e.$$.fragment,n)},m(n,s){ne(e,n,s),t=!0},p:T,i(n){t||(O(e.$$.fragment,n),t=!0)},o(n){N(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function he(r){let e,t='<div class="loading loading-spinner loading-lg"></div>';return{c(){e=v("div"),e.innerHTML=t,this.h()},l(n){e=g(n,"DIV",{class:!0,"data-svelte-h":!0}),B(e)!=="svelte-asr66p"&&(e.innerHTML=t),this.h()},h(){b(e,"class","flex h-64 items-center justify-center")},m(n,s){y(n,e,s)},p:T,i:T,o:T,d(n){n&&m(e)}}}function pe(r){let e,t="Change Password By Email";return{c(){e=v("div"),e.textContent=t,this.h()},l(n){e=g(n,"DIV",{class:!0,"data-svelte-h":!0}),B(e)!=="svelte-wb4o62"&&(e.textContent=t),this.h()},h(){b(e,"class","font-bold")},m(n,s){y(n,e,s)},d(n){n&&m(e)}}}function _e(r){let e,t="Set Password By Email",n,s,i=`You use oAuth to sign in ("Sign in with Github" or similar). You can\r
          continue to access your account using only oAuth if you like!`;return{c(){e=v("div"),e.textContent=t,n=E(),s=v("div"),s.textContent=i,this.h()},l(o){e=g(o,"DIV",{class:!0,"data-svelte-h":!0}),B(e)!=="svelte-e40ftg"&&(e.textContent=t),n=S(o),s=g(o,"DIV",{"data-svelte-h":!0}),B(s)!=="svelte-kym5a6"&&(s.textContent=i),this.h()},h(){b(e,"class","font-bold")},m(o,u){y(o,e,u),y(o,n,u),y(o,s,u)},d(o){o&&(m(e),m(n),m(s))}}}function we(r){let e,t,n="Change Password",s,i,o,u,w;const C=[he,me,fe],c=[];function d(a,f){return a[2]?0:a[0]?1:2}return i=d(r),o=c[i]=C[i](r),{c(){e=E(),t=v("h1"),t.textContent=n,s=E(),o.c(),u=Y(),this.h()},l(a){J("svelte-cgsnq8",document.head).forEach(m),e=S(a),t=g(a,"H1",{class:!0,"data-svelte-h":!0}),B(t)!=="svelte-1thmec9"&&(t.textContent=n),s=S(a),o.l(a),u=Y(),this.h()},h(){document.title="Change Password",b(t,"class","mb-6 text-2xl font-bold")},m(a,f){y(a,e,f),y(a,t,f),y(a,s,f),c[i].m(a,f),y(a,u,f),w=!0},p(a,[f]){let h=i;i=d(a),i===h?c[i].p(a,f):(le(),N(c[h],1,1,()=>{c[h]=null}),te(),o=c[i],o?o.p(a,f):(o=c[i]=C[i](a),o.c()),O(o,1),o.m(u.parentNode,u))},i(a){w||(O(o),w=!0)},o(a){N(o),w=!1},d(a){a&&(m(e),m(t),m(s),m(u)),c[i].d(a)}}}function be(r,e,t){let n,s;z(r,re,l=>t(11,n=l)),z(r,ue,l=>t(5,s=l)),K("adminSection").set("settings");let o=!1,u=!1,w=!0;Q(async()=>{if(!s){G("/login");return}if(console.log("Session user:",s.user),s.user?.app_metadata?.provider){const l=s.user.app_metadata.provider;console.log("Auth provider:",l),l==="email"?t(0,o=!0):l!=="email"&&t(1,u=!0)}s.user?.amr&&(console.log("User AMR:",s.user.amr),t(0,o=!!s.user.amr.find(l=>l.method==="password")),t(1,u=!!s.user.amr.find(l=>l.method==="oauth"))),console.log("hasPassword:",o),console.log("usingOAuth:",u),t(2,w=!1)});async function C(l){return await de.updatePassword(l.newPassword1,l.newPassword2,l.currentPassword)}function c(){setTimeout(()=>{G("/account/settings")},1500)}let d,a=!1;async function f(){if(s?.user?.email){d&&(t(3,d.disabled=!0,d),t(3,d.textContent="Sending...",d));try{const{error:l}=await ce.auth.resetPasswordForEmail(s.user.email,{redirectTo:`${n.url.origin}/auth/callback?next=%2Faccount%2Fsettings%2Freset_password`});if(l)throw l;t(4,a=!0)}catch(l){console.error("Error sending password reset email:",l),d&&(t(3,d.disabled=!1,d),t(3,d.textContent="Send Set Password Email",d))}finally{}}}function h(l){Z[l?"unshift":"push"](()=>{d=l,t(3,d)})}return[o,u,w,d,a,s,C,c,f,h]}class Se extends ${constructor(e){super(),ee(this,e,be,we,R,{})}}export{Se as component};
