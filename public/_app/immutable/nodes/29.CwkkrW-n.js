import{s as w,n as a,d as v,i as _,b,c as x,g as y,j as S,l as k,v as E}from"../chunks/DjMlahvE.js";import{S as F,i as U}from"../chunks/KhAD1Hhl.js";import{g as c}from"../chunks/CsvQbYGG.js";import{s as j}from"../chunks/DSS83BMa.js";import{t as i}from"../chunks/C31GE7Pe.js";import{s as m}from"../chunks/Ehf4wK3b.js";const C=!1,T=({params:t})=>({slug:t.slug}),D=Object.freeze(Object.defineProperty({__proto__:null,load:T,prerender:C},Symbol.toStringTag,{value:"Module"})),q=async({session:t})=>{try{if(!(t!=null&&t.access_token))return{error:"No valid session"};const e=await m.createFreeSubscription();if(!e.success)throw new Error(e.message||"Failed to create free subscription");return{error:null}}catch(e){return console.error("Error in createFreeSubscription:",e),{error:e.message}}},M=async({session:t,priceId:e,seats:n=1,discount:o=!1,discountcode:s=null})=>{try{if(!(t!=null&&t.access_token))return{error:"No valid session",stripeUrl:null};const r=await m.createCheckoutSession({priceId:e,seats:n,discount:o,discountcode:s});if(!r.success)throw new Error(r.message||"Failed to create checkout session");return{error:null,stripeUrl:r.stripeUrl}}catch(r){return console.error("Error in createCheckoutSession:",r),{error:r.message,stripeUrl:null}}};function A(t){let e,n='<div class="container mx-auto flex flex-col items-center justify-center px-4"><div class="flex flex-col items-center"><div class="skeleton mb-4 h-12 w-12 rounded-full"></div> <p class="text-lg">&quot;Just a moment...&quot;</p></div></div>';return{c(){e=S("div"),e.innerHTML=n,this.h()},l(o){e=x(o,"DIV",{class:!0,"data-svelte-h":!0}),y(e)!=="svelte-d80lr3"&&(e.innerHTML=n),this.h()},h(){b(e,"class","fixed inset-0 z-50 flex items-center justify-center bg-base-100 bg-opacity-50 backdrop-blur-sm")},m(o,s){_(o,e,s)},p:a,i:a,o:a,d(o){o&&v(e)}}}function I(t,e,n){let o;k(t,j,r=>n(1,o=r));let{data:s}=e;return E(async()=>{try{if(s.error){i.error(s.error),setTimeout(()=>c("/account/payment_plans"),2e3);return}if(!o)throw new Error("Authentication required");const r=new URLSearchParams(window.location.search),l=window.location.pathname.split("/").pop();if(l==="free_plan"){const{error:p}=await q({session:o});if(p)throw new Error(`Failed to activate free plan: ${p}`);i.success("Free plan activated!"),c("/account");return}const f=parseInt(r.get("seats")||"1"),h=r.get("discount")==="true",g=r.get("discountcode"),{error:u,stripeUrl:d}=await M({session:o,priceId:l,seats:f,discount:h,discountcode:g});if(u||!d)throw new Error(u||"Failed to create checkout session");window.location.href=d}catch(r){console.error("Error:",r),i.error(r.message||"An unexpected error occurred"),setTimeout(()=>c("/account/payment_plans"),2e3)}}),t.$$set=r=>{"data"in r&&n(0,s=r.data)},[s]}class J extends F{constructor(e){super(),U(this,e,I,A,w,{data:0})}}export{J as component,D as universal};
